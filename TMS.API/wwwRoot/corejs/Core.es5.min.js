"use strict";Bridge.assembly("Core",function(n){Bridge.define("Core.Clients.BadGatewayQueue",{fields:{_queue:null},props:{Count:{get:function(){return this._queue.Count}}},ctors:{init:function(){this._queue=new(System.Collections.Generic.Queue$1(Core.Clients.XHRWrapper).ctor)}},methods:{Enqueue:function(n){n.NoQueue||n.Method===Core.Enums.HttpMethod.GET||(n.Retry=!0,this._queue.Enqueue(n))},Dequeue:function(){return this._queue.Dequeue()},Peek:function(){return this._queue.Peek()}}});Bridge.define("Core.Clients.Client",{statics:{fields:{ErrorMessage:null,ModelNamespace:null,entities:null,token:null,GuidLength:0,BadGatewayRequest:null,_errorMessageAwaiter:0,UnAuthorizedEventHandler:null,SignOutEventHandler:null},props:{EpsilonNow:{get:function(){return System.DateTime.addMinutes(System.DateTime.getNow(),2)}},Host:{get:function(){return window.Host!=null?Bridge.toString(window.Host):window.location.host}},Origin:{get:function(){return window.OriginLocation!=null?Bridge.toString(window.OriginLocation):(window.location.origin||"")+"/"}},Prefix:{get:function(){return(Core.Clients.Client.Origin||"")+"api"}},Tenant:{get:function(){var n;return(n=System.Linq.Enumerable.from(document.head.children,HTMLElement).where(function(n){return Bridge.is(n,HTMLMetaElement)}).select(function(n){return Bridge.cast(n,HTMLMetaElement)}).firstOrDefault(function(n){var t;return(t=n)!=null&&Bridge.referenceEquals(t.name,"tenant")},null))!=null?n.content:null}},FileFTP:{get:function(){var n;return(n=System.Linq.Enumerable.from(document.head.children,HTMLElement).where(function(n){return Bridge.is(n,HTMLMetaElement)}).select(function(n){return Bridge.cast(n,HTMLMetaElement)}).firstOrDefault(function(n){var t;return(t=n)!=null&&Bridge.referenceEquals(t.name,"file")},null))!=null?n.content:null}},Token:{get:function(){return Core.Clients.Client.token!=null?Core.Clients.Client.token:Core.Clients.LocalStorage.GetItem(Core.ViewModels.Token,"UserInfo")},set:function(n){Core.Clients.Client.token=n;Core.Clients.LocalStorage.SetItem(Core.ViewModels.Token,"UserInfo",n)}},Entities:{get:function(){return Core.Clients.Client.entities!=null?Core.Clients.Client.entities:Core.Clients.LocalStorage.GetItem(System.Collections.Generic.Dictionary$2(System.Int32,Core.Models.Entity),"Entities")},set:function(n){Core.Clients.Client.entities=n;Core.Clients.LocalStorage.SetItem(System.Collections.Generic.Dictionary$2(System.Int32,Core.Models.Entity),"Entities",n)}},SystemRole:!1},ctors:{init:function(){this.ErrorMessage="Hệ thống đang cập nhật vui lòng chờ trong 30s!";this.GuidLength=36;this.BadGatewayRequest=new Core.Clients.BadGatewayQueue}},methods:{CheckHasRole:function(n){return Core.Clients.Client.Token==null?!1:System.Linq.Enumerable.from(Core.Clients.Client.Token.RoleNames,System.String).any(function(t){return System.String.indexOf(t,System.String.replaceAll(System.Enum.toString(Core.Enums.RoleEnum,n),"_"," "),0,null,5)>=0})},CheckHasRole$1:function(n,t){return System.Linq.Enumerable.from(n,System.String).any(function(n){return System.String.indexOf(n,System.String.replaceAll(System.Enum.toString(Core.Enums.RoleEnum,t),"_"," "),0,null,5)>=0})},CheckIsRole:function(n,t){return System.String.indexOf(n,System.String.replaceAll(System.Enum.toString(Core.Enums.RoleEnum,t),"_"," "),0,null,5)>=0},ApplyParameter:function(n,t){var i=System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Bridge.getType(t,n),16,28),System.Reflection.PropertyInfo).select(function(n){return System.String.format("{0}={1}",n.n,Bridge.Reflection.midel(n.g,t)())});return Bridge.toArray(i).join("&")},FetchWrapper:function(n,t,i){var e,o,h,c,l=n.FormData==null,r=new XMLHttpRequest,u,f,s;n.Headers==null&&n.FormData==null&&(n.Headers=function(n){return n.add("content-type","application/json"),n}(new(System.Collections.Generic.Dictionary$2(System.String,System.String).ctor)));Core.Extensions.StringExt.HasAnyChar(n.Url)&&n.Url.charCodeAt(0)===47&&(n.Url=n.Url.substr(1));n.FinalUrl==null&&(u=n.Url,f=Core.Extensions.Utils.GetUrlParam(Core.Extensions.Utils.TenantField),Core.Extensions.StringExt.IsNullOrEmpty(f)&&(f=Core.Clients.Client.Tenant),Core.Extensions.StringExt.IsNullOrWhiteSpace(Core.Extensions.Utils.GetUrlParam(Core.Extensions.Utils.TenantField,n.Url))&&Core.Clients.Client.Token==null&&n.AddTenant&&(s="t="+((e=f,e!=null?e:"wr1")||""),u=(u||"")+((System.String.contains(u,Core.Extensions.Utils.QuestionMark)?"&"+(s||""):(Core.Extensions.Utils.QuestionMark||"")+(s||""))||"")),n.FinalUrl=encodeURI(System.IO.Path.Combine([(o=n.Prefix,o!=null?o:Core.Clients.Client.Prefix),n.EntityName,u])));r.open(System.Enum.toString(Core.Enums.HttpMethod,n.Method),n.FinalUrl,!0);Core.Extensions.IEnumerableExtensions.ForEach(System.Collections.Generic.KeyValuePair$2(System.String,System.String),n.Headers,function(n){r.setRequestHeader(n.key,n.value)});n.AllowAnonymous||r.setRequestHeader(Core.Extensions.Utils.Authorization,"Bearer "+(((h=Core.Clients.Client.Token)!=null?h.AccessToken:null)||""));r.onreadystatechange=Bridge.fn.combine(r.onreadystatechange,function(){if(r.readyState===4)if(r.status>=Core.Enums.HttpStatusCode.OK&&r.status<Core.Enums.HttpStatusCode.MultipleChoices){var n=JSON.parse(r.responseText);t.call(null,n,r)}else i.call(null,r)});Bridge.staticEquals(n.ProgressHandler,null)||r.addEventListener("progress",n.ProgressHandler);l?(n.AllowNestedObject||(n!=null&&(c=n.Value)!=null?Core.Extensions.ReflectionExt.ClearReferences(c):null),r.send(n.JsonData)):r.send(n.FormData)},ErrorHandler:function(n,t,i,r){var f,u;if(t.Retry){i.trySetResult(!1);return}try{u=Newtonsoft.Json.JsonConvert.DeserializeObject(r.responseText,Core.Clients.TmpException);u.StatusCode=r.status}catch(e){e=System.Exception.create(e);u=(f=new Core.Clients.TmpException,f.Message="Đã có lỗi xảy ra trong quá trình xử lý",f.StackTrace=r.responseText,f)}if(!Bridge.staticEquals(t.ErrorHandler,null)){t.ErrorHandler(r);i.trySetException((f=new Core.Clients.HttpException.$ctor1(u.Message),f.XHR=r,f));return}r.status>=Core.Enums.HttpStatusCode.BadRequest&&r.status<Core.Enums.HttpStatusCode.InternalServerError?(System.Nullable.getValue(System.Nullable.not(u!=null?Core.Extensions.StringExt.IsNullOrWhiteSpace(u.Message):null))&&Core.Extensions.Toast.Warning(u!=null?u.Message:null),System.Console.WriteLine(u)):r.status===Core.Enums.HttpStatusCode.InternalServerError||r.status===Core.Enums.HttpStatusCode.NotFound?System.Console.WriteLine(u):r.status===Core.Enums.HttpStatusCode.Unauthorized?Bridge.staticEquals(Core.Clients.Client.UnAuthorizedEventHandler,null)?null:Core.Clients.Client.UnAuthorizedEventHandler(t):r.status===0||r.status>=Core.Enums.HttpStatusCode.BadGateway||r.status===Core.Enums.HttpStatusCode.GatewayTimeout||r.status===Core.Enums.HttpStatusCode.ServiceUnavailable?(window.clearTimeout(Core.Clients.Client._errorMessageAwaiter),Core.Clients.Client._errorMessageAwaiter=window.setTimeout(function(){Core.Extensions.Toast.Warning("Lỗi kết nối tới máy chủ, vui lòng chờ trong giây lát...")},100),t.Retry||Core.Clients.Client.BadGatewayRequest.Enqueue(t)):System.String.isNullOrWhiteSpace(r.responseText)||Core.Extensions.Toast.Warning(r.responseText);i.trySetException((f=new Core.Clients.HttpException.$ctor1(u.Message),f.XHR=r,f))},ProcessSuccessRequest:function(n,t,i,r){var u,f,o,e;if(t.Retry){i.trySetResult(!0);return}if(Core.Extensions.StringExt.IsNullOrEmpty(r.responseText)){i.trySetResult(Bridge.getDefaultValue(n));return}if(!Bridge.staticEquals(t.CustomParser,null)){i.trySetResult(Bridge.unbox(t.CustomParser(r.response)));return}u=n;Core.Extensions.ReflectionExt.IsInt32(u)?i.trySetResult(Core.Extensions.Utils.TryParseInt(r.responseText)):Core.Extensions.ReflectionExt.IsDecimal(u)?i.trySetResult(Core.Extensions.Utils.TryParseDecimal(r.responseText)):Bridge.referenceEquals(n,System.String)?i.trySetResult(r.responseText):Bridge.referenceEquals(n,Blob)?(f=null,o=new Blob([r.response],r.responseType),i.trySetResult(f)):(e=Newtonsoft.Json.JsonConvert.DeserializeObject(r.responseText,n),i.trySetResult(e))},ClearCacheHeader:function(n){var t=new(System.Collections.Generic.Dictionary$2(System.String,System.String).ctor);return n&&(t.add("Pragma","no-cache"),t.add("Expires","0"),t.add("Last-Modified",System.DateTime.format(System.DateTime.getDefaultValue())),t.add("If-Modified-Since",System.DateTime.format(System.DateTime.getDefaultValue())),t.add("Cache-Control","no-store, no-cache, must-revalidate, post-check=0, pre-check=0")),t},LoadScript:function(n){var i=new System.Threading.Tasks.TaskCompletionSource,r=System.Linq.Enumerable.from(document.head.children,HTMLElement).where(function(n){return Bridge.is(n,HTMLScriptElement)}).select(function(n){return Bridge.cast(n,HTMLScriptElement)}).any(function(t){return Bridge.referenceEquals(System.Linq.Enumerable.from(t.src.split("/"),System.String).lastOrDefault(null,null),System.Linq.Enumerable.from(n.split("/"),System.String).lastOrDefault(null,null))}),t;return r?(i.setResult(!0),i.task):(t=document.createElement(System.Enum.toString(System.String,"script")),t.src=n,t.onload=Bridge.fn.combine(t.onload,function(){i.setResult(!0)}),t.onerror=Bridge.fn.combine(t.onerror,function(){return i.setResult(!0),!1}),document.head.appendChild(t),i.task)},LoadLink:function(n){var i=new System.Threading.Tasks.TaskCompletionSource,r=System.Linq.Enumerable.from(document.head.children,HTMLElement).any(function(t){var i;return(i=Bridge.as(t,HTMLLinkElement))!=null&&Bridge.referenceEquals(System.String.replaceAll(i.href,document.location.origin,""),n)}),t;return r?(i.setResult(!0),i.task):(t=document.createElement(System.Enum.toString(System.String,"style")),t.href=n,t.onload=Bridge.fn.combine(t.onload,function(){i.setResult(!0)}),t.onerror=Bridge.fn.combine(t.onerror,function(){return i.setResult(!0),!1}),document.head.appendChild(t),i.task)},RefreshToken:function(n){var i=0,u,e,r=new System.Threading.Tasks.TaskCompletionSource,t,f,o,s=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3],i);switch(i){case 0:if(n===void 0&&(n=null),t=Core.Clients.Client.Token,t==null||System.DateTime.lte(t.RefreshTokenExp,Core.Clients.Client.EpsilonNow)){r.setResult(null);return}if(System.DateTime.gt(t.AccessTokenExp,Core.Clients.Client.EpsilonNow)){r.setResult(t);return}if(System.DateTime.lte(t.AccessTokenExp,Core.Clients.Client.EpsilonNow)&&System.DateTime.gt(t.RefreshTokenExp,Core.Clients.Client.EpsilonNow)){i=1;continue}i=3;continue;case 1:if(u=Core.Clients.Client.GetToken(t),i=2,u.isCompleted())continue;u["continue"](s);return;case 2:e=u.getAwaitedResult();f=e;f!=null&&(Core.Clients.Client.Token=f,Bridge.staticEquals(n,null)||n(f));i=3;continue;case 3:r.setResult(null);return;default:r.setResult(null);return}}}catch(h){o=System.Exception.create(h);r.setException(o)}},arguments);return s(),r.task},GetToken:function(n){var i=0,r,o,u=new System.Threading.Tasks.TaskCompletionSource,s,h,t,e,f,c,l=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(s=new Core.Clients.Client.$ctor1("User",Bridge.Reflection.getTypeNamespace(Core.Models.User)),r=s.SubmitAsync(Core.ViewModels.Token,(t=new Core.Clients.XHRWrapper,t.NoQueue=!0,t.Url=System.String.format("Refresh?t={0}",[(e=Core.Clients.Client.Token.TenantCode,e!=null?e:Core.Clients.Client.Tenant)]),t.Method=Core.Enums.HttpMethod.POST,t.Value=(f=new Core.ViewModels.RefreshVM,f.AccessToken=n.AccessToken,f.RefreshToken=n.RefreshToken,f),t.AllowAnonymous=!0,t.ErrorHandler=function(n){n.status===Core.Enums.HttpStatusCode.BadRequest&&(Core.Clients.Client.Token=null,Core.Extensions.Toast.Warning("Phiên truy cập đã hết hạn! Vui lòng chờ trong giây lát, hệ thống đang tải lại trang"),window.location.reload())},t)),i=1,r.isCompleted())continue;r["continue"](l);return;case 1:o=r.getAwaitedResult();h=o;u.setResult(h);return;default:u.setResult(null);return}}}catch(a){c=System.Exception.create(a);u.setException(c)}},arguments);return l(),u.task},Download:function(n){var t,r=Core.Clients.Client.RemoveGuid(n),i=(t=document.createElement("a"),t.href=System.String.contains(n,"http")?n:System.IO.Path.Combine([Core.Clients.Client.Origin,n]),t.target="_blank",t);i.setAttribute("download",r);document.body.appendChild(i);i.click();document.body.removeChild(i)},LoadEntities:function(){var n=0,t,u,i=new System.Threading.Tasks.TaskCompletionSource,f,r,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=new Core.Clients.Client.$ctor1("Entity",Bridge.Reflection.getTypeNamespace(Core.Models.Entity)).GetRawList(Core.Models.Entity,void 0,!1,!0,!1,void 0),n=1,t.isCompleted())continue;t["continue"](o);return;case 1:u=t.getAwaitedResult();f=u;Core.Clients.Client.Entities=(r=Core.Models.Entity,System.Linq.Enumerable.from(f,r).toDictionary(function(n){return n.Id},null,System.Int32,r));i.setResult(null);return;default:i.setResult(null);return}}}catch(s){e=System.Exception.create(s);i.setException(e)}},arguments);return o(),i.task},RemoveGuid:function(n){var i=n,t;return n.length>Core.Clients.Client.GuidLength&&(t=System.IO.Path.GetFileNameWithoutExtension(n),i=(Core.Extensions.StringExt.SubStrIndex$1(t,0,t.length-Core.Clients.Client.GuidLength|0)||"")+(System.IO.Path.GetExtension(n)||"")),i}}},fields:{_nameSpace:null},props:{NameSpace:{get:function(){return Core.Extensions.StringExt.IsNullOrEmpty(this._nameSpace)?Core.Clients.Client.ModelNamespace:this._nameSpace}},CustomPrefix:null,EntityName:null,FileName:null,FileType:null},ctors:{ctor:function(){this.$initialize()},$ctor1:function(n,t){t===void 0&&(t="");this.$initialize();this._nameSpace=t;Core.Extensions.StringExt.HasAnyChar(this._nameSpace)&&System.Linq.Enumerable.from(this._nameSpace,System.Char).last()!==46&&(this._nameSpace=(this._nameSpace||"")+String.fromCharCode(46));this.EntityName=n}},methods:{SubmitAsync:function(n,t){var i=0,r,h,u,o,f=new System.Threading.Tasks.TaskCompletionSource,s,e=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3,4],i);switch(i){case 0:if(!t.AllowAnonymous){i=1;continue}i=3;continue;case 1:if(r=Core.Clients.Client.RefreshToken(),i=2,r.isCompleted())continue;r["continue"](e);return;case 2:h=r.getAwaitedResult();i=3;continue;case 3:if(u=this.SubmitAsyncWithToken(n,t),i=4,u.isCompleted())continue;u["continue"](e);return;case 4:o=u.getAwaitedResult();f.setResult(o);return;default:f.setResult(null);return}}}catch(c){s=System.Exception.create(c);f.setException(s)}},arguments);return e(),f.task},Fetch:function(n,t){var i=new System.Threading.Tasks.TaskCompletionSource;return Core.Clients.Client.FetchWrapper(t,function(t){i.trySetResult(Bridge.cast(Bridge.unbox(t,n),n))},function(n){i.trySetException(new System.Exception(n.responseText))}),i.task},SubmitAsyncWithToken:function(n,t){var f,e,h,c,l=t.FormData==null,o=new System.Threading.Tasks.TaskCompletionSource,i=new XMLHttpRequest,r,u,s;return t.Headers==null&&t.FormData==null&&(t.Headers=function(n){return n.add("content-type","application/json"),n}(new(System.Collections.Generic.Dictionary$2(System.String,System.String).ctor))),Core.Extensions.StringExt.HasAnyChar(t.Url)&&t.Url.charCodeAt(0)===47&&(t.Url=t.Url.substr(1)),t.FinalUrl==null&&(r=t.Url,u=Core.Extensions.Utils.GetUrlParam(Core.Extensions.Utils.TenantField),Core.Extensions.StringExt.IsNullOrEmpty(u)&&(u=Core.Clients.Client.Tenant),Core.Extensions.StringExt.IsNullOrWhiteSpace(Core.Extensions.Utils.GetUrlParam(Core.Extensions.Utils.TenantField,t.Url))&&Core.Clients.Client.Token==null&&t.AddTenant&&(s="t="+((f=u,f!=null?f:"wr1")||""),r=(r||"")+((System.String.contains(r,Core.Extensions.Utils.QuestionMark)?"&"+(s||""):(Core.Extensions.Utils.QuestionMark||"")+(s||""))||"")),t.FinalUrl=encodeURI(System.IO.Path.Combine([(e=this.CustomPrefix,e!=null?e:Core.Clients.Client.Prefix),this.EntityName,r]))),i.open(System.Enum.toString(Core.Enums.HttpMethod,t.Method),t.FinalUrl,!0),Core.Extensions.IEnumerableExtensions.ForEach(System.Collections.Generic.KeyValuePair$2(System.String,System.String),t.Headers,function(n){i.setRequestHeader(n.key,n.value)}),t.AllowAnonymous||i.setRequestHeader(Core.Extensions.Utils.Authorization,"Bearer "+(((h=Core.Clients.Client.Token)!=null?h.AccessToken:null)||"")),i.onreadystatechange=Bridge.fn.combine(i.onreadystatechange,function(){i.readyState===4&&(i.status>=Core.Enums.HttpStatusCode.OK&&i.status<Core.Enums.HttpStatusCode.MultipleChoices?Core.Clients.Client.ProcessSuccessRequest(n,t,o,i):Core.Clients.Client.ErrorHandler(n,t,o,i))}),Bridge.staticEquals(t.ProgressHandler,null)||i.addEventListener("progress",t.ProgressHandler),l?(t.AllowNestedObject||(t!=null&&(c=t.Value)!=null?Core.Extensions.ReflectionExt.ClearReferences(c):null),i.send(t.JsonData)):i.send(t.FormData),o.task},GetList:function(n,t,i){var r=0,e,y,o,p,s,w,u=new System.Threading.Tasks.TaskCompletionSource,b,c,f,l,a,v,k,h=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1,2,3,4,5,6,7],r);switch(r){case 0:if(t===void 0&&(t=null),i===void 0&&(i=!1),b=Core.Clients.Client.ClearCacheHeader(i),c=(f=new Core.Clients.XHRWrapper,f.Value=null,f.Url=t,f.Headers=b,f.Method=Core.Enums.HttpMethod.GET,f),!Bridge.referenceEquals(n,System.Object)){r=1;continue}r=3;continue;case 1:if(l=n,this.EntityName=l!=null?Bridge.Reflection.getTypeName(l):null,e=this.SubmitAsync(Core.Models.OdataResult$1(n),c),r=2,e.isCompleted())continue;e["continue"](h);return;case 2:y=e.getAwaitedResult();u.setResult(y);return;case 3:if(a=Bridge.Reflection.getType((this.NameSpace||"")+(this.EntityName||"")),a==null){r=4;continue}r=6;continue;case 4:if(o=this.SubmitAsync(Core.Models.OdataResult$1(System.Object),c),r=5,o.isCompleted())continue;o["continue"](h);return;case 5:p=o.getAwaitedResult();u.setResult(p);return;case 6:if(v=System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Bridge.getType(this),8,28),System.Reflection.MethodInfo).firstOrDefault(function(n){return Bridge.referenceEquals(n.n,"GetList")&&Bridge.Reflection.isGenericMethodDefinition(n)},null),v==null){u.setResult(new(Core.Models.OdataResult$1(n)));return}if(s=Bridge.unbox(Bridge.Reflection.midel(Bridge.Reflection.makeGenericMethod(v,[a]),this)(t,i)),r=7,s.isCompleted())continue;s["continue"](h);return;case 7:w=s.getAwaitedResult();u.setResult(w);return;default:u.setResult(null);return}}}catch(d){k=System.Exception.create(d);u.setException(k)}},arguments);return h(),u.task},GetRawList:function(n,t,i,r,u,f){var o=0,s,a,h=new System.Threading.Tasks.TaskCompletionSource,c,v,l,e,y,p=Bridge.fn.bind(this,function(){try{for(;;){o=System.Array.min([0,1],o);switch(o){case 0:if(t===void 0&&(t=null),i===void 0&&(i=!1),r===void 0&&(r=!1),u===void 0&&(u=!1),f===void 0&&(f=null),this.EntityName=(c=f,c!=null?c:Bridge.Reflection.getTypeName(n)),v=Core.Clients.Client.ClearCacheHeader(i),s=this.SubmitAsync(Core.Models.OdataResult$1(n),(e=new Core.Clients.XHRWrapper,e.Value=null,e.AddTenant=r,e.Url=t,e.Headers=v,e.AllowAnonymous=u,e.Method=Core.Enums.HttpMethod.GET,e)),o=1,s.isCompleted())continue;s["continue"](p);return;case 1:a=s.getAwaitedResult();l=a;h.setResult(l!=null?l.Value:null);return;default:h.setResult(null);return}}}catch(w){y=System.Exception.create(w);h.setException(y)}},arguments);return p(),h.task},FirstOrDefaultAsync:function(n,t,i,r){var f=0,e,h,o=new System.Threading.Tasks.TaskCompletionSource,c,s,u,l,a=Bridge.fn.bind(this,function(){try{for(;;){f=System.Array.min([0,1],f);switch(f){case 0:if(t===void 0&&(t=null),i===void 0&&(i=!1),r===void 0&&(r=!1),t=Core.Extensions.OdataExt.ApplyClause(t,Bridge.toString(1),Core.Extensions.OdataExt.TopKeyword),this.EntityName=Bridge.Reflection.getTypeName(n),c=Core.Clients.Client.ClearCacheHeader(i),e=this.SubmitAsync(Core.Models.OdataResult$1(n),(u=new Core.Clients.XHRWrapper,u.Value=null,u.AddTenant=r,u.Url=t,u.Headers=c,u.Method=Core.Enums.HttpMethod.GET,u)),f=1,e.isCompleted())continue;e["continue"](a);return;case 1:h=e.getAwaitedResult();s=h;o.setResult(s!=null&&(u=s.Value)!=null?System.Linq.Enumerable.from(u,n).firstOrDefault(null,null):null);return;default:o.setResult(null);return}}}catch(v){l=System.Exception.create(v);o.setException(l)}},arguments);return a(),o.task},FirstOrDefaultAsync$1:function(n,t,i){var u=0,f,o,e=new System.Threading.Tasks.TaskCompletionSource,s,h,r,c,l,a=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1],u);switch(u){case 0:if(t===void 0&&(t=null),i===void 0&&(i=!1),t=Core.Extensions.OdataExt.ApplyClause(t,Bridge.toString(1),Core.Extensions.OdataExt.TopKeyword),this.EntityName=Bridge.Reflection.getTypeName(n),s=Core.Clients.Client.ClearCacheHeader(i),f=this.SubmitAsync(Core.Models.OdataResult$1(System.Object),(r=new Core.Clients.XHRWrapper,r.Value=null,r.Url=t,r.Headers=s,r.Method=Core.Enums.HttpMethod.GET,r)),u=1,f.isCompleted())continue;f["continue"](a);return;case 1:o=f.getAwaitedResult();h=o;c=Newtonsoft.Json.JsonConvert.DeserializeObject(Newtonsoft.Json.JsonConvert.SerializeObject(System.Linq.Enumerable.from(h.Value,System.Object).firstOrDefault(null,null)),n);e.setResult(c);return;default:e.setResult(null);return}}}catch(v){l=System.Exception.create(v);e.setException(l)}},arguments);return a(),e.task},LoadById:function(n,t,i){var r;return t===void 0&&(t=""),i===void 0&&(i="ById"),this.SubmitAsync(Core.Models.OdataResult$1(System.Object),(r=new Core.Clients.XHRWrapper,r.Value=n,r.Method=Core.Enums.HttpMethod.POST,r.Url=i,r.Headers=function(n){return n.add("content-type","application/json"),n}(new(System.Collections.Generic.Dictionary$2(System.String,System.String).ctor)),r))},GetRawListById:function(n,t,i,r,u){var e=0,o,h,f=new System.Threading.Tasks.TaskCompletionSource,c,s,l,a,v=Bridge.fn.bind(this,function(){try{for(;;){e=System.Array.min([0,1],e);switch(e){case 0:if(i===void 0&&(i=""),r===void 0&&(r=""),u===void 0&&(u=!1),Core.Extensions.IEnumerableExtensions.Nothing(System.Int32,t)){f.setResult(new(System.Collections.Generic.List$1(n).ctor));return}if(t=System.Linq.Enumerable.from(t,System.Int32).distinct().toList(System.Int32),c=Bridge.Reflection.getType((this.NameSpace||"")+(this.EntityName||"")),s=System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Bridge.getType(this),8,28),System.Reflection.MethodInfo).firstOrDefault(function(n){return Bridge.referenceEquals(n.n,"GetRawList")&&Bridge.Reflection.isGenericMethodDefinition(n)},null),s==null){f.setResult(new(System.Collections.Generic.List$1(n).ctor));return}if(l=System.String.format("{0}/?{1}$filter=Id in ({2})",r,Bridge.referenceEquals(i,"")?"":System.String.format("t={0}&",[i]),Bridge.toArray(t).join(",")),o=Bridge.unbox(Bridge.Reflection.midel(Bridge.Reflection.makeGenericMethod(s,[c]),this)(l,u)),e=1,o.isCompleted())continue;o["continue"](v);return;case 1:h=o.getAwaitedResult();f.setResult(h);return;default:f.setResult(null);return}}}catch(y){a=System.Exception.create(y);f.setException(a)}},arguments);return v(),f.task},GetAsync:function(n,t){var r=0,u,e,i=new System.Threading.Tasks.TaskCompletionSource,o,f,s,h=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(t==null||System.Nullable.lte(t,0)){i.setResult(Bridge.getDefaultValue(n));return}if(this.EntityName=Bridge.Reflection.getTypeName(n),u=this.SubmitAsync(Core.Models.OdataResult$1(n),(f=new Core.Clients.XHRWrapper,f.Url=System.String.format("/Public/?ids={0}",[Bridge.box(t,System.Int32,System.Nullable.toString,System.Nullable.getHashCode)]),f.Method=Core.Enums.HttpMethod.GET,f)),r=1,u.isCompleted())continue;u["continue"](h);return;case 1:e=u.getAwaitedResult();o=e;i.setResult(System.Linq.Enumerable.from(o.Value,n).firstOrDefault(null,function(){return Bridge.getDefaultValue(n)}));return;default:i.setResult(null);return}}}catch(c){s=System.Exception.create(c);i.setException(s)}},arguments);return h(),i.task},GetAsync$1:function(n,t){var i;return this.SubmitAsync(n,(i=new Core.Clients.XHRWrapper,i.Url=t,i.Method=Core.Enums.HttpMethod.GET,i))},GetRawAsync:function(n){var i=Bridge.Reflection.getType((this.NameSpace||"")+(this.EntityName||"")),t=System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Bridge.getType(this),8,28),System.Reflection.MethodInfo).firstOrDefault(function(n){return Bridge.referenceEquals(n.n,"GetAsync")&&Bridge.Reflection.isGenericMethodDefinition(n)},null);return t==null?null:Bridge.unbox(Bridge.Reflection.midel(Bridge.Reflection.makeGenericMethod(t,[i]),this)(n))},CreateAsync$1:function(n,t){t===void 0&&(t="");var r=Bridge.Reflection.getType((this.NameSpace||"")+(this.EntityName||"")),i=System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Bridge.getType(this),8,28),System.Reflection.MethodInfo).firstOrDefault(function(n){return Bridge.referenceEquals(n.n,"PostAsync")&&Bridge.Reflection.isGenericMethodDefinition(n)},null);return i==null?System.Threading.Tasks.Task.fromResult({},System.Object):Bridge.unbox(Bridge.Reflection.midel(Bridge.Reflection.makeGenericMethod(i,[r]),this)(Bridge.unbox(n),t))},CreateAsync:function(n,t,i){return i===void 0&&(i=""),this.PostAsync(n,t,i)},PostAsync:function(n,t,i,r,u){var f;return i===void 0&&(i=""),r===void 0&&(r=!1),u===void 0&&(u=!1),this.SubmitAsync(n,(f=new Core.Clients.XHRWrapper,f.Value=t,f.Url=i,f.Method=Core.Enums.HttpMethod.POST,f.AllowAnonymous=r,f.AllowNestedObject=u,f))},PutAsync:function(n,t,i,r,u){var f;return i===void 0&&(i=""),r===void 0&&(r=!1),u===void 0&&(u=!1),this.SubmitAsync(n,(f=new Core.Clients.XHRWrapper,f.Value=t,f.Url=i,f.Method=Core.Enums.HttpMethod.PUT,f.AllowAnonymous=r,f.AllowNestedObject=u,f))},UpdateAsync$1:function(n,t){var i,u,r;return(t===void 0&&(t=""),u=Bridge.Reflection.getType(((i=this.NameSpace,i!=null?i:"Core.Models.")||"")+(this.EntityName||"")),r=System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Bridge.getType(this),8,28),System.Reflection.MethodInfo).firstOrDefault(function(n){return Bridge.referenceEquals(n.n,"UpdateAsync")&&Bridge.Reflection.isGenericMethodDefinition(n)},null),r==null)?System.Threading.Tasks.Task.fromResult({},System.Object):Bridge.Reflection.midel(Bridge.Reflection.makeGenericMethod(r,[u]),this)(Bridge.unbox(n),t)},UpdateAsync:function(n,t,i,r,u){var f;return i===void 0&&(i=""),r===void 0&&(r=!1),u===void 0&&(u=!1),this.SubmitAsync(n,(f=new Core.Clients.XHRWrapper,f.Value=t,f.Url=i,f.Method=Core.Enums.HttpMethod.PUT,f.AllowAnonymous=r,f.AllowNestedObject=u,f))},PatchAsync:function(n,t,i,r,u,f){var e,o;return i===void 0&&(i=""),r===void 0&&(r=""),u===void 0&&(u=!1),f===void 0&&(f=!1),o=System.Linq.Enumerable.from(t.Changes,Core.ViewModels.PatchUpdateDetail).firstOrDefault(function(n){return Bridge.referenceEquals(n.Field,Core.Extensions.Utils.IdField)},null),this.SubmitAsync(n,(e=new Core.Clients.XHRWrapper,e.Value=t,e.Url=(i||"")+(System.String.format("?$filter=Id eq {0}{1}",o.Value,r)||""),e.Headers=function(n){return n.add("Content-type","application/json"),n}(new(System.Collections.Generic.Dictionary$2(System.String,System.String).ctor)),e.Method=Core.Enums.HttpMethod.PATCH,e.AllowAnonymous=u,e.AllowNestedObject=f,e))},PatchAsync$1:function(n,t,i,r){var u=0,f,h,e=new System.Threading.Tasks.TaskCompletionSource,v,o,s,c,l,a=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1,2,3,4],u);switch(u){case 0:i===void 0&&(i="");r===void 0&&(r=!0);v=System.Linq.Enumerable.from(t,Core.ViewModels.PatchUpdate).select(Bridge.fn.bind(this,function(t){return this.PatchAsync(n,t)}));o=new(System.Collections.Generic.List$1(n).ctor);s=Bridge.getEnumerator(t);u=1;continue;case 1:if(s.moveNext()){c=s.Current;u=2;continue}u=4;continue;case 2:if(f=this.PatchAsync(n,c),u=3,f.isCompleted())continue;f["continue"](a);return;case 3:h=f.getAwaitedResult();o.add(h);u=1;continue;case 4:e.setResult(o);return;default:e.setResult(null);return}}}catch(y){l=System.Exception.create(y);e.setException(l)}},arguments);return a(),e.task},PostFilesAsync:function(n,t,i,r){var u,f;return i===void 0&&(i=""),r===void 0&&(r=null),f=new FormData,f.append("file",t),this.CustomPrefix=Core.Clients.Client.FileFTP,this.SubmitAsync(n,(u=new Core.Clients.XHRWrapper,u.FormData=f,u.File=t,u.ProgressHandler=r,u.Method=Core.Enums.HttpMethod.POST,u.Url=i,u))},SendMail:function(n){var t;return this.SubmitAsync(System.Boolean,(t=new Core.Clients.XHRWrapper,t.Value=n,t.Method=Core.Enums.HttpMethod.POST,t.Url="Email",t))},CloneFeatureAsync:function(n){var t;return this.SubmitAsync(System.Boolean,(t=new Core.Clients.XHRWrapper,t.Url="Clone",t.Value=Bridge.box(n,System.Int32),t.Method=Core.Enums.HttpMethod.POST,t))},DeactivateAsync:function(n){var t;return this.SubmitAsync(System.Boolean,(t=new Core.Clients.XHRWrapper,t.Url="Delete",t.Value=Core.Extensions.IEnumerableExtensions.Combine(System.Int32,n),t.AllowNestedObject=!0,t.Method=Core.Enums.HttpMethod.DELETE,t))},BulkUpdateAsync:function(n,t,i,r){var f=0,o,c,s,l,e=new System.Threading.Tasks.TaskCompletionSource,u,a,v,y,h=Bridge.fn.bind(this,function(){try{for(;;){f=System.Array.min([0,1,2,3,4],f);switch(f){case 0:if(i===void 0&&(i=""),r===void 0&&(r=!0),!r){f=1;continue}f=3;continue;case 1:if(o=this.SubmitAsync(System.Collections.Generic.List$1(n),(u=new Core.Clients.XHRWrapper,u.Url=System.String.format("BulkUpdate/?reasonOfChange={0}",[i]),u.Value=t,u.Method=Core.Enums.HttpMethod.PUT,u)),f=2,o.isCompleted())continue;o["continue"](h);return;case 2:c=o.getAwaitedResult();e.setResult(c);return;case 3:if(a=System.Linq.Enumerable.from(t,n).select(Bridge.fn.bind(this,function(t){return Bridge.unbox(t[Core.Extensions.Utils.IdField])>0?this.UpdateAsync(n,t,System.String.format("?reasonOfChange={0}",[i])):this.CreateAsync(n,t,System.String.format("?reasonOfChange=Thêm mới dữ liệu",null))})),s=System.Threading.Tasks.Task.whenAll(a),f=4,s.isCompleted())continue;s["continue"](h);return;case 4:l=s.getAwaitedResult();v=l;e.setResult((u=n,System.Linq.Enumerable.from(v,u).toList(u)));return;default:e.setResult(null);return}}}catch(p){y=System.Exception.create(p);e.setException(y)}},arguments);return h(),e.task},HardDeleteAsync$1:function(n){return this.HardDeleteAsync(function(t){return t.add(n),t}(new(System.Collections.Generic.List$1(System.Int32).ctor)))},HardDeleteAsync:function(n){var t;return this.SubmitAsync(System.Boolean,(t=new Core.Clients.XHRWrapper,t.Url="HardDelete",t.Value=n,t.AllowNestedObject=!0,t.Method=Core.Enums.HttpMethod.DELETE,t))}}});Bridge.define("Core.Clients.EntityAction",{props:{EntityId:0,TypeId:0,Action:null}});Bridge.define("Core.Clients.HttpException",{inherits:[System.Exception],props:{XHR:null,StatusCode:{get:function(){return this.XHR.status}}},ctors:{ctor:function(){this.$initialize();System.Exception.ctor.call(this)},$ctor1:function(n){this.$initialize();System.Exception.ctor.call(this,n)},$ctor2:function(n,t){this.$initialize();System.Exception.ctor.call(this,n,t)}}});Bridge.define("Core.Clients.LocalStorage",{statics:{fields:{_hasRegisteredCrossTab:!1,StorageEventMap:null},props:{Instance:{get:function(){return window.localStorage}}},ctors:{init:function(){this.StorageEventMap=new(System.Collections.Generic.Dictionary$2(System.String,System.Collections.Generic.List$1(Function)).ctor)}},methods:{Subscribe:function(n,t,i,r){r===void 0&&(r=!0);var u=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String,System.Collections.Generic.List$1(Function),Core.Clients.LocalStorage.StorageEventMap,n);(u.add(t),r&&!Core.Clients.LocalStorage._hasRegisteredCrossTab)&&(Core.Clients.LocalStorage._hasRegisteredCrossTab=!0,window.addEventListener("storage",function(t){var u,o=(u=t.key)!=null?Bridge.toString(u):null,r,f,e;Bridge.referenceEquals(o,n)&&((r=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String,System.Collections.Generic.List$1(Function),Core.Clients.LocalStorage.StorageEventMap,n),Core.Extensions.IEnumerableExtensions.Nothing(Function,r))||(f=Bridge.as(t.newValue,System.String),e=Bridge.as(t.oldValue,System.String),r!=null?r.ForEach(function(t){t(n,Newtonsoft.Json.JsonConvert.DeserializeObject(f,i),Newtonsoft.Json.JsonConvert.DeserializeObject(e,i))}):null))}))},Ubsubscribe:function(n,t){var i=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String,System.Collections.Generic.List$1(Function),Core.Clients.LocalStorage.StorageEventMap,n);i.remove(t)},SetItem:function(n,t,i){i==null?Core.Clients.LocalStorage.Instance.setItem(t,null):Core.Clients.LocalStorage.Instance.setItem(t,Bridge.referenceEquals(n,System.String)?Bridge.toString(i):Newtonsoft.Json.JsonConvert.SerializeObject(i));var r=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String,System.Collections.Generic.List$1(Function),Core.Clients.LocalStorage.StorageEventMap,t);r!=null?r.ForEach(function(r){r(t,i,Core.Clients.LocalStorage.GetItem(n,t))}):null},GetItem:function(n,t){if(Bridge.referenceEquals(n,System.String))return Bridge.cast(Bridge.unbox(Core.Clients.LocalStorage.Instance.getItem(t),n),n);var i=Bridge.as(Core.Clients.LocalStorage.Instance.getItem(t),System.String);return i==null?Bridge.getDefaultValue(n):Newtonsoft.Json.JsonConvert.DeserializeObject(i,n)},RemoveItem:function(n){Core.Clients.LocalStorage.Instance.removeItem(n)}}}});Bridge.define("Core.Clients.TmpException",{props:{StatusCode:0,Message:null,StackTrace:null,InnerException:null}});Bridge.define("Core.Clients.WebSocketClient",{fields:{_socket:null,EntityAction:null},ctors:{ctor:function(n){this.$initialize();this.EntityAction=new(System.Collections.Generic.List$1(Core.Clients.EntityAction).ctor);var t=(System.String.format("wss://{0}/{1}?access_token=",Core.Clients.Client.Host,n)||"")+(Core.Clients.Client.Token.AccessToken||"");this._socket=new WebSocket(t);this._socket.onopen=Bridge.fn.combine(this._socket.onopen,function(n){System.Console.WriteLine(System.String.format("Socket opened",n))});this._socket.onclose=Bridge.fn.combine(this._socket.onclose,function(n){System.Console.WriteLine(System.String.format("Socket closed",n))});this._socket.onerror=Bridge.fn.combine(this._socket.onerror,function(n){System.Console.WriteLine(n)});this._socket.onmessage=Bridge.fn.combine(this._socket.onmessage,Bridge.fn.bind(this,function(n){var i=Bridge.toString(n.data),t=Newtonsoft.Json.JsonConvert.DeserializeObject(i,Core.Models.SocketResponse),s=t.EntityId,u=Core.Extensions.Utils.GetEntity(t.EntityId),r=u.GetEntityType();if(r!=null){var f=Core.Models.WebSocketResponse$1.apply(null,System.Array.init([r],System.Type)),e=Bridge.unbox(Newtonsoft.Json.JsonConvert.DeserializeObject(i,f)),o=e.Data;System.Linq.Enumerable.from(this.EntityAction,Core.Clients.EntityAction).where(function(n){return n.EntityId===t.EntityId&&n.TypeId===t.TypeId}).forEach(function(n){n.Action(o)})}}));this._socket.binaryType="arraybuffer"}},methods:{Send:function(n){this._socket.send(n)},AddListener:function(n,t,i){var r,u=System.Linq.Enumerable.from(this.EntityAction,Core.Clients.EntityAction).firstOrDefault(function(r){return r.EntityId===n&&Bridge.staticEquals(r.Action,i)&&r.TypeId===t},null);u==null&&this.EntityAction.add((r=new Core.Clients.EntityAction,r.EntityId=n,r.Action=i,r.TypeId=t,r))},AddListener$1:function(n,t,i){var r,u=System.Linq.Enumerable.from(Core.Clients.Client.Entities.Values,Core.Models.Entity).firstOrDefault(function(t){return Bridge.referenceEquals(t.Name,n)},null),f=System.Linq.Enumerable.from(this.EntityAction,Core.Clients.EntityAction).firstOrDefault(function(n){return n.EntityId===u.Id&&Bridge.staticEquals(n.Action,i)&&n.TypeId===t},null);f==null&&this.EntityAction.add((r=new Core.Clients.EntityAction,r.EntityId=u.Id,r.Action=i,r.TypeId=t,r))},RemoveListener:function(n,t,i){this.EntityAction.RemoveAll(function(r){return Bridge.staticEquals(r.Action,n)&&r.EntityId===t&&r.TypeId===i})},Close:function(){this._socket.close()}}});Bridge.define("Core.Clients.XHRWrapper",{props:{NoQueue:!1,Retry:!1,AllowAnonymous:!1,AddTenant:!1,AllowNestedObject:!1,Method:0,Url:null,NameSpace:null,Prefix:null,EntityName:null,FinalUrl:null,ResponseMimeType:null,Value:null,IsRaw:!1,JsonData:{get:function(){var t,i,n;if(this.Value==null)return null;if(this.IsRaw&&(i=Bridge.as(this.Value,System.String))!=null)return i;n=null;try{n=Newtonsoft.Json.JsonConvert.SerializeObject(this.Value)}catch(r){r=System.Exception.create(r);try{n=Newtonsoft.Json.JsonConvert.SerializeObject(this.Value)}catch(i){i=System.Exception.create(i);this.UnboxValue(this.Value);n=(t=n,t!=null?t:JSON.stringify(Bridge.unbox(this.Value)))}}return n}},FormData:null,File:null,ProgressHandler:null,Headers:null,CustomParser:null,ErrorHandler:null},ctors:{init:function(){this.Method=Core.Enums.HttpMethod.GET}},methods:{UnboxValue:function(n){var t,i;for(t in n)if(n[t]!==null&&(n[t].v!==undefined?n[t]=n[t].v:n[t]._items!==undefined&&(n[t]=n[t]._items),n[t]instanceof Array))for(i in n[t])this.UnboxValue(n[t][i])}}});Bridge.define("Core.Components.EditableComponent",{statics:{fields:{IdField:null,SmallScreen:0,ExSmallScreen:0,MediumScreen:0,LargeScreen:0,ExLargeScreen:0,RequiredRule:null},props:{IsSmallUp:{get:function(){return document.documentElement.clientWidth>Core.Components.EditableComponent.SmallScreen}},IsMediumUp:{get:function(){return document.documentElement.clientWidth>Core.Components.EditableComponent.MediumScreen}},IsLargeUp:{get:function(){return document.documentElement.clientWidth>Core.Components.EditableComponent.LargeScreen}}},ctors:{init:function(){var n;this.IdField="Id";this.SmallScreen=768;this.ExSmallScreen=567;this.MediumScreen=992;this.LargeScreen=1200;this.ExLargeScreen=1452;this.RequiredRule=(n=new Core.Extensions.ValidationRule,n.Rule=Core.Extensions.ValidationRule.Required,n.Message="{0} không được để trống!",n)}}},fields:{_show:!1,OnToggle:null,editForm:null,rootTab:null,emptyRow:null,_updateViewAwaiter:0,_dirty:!1,_disabled:!1,_setDirty:!1},events:{Disposed:null},props:{Id:null,ComponentType:null,Name:null,Parent:null,GuiInfo:null,Children:null,FirstChild:{get:function(){return System.Linq.Enumerable.from(this.Children,Core.Components.EditableComponent).firstOrDefault(null,null)}},ParentElement:null,Element:null,DOMContentLoaded:null,EntityType:null,EntityId:{get:function(){return this.Entity==null?0:Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField])}},Entity:null,IsSingleton:!1,EmptyRow:{get:function(){var n;return this.emptyRow==null&&(this.emptyRow=(n=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem,this))!=null?n.EmptyRow:null),System.Nullable.getValue(this.emptyRow)},set:function(n){this.emptyRow=n}},Show:{get:function(){return this._show},set:function(n){this.Toggle(n)}},TabEditor:{get:function(){return this.rootTab||Core.Components.Extensions.ComponentExt.FindClosest$1(Core.Components.Forms.TabEditor,this,function(n){return!n.Popup})},set:function(n){this.rootTab=n}},EditForm:{get:function(){return this.editForm||Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm,this)},set:function(n){this.editForm=n}},UserInput:null,AlwaysLogHistory:!1,OldValue:null,ValidationResult:null,ClassName:{get:function(){return this.Element.className},set:function(n){this.Element.className=n}},BasicUpdateText:{get:function(){return this.Updating?"Cập nhật":"Thêm mới"}},Updating:{get:function(){return this.Entity!=null&&Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField])>0}},StopChildrenHistory:!1,ValidationRules:null,Disabled:{get:function(){return this._disabled},set:function(n){var t;this._disabled=n;this.SetDisableUI(n);(t=this.Children)!=null?t.ForEach(function(t){var i;(i=t)!=null&&(i.Disabled=n)}):null}},Dirty:{get:function(){return this._dirty&&!this.AlwaysValid||System.Linq.Enumerable.from(this.FilterChildren(Core.Components.EditableComponent,function(n){return n._dirty},function(n){return!n.PopulateDirty||n.AlwaysValid}),Core.Components.EditableComponent).any()},set:function(n){this.UpdateDirty$1(n)}},OriginalText:null,AlwaysValid:!1,IsValid:{get:function(){return this.ValidationResult.Count===0}},PopulateDirty:!1},ctors:{init:function(){this._show=!0;this._setDirty=!0;this.Children=new(System.Collections.Generic.List$1(Core.Components.EditableComponent).ctor);this.PopulateDirty=!0},ctor:function(n){var t,i;this.$initialize();this.GuiInfo=n;this.GuiInfo==null||Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.Validation)?this.ValidationRules=new(System.Collections.Generic.Dictionary$2(System.String,Core.Extensions.ValidationRule).ctor):(i=Newtonsoft.Json.JsonConvert.DeserializeObject(this.GuiInfo.Validation,System.Collections.Generic.List$1(Core.Extensions.ValidationRule)),Core.Extensions.IEnumerableExtensions.HasElement(Core.Extensions.ValidationRule,i)&&(this.ValidationRules=(t=Core.Extensions.ValidationRule,System.Linq.Enumerable.from(i,t).toDictionary(function(n){return n.Rule},null,System.String,t))));this.ValidationResult=new(System.Collections.Generic.Dictionary$2(System.String,System.String).ctor);this.Children=new(System.Collections.Generic.List$1(Core.Components.EditableComponent).ctor);this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1,2,3],n);switch(n){case 0:if(this.SetRequired(),this.GuiInfo!=null&&Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.Events)){n=1;continue}n=3;continue;case 1:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"DOMContentLoaded",[this.Entity]),n=2,t.isCompleted())continue;t["continue"](i);return;case 2:t.getAwaitedResult();n=3;continue;case 3:this.SetOldTextAndVal();return;default:return}}},arguments);i()}))}},methods:{Toggle:function(n){this.Element!=null&&(this._show=n,this._show?(this.Element.style.display="",this.GuiInfo!=null&&this.GuiInfo.ShowLabel&&Bridge.is(this.Parent,Core.Components.Section)&&this.GuiInfo.FieldName!=null&&(this.Element.parentElement.style.display="",this.Element.parentElement.previousElementSibling.style.display="")):(this.Element.style.display="none",this.GuiInfo!=null&&this.GuiInfo.ShowLabel&&Bridge.is(this.Parent,Core.Components.Section)&&this.GuiInfo.FieldName!=null&&(this.Element.parentElement.style.display="none",this.Element.parentElement.previousElementSibling.style.display="none")),Bridge.staticEquals(this.OnToggle,null)?null:this.OnToggle(this._show))},AddChild:function(n,t,i,r){var u,o,f,s,e;if(t===void 0&&(t=null),i===void 0&&(i=null),r===void 0&&(r=null),n.IsSingleton){n.Render();return}n.ParentElement==null&&((e=Bridge.as(n,Core.Components.Forms.TabEditor))!=null?e.Popup?n.ParentElement=this.Element||Core.Components.Forms.TabEditor.TabContainer:e.ParentElement=Core.Components.Forms.TabEditor.TabContainer:n.ParentElement=Core.MVVM.Html.Context);n.Entity==null&&(n.Entity=this.Entity);this.Children==null&&(this.Children=new(System.Collections.Generic.List$1(Core.Components.EditableComponent).ctor));t==null||System.Nullable.gte(t,this.Children.Count)||System.Nullable.lt(t,0)?this.Children.add(n):this.Children.insert(System.Nullable.getValue(t),n);n.Parent==null&&(n.Parent=this);Core.MVVM.Html.Take(n.ParentElement);n.Render();n.ToggleShow((u=i,u!=null?u:(o=n.GuiInfo)!=null?o.ShowExp:null));n.ToggleDisabled((f=r,f!=null?f:(s=n.GuiInfo)!=null?s.DisabledExp:null))},RemoveChild:function(n){this.Children.remove(n)},Focus:function(){var n;(n=this.Element)!=null?n.focus():null},UpdateViewAwait:function(n){n===void 0&&(n=!1);window.clearTimeout(this._updateViewAwaiter);this._updateViewAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){this.UpdateView$1(n)}),100)},UpdateView$1:function(n,t){t===void 0&&(t=[]);this.UpdateView(n,null,t)},UpdateView:function(n,t,i){var r,u,f,o,e;if(n===void 0&&(n=!1),t===void 0&&(t=null),i===void 0&&(i=[]),this.PrepareUpdateView(n,t),!Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,this.Children))if(Core.Extensions.IEnumerableExtensions.HasElement(System.String,i)){var s=System.Linq.Enumerable.from(this.FilterChildren(Core.Components.Section,function(n){return System.Array.contains(i,n.Name,System.String)&&Bridge.hasValue(n)}),Core.Components.Section).selectMany(function(n){return n.FilterChildren(Core.Components.EditableComponent,function(n){return!Bridge.is(n,Core.Components.Section)})}),h=System.Linq.Enumerable.from(this.FilterChildren(Core.Components.EditableComponent,function(n){return System.Array.contains(i,n.Name,System.String)}),Core.Components.EditableComponent).where(function(n){return!Bridge.is(n,Core.Components.Section)}),c=s.union(h).where(function(n){return!Bridge.is(n,Core.Components.Section)}).ToArray(Core.Components.EditableComponent);r=Bridge.getEnumerator(c);try{while(r.moveNext())f=r.Current,f.PrepareUpdateView(n,t),f.UpdateView(n,t,i)}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}}else{o=System.Linq.Enumerable.from(this.FilterChildren(Core.Components.EditableComponent),Core.Components.EditableComponent).where(function(n){return!Bridge.is(n,Core.Components.Section)}).ToArray(Core.Components.EditableComponent);u=Bridge.getEnumerator(o);try{while(u.moveNext())e=u.Current,e.PrepareUpdateView(n,t),e.UpdateView(n,t,i)}finally{Bridge.is(u,System.IDisposable)&&u.System$IDisposable$Dispose()}}},PrepareUpdateView:function(n,t){var i,r;n&&(this.EmptyRow=!1);this.ToggleShow((i=this.GuiInfo)!=null?i.ShowExp:null);this.ToggleDisabled((r=this.GuiInfo)!=null?r.DisabledExp:null);System.Nullable.hasValue(t)&&(this._setDirty=System.Nullable.getValue(t))},Dispose:function(){this.DisposeChildren();this.RemoveDOM();this.Children=null;this.DOMContentLoaded=null;this.OnToggle=null;this.Parent!=null&&this.Parent.Children!=null&&Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent,this.Parent.Children)&&this.Parent.Children.contains(this)&&this.Parent.Children.remove(this);Bridge.staticEquals(this.Disposed,null)?null:this.Disposed()},DisposeChildren:function(){var t,i,n;if(!Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,this.Children))for(n=(t=Core.Extensions.IEnumerableExtensions.Flattern(Core.Components.EditableComponent,this.Children,function(n){return n.Children}))!=null?System.Linq.Enumerable.from(t,Core.Components.EditableComponent).where(function(n){return n.Element!=null&&n.Parent!=null&&Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,n.Children)}).ToArray(Core.Components.EditableComponent):null;Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent,n);)n.forEach(function(n){n!=null&&(n.Dispose(),n.Parent!=null&&n.Parent.Children!=null&&n.Parent.Children.remove(n))}),n=(i=Core.Extensions.IEnumerableExtensions.Flattern(Core.Components.EditableComponent,this.Children,function(n){return n.Children}))!=null?System.Linq.Enumerable.from(i,Core.Components.EditableComponent).where(function(n){return n.Element!=null&&n.Parent!=null&&Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,n.Children)}).ToArray(Core.Components.EditableComponent):null},RemoveDOM:function(){this.Element!=null&&(this.Element.remove(),this.Element=null)},SetDefaultVal:function(){var i,r=(i=this.Entity)!=null?Bridge.unbox(i[Core.Components.EditableComponent.IdField]):null,t,n,u;if(this.Entity!=null&&(r==null||!System.Nullable.gt(r,0))&&!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.DefaultVal)){if(t=this.Entity[this.GuiInfo.FieldName],n=Bridge.Reflection.getMembers(Bridge.getType(this.Entity),16,284,this.GuiInfo.FieldName),n==null){this.TrySetDFValue();return}(u=Bridge.createInstance(n.rt),Bridge.equals(u,t)||Bridge.referenceEquals(n.rt,System.String)&&t==null)&&this.TrySetDFValue()}},TrySetDFValue:function(){try{var n=eval(this.GuiInfo.DefaultVal);this.Entity[this.GuiInfo.FieldName]=Bridge.is(n,Function)?Bridge.as(n,Function).call(this,this):n}catch(t){t=System.Exception.create(t)}},FilterChildren$1:function(n,t){return t===void 0&&(t=null),this.FilterChildren(Core.Components.EditableComponent,n,t)},FilterChildren:function(n){return new(Bridge.GeneratorEnumerable$1(n))(Bridge.fn.bind(this,function(n,t,i,r){var u=0,o,e,f,s,c,l,h=new(Bridge.GeneratorEnumerator$1(n))(Bridge.fn.bind(this,function(){try{for(;;)switch(u){case 0:if(t===void 0&&(t=null),i===void 0&&(i=null),r===void 0&&(r=null),Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,this.Children)){u=1;continue}u=2;continue;case 1:return!1;case 2:r==null&&(r=new(System.Collections.Generic.HashSet$1(n).ctor));o=Bridge.getEnumerator(this.Children);u=3;continue;case 3:if(o.moveNext()){e=o.Current;u=4;continue}u=12;continue;case 4:if(f=Bridge.as(e,n),f==null&&Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,e.Children)){u=3;continue}if(!Bridge.staticEquals(i,null)&&i(f)){u=3;continue}if(f!=null&&(Bridge.staticEquals(t,null)||t(f))&&!r.contains(f)){u=5;continue}u=7;continue;case 5:return r.add(f),h.current=f,u=6,!0;case 6:u=7;continue;case 7:s=Bridge.getEnumerator(e.FilterChildren(n,t,i,r),n);u=8;continue;case 8:if(s.moveNext()){c=s.Current;u=9;continue}u=11;continue;case 9:return h.current=c,u=10,!0;case 10:u=8;continue;case 11:u=3;continue;case 12:default:return!1}}catch(a){l=System.Exception.create(a);throw l;}}));return h},arguments))},ToggleShow:function(n){var t,i={},r;Core.Extensions.StringExt.HasAnyChar(n)&&Core.Extensions.Utils.IsFunction(n,i)&&(r=Bridge.as(i.v.call(null,this),System.Boolean,!0),this.Show=(t=r,t!=null?t:!1))},ToggleDisabled:function(n){var t,i={},r;Core.Extensions.StringExt.HasAnyChar(n)&&Core.Extensions.Utils.IsFunction(n,i)&&(r=Bridge.as(i.v.call(null,this),System.Boolean,!0),this.Disabled=(t=r,t!=null?t:!1))},SetDisableUI:function(n){this.Element!=null&&(n?this.Element.setAttribute("disabled","disabled"):(this.Element.removeAttribute("disabled"),this.Element.setAttribute("enable","true")))},UpdateDirty$1:function(n){n?this.SetDirtyInternal():(this.ClearDirtyInternal(),Core.Extensions.IEnumerableExtensions.ForEach(Core.Components.EditableComponent,this.FilterChildren(Core.Components.EditableComponent,function(n){return n._dirty}),function(n){n.ClearDirtyInternal()}))},UpdateDirty:function(n,t){(t===void 0&&(t=[]),Core.Extensions.IEnumerableExtensions.Nothing(System.String,t))||Core.Extensions.IEnumerableExtensions.ForEach(Core.Components.EditableComponent,this.FilterChildren(Core.Components.EditableComponent,function(n){return n.GuiInfo!=null&&System.Array.contains(t,n.Name,System.String)}),function(t){n?t.SetDirtyInternal():t.ClearDirtyInternal()})},SetDirtyInternal:function(){this._dirty=this._setDirty;this._setDirty||(this._setDirty=!0);this.Updating||this.SetOldTextAndVal()},ClearDirtyInternal:function(){this._dirty=!1;this.SetOldTextAndVal()},SetOldTextAndVal:function(){var n,t;this.OriginalText=this.GetValueText();this.OldValue=(n=Core.Extensions.Utils.GetComplexPropValue(this.Entity,(t=this.GuiInfo)!=null?t.FieldName:null))!=null?Bridge.toString(n):null},GetValueText:function(){var n,t;return this.Element==null?"":(n=Bridge.as(this.Element,HTMLInputElement))!=null?n.value:(t=Bridge.as(this.Element,HTMLTextAreaElement))!=null?t.value:""},ValidateAsync:function(){var t=0,n=new System.Threading.Tasks.TaskCompletionSource,i,r=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0],t);switch(t){case 0:this.ValidationResult.clear();n.setResult(!0);return;default:n.setResult(null);return}}}catch(r){i=System.Exception.create(r);n.setException(i)}},arguments);return r(),n.task},SetRequired:function(){var n,t;Core.Extensions.IEnumerableExtensions.HasElement(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule),this.ValidationRules)&&this.ValidationRules.containsKey(Core.Extensions.ValidationRule.Required)?(n=this.Element)!=null?n.setAttribute(Core.Extensions.ValidationRule.Required,System.Boolean.toString(!0)):null:(t=this.Element)!=null?t.removeAttribute(Core.Extensions.ValidationRule.Required):null},Validate:function(n,t,i,r,u){var s,h,f,e;if(!this.ValidationRules.containsKey(i)||(f=this.ValidationRules.getItem(i),f==null||f.Value1==null)||(e=Bridge.toString(f.Value1),Core.Extensions.StringExt.IsNullOrWhiteSpace(e)))return!0;var o=Bridge.unbox(f.Value1),c=o,l={},a={};if(Bridge.Deconstruct(Core.Extensions.BridgeExt.GetComplexProp(this.Entity,e).$clone(),l,a),l.v&&(c=(s=Core.Components.Extensions.ComponentExt.FirstOrDefault(this.Parent,function(n){return Bridge.referenceEquals(n.Name,e)}))!=null&&(h=s.GuiInfo)!=null?h.Label:null,o=Bridge.unbox(a.v)),u(r,o))this.ValidationResult.remove(i);else return System.Collections.Generic.CollectionExtensions.TryAdd(System.String,System.String,this.ValidationResult,i,System.String.format(f.Message,Core.Components.LangSelect.Get(this.GuiInfo.Label),c)),!0;return!1},ValidateRequired:function(n,t){if(this.Element==null||Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule),this.ValidationRules))return!0;if(!this.ValidationRules.containsKey(Core.Extensions.ValidationRule.Required))return this.Element.removeAttribute(Core.Extensions.ValidationRule.Required),!0;var i=this.ValidationRules.getItem(Core.Extensions.ValidationRule.Required);return this.Element.setAttribute(Core.Extensions.ValidationRule.Required,System.Boolean.toString(!0)),System.Collections.Generic.EqualityComparer$1(n).def.equals2(t,Bridge.getDefaultValue(n))||Core.Extensions.StringExt.IsNullOrWhiteSpace(Bridge.toString(t))?(this.Element.removeAttribute("readonly"),System.Collections.Generic.CollectionExtensions.TryAdd(System.String,System.String,this.ValidationResult,Core.Extensions.ValidationRule.Required,System.String.format(i.Message,Core.Components.LangSelect.Get(this.GuiInfo.Label),this.Entity)),!0):(this.ValidationResult.remove(Core.Extensions.ValidationRule.Required),!1)},AddRule:function(n){System.Collections.Generic.CollectionExtensions.TryAdd(System.String,Core.Extensions.ValidationRule,this.ValidationRules,n.Rule,n);Bridge.referenceEquals(n.Rule,Core.Extensions.ValidationRule.Required)&&this.Element.setAttribute(Core.Extensions.ValidationRule.Required,System.Boolean.toString(!0))},RemoveRule:function(n){this.ValidationRules.remove(n);this.ValidationRules.containsKey(Core.Extensions.ValidationRule.Required)||this.Element.removeAttribute(Core.Extensions.ValidationRule.Required)},CascadeField:function(){if(!Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.CascadeField)){var t=Bridge.as(Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem,this),Core.Components.EditableComponent),i=t||Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm,this),n=System.Linq.Enumerable.from(this.GuiInfo.CascadeField.split(","),System.String).where(function(n){return Core.Extensions.StringExt.HasAnyChar(n)}).select(function(n){return n.trim()});Core.Extensions.IEnumerableExtensions.Nothing(System.String,n)||n.forEach(function(n){Core.Extensions.IEnumerableExtensions.ForEach(Core.Components.EditableComponent,i.FilterChildren$1(function(t){return Bridge.referenceEquals(t.Name,n)}),function(n){var i,r,t;(t=Bridge.as(n,Core.Components.SearchEntry))!=null&&t!=null?(t.Value=null,(i=t.GuiInfo)!=null&&(r=i.LocalData)!=null?r.clear():null):n.UpdateView()})})}},BuildTextHistory:function(n,t){return(n===void 0&&(n=null),t===void 0&&(t=null),n==null&&(n=new System.Text.StringBuilder),t==null&&(t=new(System.Collections.Generic.HashSet$1(System.Object).ctor)),t.contains(this))?n:(t.add(this),this.BuildInternal(n,t),n)},BuildInternal:function(n,t){var i,r;if(this.BuildHistoryInternal(n),Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent,this.Children)&&!this.StopChildrenHistory){i=Bridge.getEnumerator(System.Linq.Enumerable.from(this.Children,Core.Components.EditableComponent).where(function(n){return Bridge.hasValue(n)}).select(function(n){return Bridge.cast(n,Core.Components.EditableComponent)}));try{while(i.moveNext())r=i.Current,r.BuildTextHistory(n,t)}finally{Bridge.is(i,System.IDisposable)&&i.System$IDisposable$Dispose()}}return},BuildHistoryInternal:function(n){var t,i;if(this.GuiInfo!=null)if(t=this.GetValueText(),Core.Extensions.StringExt.IsNullOrWhiteSpace(t)&&(t="N/A"),this.Updating){if(i=Core.Extensions.StringExt.IsNullOrWhiteSpace(this.OriginalText)?"N/A":this.OriginalText,Bridge.referenceEquals(i.trim(),t.trim()))return;n.append(Core.Components.LangSelect.Get(this.GuiInfo.Label)).append(": ").append(i).append(" -> ").append(t).append(Core.Extensions.Utils.NewLine)}else!this.Updating&&this.AlwaysLogHistory&&n.append(Core.Components.LangSelect.Get(this.GuiInfo.Label)).append(": ").append(t).append(Core.Extensions.Utils.NewLine)},GetInvalid:function(){return new(Bridge.GeneratorEnumerable$1(Core.Components.EditableComponent))(Bridge.fn.bind(this,function(){var n=0,t,u,i,f,e,r=new(Bridge.GeneratorEnumerator$1(Core.Components.EditableComponent))(Bridge.fn.bind(this,function(){try{for(;;)switch(n){case 0:if(this.AlwaysValid){n=1;continue}n=2;continue;case 1:return!1;case 2:if(!this.IsValid){n=3;continue}n=5;continue;case 3:return r.current=this,n=4,!0;case 4:n=5;continue;case 5:if(Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent,this.Children)){n=6;continue}n=14;continue;case 6:t=Bridge.getEnumerator(System.Linq.Enumerable.from(this.Children,Core.Components.EditableComponent).where(function(n){var t;return(t=n)!=null}).select(function(n){return Bridge.cast(n,Core.Components.EditableComponent)}));n=7;continue;case 7:if(t.moveNext()){u=t.Current;n=8;continue}n=13;continue;case 8:i=Bridge.getEnumerator(u.GetInvalid(),Core.Components.EditableComponent);n=9;continue;case 9:if(i.moveNext()){f=i.Current;n=10;continue}n=12;continue;case 10:return r.current=f,n=11,!0;case 11:n=9;continue;case 12:n=7;continue;case 13:n=14;continue;case 14:default:return!1}}catch(o){e=System.Exception.create(o);throw e;}}));return r}))},PopulateFields:function(n){var t;if(n===void 0&&(n=null),this.Entity!=null&&!Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.PopulateField)){var f=Bridge.as(Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem,this),Core.Components.EditableComponent),i=f||this.EditForm,r={},e=Core.Extensions.Utils.IsFunction(this.GuiInfo.PopulateField,r);if(e){try{r.v.call(null,this,Bridge.unbox(n))}catch(u){u=System.Exception.create(u)}i.UpdateViewAwait(!0);return}(t=System.Linq.Enumerable.from(this.GuiInfo.PopulateField.split(","),System.String).where(function(n){return Core.Extensions.StringExt.HasAnyChar(n)}).select(function(n){return n.trim()}),n==null||Core.Extensions.IEnumerableExtensions.Nothing(System.String,t))||t.forEach(Bridge.fn.bind(this,function(t){var r=Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField])<=0;Core.Extensions.IEnumerableExtensions.ForEach(Core.Components.EditableComponent,i.FilterChildren(Core.Components.EditableComponent,function(n){return Bridge.referenceEquals(n.Name,t)}),Bridge.fn.bind(this,function(i){var r=Core.Extensions.Utils.GetComplexPropValue(n,t),u=Core.Extensions.Utils.GetComplexPropValue(this.Entity,t),f=Core.Extensions.BridgeExt.GetComplexPropType(Bridge.getType(this.Entity),t);!Bridge.referenceEquals(r,u)&&f!=null&&Bridge.referenceEquals(Bridge.createInstance(f),u)&&(Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,t,r),i.UpdateView(!0,!1))}))}))}}}});Bridge.define("Core.Components.Direction",{$kind:"enum",statics:{fields:{top:0,right:1,bottom:2,left:3}}});Bridge.define("Core.Components.Extensions.ComponentExt",{statics:{fields:{Auto:null,StepPx:0},props:{FeatureMap:null},ctors:{init:function(){this.Auto="auto";this.StepPx=10;this.FeatureMap=new(System.Collections.Generic.Dictionary$2(System.String,Core.Models.Feature).ctor)}},methods:{DispatchEventToHandlerAsync:function(n,t,i,r){var f=0,e,u=new System.Threading.Tasks.TaskCompletionSource,o,s,h=Bridge.fn.bind(this,function(){try{for(;;){f=System.Array.min([0,1],f);switch(f){case 0:if(r===void 0&&(r=[]),Core.Extensions.StringExt.IsNullOrEmpty(t)){u.setResult(null);return}if(o=System.Enum.toString(System.String,i),e=Core.Components.Extensions.ComponentExt.InvokeEventAsync(n,t,o,r),f=1,e.isCompleted())continue;e["continue"](h);return;case 1:e.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(c){s=System.Exception.create(c);u.setException(s)}},arguments);return h(),u.task},InvokeEventAsync:function(n,t,i,r){var u=0,c,v,f=new System.Threading.Tasks.TaskCompletionSource,p,w,e,o,b,y,k,h,l,s,a=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1,2,3,4,6,7],u);switch(u){case 0:r===void 0&&(r=[]);try{w=Newtonsoft.Json.JsonConvert.DeserializeObject(t,System.Object)}catch(g){g=System.Exception.create(g);f.setResult(null);return}if(e=n.EditForm,e==null){f.setResult(null);return}if(o=(b=w[i])!=null?Bridge.toString(b):null,y={},k=Core.Extensions.Utils.IsFunction(o,y),k){y.v.call(e,e,n);f.setResult(null);return}if(Core.Extensions.StringExt.IsNullOrEmpty(o)){f.setResult(null);return}if(h=e[o],h==null){if(e=Core.Components.Extensions.ComponentExt.FindComponentEvent(e,o),e==null){f.setResult(null);return}h=e[o]}if(h==null){f.setResult(null);return}d=null;u=1;continue;case 1:var d=h.apply(e,r);if(d==null||d.isCompleted==null){f.setResult(null);return}u=2;continue;case 2:if(c=d,u=3,c.isCompleted())continue;c["continue"](a);return;case 3:c.getAwaitedResult();u=5;continue;case 4:System.Console.WriteLine(l.Message);System.Console.WriteLine(l.StackTrace);throw l;case 6:if(Bridge.hasValue(d)&&d.System$IDisposable$Dispose(),v>-1)u=v,v=null;else{if(s){f.setException(s);return}if(Bridge.isDefined(p)){f.setResult(p);return}}u=7;continue;case 7:f.setResult(null);return;default:f.setResult(null);return}}}catch(nt){if(s=System.Exception.create(nt),u>=2&&u<=3){l=s;u=4;a();return}if(u>=1&&u<=5){u=6;a();return}f.setException(s)}},arguments);return a(),f.task},InvokeMethodAsync:function(n,t,i){var r=0,f,o,u=new System.Threading.Tasks.TaskCompletionSource,c,s,e,h=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1,2,3,4],r);switch(r){case 0:if(i===void 0&&(i=[]),s=n[t],s==null){u.setResult(null);return}l=null;r=1;continue;case 1:var l=s.apply(n,i);if(l==null||l.isCompleted==null){u.setResult(null);return}if(f=l,r=2,f.isCompleted())continue;f["continue"](h);return;case 2:f.getAwaitedResult();r=3;continue;case 3:if(Bridge.hasValue(l)&&l.System$IDisposable$Dispose(),o>-1)r=o,o=null;else{if(e){u.setException(e);return}if(Bridge.isDefined(c)){u.setResult(c);return}}r=4;continue;case 4:u.setResult(null);return;default:u.setResult(null);return}}}catch(a){if(e=System.Exception.create(a),r>=1&&r<=2){r=3;h();return}u.setException(e)}},arguments);return h(),u.task},DispatchCustomEventAsync:function(n,t,i,r){var f=0,e,u=new System.Threading.Tasks.TaskCompletionSource,o,s,h=Bridge.fn.bind(this,function(){try{for(;;){f=System.Array.min([0,1],f);switch(f){case 0:if(r===void 0&&(r=[]),Core.Extensions.StringExt.IsNullOrEmpty(t)){u.setResult(null);return}if(o=System.Enum.toString(Core.Enums.CustomEventType,i),e=Core.Components.Extensions.ComponentExt.InvokeEventAsync(n,t,o,r),f=1,e.isCompleted())continue;e["continue"](h);return;case 1:e.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(c){s=System.Exception.create(c);u.setException(s)}},arguments);return h(),u.task},MapToFilterOperator:function(n,t){var i,u,e,f,o,r,s;return Core.Extensions.StringExt.IsNullOrWhiteSpace(t)||!n.HasFilter||Core.Extensions.StringExt.IsNullOrEmpty(n.FieldName)?"":(t=t.trim(),i=System.String.replaceAll(n.FieldName,".","/"),Bridge.referenceEquals(n.FieldName,"Id")||Bridge.referenceEquals(n.FieldName.substr(n.FieldName.length-2|0),"Id")&&Core.Extensions.StringExt.IsNullOrEmpty(n.FilterTemplate))?"":Bridge.referenceEquals(n.ComponentType,"Datepicker")?(u={},e=System.DateTime.tryParseExact(t,"dd/MM/yyyy",System.Globalization.CultureInfo.invariantCulture,u),e)?System.String.format("{0} eq cast({1},Edm.DateTimeOffset)",i,Core.Extensions.DateTimeExt.ToISOFormat(u.v)):"":Bridge.referenceEquals(n.ComponentType,"Checkbox")?(f={},o=System.Boolean.tryParse(t,f),!o)?"":System.String.format("{0} eq {1}",i,Bridge.box(f.v,System.Boolean,System.Boolean.toString)):Bridge.referenceEquals(n.ComponentType,"Number")?(r={},s=System.Int32.tryParse(t,r),!s)?"":Core.Extensions.StringExt.HasAnyChar(n.FilterTemplate)?System.String.format(n.FilterTemplate,[Bridge.box(r.v,System.Int32)]):System.String.format("{0} eq {1}",i,Bridge.box(r.v,System.Int32)):Core.Extensions.StringExt.HasAnyChar(n.FilterTemplate)?System.String.format(n.FilterTemplate,[t]):n.FilterEq?System.String.format("startswith({0}, '{1}')",i,t):System.String.format("contains({0}, '{1}')",i,t)},FilterById:function(n,t){var i,r,u,f,e;return Core.Extensions.StringExt.IsNullOrWhiteSpace(n)?"":(r="",u=n.replace(new RegExp("\\d+"),""),Core.Extensions.StringExt.IsNullOrWhiteSpace(u))?"":(f=System.Linq.Enumerable.from(t,Core.Models.GridPolicy).firstOrDefault(function(n){var t=Core.Extensions.StringExt.IsNullOrEmpty(n.FormatCell)?n.FormatRow:n.FormatCell,i;return Core.Extensions.StringExt.IsNullOrEmpty(t)?!1:(i=t.replace(new RegExp("\\{[\\s\\S]*?\\}"),""),Bridge.referenceEquals(i.toLowerCase(),u.toLowerCase()))},null),f!=null&&(e=System.Text.RegularExpressions.Regex.match(n,"\\d+").getValue(),Core.Extensions.StringExt.HasAnyChar(e)&&(r=System.String.format("{0} eq {1}",System.String.replaceAll(f.FieldName,".","/"),Bridge.box((i=Core.Extensions.Utils.TryParseInt(e),i!=null?i:0),System.Int32)))),r)},OpenTab:function(n,t,i){var r;return(r=Bridge.as(Core.Components.Forms.TabEditor.FindTab(t),Core.Components.Forms.TabEditor))!=null?(r.Focus(),r):(r=i(),Core.Components.Extensions.ComponentExt.OpenTabOrPopup(n,r),r)},OpenTab$1:function(n,t,i,r,u,f){var s=0,h,l,o=new System.Threading.Tasks.TaskCompletionSource,c,a,e,v,y=Bridge.fn.bind(this,function(){try{for(;;){s=System.Array.min([0,1],s);switch(s){case 0:if(u===void 0&&(u=!1),f===void 0&&(f=!1),!u&&(c=Bridge.as(Core.Components.Forms.TabEditor.FindTab(t),Core.Components.Forms.TabEditor))!=null){c.Focus();o.setResult(c);return}if(h=Core.Components.Extensions.ComponentExt.LoadFeatureByName(i,f),s=1,h.isCompleted())continue;h["continue"](y);return;case 1:l=h.getAwaitedResult();a=l;e=r();e.Popup=u;e.Name=i;e.Id=t;e.Feature=a;Core.Components.Extensions.ComponentExt.OpenTabOrPopup(n,e);o.setResult(e);return;default:o.setResult(null);return}}}catch(p){v=System.Exception.create(p);o.setException(v)}},arguments);return y(),o.task},OpenTabOrPopup:function(n,t){var r,u,i=(u=Bridge.as(n,Core.Components.Forms.EditForm))!=null?u:n.EditForm||Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm,n);t.Popup?n.AddChild(t):t.Render();t.ParentForm=i;t.OpenFrom=i!=null&&(r=i.FilterChildren(Core.Components.ListViewItem,function(n){return Bridge.referenceEquals(n.Entity,t.Entity)}))!=null?System.Linq.Enumerable.from(r,Core.Components.ListViewItem).firstOrDefault(null,null):null},OpenPopup:function(n,t,i,r,u){var f=0,e,s,o=new System.Threading.Tasks.TaskCompletionSource,h,c=Bridge.fn.bind(this,function(){try{for(;;){f=System.Array.min([0,1],f);switch(f){case 0:if(r===void 0&&(r=!1),u===void 0&&(u=!1),e=Core.Components.Extensions.ComponentExt.OpenTab$1(n,Bridge.toString(Bridge.getHashCode(n)),t,i,!0,r),f=1,e.isCompleted())continue;e["continue"](c);return;case 1:s=e.getAwaitedResult();o.setResult(s);return;default:o.setResult(null);return}}}catch(l){h=System.Exception.create(l);o.setException(h)}},arguments);return c(),o.task},InitFeatureByName:function(n,t){t===void 0&&(t=!0);var i=new System.Threading.Tasks.TaskCompletionSource,r=System.String.replaceAll(System.String.replaceAll(n,"-"," "),"#","");return System.Threading.Tasks.Task.run(function(){var e=0,o,h,n=new System.Threading.Tasks.TaskCompletionSource,u,s,f,c,l=Bridge.fn.bind(this,function(){try{for(;;){e=System.Array.min([0,1],e);switch(e){case 0:if(o=Core.Components.Extensions.ComponentExt.LoadFeatureByName(r,!0),e=1,o.isCompleted())continue;o["continue"](l);return;case 1:if(h=o.getAwaitedResult(),u=h,u==null){n.setResult(null);return}s=Bridge.Reflection.getType(u.ViewClass);f=s==null?new Core.Components.Forms.EditForm(""):Bridge.as(Bridge.createInstance(s),Core.Components.Forms.EditForm);f.Feature=u;f.Id=u.Name;Core.Components.Forms.EditForm.Portal=t;f.Render();i.setResult(f);n.setResult(null);return;default:n.setResult(null);return}}}catch(a){c=System.Exception.create(a);n.setException(c)}},arguments);return l(),n.task}),i.task},LoadFeatureByName:function(n,t){var r=0,u,f=new System.Threading.Tasks.TaskCompletionSource,h,e,o,s,i,c,l=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(t===void 0&&(t=!1),h=t?"/Public/":"",e=new Core.Clients.Client.$ctor1("Feature",Bridge.Reflection.getTypeNamespace(Core.Models.User)).FirstOrDefaultAsync(Core.Models.Feature,System.String.format("{0}?$filter=Active eq true and Name eq '{1}'",h,n),!1,!0),o=t?System.Threading.Tasks.Task.fromResult(new(System.Collections.Generic.List$1(Core.Models.FeaturePolicy).ctor),System.Collections.Generic.List$1(Core.Models.FeaturePolicy)):new Core.Clients.Client.$ctor1("FeaturePolicy",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.FeaturePolicy,System.String.format("?$filter=Active eq true and Feature/Name eq '{0}'",[n])),s=new Core.Clients.Client.$ctor1("ComponentGroup",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.ComponentGroup,(System.String.format("?$expand=Component($filter=Active eq true;$expand=Reference($select=Id,Name,Namespace))",null)||"")+(System.String.format("&$filter=Active eq true and Feature/Name eq '{0}'",[n])||""),!1,!0,!1,void 0),u=System.Threading.Tasks.Task.whenAll(e,o,s),r=1,u.isCompleted())continue;u["continue"](l);return;case 1:u.getAwaitedResult();i=e.getResult();i.FeaturePolicy=o.getResult();i.ComponentGroup=s.getResult();System.Collections.Generic.CollectionExtensions.TryAdd(System.String,Core.Models.Feature,Core.Components.Extensions.ComponentExt.FeatureMap,n,i);Core.Components.Extensions.ComponentExt.ExecuteFeatureScript(i);f.setResult(i);return;default:f.setResult(null);return}}}catch(a){c=System.Exception.create(a);f.setException(c)}},arguments);return l(),f.task},LoadFeatureComponent:function(n,t){var i=0,r,u=new System.Threading.Tasks.TaskCompletionSource,h,f,e,o,s=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(t===void 0&&(t=!1),h=t?"/Public/":"",f=t?System.Threading.Tasks.Task.fromResult(new(System.Collections.Generic.List$1(Core.Models.FeaturePolicy).ctor),System.Collections.Generic.List$1(Core.Models.FeaturePolicy)):new Core.Clients.Client.$ctor1("FeaturePolicy",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.FeaturePolicy,System.String.format("?$filter=Active eq true and FeatureId eq {0}",[Bridge.box(n.Id,System.Int32)])),e=new Core.Clients.Client.$ctor1("ComponentGroup",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.ComponentGroup,(System.String.format("?$expand=Component($filter=Active eq true;$expand=Reference($select=Id,Name,Namespace))",null)||"")+(System.String.format("&$filter=Active eq true and FeatureId eq {0}",[Bridge.box(n.Id,System.Int32)])||""),!1,!0,!1,void 0),r=System.Threading.Tasks.Task.whenAll(f,e),i=1,r.isCompleted())continue;r["continue"](s);return;case 1:r.getAwaitedResult();n.FeaturePolicy=f.getResult();n.ComponentGroup=e.getResult();System.Collections.Generic.CollectionExtensions.TryAdd(System.String,Core.Models.Feature,Core.Components.Extensions.ComponentExt.FeatureMap,n.Name,n);Core.Components.Extensions.ComponentExt.ExecuteFeatureScript(n);u.setResult(n);return;default:u.setResult(null);return}}}catch(c){o=System.Exception.create(c);u.setException(o)}},arguments);return s(),u.task},LoadFeatureByNameOrViewClass:function(n){var r=0,u,i=new System.Threading.Tasks.TaskCompletionSource,f,e,o,s,t,h,c=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(f=System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FeatureMap.Values,Core.Models.Feature).firstOrDefault(function(t){return Bridge.referenceEquals(t.ViewClass,n)},null),f!=null){i.setResult(f);return}if(e=new Core.Clients.Client.$ctor1("Feature",Bridge.Reflection.getTypeNamespace(Core.Models.User)).FirstOrDefaultAsync(Core.Models.Feature,System.String.format("?$expand=Entity($select=Name)&$filter=Active eq true and (Name eq '{0}' or ViewClass eq '{1}')",n,n)),o=new Core.Clients.Client.$ctor1("FeaturePolicy",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.FeaturePolicy,System.String.format("?$filter=Active eq true and (Feature/Name eq '{0}' or Feature/ViewClass eq '{1}')",n,n)),s=new Core.Clients.Client.$ctor1("ComponentGroup",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.ComponentGroup,(System.String.format("?$expand=Component($filter=Active eq true;$expand=Reference($select=Id,Name,Namespace))",null)||"")+(System.String.format("&$filter=Active eq true and (Feature/Name eq '{0}' or Feature/ViewClass eq '{1}')",n,n)||"")),u=System.Threading.Tasks.Task.whenAll(e,o,s),r=1,u.isCompleted())continue;u["continue"](c);return;case 1:u.getAwaitedResult();t=e.getResult();t.FeaturePolicy=o.getResult();t.ComponentGroup=s.getResult();System.Collections.Generic.CollectionExtensions.TryAdd(System.String,Core.Models.Feature,Core.Components.Extensions.ComponentExt.FeatureMap,t.Name,t);Core.Components.Extensions.ComponentExt.ExecuteFeatureScript(t);i.setResult(t);return;default:i.setResult(null);return}}}catch(l){h=System.Exception.create(l);i.setException(h)}},arguments);return c(),i.task},LoadEditorFeatureByNameByEntity:function(n){var r=0,u,i=new System.Threading.Tasks.TaskCompletionSource,f,e,o,s,t,h,c=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(f=System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FeatureMap.Values,Core.Models.Feature).firstOrDefault(function(t){return System.Nullable.eq(t.EntityId,n)&&System.String.indexOf(t.Name,"editor",0,null,5)>=0},null),f!=null){i.setResult(f);return}if(e=new Core.Clients.Client.$ctor1("Feature",Bridge.Reflection.getTypeNamespace(Core.Models.User)).FirstOrDefaultAsync(Core.Models.Feature,System.String.format("?$expand=Entity($select=Name)&$filter=Active eq true and EntityId eq {0}  ",[Bridge.box(n,System.Int32)])),o=new Core.Clients.Client.$ctor1("FeaturePolicy",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.FeaturePolicy,System.String.format("?$filter=Active eq true and Feature/EntityId eq {0}",[Bridge.box(n,System.Int32)])),s=new Core.Clients.Client.$ctor1("ComponentGroup",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.ComponentGroup,(System.String.format("?$expand=Component($filter=Active eq true;$expand=Reference($select=Id,Name,Namespace))",null)||"")+(System.String.format("&$filter=Active eq true and Feature/EntityId eq {0} ",[Bridge.box(n,System.Int32)])||"")),u=System.Threading.Tasks.Task.whenAll(e,o,s),r=1,u.isCompleted())continue;u["continue"](c);return;case 1:u.getAwaitedResult();t=e.getResult();t.FeaturePolicy=o.getResult();t.ComponentGroup=s.getResult();System.Collections.Generic.CollectionExtensions.TryAdd(System.String,Core.Models.Feature,Core.Components.Extensions.ComponentExt.FeatureMap,t.Name,t);Core.Components.Extensions.ComponentExt.ExecuteFeatureScript(t);i.setResult(t);return;default:i.setResult(null);return}}}catch(l){h=System.Exception.create(l);i.setException(h)}},arguments);return c(),i.task},LoadRecordPolicy:function(n,t){var r=0,u,f,i=new System.Threading.Tasks.TaskCompletionSource,e,o=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(Core.Extensions.IEnumerableExtensions.Nothing(System.Int32,n)||System.Linq.Enumerable.from(n,System.Int32).all(function(n){return n<=0})){i.setResult(new(System.Collections.Generic.List$1(Core.Models.FeaturePolicy).ctor));return}if(u=new Core.Clients.Client.$ctor1("FeaturePolicy",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.FeaturePolicy,System.String.format("?$filter=Active eq true and EntityId eq {0} and RecordId in ({1})",Bridge.box(t,System.Int32),Core.Extensions.IEnumerableExtensions.Combine(System.Int32,n,","))),r=1,u.isCompleted())continue;u["continue"](o);return;case 1:f=u.getAwaitedResult();i.setResult(f);return;default:i.setResult(null);return}}}catch(s){e=System.Exception.create(s);i.setException(e)}},arguments);return o(),i.task},ExecuteFeatureScript:function(n){var i,t;Core.Extensions.StringExt.IsNullOrWhiteSpace(n.ViewClass)||(i=Bridge.Reflection.getType(n.ViewClass),i==null)&&(t=Bridge.as(document.createElement(System.Enum.toString(System.String,"script")),HTMLScriptElement),t.textContent=n.Script,t.type="text/javascript",document.head.appendChild(t),t.remove())},AddChild:function(n,t,i,r){var u=0,f,l,e=new System.Threading.Tasks.TaskCompletionSource,s,o,h,c=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1],u);switch(u){case 0:if(f=Core.Components.Extensions.ComponentExt.LoadFeatureByName(i),u=1,f.isCompleted())continue;f["continue"](c);return;case 1:l=f.getAwaitedResult();s=Bridge.Reflection.getType(r);o=Bridge.as(Bridge.createInstance(s),Core.Components.EditableComponent);o.Id=t;n.AddChild(o);e.setResult(o);return;default:e.setResult(null);return}}}catch(a){h=System.Exception.create(a);e.setException(h)}},arguments);return c(),e.task},FirstOrDefault:function(n,t,i){var r,u,f,e,o;if(i===void 0&&(i=null),n==null||Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,n.Children))return null;r=Bridge.getEnumerator(n.Children);try{while(r.moveNext())if((f=r.Current,Bridge.staticEquals(i,null)||!i(f))&&t(f))return f}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}u=Bridge.getEnumerator(n.Children);try{while(u.moveNext())if(e=u.Current,Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent,e.Children)&&(o=Core.Components.Extensions.ComponentExt.FirstOrDefault(e,t,i),o!=null))return o}finally{Bridge.is(u,System.IDisposable)&&u.System$IDisposable$Dispose()}return null},FindActiveComponent:function(n,t,i){var u,f,e,r,o;if(i===void 0&&(i=null),f=new(System.Collections.Generic.HashSet$1(n).ctor),e=n,t==null||t.Children==null||Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,t.Children))return System.Linq.Enumerable.empty();u=Bridge.getEnumerator(t.Children);try{while(u.moveNext())(r=u.Current,Bridge.Reflection.isAssignableFrom(e,Bridge.getType(r))&&r.ParentElement!=null&&!Core.Extensions.HtmlElementExtension.Hidden(r.ParentElement)&&(Bridge.staticEquals(i,null)||i(Bridge.as(r,n)))&&f.add(Bridge.as(r,n)),Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,r.Children))||(o=Core.Components.Extensions.ComponentExt.FindActiveComponent(n,r),Core.Extensions.IEnumerableExtensions.ForEach(n,o,function(n){f.add(n)}))}finally{Bridge.is(u,System.IDisposable)&&u.System$IDisposable$Dispose()}return System.Linq.Enumerable.from(f,n).distinct()},FindComponentByName:function(n,t,i){return Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(t,function(t){return Bridge.referenceEquals(t.Name,i)&&Bridge.Reflection.isAssignableFrom(n,Bridge.getType(t))}),n)},SetValue:function(n,t,i){var r=Core.Components.Extensions.ComponentExt.FirstOrDefault(n,function(n){var i;return Bridge.referenceEquals((i=n.GuiInfo)!=null?i.FieldName:null,t)}),u,f,e,o,s;r!=null&&((u=Bridge.as(r,Core.Components.Textbox))!=null?u.Value=i:(f=Bridge.as(r,Core.Components.SearchEntry))!=null&&(i==null||Core.Extensions.ReflectionExt.IsInt32(Bridge.getType(i)))?f.Value=Bridge.cast(Bridge.unbox(i,System.Int32),System.Int32,!0):(e=Bridge.as(r,Core.Components.Number))!=null&&(i==null||Core.Extensions.ReflectionExt.IsNumber(Bridge.getType(i)))?e.Value=System.Convert.toDecimal(i):(o=Bridge.as(r,Core.Components.Checkbox))!=null&&(i==null||Core.Extensions.ReflectionExt.IsBool(Bridge.getType(i)))?o.Value=Bridge.as(i,System.Boolean,!0):(s=Bridge.as(r,Core.Components.Datepicker))!=null&&(i==null||Core.Extensions.ReflectionExt.IsDate(Bridge.getType(i)))&&(s.Value=Bridge.as(i,System.DateTime,!0)))},GetValue:function(n,t){var r,i,u,f,e,o,s,h;return(t===void 0&&(t=!1),(r=Bridge.as(n,Core.Components.Textbox))!=null)?r.Text:(i=Bridge.as(n,Core.Components.MultipleSearchEntry))!=null?t?Core.Extensions.IEnumerableExtensions.Combine(System.Int32,i.ListValues):i.ListValues:(u=Bridge.as(n,Core.Components.SearchEntry))!=null?Bridge.box(u.Value,System.Int32,System.Nullable.toString,System.Nullable.getHashCode):(f=Bridge.as(n,Core.Components.Number))!=null?f.Value:(e=Bridge.as(n,Core.Components.Checkbox))!=null?Bridge.box(e.Value,System.Boolean,System.Nullable.toStringFn(System.Boolean.toString),System.Nullable.getHashCode):(o=Bridge.as(n,Core.Components.Datepicker))!=null?Bridge.box(o.Value,System.DateTime,System.Nullable.toStringFn(System.DateTime.format),System.Nullable.getHashCode):(s=Bridge.as(n,Core.Components.ImageUploader))!=null?s.Path:(h=Bridge.as(n,Core.Components.CellText))!=null?h.Element.innerText:null},SetAutoWidth:function(n,t,i,r){r===void 0&&(r=8);n.ParentElement.style.minWidth=Core.Extensions.BridgeExt.TextWidth(t,i).add(System.Decimal(8))+"px";n.ParentElement.style.maxWidth=Core.Extensions.BridgeExt.TextWidth(t,i).add(System.Decimal(8))+"px"},SetDisabled:function(n,t){var i;n!=null&&(i=n)!=null&&(i.Disabled=t)},SetDisabled$2:function(n,t,i,r){t=Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(t,function(t){return Bridge.referenceEquals(t.Name,i)&&Bridge.is(t,n)}),n);var u;t!=null&&(u=t)!=null&&(u.Disabled=r)},SetDisabled$1:function(n,t,i){(i===void 0&&(i=[]),n!=null)&&Core.Extensions.IEnumerableExtensions.ForEach(Core.Components.EditableComponent,n.FilterChildren(Core.Components.EditableComponent,function(n){return System.Array.contains(i,n.Name,System.String)}),function(n){n.Disabled=t})},SetDataSourceSearchEntry:function(n,t,i){var r=Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(n,function(n){return Bridge.referenceEquals(n.Name,t)&&Bridge.is(n,Core.Components.SearchEntry)}),Core.Components.SearchEntry);r!=null&&(r.DataSourceFilter=i)},SetDataSourceGridView:function(n,t,i){var r=Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(n,function(n){return Bridge.referenceEquals(n.Name,t)&&Bridge.is(n,Core.Components.GridView)}),Core.Components.GridView);r!=null&&(r.DataSourceFilter=i)},FindClosest:function(n,t){var i=n;if(Bridge.Reflection.isAssignableFrom(i,Bridge.getType(t)))return Bridge.as(t,n);while(t.Parent!=null)if(t=t.Parent,Bridge.Reflection.isAssignableFrom(i,Bridge.getType(t)))return Bridge.as(t,n);return Bridge.as(t,n)},FindClosest$1:function(n,t,i){var r=n;if(Bridge.Reflection.isAssignableFrom(r,Bridge.getType(t))&&i(Bridge.as(t,n)))return Bridge.as(t,n);while(t.Parent!=null)if(t=t.Parent,Bridge.Reflection.isAssignableFrom(r,Bridge.getType(t))&&i(Bridge.as(t,n)))return Bridge.as(t,n);return Bridge.as(t,n)},FindComponentEvent:function(n,t){var i,r;if(n==null)return null;for(i=n.ParentForm;i!=null&&i[t]==null;)i=i.ParentForm;if(i==null&&(r=Bridge.as(n.Parent,Core.Components.Forms.EditForm))!=null)for(i=r;i!=null&&i[t]==null;)i=i.ParentForm;return i},SetShow:function(n,t,i){(i===void 0&&(i=[]),n!=null)&&Core.Extensions.IEnumerableExtensions.ForEach(Core.Components.EditableComponent,n.FilterChildren$1(function(n){return System.Array.contains(i,n.Name,System.String)}),function(n){n.Show=t})},AlterPosition:function(n,t){if(n!=null&&n.parentElement!=null&&t!=null){var i=t.getBoundingClientRect(),r=i.bottom;n.style.top=Core.Components.Extensions.ComponentExt.Auto;n.style.right=Core.Components.Extensions.ComponentExt.Auto;n.style.bottom=Core.Components.Extensions.ComponentExt.Auto;n.style.left=Core.Components.Extensions.ComponentExt.Auto;Core.Components.Renderer.Floating(Core.MVVM.Html.Take(n),r,i.left);Core.Extensions.HtmlElementExtension.OutOfViewport(n).Right&&(Core.Extensions.HtmlElementExtension.OutOfViewport(n).Bottom?i.top>n.clientHeight?Core.Components.Extensions.ComponentExt.TopCenter(n,t):i.left>n.clientWidth&&Core.Components.Extensions.ComponentExt.LeftMiddle(n,t):Core.Components.Extensions.ComponentExt.BottomCenter(n,t));Core.Extensions.HtmlElementExtension.OutOfViewport(n).Bottom&&(Core.Components.Extensions.ComponentExt.RightMiddle(n,t),Core.Extensions.HtmlElementExtension.OutOfViewport(n).Right&&Core.Components.Extensions.ComponentExt.LeftMiddle(n,t),Core.Extensions.HtmlElementExtension.OutOfViewport(n).Left&&Core.Components.Extensions.ComponentExt.TopCenter(n,t))}},BottomCenter:function(n,t){var i=t.getBoundingClientRect();n.style.right=Core.Components.Extensions.ComponentExt.Auto;n.style.top=System.Double.format(i.bottom)+(Core.Extensions.Utils.Pixel||"");Core.Components.Extensions.ComponentExt.MoveLeft(n)},GetComputedPx:function(n,t){var i,r,u=t(window.getComputedStyle(n));return i=u!=null&&(r=System.String.replaceAll(u,Core.Extensions.Utils.Pixel,""))!=null?Core.Extensions.Utils.TryParse(System.Decimal,r):System.Decimal.lift(null),i!=null?i:System.Decimal(0)},TopCenter:function(n,t){n.style.right=Core.Components.Extensions.ComponentExt.Auto;Core.Components.Extensions.ComponentExt.MoveLeft(n);Core.Components.Extensions.ComponentExt.MoveTop(n,t)},MoveLeft:function(n){while(Core.Extensions.HtmlElementExtension.OutOfViewport(n).Right){var t=Core.Components.Extensions.ComponentExt.GetComputedPx(n,function(n){return n.left}).sub(System.Decimal(Core.Components.Extensions.ComponentExt.StepPx));n.style.left=t+(Core.Extensions.Utils.Pixel||"")}},MoveTop:function(n,t){var i,r,u;for(t===void 0&&(t=null),r=t!=null&&(i=t.getBoundingClientRect())!=null?i.top:null;Core.Extensions.HtmlElementExtension.OutOfViewport(n).Bottom||t!=null&&System.Nullable.gt(n.getBoundingClientRect().bottom,r);)u=Core.Components.Extensions.ComponentExt.GetComputedPx(n,function(n){return n.top}).sub(System.Decimal(t==null?Core.Components.Extensions.ComponentExt.StepPx:1)),n.style.top=u+(Core.Extensions.Utils.Pixel||"")},LeftMiddle:function(n,t){var i=t.getBoundingClientRect();n.style.left=Core.Components.Extensions.ComponentExt.Auto;n.style.bottom=Core.Components.Extensions.ComponentExt.Auto;n.style.right=System.Double.format(i.left)+(Core.Extensions.Utils.Pixel||"");Core.Components.Extensions.ComponentExt.MoveTop(n)},RightMiddle:function(n,t){var i=t.getBoundingClientRect();n.style.right=Core.Components.Extensions.ComponentExt.Auto;n.style.bottom=Core.Components.Extensions.ComponentExt.Auto;n.style.left=System.Double.format(i.right)+(Core.Extensions.Utils.Pixel||"");Core.Components.Extensions.ComponentExt.MoveTop(n)},BuildGroupTree:function(n,t){if(Core.Extensions.IEnumerableExtensions.Nothing(System.String,t))return n;var i=System.Linq.Enumerable.from(t,System.String).first();return Core.Extensions.StringExt.IsNullOrWhiteSpace(i)?n:System.Linq.Enumerable.from(n,System.Object).groupBy(function(n){return n[i]}).select(function(n){var i,r;return i=new Core.Components.GroupRowData,i.Key=n.key(),i.Children=(r=System.Object,System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.BuildGroupTree(n.toList(System.Object),System.Linq.Enumerable.from(t,System.String).skip(1).ToArray(System.String)),r).toList(r)),i}).select(function(n){return Bridge.cast(n,System.Object)})},DownloadFile:function(n,t){var i=Bridge.as(document.createElement("a"),HTMLAnchorElement);i.style.display="none";i.href=window.URL.createObjectURL(t);i.download=n;document.body.appendChild(i);i.click();document.body.removeChild(i)},CheckValidity:function(n,t){var i,r;return(t===void 0&&(t=!0),i=n.GetInvalid(),Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,i))?!0:(t&&(Core.Extensions.IEnumerableExtensions.ForEach(Core.Components.EditableComponent,i,function(n){n.Disabled=!1}),System.Linq.Enumerable.from(i,Core.Components.EditableComponent).firstOrDefault(null,null).Focus(),r=Bridge.toArray(System.Linq.Enumerable.from(i,Core.Components.EditableComponent).selectMany(function(n){return n.ValidationResult.Values})).join("<br />"),Core.Extensions.Toast.Warning(r)),!1)}}}});Bridge.define("Core.Components.Extensions.ComponentFactory",{statics:{methods:{GetComponent:function(n,t){var r,i,f,u;if(n==null)throw new System.ArgumentNullException.$ctor1("ui");if(Core.Extensions.StringExt.IsNullOrEmpty(n.ComponentType))throw new System.InvalidOperationException.$ctor1(System.String.format("Component type of {0} is null.",[Bridge.box(n.Id,System.Int32)]));n.ComponentType=n.ComponentType.trim();switch(n.ComponentType){case"Link":i=new Core.Components.Link(n);break;case"Input":i=new Core.Components.Textbox(n);break;case"Timepicker":i=new Core.Components.Timepicker(n);break;case"Password":i=(r=new Core.Components.Textbox(n),r.Password=!0,r);break;case"Label":i=new Core.Components.CellText(n);break;case"Textarea":i=(r=new Core.Components.Textbox(n),r.MultipleLine=!0,r);break;case"Dropdown":i=n.Precision!=null&&System.Nullable.gte(n.Precision,2)?new Core.Components.MultipleSearchEntry(n):new Core.Components.SearchEntry(n);break;case"Image":i=new Core.Components.ImageUploader(n);break;case"GridView":i=Core.Extensions.StringExt.IsNullOrWhiteSpace(n.GroupBy)?new Core.Components.GridView(n):new Core.Components.GroupGridView(n);break;case"ListView":i=Core.Extensions.StringExt.IsNullOrWhiteSpace(n.GroupBy)?new Core.Components.ListView(n):new Core.Components.GroupListView(n);break;default:if(f=Core.Components.EditableComponent,u=Bridge.Reflection.getType((Bridge.Reflection.getTypeNamespace(f)||"")+"."+(n.ComponentType||"")),u==null)return Core.Components.Extensions.ComponentFactory.CompositedComponents(n,t);i=Bridge.as(Bridge.createInstance(u,[n]),Core.Components.EditableComponent)}return i.Id=(n.FieldName||"")+(Bridge.toString(n.Id)||""),i.Name=n.FieldName,i.ComponentType=n.ComponentType,i.EditForm=t,i},CompositedComponents:function(n,t){var u,i,r;return Core.Extensions.StringExt.IsNullOrWhiteSpace(n.FieldName)||Core.Extensions.StringExt.IsNullOrWhiteSpace(n.ComponentType)?null:(u=System.String.split(n.FieldName,[44].map(function(n){return String.fromCharCode(n)})),Core.Extensions.IEnumerableExtensions.Nothing(System.String,u))?null:(n.ComponentType=n.ComponentType.trim(),i=System.Linq.Enumerable.from(n.ComponentType,System.Char).where(function(n){return!(n>=97&&n<=122||n>=65&&n<=90)}).ToArray(System.Char),System.Linq.Enumerable.from(u,System.String).count()!==(i.length+1|0))?null:(r=new Core.Components.Section.$ctor1(Core.MVVM.ElementType.div),r.DOMContentLoaded=Bridge.fn.combine(r.DOMContentLoaded,function(){Core.Extensions.IEnumerableExtensions.ForEach$1(System.String,u,function(f,e){var s=e===0?0:System.String.indexOf(n.ComponentType,String.fromCharCode(i[System.Array.index(e-1|0,i)])),h=e===(u.length-1|0)?n.ComponentType.length-1|0:System.String.indexOf(n.ComponentType,String.fromCharCode(i[System.Array.index(e,i)]))-1|0,c=n.ComponentType.substr(s,h-s|0),o=new Core.Models.Component;Core.Extensions.ReflectionExt.CopyPropFrom$1(o,n);o.ComponentType=c;o.FieldName=f;r.AddChild(Core.Components.Extensions.ComponentFactory.GetComponent(o,t));i.length>e&&r.Element.appendChild(document.createTextNode(String.fromCharCode(i[System.Array.index(e,i)])))})}),r)}}}});Bridge.define("Core.Components.Forms.ContextMenuItem",{props:{Ele:null,Icon:null,Style:null,Text:null,Click:null,Disabled:!1,Parameter:null,MenuItems:null}});Bridge.define("Core.Components.GroupRowData",{props:{Key:null,Children:null}});Bridge.define("Core.Components.ListViewSearchVM",{props:{SearchTerm:null,FullTextSearch:null,ScanTerm:null,StartDate:null,DateTimeField:null,EndDate:null}});Bridge.define("Core.Components.PaginationOptions",{props:{Total:0,PageSize:0,Selected:0,PageIndex:0,PageNumber:0,CurrentPageCount:0,StartIndex:0,EndIndex:0,ClickHandler:null}});Bridge.define("Core.Components.Position",{$kind:"enum",statics:{fields:{absolute:0,fixed:1,inherit:2,initial:3,relative:4,"static":5,sticky:6,unset:7}}});Bridge.define("Core.Components.Renderer",{statics:{methods:{ColSpan:function(n,t){return n.Attr$1("colspan",Bridge.toString(t))},RowSpan:function(n,t){return n.Attr$1("rowspan",Bridge.toString(t))},Panel:function(n,t){return t===void 0&&(t=""),n.Div.Render(),System.String.isNullOrEmpty(t)||Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(n.Label,"header"),t).End.Render(),n},Button:function(n,t,i,r){return t===void 0&&(t=""),i===void 0&&(i="button info small"),r===void 0&&(r=""),n.Button.Render(),System.String.isNullOrEmpty(r)||Core.Components.Renderer.ClassName(n.Span,r).End.Text(" ").Render(),Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(n,i),t)},SmallInput:function(n,t,i){return t===void 0&&(t=""),i===void 0&&(i="left"),Core.Components.Renderer.ClassName(n.Input,"input-small "+(i||"")).Attr$1("data-role","input").Value(t)},PlaceHolder:function(n,t){return Core.Extensions.StringExt.IsNullOrWhiteSpace(t)?n:(Core.Components.Renderer.MarkLangProp(n.GetContext(),t,"placeholder"),n.Attr$1("placeholder",Core.Components.LangSelect.Get(t)))},MarkLangProp:function(n,t,i,r){r===void 0&&(r=[]);n[(Core.Components.LangSelect.LangKey||"")+(i||"")]=t;Core.Extensions.IEnumerableExtensions.HasElement(System.Object,r)&&(n[(Core.Components.LangSelect.LangParam||"")+(i||"")]=r);var u=n[Core.Components.LangSelect.LangProp],f=u==null?i:System.String.concat(u,",",i);n[Core.Components.LangSelect.LangProp]=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(f.split(","),System.String).distinct())},Title:function(n,t){return Core.Extensions.StringExt.IsNullOrWhiteSpace(t)?n:(Core.Components.Renderer.MarkLangProp(n.GetContext(),t,"title"),n.Attr$1("title",Core.Components.LangSelect.Get(t)))},SmallCheckbox:function(n,t){t===void 0&&(t=!1);Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(n.Label,"checkbox input-small transition-on style2").Input.Attr$1("type","checkbox").Type$1("checkbox").End.Span,"check myCheckbox");var i=Bridge.as(Core.MVVM.Html.Context.previousElementSibling,HTMLInputElement);return i.checked=t,n},Disabled:function(n,t){return t===!1?(Core.MVVM.Html.Context.removeAttribute("disabled"),n):n.Attr$1("disabled","disabled")},Margin:function(n,t,i,r){return r===void 0&&(r="px"),n.Style$1(System.String.format("margin-{0} : {1}{2}",Bridge.box(t,Core.Components.Direction,System.Enum.toStringFn(Core.Components.Direction)),Bridge.box(i,System.Double,System.Double.format,System.Double.getHashCode),r))},MarginRem:function(n,t,i){return n.Style$1(System.String.format("margin-{0} : {1}rem",Bridge.box(t,Core.Components.Direction,System.Enum.toStringFn(Core.Components.Direction)),Bridge.box(i,System.Double,System.Double.format,System.Double.getHashCode)))},Padding:function(n,t,i,r){return r===void 0&&(r="px"),n.Style$1(System.String.format("padding-{0} : {1}{2}",Bridge.box(t,Core.Components.Direction,System.Enum.toStringFn(Core.Components.Direction)),Bridge.box(i,System.Double,System.Double.format,System.Double.getHashCode),r))},Width:function(n,t){return n.Style$1(System.String.format("width: {0}",[t]))},Sticky:function(n,t,i){t===void 0&&(t=null);i===void 0&&(i=null);var r=Core.MVVM.Html.Context;return r==null?n:(r.previousElementSibling!=null&&Bridge.referenceEquals(Bridge.getType(r),Bridge.getType(r.previousElementSibling))&&(Bridge.referenceEquals(i,Bridge.toString(0))?i=r.offsetLeft+(Core.Extensions.Utils.Pixel||""):Bridge.referenceEquals(t,Bridge.toString(0))&&(t=r.offsetTop+(Core.Extensions.Utils.Pixel||""))),t!=null&&n.Style$1(System.String.format("top: {0};",[t])),i!=null&&n.Style$1(System.String.format("left: {0};",[i])),n.Style$1("position: sticky; z-index: 1;"))},TextAlign:function(n,t){return t===void 0&&(t=8),n.Style$1("text-align: "+(System.Nullable.toString(t,System.Enum.toStringFn(Core.Enums.TextAlign))||""))},Position:function(n,t,i){return n.Style$1(System.String.format("{0}: {1}px",Core.Extensions.ReflectionExt.GetEnumDescription(Bridge.box(t,Core.Components.Direction,System.Enum.toStringFn(Core.Components.Direction))),Bridge.box(i,System.Double,System.Double.format,System.Double.getHashCode)))},Position$1:function(n,t){return n.Style$1(System.String.format("position: {0}",[Core.Extensions.ReflectionExt.GetEnumDescription(Bridge.box(t,Core.Components.Position,System.Enum.toStringFn(Core.Components.Position)))]))},Icon:function(n,t){var i=System.String.contains(t,"mif")||System.String.contains(t,"fa")||System.String.contains(t,"fa-");return Core.Components.Renderer.ClassName(n.Span,"icon"),i?Core.Components.Renderer.ClassName(n,t).Render():Core.Components.Renderer.ClassName(n.Style$1(System.String.format("background-image: url({0});",[(Core.Clients.Client.Origin||"")+(t||"")])),"iconBg").Render(),n},Escape:function(n,t){var i=Core.MVVM.Html.Context;return i.tabIndex=-1,i.focus(),i.addEventListener("keydown",function(n){if(System.Nullable.eq(Bridge.unbox(n.keyCode),27)){var r=i.parentElement;n.stopPropagation();t(n);r.focus()}}),n},IconForSpan:function(n,t){var i,r;return Core.Extensions.StringExt.IsNullOrWhiteSpace(t)?n:(t=t.trim(),i=Core.MVVM.Html.Context,Core.Components.Renderer.ClassName(n,"icon"),r=System.String.contains(t,"mif")||System.String.contains(t,"fa")||System.String.contains(t,"fa-"),r?Core.Extensions.HtmlElementExtension.AddClass(i,t):(Core.Extensions.HtmlElementExtension.AddClass(i,"iconBg"),i.style["background-image"]="url("+(t||"")+")"),n)},Floating:function(n,t,i){return Core.Components.Renderer.Position(Core.Components.Renderer.Position(Core.Components.Renderer.Position$1(n,Core.Components.Position.fixed),Core.Components.Direction.top,t),Core.Components.Direction.left,i)},TabIndex:function(n,t){return n.Attr$1("tabindex",Bridge.toString(t))},ClassName:function(n,t){var i,r,u;return System.String.isNullOrEmpty(t)?n:(i=Core.MVVM.Html.Context,r=Core.Components.LangSelect.Get(t),Core.Components.Renderer.MarkLangProp(i,t,"ClassName"),u=(i.className||"")+" "+(r||""),i.className=u.trim(),n)},IHtml:function(n,t,i){if(i===void 0&&(i=[]),System.String.isNullOrEmpty(t))return n;var r=Core.MVVM.Html.Context,u=Core.Components.LangSelect.Get(t);return Core.Components.Renderer.MarkLangProp(r,t,"InnerHTML",i),r.innerHTML=u,n},IText:function(n,t,i){if(i===void 0&&(i=[]),System.String.isNullOrEmpty(t))return n;var r=Core.Components.LangSelect.Get(t),u=document.createTextNode(Core.Extensions.IEnumerableExtensions.HasElement(System.Object,i)?System.String.format.apply(System.String,[r].concat(i)):r);return Core.Components.Renderer.MarkLangProp(u,t,"TextContent",i),n.GetContext().appendChild(u),n}}}});Bridge.define("Core.Components.SortedField",{props:{Field:null,Com:null,Desc:!1}});Bridge.define("Core.Components.Spinner",{statics:{fields:{_instance:null,_span:null,_backdrop:null,_hiddenAwaiter:0},props:{Instance:{get:function(){if(Core.Components.Spinner._instance!=null)return Core.Components.Spinner._instance;Core.Components.Spinner._instance=new Core.Components.Spinner;var n=document.getElementById("spinner");return n==null?(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div,"backdrop").Style$1("background: transparent !important;").End.Span,"spinner"),Core.Components.Spinner._span=Core.MVVM.Html.Context):Core.Components.Spinner._span=n,Core.Components.Spinner._backdrop=Core.Components.Spinner._span.previousElementSibling,Core.Components.Spinner._span.style.display=System.Enum.toString(System.String,"none"),Core.Components.Spinner._backdrop.style.display=System.Enum.toString(System.String,"none"),Core.Components.Spinner._instance}}},methods:{AppendTo:function(n,t,i,r){(t===void 0&&(t=!0),i===void 0&&(i=!0),r===void 0&&(r=7e3),Core.Components.Spinner._span!=null)&&(Bridge.referenceEquals(Core.Components.Spinner._span.parentElement,n)&&Bridge.referenceEquals(Bridge.toString(Core.Components.Spinner._span.style.display),"")||(n!=null?n.appendChild(Core.Components.Spinner._span):document.body.appendChild(Core.Components.Spinner._span),Core.Components.Spinner._span.style.display="",t&&(Core.Components.Spinner._backdrop.style.display=""),i)&&(window.clearTimeout(Core.Components.Spinner._hiddenAwaiter),Core.Components.Spinner._hiddenAwaiter=window.setTimeout(Core.Components.Spinner.Hide,r)))},Hide:function(){Core.Components.Spinner._span!=null&&(Core.Components.Spinner._span.style.display=System.Enum.toString(System.String,"none"),Core.Components.Spinner._backdrop.style.display=System.Enum.toString(System.String,"none"))}}},ctors:{ctor:function(){this.$initialize()}}});Bridge.define("Core.Enums.ActiveStateEnum",{$kind:"enum",statics:{fields:{All:1,Yes:2,No:3}}});Bridge.define("Core.Enums.AdvSearchOperation",{$kind:"enum",statics:{fields:{Equal:1,NotEqual:2,GreaterThan:3,GreaterThanOrEqual:4,LessThan:5,LessThanOrEqual:6,Contains:7,NotContains:8,StartWith:9,NotStartWith:10,EndWidth:11,NotEndWidth:12,In:13,NotIn:14,EqualDatime:15,GreaterThanDatime:21,LessThanDatime:22,NotEqualDatime:16,EqualNull:17,NotEqualNull:18,Like:19,NotLike:20,GreaterEqualDatime:23,LessEqualDatime:24}}});Bridge.define("Core.Enums.ApprovalStatusEnum",{$kind:"enum",statics:{fields:{Approved:1,New:2,Rejected:3,Approving:4}}});Bridge.define("Core.Enums.AuthVerEnum",{$kind:"enum",statics:{fields:{None:100,Simple:0,OAuth1:1,OAuth2:2,ApiKey:3}}});Bridge.define("Core.Enums.ComponentTypeTypeEnum",{$kind:"enum",statics:{fields:{Dropdown:1,SearchEntry:1,MultipleSearchEntry:1,Datepicker:2,Number:3,Textbox:4,Checkbox:5}}});Bridge.define("Core.Enums.CurrencyEnum",{$kind:"enum",statics:{fields:{USD:71,VND:72}}});Bridge.define("Core.Enums.CustomEventType",{$kind:"enum",statics:{fields:{BeforeCopied:0,AfterWebsocket:1,AfterCopied:2,BeforeDeleted:3,AfterDeleted:4,Deactivated:5,BeforePasted:6,AfterPasted:7,BeforeCreated:8,AfterCreated:9,BeforeEmptyRowCreated:10,AfterEmptyRowCreated:11,BeforeCreatedList:12,AfterCreatedList:13,Selected:14,RowFocusIn:15,RowFocusOut:16,RowMouseEnter:17,RowMouseLeave:18,OpenRef:19,BeforePatchUpdate:20,ValidatePatchUpdate:21,BeforePatchCreate:22,AfterPatchUpdate:23}}});Bridge.define("Core.Enums.DebtStatusEnum",{$kind:"enum",statics:{fields:{Approved:1,New:2,Rejected:3,Approving:4,Paying:5,Paid:6,Overdue:7,BadDebt:8}}});Bridge.define("Core.Enums.EntityActionEnum",{$kind:"enum",statics:{fields:{Create:1,Update:2,Deactivate:3,Delete:4}}});Bridge.define("Core.Enums.HttpMethod",{$kind:"enum",statics:{fields:{GET:0,POST:1,PUT:2,PATCH:3,DELETE:4}}});Bridge.define("Core.Enums.HttpStatusCode",{$kind:"enum",statics:{fields:{Continue:100,SwitchingProtocols:101,OK:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultipleChoices:300,Ambiguous:300,MovedPermanently:301,Moved:301,Found:302,Redirect:302,SeeOther:303,RedirectMethod:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,RedirectKeepVerb:307,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,RequestEntityTooLarge:413,RequestUriTooLong:414,UnsupportedMediaType:415,RequestedRangeNotSatisfiable:416,ExpectationFailed:417,UpgradeRequired:426,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505}}});Bridge.define("Core.Enums.KeyCodeEnum",{$kind:"enum",statics:{fields:{Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,PauseBreak:19,CapsLock:20,Escape:27,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Insert:45,Delete:46,Zero:48,One:49,Two:50,Three:51,Four:52,Five:53,Six:54,Seven:55,Eight:56,Nine:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftWindowKey:91,RightWindowKey:92,SelectKey:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,Multiply:106,Add:107,Subtract:109,DecimalPoint:110,Divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NumLock:144,ScrollLock:145,SemiColon:186,EqualSign:187,Comma:188,Dash:189,Period:190,ForwardSlash:191,GraveAccent:192,OpenBracket:219,BackSlash:220,CloseBraket:221,SingleQuote:222}}});Bridge.define("Core.Enums.LogicOperation",{$kind:"enum",statics:{fields:{And:0,Or:1}}});Bridge.define("Core.Enums.OrderbyOption",{$kind:"enum",statics:{fields:{ASC:1,DESC:2}}});Bridge.define("Core.Enums.PaybackPaymentTypeEnum",{$kind:"enum",statics:{fields:{TruckMaintenance:1,AdvPayment:2}}});Bridge.define("Core.Enums.ReceiptStatusEnum",{$kind:"enum",statics:{fields:{Approved:1,New:2,Rejected:3,Approving:4,Finished:5}}});Bridge.define("Core.Enums.ResponseApproveEnum",{$kind:"enum",statics:{fields:{NonRole:414,NonUser:415,Approved:416,Success:200,Fail:300}}});Bridge.define("Core.Enums.RoleEnum",{$kind:"enum",statics:{fields:{Assistant:1,Driver:2,Truck_Coordinator:20,Vendor_Coordination_Truck:25,Vendor_Coordination_Cont:28,Cont_Coordinator:19,Sale_Staff:4,Accountant:5,Director:6,Customer:7,System:8,Sale_Leader:9,Transportation_Manager:29,Accountant_Leader:11,Driver_Cont:23,Driver_Truck:24,Container_Leader:10,Truck_Leader:18,Super_Admin:40}}});Bridge.define("Core.Enums.RoleSelection",{$kind:"enum",statics:{fields:{TopFirst:1,BottomFirst:2}}});Bridge.define("Core.Enums.SystemType",{$kind:"enum",statics:{fields:{EDO:1,TMS:2,CD:3,FastDemo:4,FastNew:5,FastExsiting:6}}});Bridge.define("Core.Enums.TaskStateEnum",{$kind:"enum",statics:{fields:{UnreadStatus:339,Read:340,Processing:341,Proceeded:342}}});Bridge.define("Core.Enums.TextAlign",{$kind:"enum",statics:{fields:{center:0,end:1,inherit:2,initial:3,justify:4,left:5,right:6,start:7,unset:8}}});Bridge.define("Core.Enums.TypeEntityAction",{$kind:"enum",statics:{fields:{UpdateEntity:1,UpdateCountBadge:2,Message:3,MessageCountBadge:4}}});Bridge.define("Core.Enums.VendorTypeEnum",{$kind:"enum",statics:{fields:{Customer:1,Vendor:2,Mixed:3}}});Bridge.define("Core.Extensions.AdvOptionExt",{statics:{fields:{OperationToOdata:null},ctors:{init:function(){this.OperationToOdata=function(n){return n.add(Core.Enums.AdvSearchOperation.Equal,"{0} eq {1}"),n.add(Core.Enums.AdvSearchOperation.NotEqual,"{0} ne {1}"),n.add(Core.Enums.AdvSearchOperation.GreaterThan,"{0} gt {1}"),n.add(Core.Enums.AdvSearchOperation.GreaterThanOrEqual,"{0} ge {1}"),n.add(Core.Enums.AdvSearchOperation.LessThan,"{0} lt {1}"),n.add(Core.Enums.AdvSearchOperation.LessThanOrEqual,"{0} le {1}"),n.add(Core.Enums.AdvSearchOperation.Contains,"contains({0}, {1})"),n.add(Core.Enums.AdvSearchOperation.NotContains,"contains({0}, {1}) eq false"),n.add(Core.Enums.AdvSearchOperation.StartWith,"startswith({0}, {1})"),n.add(Core.Enums.AdvSearchOperation.NotStartWith,"indexof({0}, {1}) ne 0"),n.add(Core.Enums.AdvSearchOperation.EndWidth,"endswith({0}, {1})"),n.add(Core.Enums.AdvSearchOperation.NotEndWidth,"endswith({0}, {1}) eq false"),n.add(Core.Enums.AdvSearchOperation.In,"{0} in ({1})"),n.add(Core.Enums.AdvSearchOperation.Like,"contains({0},{1})"),n.add(Core.Enums.AdvSearchOperation.NotLike,"contains({0},{1}) eq false"),n.add(Core.Enums.AdvSearchOperation.NotIn,"{0} in ({1}) eq false"),n.add(Core.Enums.AdvSearchOperation.EqualDatime,"cast({0},Edm.DateTimeOffset) eq {1}"),n.add(Core.Enums.AdvSearchOperation.NotEqualDatime,"cast({0},Edm.DateTimeOffset) ne {1}"),n.add(Core.Enums.AdvSearchOperation.EqualNull,"{0} eq null"),n.add(Core.Enums.AdvSearchOperation.NotEqualNull,"{0} ne null"),n.add(Core.Enums.AdvSearchOperation.GreaterThanDatime,"cast({0},Edm.DateTimeOffset) gt {1}"),n.add(Core.Enums.AdvSearchOperation.GreaterEqualDatime,"cast({0},Edm.DateTimeOffset) ge {1}"),n.add(Core.Enums.AdvSearchOperation.LessThanDatime,"cast({0},Edm.DateTimeOffset) lt {1}"),n.add(Core.Enums.AdvSearchOperation.LessEqualDatime,"cast({0},Edm.DateTimeOffset) le {1}"),n}(new(System.Collections.Generic.Dictionary$2(Core.Enums.AdvSearchOperation,System.String).ctor))}}}});Bridge.define("Core.Extensions.BridgeExt",{statics:{methods:{SetComplexPropValue:function(n,t,i){var r,u,f,e;if(n!=null&&!System.String.isNullOrWhiteSpace(t)&&(r=System.String.split(t,[46].map(function(n){return String.fromCharCode(n)})),r.length!==0)){if(r.length===1){Core.Extensions.BridgeExt.SetPropValue(n,t,i);return}for(u=n,f=0;f<(r.length-1|0);f=f+1|0){if(u==null)return;e=r[System.Array.index(f,r)];u=Core.Extensions.BridgeExt.GetPropValue(u,e)}u!=null&&Core.Extensions.BridgeExt.SetPropValue(u,Bridge.toString(r[System.Array.index(r.length-1|0,r)]),i)}},CustomFormat:function(n,t){if(t===void 0&&(t="dd/MM/yyyy"),Bridge.equals(n,null))return"";var i=System.DateTime.parse(n);return System.DateTime.format(i,t)},CastProp:function(n,t){if(t==null)return Bridge.getDefaultValue(n);var i;try{return Bridge.cast(Bridge.unbox(t,n),n)}catch(r){return r=System.Exception.create(r),i=Bridge.cast(Bridge.unbox(Bridge.createInstance(n),n),n),Core.Extensions.ReflectionExt.CopyPropFrom$1(i,t),i}},GetPropValue:function(n,t){return n==null?null:n[t]},SetPropValue:function(n,t,i){var u=Bridge.getType(n),r=Bridge.Reflection.getMembers(u,16,284,t);r==null||u==null||!r.s?r==null&&n!=null&&(n[t]=i):Bridge.Reflection.midel(r.s,n).apply(null,(null||[]).concat(i))},GetComplexProp:function(n,t){var u,i,f,r,e;if(n==null||System.String.isNullOrWhiteSpace(t)||(i=System.String.split(t,[46].map(function(n){return String.fromCharCode(n)})),i.length===0))return new(System.ValueTuple$2(System.Boolean,System.Object).$ctor1)(!1,null);if(i.length===1)return new(System.ValueTuple$2(System.Boolean,System.Object).$ctor1)(n.hasOwnProperty(t)||Bridge.Reflection.getMembers(Bridge.getType(n),16,284,t)!=null,n[t]);f=System.Linq.Enumerable.from(i,System.String).lastOrDefault(null,null);i=System.Linq.Enumerable.from(i,System.String).take(i.length-1|0).ToArray(System.String);r=n;u=Bridge.getEnumerator(i);try{while(u.moveNext()){if(e=u.Current,r==null)return new(System.ValueTuple$2(System.Boolean,System.Object).$ctor1)(!1,null);r=r[e]}}finally{Bridge.is(u,System.IDisposable)&&u.System$IDisposable$Dispose()}return r==null?new(System.ValueTuple$2(System.Boolean,System.Object).$ctor1)(!1,null):new(System.ValueTuple$2(System.Boolean,System.Object).$ctor1)(r.hasOwnProperty(f)||Bridge.Reflection.getMembers(Bridge.getType(r),16,284,f)!=null,r[f])},GetComplexPropType:function(n,t,i){var f,u,r,e,o;if((i===void 0&&(i=null),n==null||System.String.isNullOrWhiteSpace(t))||(i=(f=i,f!=null?f:Bridge.createInstance(n)),r=System.String.split(t,[46].map(function(n){return String.fromCharCode(n)})),r.length===0))return null;if(r.length===1)return Core.Extensions.BridgeExt.GetObjType(t,i);e=System.Linq.Enumerable.from(r,System.String).lastOrDefault(null,null);r=System.Linq.Enumerable.from(r,System.String).take(r.length-1|0).ToArray(System.String);u=Bridge.getEnumerator(r);try{while(u.moveNext()){if(o=u.Current,i==null)return null;i=i[o]}}finally{Bridge.is(u,System.IDisposable)&&u.System$IDisposable$Dispose()}return i==null?null:Core.Extensions.BridgeExt.GetObjType(e,i)},GetObjType:function(n,t){var r,i;return t.hasOwnProperty(n)?(i=Core.Extensions.BridgeExt.GetPropValue(t,n),i!=null?Bridge.getType(i):null):Bridge.Reflection.getMembers(Bridge.getType(t),16,284,n)!=null?(r=Bridge.Reflection.getMembers(Bridge.getType(t),16,284,n))!=null?r.rt:null:null},DistinctBy:function(n,t,i,r){return i==null?null:System.Linq.Enumerable.from(i,n).groupBy(r).select(function(n){return n.first()})},TextWidth:function(n,t){var r,i=document.createElement("div"),u;return i.textContent=n,i.style.cssText=System.String.format("position: absolute; float: left; white-space: nowrap; visibility: hidden, font: {0}",[t]),document.body.appendChild(i),u=window.getComputedStyle(i,"width"),r=Core.Extensions.Utils.TryParse(System.Decimal,System.String.replaceAll(u.width,"px","")),r!=null?r:System.Decimal(0)},Swap:function(n,t,i,r){var u=t.getItem(i);t.setItem(i,t.getItem(r));t.setItem(r,u)}}}});Bridge.define("Core.Extensions.DateTimeExt",{statics:{methods:{ToISOFormat:function(n){return System.DateTime.format(n,"yyyy-MM-ddTHH:mm:ssZ")},DateConverter:function(n){var t=new Date(n),i=("0"+(t.getMonth()+1)).slice(-2),r=("0"+t.getDate()).slice(-2),u=("0"+t.getHours()).slice(-2),f=("0"+t.getMinutes()).slice(-2),e=("0"+t.getSeconds()).slice(-2),o=t.getFullYear();return o+"/"+i+"/"+r+" "+u+":"+f+":"+e},ToOdataFormat:function(n){return System.String.concat("cast(",Core.Extensions.DateTimeExt.ToISOFormat(n),",Edm.DateTimeOffset)")},ToDayHourMinute:function(n){var t=Bridge.Int.clip32(n.getTotalDays()),i=Bridge.Int.clip32(n.getTotalMinutes())-Bridge.Int.mul(Bridge.Int.mul(t,24),60)|0,r=i%60,u=Bridge.Int.div(i,60)|0;return new(System.ValueTuple$3(System.Int32,System.Int32,System.Int32).$ctor1)(t,u,r)},DateString:function(n,t){var u,f;t===void 0&&(t=null);Bridge.equals(t,null)&&(t=System.DateTime.getNow());var i=new System.TimeSpan(System.DateTime.getTicks(System.Nullable.getValue(t)).sub(System.DateTime.getTicks(n))),r=Math.abs(i.getTotalSeconds());return r<60?i.getSeconds()===1?"one second ago":i.getSeconds()+" seconds ago":r<120?"a minute ago":r<2700?i.getMinutes()+" minutes ago":r<5400?"an hour ago":r<86400?i.getHours()+" hours ago":r<172800?"yesterday":r<2592e3?i.getDays()+" days ago":r<31104e3?(u=System.Convert.toInt32(Bridge.box(Math.floor(i.getDays()/30),System.Double,System.Double.format,System.Double.getHashCode)),u<=1?"one month ago":u+" months ago"):(f=System.Convert.toInt32(Bridge.box(Math.floor(i.getDays()/365),System.Double,System.Double.format,System.Double.getHashCode)),f<=1?"one year ago":f+" years ago")},ToUserFormat:function(n){return System.DateTime.format(n,"yyyy/MM/dd HH:mm")},TryParseDateTime:function(n){if(Core.Extensions.StringExt.IsNullOrWhiteSpace(n))return null;var t={},i=System.DateTime.tryParse(n,null,t);return i?t.v:null},GetBusinessDays:function(n){var t=System.DateTime.getDate(System.DateTime.getNow()),i,r;return System.DateTime.getDayOfWeek(n)===System.DayOfWeek.Saturday?n=System.DateTime.addDays(n,2):System.DateTime.getDayOfWeek(n)===System.DayOfWeek.Sunday&&(n=System.DateTime.addDays(n,1)),System.DateTime.getDayOfWeek(t)===System.DayOfWeek.Saturday?t=System.DateTime.addDays(t,-1):System.DateTime.getDayOfWeek(t)===System.DayOfWeek.Sunday&&(t=System.DateTime.addDays(t,-2)),i=Bridge.Int.clip32(System.DateTime.subdd(t,System.DateTime.getDate(n)).getTotalDays()),r=Bridge.Int.mul(Bridge.Int.div(i,7)|0,5)+i%7|0,System.DateTime.getDayOfWeek(t)<System.DateTime.getDayOfWeek(n)?r-2|0:r},GetDays:function(n,t){return Bridge.Int.clip32(System.DateTime.subdd(t,n).getTotalDays())},TotalMonth:function(n,t){return((Bridge.Int.mul(System.DateTime.getYear(t),12)+System.DateTime.getMonth(t)|0)-Bridge.Int.mul(System.DateTime.getYear(n),12)|0)-System.DateTime.getMonth(n)|0},FirstDayOfMonth:function(n){return System.DateTime.create(System.DateTime.getYear(n),System.DateTime.getMonth(n),1)},LastDayOfMonth:function(n){return System.DateTime.addDays(System.DateTime.addMonths(Core.Extensions.DateTimeExt.FirstDayOfMonth(n),1),-1)},FirstDayOfNextMonth:function(n){return System.DateTime.addMonths(Core.Extensions.DateTimeExt.FirstDayOfMonth(n),1)}}}});Bridge.define("Core.Extensions.EventExt",{statics:{methods:{Top:function(n){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(n.clientY,System.Single),System.Single))},Left:function(n){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(n.clientX,System.Single),System.Single))},KeyCode:function(n){var t;return t=Bridge.cast(Bridge.unbox(n.keyCode,System.Int32),System.Int32,!0),t!=null?t:-1},KeyCodeEnum:function(n){if(n.keyCode==null)return null;var t={v:new Core.Enums.KeyCodeEnum},i=System.Enum.tryParse(Core.Enums.KeyCodeEnum,Bridge.toString(n.keyCode).toUpperCase(),t);return i?Bridge.cast(t.v,System.Int32,!0):null},ShiftKey:function(n){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(n.shiftKey,System.Boolean),System.Boolean))},CtrlOrMetaKey:function(n){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(n.ctrlKey,System.Boolean),System.Boolean))||System.Nullable.getValue(Bridge.cast(Bridge.unbox(n.metaKey,System.Boolean),System.Boolean))},AltKey:function(n){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(n.altKey,System.Boolean),System.Boolean))}}}});Bridge.define("Core.Extensions.ExcelExt",{statics:{methods:{ExportTableToExcel:function(n,t,i,r){var o,u;i===void 0&&(i=null);r===void 0&&(r=!1);r&&(Core.Extensions.IEnumerableExtensions.ForEach(Node,i.querySelectorAll("td"),function(n){n.style="border:1px solid;white-space: nowrap;font-family: 'times new roman', times, serif;"}),Core.Extensions.IEnumerableExtensions.ForEach(Node,i.querySelectorAll("th"),function(n){n.style="border:1px solid;white-space: nowrap;font-family: 'times new roman', times, serif;"}));var f="application/vnd.ms-excel",s=function(n){return window.btoa(unescape(encodeURIComponent(n)))},h=function(n,t){return n.replace(/{(\w+)}/g,function(n,i){return t[i]})},c=i||document.getElementById(n),e=h('<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}<\/x:Name><x:WorksheetOptions><x:DisplayGridlines/><\/x:WorksheetOptions><\/x:ExcelWorksheet><\/x:ExcelWorksheets><\/x:ExcelWorkbook><\/xml><![endif]--><\/head><body><table>{table}<\/table><\/body><\/html>',{worksheet:t,table:c.innerHTML});t=t+".xls";navigator.msSaveOrOpenBlob?(o=new Blob(["﻿",e],{type:f}),navigator.msSaveOrOpenBlob(o,t)):(u=document.createElement("a"),document.body.appendChild(u),u.href="data:"+f+";base64,"+s(e),u.download=t,u.click());r&&(Core.Extensions.IEnumerableExtensions.ForEach(Node,i.querySelectorAll("td"),function(n){n.style=""}),Core.Extensions.IEnumerableExtensions.ForEach(Node,i.querySelectorAll("th"),function(n){n.style=""}))}}}});Bridge.define("Core.Extensions.HtmlElementExtension",{statics:{methods:{HasClass:function(n,t){if(n==null)throw new System.InvalidOperationException.$ctor1(System.String.format("{0} is null",["node"]));if(!Core.Extensions.StringExt.HasAnyChar(t))return!1;var i=Bridge.as(n,Element);return System.String.contains(i.className,t)},ReplaceClass:function(n,t,i){if(!System.String.isNullOrEmpty(t)){var r=Bridge.as(n,Element);r.className=System.String.replaceAll(r.className,t,i).trim().replace(new RegExp("\\s+")," ")}},AddClass:function(n,t){if(n!=null&&!System.String.isNullOrEmpty(t)&&!Core.Extensions.HtmlElementExtension.HasClass(n,t)){var i=Bridge.as(n,Element);i.className=((i.className||"")+" "+(t||"")).trim()}},Closest:function(n,t){if(n==null||System.String.isNullOrEmpty(t))return null;var i=n.closest;return Bridge.cast(i.call(n,t),HTMLElement)},Prepend:function(n,t){if(n!=null){var i=n.prepend;i.call(n,t)}},GetFullHeight:function(n){if(n==null)return 0;var t=window.getComputedStyle(n),i=Core.Extensions.StringExt.HasAnyChar(t.marginTop)?System.String.replaceAll(t.marginTop,Core.Extensions.Utils.Pixel,""):Bridge.toString(0),r=Core.Extensions.StringExt.HasAnyChar(t.marginTop)?System.String.replaceAll(t.marginBottom,Core.Extensions.Utils.Pixel,""):Bridge.toString(0),u=System.Convert.toDouble(i)+System.Convert.toDouble(r);return n.scrollHeight+u},RemoveClass:function(n,t){n==null||System.String.isNullOrEmpty(t)||Core.Extensions.HtmlElementExtension.ReplaceClass(n,t,"")},ToggleClass:function(n,t){if(n!=null&&!System.String.isNullOrEmpty(t)){var i=System.String.contains(Bridge.as(n,HTMLElement).className,t);i?Core.Extensions.HtmlElementExtension.RemoveClass(n,t):Core.Extensions.HtmlElementExtension.AddClass(n,t)}},Show:function(n){n.style.display=""},GetComputedStyle:function(n){return window.getComputedStyle(n)},Hide:function(n){n.style.display="none"},Hidden:function(n){if(n==null)return!0;var t=n.getBoundingClientRect(),i=window.getComputedStyle(n);return Bridge.referenceEquals(Bridge.toString(i.display),"none")||t.bottom===0&&t.top===0&&t.width===0&&t.height===0},OutOfViewport:function(n){var i,r=n.getBoundingClientRect(),t=(i=new Core.Extensions.OutOfViewPort,i.Top=r.top<0,i.Left=r.left<0,i.Bottom=r.bottom>window.innerHeight,i.Right=r.right>window.innerWidth,i);return t.Any=t.Top||t.Left||t.Bottom||t.Right,t.All=t.Top&&t.Left&&t.Bottom&&t.Right,t},FilterElement:function(){return new(Bridge.GeneratorEnumerable$1(HTMLElement))(Bridge.fn.bind(this,function(n,t,i){var r=0,u,o,f,s,h,e=new(Bridge.GeneratorEnumerator$1(HTMLElement))(Bridge.fn.bind(this,function(){try{for(;;)switch(r){case 0:if(i===void 0&&(i=null),n==null){r=1;continue}r=2;continue;case 1:return!1;case 2:if(i==null&&(i=new(System.Collections.Generic.HashSet$1(HTMLElement).ctor)),i.contains(n)){r=3;continue}r=4;continue;case 3:return!1;case 4:if(i.add(n),Bridge.staticEquals(t,null)||t(n)){r=5;continue}r=7;continue;case 5:return e.current=n,r=6,!0;case 6:r=7;continue;case 7:u=Bridge.getEnumerator(n.children,"getEnumerator");r=8;continue;case 8:if(u.moveNext()){o=u.Current;r=9;continue}r=14;continue;case 9:f=Bridge.getEnumerator(Core.Extensions.HtmlElementExtension.FilterElement(o,t,i),HTMLElement);r=10;continue;case 10:if(f.moveNext()){s=f.Current;r=11;continue}r=13;continue;case 11:return e.current=s,r=12,!0;case 12:r=10;continue;case 13:r=8;continue;case 14:default:return!1}}catch(c){h=System.Exception.create(c);throw h;}}));return e},arguments))}}}});Bridge.define("Core.Extensions.IEnumerableExtensions",{statics:{methods:{GetSourceByType:function(n,t){return n==null?null:System.Linq.Enumerable.from(n,System.Collections.Generic.IEnumerable$1(System.Object)).firstOrDefault(function(n){var i;return Bridge.referenceEquals((i=Bridge.Reflection.getGenericArguments(Bridge.getType(n)))[System.Array.index(0,i)],t)},null)},ForEach:function(n,t,i){var r,u;if(Core.Extensions.IEnumerableExtensions.Nothing(n,t)||Bridge.staticEquals(i,null))return t;r=Bridge.getEnumerator(t,n);try{while(r.moveNext())u=r.Current,i(u)}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}return t},ForEach$1:function(n,t,i){var r,u,f;if(Core.Extensions.IEnumerableExtensions.Nothing(n,t)||Bridge.staticEquals(i,null))return t;u=0;r=Bridge.getEnumerator(t,n);try{while(r.moveNext())f=r.Current,i(f,u),u=u+1|0}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}return t},ForEachAsync:function(n,t,i){var u=0,f,r=new System.Threading.Tasks.TaskCompletionSource,e,o,s=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1],u);switch(u){case 0:if(Core.Extensions.IEnumerableExtensions.Nothing(n,t)||Bridge.staticEquals(i,null)){r.setResult(t);return}if(e=System.Linq.Enumerable.from(t,n).select(i),f=System.Threading.Tasks.Task.whenAll(e),u=1,f.isCompleted())continue;f["continue"](s);return;case 1:f.getAwaitedResult();r.setResult(t);return;default:r.setResult(null);return}}}catch(h){o=System.Exception.create(h);r.setException(o)}},arguments);return s(),r.task},Nothing:function(n,t){return t==null||!System.Linq.Enumerable.from(t,n).any()},HasElementAndAll:function(n,t,i){return t==null||!System.Linq.Enumerable.from(t,n).any()?!1:System.Linq.Enumerable.from(t,n).all(i)},FindItemAndIndex:function(n,t,i){var r,u=-1,f;r=Bridge.getEnumerator(t,n);try{while(r.moveNext())if(f=r.Current,u=u+1|0,i(f))return new(System.ValueTuple$2(n,System.Int32).$ctor1)(f,u)}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}return new(System.ValueTuple$2(n,System.Int32).$ctor1)(Bridge.getDefaultValue(n),-1)},IndexOf:function(n,t,i){var r,u=-1,f;r=Bridge.getEnumerator(t,n);try{while(r.moveNext())if(f=r.Current,u=u+1|0,i(f))return u}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}return-1},HasElement:function(n,t){return t!=null&&System.Linq.Enumerable.from(t,n).any()},Except:function(n,t,i){return t==null?t:System.Linq.Enumerable.from(t,n).where(function(n){return!Bridge.equals(n,i)})},ToEntity:function(n){var i,t,r=n,c=System.Enum.getValues(r),f=new(System.Collections.Generic.List$1(System.Object).ctor);i=Bridge.getEnumerator(c);try{while(i.moveNext()){var e=i.Current,o=System.Enum.parse(r,Bridge.toString(e)),u=Bridge.toString(o),s=Bridge.Reflection.getMembers(r,4,284,u),h=Bridge.as(s!=null?System.Attribute.getCustomAttributes(s,System.ComponentModel.DescriptionAttribute,!1):null,System.Array.type(System.ComponentModel.DescriptionAttribute));Core.Extensions.IEnumerableExtensions.HasElement(System.ComponentModel.DescriptionAttribute,h)&&(u=System.Linq.Enumerable.from(h,System.ComponentModel.DescriptionAttribute).first().Description);f.add((t=new Core.Models.Entity,t.Id=System.Nullable.getValue(Bridge.cast(Bridge.unbox(e,System.Int32),System.Int32)),t.Name=Bridge.toString(o),t.Description=u,t.Active=!0,t))}}finally{Bridge.is(i,System.IDisposable)&&i.System$IDisposable$Dispose()}return f},Combine:function(n,t,i){return(i===void 0&&(i=","),i==null||t==null)?"":Bridge.toArray(t).join(i)},Combine$1:function(n,t,i,r,u){return(u===void 0&&(u=","),Bridge.staticEquals(r,null)||i==null)?"":Core.Extensions.IEnumerableExtensions.Combine(t,System.Linq.Enumerable.from(i,n).select(r),u)},All:function(n){return System.Linq.Enumerable.from(n,System.Boolean).all(function(n){return n})},Any:function(n){return System.Linq.Enumerable.from(n,System.Boolean).any(function(n){return n})},WhereNotNull$1:function(n,t){return t==null?null:System.Linq.Enumerable.from(t,System.Nullable$1(n)).where(function(n){return System.Nullable.hasValue(n)}).select(function(n){return System.Nullable.getValue(n)})},WhereNotNull:function(n,t){return t==null?null:System.Linq.Enumerable.from(t,n).where(function(n){return n!=null})},Flattern:function(n,t,i){if(Core.Extensions.IEnumerableExtensions.Nothing(n,t))return t;var r=System.Linq.Enumerable.from(t,n).select(function(n){return i(n)}).where(function(n){return n!=null}).selectMany(function(n){return n});return Core.Extensions.IEnumerableExtensions.Nothing(n,r)?t:System.Linq.Enumerable.from(t,n).concat(Core.Extensions.IEnumerableExtensions.Flattern(n,r,i))}}}});Bridge.define("Core.Extensions.NumberExtensions",{statics:{methods:{RoundUp:function(n,t){return System.Decimal.toDecimalPlaces(n,t,4)},ToRealDecimal:function(n){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(System.Convert.changeType(n,System.Decimal),System.Decimal),System.Decimal))},NumberToText:function(n){var u=System.Array.init(["không","một","hai","ba","bốn","năm","sáu","bảy","tám","chín"],System.String),c=System.Array.init(["","nghìn","triệu","tỷ"],System.String),l=!1,o=Bridge.Int.format(n,"#"),h=System.Convert.toDouble(o),f,r,s,i,t,e;if(h<0&&(h=-h,o=System.Double.format(h),l=!0),i=o.length,t=" ",i===0)t=(u[System.Array.index(0,u)]||"")+(t||"");else for(e=0;i>0;){if(r=s=-1,f=System.Convert.toInt32(o.substr(i-1|0,1)),i=i-1|0,i>0&&(r=System.Convert.toInt32(o.substr(i-1|0,1)),i=i-1|0,i>0&&(s=System.Convert.toInt32(o.substr(i-1|0,1)),i=i-1|0)),(f>0||r>0||s>0||e===3)&&(t=(c[System.Array.index(e,c)]||"")+(t||"")),e=e+1|0,e>3&&(e=1),f===1&&r>1?t="một "+(t||""):f===5&&r>0?t="lăm "+(t||""):f>0&&(t=(u[System.Array.index(f,u)]||"")+" "+(t||"")),r<0)break;else r===0&&f>0&&(t="lẻ "+(t||"")),r===1&&(t="mười "+(t||"")),r>1&&(t=(u[System.Array.index(r,u)]||"")+" mươi "+(t||""));if(s<0)break;else(s>0||r>0||f>0)&&(t=(u[System.Array.index(s,u)]||"")+" trăm "+(t||""));t=" "+(t||"")}return t=t.trim(),l&&(t="Âm "+(t||"")),(t||"")+" đồng chẵn"}}}});Bridge.define("Core.Extensions.OdataExt",{statics:{fields:{TopKeyword:null,FilterKeyword:null,OrderByKeyword:null,QuestionMark:null},ctors:{init:function(){this.TopKeyword="$top=";this.FilterKeyword="$filter=";this.OrderByKeyword="$orderby=";this.QuestionMark="?"}},methods:{RemoveClause:function(n,t,i){var r,e,u,f,o;return(t===void 0&&(t="$filter="),i===void 0&&(i=!1),Core.Extensions.StringExt.IsNullOrWhiteSpace(n))?"":(r=n,e=n.lastIndexOf(t),e>=0&&(u=n.substr(e),f=System.String.indexOf(u,"&"),f=f===-1?u.length:f,r=(n.substr(0,e)||"")+(u.substr(f,u.length)||"")),o=r.charCodeAt(r.length-1|0),(r.length>0&&o===38||o===63)&&(r=r.substr(0,r.length-1|0)),i?System.String.replaceAll(r,t,""):r)},GetClausePart:function(n,t){var u,r,i;return(t===void 0&&(t="$filter="),u=n.lastIndexOf(t),u>=0)?(r=n.substr(u),i=System.String.indexOf(r,"&"),i=i===-1?r.length:i,r.substr(t.length,i-t.length|0).trim()):""},GetOrderByPart:function(n){var r=n.lastIndexOf(Core.Extensions.OdataExt.OrderByKeyword),i,t;return r>=0?(i=n.substr(r),t=System.String.indexOf(i,"&"),t=t===-1?i.length:t,i.substr(Core.Extensions.OdataExt.OrderByKeyword.length,t-Core.Extensions.OdataExt.OrderByKeyword.length|0).trim()):""},AppendClause:function(n,t,i){var r,u;return(i===void 0&&(i="$filter="),Core.Extensions.StringExt.IsNullOrWhiteSpace(t))?n:(Core.Extensions.StringExt.IsNullOrWhiteSpace(n)&&(n=""),System.String.contains(n,Core.Extensions.OdataExt.QuestionMark)||(n=(n||"")+(Core.Extensions.OdataExt.QuestionMark||"")),r=Core.Extensions.OdataExt.GetClausePart(n,i),Core.Extensions.StringExt.IsNullOrEmpty(r)?(n=(n||"")+((System.String.indexOf(n,"?")<0?i:"&"+(i||""))||""),u=n.length):u=System.String.indexOf(n,r)+r.length|0,(n.substr(0,u)||"")+(t||"")+(n.substr(u)||""))},ApplyClause:function(n,t,i){i===void 0&&(i="$filter=");var r=Core.Extensions.OdataExt.RemoveClause(n,i,!0);return Core.Extensions.OdataExt.AppendClause(r,t,i)}}}});Bridge.define("Core.Extensions.OutOfViewPort",{props:{Top:!1,Left:!1,Right:!1,Bottom:!1,Any:!1,All:!1}});Bridge.define("Core.Extensions.ReflectionExt",{statics:{fields:{IdField:null,StatusIdField:null,FreightStateId:null},ctors:{init:function(){this.IdField="Id";this.StatusIdField="StatusId";this.FreightStateId="FreightStateId"}},methods:{IsSimple:function(n){var t;if(n==null)throw new System.ArgumentNullException.$ctor1(System.String.format("{0} is null",["type"]));return Bridge.Reflection.isGenericType(n)&&Bridge.referenceEquals(Bridge.Reflection.getGenericTypeDefinition(n),System.Nullable$1)?Core.Extensions.ReflectionExt.IsSimple((t=Bridge.Reflection.getGenericArguments(n))[System.Array.index(0,t)]):Bridge.Reflection.isPrimitive(n)||Bridge.Reflection.isEnum(n)||Bridge.equals(n,System.String)||Bridge.equals(n,System.DateTime)||Bridge.equals(n,System.DateTimeOffset)||Bridge.equals(n,System.TimeSpan)||Bridge.equals(n,System.Decimal)},IsDate:function(n){return Bridge.equals(n,System.DateTime)||Bridge.equals(n,System.Nullable$1(System.DateTime))||Bridge.equals(n,System.DateTimeOffset)||Bridge.equals(n,System.Nullable$1(System.DateTimeOffset))},IsNumber:function(n){var t;return Bridge.Reflection.isGenericType(n)&&Bridge.referenceEquals(Bridge.Reflection.getGenericTypeDefinition(n),System.Nullable$1)?Core.Extensions.ReflectionExt.IsNumber((t=Bridge.Reflection.getGenericArguments(n))[System.Array.index(0,t)]):Bridge.referenceEquals(n,System.SByte)||Bridge.referenceEquals(n,System.Byte)||Bridge.referenceEquals(n,System.Int16)||Bridge.referenceEquals(n,System.UInt16)||Bridge.referenceEquals(n,System.Int32)||Bridge.referenceEquals(n,System.UInt32)||Bridge.referenceEquals(n,System.Int32)||Bridge.referenceEquals(n,System.UInt64)||Bridge.referenceEquals(n,System.Single)||Bridge.referenceEquals(n,System.Double)||Bridge.referenceEquals(n,System.Decimal)},IsDecimal:function(n){return Bridge.referenceEquals(n,System.Decimal)||Bridge.referenceEquals(n,System.Nullable$1(System.Decimal))},IsInt32:function(n){return Bridge.referenceEquals(n,System.Int32)||Bridge.referenceEquals(n,System.Nullable$1(System.Int32))},IsBool:function(n){return Bridge.referenceEquals(n,System.Boolean)||Bridge.referenceEquals(n,System.Nullable$1(System.Boolean))},CopyPropFrom$1:function(n,t,i){i===void 0&&(i=[]);Core.Extensions.ReflectionExt.CopyPropFromInternal(n,t,new(System.Collections.Generic.HashSet$1(System.Int32).ctor),0,0,i)},CopyPropFrom:function(n,t,i,r){i===void 0&&(i=0);r===void 0&&(r=[]);Core.Extensions.ReflectionExt.CopyPropFromInternal(n,t,new(System.Collections.Generic.HashSet$1(System.Int32).ctor),0,i,r)},CopyPropFromAct:function(n,t){var u,f,e,i,r;if(t!=null&&n!=null&&(f=Bridge.getType(n),!Core.Extensions.ReflectionExt.IsSimple(f))){e=System.Linq.Enumerable.from(Bridge.Reflection.getMembers(f,16,28),System.Reflection.PropertyInfo).where(function(n){return!!n.g&&!!n.s});u=Bridge.getEnumerator(e);try{while(u.moveNext())i=u.Current,r=Core.Extensions.BridgeExt.GetPropValue(t,i.n),Core.Extensions.ReflectionExt.IsDecimal(i.rt)&&r!=null&&!Core.Extensions.ReflectionExt.IsDecimal(Bridge.getType(r))?Core.Extensions.BridgeExt.SetPropValue(n,i.n,System.Convert.toDecimal(r)):Core.Extensions.ReflectionExt.IsDate(i.rt)&&r!=null&&!Core.Extensions.ReflectionExt.IsDate(Bridge.getType(r))?Core.Extensions.BridgeExt.SetPropValue(n,i.n,Bridge.box(System.Convert.toDateTime(r),System.DateTime,System.DateTime.format)):Core.Extensions.ReflectionExt.IsSimple(i.rt)?Core.Extensions.BridgeExt.SetPropValue(n,i.n,r):Core.Extensions.ReflectionExt.CopyPropFromAct(Core.Extensions.BridgeExt.GetPropValue(n,i.n),r)}finally{Bridge.is(u,System.IDisposable)&&u.System$IDisposable$Dispose()}}},CopyPropFromInternal:function(n,t,i,r,u,f){var s,v,h,c,l,a,y,e,o;if((r===void 0&&(r=0),u===void 0&&(u=0),f===void 0&&(f=[]),v=u===0||r<u,t!=null&&n!=null&&v)&&(h=Bridge.getType(n),!Core.Extensions.ReflectionExt.IsSimple(h))&&(c=Bridge.getHashCode(t),!i.contains(c))){if(i.add(c),Bridge.Reflection.isAssignableFrom(System.Collections.IEnumerable,h)){for(l=Bridge.getEnumerator(Bridge.as(t,System.Collections.IEnumerable)),a=Bridge.getEnumerator(Bridge.as(n,System.Collections.IEnumerable));l.System$Collections$IEnumerator$moveNext()&&a.System$Collections$IEnumerator$moveNext();)Core.Extensions.ReflectionExt.CopyPropFromInternal(a.System$Collections$IEnumerator$Current,l.System$Collections$IEnumerator$Current,i,r+1|0,u,f);return}y=System.Linq.Enumerable.from(Bridge.Reflection.getMembers(h,16,28),System.Reflection.PropertyInfo).where(function(n){return!!n.g&&!!n.s});s=Bridge.getEnumerator(y);try{while(s.moveNext())(e=s.Current,f!=null&&System.Array.contains(f,e.n,System.String))||(o=Core.Extensions.BridgeExt.GetPropValue(t,e.n),Core.Extensions.ReflectionExt.IsDecimal(e.rt)&&o!=null&&!Core.Extensions.ReflectionExt.IsDecimal(Bridge.getType(o))?Core.Extensions.BridgeExt.SetPropValue(n,e.n,System.Convert.toDecimal(o)):Core.Extensions.ReflectionExt.IsDate(e.rt)&&o!=null&&!Core.Extensions.ReflectionExt.IsDate(Bridge.getType(o))?Core.Extensions.BridgeExt.SetPropValue(n,e.n,Bridge.box(System.Convert.toDateTime(o),System.DateTime,System.DateTime.format)):Core.Extensions.ReflectionExt.IsSimple(e.rt)?Core.Extensions.BridgeExt.SetPropValue(n,e.n,o):Core.Extensions.ReflectionExt.CopyPropFromInternal(Core.Extensions.BridgeExt.GetPropValue(n,e.n),o,i,r+1|0,u,f))}finally{Bridge.is(s,System.IDisposable)&&s.System$IDisposable$Dispose()}}},ClearReferences:function(n,t,i){var r,u,f;if(t===void 0&&(t=!1),i===void 0&&(i=null),i==null&&(i=new(System.Collections.Generic.HashSet$1(System.Object).ctor)),n!=null&&!i.contains(n)&&!Core.Extensions.ReflectionExt.IsSimple(Bridge.getType(n)))if(i.add(n),(u=Bridge.as(n,System.Collections.IEnumerable))!=null){r=Bridge.getEnumerator(u);try{while(r.moveNext())f=r.Current,Core.Extensions.ReflectionExt.ClearReferences(f,t,i)}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}}else Core.Extensions.ReflectionExt.ClearRefInternal(n,t,i)},ClearRefInternal:function(n,t,i){var u,f,h=System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Bridge.getType(n),16,28),System.Reflection.PropertyInfo).where(function(n){return!!n.s&&!!n.s}),s;u=Bridge.getEnumerator(h);try{while(u.moveNext()){var r=u.Current,e=Core.Extensions.StringExt.SubStrIndex$1(r.n,0,r.n.length-2|0),o=Bridge.as(Bridge.Reflection.midel(r.g,Bridge.unbox(n))(),System.Collections.IEnumerable);if(Core.Extensions.ReflectionExt.IsSimple(r.rt)||o!=null?Core.Extensions.ReflectionExt.IsSimple(r.rt)&&n[e]!=null&&!Core.Extensions.ReflectionExt.IsSimple(Bridge.getType(n[e]))&&(n[e]=null):Bridge.Reflection.midel(r.s,n)(null),!Bridge.referenceEquals(r.rt,System.String)&&o!=null){if(t){Bridge.Reflection.midel(r.s,n)(null);continue}f=Bridge.getEnumerator(o);try{while(f.moveNext())s=f.Current,Core.Extensions.ReflectionExt.ClearReferences(s,t,i)}finally{Bridge.is(f,System.IDisposable)&&f.System$IDisposable$Dispose()}}}}finally{Bridge.is(u,System.IDisposable)&&u.System$IDisposable$Dispose()}},GetEnumDescription:function(n,t){var r,i;return(t===void 0&&(t=null),t=t||Bridge.getType(n),r=Bridge.Reflection.getMembers(t,4,284,System.Enum.toString(Bridge.getType(n),n)),r==null)?"":(i=Bridge.as(System.Attribute.getCustomAttributes(r,System.ComponentModel.DescriptionAttribute,!1),System.Array.type(System.ComponentModel.DescriptionAttribute)),i!=null&&System.Linq.Enumerable.from(i,System.ComponentModel.DescriptionAttribute).any())?System.Linq.Enumerable.from(i,System.ComponentModel.DescriptionAttribute).first().Description:System.Enum.toString(Bridge.getType(n),n)},DeepCopy:function(n){var o,s,i,t,u,c,f,e;if(n==null)return null;if(t=Bridge.getType(n),Core.Extensions.ReflectionExt.IsSimple(t))return n;if(Bridge.Reflection.isAssignableFrom(System.Collections.IEnumerable,t)){for(var r=Bridge.createInstance(t),l=(o=Bridge.Reflection.getGenericArguments(t))[System.Array.index(0,o)],h=Bridge.getEnumerator(Bridge.as(n,System.Collections.IEnumerable)),a=Bridge.Reflection.getMembers(Bridge.getType(r),8,272,"Add");h.System$Collections$IEnumerator$moveNext();)(s=Bridge.Reflection.makeGenericMethod(a,[l]))!=null?Bridge.Reflection.midel(s,Bridge.unbox(r)).apply(null,Bridge.unbox(System.Array.init([Core.Extensions.ReflectionExt.DeepCopy(h.System$Collections$IEnumerator$Current)],System.Object))):null;return r}if(Bridge.Reflection.isClass(t)){u=Bridge.createInstance(Bridge.getType(n));c=Bridge.Reflection.getMembers(t,4,52);i=Bridge.getEnumerator(c);try{while(i.moveNext())(f=i.Current,e=Bridge.Reflection.fieldAccess(f,Bridge.unbox(n)),e!=null)&&Bridge.Reflection.fieldAccess(f,Bridge.unbox(u),Bridge.unbox(Core.Extensions.ReflectionExt.DeepCopy(e)))}finally{Bridge.is(i,System.IDisposable)&&i.System$IDisposable$Dispose()}return u}return null},CopyRowWithoutId:function(n,t){return System.Linq.Enumerable.from(t,n).select(function(t){var i=Bridge.cast(Bridge.unbox(Core.Extensions.ReflectionExt.DeepCopy(t),n),n);return Core.Extensions.BridgeExt.SetPropValue(i,Core.Extensions.ReflectionExt.IdField,Bridge.box(0,System.Int32)),Core.Extensions.ReflectionExt.ProcessObjectRecursive(i,function(n){var i=Bridge.as(Core.Extensions.BridgeExt.GetPropValue(n,Core.Extensions.ReflectionExt.IdField),System.Int32,!0),t,r;System.Nullable.hasValue(i)&&System.Nullable.getValue(i)>0&&Core.Extensions.BridgeExt.SetPropValue(n,Core.Extensions.ReflectionExt.IdField,Bridge.box(0,System.Int32));t=Bridge.as(Core.Extensions.BridgeExt.GetPropValue(n,Core.Extensions.ReflectionExt.StatusIdField),System.Int32,!0);System.Nullable.hasValue(t)&&Core.Extensions.BridgeExt.SetPropValue(n,Core.Extensions.ReflectionExt.StatusIdField,Bridge.box(Core.Enums.ApprovalStatusEnum.New,System.Int32));r=Bridge.as(Core.Extensions.BridgeExt.GetPropValue(n,Core.Extensions.ReflectionExt.FreightStateId),System.Int32,!0);System.Nullable.hasValue(t)&&Core.Extensions.BridgeExt.SetPropValue(n,Core.Extensions.ReflectionExt.FreightStateId,Bridge.box(1,System.Int32))}),Core.Extensions.ReflectionExt.ClearReferences(i),i}).toList(n)},ProcessObjectRecursive:function(n,t,i){var r,f,u,o,s;if((i===void 0&&(i=null),n!=null&&!Core.Extensions.ReflectionExt.IsSimple(Bridge.getType(n)))&&(i==null&&(i=new(System.Collections.Generic.HashSet$1(System.Object).ctor)),!i.contains(n))){if(i.add(n),(f=Bridge.as(n,System.Collections.IEnumerable))!=null){try{for(u=Bridge.getEnumerator(f);u.System$Collections$IEnumerator$moveNext();)Core.Extensions.ReflectionExt.ProcessObjectRecursive(u.System$Collections$IEnumerator$Current,t,i)}catch(e){e=System.Exception.create(e)}return}t(n);o=System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Bridge.getType(n),16,28),System.Reflection.PropertyInfo).where(function(n){return!Core.Extensions.ReflectionExt.IsSimple(n.rt)&&Bridge.Reflection.isAssignableFrom(System.Collections.IEnumerable,n.rt)});r=Bridge.getEnumerator(o);try{while(r.moveNext())s=r.Current,Core.Extensions.ReflectionExt.ProcessObjectRecursive(Bridge.Reflection.midel(s.g,Bridge.unbox(n))(),t,i)}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}}},ToDictionaryDistinct:function(n,t,i,r){return i==null?null:System.Linq.Enumerable.from(i,n).groupBy(r).select(function(n){return n.first()}).toDictionary(r,null,t,n)}}}});Bridge.define("Core.Extensions.StringExt",{statics:{fields:{trimmer:null},ctors:{init:function(){this.trimmer=new System.Text.RegularExpressions.Regex.ctor("\\s\\s+")}},methods:{IsNullOrEmpty:function(n){return System.String.isNullOrEmpty(n)},IsNullOrWhiteSpace:function(n){return System.String.isNullOrWhiteSpace(n)},HasAnyChar:function(n){return n!=null&&!System.String.isNullOrEmpty(n)},HasNonSpaceChar:function(n){return n!=null&&!System.String.isNullOrWhiteSpace(n)},CountChar:function(n,t){var i,r=0,u;i=Bridge.getEnumerator(n);try{while(i.moveNext())u=i.Current,t===u&&(r=r+1|0)}finally{Bridge.is(i,System.IDisposable)&&i.System$IDisposable$Dispose()}return r},IsMatch:function(n,t){var i=new System.Text.RegularExpressions.Regex.ctor(t);return i.isMatch(n)},TrimAndRemoveWhiteSpace:function(n){return n==null?null:Core.Extensions.StringExt.trimmer.replace(n.trim()," ")},ToLower:function(n){return System.Boolean.toString(n).toLowerCase()},SubStrIndex:function(n,t){return n==null?n:((t<0||t>(n.length-1|0))&&(t=0),n.substr(t,n.length-t|0))},SubStrIndex$1:function(n,t,i){return n==null?n:((t<0||t>(n.length-1|0))&&(t=0),(i<0||i>(n.length-1|0))&&(i=n.length-1|0),n.substr(t,i-t|0))}}}});Bridge.define("Core.Extensions.Toast",{statics:{methods:{Create:function(n){if(typeof PNotify!="undefined"){new PNotify({title:n.Message,delay:n.Timeout,type:n.ClassName});return}Core.Components.Renderer.IHtml(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div,"toast"),n.ClassName),n.Message,n.Params);var t=Core.MVVM.Html.Context;window.setTimeout(function(){t.remove()},n.Timeout)},Success:function(n,t,i){var r;t===void 0&&(t=2500);i===void 0&&(i=[]);Core.Extensions.Toast.Create((r=new Core.Extensions.ToastOptions,r.ClassName="success",r.Timeout=t,r.Message=n,r.Params=i,r))},Warning:function(n){var t;Core.Extensions.Toast.Create((t=new Core.Extensions.ToastOptions,t.ClassName="warning",t.Timeout=2500,t.Message=n,t))},Small:function(n,t){var i;t===void 0&&(t=2500);Core.Extensions.Toast.Create((i=new Core.Extensions.ToastOptions,i.ClassName="sm-tran",i.Timeout=t,i.Message=n,i))}}}});Bridge.define("Core.Extensions.ToastOptions",{props:{Timeout:0,ClassName:null,Message:null,Params:null}});Bridge.define("Core.Extensions.Utils",{statics:{fields:{SystemId:0,TenantField:null,Pixel:null,FeatureField:null,QuestionMark:null,Amp:null,ApplicationJson:null,Authorization:null,SelfVendorId:0,AutoSaveReason:null,IdField:null,NewLine:null,Indent:null,Dot:null,Comma:null,Semicolon:null,Space:null,ComponentId:0,ComponentGroupId:0,GridPolicyId:0,HistoryId:0,InsertedBy:null,OwnerId:null,GOOGLE_MAP:null,GOOGLE_MAP_PLACES:null,GOOGLE_MAP_GEOMETRY:null,GOOGLE_MAP_WEEKLY:null,GOOGLE_MAP_GEO_REQUEST:null,SpecialChar:null,ReverseSpecialChar:null,NullFormatHandler:null,NotFoundHandler:null,EmptyFormat:null},ctors:{init:function(){this.SystemId=1;this.TenantField="t";this.Pixel="px";this.FeatureField="f";this.QuestionMark="?";this.Amp="&";this.ApplicationJson="application/json";this.Authorization="Authorization";this.SelfVendorId=65;this.AutoSaveReason="Tự động cập nhật";this.IdField="Id";this.NewLine="\r\n";this.Indent="\t";this.Dot=".";this.Comma=",";this.Semicolon=";";this.Space=" ";this.ComponentId=20;this.ComponentGroupId=30;this.GridPolicyId=2077;this.HistoryId=4199;this.InsertedBy="InsertedBy";this.OwnerId="OwnerId";this.GOOGLE_MAP="https://maps.googleapis.com/maps/api/js?key=AIzaSyCr_2PaKJplCyvwN4q78lBkX3UBpfZ_HsY";this.GOOGLE_MAP_PLACES="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfVrTUFatsZTyqaCKwRzbj09DD72VxSwc&libraries=places";this.GOOGLE_MAP_GEOMETRY="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfVrTUFatsZTyqaCKwRzbj09DD72VxSwc&libraries=geometry";this.GOOGLE_MAP_WEEKLY="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfVrTUFatsZTyqaCKwRzbj09DD72VxSwc&libraries=&v=weekly";this.GOOGLE_MAP_GEO_REQUEST="https://maps.googleapis.com/maps/api/geocode/json?key=AIzaSyBfVrTUFatsZTyqaCKwRzbj09DD72VxSwc";this.SpecialChar=function(n){return n.add(43,"%2B"),n.add(47,"%2F"),n.add(63,"%3F"),n.add(35,"%23"),n.add(38,"%26"),n}(new(System.Collections.Generic.Dictionary$2(System.Char,System.String).ctor));this.ReverseSpecialChar=System.Linq.Enumerable.from(Core.Extensions.Utils.SpecialChar,System.Collections.Generic.KeyValuePair$2(System.Char,System.String)).toDictionary(function(n){return n.value},function(n){return n.key},System.String,System.Char);this.NullFormatHandler=function(){return"null"};this.NotFoundHandler=function(n){return"{"+(n||"")+"}"};this.EmptyFormat=function(){return""}}},methods:{EncodeSpecialChar:function(n){var t,r,i;if(n==null)return null;for(t=System.String.toCharArray(n,0,n.length),r=new System.Text.StringBuilder,i=0;i<t.length;i=i+1|0)Core.Extensions.Utils.SpecialChar.containsKey(t[System.Array.index(i,t)])?r.append(Core.Extensions.Utils.SpecialChar.getItem(t[System.Array.index(i,t)])):r.append(String.fromCharCode(t[System.Array.index(i,t)]));return r.toString()},EncodeProperties:function(n){var t,r,f=n!=null?Bridge.Reflection.getMembers(Bridge.getType(n),16,28):null,i,u;t=Bridge.getEnumerator(f);try{while(t.moveNext())i=t.Current,Bridge.referenceEquals(i.rt,System.String)&&!!i.s&&(u=(r=Bridge.Reflection.midel(i.g,Bridge.unbox(n)).apply(null,null))!=null?Bridge.toString(r):null,Bridge.Reflection.midel(i.s,n).apply(null,(null||[]).concat(Core.Extensions.Utils.EncodeSpecialChar(u))))}finally{Bridge.is(t,System.IDisposable)&&t.System$IDisposable$Dispose()}return n},DecodeProperties:function(n){var t,r,f=n!=null?Bridge.Reflection.getMembers(Bridge.getType(n),16,28):null,i,u;t=Bridge.getEnumerator(f);try{while(t.moveNext())i=t.Current,Bridge.referenceEquals(i.rt,System.String)&&!!i.s&&(u=(r=Bridge.Reflection.midel(i.g,Bridge.unbox(n)).apply(null,null))!=null?Bridge.toString(r):null,Bridge.Reflection.midel(i.s,n).apply(null,(null||[]).concat(Core.Extensions.Utils.DecodeSpecialChar(u))))}finally{Bridge.is(t,System.IDisposable)&&t.System$IDisposable$Dispose()}return n},GetUrlParam:function(n,t){var i,r,u;return n===void 0&&(n="f"),t===void 0&&(t=null),r=new URLSearchParams((i=t,i!=null?i:window.location.search)),u=r.get(n),u},IsOwner:function(n,t){if(t===void 0&&(t=!0),n==null||Bridge.unbox(n[Core.Extensions.Utils.IdField])<=0)return t;var i=Bridge.unbox(n[Core.Extensions.Utils.OwnerId]),r=Bridge.unbox(n[Core.Extensions.Utils.InsertedBy]);return Core.Clients.Client.SystemRole||i==null&&System.Nullable.eq(r,Core.Clients.Client.Token.UserId)||System.Nullable.eq(i,Core.Clients.Client.Token.UserId)},GetEntity:function(n){return System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.Int32,Core.Models.Entity,Core.Clients.Client.Entities,n)},GetEntity$1:function(n){return System.Linq.Enumerable.from(Core.Clients.Client.Entities.Values,Core.Models.Entity).firstOrDefault(function(t){return Bridge.referenceEquals(t.Name,n)},null)},IsNullable:function(n,t,i,r){var u=Core.Extensions.BridgeExt.GetComplexPropType(t,i,r);return u==null||Bridge.referenceEquals(u,System.Nullable$1(n))},DecodeSpecialChar:function(n){var i,r,t;if(n==null)return null;for(i=System.String.toCharArray(n,0,n.length),r=new System.Text.StringBuilder,t=0;t<i.length;t=t+1|0)i[System.Array.index(t,i)]===37&&(t+3|0)<=i.length&&Core.Extensions.Utils.ReverseSpecialChar.containsKey(n.substr(t,3))?(r.append(String.fromCharCode(Core.Extensions.Utils.ReverseSpecialChar.getItem(n.substr(t,3)))),t=t+2|0):r.append(String.fromCharCode(i[System.Array.index(t,i)]));return r.toString()},GetComplexPropValue:function(n,t){var i,u,r,f;if(n==null||System.String.isNullOrWhiteSpace(t))return null;u=System.String.split(t,[46].map(function(n){return String.fromCharCode(n)}));r=n;i=Bridge.getEnumerator(u);try{while(i.moveNext()){if(f=i.Current,r==null)return null;r=Core.Extensions.BridgeExt.GetPropValue(r,f)}}finally{Bridge.is(i,System.IDisposable)&&i.System$IDisposable$Dispose()}return r},FormatEntity$1:function(n,t){return Core.Extensions.StringExt.HasAnyChar(n)?t==null?n:Core.Extensions.Utils.FormatEntity(n,null,t):""},FormatEntity:function(n,t,i,r,u){var h,f;if(r===void 0&&(r=null),u===void 0&&(u=null),n==null)return null;if(i==null)return n;Bridge.staticEquals(r,null)&&(r=Core.Extensions.Utils.NullFormatHandler);Bridge.staticEquals(u,null)&&(u=Core.Extensions.Utils.NotFoundHandler);var e=new System.Text.StringBuilder,l=0,o=!1,c=!1,s=new System.Text.StringBuilder,a=new(System.Collections.Generic.List$1(System.Object).ctor);for(h=0;h<n.length;h=h+1|0){f=n.charCodeAt(h);switch(f){case 123:o=!0;c=!0;e.append(String.fromCharCode(f)+(Bridge.toString(l)||""));break;case 58:o&&!c?e.append(String.fromCharCode(f)):o?(c=!1,e.append(String.fromCharCode(f)),Core.Extensions.Utils.GetValues(i,r,u,s.toString(),a),s.clear()):e.append(String.fromCharCode(f));break;case 125:o&&(o=!1,e.append(String.fromCharCode(f)),l=l+1|0,Core.Extensions.Utils.GetValues(i,r,u,s.toString(),a),s.clear());break;default:o&&c?s.append(String.fromCharCode(f)):e.append(String.fromCharCode(f))}}return System.String.formatProvider.apply(System.String,[t,e.toString()].concat(a.ToArray()))},GetValues:function(n,t,i,r,u){if(!Core.Extensions.StringExt.IsNullOrEmpty(r)){var e={},f={};Bridge.Deconstruct(Core.Extensions.BridgeExt.GetComplexProp(n,r).$clone(),e,f);f.v==null&&e.v?f.v=t(r):f.v!=null||e.v||(f.v=i(r));u.add(Bridge.referenceEquals(r,"0")?n:f.v)}},GenerateRandomToken:function(n){var i,r,u,t;for(n===void 0&&(n=32),i=new System.Text.StringBuilder,r=new System.Random.ctor,t=0;System.Nullable.lt(t,n);t=t+1|0)u=System.Convert.toChar(System.Convert.toInt32(Bridge.box(Math.floor(26*r.NextDouble()+65),System.Double,System.Double.format,System.Double.getHashCode)),null,9),i.append(String.fromCharCode(u));return i.toString()},CheckDataPath:function(n,t){return System.String.contains(n,"\\"+t+"\\")},UniqueNegativeId:function(n){return-Math.abs(Bridge.getHashCode(n))|0},GetCellText:function(n,t,i,r,u,f){return f===void 0&&(f=!1),Core.Extensions.Utils.DecodeSpecialChar(Core.Extensions.Utils.GetCellTextInternal(n,t,i,r,u,f))},GetCellTextInternal:function(n,t,i,r,u,f){var e,o,y,s,h,c;f===void 0&&(f=!1);var l={v:System.DateTime.getNow()},a=t!=null&&Bridge.referenceEquals(n.ComponentType,"Datepicker")&&System.DateTime.tryParse(Bridge.toString(t),null,l),v=Core.Extensions.IEnumerableExtensions.HasElement(System.Object,n.LocalData)||System.Nullable.hasValue(n.ReferenceId)||n.Reference!=null&&Core.Extensions.StringExt.HasAnyChar(n.Reference.Name);if(f||Bridge.referenceEquals(n.FieldName,Core.Extensions.Utils.IdField)&&t!=null&&(y=Bridge.is(t,System.Int32)?System.Nullable.getValue(Bridge.cast(Bridge.unbox(t,System.Int32),System.Int32)):null)!=null&&y<=0)return"";if(v&&u||!Core.Extensions.StringExt.HasAnyChar(n.FormatEntity)){if(t==null)return e=n.PlainText,e!=null?e:"";if(Bridge.is(t,System.DateTime)||a)return System.String.format((o=n.FormatData,o!=null?o:"{0:dd/MM/yyyy}"),[Bridge.box(a?l.v:Bridge.as(t,System.DateTime,!0),System.DateTime,System.Nullable.toStringFn(System.DateTime.format),System.Nullable.getHashCode)]);if(v){h=n.LocalData||(r!=null?System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String,System.Collections.Generic.List$1(System.Object),r,n.RefName):null);try{return(c=h!=null?System.Linq.Enumerable.from(h,System.Object).firstOrDefault(function(n){return Core.Extensions.Utils.CompareIdField(n,t)},null):null,c==null)?"":Core.Extensions.StringExt.HasAnyChar(n.FormatData)?Core.Extensions.Utils.FormatEntity(n.FormatData,null,c,Core.Extensions.Utils.EmptyFormat,Core.Extensions.Utils.EmptyFormat):(System.Console.WriteLine(System.String.format("Format of {0} is null",[n.FieldName])),"")}catch(p){return p=System.Exception.create(p),System.Console.WriteLine(System.String.format("Format of {0} is null",[n.FieldName])),""}}else return Core.Extensions.StringExt.HasAnyChar(n.FormatData)?System.String.format(n.FormatData,[t]):Bridge.toString(t)}else return(s={},Core.Extensions.Utils.IsFunction(n.FormatEntity,s))?Bridge.toString(s.v.call(Bridge.unbox(i),Bridge.unbox(i))):Core.Extensions.Utils.GetFormattedRow(n.FormatEntity,i)},CompareIdField:function(n,t){var i=Core.Extensions.BridgeExt.GetPropValue(n,Core.Extensions.Utils.IdField),r,u;return System.Nullable.liftne("ne",r=Bridge.is(i,System.Int64)?System.Nullable.getValue(Bridge.cast(Bridge.unbox(i,System.Int64),System.Int64)):null,System.Int64.lift(null))&&r.equals(System.Nullable.getValue(Bridge.cast(Bridge.unbox(t,System.Int64),System.Int64)))||(u=Bridge.is(i,System.Int32)?System.Nullable.getValue(Bridge.cast(Bridge.unbox(i,System.Int32),System.Int32)):null)!=null&&u===System.Nullable.getValue(Bridge.cast(Bridge.unbox(t,System.Int32),System.Int32))},GetFormattedRow:function(n,t){var i,r={},u=Core.Extensions.Utils.IsFunction(n,r);return u?(i=r.v.call(null,Bridge.unbox(t)))!=null?Bridge.toString(i):null:Core.Extensions.Utils.FormatEntity(n,null,t,Core.Extensions.Utils.EmptyFormat,Core.Extensions.Utils.EmptyFormat)},IsFunction:function(n,t){if(t.v=null,Core.Extensions.StringExt.IsNullOrEmpty(n)||!System.String.contains(n,"=>"))return!1;try{if(t.v=eval(n),t.v!=null&&Bridge.hasValue(t.v))return!0}catch(i){return i=System.Exception.create(i),!1}return t.v!=null},MapToComponent:function(n){var t=new Core.Models.Component,i;return Core.Extensions.ReflectionExt.CopyPropFrom$1(t,n),t.Label=n.ShortDesc,t.FormatData=n.FormatCell,t.FormatEntity=n.FormatRow,t.DataSourceFilter=n.DataSource,t.LocalHeader=n.LocalHeader,t.LocalData=n.LocalData,Core.Extensions.StringExt.IsNullOrEmpty(n.Query)||(i=Core.Extensions.Utils.TryParseHeader(n),Core.Extensions.IEnumerableExtensions.HasElement(System.Object,i)&&(t.LocalData=i)),t},TryParseHeader:function(n){try{return System.Linq.Enumerable.from(Newtonsoft.Json.JsonConvert.DeserializeObject(n.Query,System.Collections.Generic.List$1(Core.Models.Entity))).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object)}catch(t){return t=System.Exception.create(t),null}},LastDayOfMonth:function(n){var i,t;return n===void 0&&(n=null),t=(i=n,i!=null?i:System.DateTime.getNow()),System.DateTime.create(System.DateTime.getYear(t),System.DateTime.getMonth(t),System.DateTime.getDaysInMonth(System.DateTime.getYear(t),System.DateTime.getMonth(t)))},TryParseInt:function(n){var t={},i=System.Int32.tryParse(n,t);return i?t.v:null},TryParseBool:function(n){var t={},i=System.Boolean.tryParse(n,t);return i?t.v:null},TryParseDecimal:function(n){if(Core.Extensions.StringExt.IsNullOrWhiteSpace(n))return System.Decimal.lift(null);var t={},i=System.Decimal.tryParse(n,null,t);return i?t.v:System.Decimal.lift(null)},TryParse:function(n,t){var i,r,s,u,h,f,c,e,l,o,a;return Core.Extensions.StringExt.IsNullOrWhiteSpace(t)?null:(i=n,Bridge.Reflection.isEnum(i))?(r={},s=System.Enum.tryParse(n,t,r),s?r.v:null):Bridge.referenceEquals(i,System.Int32)||Bridge.referenceEquals(i,System.Nullable$1(System.Int32))?Bridge.as(System.Convert.toInt32(t),n,!0):Bridge.referenceEquals(i,System.Int64)||Bridge.referenceEquals(i,System.Nullable$1(System.Int64))?Bridge.as(System.Convert.toInt64(t),n,!0):Bridge.referenceEquals(i,System.Int16)||Bridge.referenceEquals(i,System.Nullable$1(System.Int16))?Bridge.as(System.Convert.toInt16(t),n,!0):Bridge.referenceEquals(i,System.Boolean)||Bridge.referenceEquals(i,System.Nullable$1(System.Boolean))?Bridge.as(System.Convert.toBoolean(t),n,!0):Bridge.referenceEquals(i,System.TimeSpan)||Bridge.referenceEquals(i,System.Nullable$1(System.TimeSpan))?(u={},h=System.TimeSpan.tryParse(t,null,u),h?Bridge.as(u.v,n,!0):null):Bridge.referenceEquals(i,System.DateTime)||Bridge.referenceEquals(i,System.Nullable$1(System.DateTime))?(f={},c=System.DateTime.tryParse(t,null,f),c?Bridge.as(f.v,n,!0):null):Bridge.referenceEquals(i,System.DateTimeOffset)||Bridge.referenceEquals(i,System.Nullable$1(System.DateTimeOffset))?(e={v:new System.DateTimeOffset},l=System.DateTimeOffset.TryParse(t,e),l?Bridge.as(e.v,n,!0):null):Bridge.referenceEquals(i,System.Byte)||Bridge.referenceEquals(i,System.Nullable$1(System.Byte))?Bridge.as(System.Convert.toByte(t),n,!0):Bridge.referenceEquals(i,System.Char)||Bridge.referenceEquals(i,System.Nullable$1(System.Char))?Bridge.as(System.Convert.toChar(t,null,18),n,!0):Bridge.referenceEquals(i,System.Decimal)||Bridge.referenceEquals(i,System.Nullable$1(System.Decimal))?Bridge.as(System.Convert.toDecimal(t),n,!0):Bridge.referenceEquals(i,System.Double)||Bridge.referenceEquals(i,System.Nullable$1(System.Double))?Bridge.as(System.Convert.toDouble(t),n,!0):Bridge.referenceEquals(i,System.Single)||Bridge.referenceEquals(i,System.Nullable$1(System.Single))?(o={},a=System.Single.tryParse(t,null,o),a?Bridge.as(o.v,n,!0):null):null},ChangeType:function(n,t){var i,l,r,a,u,v,f,y,e,p,o,w,s,b,h,k,c,d;return Core.Extensions.StringExt.IsNullOrWhiteSpace(n)?null:Bridge.referenceEquals(t,System.Int32)||Bridge.referenceEquals(t,System.Nullable$1(System.Int32))?(i={},l=System.Int32.tryParse(n,i),Bridge.box(l?i.v:Bridge.referenceEquals(t,System.Int32)?0:null,System.Int32,System.Nullable.toString,System.Nullable.getHashCode)):Bridge.referenceEquals(t,System.Int64)||Bridge.referenceEquals(t,System.Nullable$1(System.Int64))?(r={},a=System.Int64.tryParse(n,r),a?r.v:Bridge.referenceEquals(t,System.Int64)?System.Int64(0):System.Int64.lift(null)):Bridge.referenceEquals(t,System.Int16)||Bridge.referenceEquals(t,System.Nullable$1(System.Int16))?(u={},v=System.Int16.tryParse(n,u),Bridge.box(v?u.v:Bridge.referenceEquals(t,System.Int16)?0:null,System.Int16,System.Nullable.toString,System.Nullable.getHashCode)):Bridge.referenceEquals(t,System.Boolean)||Bridge.referenceEquals(t,System.Nullable$1(System.Boolean))?Bridge.box(System.Convert.toBoolean(n),System.Boolean,System.Boolean.toString):Bridge.referenceEquals(t,System.TimeSpan)||Bridge.referenceEquals(t,System.Nullable$1(System.TimeSpan))?(f={},y=System.TimeSpan.tryParse(n,null,f),y?f.v:null):Bridge.referenceEquals(t,System.DateTime)||Bridge.referenceEquals(t,System.Nullable$1(System.DateTime))?(e={},p=System.DateTime.tryParse(n,null,e),Bridge.box(p?e.v:null,System.DateTime,System.Nullable.toStringFn(System.DateTime.format),System.Nullable.getHashCode)):Bridge.referenceEquals(t,System.DateTimeOffset)||Bridge.referenceEquals(t,System.Nullable$1(System.DateTimeOffset))?(o={v:new System.DateTimeOffset},w=System.DateTimeOffset.TryParse(n,o),System.Nullable.lift1("$clone",w?o.v:null)):Bridge.referenceEquals(t,System.Byte)||Bridge.referenceEquals(t,System.Nullable$1(System.Byte))?Bridge.box(System.Convert.toByte(n),System.Byte):Bridge.referenceEquals(t,System.Char)||Bridge.referenceEquals(t,System.Nullable$1(System.Char))?Bridge.box(System.Convert.toChar(n,null,18),System.Char,String.fromCharCode,System.Char.getHashCode):Bridge.referenceEquals(t,System.Decimal)||Bridge.referenceEquals(t,System.Nullable$1(System.Decimal))?(s={},b=System.Decimal.tryParse(n,null,s),b?s.v:Bridge.referenceEquals(t,System.Decimal)?System.Decimal(0):System.Decimal.lift(null)):Bridge.referenceEquals(t,System.Double)||Bridge.referenceEquals(t,System.Nullable$1(System.Double))?(h={},k=System.Single.tryParse(n,null,h),Bridge.box(k?h.v:Bridge.referenceEquals(t,System.Double)?0:null,System.Double,System.Nullable.toStringFn(System.Double.format),System.Nullable.getHashCodeFn(System.Double.getHashCode))):Bridge.referenceEquals(t,System.Single)||Bridge.referenceEquals(t,System.Nullable$1(System.Single))?(c={},d=System.Single.tryParse(n,null,c),Bridge.box(d?c.v:Bridge.referenceEquals(t,System.Single)?0:null,System.Single,System.Nullable.toStringFn(System.Single.format),System.Nullable.getHashCodeFn(System.Single.getHashCode))):null},GetMimeType:function(n){if(n==null)throw new System.ArgumentNullException.$ctor1("extension");System.String.startsWith(n,".")&&(n=n.substr(1));n=n.toLowerCase();switch(n){case"323":return"text/h323";case"3g2":return"video/3gpp2";case"3gp":return"video/3gpp";case"3gp2":return"video/3gpp2";case"3gpp":return"video/3gpp";case"7z":return"application/x-7z-compressed";case"aa":return"audio/audible";case"aac":return"audio/aac";case"aaf":return"application/octet-stream";case"aax":return"audio/vnd.audible.aax";case"ac3":return"audio/ac3";case"aca":return"application/octet-stream";case"accda":return"application/msaccess.addin";case"accdb":return"application/msaccess";case"accdc":return"application/msaccess.cab";case"accde":return"application/msaccess";case"accdr":return"application/msaccess.runtime";case"accdt":return"application/msaccess";case"accdw":return"application/msaccess.webapplication";case"accft":return"application/msaccess.ftemplate";case"acx":return"application/internet-property-stream";case"addin":return"text/xml";case"ade":return"application/msaccess";case"adobebridge":return"application/x-bridge-url";case"adp":return"application/msaccess";case"adt":return"audio/vnd.dlna.adts";case"adts":return"audio/aac";case"afm":return"application/octet-stream";case"ai":return"application/postscript";case"aif":return"audio/x-aiff";case"aifc":return"audio/aiff";case"aiff":return"audio/aiff";case"air":return"application/vnd.adobe.air-application-installer-package+zip";case"amc":return"application/x-mpeg";case"application":return"application/x-ms-application";case"art":return"image/x-jg";case"asa":return"application/xml";case"asax":return"application/xml";case"ascx":return"application/xml";case"asd":return"application/octet-stream";case"asf":return"video/x-ms-asf";case"ashx":return"application/xml";case"asi":return"application/octet-stream";case"asm":return"text/plain";case"asmx":return"application/xml";case"aspx":return"application/xml";case"asr":return"video/x-ms-asf";case"asx":return"video/x-ms-asf";case"atom":return"application/atom+xml";case"au":return"audio/basic";case"avi":return"video/x-msvideo";case"axs":return"application/olescript";case"bas":return"text/plain";case"bcpio":return"application/x-bcpio";case"bin":return"application/octet-stream";case"bmp":return"image/bmp";case"c":return"text/plain";case"cab":return"application/octet-stream";case"caf":return"audio/x-caf";case"calx":return"application/vnd.ms-office.calx";case"cat":return"application/vnd.ms-pki.seccat";case"cc":return"text/plain";case"cd":return"text/plain";case"cdda":return"audio/aiff";case"cdf":return"application/x-cdf";case"cer":return"application/x-x509-ca-cert";case"chm":return"application/octet-stream";case"class":return"application/x-java-applet";case"clp":return"application/x-msclip";case"cmx":return"image/x-cmx";case"cnf":return"text/plain";case"cod":return"image/cis-cod";case"config":return"application/xml";case"contact":return"text/x-ms-contact";case"coverage":return"application/xml";case"cpio":return"application/x-cpio";case"cpp":return"text/plain";case"crd":return"application/x-mscardfile";case"crl":return"application/pkix-crl";case"crt":return"application/x-x509-ca-cert";case"cs":return"text/plain";case"csdproj":return"text/plain";case"csh":return"application/x-csh";case"csproj":return"text/plain";case"css":return"text/css";case"csv":return"text/csv";case"cur":return"application/octet-stream";case"cxx":return"text/plain";case"dat":return"application/octet-stream";case"datasource":return"application/xml";case"dbproj":return"text/plain";case"dcr":return"application/x-director";case"def":return"text/plain";case"deploy":return"application/octet-stream";case"der":return"application/x-x509-ca-cert";case"dgml":return"application/xml";case"dib":return"image/bmp";case"dif":return"video/x-dv";case"dir":return"application/x-director";case"disco":return"text/xml";case"dll":return"application/x-msdownload";case"dll.config":return"text/xml";case"dlm":return"text/dlm";case"doc":return"application/msword";case"docm":return"application/vnd.ms-word.document.macroenabled.12";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"dot":return"application/msword";case"dotm":return"application/vnd.ms-word.template.macroenabled.12";case"dotx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.template";case"dsp":return"application/octet-stream";case"dsw":return"text/plain";case"dtd":return"text/xml";case"dtsconfig":return"text/xml";case"dv":return"video/x-dv";case"dvi":return"application/x-dvi";case"dwf":return"drawing/x-dwf";case"dwp":return"application/octet-stream";case"dxr":return"application/x-director";case"eml":return"message/rfc822";case"emz":return"application/octet-stream";case"eot":return"application/octet-stream";case"eps":return"application/postscript";case"etl":return"application/etl";case"etx":return"text/x-setext";case"evy":return"application/envoy";case"exe":return"application/octet-stream";case"exe.config":return"text/xml";case"fdf":return"application/vnd.fdf";case"fif":return"application/fractals";case"filters":return"application/xml";case"fla":return"application/octet-stream";case"flr":return"x-world/x-vrml";case"flv":return"video/x-flv";case"fsscript":return"application/fsharp-script";case"fsx":return"application/fsharp-script";case"generictest":return"application/xml";case"gif":return"image/gif";case"group":return"text/x-ms-group";case"gsm":return"audio/x-gsm";case"gtar":return"application/x-gtar";case"gz":return"application/x-gzip";case"h":return"text/plain";case"hdf":return"application/x-hdf";case"hdml":return"text/x-hdml";case"hhc":return"application/x-oleobject";case"hhk":return"application/octet-stream";case"hhp":return"application/octet-stream";case"hlp":return"application/winhlp";case"hpp":return"text/plain";case"hqx":return"application/mac-binhex40";case"hta":return"application/hta";case"htc":return"text/x-component";case"htm":return"text/html";case"html":return"text/html";case"htt":return"text/webviewhtml";case"hxa":return"application/xml";case"hxc":return"application/xml";case"hxd":return"application/octet-stream";case"hxe":return"application/xml";case"hxf":return"application/xml";case"hxh":return"application/octet-stream";case"hxi":return"application/octet-stream";case"hxk":return"application/xml";case"hxq":return"application/octet-stream";case"hxr":return"application/octet-stream";case"hxs":return"application/octet-stream";case"hxt":return"text/html";case"hxv":return"application/xml";case"hxw":return"application/octet-stream";case"hxx":return"text/plain";case"i":return"text/plain";case"ico":return"image/x-icon";case"ics":return"application/octet-stream";case"idl":return"text/plain";case"ief":return"image/ief";case"iii":return"application/x-iphone";case"inc":return"text/plain";case"inf":return"application/octet-stream";case"inl":return"text/plain";case"ins":return"application/x-internet-signup";case"ipa":return"application/x-itunes-ipa";case"ipg":return"application/x-itunes-ipg";case"ipproj":return"text/plain";case"ipsw":return"application/x-itunes-ipsw";case"iqy":return"text/x-ms-iqy";case"isp":return"application/x-internet-signup";case"ite":return"application/x-itunes-ite";case"itlp":return"application/x-itunes-itlp";case"itms":return"application/x-itunes-itms";case"itpc":return"application/x-itunes-itpc";case"ivf":return"video/x-ivf";case"jar":return"application/java-archive";case"java":return"application/octet-stream";case"jck":return"application/liquidmotion";case"jcz":return"application/liquidmotion";case"jfif":return"image/pjpeg";case"jnlp":return"application/x-java-jnlp-file";case"jpb":return"application/octet-stream";case"jpe":return"image/jpeg";case"jpeg":return"image/jpeg";case"jpg":return"image/jpeg";case"js":return"application/x-javascript";case"jsx":return"text/jscript";case"jsxbin":return"text/plain";case"latex":return"application/x-latex";case"library-ms":return"application/windows-library+xml";case"lit":return"application/x-ms-reader";case"loadtest":return"application/xml";case"lpk":return"application/octet-stream";case"lsf":return"video/x-la-asf";case"lst":return"text/plain";case"lsx":return"video/x-la-asf";case"lzh":return"application/octet-stream";case"m13":return"application/x-msmediaview";case"m14":return"application/x-msmediaview";case"m1v":return"video/mpeg";case"m2t":return"video/vnd.dlna.mpeg-tts";case"m2ts":return"video/vnd.dlna.mpeg-tts";case"m2v":return"video/mpeg";case"m3u":return"audio/x-mpegurl";case"m3u8":return"audio/x-mpegurl";case"m4a":return"audio/m4a";case"m4b":return"audio/m4b";case"m4p":return"audio/m4p";case"m4r":return"audio/x-m4r";case"m4v":return"video/x-m4v";case"mac":return"image/x-macpaint";case"mak":return"text/plain";case"man":return"application/x-troff-man";case"manifest":return"application/x-ms-manifest";case"map":return"text/plain";case"master":return"application/xml";case"mda":return"application/msaccess";case"mdb":return"application/x-msaccess";case"mde":return"application/msaccess";case"mdp":return"application/octet-stream";case"me":return"application/x-troff-me";case"mfp":return"application/x-shockwave-flash";case"mht":return"message/rfc822";case"mhtml":return"message/rfc822";case"mid":return"audio/mid";case"midi":return"audio/mid";case"mix":return"application/octet-stream";case"mk":return"text/plain";case"mmf":return"application/x-smaf";case"mno":return"text/xml";case"mny":return"application/x-msmoney";case"mod":return"video/mpeg";case"mov":return"video/quicktime";case"movie":return"video/x-sgi-movie";case"mp2":return"video/mpeg";case"mp2v":return"video/mpeg";case"mp3":return"audio/mpeg";case"mp4":return"video/mp4";case"mp4v":return"video/mp4";case"mpa":return"video/mpeg";case"mpe":return"video/mpeg";case"mpeg":return"video/mpeg";case"mpf":return"application/vnd.ms-mediapackage";case"mpg":return"video/mpeg";case"mpp":return"application/vnd.ms-project";case"mpv2":return"video/mpeg";case"mqv":return"video/quicktime";case"ms":return"application/x-troff-ms";case"msi":return"application/octet-stream";case"mso":return"application/octet-stream";case"mts":return"video/vnd.dlna.mpeg-tts";case"mtx":return"application/xml";case"mvb":return"application/x-msmediaview";case"mvc":return"application/x-miva-compiled";case"mxp":return"application/x-mmxp";case"nc":return"application/x-netcdf";case"nsc":return"video/x-ms-asf";case"nws":return"message/rfc822";case"ocx":return"application/octet-stream";case"oda":return"application/oda";case"odc":return"text/x-ms-odc";case"odh":return"text/plain";case"odl":return"text/plain";case"odp":return"application/vnd.oasis.opendocument.presentation";case"ods":return"application/oleobject";case"odt":return"application/vnd.oasis.opendocument.text";case"one":return"application/onenote";case"onea":return"application/onenote";case"onepkg":return"application/onenote";case"onetmp":return"application/onenote";case"onetoc":return"application/onenote";case"onetoc2":return"application/onenote";case"orderedtest":return"application/xml";case"osdx":return"application/opensearchdescription+xml";case"p10":return"application/pkcs10";case"p12":return"application/x-pkcs12";case"p7b":return"application/x-pkcs7-certificates";case"p7c":return"application/pkcs7-mime";case"p7m":return"application/pkcs7-mime";case"p7r":return"application/x-pkcs7-certreqresp";case"p7s":return"application/pkcs7-signature";case"pbm":return"image/x-portable-bitmap";case"pcast":return"application/x-podcast";case"pct":return"image/pict";case"pcx":return"application/octet-stream";case"pcz":return"application/octet-stream";case"pdf":return"application/pdf";case"pfb":return"application/octet-stream";case"pfm":return"application/octet-stream";case"pfx":return"application/x-pkcs12";case"pgm":return"image/x-portable-graymap";case"pic":return"image/pict";case"pict":return"image/pict";case"pkgdef":return"text/plain";case"pkgundef":return"text/plain";case"pko":return"application/vnd.ms-pki.pko";case"pls":return"audio/scpls";case"pma":return"application/x-perfmon";case"pmc":return"application/x-perfmon";case"pml":return"application/x-perfmon";case"pmr":return"application/x-perfmon";case"pmw":return"application/x-perfmon";case"png":return"image/png";case"pnm":return"image/x-portable-anymap";case"pnt":return"image/x-macpaint";case"pntg":return"image/x-macpaint";case"pnz":return"image/png";case"pot":return"application/vnd.ms-powerpoint";case"potm":return"application/vnd.ms-powerpoint.template.macroenabled.12";case"potx":return"application/vnd.openxmlformats-officedocument.presentationml.template";case"ppa":return"application/vnd.ms-powerpoint";case"ppam":return"application/vnd.ms-powerpoint.addin.macroenabled.12";case"ppm":return"image/x-portable-pixmap";case"pps":return"application/vnd.ms-powerpoint";case"ppsm":return"application/vnd.ms-powerpoint.slideshow.macroenabled.12";case"ppsx":return"application/vnd.openxmlformats-officedocument.presentationml.slideshow";case"ppt":return"application/vnd.ms-powerpoint";case"pptm":return"application/vnd.ms-powerpoint.presentation.macroenabled.12";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"prf":return"application/pics-rules";case"prm":return"application/octet-stream";case"prx":return"application/octet-stream";case"ps":return"application/postscript";case"psc1":return"application/powershell";case"psd":return"application/octet-stream";case"psess":return"application/xml";case"psm":return"application/octet-stream";case"psp":return"application/octet-stream";case"pub":return"application/x-mspublisher";case"pwz":return"application/vnd.ms-powerpoint";case"qht":return"text/x-html-insertion";case"qhtm":return"text/x-html-insertion";case"qt":return"video/quicktime";case"qti":return"image/x-quicktime";case"qtif":return"image/x-quicktime";case"qtl":return"application/x-quicktimeplayer";case"qxd":return"application/octet-stream";case"ra":return"audio/x-pn-realaudio";case"ram":return"audio/x-pn-realaudio";case"rar":return"application/octet-stream";case"ras":return"image/x-cmu-raster";case"rat":return"application/rat-file";case"rc":return"text/plain";case"rc2":return"text/plain";case"rct":return"text/plain";case"rdlc":return"application/xml";case"resx":return"application/xml";case"rf":return"image/vnd.rn-realflash";case"rgb":return"image/x-rgb";case"rgs":return"text/plain";case"rm":return"application/vnd.rn-realmedia";case"rmi":return"audio/mid";case"rmp":return"application/vnd.rn-rn_music_package";case"roff":return"application/x-troff";case"rpm":return"audio/x-pn-realaudio-plugin";case"rqy":return"text/x-ms-rqy";case"rtf":return"application/rtf";case"rtx":return"text/richtext";case"ruleset":return"application/xml";case"s":return"text/plain";case"safariextz":return"application/x-safari-safariextz";case"scd":return"application/x-msschedule";case"sct":return"text/scriptlet";case"sd2":return"audio/x-sd2";case"sdp":return"application/sdp";case"sea":return"application/octet-stream";case"searchconnector-ms":return"application/windows-search-connector+xml";case"setpay":return"application/set-payment-initiation";case"setreg":return"application/set-registration-initiation";case"settings":return"application/xml";case"sgimb":return"application/x-sgimb";case"sgml":return"text/sgml";case"sh":return"application/x-sh";case"shar":return"application/x-shar";case"shtml":return"text/html";case"sit":return"application/x-stuffit";case"sitemap":return"application/xml";case"skin":return"application/xml";case"sldm":return"application/vnd.ms-powerpoint.slide.macroenabled.12";case"sldx":return"application/vnd.openxmlformats-officedocument.presentationml.slide";case"slk":return"application/vnd.ms-excel";case"sln":return"text/plain";case"slupkg-ms":return"application/x-ms-license";case"smd":return"audio/x-smd";case"smi":return"application/octet-stream";case"smx":return"audio/x-smd";case"smz":return"audio/x-smd";case"snd":return"audio/basic";case"snippet":return"application/xml";case"snp":return"application/octet-stream";case"sol":return"text/plain";case"sor":return"text/plain";case"spc":return"application/x-pkcs7-certificates";case"spl":return"application/futuresplash";case"src":return"application/x-wais-source";case"srf":return"text/plain";case"ssisdeploymentmanifest":return"text/xml";case"ssm":return"application/streamingmedia";case"sst":return"application/vnd.ms-pki.certstore";case"stl":return"application/vnd.ms-pki.stl";case"sv4cpio":return"application/x-sv4cpio";case"sv4crc":return"application/x-sv4crc";case"svc":return"application/xml";case"swf":return"application/x-shockwave-flash";case"t":return"application/x-troff";case"tar":return"application/x-tar";case"tcl":return"application/x-tcl";case"testrunconfig":return"application/xml";case"testsettings":return"application/xml";case"tex":return"application/x-tex";case"texi":return"application/x-texinfo";case"texinfo":return"application/x-texinfo";case"tgz":return"application/x-compressed";case"thmx":return"application/vnd.ms-officetheme";case"thn":return"application/octet-stream";case"tif":return"image/tiff";case"tiff":return"image/tiff";case"tlh":return"text/plain";case"tli":return"text/plain";case"toc":return"application/octet-stream";case"tr":return"application/x-troff";case"trm":return"application/x-msterminal";case"trx":return"application/xml";case"ts":return"video/vnd.dlna.mpeg-tts";case"tsv":return"text/tab-separated-values";case"ttf":return"application/octet-stream";case"tts":return"video/vnd.dlna.mpeg-tts";case"txt":return"text/plain";case"u32":return"application/octet-stream";case"uls":return"text/iuls";case"user":return"text/plain";case"ustar":return"application/x-ustar";case"vb":return"text/plain";case"vbdproj":return"text/plain";case"vbk":return"video/mpeg";case"vbproj":return"text/plain";case"vbs":return"text/vbscript";case"vcf":return"text/x-vcard";case"vcproj":return"application/xml";case"vcs":return"text/plain";case"vcxproj":return"application/xml";case"vddproj":return"text/plain";case"vdp":return"text/plain";case"vdproj":return"text/plain";case"vdx":return"application/vnd.ms-visio.viewer";case"vml":return"text/xml";case"vscontent":return"application/xml";case"vsct":return"text/xml";case"vsd":return"application/vnd.visio";case"vsi":return"application/ms-vsi";case"vsix":return"application/vsix";case"vsixlangpack":return"text/xml";case"vsixmanifest":return"text/xml";case"vsmdi":return"application/xml";case"vspscc":return"text/plain";case"vss":return"application/vnd.visio";case"vsscc":return"text/plain";case"vssettings":return"text/xml";case"vssscc":return"text/plain";case"vst":return"application/vnd.visio";case"vstemplate":return"text/xml";case"vsto":return"application/x-ms-vsto";case"vsw":return"application/vnd.visio";case"vsx":return"application/vnd.visio";case"vtx":return"application/vnd.visio";case"wav":return"audio/wav";case"wave":return"audio/wav";case"wax":return"audio/x-ms-wax";case"wbk":return"application/msword";case"wbmp":return"image/vnd.wap.wbmp";case"wcm":return"application/vnd.ms-works";case"wdb":return"application/vnd.ms-works";case"wdp":return"image/vnd.ms-photo";case"webarchive":return"application/x-safari-webarchive";case"webtest":return"application/xml";case"wiq":return"application/xml";case"wiz":return"application/msword";case"wks":return"application/vnd.ms-works";case"wlmp":return"application/wlmoviemaker";case"wlpginstall":return"application/x-wlpg-detect";case"wlpginstall3":return"application/x-wlpg3-detect";case"wm":return"video/x-ms-wm";case"wma":return"audio/x-ms-wma";case"wmd":return"application/x-ms-wmd";case"wmf":return"application/x-msmetafile";case"wml":return"text/vnd.wap.wml";case"wmlc":return"application/vnd.wap.wmlc";case"wmls":return"text/vnd.wap.wmlscript";case"wmlsc":return"application/vnd.wap.wmlscriptc";case"wmp":return"video/x-ms-wmp";case"wmv":return"video/x-ms-wmv";case"wmx":return"video/x-ms-wmx";case"wmz":return"application/x-ms-wmz";case"wpl":return"application/vnd.ms-wpl";case"wps":return"application/vnd.ms-works";case"wri":return"application/x-mswrite";case"wrl":return"x-world/x-vrml";case"wrz":return"x-world/x-vrml";case"wsc":return"text/scriptlet";case"wsdl":return"text/xml";case"wvx":return"video/x-ms-wvx";case"x":return"application/directx";case"xaf":return"x-world/x-vrml";case"xaml":return"application/xaml+xml";case"xap":return"application/x-silverlight-app";case"xbap":return"application/x-ms-xbap";case"xbm":return"image/x-xbitmap";case"xdr":return"text/plain";case"xht":return"application/xhtml+xml";case"xhtml":return"application/xhtml+xml";case"xla":return"application/vnd.ms-excel";case"xlam":return"application/vnd.ms-excel.addin.macroenabled.12";case"xlc":return"application/vnd.ms-excel";case"xld":return"application/vnd.ms-excel";case"xlk":return"application/vnd.ms-excel";case"xll":return"application/vnd.ms-excel";case"xlm":return"application/vnd.ms-excel";case"xls":return"application/vnd.ms-excel";case"xlsb":return"application/vnd.ms-excel.sheet.binary.macroenabled.12";case"xlsm":return"application/vnd.ms-excel.sheet.macroenabled.12";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xlt":return"application/vnd.ms-excel";case"xltm":return"application/vnd.ms-excel.template.macroenabled.12";case"xltx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.template";case"xlw":return"application/vnd.ms-excel";case"xml":return"text/xml";case"xmta":return"application/xml";case"xof":return"x-world/x-vrml";case"xoml":return"text/plain";case"xpm":return"image/x-xpixmap";case"xps":return"application/vnd.ms-xpsdocument";case"xrm-ms":return"text/xml";case"xsc":return"application/xml";case"xsd":return"text/xml";case"xsf":return"text/xml";case"xsl":return"text/xml";case"xslt":return"text/xml";case"xsn":return"application/octet-stream";case"xss":return"application/xml";case"xtp":return"application/octet-stream";case"xwd":return"image/x-xwindowdump";case"z":return"application/x-compress";case"zip":return"application/x-zip-compressed";default:return"application/octet-stream"}}}}});Bridge.define("Core.Extensions.ValidationExtensions",{statics:{methods:{IsUnique:function(n,t,i,r){var f=0,e,h,o=new System.Threading.Tasks.TaskCompletionSource,s,u,c,l,a,v=Bridge.fn.bind(this,function(){try{for(;;){f=System.Array.min([0,1],f);switch(f){case 0:if(r===void 0&&(r=null),s="Id",r==null&&(r=System.String.format("Active eq true and {0} eq '{1}' and Id ne {2}",i,Core.Extensions.BridgeExt.GetPropValue(t,i),Bridge.box(Bridge.unbox(t.Id),System.Int32))),e=new Core.Clients.Client.$ctor1(Bridge.Reflection.getTypeName(n)).GetAsync$1(Core.Models.OdataResult$1(n),System.String.format("?$select={0},{1}&$filter={2}",s,i,r)),f=1,e.isCompleted())continue;e["continue"](v);return;case 1:h=e.getAwaitedResult();u=h;o.setResult(System.Nullable.eq(u!=null&&(c=u.Value)!=null?c.Count:null,0)||System.Nullable.eq(u!=null&&(l=u.Value)!=null?l.Count:null,1)&&Bridge.referenceEquals(t[s],System.Linq.Enumerable.from(u.Value,n).first()[s]));return;default:o.setResult(null);return}}}catch(y){a=System.Exception.create(y);o.setException(a)}},arguments);return v(),o.task}}}});Bridge.define("Core.Extensions.ValidationRule",{statics:{fields:{Required:null,MinLength:null,CheckLength:null,MaxLength:null,GreaterThanOrEqual:null,LessThanOrEqual:null,GreaterThan:null,LessThan:null,Equal:null,NotEqual:null,RegEx:null,Unique:null},ctors:{init:function(){this.Required="required";this.MinLength="minLength";this.CheckLength="checkLength";this.MaxLength="maxLength";this.GreaterThanOrEqual="min";this.LessThanOrEqual="max";this.GreaterThan="gt";this.LessThan="lt";this.Equal="eq";this.NotEqual="ne";this.RegEx="regEx";this.Unique="unique"}}},props:{Rule:null,Message:null,Value1:null,Value2:null,Condition:null,RejectInvalid:!1}});Bridge.define("Core.Fw.User.VendorListVM",{props:{Vendor:null}});Bridge.define("Core.Models.AdvSearchVM",{props:{ActiveState:0,Conditions:null,OrderBy:null},ctors:{ctor:function(){this.$initialize();this.Conditions=new(System.Collections.Generic.List$1(Core.Models.FieldCondition).ctor);this.OrderBy=new(System.Collections.Generic.List$1(Core.Models.OrderBy).ctor)}}});Bridge.define("Core.Models.ApprovalConfig",{props:{Id:0,Level:0,Description:null,UserId:null,RoleId:null,DataSource:null,EntityId:0,WorkflowId:null,MinAmount:System.Decimal(0),MaxAmount:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,RoleLevel:null,IsSameCostCenter:!1,IsSupervisor:!1,CostCenterId:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.Approvement",{props:{Id:0,ReasonOfChange:null,EntityId:null,LevelName:null,RecordId:null,StatusId:null,Amount:System.Decimal(0),UserApproveId:0,IsEnd:!1,NextLevel:null,CurrentLevel:0,Approved:!1,ApprovedBy:null,ApprovedDate:null,RejectBy:null,RejectDate:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.CellSelected",{props:{FieldName:null,FieldText:null,ComponentType:null,Value:null,ValueText:null,Operator:null,OperatorText:null,Logic:null,IsSearch:!1,Group:!1,Shift:!1}});Bridge.define("Core.Models.Component",{props:{Id:0,FieldName:null,Order:null,ComponentType:null,ComponentGroupId:0,DataSourceFilter:null,ReferenceId:null,FormatData:null,FormatEntity:null,PlainText:null,Column:null,Offset:null,Row:null,CanSearch:!1,CanCache:!1,Precision:null,GroupBy:null,GroupFormat:null,Label:null,ShowLabel:!1,Icon:null,ClassName:null,Style:null,ChildStyle:null,HotKey:null,RefClass:null,Events:null,Disabled:!1,Visibility:!1,Hidden:!1,Validation:null,Focus:!1,Width:null,PopulateField:null,CascadeField:null,GroupEvent:null,XsCol:null,SmCol:null,LgCol:null,XlCol:null,XxlCol:null,DefaultVal:null,DateTimeField:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,RoleId:null,IgnoreSync:!1,CanAdd:!1,ShowAudit:!1,IsPrivate:!1,IdField:null,DescFieldName:null,DescValue:null,MonthCount:null,IsDoubleLine:null,Query:null,RefName:null,Headers:null,FormatExSmall:null,FormatSmall:null,FormatMedium:null,FormatLarge:null,FormatExLarge:null,ShowExp:null,ParentId:null,IsRealtime:!1,TopEmpty:!1,IsCollapsible:!1,Template:null,System:null,PreQuery:null,DisabledExp:null,FocusSearch:!1,IsSumary:!1,FormatSumaryField:null,OrderBySumary:null,ShowHotKey:!1,DefaultAddStart:null,DefaultAddEnd:null,UpperCase:!1,VirtualScroll:!1,Migration:null,ListClass:null,ExcelFieldName:null,LiteGrid:null,ShowDatetimeField:null,ShowNull:null,AddDate:null,FilterEq:!1,HeaderHeight:null,BodyItemHeight:null,FooterHeight:null,ScrollHeight:null,ComponentGroup:null,Reference:null,EntityRef:null,TextAlignEnum:null,IsPivot:!1,AutoFit:!1,MaxWidth:null,PostOrder:0,LocalData:null,LocalHeader:null,StatusBar:!1,SimpleText:!1,MinWidth:null,DataSourceOptimized:null,LocalRender:!1,IgnoreConfirmHardDelete:!1,Editable:!1,Frozen:!1},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()},ctor:function(){this.$initialize();this.EntityRef=new(System.Collections.Generic.HashSet$1(Core.Models.EntityRef).ctor)}}});Bridge.define("Core.Models.ComponentGroup",{props:{Id:0,FeatureId:0,Name:null,Label:null,Description:null,ClassName:null,IsTab:!1,TabGroup:null,IsVertialTab:!1,Responsive:!1,Events:null,Width:null,Style:null,Column:0,Row:0,PolicyId:null,Hidden:!1,ParentId:null,Order:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,Disabled:!1,XsCol:null,SmCol:null,LgCol:null,XlCol:null,XxlCol:null,OuterColumn:null,XsOuterColumn:null,SmOuterColumn:null,LgOuterColumn:null,XlOuterColumn:null,XxlOuterColumn:null,RoleId:null,Icon:null,IgnoreSync:!1,IsPrivate:!1,BadgeMonth:null,IsCollapsible:null,ShowExp:null,DisabledExp:null,IsDropDown:!1,Feature:null,Parent:null,Component:null,InverseParent:null,ItemInRow:0},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()},ctor:function(){this.$initialize();this.Component=new(System.Collections.Generic.HashSet$1(Core.Models.Component).ctor);this.InverseParent=new(System.Collections.Generic.HashSet$1(Core.Models.ComponentGroup).ctor)}}});Bridge.define("Core.Models.Dictionary",{props:{Id:0,LangCode:null,Key:null,Value:null,Active:!1,InsertedBy:0,InsertedDate:null,UpdatedBy:null,UpdatedDate:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.Entity",{props:{Id:0,Name:null,Description:null,AliasFor:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,RefDetailClass:null,RefListClass:null,Namespace:null,Component:null,Feature:null,GridPolicyEntity:null,GridPolicyReference:null,TaskNotification:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()},ctor:function(){this.$initialize();this.Component=new(System.Collections.Generic.HashSet$1(Core.Models.Component).ctor);this.Feature=new(System.Collections.Generic.HashSet$1(Core.Models.Feature).ctor);this.GridPolicyEntity=new(System.Collections.Generic.HashSet$1(Core.Models.GridPolicy).ctor);this.GridPolicyReference=new(System.Collections.Generic.HashSet$1(Core.Models.GridPolicy).ctor);this.TaskNotification=new(System.Collections.Generic.HashSet$1(Core.Models.TaskNotification).ctor)}},methods:{GetEntityType:function(n){var t,i,r,u;return n===void 0&&(n=null),u=(t=this.AliasFor,t!=null?t:this.Name),Bridge.Reflection.getType(((i=n,i!=null?i:(r=this.Namespace,r!=null?r:Core.Clients.Client.ModelNamespace))||"")+(u||""))}}});Bridge.define("Core.Models.EntityRef",{props:{Id:0,ComId:null,HeaderId:null,SectionId:null,TargetComId:null,TargetFieldName:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,MenuText:null,ViewClass:null,FieldName:null,FeatureId:null,Com:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.Feature",{props:{Id:0,Name:null,Label:null,ParentId:null,Order:null,ClassName:null,Style:null,StyleSheet:null,Script:null,Events:null,Icon:null,IsDevider:!1,IsGroup:!1,IsMenu:!1,IsPublic:!1,StartUp:!1,ViewClass:null,EntityId:null,Description:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,IsSystem:!1,IgnoreEncode:!1,RequireJS:null,GuiInfo:null,RoleId:0,IsPermissionInherited:!1,FeatureGroup:null,InheritParentFeature:!1,Properties:null,Template:null,LayoutId:null,DataSource:null,Gallery:null,Entity:null,Parent:null,ComponentGroup:null,FeaturePolicy:null,GridPolicy:null,InverseParent:null,Component:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()},ctor:function(){this.$initialize();this.ComponentGroup=new(System.Collections.Generic.HashSet$1(Core.Models.ComponentGroup).ctor);this.FeaturePolicy=new(System.Collections.Generic.HashSet$1(Core.Models.FeaturePolicy).ctor);this.GridPolicy=new(System.Collections.Generic.HashSet$1(Core.Models.GridPolicy).ctor);this.InverseParent=new(System.Collections.Generic.HashSet$1(Core.Models.Feature).ctor)}}});Bridge.define("Core.Models.FeaturePolicy",{props:{Id:0,FeatureId:null,RoleId:null,CanRead:!1,CanWrite:!1,CanDelete:!1,CanDeleteAll:!1,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,CanDeactivate:!1,LockDeleteAfterCreated:null,LockUpdateAfterCreated:null,EntityId:null,RecordId:0,UserId:null,CanShare:!1,Desc:null,CanWriteAll:!1,Feature:null,Role:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.FieldCondition",{props:{Id:0,FieldId:0,Field:null,CompareOperatorId:null,Value:null,LogicOperatorId:null,LogicOperator:null,Level:0,Group:!1}});Bridge.define("Core.Models.GridPolicy",{props:{Id:0,UniqueId:null,FeatureId:null,EntityId:0,FieldName:null,Order:null,GroupOrder:null,ShortDesc:null,Description:null,IsPivot:!1,ReferenceId:null,FilterTemplate:null,RefClass:null,DataSource:null,GroupName:null,FormatCell:null,FormatRow:null,PlainText:null,Width:null,MinWidth:null,MaxWidth:null,Precision:null,Validation:null,TextAlign:null,Frozen:!1,Hidden:!1,Events:null,ClassName:null,Style:null,ChildStyle:null,Icon:null,AdvancedSearch:!1,HasFilter:!1,Editable:!1,Disabled:!1,ComponentType:null,PopulateField:null,CascadeField:null,Summary:null,SummaryColSpan:null,ComponentId:null,DefaultVal:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,RoleId:null,IgnoreSync:!1,AutoFit:!1,IsPrivate:!1,BasicSearch:!1,FormatExcell:null,Query:null,RefName:null,DisabledExp:null,FocusSearch:!1,Template:null,System:null,UpperCase:null,VirtualScroll:null,DisplayNone:!1,Migration:null,ListClass:null,IsExport:!1,OrderExport:null,IsRealtime:!1,GroupBy:null,GroupFormat:null,IsSumary:null,ExcelFieldName:null,Row:null,FilterEq:!1,DatabaseName:null,AddDate:!1,Entity:null,Feature:null,Reference:null,DataSourceOptimized:null,Sum:null,SimpleText:!1,StatusBar:!1,TextAlignEnum:null,PostOrder:0,LocalData:null,LocalHeader:null,LocalRender:!1,IgnoreConfirmHardDelete:!1},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.History",{props:{Id:System.Int64(0),TanentCode:null,EntityId:0,RecordId:0,ReasonOfChange:null,JsonHistory:null,TextHistory:null,ValueText:null,OldValueText:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.Images",{props:{Id:0,Name:null,Size:null,Url:null,IsAvatar:!1,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.MasterData",{props:{Id:0,Name:null,Description:null,ParentId:null,Path:null,Additional:null,Order:null,Enum:null,Level:0,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,InterDesc:null,CostCenterId:null,Code:null,Parent:null,InverseParent:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()},ctor:function(){this.$initialize();this.InverseParent=new(System.Collections.Generic.HashSet$1(Core.Models.MasterData).ctor)}}});Bridge.define("Core.Models.Odata",{props:{Count:null}});Bridge.define("Core.Models.OdataResult$1",function(n){return{props:{Odata:null,Value:null,Query:null,Sql:null},ctors:{ctor:function(){this.$initialize();this.Odata=new Core.Models.Odata;this.Value=new(System.Collections.Generic.List$1(n).ctor)}}}});Bridge.define("Core.Models.OrderBy",{props:{Id:0,FieldId:0,Field:null,OrderbyOptionId:null}});Bridge.define("Core.Models.Role",{props:{Id:0,VendorId:null,RoleName:null,Description:null,ParentRoleId:null,CostCenterId:null,Level:0,Path:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,AccRoleId:null,ParentRole:null,FeaturePolicy:null,InverseParentRole:null,TaskNotification:null,UserRole:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()},ctor:function(){this.$initialize();this.FeaturePolicy=new(System.Collections.Generic.HashSet$1(Core.Models.FeaturePolicy).ctor);this.InverseParentRole=new(System.Collections.Generic.HashSet$1(Core.Models.Role).ctor);this.TaskNotification=new(System.Collections.Generic.HashSet$1(Core.Models.TaskNotification).ctor);this.UserRole=new(System.Collections.Generic.HashSet$1(Core.Models.UserRole).ctor)}}});Bridge.define("Core.Models.SocketResponse",{props:{EntityId:0,TypeId:0,Data:null},ctors:{init:function(){this.TypeId=1}}});Bridge.define("Core.Models.TaskNotification",{props:{Id:0,Title:null,Description:null,EntityId:null,RecordId:null,Deadline:null,StatusId:null,Attachment:null,AssignedId:null,RoleId:null,TimeConsumed:System.Decimal(0),TimeRemained:System.Decimal(0),Progress:System.Decimal(0),RemindBefore:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,Badge:null,Entity:null,Role:null},ctors:{init:function(){this.Deadline=System.DateTime.getDefaultValue();this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.User",{props:{Id:0,VendorId:0,FirstName:null,LastName:null,MiddleName:null,FullName:null,IsInternal:!1,DoB:null,Ssn:null,Passport:null,Address:null,Address2:null,PhoneNumber:null,PhoneNumber2:null,NationalityId:null,ContractId:null,BankId:null,BankBranchId:null,BankAccountNo:null,BankAccountName:null,DepartmentId:null,Avatar:null,SupervisorId:null,Password:null,UserName:null,Salt:null,LoginFailedCount:null,LastLogin:null,LastFailedLogin:null,Email:null,GenderId:0,Recover:null,Reported:!1,HasVerifiedEmail:!1,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,CreatedRoleId:null,CostCenterId:null,TeamId:null,ContactId:null,StateId:null,Supervisor:null,Vendor:null,InverseSupervisor:null,UserRole:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()},ctor:function(){this.$initialize();this.InverseSupervisor=new(System.Collections.Generic.HashSet$1(Core.Models.User).ctor);this.UserRole=new(System.Collections.Generic.HashSet$1(Core.Models.UserRole).ctor)}}});Bridge.define("Core.Models.UserLogin",{props:{Id:0,UserId:0,IpAddress:null,SignInDate:null,RefreshToken:null,ExpiredDate:null}});Bridge.define("Core.Models.UserRole",{props:{Id:0,UserId:0,RoleId:0,Active:!1,EffectiveDate:null,ExpiredDate:null,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,Role:null,User:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.UserSeq",{props:{Id:0,EntityId:0,IsMonthlyRecycle:!1,LastKey:0,Active:!1,InsertedBy:0,InsertedDate:null,UpdatedBy:null,UpdatedDate:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.UserSetting",{props:{Id:0,RoleId:null,UserId:null,Name:null,Value:null,ParentId:null,Path:null,Description:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,Role:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}},methods:{ToDictionary:function(){throw new System.NotImplementedException.ctor;}}});Bridge.define("Core.Models.Vendor",{props:{Id:0,VendorTypeId:null,Description:null,Avatar:null,CustomerGroupId:null,SaleId:0,UserId:null,CustomerStateId:null,LastContactDate:null,IsSelf:!1,IsInternal:!1,PhoneNumber:null,PhoneNumber2:null,Address:null,Address2:null,Note:null,Email:null,Fax:null,Skype:null,Zalo:null,Viber:null,OtherContact:null,TaxCode:null,CompanyLocalShortName:null,CompanyInterShortName:null,CompanyLocalFullName:null,CompanyInterFullName:null,CompanyLocalAddress:null,CompanyInterAddress:null,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,RoleId:null,IsTenant:!1,ParentId:null,TenantId:null,ConStr:null,NationalityId:null,SeqKey:null,DebtCountFinished:!1,DebtDate:null,DebtDateTypeId:null,DebtExportDate:null,OwnerId:null,CollectOnBehalfDay:null,GlobalId:null,PartnerId:null,StateId:null,LastOrderState:null,IsSeft:!1,Parent:null,Tenant:null,InverseParent:null,InverseTenant:null,User:null,VendorBranch:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()},ctor:function(){this.$initialize();this.InverseParent=new(System.Collections.Generic.HashSet$1(Core.Models.Vendor).ctor);this.InverseTenant=new(System.Collections.Generic.HashSet$1(Core.Models.Vendor).ctor);this.User=new(System.Collections.Generic.HashSet$1(Core.Models.User).ctor);this.VendorBranch=new(System.Collections.Generic.HashSet$1(Core.Models.VendorBranch).ctor)}}});Bridge.define("Core.Models.VendorBranch",{props:{Id:0,CustomerId:null,VendorId:null,RegionId:null,Address:null,PhoneNumber:null,InsertedDate:null,InsertedBy:null,UpdatedDate:null,UpdatedBy:null,Active:!1,Name:null,Description:null,TaxCode:null,ParentId:null,Path:null,Level:null,Parent:null,Vendor:null,InverseParent:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()},ctor:function(){this.$initialize();this.InverseParent=new(System.Collections.Generic.HashSet$1(Core.Models.VendorBranch).ctor)}}});Bridge.define("Core.Models.Webhook",{props:{Id:0,EntityId:null,SubName:null,SubUrl:null,SubUsername:null,SubPassword:null,AuthVersionId:0,Active:!1,InsertedDate:null,InsertedBy:0,UpdatedDate:null,UpdatedBy:null,EventTypeId:0,Method:null,ApiKey:null,ApiKeyHeader:null,LoginUrl:null,UsernameKey:null,PasswordKey:null,AccessTokenField:null,TokenPrefix:null,SavedToken:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.Models.WebSocketResponse$1",function(n){return{props:{EntityId:0,Data:Bridge.getDefaultValue(n),DataList:null}}});Bridge.define("Core.Models.Where",{props:{FieldName:null,Group:!1}});Bridge.define("Core.MVVM.ElementType",{$kind:"enum",statics:{fields:{a:0,abbr:1,address:2,area:3,article:4,aside:5,audio:6,b:7,base:8,bdi:9,bdo:10,blockquote:11,button:12,canvas:13,caption:14,cite:15,code:16,col:17,colgroup:18,datalist:19,dd:20,del:21,details:22,dfn:23,div:24,dl:25,dt:26,em:27,embed:28,fieldset:29,figcaption:30,figure:31,footer:32,form:33,h1:34,h2:35,h3:36,h4:37,h5:38,h6:39,head:40,header:41,i:42,iframe:43,img:44,input:45,ins:46,kbd:47,keygen:48,label:49,legend:50,li:51,link:52,main:53,map:54,mark:55,menu:56,menuitem:57,meta:58,meter:59,nav:60,object:61,ol:62,ptgroup:63,option:64,output:65,p:66,param:67,pre:68,progress:69,q:70,rp:71,rt:72,ruby:73,s:74,samp:75,script:76,section:77,select:78,small:79,source:80,span:81,strong:82,style:83,sub:84,summary:85,sup:86,table:87,tbody:88,td:89,textarea:90,tfoot:91,th:92,thead:93,time:94,title:95,tr:96,track:97,u:98,ul:99,"var":100,video:101}}});Bridge.define("Core.MVVM.Html",{statics:{fields:{_instance:null},props:{Context:null,Instance:{get:function(){return Core.MVVM.Html._instance==null&&(Core.MVVM.Html._instance=new Core.MVVM.Html.ctor),Core.MVVM.Html._instance}}},methods:{Take$1:function(n){return Core.MVVM.Html.Context=Bridge.as(document.querySelector(n),HTMLElement),Core.MVVM.Html.Instance},Take:function(n){return Core.MVVM.Html.Context=n,Core.MVVM.Html.Instance},SetObservableValue:function(n,t,i){t.Data=System.String.isNullOrEmpty(i)?Bridge.getDefaultValue(n):Bridge.cast(Bridge.unbox(System.Convert.changeType(i,n),n),n)},SwapElement:function(n,t,i,r){var u=t.getItem(i);t.setItem(i,t.getItem(r));t.setItem(r,u)}}},props:{Div:{get:function(){return this.Add(Core.MVVM.ElementType.div)}},Link:{get:function(){return this.Add(Core.MVVM.ElementType.link)}},Script:{get:function(){return this.Add(Core.MVVM.ElementType.script)}},Header:{get:function(){return this.Add(Core.MVVM.ElementType.header)}},Section:{get:function(){return this.Add(Core.MVVM.ElementType.section)}},Canvas:{get:function(){return this.Add(Core.MVVM.ElementType.canvas)}},Video:{get:function(){return this.Add(Core.MVVM.ElementType.video)}},Audio:{get:function(){return this.Add(Core.MVVM.ElementType.audio)}},H1:{get:function(){return this.Add(Core.MVVM.ElementType.h1)}},H2:{get:function(){return this.Add(Core.MVVM.ElementType.h2)}},H3:{get:function(){return this.Add(Core.MVVM.ElementType.h3)}},H4:{get:function(){return this.Add(Core.MVVM.ElementType.h4)}},H5:{get:function(){return this.Add(Core.MVVM.ElementType.h5)}},H6:{get:function(){return this.Add(Core.MVVM.ElementType.h6)}},Nav:{get:function(){return this.Add(Core.MVVM.ElementType.nav)}},Input:{get:function(){return this.Add(Core.MVVM.ElementType.input)}},Select:{get:function(){return this.Add(Core.MVVM.ElementType.select)}},Option:{get:function(){return this.Add(Core.MVVM.ElementType.option)}},Span:{get:function(){return this.Add(Core.MVVM.ElementType.span)}},Small:{get:function(){return this.Add(Core.MVVM.ElementType.small)}},I:{get:function(){return this.Add(Core.MVVM.ElementType.i)}},Img:{get:function(){return this.Add(Core.MVVM.ElementType.img)}},Button:{get:function(){return this.Add(Core.MVVM.ElementType.button)}},Table:{get:function(){return this.Add(Core.MVVM.ElementType.table)}},Thead:{get:function(){return this.Add(Core.MVVM.ElementType.thead)}},Th:{get:function(){return this.Add(Core.MVVM.ElementType.th)}},TBody:{get:function(){return this.Add(Core.MVVM.ElementType.tbody)}},TFooter:{get:function(){return this.Add(Core.MVVM.ElementType.tfoot)}},TRow:{get:function(){return this.Add(Core.MVVM.ElementType.tr)}},TData:{get:function(){return this.Add(Core.MVVM.ElementType.td)}},P:{get:function(){return this.Add(Core.MVVM.ElementType.p)}},TextArea:{get:function(){return this.Add(Core.MVVM.ElementType.textarea)}},Br:{get:function(){var n=document.createElement("br");return Core.MVVM.Html.Context.appendChild(n),this}},Hr:{get:function(){var n=document.createElement("hr");return Core.MVVM.Html.Context.appendChild(n),this}},Ul:{get:function(){return this.Add(Core.MVVM.ElementType.ul)}},Li:{get:function(){return this.Add(Core.MVVM.ElementType.li)}},Aside:{get:function(){return this.Add(Core.MVVM.ElementType.aside)}},A:{get:function(){return this.Add(Core.MVVM.ElementType.a)}},Form:{get:function(){return this.Add(Core.MVVM.ElementType.form)}},Label:{get:function(){return this.Add(Core.MVVM.ElementType.label)}},End:{get:function(){return Core.MVVM.Html.Context=Core.MVVM.Html.Context.parentElement,this}}},ctors:{$ctor2:function(n){this.$initialize();Core.MVVM.Html.Context=Bridge.as(document.querySelector(n),HTMLElement)},ctor:function(){this.$initialize()},$ctor1:function(n){this.$initialize();Core.MVVM.Html.Context=n}},methods:{GetContext:function(){return Core.MVVM.Html.Context},EndOf:function(n){return this.EndOf$1(System.Enum.toString(Core.MVVM.ElementType,n))},EndOf$1:function(n){for(var t=Core.MVVM.Html.Context;t!=null;)if(t.querySelector(n)!=null)break;else t=t.parentElement;return Core.MVVM.Html.Context=t||function(){throw new System.InvalidOperationException.$ctor1("Cannot find the element of selector "+(n||""));}(),this},Closest:function(n){var t=Core.MVVM.Html.Context.closest;return Core.MVVM.Html.Context=Bridge.cast(t.call(Core.MVVM.Html.Context,System.Enum.toString(Core.MVVM.ElementType,n)),HTMLElement),this},Render$1:function(n){Core.MVVM.Html.Context.innerHTML=n},Render:function(){},Add:function(n){var t=document.createElement(System.Enum.toString(Core.MVVM.ElementType,n));return Core.MVVM.Html.Context.appendChild(t),Core.MVVM.Html.Context=t,this},Id:function(n){return Core.MVVM.Html.Context.id=n,this},Style$1:function(n){var t;return System.String.isNullOrWhiteSpace(n)?this:((t=Core.MVVM.Html.Context.style).cssText=(t.cssText||"")+(n||""),this)},Style:function(n){var t,i;t=Bridge.getEnumerator(Object.getOwnPropertyNames(Bridge.unbox(n)));try{while(t.moveNext())i=t.Current,Core.MVVM.Html.Context.style[i]=n[i]}finally{Bridge.is(t,System.IDisposable)&&t.System$IDisposable$Dispose()}return this},Clear:function(){return Core.MVVM.Html.Context!=null&&(Core.MVVM.Html.Context.textContent="",Core.MVVM.Html.Context.innerHTML=""),this},If:function(n,t,i){return i===void 0&&(i=null),n?t():i(),this},Checkbox:function(n){var t,i;return this.Add(Core.MVVM.ElementType.input),i=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement),i.setAttribute("type","checkbox"),i.checked=(t=n,t!=null?t:!1),this.Event$1("change",function(t){n=Bridge.as(t.target,HTMLInputElement).checked}),this.Event$1("click",function(t){n=Bridge.as(t.target,HTMLInputElement).checked}),this},Value:function(n){var t=Core.MVVM.Html.Context;return t.value=n,this},Value$1:function(n,t){var r,i=Core.MVVM.Html.Context;return i!=null&&(i.value=(r=t.Data)!=null?Bridge.toString(r):null,this.Event$1("input",function(){var r;Core.MVVM.Html.SetObservableValue(n,t,(r=i.value)!=null?Bridge.toString(r):null)}),t.addChanged(function(n){i.value=n.NewData!=null?Bridge.toString(n.NewData):""})),this},Attr$1:function(n,t){return Core.MVVM.Html.Context.setAttribute(n,t),this},Attr:function(n,t){return Core.MVVM.Html.Context.setAttribute(n,Bridge.toString(t)),this},DataAttr$1:function(n,t){return Core.MVVM.Html.Context.setAttribute("data-"+(n||""),t),this},DataAttr:function(n,t){return Core.MVVM.Html.Context.setAttribute("data-"+(n||""),Bridge.toString(t)),this},Type$1:function(n){return Core.MVVM.Html.Context.setAttribute("type",n),this},Type:function(n){return Core.MVVM.Html.Context.setAttribute("type",System.Enum.toString(System.String,n)),this},Href:function(n){return Core.MVVM.Html.Context.setAttribute("href",n),this},Src:function(n){return Core.MVVM.Html.Context.setAttribute("src",n),this},Text:function(n){if(System.String.isNullOrEmpty(n))return this;var t=document.createTextNode(n);return Core.MVVM.Html.Context.appendChild(t),this},Text$1:function(n,t){var i=document.createTextNode(Bridge.toString(t.Data));return t.addChanged(function(n){var t;i.textContent=(t=n.NewData)!=null?Bridge.toString(t):null}),Core.MVVM.Html.Context.appendChild(i),this},InnerHTML:function(n){return Core.MVVM.Html.Context.innerHTML=n,this},Number:function(n){var t=document.createTextNode(System.String.format("{0:n0}",[Bridge.box(n.Data,System.Int32)]));return n.addChanged(function(n){t.textContent=System.String.format("{0:n0}",[Bridge.box(n.NewData,System.Int32)])}),Core.MVVM.Html.Context.appendChild(t),this},Event:function(n,t){return Core.MVVM.Html.Context.addEventListener(n,t),this},Event$1:function(n,t){return Core.MVVM.Html.Context.addEventListener(n,t),this},Event$4:function(n,t,i,r){return Core.MVVM.Html.Context.addEventListener(t,function(n){i(n,r)}),this},Event$2:function(n,t,i,r){return Core.MVVM.Html.Context.addEventListener(t,function(){i(r)}),this},Event$3:function(n,t,i,r){return Core.MVVM.Html.Context.addEventListener(t,function(n){i(r,n)}),this},AsyncEvent$2:function(n,t,i,r){return Core.MVVM.Html.Context.addEventListener(t,Bridge.fn.bind(this,function(){var n=0,t,u=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=i(r),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);u()})),this},AsyncEvent$3:function(n,t,i,r){return Core.MVVM.Html.Context.addEventListener(t,Bridge.fn.bind(this,function(n){var t=0,u,f=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(u=i(r,n),t=1,u.isCompleted())continue;u["continue"](f);return;case 1:u.getAwaitedResult();return;default:return}}},arguments);f()})),this},AsyncEvent:function(n,t){return Core.MVVM.Html.Context.addEventListener(n,Bridge.fn.bind(this,function(){var n=0,i,r=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(i=t(),n=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()})),this},AsyncEvent$1:function(n,t){return Core.MVVM.Html.Context.addEventListener(n,Bridge.fn.bind(this,function(n){var i=0,r,u=Bridge.fn.bind(this,function(){for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(r=t(n),i=1,r.isCompleted())continue;r["continue"](u);return;case 1:r.getAwaitedResult();return;default:return}}},arguments);u()})),this},Trigger:function(n){var t=new Event(System.Enum.toString(System.String,n),{});return Core.MVVM.Html.Context.dispatchEvent(t),this},ClearContextContent:function(){Core.MVVM.Html.Context.innerHTML=""},ForEach$2:function(n,t,i){if(t==null)throw new System.ArgumentNullException.$ctor1("list");for(var r=Core.MVVM.Html.Context,e=System.Linq.Enumerable.from(t,n).count(),u=-1,f=Bridge.getEnumerator(t,n);(u=u+1|0)<e;)Core.MVVM.Html.Context=r,f.System$Collections$IEnumerator$moveNext(),i.call(r,f[Bridge.geti(f,"System$Collections$Generic$IEnumerator$1$"+Bridge.getTypeAlias(n)+"$Current$1","System$Collections$Generic$IEnumerator$1$Current$1")],Bridge.box(u,System.Int32));return Core.MVVM.Html.Context=r,this},ForEach$1:function(n,t,i){if(t==null)throw new System.ArgumentNullException.$ctor1("list");for(var r=Core.MVVM.Html.Context,e=System.Linq.Enumerable.from(t,n).count(),u=-1,f=Bridge.getEnumerator(t,n);(u=u+1|0)<e;)Core.MVVM.Html.Context=r,f.System$Collections$IEnumerator$moveNext(),i.call(r,f[Bridge.geti(f,"System$Collections$Generic$IEnumerator$1$"+Bridge.getTypeAlias(n)+"$Current$1","System$Collections$Generic$IEnumerator$1$Current$1")],Bridge.box(u,System.Int32));return Core.MVVM.Html.Context=r,this},ForEach:function(n,t,i){if(t==null)throw new System.ArgumentNullException.$ctor1("observableArray");for(var u=Core.MVVM.Html.Context,f=t.Data,e=f.Count,r=-1;(r=r+1|0)<e;)Core.MVVM.Html.Context=u,i(f.getItem(r),r);return t.ListChanged=Bridge.fn.combine(t.ListChanged,Bridge.fn.bind(this,function(r){var f;r.Element=u;r.Renderer=i;r.Action=(f=r.Action,f!=null?f:Core.MVVM.ObservableAction.Render);this.Update(n,r,t)})),this},Update:function(n,t,i){var r,o,u,f,s,c,h,l,e;Core.MVVM.Html.Context=t.Element;switch(t.Action){case Core.MVVM.ObservableAction.Add:if(i.Data.insert(t.Index,t.Item),t.Index===(t.ListData.Count-1|0)){t.Renderer.call(t.Element,t.Item,Bridge.box(t.Index,System.Int32));return}o=document.createElement("div");Core.MVVM.Html.Context=o;t.Renderer.call(o,t.Item,Bridge.box(t.Index,System.Int32));this.AppendChildList(t.Element,o,t.Index);break;case Core.MVVM.ObservableAction.Remove:i.Data.remove(t.Item);r=Bridge.Int.div(t.Element.children.length,t.ListData.Count+1|0)|0;this.RemoveChildList(t.Element,t.Index,r);break;case Core.MVVM.ObservableAction.Move:if(r=Bridge.Int.div(t.Element.children.length,t.ListData.Count)|0,u=t.Index,f=t.ListData.indexOf(t.Item),u===f)return;for(Core.MVVM.Html.SwapElement(n,i.Data,u,f),s=Bridge.Int.mul(f,r),c=f<u?t.Element.children[Bridge.Int.mul(u+1|0,r)]:t.Element.children[Bridge.Int.mul(u,r)],h=0;h<r;h=h+1|0)t.Element.insertBefore(t.Element.children[s],c),f>u&&(s=s+1|0);break;case Core.MVVM.ObservableAction.Render:for(this.ClearContextContent(),l=t.ListData.Count,e=-1;(e=e+1|0)<l;)Core.MVVM.Html.Context=t.Element,t.Renderer.call(t.Element,t.ListData.getItem(e),Bridge.box(e,System.Int32))}},AppendChildList:function(n,t,i){i=Bridge.Int.mul(i,t.children.length);for(var r=n.children[i];t.children.length>0;)n.insertBefore(t.children[0],r)},RemoveChildList:function(n,t,i){for(var u=Bridge.Int.mul(t,i),r=0;r<i&&n.children.length>0;r=r+1|0)n.removeChild(n.children[u])},Dropdown$1:function(n,t,i,r,u){r===void 0&&(r=null);u===void 0&&(u=null);Bridge.referenceEquals(Core.MVVM.Html.Context.nodeName.toLowerCase(),"select")||this.Select.Render();var f=Bridge.as(Core.MVVM.Html.Context,HTMLSelectElement);return t.ForEach(Bridge.fn.bind(this,function(n){var t,i,f=r==null?Bridge.toString(n):(t=n[r])!=null?Bridge.toString(t):null,e=u==null?Bridge.toString(n):(i=n[u])!=null?Bridge.toString(i):null;this.Option.Text(f).Value(e).End.Render()})),f.selectedIndex=this.GetSelectedIndex(n,t,i,u),this},Dropdown:function(n,t,i,r,u){var e,f;return Bridge.referenceEquals(Core.MVVM.Html.Context.nodeName.toLowerCase(),"select")||this.Select.Render(),f=Bridge.as(Core.MVVM.Html.Context,HTMLSelectElement),this.ForEach(n,t,Bridge.fn.bind(this,function(n){var t,i,f=(t=n[r])!=null?Bridge.toString(t):null,e=(i=n[u])!=null?Bridge.toString(i):null;this.Option.Text(f).Value(e).End.Render()})),f.selectedIndex=this.GetSelectedIndex(n,(e=n,System.Linq.Enumerable.from(t.Data,e).toList(e)),i.Data,u),t.ListChanged=Bridge.fn.combine(t.ListChanged,Bridge.fn.bind(this,function(t){var r;f.selectedIndex=this.GetSelectedIndex(n,(r=n,System.Linq.Enumerable.from(t.ListData,r).toList(r)),i.Data,u)})),this.Event("change",function(){var n=t.Data.getItem(f.selectedIndex);i.Data=n}),i.addChanged(Bridge.fn.bind(this,function(i){var r;f.selectedIndex=this.GetSelectedIndex(n,(r=n,System.Linq.Enumerable.from(t.Data,r).toList(r)),i.NewData,u)})),this},GetSelectedIndex:function(n,t,i,r){var u,f,e;return i==null?-1:(u=t.ToArray(),f=System.Array.indexOfT(u,i),Bridge.referenceEquals(r,"")||(e=System.Array.find(n,u,function(n){return Bridge.referenceEquals(n[r],i[r])}),f=System.Array.indexOfT(u,e)),f)},Visibility$1:function(n){var t=Core.MVVM.Html.Context;return t.style.visibility=n?"":System.Enum.toString(System.String,"hidden"),this},Visibility:function(n){var t=Core.MVVM.Html.Context;return t.style.visibility=n.Data?"":System.Enum.toString(System.String,"hidden"),n.addChanged(function(n){t.style.visibility=n.NewData?"":System.Enum.toString(System.String,"hidden")}),this},Display$1:function(n){var t=Core.MVVM.Html.Context;return t.style.display=n?"":System.Enum.toString(System.String,"none"),this},Display:function(n){var t=Core.MVVM.Html.Context;return t.style.display=n.Data?"":System.Enum.toString(System.String,"none"),n.addChanged(function(n){t.style.display=n.NewData?"":System.Enum.toString(System.String,"none")}),this}}});Bridge.define("Core.MVVM.Observable$1",function(n){return{fields:{Getter:null,Setter:null,_data:Bridge.getDefaultValue(n)},events:{Changed:null},props:{Data:{get:function(){return Bridge.staticEquals(this.Getter,null)?this._data:this.Getter()},set:function(t){var i,r;Bridge.equals(this._data,t)||(r=this._data,this._data=t,Bridge.staticEquals(this.Changed,null)?null:this.Changed((i=new(Core.MVVM.ObservableArgs$1(n)),i.NewData=this._data,i.OldData=r,i)),Bridge.staticEquals(this.Setter,null)||this.Setter(this._data))}}},ctors:{ctor:function(){this.$initialize();this._data=Bridge.getDefaultValue(n)},$ctor1:function(n){this.$initialize();this._data=n}}}});Bridge.define("Core.MVVM.ObservableAction",{$kind:"enum",statics:{fields:{Render:0,Add:1,AddRange:2,Update:3,Remove:4,Move:5}}});Bridge.define("Core.MVVM.ObservableArgs",{props:{EvType:"abort",NewData:null,OldData:null,NewMatch:null,OldMatch:null,NewEntity:null,OldEntity:null,FieldName:null}});Bridge.define("Core.MVVM.ObservableArgs$1",function(n){return{props:{NewData:Bridge.getDefaultValue(n),OldData:Bridge.getDefaultValue(n)}}});Bridge.define("Core.MVVM.ObservableList$1",function(n){return{fields:{_data:null,ListChanged:null},props:{Data:{get:function(){return this._data},set:function(t){var i;this._data=t;Bridge.staticEquals(this.ListChanged,null)?null:this.ListChanged((i=new(Core.MVVM.ObservableListArgs$1(n)),i.ListData=this._data,i.Action=Core.MVVM.ObservableAction.Render,i))}}},ctors:{ctor:function(){this.$initialize();this._data=new(System.Collections.Generic.List$1(n).ctor)},$ctor1:function(n){this.$initialize();this._data=n}},methods:{NotifyArrayChanged:function(n){Bridge.staticEquals(this.ListChanged,null)?null:this.ListChanged(n)},Add:function(t,i){var r,u;i===void 0&&(i=null);Bridge.staticEquals(this.ListChanged,null)?null:this.ListChanged((r=new(Core.MVVM.ObservableListArgs$1(n)),r.ListData=this._data,r.Item=t,r.Index=(u=i,u!=null?u:this._data.Count),r.Action=Core.MVVM.ObservableAction.Add,r))},Remove:function(t){var i;Bridge.staticEquals(this.ListChanged,null)?null:this.ListChanged((i=new(Core.MVVM.ObservableListArgs$1(n)),i.ListData=this.Data,i.Item=t,i.Action=Core.MVVM.ObservableAction.Remove,i))},RemoveAt:function(t){var i,r;t<0||(r=System.Linq.Enumerable.from(this._data,n).elementAt(t),Bridge.staticEquals(this.ListChanged,null)?null:this.ListChanged((i=new(Core.MVVM.ObservableListArgs$1(n)),i.ListData=this._data,i.Item=r,i.Index=t,i.Action=Core.MVVM.ObservableAction.Remove,i)))},Update:function(t,i){var r;Bridge.staticEquals(this.ListChanged,null)?null:this.ListChanged((r=new(Core.MVVM.ObservableListArgs$1(n)),r.ListData=this._data,r.Item=t,r.Index=i,r.Action=Core.MVVM.ObservableAction.Update,r))}}}});Bridge.define("Core.MVVM.ObservableListArgs$1",function(n){return{props:{ListData:null,Item:Bridge.getDefaultValue(n),Index:0,Action:null,Element:null,Renderer:null}}});Bridge.define("Core.MVVM.SelectListItem",{props:{Value:null,Display:null}});Bridge.define("Core.ViewModels.ConfigEmailVM",{props:{Server:null,FromAddress:null,Password:null}});Bridge.define("Core.ViewModels.EmailVM",{props:{FromAddress:null,ToAddresses:null,CC:null,BCC:null,Subject:null,Body:null,PdfText:null,FileName:null,Attachements:null},ctors:{init:function(){this.PdfText=new(System.Collections.Generic.List$1(System.String).ctor);this.FileName=new(System.Collections.Generic.List$1(System.String).ctor);this.Attachements=new(System.Collections.Generic.HashSet$1(System.String).ctor)}}});Bridge.define("Core.ViewModels.FileUpload",{props:{Id:0,EntityName:null,RecordId:0,FieldName:null,SectionId:0,FileName:null,FilePath:null,InsertedBy:0,InsertedDate:null,UpdatedBy:0,UpdatedDate:null},ctors:{init:function(){this.InsertedDate=System.DateTime.getDefaultValue()}}});Bridge.define("Core.ViewModels.GPS",{props:{latitude:0,longitude:0}});Bridge.define("Core.ViewModels.LoginVM",{props:{CompanyName:null,UserName:null,Password:null,ClientId:null,AutoSignIn:!1,RecoveryToken:null}});Bridge.define("Core.ViewModels.OwnershipRequest",{props:{EntityType:null,RecordIds:null}});Bridge.define("Core.ViewModels.PatchUpdate",{props:{Changes:null}});Bridge.define("Core.ViewModels.PatchUpdateDetail",{props:{Field:null,OldVal:null,Value:null}});Bridge.define("Core.ViewModels.RefreshVM",{props:{AccessToken:null,RefreshToken:null}});Bridge.define("Core.ViewModels.RegistrationVM",{props:{Email:null,Password:null,ConfirmPassword:null,FullName:null,Address:null,IsVendor:!1,TaxCode:null,LocalShortName:null,LocalFullName:null,InterShortName:null,InterFullName:null}});Bridge.define("Core.ViewModels.SqlQueryResult",{props:{Query:null,Result:null,SqlType:0,Message:null,System:null,ConnectionStr:null}});Bridge.define("Core.ViewModels.SqlResult",{props:{DataSet:null,Status:0,Message:null}});Bridge.define("Core.ViewModels.SqlStatusEnum",{$kind:"enum",statics:{fields:{Success:0,Failed:1}}});Bridge.define("Core.ViewModels.SqlTypeEnum",{$kind:"enum",statics:{fields:{Query:0,Update:1,Mixed:2,Json:3}}});Bridge.define("Core.ViewModels.SqlViewModel",{props:{CmdId:0,CmdType:null,Modules:null,QueryType:0,Entity:null}});Bridge.define("Core.ViewModels.SyncConfigVM",{props:{Component:null,ComponentGroup:null,Feature:null,GridPolicy:null,SyncChildren:!1,VendorId:null}});Bridge.define("Core.ViewModels.Token",{props:{UserId:0,CostCenterId:null,UserName:null,Email:null,FirstName:null,LastName:null,FullName:null,Address:null,Avatar:null,AccessToken:null,RefreshToken:null,AccessTokenExp:null,RefreshTokenExp:null,HashPassword:null,Recovery:null,SysName:null,TenantCode:null,Vendor:null,RoleIds:null,RoleNames:null,AllRoleIds:null,CenterIds:null,Ssn:null,PhoneNumber:null,TeamId:null,PartnerId:null,RegionId:null,Additional:null},ctors:{init:function(){this.AccessTokenExp=System.DateTime.getDefaultValue();this.RefreshTokenExp=System.DateTime.getDefaultValue();this.SysName="TMS"}}});Bridge.define("Core.ViewModels.VendorConnStrVM",{props:{Name:null,ConStr:null}});Bridge.define("System.ComponentModel.DescriptionAttribute",{inherits:[System.Attribute],props:{Description:null},ctors:{ctor:function(n){this.$initialize();System.Attribute.ctor.call(this);this.Description=n}}});Bridge.define("System.Id",{$kind:"struct",statics:{fields:{Empty:null},ctors:{init:function(){this.Empty=new System.Id;this.Empty=new System.Id.$ctor1(System.Guid.Empty)}},methods:{NewGuid:function(){return new System.Id.$ctor1(System.Guid.NewGuid())},Gt:function(n,t){return System.Id.op_GreaterThan(System.Id.From(n),System.Id.From(t))},Ge:function(n,t){return System.Id.op_GreaterThanOrEqual(System.Id.From(n),System.Id.From(t))},Lt:function(n,t){return System.Id.op_LessThan(System.Id.From(n),System.Id.From(t))},Le:function(n,t){return System.Id.op_LessThanOrEqual(System.Id.From(n),System.Id.From(t))},From:function(n){var r,t,u,f,e,i;if(n==null)throw new System.ArgumentNullException.$ctor1("obj");if(t=n,(u=Bridge.is(t,System.Int32)?System.Nullable.getValue(Bridge.cast(Bridge.unbox(t,System.Int32),System.Int32)):null)!=null)return new System.Id.$ctor2(u);if((f=Bridge.is(t,System.Int32)?System.Nullable.getValue(Bridge.cast(Bridge.unbox(t,System.Int32),System.Int32)):null)!=null)return new System.Id.$ctor2(f);if((e=Bridge.as(t,System.String))!=null)return new System.Id.$ctor4(e);if(i=new System.Guid,System.Nullable.liftne(System.Guid.op_Inequality,i=Bridge.is(t,System.Guid)?System.Nullable.getValue(Bridge.cast(Bridge.unbox(t,System.Guid),System.Guid)):null,null))return new System.Id.$ctor1(i);if(t=(r=Bridge.Reflection.getMembers(Bridge.getType(n),16,284,"Id"))!=null?Bridge.Reflection.midel(r.g,Bridge.unbox(n))():null,t==null)throw new System.InvalidCastException.$ctor1("Object does not contain Id field or Id field is null");return System.Id.From(t)},Encode$1:function(n){var t=new System.Guid.$ctor4(n);return System.Id.Encode(t)},Encode:function(n){var t=System.Convert.toBase64String(n.ToByteArray(),null,null,null);return t=System.String.replaceAll(System.String.replaceAll(t,"/","_"),"+","-"),t.substr(0,22)},Decode:function(n){n=System.String.replaceAll(System.String.replaceAll(n,"_","/"),"-","+");var t=System.Convert.fromBase64String((n||"")+"==");return new System.Guid.$ctor1(t)},op_Equality:function(n,t){return n==null?t==null:System.Nullable.lifteq(System.Guid.op_Equality,n._guidVal,t._guidVal)&&Bridge.referenceEquals(n._strVal,t._strVal)&&System.Nullable.eq(n._intVal,t._intVal)&&System.Nullable.lifteq("equals",n._longVal,t._longVal)},op_LessThan:function(n,t){if(n._strVal!=null&&t._strVal!=null)return System.String.compare(n._strVal,t._strVal,2)<0;if(System.Nullable.hasValue(n._intVal)&&System.Nullable.hasValue(t._intVal))return System.Nullable.getValue(n._intVal)<System.Nullable.getValue(t._intVal);if(System.Nullable.hasValue(n._longVal)&&System.Nullable.hasValue(t._longVal))return System.Nullable.getValue(n._longVal).lt(System.Nullable.getValue(t._longVal));throw new System.ArithmeticException.$ctor1("Cannot determine what type of underlaying Id data");},op_GreaterThan:function(n,t){if(n._strVal!=null&&t._strVal!=null)return System.String.compare(n._strVal,t._strVal,2)>0;if(System.Nullable.hasValue(n._intVal)&&(System.Nullable.hasValue(t._intVal)||System.Nullable.hasValue(t._longVal)))return System.Nullable.hasValue(t._intVal)?System.Nullable.getValue(n._intVal)>=System.Nullable.getValue(t._intVal):System.Int64(System.Nullable.getValue(n._intVal)).gte(System.Nullable.getValue(t._longVal));if(System.Nullable.hasValue(n._longVal)&&(System.Nullable.hasValue(t._intVal)||System.Nullable.hasValue(t._longVal)))return System.Nullable.hasValue(t._intVal)?System.Nullable.getValue(n._longVal).gte(System.Int64(System.Nullable.getValue(t._intVal))):System.Nullable.getValue(n._longVal).gte(System.Nullable.getValue(t._longVal));throw new System.ArithmeticException.$ctor1("Cannot determine what type of underlaying Id data");},op_LessThanOrEqual:function(n,t){if(n._strVal!=null&&t._strVal!=null)return System.String.compare(n._strVal,t._strVal,2)<=0;if(System.Nullable.hasValue(n._intVal)&&(System.Nullable.hasValue(t._intVal)||System.Nullable.hasValue(t._longVal)))return System.Nullable.hasValue(t._intVal)?System.Nullable.getValue(n._intVal)<=System.Nullable.getValue(t._intVal):System.Int64(System.Nullable.getValue(n._intVal)).lte(System.Nullable.getValue(t._longVal));if(System.Nullable.hasValue(n._longVal)&&(System.Nullable.hasValue(t._intVal)||System.Nullable.hasValue(t._longVal)))return System.Nullable.hasValue(t._intVal)?System.Nullable.getValue(n._longVal).lte(System.Int64(System.Nullable.getValue(t._intVal))):System.Nullable.getValue(n._longVal).lte(System.Nullable.getValue(t._longVal));throw new System.ArithmeticException.$ctor1("Cannot determine what type of underlaying Id data");},op_GreaterThanOrEqual:function(n,t){if(n._strVal!=null&&t._strVal!=null)return System.String.compare(n._strVal,t._strVal,2)>=0;if(System.Nullable.hasValue(n._intVal)&&(System.Nullable.hasValue(t._intVal)||System.Nullable.hasValue(t._longVal)))return System.Nullable.hasValue(t._intVal)?System.Nullable.getValue(n._intVal)>=System.Nullable.getValue(t._intVal):System.Int64(System.Nullable.getValue(n._intVal)).gte(System.Nullable.getValue(t._longVal));if(System.Nullable.hasValue(n._longVal)&&(System.Nullable.hasValue(t._intVal)||System.Nullable.hasValue(t._longVal)))return System.Nullable.hasValue(t._intVal)?System.Nullable.getValue(n._longVal).gte(System.Int64(System.Nullable.getValue(t._intVal))):System.Nullable.getValue(n._longVal).gte(System.Nullable.getValue(t._longVal));throw new System.ArithmeticException.$ctor1("Cannot determine what type of underlaying Id data");},op_Inequality:function(n,t){return System.Nullable.liftne(System.Guid.op_Inequality,n._guidVal,t._guidVal)&&!Bridge.referenceEquals(n._strVal,t._strVal)&&System.Nullable.neq(n._intVal,t._intVal)&&System.Nullable.liftne("ne",n._longVal,t._longVal)},op_Implicit$7:function(n){return n._strVal},op_Implicit$5:function(n){var t;return t=n._intVal,t!=null?t:0},op_Implicit$6:function(n){var t;return t=n._longVal,t!=null?t:System.Int64(0)},op_Implicit:function(n){var t;return t=n._guidVal,t!=null?t:System.Guid.Empty},op_Implicit$4:function(n){return new System.Id.$ctor4(n)},op_Implicit$1:function(n){return new System.Id.$ctor1(n)},op_Implicit$2:function(n){return new System.Id.$ctor2(n)},op_Implicit$3:function(n){return new System.Id.$ctor3(n)},getDefaultValue:function(){return new System.Id}}},fields:{_guidVal:null,_strVal:null,_intVal:null,_longVal:null},props:{GuidVal:{get:function(){var n;return n=this._guidVal,n!=null?n:System.Guid.Empty}},StrVal:{get:function(){return this._strVal}},IntVal:{get:function(){var n;return n=this._intVal,n!=null?n:0}},LongVal:{get:function(){var n;return n=this._longVal,n!=null?n:System.Int64(0)}}},ctors:{$ctor4:function(n){this.$initialize();this._strVal=n;this._guidVal=System.Id.Decode(n);this._intVal=0;this._longVal=System.Int64(0)},$ctor2:function(n){this.$initialize();this._strVal=null;this._guidVal=null;this._intVal=n;this._longVal=System.Int64.lift(null)},$ctor3:function(n){this.$initialize();this._strVal=null;this._guidVal=null;this._intVal=null;this._longVal=n},$ctor1:function(n){this.$initialize();this._strVal=System.Id.Encode(n);this._guidVal=n;this._intVal=null;this._longVal=System.Int64.lift(null)},ctor:function(){this.$initialize()}},methods:{toString:function(){var n,t;return n=this._strVal,n!=null?n:(t=this._intVal!=null?Bridge.toString(System.Nullable.getValue(this._intVal)):null,t!=null?t:System.Nullable.liftne("ne",this._longVal,System.Int64.lift(null))?Bridge.toString(System.Nullable.getValue(this._longVal)):null)},equals:function(n){var t,i,r,u,f,e,o,s,h;return n==null?!1:(f=new System.Id,System.Id.op_Inequality(f=Bridge.is(n,System.Id)?System.Nullable.getValue(Bridge.cast(Bridge.unbox(n,System.Id),System.Id)):null,System.Id.op_Implicit$4(null)))?System.Id.op_Equality(this,f):(e=new System.Guid,System.Nullable.liftne(System.Guid.op_Inequality,e=Bridge.is(n,System.Guid)?System.Nullable.getValue(Bridge.cast(Bridge.unbox(n,System.Guid),System.Guid)):null,null))?(t=System.Nullable.liftne(System.Guid.op_Inequality,this._guidVal,null)?System.Nullable.getValue(this._guidVal).equalsT(e):null,t!=null?t:!1):(o=Bridge.as(n,System.String))!=null?(i=this._strVal!=null?System.String.equals(this._strVal,o):null,i!=null?i:!1):(s=Bridge.is(n,System.Int32)?System.Nullable.getValue(Bridge.cast(Bridge.unbox(n,System.Int32),System.Int32)):null)!=null?(r=this._intVal!=null?System.Nullable.getValue(this._intVal)===s:null,r!=null?r:!1):System.Nullable.liftne("ne",h=Bridge.is(n,System.Int64)?System.Nullable.getValue(Bridge.cast(Bridge.unbox(n,System.Int64),System.Int64)):null,System.Int64.lift(null))?(u=System.Nullable.liftne("ne",this._longVal,System.Int64.lift(null))?System.Nullable.getValue(this._longVal).equalsT(h):null,u!=null?u:!1):!1},getHashCode:function(){return this._guidVal.getHashCode()},$clone:function(n){var t=n||new System.Id;return t._guidVal=this._guidVal,t._strVal=this._strVal,t._intVal=this._intVal,t._longVal=this._longVal,t}}});Bridge.define("System.IO.Path",{statics:{fields:{ImgExt:null},ctors:{init:function(){this.ImgExt=System.Array.init(["tif","pjp","xbm","jxl","svgz","jpeg","ico","tiff","gif","svg","jfif","webp","png","bmp","pjpeg","avif","jpg"],System.String)}},methods:{IsImage:function(n){return System.Array.contains(System.IO.Path.ImgExt,Core.Extensions.StringExt.SubStrIndex(System.IO.Path.GetExtension(n).toLowerCase(),1),System.String)},CombineHostAndPath:function(n,t){var i=System.IO.Path.ContainHost(t);return i?t:System.IO.Path.Combine([n,t])},ContainHost:function(n){return System.String.contains(n,"http://")||System.String.contains(n,"https://")},GetExtension:function(n){return System.String.isNullOrEmpty(n)?"":n.substr(n.lastIndexOf("."))},GetFileName:function(n){if(System.String.isNullOrEmpty(n))return"";var t=n.lastIndexOf("/");return t>=0?n.substr(t+1|0):n},GetFileNameWithoutExtension:function(n){var t,i;return System.String.isNullOrEmpty(n)?"":(t=n.lastIndexOf("/"),t<0&&(t=0),i=n.lastIndexOf("."),n.substr(t+1|0,(i-1|0)-(t>=0?t:0)|0))},Combine:function(n){if(n===void 0&&(n=[]),n==null||n.length===0)return"";var t=System.Linq.Enumerable.from(n,System.String).where(function(n){return!System.String.isNullOrEmpty(n)}).select(function(n){var t=n.charCodeAt(0)===47?1:0,i=n.charCodeAt(n.length-1|0)===47?n.length-1|0:n.length;return n.substr(t,i-t|0)}).ToArray(System.String);return t.join("/")}}}});Bridge.define("Core.Components.Forms.EditForm",{inherits:[Core.Components.EditableComponent],statics:{fields:{NotDirtyMessage:null,ExpiredDate:null,BtnExpired:null,BtnSave:null,BtnSend:null,BtnApprove:null,BtnReject:null,StatusIdField:null,BtnCancel:null,BtnPrint:null,BtnPreview:null,SpecialEntryPoint:null,LastForm:null,NotificationClient:null},props:{LayoutForm:null,Portal:!1},ctors:{init:function(){this.NotDirtyMessage="Dữ liệu chưa thay đổi";this.ExpiredDate="ExpiredDate";this.BtnExpired="btnExpired";this.BtnSave="btnSave";this.BtnSend="btnSend";this.BtnApprove="btnApprove";this.BtnReject="btnReject";this.StatusIdField="StatusId";this.BtnCancel="btnCancel";this.BtnPrint="btnPrint";this.BtnPreview="btnPreview";this.SpecialEntryPoint="entry"}},methods:{ListViewItemFilter:function(n,t){return Bridge.is(t,Core.Components.GroupViewItem)?!1:t.Entity!=null&&Bridge.referenceEquals(Bridge.Reflection.getTypeName(Bridge.getType(t.Entity)),Bridge.Reflection.getTypeName(Bridge.getType(n)))&&Bridge.referenceEquals(Bridge.toString(t.Entity[Core.Components.EditableComponent.IdField]),Bridge.toString(n[Core.Components.EditableComponent.IdField]))},RenderCellText:function(n,t,i){var f,e,r=n.textContent!=null?n.textContent.trim():null,u;return Core.Extensions.StringExt.HasAnyChar(r)&&System.String.startsWith(r,"{")&&System.String.endsWith(r,"}")?(u=(f=new Core.Components.CellText((e=new Core.Models.Component,e.FieldName=Core.Extensions.StringExt.SubStrIndex$1(r,1,r.length-1|0),e),n),f.Entity=t,f),i&&Core.Components.Forms.EditForm.LayoutForm!=null?Core.Components.Forms.EditForm.LayoutForm.AddChild(u):u.Render(),u):null},PrintSection:function(n,t,i,r){var f,e,u;return(t===void 0&&(t=!0),i===void 0&&(i=null),r===void 0&&(r=!1),n==null)?null:(i==null&&(i=function(n){return n.add("./css/styleprint.css"),n.add("./css/font-awesome.css"),n.add("./css/metro-all.css"),n.add("./css/LineIcons.css"),n.add("./css/main.css"),n}(new(System.Collections.Generic.List$1(System.String).ctor))),f=new System.Text.StringBuilder("<html><head>"),i!=null?i.ForEach(function(n){System.String.contains(n,window.location.origin)||(n=System.IO.Path.Combine([window.location.origin,n]));f.append('<link href="').append(n).append('" ')}):null,f.append("<body><div style='padding:7pt'>").append(n.innerHTML).append("<\/div><\/body><\/html>"),e=f.toString(),!t)?e:(u=window.open("","_blank"),u.document.write(e),u.document.close(),u.addEventListener(System.Enum.toString(System.String,"afterprint"),Bridge.fn.cacheBind(u,u.close)),r&&window.setTimeout(Bridge.fn.cacheBind(u,u.print),250),e)}}},fields:{_entity:null,UrlSearch:null,_entityEnum:null,TabGroup:null,_confirm:null,_title:null,_icon:null,TitleElement:null,IconElement:null,AfterSaved:null,BeforeSaved:null,awaiter:0,_currentListView:null,_componentCoppy:null},props:{CurrentUserId:0,RegionId:null,AllRoleIds:null,CenterIds:null,RoleIds:null,CostCenterId:null,RoleNames:null,ShouldUpdateParentForm:!1,Now:{get:function(){return System.DateTime.getNow()}},Client:null,IsEditMode:{get:function(){return this.Entity!=null&&Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField])>0}},InnerEntry:{get:function(){return document.getElementById("entry")}},IsLock:!1,ListViews:null,UserVendor:{get:function(){var n;return(n=Core.Clients.Client.Token)!=null?n.Vendor:null}},ShouldLoadEntity:!1,Feature:null,Icon:{get:function(){return this._icon},set:function(n){this._icon=n;this.IconElement!=null&&Core.Components.Renderer.IconForSpan(Core.MVVM.Html.Take(this.IconElement),n)}},Title:{get:function(){return this._title},set:function(n){this._title=n;this.TitleElement!=null&&(this.TitleElement.innerHTML=null,Core.Components.Renderer.IText(Core.MVVM.Html.Take(this.TitleElement),n))}},Public:!1,OpenFrom:null,ParentForm:null,ReasonOfChange:null,Token:{get:function(){return Core.Clients.Client.Token},set:function(n){Core.Clients.Client.Token=n}}},ctors:{ctor:function(n){if(this.$initialize(),Core.Components.EditableComponent.ctor.call(this,null),this.UrlSearch=new URLSearchParams(window.location.search),n!=null){this.ListViews=new(System.Collections.Generic.HashSet$1(Core.Components.ListView).ctor);this._entity=n;this.Client=new Core.Clients.Client.$ctor1(n);var t=Bridge.Reflection.getType((Core.Clients.Client.ModelNamespace||"")+(n||""));t!=null&&(this.Entity=Bridge.createInstance(t));window.addEventListener("resize",Bridge.fn.cacheBind(this,this.ResizeHandler));Core.Components.Forms.EditForm.LayoutForm=Core.Components.Forms.EditForm.LayoutForm||new Core.Components.Forms.EditForm(null)}}},methods:{UpdateViewAwait$1:function(n){n===void 0&&(n=100);window.clearTimeout(this.awaiter);this.awaiter=window.setTimeout(Bridge.fn.bind(this,function(){this.UpdateView()}),n);this.Dirty=!1},BulkUpdate:function(){var t=0,i,f,n=new System.Threading.Tasks.TaskCompletionSource,r,e,u,o,s=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(r=Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.ListView,this),!this.Dirty){Core.Extensions.Toast.Warning(Core.Components.Forms.EditForm.NotDirtyMessage);n.setResult(!1);return}if(Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.ListView,r)){n.setResult(!1);return}if(e=System.Linq.Enumerable.from(r,Core.Components.ListView).select(function(n){return n.Dirty?n.BatchUpdate():null}).where(function(n){return n!=null}),i=System.Threading.Tasks.Task.whenAll(e),t=1,i.isCompleted())continue;i["continue"](s);return;case 1:f=i.getAwaitedResult();u=f;u!=null&&System.Linq.Enumerable.from(u,System.Collections.Generic.List$1(System.Object)).any(function(n){return Core.Extensions.IEnumerableExtensions.HasElement(System.Object,n)})?Core.Extensions.Toast.Success("Cập nhật thành công"):Core.Extensions.Toast.Warning(Core.Clients.Client.ErrorMessage);this.Dirty=!1;n.setResult(!0);return;default:n.setResult(null);return}}}catch(h){o=System.Exception.create(h);n.setException(o)}},arguments);return s(),n.task},SaveWithouUpdateView:function(n){var t=0,r,o,u,c,i=new System.Threading.Tasks.TaskCompletionSource,f,s,h,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2],t);switch(t){case 0:if(this.Entity==null)throw new System.InvalidOperationException.$ctor1("Entity is null");if(r=this.IsFormValid(),t=1,r.isCompleted())continue;r["continue"](e);return;case 1:if(o=r.getAwaitedResult(),s=o,!s){i.setResult(!1);return}if(Bridge.staticEquals(this.BeforeSaved,null)?null:this.BeforeSaved(),Core.Extensions.ReflectionExt.ClearReferences(this.Entity),u=this.AddOrUpdate(n),t=2,u.isCompleted())continue;u["continue"](e);return;case 2:c=u.getAwaitedResult();this.Dirty=!1;f=!0;Bridge.staticEquals(this.AfterSaved,null)?null:this.AfterSaved(f);i.setResult(f);return;default:i.setResult(null);return}}}catch(l){h=System.Exception.create(l);i.setException(h)}},arguments);return e(),i.task},Save:function(n){var i=0,r,s,u,h,t=new System.Threading.Tasks.TaskCompletionSource,f,c,e,l,a,o=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2],i);switch(i){case 0:if(n===void 0&&(n=null),this.Entity==null)throw new System.InvalidOperationException.$ctor1("Entity is null");if(!this.Dirty){Core.Extensions.Toast.Warning(Core.Components.Forms.EditForm.NotDirtyMessage);t.setResult(!1);return}if(r=this.IsFormValid(n!=null,void 0,void 0),i=1,r.isCompleted())continue;r["continue"](o);return;case 1:if(s=r.getAwaitedResult(),c=s,!c){t.setResult(!1);return}if(Bridge.staticEquals(this.BeforeSaved,null)?null:this.BeforeSaved(),Core.Extensions.ReflectionExt.ClearReferences(this.Entity),u=this.AddOrUpdate(n),i=2,u.isCompleted())continue;u["continue"](o);return;case 2:h=u.getAwaitedResult();e=h;f=e!=null;Bridge.staticEquals(this.AfterSaved,null)?null:this.AfterSaved(f);f&&(Core.Extensions.ReflectionExt.CopyPropFrom$1(this.Entity,e),this.UpdateViewAwait(!0));this.ShouldUpdateParentForm&&((l=this.ParentForm)!=null?l.UpdateView$1(!0):null);t.setResult(f);return;default:t.setResult(null);return}}}catch(v){a=System.Exception.create(v);t.setException(a)}},arguments);return o(),t.task},AddNew:function(n){var t=0,i,e,r,u=new System.Threading.Tasks.TaskCompletionSource,o,s,h,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4,5],t);switch(t){case 0:if(n===void 0&&(n=null),this.Dirty=!0,Core.Extensions.BridgeExt.SetPropValue(this.Entity,Core.Components.EditableComponent.IdField,Bridge.box(0,System.Int32)),o=System.Linq.Enumerable.from(this.ListViews,Core.Components.ListView).where(function(n){return Core.Extensions.StringExt.HasAnyChar(n.GuiInfo.IdField)&&n.GuiInfo.CanAdd}).ToArray(Core.Components.ListView),o.forEach(function(n){n.RowData.Data.ForEach(function(t){Core.Extensions.BridgeExt.SetPropValue(t,n.GuiInfo.IdField,null);Core.Extensions.BridgeExt.SetPropValue(t,Core.Components.EditableComponent.IdField,Bridge.box(0,System.Int32))})}),i=this.Save(null),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:if(e=i.getAwaitedResult(),s=e,s){t=2;continue}else{t=4;continue}case 2:if(Core.Extensions.Toast.Success("Tạo mới thành công"),r=System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.GridView,this.ParentForm),Core.Components.GridView).firstOrDefault(null,null).ActionFilter(),t=3,r.isCompleted())continue;r["continue"](f);return;case 3:r.getAwaitedResult();t=5;continue;case 4:Core.Extensions.Toast.Warning("Tạo mới lỗi");t=5;continue;case 5:u.setResult(null);return;default:u.setResult(null);return}}}catch(c){h=System.Exception.create(c);u.setException(h)}},arguments);return f(),u.task},UpdateViewForm:function(){var n,i=this.ParentForm||((n=Bridge.as(this,Core.Components.Forms.TabEditor))!=null&&n.Popup?n.Parent:null),t;i!=null&&(t=System.Linq.Enumerable.from(i.FilterChildren$1(Bridge.fn.bind(this,function(n){return n.Entity!=null&&Bridge.referenceEquals(n.Entity,this.Entity)})),Core.Components.EditableComponent).firstOrDefault(null,null),t!=null?t.UpdateView():null)},GetDirtyGrid:function(){return System.Linq.Enumerable.from(this.ListViews,Core.Components.ListView).where(function(n){return Core.Extensions.StringExt.HasAnyChar(n.GuiInfo.IdField)&&n.GuiInfo.CanAdd}).where(function(n){return System.Linq.Enumerable.from(n.FilterChildren(Core.Components.EditableComponent,function(n){return n._dirty},function(n){return!n.PopulateDirty}),Core.Components.EditableComponent).any()}).ToArray(Core.Components.ListView)},AddOrUpdate:function(n){var t=0,r,s,u,i=new System.Threading.Tasks.TaskCompletionSource,h,c,f,e,l,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2],t);switch(t){case 0:if(h=n!=null,c=this.BuildTextHistory().toString(),f=Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField])>0,r=this.AddOrUpdateEntity(n,f),t=1,r.isCompleted())continue;r["continue"](o);return;case 1:if(s=r.getAwaitedResult(),e=s,e==null){i.setResult(null);return}if(u=this.UpdateHistory(c),t=2,u.isCompleted())continue;u["continue"](o);return;case 2:u.getAwaitedResult();this.ReloadAndShowMessage(h,f);this.Dirty=!1;i.setResult(e);return;default:i.setResult(null);return}}}catch(a){l=System.Exception.create(a);i.setException(l)}},arguments);return o(),i.task},UpdateIndependantGridView:function(){var t=0,i,o,n=new System.Threading.Tasks.TaskCompletionSource,r,u,f,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(r=this.GetDirtyGrid(),Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.ListView,r)){n.setResult(null);return}if(u=Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField]),r.forEach(function(n){n.UpdatedRows.ForEach(function(t){Core.Extensions.BridgeExt.SetPropValue(t,n.GuiInfo.IdField,Bridge.box(u,System.Int32))})}),i=System.Threading.Tasks.Task.whenAll(System.Linq.Enumerable.from(r,Core.Components.ListView).select(function(n){return n.BatchUpdate()})),t=1,i.isCompleted())continue;i["continue"](e);return;case 1:o=i.getAwaitedResult();n.setResult(null);return;default:n.setResult(null);return}}}catch(s){f=System.Exception.create(s);n.setException(f)}},arguments);return e(),n.task},UpdateHistory:function(n){var t=0,u,h,r=new System.Threading.Tasks.TaskCompletionSource,s,i,f,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4],t);switch(t){case 0:if(Core.Extensions.StringExt.IsNullOrWhiteSpace(n)){r.setResult(null);return}s=(i=new Core.Models.History,i.EntityId=Core.Extensions.Utils.GetEntity$1(this.Client.EntityName).Id,i.RecordId=System.Int32.parse(Bridge.toString(this.Entity[Core.Components.EditableComponent.IdField])),i.ReasonOfChange=(f=this.ReasonOfChange,f!=null?f:"Cập nhật thông tin"),i.TextHistory=n,i);t=1;continue;case 1:if(u=new Core.Clients.Client.$ctor1("History",Bridge.Reflection.getTypeNamespace(Core.Models.User)).CreateAsync(Core.Models.History,s),t=2,u.isCompleted())continue;u["continue"](o);return;case 2:h=u.getAwaitedResult();this.ReasonOfChange=null;t=4;continue;case 3:e=null;t=4;continue;case 4:r.setResult(null);return;default:r.setResult(null);return}}}catch(c){if(e=System.Exception.create(c),t>=1&&t<=2){t=3;o();return}r.setException(e)}},arguments);return o(),r.task},AddOrUpdateEntity:function(n,t){var i=0,f,c,e,l,o,s=new System.Threading.Tasks.TaskCompletionSource,r,a,h,u=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([1,2,3,4,5,6,7,8,9],i);switch(i){case 1:if(t){i=2;continue}else{i=4;continue}case 2:if(f=this.Client.UpdateAsync(System.Object,this.Entity),i=3,f.isCompleted())continue;f["continue"](u);return;case 3:c=f.getAwaitedResult();r=c;i=6;continue;case 4:if(this.Entity[Core.Components.EditableComponent.IdField]=Bridge.box(0,System.Int32),e=this.Client.CreateAsync(System.Object,this.Entity),i=5,e.isCompleted())continue;e["continue"](u);return;case 5:l=e.getAwaitedResult();r=l;i=6;continue;case 6:i=8;continue;case 7:(a=Bridge.is(n,System.Boolean)?System.Nullable.getValue(Bridge.cast(Bridge.unbox(n,System.Boolean),System.Boolean)):null)!=null&&a&&Core.Extensions.Toast.Warning(Core.Clients.Client.ErrorMessage);r=null;h=null;i=8;continue;case 8:if(Core.Extensions.ReflectionExt.CopyPropFrom$1(this.Entity,r),o=this.UpdateIndependantGridView(),i=9,o.isCompleted())continue;o["continue"](u);return;case 9:o.getAwaitedResult();s.setResult(r);return;default:s.setResult(null);return}}}catch(v){if(h=System.Exception.create(v),i>=1&&i<=6){i=7;u();return}s.setException(h)}},arguments);return u(),s.task},IsFormValid:function(n,t,i){var f=0,e,s,r=new System.Threading.Tasks.TaskCompletionSource,h,u,o,c,l,a=Bridge.fn.bind(this,function(){try{for(;;){f=System.Array.min([0,1],f);switch(f){case 0:if(n===void 0&&(n=!0),t===void 0&&(t=null),i===void 0&&(i=null),Bridge.staticEquals(t,null)&&(t=function(){return!0}),Bridge.staticEquals(i,null)&&(i=function(n){return n.AlwaysValid}),e=Core.Extensions.IEnumerableExtensions.ForEachAsync(Core.Components.EditableComponent,this.FilterChildren(Core.Components.EditableComponent,t,i,void 0),function(n){return n.ValidateAsync()}),f=1,e.isCompleted())continue;e["continue"](a);return;case 1:if(s=e.getAwaitedResult(),h=s,u=System.Linq.Enumerable.from((o=Core.Components.EditableComponent,System.Linq.Enumerable.from(h,o).toList(o)),Core.Components.EditableComponent).where(function(n){return!n.IsValid}),Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,u)){r.setResult(!0);return}n&&(u.forEach(function(n){n.Disabled=!1}),u.firstOrDefault(null,null).Focus(),c=Bridge.toArray(u.selectMany(function(n){return n.ValidationResult.Values})).join("<br />"),Core.Extensions.Toast.Warning(c));r.setResult(!1);return;default:r.setResult(null);return}}}catch(v){l=System.Exception.create(v);r.setException(l)}},arguments);return a(),r.task},ReloadAndShowMessage:function(n,t){var i=t?"Cập nhật":"Tạo mới";n&&Core.Extensions.Toast.Success(System.String.format("{0} thành công",[i]));this.UpdateView()},BuildTree:function(n){var o,u,f,e,h=(o=Core.Models.ComponentGroup,System.Linq.Enumerable.from(n,o).toDictionary(function(n){return n.Id},null,System.Int32,o)),r,t,i,c,s;u=Bridge.getEnumerator(n);try{while(u.moveNext())if(t=u.Current,t.IsVertialTab&&this.Element.clientWidth<Core.Components.EditableComponent.SmallScreen&&(t.IsVertialTab=!1),t.ParentId!=null){if(!h.containsKey(System.Nullable.getValue(t.ParentId))){System.Console.WriteLine(System.String.format("The parent key {0} of {1} doesn't exist",Bridge.box(t.ParentId,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),t.Name));continue}r=h.getItem(System.Nullable.getValue(t.ParentId));r.InverseParent==null&&(r.InverseParent=new(System.Collections.Generic.List$1(Core.Models.ComponentGroup).ctor));System.Array.contains(r.InverseParent,t,Core.Models.ComponentGroup)||System.Array.add(r.InverseParent,t,Core.Models.ComponentGroup);t.Parent=r}}finally{Bridge.is(u,System.IDisposable)&&u.System$IDisposable$Dispose()}f=Bridge.getEnumerator(n);try{while(f.moveNext())if(i=f.Current,i.Component!=null&&System.Linq.Enumerable.from(i.Component,Core.Models.Component).any()){e=Bridge.getEnumerator(i.Component,Core.Models.Component);try{while(e.moveNext())c=e.Current,c.ComponentGroup=i}finally{Bridge.is(e,System.IDisposable)&&e.System$IDisposable$Dispose()}i.InverseParent!=null&&(i.InverseParent=System.Linq.Enumerable.from(i.InverseParent,Core.Models.ComponentGroup).orderBy(function(n){return n.Order}).toList(Core.Models.ComponentGroup))}}finally{Bridge.is(f,System.IDisposable)&&f.System$IDisposable$Dispose()}return n.ForEach(Bridge.fn.bind(this,function(n){var t;this.CalcItemInRow((t=Core.Models.ComponentGroup,System.Linq.Enumerable.from(n.InverseParent,t).toList(t)))})),s=System.Linq.Enumerable.from(n,Core.Models.ComponentGroup).where(function(n){return n.ParentId==null}),Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.ComponentGroup,s)&&System.Console.WriteLine("No component group is root component. Wrong feature name or the configuration is wrong"),s.toList(Core.Models.ComponentGroup)},CalcItemInRow:function(n){for(var i,u=0,r=0,f=0,t=0;t<n.Count;t=t+1|0){var e=n.getItem(t),o=this.GetInnerColumn(e.Parent),s=this.GetOuterColumn(e);if(!(o<=0)&&(r=r+1|0,u=u+s|0,u%o==0)){for(i=t;i>=f;)n.getItem(i).ItemInRow=r,i=i-1|0;r=0;f=t}}},Render:function(){Core.Components.Forms.EditForm.Portal&&(this.ParentForm=this.ParentForm||Core.Components.Forms.EditForm.LastForm);System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this,this.RenderAsync));Core.Components.Forms.EditForm.LastForm=this},RenderAsync:function(){var t=0,r,u,y,f,e=new System.Threading.Tasks.TaskCompletionSource,n,s,h,i,p,c,l,a,w,v,b,k,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4,5,6],t);switch(t){case 0:if(n=Core.Clients.Client.Token,s=this.Feature!=null?System.Threading.Tasks.Task.fromResult(this.Feature,Core.Models.Feature):Core.Components.Extensions.ComponentExt.LoadFeatureByName(this.Name,this.Public),h=this.LoadEntity(),r=System.Threading.Tasks.Task.whenAll(s,h),t=1,r.isCompleted())continue;r["continue"](o);return;case 1:if(r.getAwaitedResult(),i=s.getResult(),i.LayoutId==null||this.InnerEntry!=null){t=2;continue}else{t=3;continue}case 2:c=null;t=5;continue;case 3:if(u=new Core.Clients.Client.$ctor1("Feature",Bridge.Reflection.getTypeNamespace(Core.Models.User)).FirstOrDefaultAsync(Core.Models.Feature,System.String.format("/Public/?$filter=Active eq true and Id eq {0} and {1} ne null",Bridge.box(i.LayoutId,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),"Template")),t=4,u.isCompleted())continue;u["continue"](o);return;case 4:y=u.getAwaitedResult();c=y;t=5;continue;case 5:if(p=c,Core.Extensions.ReflectionExt.CopyPropFrom$1(this.Entity,h.getResult()),this.SetFeatureProperties(i),this.CurrentUserId=(l=n!=null?n.UserId:null,l!=null?l:0),this.RegionId=(a=n!=null?n.RegionId:null,a!=null?a:0),this.AllRoleIds=(n!=null?n.AllRoleIds:null)!=null?Bridge.toArray(n.AllRoleIds).join(","):"",this.CenterIds=(n!=null?n.CenterIds:null)!=null?Bridge.toArray(n.CenterIds).join(","):"",this.RoleIds=(n!=null?n.RoleIds:null)!=null?Bridge.toArray(n.RoleIds).join(","):"",this.CostCenterId=n!=null?n.CostCenterId:null,this.RoleNames=(n!=null?n.RoleNames:null)!=null?Bridge.toArray(n.RoleNames).join(","):"",w=this.BuildTree(System.Linq.Enumerable.from((v=Core.Models.ComponentGroup,System.Linq.Enumerable.from(i.ComponentGroup,v).toList(v)),Core.Models.ComponentGroup).orderBy(function(n){return n.Order}).toList(Core.Models.ComponentGroup)),this.Element=this.RenderTemplate(p,i),this.SetFeatureStyleSheet(i.StyleSheet),this.RenderTabOrSection(w),this.ResizeHandler(),this.LockUpdate(),this.ToggleApprovalBtn(),Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(this.Element),-1).Trigger("focus").Event("focusin",Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.Feature.Events,"focusin",[this.Entity]),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()})).Event("focusout",Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.Feature.Events,"focusout",[this.Entity]),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()})),Bridge.staticEquals(b=this.DOMContentLoaded,null)?null:b(),f=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.Feature.Events,"DOMContentLoaded",[this.Entity]),t=6,f.isCompleted())continue;f["continue"](o);return;case 6:f.getAwaitedResult();e.setResult(null);return;default:e.setResult(null);return}}}catch(d){k=System.Exception.create(d);e.setException(k)}},arguments);return o(),e.task},RenderTemplate:function(n,t){var i=document.getElementById(Core.Components.Forms.EditForm.SpecialEntryPoint)||document.getElementById("template")||this.Element,r,f,e,u;return(this.ParentForm!=null&&Core.Components.Forms.EditForm.Portal&&(this.ParentForm.Element=null,this.ParentForm.Dispose(),this.ParentForm=null),n!=null?(r=document.getElementById("template"),Core.MVVM.Html.Take(r).InnerHTML(n.Template),f=document.createElement(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.style)),f.appendChild(document.createTextNode(n.StyleSheet)),r.appendChild(f),this.BindingTemplate(r,this,!0,void 0,void 0,void 0),i=System.Linq.Enumerable.from(Core.Extensions.HtmlElementExtension.FilterElement(r,function(n){return Bridge.referenceEquals(n.id,Core.Components.Forms.EditForm.SpecialEntryPoint)}),HTMLElement).firstOrDefault(null,null),this.ResetEntryPoint(i)):i.innerHTML=null,!Core.Extensions.StringExt.HasAnyChar(t.Template))?i:(Core.MVVM.Html.Take(i).InnerHTML(t.Template),this.BindingTemplate(i,this),e=System.Linq.Enumerable.from(Core.Extensions.HtmlElementExtension.FilterElement(i,function(n){return Bridge.referenceEquals(n.id,"inner-entry")}),HTMLElement).firstOrDefault(null,null),this.ResetEntryPoint(e),u=e||i,Bridge.referenceEquals(Bridge.toString(u.style.display),System.Enum.toString(System.String,"none"))&&(u.style.display=""),u)},ResetEntryPoint:function(n){n!=null&&(n.innerHTML="")},BindingTemplate:function(n,t,i,r,u,f){var o,e,s,h,c,l;if((i===void 0&&(i=!1),r===void 0&&(r=null),u===void 0&&(u=null),f===void 0&&(f=null),f==null&&(f=new(System.Collections.Generic.HashSet$1(HTMLElement).ctor)),n!=null&&!f.contains(n))&&(f.add(n),n.children.length!==0||Core.Components.Forms.EditForm.RenderCellText(n,r,i)==null)){e=null;o=Bridge.getEnumerator(System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Core.Models.Component,16,28),System.Reflection.PropertyInfo).where(function(n){return!!n.g&&!!n.s}));try{while(o.moveNext())if(s=o.Current,h=n.dataset[s.n.toLowerCase()],h!=null){c=null;try{c=Bridge.referenceEquals(s.rt,System.String)?h:Core.Extensions.Utils.ChangeType(h,s.rt);e=e||new Core.Models.Component;Core.Extensions.BridgeExt.SetPropValue(e,s.n,c)}catch(a){a=System.Exception.create(a);continue}}}finally{Bridge.is(o,System.IDisposable)&&o.System$IDisposable$Dispose()}l=(Bridge.staticEquals(u,null)?null:u(n,e,t,i,r))||this.BindingData(n,e,t,i,r);t=Bridge.is(l,Core.Components.Section)?l:t;Core.Extensions.IEnumerableExtensions.ForEach(HTMLElement,n.children,Bridge.fn.bind(this,function(n){this.BindingTemplate(n,t,i,r,u,f)}))}},BindingData:function(n,t,i,r,u){var e,o,h,f=null,c,s;if(n==null||t==null||Core.Extensions.StringExt.IsNullOrEmpty(t.ComponentType))return null;if(Bridge.referenceEquals(t.ComponentType,"Section"))f=(e=new Core.Components.Section.ctor(n),e.GuiInfo=t,e);else if(f==null){if(c=System.String.indexOf(t.ComponentType,".")>=0?t.ComponentType:(Bridge.Reflection.getTypeNamespace(Core.Components.EditableComponent)||"")+"."+(t.ComponentType||""),s=eval(c),s==null)return null;f=new s(t,n)}return f.ParentElement=f.ParentElement||n.parentElement,f.Entity=(e=u,e!=null?e:(o=(h=f.EditForm)!=null?h.Entity:null,o!=null?o:Core.Components.Forms.EditForm.LayoutForm.Entity)),r?(f.EditForm=Bridge.as(i,Core.Components.Forms.EditForm),f.Render(),Core.Components.Forms.EditForm.LayoutForm.Children.add(f),f.ToggleShow(t.ShowExp),f.ToggleDisabled(t.DisabledExp)):i.AddChild(f),f},LoadEntity:function(){var t=0,i,f,n=new System.Threading.Tasks.TaskCompletionSource,r,e,u,o,s=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(!this.ShouldLoadEntity||this.Entity==null){n.setResult(null);return}if(r=Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField]),r==null||System.Nullable.lte(r,0)){n.setResult(null);return}if(i=this.Client.LoadById(System.String.format("{0}",[Bridge.box(System.Nullable.getValue(r),System.Int32)])),t=1,i.isCompleted())continue;i["continue"](s);return;case 1:f=i.getAwaitedResult();e=(u=System.Linq.Enumerable.from(f.Value,System.Object).firstOrDefault(null,null),u!=null?u:this.Entity);n.setResult(e);return;default:n.setResult(null);return}}}catch(h){o=System.Exception.create(h);n.setException(o)}},arguments);return s(),n.task},LockUpdate:function(){var u=System.Linq.Enumerable.from(this.Feature.FeaturePolicy,Core.Models.FeaturePolicy).where(function(n){return n.RecordId===0}).ToArray(Core.Models.FeaturePolicy),n,i,r,t;if(!this.Feature.IsPublic&&(System.Linq.Enumerable.from(u,Core.Models.FeaturePolicy).all(function(n){return!n.CanWrite})||!Core.Extensions.Utils.IsOwner(this.Entity)&&System.Linq.Enumerable.from(u,Core.Models.FeaturePolicy).all(function(n){return!n.CanWriteAll}))){this.LockUpdateButCancel();return}this.Entity!=null&&((n=Bridge.unbox(this.Entity.InsertedDate),i=Bridge.unbox(this.Entity.Lock),Bridge.equals(n,null)||Bridge.equals(n,System.DateTime.getMinValue()))||(r=System.Linq.Enumerable.from(this.Feature.FeaturePolicy,Core.Models.FeaturePolicy).where(function(n){return n.EntityId==null&&System.Nullable.hasValue(n.RoleId)&&System.Nullable.hasValue(n.LockUpdateAfterCreated)}).where(function(n){return Core.Clients.Client.Token.RoleIds.contains(System.Nullable.getValue(n.RoleId))}),t=0,Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.FeaturePolicy,r)&&(t=r.max(function(n){return System.Nullable.getValue(n.LockUpdateAfterCreated)})),(t>0&&Core.Extensions.DateTimeExt.GetBusinessDays(System.Nullable.getValue(n))>t||System.Nullable.hasValue(i)&&System.Nullable.getValue(i))&&(this.IsLock=!0,this.LockUpdateButCancel())))},LockUpdateButCancel:function(){this.Disabled=!0;Core.Components.Extensions.ComponentExt.SetDisabled$1(this,!1,[Core.Components.Forms.EditForm.BtnCancel,Core.Components.Forms.EditForm.BtnPrint])},SetFeatureProperties:function(n){n!=null&&(this.Feature=n,Core.Extensions.HtmlElementExtension.AddClass(this.Element,n.ClassName),Core.MVVM.Html.Take(this.Element).Style$1(n.Style),Core.Extensions.StringExt.IsNullOrEmpty(this.Icon)&&(this.Icon=n.Icon),Core.Extensions.StringExt.IsNullOrEmpty(this.Title)&&(this.Title=n.Label))},SetFeatureStyleSheet:function(n){if(!Core.Extensions.StringExt.IsNullOrWhiteSpace(n)){var t=Bridge.as(document.createElement(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.style)),HTMLStyleElement);t.appendChild(document.createTextNode(n));t.setAttribute("source","feature");this.Element.appendChild(t)}},RenderTabOrSection:function(n){var i,t;i=Bridge.getEnumerator(System.Linq.Enumerable.from(n,Core.Models.ComponentGroup).orderBy(function(n){return n.Order}));try{while(i.moveNext())t=i.Current,t.Disabled=this.Disabled||t.Disabled,t.IsTab?Core.Components.Section.RenderTabGroup(this,t):Core.Components.Section.RenderSection(this,t)}finally{Bridge.is(i,System.IDisposable)&&i.System$IDisposable$Dispose()}},GetInnerColumn:function(n){var i,r,t,u;return n==null?0:(t=this.Element.clientWidth,u=t<Core.Components.EditableComponent.ExSmallScreen&&System.Nullable.gt(n.XsCol,0)?n.XsCol:t<Core.Components.EditableComponent.SmallScreen&&System.Nullable.gt(n.SmCol,0)?n.SmCol:t<Core.Components.EditableComponent.MediumScreen&&n.Column>0?n.Column:t<Core.Components.EditableComponent.LargeScreen&&System.Nullable.gt(n.LgCol,0)?n.LgCol:t<Core.Components.EditableComponent.ExLargeScreen&&System.Nullable.gt(n.XlCol,0)?n.XlCol:(i=n.XxlCol,i!=null?i:n.Column),r=u,r!=null?r:0)},GetOuterColumn:function(n){var i,r,t=this.Element.clientWidth,u;return u=t<Core.Components.EditableComponent.ExSmallScreen&&System.Nullable.gt(n.XsOuterColumn,0)?n.XsOuterColumn:t<Core.Components.EditableComponent.SmallScreen&&System.Nullable.gt(n.SmOuterColumn,0)?n.SmOuterColumn:t<Core.Components.EditableComponent.MediumScreen&&System.Nullable.gt(n.OuterColumn,0)?n.OuterColumn:t<Core.Components.EditableComponent.LargeScreen&&System.Nullable.gt(n.LgOuterColumn,0)?n.LgOuterColumn:t<Core.Components.EditableComponent.ExLargeScreen&&System.Nullable.gt(n.XlOuterColumn,0)?n.XlOuterColumn:(i=n.XxlOuterColumn,i!=null?i:n.OuterColumn),r=u,r!=null?r:0},SysConfigMenu:function(t,i,r){var f,u;Core.Clients.Client.SystemRole&&(f=Bridge.fn.bind(this,function(t){var i;return t.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fas fa-link mt-2",i.Text="Add Link",i.Click=Bridge.fn.cacheBind(this,this.AddComponent),i.Parameter=new n.$AnonymousType$1(r,"AddLink"),i)),t.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fas fa-plus-circle mt-2",i.Text="Add Input",i.Click=Bridge.fn.cacheBind(this,this.AddComponent),i.Parameter=new n.$AnonymousType$1(r,"AddInput"),i)),t.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fas fa-plus-circle mt-2",i.Text="Add Timepicker",i.Click=Bridge.fn.cacheBind(this,this.AddComponent),i.Parameter=new n.$AnonymousType$1(r,"AddTimepicker"),i)),t.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fas fa-lock mt-2",i.Text="Add Password",i.Click=Bridge.fn.cacheBind(this,this.AddComponent),i.Parameter=new n.$AnonymousType$1(r,"AddPassword"),i)),t.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fas fa-plus-circle mt-2",i.Text="Add Label",i.Click=Bridge.fn.cacheBind(this,this.AddComponent),i.Parameter=new n.$AnonymousType$1(r,"AddLabel"),i)),t.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fas fa-plus-circle mt-2",i.Text="Add Textarea",i.Click=Bridge.fn.cacheBind(this,this.AddComponent),i.Parameter=new n.$AnonymousType$1(r,"AddTextarea"),i)),t.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fas fa-plus-circle mt-2",i.Text="Add Dropdown",i.Click=Bridge.fn.cacheBind(this,this.AddComponent),i.Parameter=new n.$AnonymousType$1(r,"AddDropdown"),i)),t.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fas fa-images mt-2",i.Text="Add Image",i.Click=Bridge.fn.cacheBind(this,this.AddComponent),i.Parameter=new n.$AnonymousType$1(r,"AddImage"),i)),t.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fas fa-plus-circle mt-2",i.Text="Add GridView",i.Click=Bridge.fn.cacheBind(this,this.AddComponent),i.Parameter=new n.$AnonymousType$1(r,"AddGridView"),i)),t.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fas fa-plus-circle mt-2",i.Text="Add ListView",i.Click=Bridge.fn.cacheBind(this,this.AddComponent),i.Parameter=new n.$AnonymousType$1(r,"AddListView"),i)),t})(new(System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem).ctor)),t.preventDefault(),t.stopPropagation(),u=Core.Components.Forms.ContextMenu.Instance,u.Top=Core.Extensions.EventExt.Top(t),u.Left=Core.Extensions.EventExt.Left(t),u.MenuItems=Bridge.fn.bind(this,function(n){var t;return n.add(i==null?null:(t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-cog",t.Text="Tùy chọn dữ liệu",t.Click=Bridge.fn.cacheBind(this,this.ComponentProperties),t.Parameter=i,t)),n.add(i==null?null:(t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-clone",t.Text="Sao chép",t.Click=Bridge.fn.cacheBind(this,this.CoppyComponent),t.Parameter=i,t)),n.add(this._componentCoppy==null?null:(t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-paste",t.Text="Dán",t.Click=Bridge.fn.cacheBind(this,this.PasteComponent),t.Parameter=r,t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-cogs",t.Text="Thêm Component",t.MenuItems=f,t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-cogs",t.Text="Tùy chọn vùng dữ liệu",t.Click=Bridge.fn.cacheBind(this,this.SectionProperties),t.Parameter=r,t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-clone",t.Text="Clone vùng dữ liệu",t.Click=Bridge.fn.cacheBind(this,this.CloneProperties),t.Parameter=r,t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-folder-open",t.Text="Thiết lập chung",t.Click=Bridge.fn.cacheBind(this,this.FeatureProperties),t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-clone",t.Text="Clone feature",t.Click=Bridge.fn.cacheBind(this,this.CloneFeature),t.Parameter=this.Feature,t)),n})(new(System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem).ctor)),u.Render())},CloneFeature:function(n){var t,r=Bridge.as(n,Core.Models.Feature),i=(t=new Core.Components.Forms.ConfirmDialog,t.Content="Bạn có muốn clone feature này?",t.Title="Xác nhận",t);i.YesConfirmed=Bridge.fn.combine(i.YesConfirmed,Bridge.fn.bind(this,function(){var n=0,t,f,i,u=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(i=new Core.Clients.Client.$ctor1("Feature"),t=i.CloneFeatureAsync(r.Id),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:f=t.getAwaitedResult();return;default:return}}},arguments);u()}));this.AddChild(i)},GetElementPolicies$1:function(n,t){t===void 0&&(t=30);return System.Linq.Enumerable.from(this.Feature.FeaturePolicy,Core.Models.FeaturePolicy).where(function(n){return System.Nullable.hasValue(n.RoleId)&&Core.Clients.Client.Token.AllRoleIds.contains(System.Nullable.getValue(n.RoleId))}).where(function(i){return System.Nullable.eq(i.EntityId,t)&&System.Array.contains(n,i.RecordId,System.Int32)}).ToArray(Core.Models.FeaturePolicy)},GetElementPolicies:function(n,t){t===void 0&&(t=20);return System.Linq.Enumerable.from(this.Feature.FeaturePolicy,Core.Models.FeaturePolicy).where(function(n){return System.Nullable.hasValue(n.RoleId)&&Core.Clients.Client.Token.AllRoleIds.contains(System.Nullable.getValue(n.RoleId))}).where(function(i){return System.Nullable.eq(i.EntityId,t)&&n===i.RecordId}).ToArray(Core.Models.FeaturePolicy)},HeaderProperties:function(n){var t,i=(t=new Core.Components.HeaderEditor,t.Entity=n,t.ParentElement=this.Element,t);this.AddChild(i)},ComponentProperties:function(n){var t,i=Core.Extensions.BridgeExt.CastProp(Core.Models.Component,n),r;i.ComponentGroup=null;r=(t=new Core.Components.Framework.ComponentBL,t.Entity=i,t.ParentElement=this.Element,t.OpenFrom=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm,this),t);this.AddChild(r)},CoppyComponent:function(n){var t=Core.Extensions.BridgeExt.CastProp(Core.Models.Component,n);this._componentCoppy=t},PasteComponent:function(n){var t=Core.Extensions.BridgeExt.CastProp(Core.Models.ComponentGroup,n);this._componentCoppy.ComponentGroupId=t.Id;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,r,i=new System.Threading.Tasks.TaskCompletionSource,e,u,f=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(this._componentCoppy.Id=0,t=new Core.Clients.Client.$ctor1("Component").CreateAsync$1(this._componentCoppy),n=1,t.isCompleted())continue;t["continue"](f);return;case 1:r=t.getAwaitedResult();e=r;this._componentCoppy=null;Core.Extensions.Toast.Success("Sao chép thành công!");i.setResult(null);return;default:i.setResult(null);return}}}catch(o){u=System.Exception.create(o);i.setException(u)}},arguments);return f(),i.task}))},AddComponent:function(n){var u,e=Core.Extensions.BridgeExt.CastProp(System.String,n.action),i=Core.Extensions.BridgeExt.CastProp(Core.Models.ComponentGroup,n.group),t=new Core.Models.Component,o=System.Linq.Enumerable.from(this.Feature.ComponentGroup,Core.Models.ComponentGroup).firstOrDefault(function(n){return n.Id===i.Id},null),r=System.Linq.Enumerable.from(o.Component,Core.Models.Component).nullableMax(function(n){return n.Order}),f;switch(e){case"AddLink":t.ComponentType="Link";t.Visibility=!0;t.Order=r;t.ComponentGroupId=i.Id;t.FieldName="";t.Label="";System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,s,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=new Core.Clients.Client.$ctor1("Component").CreateAsync$1(t),n=1,r.isCompleted())continue;r["continue"](o);return;case 1:f=r.getAwaitedResult();s=f;this.UpdateRender(t,i);Core.Extensions.Toast.Success("Tạo thành công!");u.setResult(null);return;default:u.setResult(null);return}}}catch(h){e=System.Exception.create(h);u.setException(e)}},arguments);return o(),u.task}));break;case"AddInput":t.ComponentType="Input";t.Visibility=!0;t.Order=r;t.ComponentGroupId=i.Id;t.FieldName="";t.Label="";System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,s,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=new Core.Clients.Client.$ctor1("Component").CreateAsync$1(t),n=1,r.isCompleted())continue;r["continue"](o);return;case 1:f=r.getAwaitedResult();s=f;this.UpdateRender(t,i);Core.Extensions.Toast.Success("Tạo thành công!");u.setResult(null);return;default:u.setResult(null);return}}}catch(h){e=System.Exception.create(h);u.setException(e)}},arguments);return o(),u.task}));break;case"AddTimepicker":t.ComponentType="Timepicker";t.Visibility=!0;t.Order=r;t.ComponentGroupId=i.Id;t.FieldName="";t.Label="";System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,s,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=new Core.Clients.Client.$ctor1("Component").CreateAsync$1(t),n=1,r.isCompleted())continue;r["continue"](o);return;case 1:f=r.getAwaitedResult();s=f;this.UpdateRender(t,i);Core.Extensions.Toast.Success("Tạo thành công!");u.setResult(null);return;default:u.setResult(null);return}}}catch(h){e=System.Exception.create(h);u.setException(e)}},arguments);return o(),u.task}));break;case"AddPassword":t.ComponentType="Password";t.Visibility=!0;t.Order=r;t.ComponentGroupId=i.Id;t.FieldName="";t.Label="";System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,s,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=new Core.Clients.Client.$ctor1("Component").CreateAsync$1(t),n=1,r.isCompleted())continue;r["continue"](o);return;case 1:f=r.getAwaitedResult();s=f;this.UpdateRender(t,i);Core.Extensions.Toast.Success("Tạo thành công!");u.setResult(null);return;default:u.setResult(null);return}}}catch(h){e=System.Exception.create(h);u.setException(e)}},arguments);return o(),u.task}));break;case"AddLabel":t.ComponentType="Label";t.Visibility=!0;t.Order=r;t.ComponentGroupId=i.Id;t.FieldName="";t.ShowLabel=!0;f=(u=new Core.Components.Forms.ConfirmDialog,u.NeedAnswer=!0,u.ComType="Textbox",u.Content="Hãy nhập label?",u);f.Render();f.YesConfirmed=Bridge.fn.combine(f.YesConfirmed,Bridge.fn.bind(this,function(){var n;t.Label=(n=f.Textbox)!=null?n.Text:null;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,e,o,s=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=new Core.Clients.Client.$ctor1("Component").CreateAsync(Core.Models.Component,t),n=1,r.isCompleted())continue;r["continue"](s);return;case 1:f=r.getAwaitedResult();e=f;this.UpdateRender(e,i);Core.Extensions.Toast.Success("Tạo thành công!");u.setResult(null);return;default:u.setResult(null);return}}}catch(h){o=System.Exception.create(h);u.setException(o)}},arguments);return s(),u.task}))}));break;case"AddTextarea":t.ComponentType="Textarea";t.Visibility=!0;t.Order=r;t.ComponentGroupId=i.Id;t.FieldName="";t.Label="";System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,s,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=new Core.Clients.Client.$ctor1("Component").CreateAsync$1(t),n=1,r.isCompleted())continue;r["continue"](o);return;case 1:f=r.getAwaitedResult();s=f;this.UpdateRender(t,i);Core.Extensions.Toast.Success("Tạo thành công!");u.setResult(null);return;default:u.setResult(null);return}}}catch(h){e=System.Exception.create(h);u.setException(e)}},arguments);return o(),u.task}));break;case"AddDropdown":t.ComponentType="Dropdown";t.Visibility=!0;t.Order=r;t.ComponentGroupId=i.Id;t.FieldName="";t.Label="";System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,s,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=new Core.Clients.Client.$ctor1("Component").CreateAsync$1(t),n=1,r.isCompleted())continue;r["continue"](o);return;case 1:f=r.getAwaitedResult();s=f;this.UpdateRender(t,i);Core.Extensions.Toast.Success("Tạo thành công!");u.setResult(null);return;default:u.setResult(null);return}}}catch(h){e=System.Exception.create(h);u.setException(e)}},arguments);return o(),u.task}));break;case"AddImage":t.ComponentType="Image";t.Visibility=!0;t.Order=r;t.ComponentGroupId=i.Id;t.FieldName="";t.Label="";System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,s,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=new Core.Clients.Client.$ctor1("Component").CreateAsync$1(t),n=1,r.isCompleted())continue;r["continue"](o);return;case 1:f=r.getAwaitedResult();s=f;this.UpdateRender(t,i);Core.Extensions.Toast.Success("Tạo thành công!");u.setResult(null);return;default:u.setResult(null);return}}}catch(h){e=System.Exception.create(h);u.setException(e)}},arguments);return o(),u.task}));break;case"AddGridView":t.ComponentType="GridView";t.Visibility=!0;t.DataSourceFilter="?$filter=Active eq true";t.Label="";t.ComponentGroupId=i.Id;t.Order=r;t.FieldName="";System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,s,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=new Core.Clients.Client.$ctor1("Component").CreateAsync$1(t),n=1,r.isCompleted())continue;r["continue"](o);return;case 1:f=r.getAwaitedResult();s=f;this.UpdateRender(t,i);Core.Extensions.Toast.Success("Tạo thành công!");u.setResult(null);return;default:u.setResult(null);return}}}catch(h){e=System.Exception.create(h);u.setException(e)}},arguments);return o(),u.task}));break;case"AddListView":t.ComponentType="ListView";t.Visibility=!0;t.DataSourceFilter="?$filter=Active eq true";t.Label="";t.ComponentGroupId=i.Id;t.Order=r;t.FieldName="";System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,s,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=new Core.Clients.Client.$ctor1("Component").CreateAsync$1(t),n=1,r.isCompleted())continue;r["continue"](o);return;case 1:f=r.getAwaitedResult();s=f;this.UpdateRender(t,i);Core.Extensions.Toast.Success("Tạo thành công!");u.setResult(null);return;default:u.setResult(null);return}}}catch(h){e=System.Exception.create(h);u.setException(e)}},arguments);return o(),u.task}))}},UpdateRender:function(n,t){var i=Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section,this,t.Name),r=Core.Components.Extensions.ComponentFactory.GetComponent(n,this.EditForm);r.ParentElement=i.Element;i.AddChild(r)},SectionProperties:function(n){var t,i=Core.Extensions.BridgeExt.CastProp(Core.Models.ComponentGroup,n),r;i.InverseParent=null;r=(t=new Core.Components.Framework.ComponentGroupBL,t.Entity=i,t.ParentElement=this.Element,t.OpenFrom=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm,this),t);this.AddChild(r)},CloneProperties:function(n){var t=Core.Extensions.BridgeExt.CastProp(Core.Models.ComponentGroup,n);Core.Components.Forms.ConfirmDialog.RenderConfirm(System.String.format("Clone the section CG{0:0000000}?",[Bridge.box(t.Id,System.Int32)]),Bridge.fn.bind(this,function(){var n=0,i,u,r=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t.InverseParent=null,t.Component=null,t.Id=0,i=new Core.Clients.Client.$ctor1("ComponentGroup").CreateAsync$1(t),n=1,i.isCompleted())continue;i["continue"](r);return;case 1:u=i.getAwaitedResult();Core.Extensions.Toast.Success("Clone thành công");return;default:return}}},arguments);r()}))},FeatureProperties:function(){var n=(this.Feature.Name||"")+"Prop"+this.Feature.Id;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,f,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.OpenPopup(this,"FeatureEditor",Bridge.fn.bind(this,function(){var t=Bridge.Reflection.getType("Core.Components.Framework.FeatureDetailBL"),n=Bridge.as(Bridge.createInstance(t),Core.Components.Forms.PopupEditor);return n.Title="Feature configuration",n.Entity=this.Feature,n.ParentElement=this.TabEditor.Element,n}),!1,!1),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:f=t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(e){r=System.Exception.create(e);i.setException(r)}},arguments);return u(),i.task}))},SecurityRecord:function(n){var t,i=(t=new Core.Components.SecurityBL,t.Entity=n,t.ParentElement=this.Element,t);this.TabEditor.AddChild(i)},Cancel:function(){this.DirtyCheckAndCancel()},CancelWithoutAsk:function(){this.Dispose()},Dispose:function(){this.Client=null;window.removeEventListener("resize",Bridge.fn.cacheBind(this,this.ResizeHandler));Core.Components.EditableComponent.prototype.Dispose.call(this)},DirtyCheckAndCancel:function(){this.DirtyCheckAndCancel$1(null)},DirtyCheckAndCancel$1:function(n){var t;if(!this.Dirty){this.Dispose();return}this._confirm=(t=new Core.Components.Forms.ConfirmDialog,t.Content="Bạn có muốn lưu dữ liệu trước khi đóng?",t);this._confirm.YesConfirmed=Bridge.fn.combine(this._confirm.YesConfirmed,Bridge.fn.bind(this,function(){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.SaveAndLeaveAsync(),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();Bridge.staticEquals(n,null)?null:n();return;default:return}}},arguments);r()}));this._confirm.NoConfirmed=Bridge.fn.combine(this._confirm.NoConfirmed,Bridge.fn.bind(this,function(){this.Dispose();Bridge.staticEquals(n,null)?null:n()}));this._confirm.IgnoreCancelButton=!0;this._confirm.Render()},SaveAndLeaveAsync:function(){var t=0,i,r,n=new System.Threading.Tasks.TaskCompletionSource,u,f,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.Save(),t=1,i.isCompleted())continue;i["continue"](e);return;case 1:if(r=i.getAwaitedResult(),u=r,!u){n.setResult(null);return}this.Dispose();n.setResult(null);return;default:n.setResult(null);return}}}catch(o){f=System.Exception.create(o);n.setException(f)}},arguments);return e(),n.task},EmailPdf:function(n,t){var i=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,e,o,s,h=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(t===void 0&&(t=[]),n==null)throw new System.ArgumentNullException.$ctor1("email");if(Core.Extensions.IEnumerableExtensions.HasElement(System.String,t)&&(e=System.Linq.Enumerable.from(t,System.String).select(Bridge.fn.bind(this,function(n){var t=Bridge.as(this.Element.querySelector(n),HTMLElement);return Core.Components.Forms.EditForm.PrintSection(t,!1)})),n.PdfText.AddRange(e)),r=this.Client.PostAsync(System.Boolean,n,"EmailAttached",!1,!0),i=1,r.isCompleted())continue;r["continue"](h);return;case 1:f=r.getAwaitedResult();o=f;o&&Core.Extensions.Toast.Success("Gởi email thành công!");u.setResult(null);return;default:u.setResult(null);return}}}catch(c){s=System.Exception.create(c);u.setException(s)}},arguments);return h(),u.task},Print:function(n){n===void 0&&(n=".printable");var t=Bridge.as(this.Element.querySelector(n),HTMLElement);Core.Components.Forms.EditForm.PrintSection(t)},Focus:function(){var n=Core.Components.Extensions.ComponentExt.FirstOrDefault(this,function(n){return n.GuiInfo!=null&&n.GuiInfo.Focus});n==null?this.Element.focus():n.Focus();this.ResizeHandler()},UpdateViewByName:function(n){(n===void 0&&(n=[]),Core.Extensions.IEnumerableExtensions.Nothing(System.String,n))||this.FilterChildren$1(function(t){return System.Array.contains(n,t.Name,System.String)&&t.UpdateView(),!1})},ResizeHandler:function(){this.ResizeTabGroup();this.ResizeListView()},ResizeListView:function(){var t=System.Linq.Enumerable.from(this.ListViews,Core.Components.ListView).firstOrDefault(function(n){return!Core.Extensions.HtmlElementExtension.Hidden(n.Element)},null),n,i;t!=null&&(n=System.Linq.Enumerable.from(t.Parent.Children,Core.Components.EditableComponent).where(function(n){return Bridge.Reflection.isAssignableFrom(Core.Components.ListView,Bridge.getType(n))}),i=n.any(function(n){return System.String.contains(n.Name,"Mobile")}),n.forEach(Bridge.fn.bind(this,function(n){i?(n.Show=Core.Components.EditableComponent.IsSmallUp?!System.String.contains(n.Name,"Mobile"):System.String.contains(n.Name,"Mobile"),n.Show&&(this._currentListView=Bridge.as(n,Core.Components.ListView))):this._currentListView=Bridge.as(n,Core.Components.ListView)})))},ResizeTabGroup:function(){this.Element!=null&&Core.Extensions.HtmlElementExtension.HasClass(this.Element,"mobile")||Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.Forms.TabGroup,this.TabGroup)||this.TabGroup.ForEach(function(n){n!=null&&n.Element!=null&&(Core.Components.EditableComponent.IsLargeUp&&n.ComponentGroup.Responsive&&Core.Extensions.HtmlElementExtension.HasClass(n.Element.parentElement,"tab-horizontal")?Core.Extensions.HtmlElementExtension.ReplaceClass(n.Element.parentElement,"tab-horizontal","tab-vertical"):!Core.Components.EditableComponent.IsLargeUp&&n.ComponentGroup.Responsive&&Core.Extensions.HtmlElementExtension.HasClass(n.Element.parentElement,"tab-vertical")&&Core.Extensions.HtmlElementExtension.ReplaceClass(n.Element.parentElement,"tab-vertical","tab-horizontal"))})},SetExpired:function(){var n,t=(n=new Core.Components.Forms.ConfirmDialog,n.Content="Bạn có chắc chắn muốn cài đặt hết hạn?",n);t.Render();t.YesConfirmed=Bridge.fn.combine(t.YesConfirmed,Bridge.fn.bind(this,function(){var n=0,t,r,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(Core.Extensions.ReflectionExt.ClearReferences(this.Entity),Core.Extensions.BridgeExt.SetPropValue(this.Entity,Core.Components.Forms.EditForm.ExpiredDate,Bridge.box(System.DateTime.getNow(),System.DateTime,System.DateTime.format)),this.UpdateView(!1,void 0,[Core.Components.Forms.EditForm.ExpiredDate]),t=this.AddOrUpdate(Bridge.box(!0,System.Boolean,System.Boolean.toString)),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:r=t.getAwaitedResult();return;default:return}}},arguments);i()}))},RequestApprove:function(){var t=0,i,f,n=new System.Threading.Tasks.TaskCompletionSource,e,r,u,o,s=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.IsFormValid(),t=1,i.isCompleted())continue;i["continue"](s);return;case 1:if(f=i.getAwaitedResult(),e=f,!e){n.setResult(null);return}r=(u=new Core.Components.Forms.ConfirmDialog,u.Content="Bạn có chắc chắn gửi yêu cầu phê duyệt?",u);r.Render();r.YesConfirmed=Bridge.fn.combine(r.YesConfirmed,Bridge.fn.bind(this,function(){var n=0,t,e,i,u,f,r=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1,2,3,4],n);switch(n){case 0:if(Core.Extensions.ReflectionExt.ClearReferences(this.Entity),Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField])<=0){n=1;continue}n=3;continue;case 1:if(t=this.Save(),n=2,t.isCompleted())continue;t["continue"](r);return;case 2:e=t.getAwaitedResult();n=3;continue;case 3:if(i=this.RequestApprove$1(this.Entity),n=4,i.isCompleted())continue;i["continue"](r);return;case 4:u=i.getAwaitedResult();f=u;this.ProcessEnumMessage(Bridge.box(f,System.Boolean,System.Boolean.toString));return;default:return}}},arguments);r()}));n.setResult(null);return;default:n.setResult(null);return}}}catch(h){o=System.Exception.create(h);n.setException(o)}},arguments);return s(),n.task},RequestApprove$1:function(n){var t=0,i,u,r=new System.Threading.Tasks.TaskCompletionSource,f,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(Core.Extensions.BridgeExt.SetPropValue(n,Core.Components.Forms.EditForm.StatusIdField,Bridge.box(Core.Enums.ApprovalStatusEnum.Approving,System.Int32)),i=this.Client.PostAsync(System.Boolean,n,"RequestApprove"),t=1,i.isCompleted())continue;i["continue"](o);return;case 1:u=i.getAwaitedResult();f=u;r.setResult(f);return;default:r.setResult(null);return}}}catch(s){e=System.Exception.create(s);r.setException(e)}},arguments);return o(),r.task},Delete:function(){var n,t=(n=new Core.Components.Forms.ConfirmDialog,n.Content="Bạn có chắc chắn xóa không?",n);t.Render();t.YesConfirmed=Bridge.fn.combine(t.YesConfirmed,Bridge.fn.bind(this,function(){var n=0,t,i,r,u=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.Client.HardDeleteAsync(Bridge.fn.bind(this,function(n){return n.add(System.Int32.parse(Bridge.toString(this.Entity[Core.Components.EditableComponent.IdField]))),n})(new(System.Collections.Generic.List$1(System.Int32).ctor))),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:i=t.getAwaitedResult();r=i;r?(this.ParentForm.UpdateView$1(!0),this.Dispose(),Core.Extensions.Toast.Success("Xóa dữ liệu thành công")):Core.Extensions.Toast.Warning("Xóa không thành công");return;default:return}}},arguments);u()}))},ProcessEnumMessage:function(n,t){var i;(t===void 0&&(t=!0),n!=null)&&(t&&Core.Extensions.Toast.Success(Core.Extensions.ReflectionExt.GetEnumDescription(Bridge.box(Core.Enums.ResponseApproveEnum.Success,Core.Enums.ResponseApproveEnum,System.Enum.toStringFn(Core.Enums.ResponseApproveEnum)))),Bridge.is(n,System.Boolean)||Core.Extensions.ReflectionExt.CopyPropFrom$1(this.Entity,n),(i=this.ParentForm)!=null?i.UpdateView$1(!0):null,this.Dispose())},Approve:function(){var t=0,i,f,n=new System.Threading.Tasks.TaskCompletionSource,e,r,u,o,s=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.IsFormValid(),t=1,i.isCompleted())continue;i["continue"](s);return;case 1:if(f=i.getAwaitedResult(),e=f,!e){n.setResult(null);return}r=(u=new Core.Components.Forms.ConfirmDialog,u.Content="Bạn có chắc chắn muốn duyệt?",u);r.Render();r.YesConfirmed=Bridge.fn.combine(r.YesConfirmed,Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.ApproveConfirmed(),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()}));n.setResult(null);return;default:n.setResult(null);return}}}catch(h){o=System.Exception.create(h);n.setException(o)}},arguments);return s(),n.task},Approve$1:function(n){var t=0,i,u,r=new System.Threading.Tasks.TaskCompletionSource,f,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.Client.CreateAsync(System.Boolean,n,"Approve"),t=1,i.isCompleted())continue;i["continue"](o);return;case 1:u=i.getAwaitedResult();f=u;this.ProcessEnumMessage(Bridge.box(f,System.Boolean,System.Boolean.toString));r.setResult(null);return;default:r.setResult(null);return}}}catch(s){e=System.Exception.create(s);r.setException(e)}},arguments);return o(),r.task},ApproveConfirmed:function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.Approve$1(this.Entity),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task},Reject:function(){var n,t=(n=new Core.Components.Forms.ConfirmDialog,n.NeedAnswer=!0,n.ComType="Textbox",n.Content=(System.String.format("Bạn có chắc chắn muốn trả về?<br />",null)||"")+"Hãy nhập lý do trả về",n);t.Render();t.YesConfirmed=Bridge.fn.combine(t.YesConfirmed,Bridge.fn.bind(this,function(){var n=0,i,r,u,f,e=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(Core.Extensions.ReflectionExt.ClearReferences(this.Entity),i=this.Client.CreateAsync(System.Object,this.Entity,"Reject?reasonOfChange="+(((f=t.Textbox)!=null?f.Text:null)||"")),n=1,i.isCompleted())continue;i["continue"](e);return;case 1:r=i.getAwaitedResult();u=r;this.ProcessEnumMessage(u);return;default:return}}},arguments);e()}))},ToggleApprovalBtn:function(n){var t,i,r;(n===void 0&&(n=null),n=(t=n,t!=null?t:this.Entity),n!=null)&&(i=Bridge.unbox(n[Core.Components.Forms.EditForm.StatusIdField]),Core.Components.Extensions.ComponentExt.SetShow(this,!1,[Core.Components.Forms.EditForm.BtnSend,Core.Components.Forms.EditForm.BtnApprove,Core.Components.Forms.EditForm.BtnReject,Core.Components.Forms.EditForm.BtnExpired]),i===Core.Enums.ApprovalStatusEnum.Approved?(this.LockUpdateButCancel(),Core.Components.Extensions.ComponentExt.SetShow(this,!1,[Core.Components.Forms.EditForm.BtnSave,Core.Components.Forms.EditForm.BtnSend,Core.Components.Forms.EditForm.BtnApprove,Core.Components.Forms.EditForm.BtnReject]),r=Bridge.unbox(n[Core.Components.Forms.EditForm.ExpiredDate]),Bridge.equals(r,null)&&(Core.Components.Extensions.ComponentExt.SetShow(this,!0,[Core.Components.Forms.EditForm.BtnExpired]),Core.Components.Extensions.ComponentExt.SetDisabled$1(this,!1,[Core.Components.Forms.EditForm.BtnExpired]))):i===Core.Enums.ApprovalStatusEnum.Approving?(Core.Components.Extensions.ComponentExt.SetShow(this,!0,[Core.Components.Forms.EditForm.BtnApprove,Core.Components.Forms.EditForm.BtnReject]),Core.Components.Extensions.ComponentExt.SetShow(this,!1,[Core.Components.Forms.EditForm.BtnSend])):Core.Components.Extensions.ComponentExt.SetShow(this,!0,[Core.Components.Forms.EditForm.BtnSend]))},CreateFeaturePolicyHeader:function(n){this.CreateFeaturePolicy(n,n.FeatureId,n.Id)},CreateFeaturePolicySection:function(n){this.CreateFeaturePolicy(n,n.FeatureId)},CreateFeaturePolicyComponent:function(n){var t=0,i,u,r=new System.Threading.Tasks.TaskCompletionSource,f,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=new Core.Clients.Client.$ctor1("ComponentGroup",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetAsync(Core.Models.ComponentGroup,n.ComponentGroupId),t=1,i.isCompleted())continue;i["continue"](o);return;case 1:u=i.getAwaitedResult();f=u;this.CreateFeaturePolicy(n,f.FeatureId);r.setResult(null);return;default:r.setResult(null);return}}}catch(s){e=System.Exception.create(s);r.setException(e)}},arguments);return o(),r.task},CreateFeaturePolicy:function(n,t,i){var f,r,e,o;t===void 0&&(t=null);i===void 0&&(i=null);var h=Bridge.is(n,Core.ViewModels.SecurityVM),s,c=(s=Bridge.as(n,Core.ViewModels.SecurityVM))!=null?s:null,l=Bridge.is(n,Core.Models.Component)?Core.Extensions.Utils.ComponentId:Bridge.is(n,Core.Models.ComponentGroup)?Core.Extensions.Utils.ComponentGroupId:Core.Extensions.Utils.GridPolicyId,u=(f=new Core.Components.SecurityEditorBL,f.Entity=c||(r=new Core.ViewModels.SecurityVM,r.FeatureId=t,r.EntityId=l,r.RecordIds=System.Array.init([(e=i,e!=null?e:(o=Bridge.unbox(n[Core.Components.EditableComponent.IdField]),o!=null?o:0))],System.Int32),r),f);u.DOMContentLoaded=Bridge.fn.combine(u.DOMContentLoaded,Bridge.fn.bind(this,function(){Core.Components.Extensions.ComponentExt.SetShow(this,!1,["RecordId"])}));u.AfterSaved=Bridge.fn.combine(u.AfterSaved,Bridge.fn.bind(this,function(){var t=0,i,u,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(h)return;if(Core.Extensions.BridgeExt.SetPropValue(n,"IsPrivate",Bridge.box(!0,System.Boolean,System.Boolean.toString)),this.UpdateView(!1,void 0,["IsPrivate"]),i=this.Save(Bridge.box(!1,System.Boolean,System.Boolean.toString)),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:u=i.getAwaitedResult();return;default:return}}},arguments);r()}));Core.Components.Forms.TabEditor.ActiveTab.AddChild(u)},SignIn:function(){Bridge.staticEquals(Core.Clients.Client.UnAuthorizedEventHandler,null)?null:Core.Clients.Client.UnAuthorizedEventHandler(null)},SignOut:function(){var n=0,t,h,i,r=new System.Threading.Tasks.TaskCompletionSource,f,e,o,s,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2],n);switch(n){case 0:if(f=Bridge.as(window.event,Event),f.preventDefault(),e=new Core.Clients.Client.$ctor1("User"),t=e.CreateAsync(System.Boolean,Core.Clients.Client.Token,"SignOut"),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:if(h=t.getAwaitedResult(),Core.Extensions.Toast.Success("Bạn đã đăng xuất!",3e3),Bridge.staticEquals(Core.Clients.Client.SignOutEventHandler,null)?null:Core.Clients.Client.SignOutEventHandler(),Core.Clients.Client.Token=null,Core.Components.Forms.EditForm.NotificationClient!=null?Core.Components.Forms.EditForm.NotificationClient.Close():null,i=System.Threading.Tasks.Task.delay(1e3),n=2,i.isCompleted())continue;i["continue"](u);return;case 2:i.getAwaitedResult();(o=Core.Components.Forms.EditForm.LayoutForm)!=null?o.UpdateView():null;window.location.reload();r.setResult(null);return;default:r.setResult(null);return}}}catch(c){s=System.Exception.create(c);r.setException(s)}},arguments);return u(),r.task}}});Bridge.define("$AnonymousType$1",n,{$kind:"anonymous",ctors:{ctor:function(n,t){this.group=n;this.action=t}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$1)?Bridge.equals(this.group,t.group)&&Bridge.equals(this.action,t.action):!1},getHashCode:function(){return Bridge.addHash([7550196186,this.group,this.action])},toJSON:function(){return{group:this.group,action:this.action}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"action",t:16,rt:System.String,g:{a:2,n:"get_action",t:8,rt:System.String,fg:"action"},fn:"action"},{a:2,n:"group",t:16,rt:Core.Models.ComponentGroup,g:{a:2,n:"get_group",t:8,rt:Core.Models.ComponentGroup,fg:"group"},fn:"group"}]}}}}});Bridge.define("Core.Components.BarCode",{inherits:[Core.Components.EditableComponent],props:{Value:null},ctors:{ctor:function(n,t){this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.ParentElement=t;this.GuiInfo=n||function(){throw new System.ArgumentNullException.$ctor1("ui");}()}},methods:{Render:function(){var n;Core.MVVM.Html.Take(this.ParentElement).Clear().Div.Style$1(System.String.format("width:{0}px;margin:auto",[this.GuiInfo.Width])).Id("barcode"+this.GuiInfo.Id);this.Element=Core.MVVM.Html.Context;this.Value=(n=Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName))!=null?Bridge.toString(n):null;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,f,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Clients.Client.LoadScript("/js/qrcode.min.js"),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:f=t.getAwaitedResult();new QRCode("barcode"+this.GuiInfo.Id,{text:value,width:this.GuiInfo.Width,height:this.GuiInfo.Width,colorDark:"#000000",colorLight:"#ffffff"});i.setResult(null);return;default:i.setResult(null);return}}}catch(e){r=System.Exception.create(e);i.setException(r)}},arguments);return u(),i.task}))},UpdateView:function(n,t,i){var r,u;(n===void 0&&(n=!1),t===void 0&&(t=null),i===void 0&&(i=[]),u=(r=Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName))!=null?Bridge.toString(r):null,Bridge.referenceEquals(u,this.Value))||this.Render()}}});Bridge.define("Core.Components.Button",{inherits:[Core.Components.EditableComponent],fields:{_textEle:null},props:{ButtonEle:null,Label:{get:function(){return this._textEle!=null?this._textEle.textContent:null},set:function(n){if(this.Element==null)throw new System.InvalidOperationException.$ctor1("Element is null");this._textEle.textContent=n}}},ctors:{ctor:function(n,t){t===void 0&&(t=null);this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.GuiInfo=n||function(){throw new System.ArgumentNullException.$ctor1("ui");}();this.ButtonEle=t}},methods:{Render:function(){var n,t,i,r=Core.MVVM.Html.Instance;this.ButtonEle==null?(Core.MVVM.Html.Take(this.ParentElement).Button.Render(),this.Element=(n=Core.MVVM.Html.Context,this.ButtonEle=n,n)):this.Element=this.ButtonEle;Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element),this.GuiInfo.ClassName).AsyncEvent("click",Bridge.fn.cacheBind(this,this.DispatchClickAsync)).Style$1(this.GuiInfo.Style);System.String.isNullOrEmpty(this.GuiInfo.Icon)||Core.Components.Renderer.Icon(r,this.GuiInfo.Icon).End.Text(" ").Render();Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(r.Span,"caption"),(t=this.GuiInfo.Label,t!=null?t:""));this._textEle=Bridge.as(Core.MVVM.Html.Context,HTMLSpanElement);Bridge.staticEquals(i=this.DOMContentLoaded,null)?null:i()},DispatchClickAsync:function(){var n=0,i,u,t=new System.Threading.Tasks.TaskCompletionSource,e,r,f=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4],n);switch(n){case 0:if(this.Disabled||Core.Extensions.HtmlElementExtension.Hidden(this.Element)){t.setResult(null);return}this.Disabled=!0;n=1;continue;case 1:if(Core.Components.Spinner.AppendTo(this.Element),i=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"click",[this.Entity,this]),n=2,i.isCompleted())continue;i["continue"](f);return;case 2:i.getAwaitedResult();n=3;continue;case 3:if(Core.Components.Spinner.Hide(),this.Disabled=!1,u>-1)n=u,u=null;else{if(r){t.setException(r);return}if(Bridge.isDefined(e)){t.setResult(e);return}}n=4;continue;case 4:t.setResult(null);return;default:t.setResult(null);return}}}catch(o){if(r=System.Exception.create(o),n>=1&&n<=2){n=3;f();return}t.setException(r)}},arguments);return f(),t.task},GetValueText:function(){var n;return this.Entity==null||this.GuiInfo==null?this._textEle.textContent:(n=this.Entity[this.GuiInfo.FieldName])!=null?Bridge.toString(n):null},BuildTextHistory:function(n,t){return n===void 0&&(n=null),t===void 0&&(t=null),n}}});Bridge.define("Core.Components.CellText",{inherits:[Core.Components.EditableComponent],statics:{methods:{CalcTextAlign:function(n,t){var i=n.TextAlignEnum;return i!=null?System.Nullable.getValue(i):n.ReferenceId!=null||t==null||Bridge.is(t,System.String)?Core.Enums.TextAlign.left:Core.Extensions.ReflectionExt.IsNumber(Bridge.getType(t))?Core.Enums.TextAlign.right:(Bridge.is(t,System.Boolean)||Bridge.is(t,System.Boolean),Core.Enums.TextAlign.center)}}},props:{RefData:null},ctors:{ctor:function(n,t){t===void 0&&(t=null);this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.GuiInfo=n;this.Element=t}},methods:{Render:function(){this.SetDefaultVal();var n=Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName),i=n!=null&&Core.Extensions.ReflectionExt.IsBool(Bridge.getType(n)),t="";if(this.Element==null&&this.RenderNewEle(t,n,i),Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.Query)){System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this,this.RenderCellTextAsync));return}t=this.CalcCellText(n);this.UpdateEle(t,n,i);this.Element.parentElement.tabIndex=-1},UpdateEle:function(n,t,i){if(i){this.GuiInfo.SimpleText?this.Element.innerHTML=System.Nullable.eq(Bridge.cast(Bridge.unbox(t,System.Boolean),System.Boolean,!0),!0)?"☑":"☐":this.Element.previousElementSibling.checked=System.Nullable.getValue(Bridge.cast(Bridge.unbox(t,System.Boolean),System.Boolean));return}this.Element.innerHTML=n;this.Element.setAttribute("title",n)},RenderNewEle:function(n,t,i){if(Core.Components.Renderer.TextAlign(Core.MVVM.Html.Take(this.ParentElement),Core.Components.CellText.CalcTextAlign(this.GuiInfo,t)),i)this.GuiInfo.SimpleText?(Core.MVVM.Html.Instance.Text(System.Nullable.eq(Bridge.cast(Bridge.unbox(t,System.Boolean),System.Boolean,!0),!0)?"☑":"☐"),Core.MVVM.Html.Context.style.fontSize="1.2rem"):(Core.Components.Renderer.SmallCheckbox(Core.Components.Renderer.Padding(Core.MVVM.Html.Instance,Core.Components.Direction.bottom,0),System.Nullable.getValue(Bridge.cast(Bridge.unbox(Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName),System.Boolean),System.Boolean))),Core.MVVM.Html.Context.previousElementSibling.disabled=!0);else{var r=Bridge.referenceEquals(n.substr(0,4),"<div>");r?Core.MVVM.Html.Instance.Div.Render():Core.MVVM.Html.Instance.Span.Render();Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.AsyncEvent$1("click",Bridge.fn.cacheBind(this,this.LabelClickHandler)),"cell-text").InnerHTML(n)}this.Element=Core.MVVM.Html.Context;Core.MVVM.Html.Instance.End.Render()},CalcCellText:function(n){var t=null,i,u,f,r;if(this.GuiInfo.IsPivot){if((i=this.GuiInfo.FieldName.split("."),i.length<3)||!((u=Bridge.as(Core.Extensions.Utils.GetComplexPropValue(this.Entity,i[System.Array.index(0,i)]),System.Collections.Generic.IEnumerable$1(System.Object)))!=null))return t;f=Bridge.toArray(System.Linq.Enumerable.from(i,System.String).skip(1).take(i.length-2|0)).join(".");r=System.Linq.Enumerable.from(u,System.Object).firstOrDefault(function(n){var t;return Bridge.referenceEquals((t=Core.Extensions.Utils.GetComplexPropValue(n,f))!=null?Bridge.toString(t):null,Bridge.toString(System.Linq.Enumerable.from(i,System.String).last()))},null);t=r==null?"":Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.FormatEntity,r)}else t=Core.Extensions.Utils.GetCellText(this.GuiInfo,n,this.Entity,this.RefData,!1,this.EmptyRow);return(t==null||Bridge.referenceEquals(t,"null"))&&(t="N/A"),t},RenderCellTextAsync:function(){var i=0,r,e,n=new System.Threading.Tasks.TaskCompletionSource,f,o,s,t,u,h,c,l,a=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.Query)){n.setResult(null);return}if(f={},o=Core.Extensions.Utils.IsFunction(this.GuiInfo.Query,f),s=o?Bridge.toString(f.v.call(this,Bridge.unbox(this.Entity),this)):Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.Query,this.Entity),r=new Core.Clients.Client.$ctor1("User",Bridge.Reflection.getTypeNamespace(Core.Models.User)).PostAsync(System.Array.type(System.Object),s,"ReportQuery"),i=1,r.isCompleted())continue;r["continue"](a);return;case 1:if(e=r.getAwaitedResult(),t=e,Core.Extensions.IEnumerableExtensions.Nothing(System.Object,t)){n.setResult(null);return}u={};h=Core.Extensions.Utils.IsFunction(this.GuiInfo.FormatEntity,u);c=h?Bridge.toString(u.v.apply.apply(u.v,[this].concat([Bridge.unbox(System.Array.init([t],System.Object))]))):Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.FormatEntity,t[System.Array.index(0,t)]);this.UpdateEle(c,null,!1);n.setResult(null);return;default:n.setResult(null);return}}}catch(v){l=System.Exception.create(v);n.setException(l)}},arguments);return a(),n.task},LabelClickHandler:function(){return Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"click",[this.Entity])},UpdateView:function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);this.PrepareUpdateView(n,t);this.Render()}}});Bridge.define("Core.Components.Chart",{inherits:[Core.Components.EditableComponent],props:{Data:null},ctors:{ctor:function(n){this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.GuiInfo=n||function(){throw new System.ArgumentNullException.$ctor1("ui");}()}},methods:{Render:function(){this.AddElement();System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,o,i,r,u=new System.Threading.Tasks.TaskCompletionSource,e,f=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3],n);switch(n){case 0:if(t=Core.Clients.Client.LoadScript("/js/canvasjs.min.js"),n=1,t.isCompleted())continue;t["continue"](f);return;case 1:if(o=t.getAwaitedResult(),i=System.Threading.Tasks.Task.delay(1e3),n=2,i.isCompleted())continue;i["continue"](f);return;case 2:if(i.getAwaitedResult(),r=this.RenderAsync(),n=3,r.isCompleted())continue;r["continue"](f);return;case 3:r.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(s){e=System.Exception.create(s);u.setException(e)}},arguments);return f(),u.task}))},AddElement:function(){this.Element==null&&(this.Element=Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Div,"chart-wrapper").GetContext())},RenderAsync:function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u,f=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.RenderChart(),n=1,t.isCompleted())continue;t["continue"](f);return;case 1:t.getAwaitedResult();Bridge.staticEquals(r=this.DOMContentLoaded,null)?null:r();i.setResult(null);return;default:i.setResult(null);return}}}catch(e){u=System.Exception.create(e);i.setException(u)}},arguments);return f(),i.task},RenderChart:function(){var t=0,r,c,u=new System.Threading.Tasks.TaskCompletionSource,o,l,a,f,s,v,i,e,h,y,p=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3],t);switch(t){case 0:if(this.AddElement(),o={},l=Core.Extensions.Utils.IsFunction(this.GuiInfo.Query,o),a=l?Bridge.toString(o.v.call(this,Bridge.unbox(this.Entity),this)):Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.Query,this.Entity),this.Data==null){t=1;continue}t=3;continue;case 1:if(r=new Core.Clients.Client.$ctor1("User").PostAsync(System.Array.type(System.Object),a,"ReportQuery"),t=2,r.isCompleted())continue;r["continue"](p);return;case 2:c=r.getAwaitedResult();this.Data=c;t=3;continue;case 3:f=(s=this.GuiInfo.ClassName,s!=null?s:"pie");v=this.GuiInfo.PlainText;i=null;i=Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.FormatData)?{theme:"light2",animationEnabled:!0,showInLegend:"true",legendText:"{name}",title:{text:v,fontFamily:"roboto",fontSize:15},data:[{type:f,toolTipContent:"{label} {y}",dataPoints:this.Data}],legend:{cursor:"pointer",fontSize:9,fontFamily:"roboto"}}:Newtonsoft.Json.JsonConvert.DeserializeObject(this.GuiInfo.FormatData,System.Object);e={};h=Core.Extensions.Utils.IsFunction(this.GuiInfo.FormatEntity,e);i.data=h||Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.GroupBy)?h?e.v.call.apply(e.v,[this].concat(Bridge.unbox(this.Data))):System.Array.init([new n.$AnonymousType$4(f,"{label} {y}",this.Data)],System.Object):System.Linq.Enumerable.from(this.Data,System.Object).select(function(n){var t;return n.type=(t=n.type,t!=null?t:f),n}).groupBy(function(t){var i,r;return new n.$AnonymousType$2(Bridge.toString(t.type),(i=t.name)!=null?Bridge.toString(i):null,(r=t.axisYType)!=null?Bridge.toString(r):null)}).select(function(t){return new n.$AnonymousType$3(t.key().type,t.firstOrDefault(null,null).toolTipContent,t.key().axisYType,t.ToArray(System.Object))}).ToArray(System.Object);var w=new CanvasJS.Chart(this.Element,i);w.render();u.setResult(null);return;default:u.setResult(null);return}}}catch(b){y=System.Exception.create(b);u.setException(y)}},arguments);return p(),u.task},UpdateView:function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);n&&(this.Data=null);this.Element!=null&&(this.Element.innerHTML=null);System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this,this.RenderChart))}}});Bridge.define("$AnonymousType$2",n,{$kind:"anonymous",ctors:{ctor:function(n,t,i){this.type=n;this.name=t;this.axisYType=i}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$2)?Bridge.equals(this.type,t.type)&&Bridge.equals(this.name,t.name)&&Bridge.equals(this.axisYType,t.axisYType):!1},getHashCode:function(){return Bridge.addHash([7550196187,this.type,this.name,this.axisYType])},toJSON:function(){return{type:this.type,name:this.name,axisYType:this.axisYType}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"axisYType",t:16,rt:System.String,g:{a:2,n:"get_axisYType",t:8,rt:System.String,fg:"axisYType"},fn:"axisYType"},{a:2,n:"name",t:16,rt:System.String,g:{a:2,n:"get_name",t:8,rt:System.String,fg:"name"},fn:"name"},{a:2,n:"type",t:16,rt:System.String,g:{a:2,n:"get_type",t:8,rt:System.String,fg:"type"},fn:"type"}]}}}}});Bridge.define("$AnonymousType$3",n,{$kind:"anonymous",ctors:{ctor:function(n,t,i,r){this.type=n;this.toolTipContent=t;this.axisYType=i;this.dataPoints=r}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$3)?Bridge.equals(this.type,t.type)&&Bridge.equals(this.toolTipContent,t.toolTipContent)&&Bridge.equals(this.axisYType,t.axisYType)&&Bridge.equals(this.dataPoints,t.dataPoints):!1},getHashCode:function(){return Bridge.addHash([7550196188,this.type,this.toolTipContent,this.axisYType,this.dataPoints])},toJSON:function(){return{type:this.type,toolTipContent:this.toolTipContent,axisYType:this.axisYType,dataPoints:this.dataPoints}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"axisYType",t:16,rt:System.String,g:{a:2,n:"get_axisYType",t:8,rt:System.String,fg:"axisYType"},fn:"axisYType"},{a:2,n:"dataPoints",t:16,rt:System.Array.type(System.Object),g:{a:2,n:"get_dataPoints",t:8,rt:System.Array.type(System.Object),fg:"dataPoints"},fn:"dataPoints"},{a:2,n:"toolTipContent",t:16,rt:System.Object,g:{a:2,n:"get_toolTipContent",t:8,rt:System.Object,fg:"toolTipContent"},fn:"toolTipContent"},{a:2,n:"type",t:16,rt:System.String,g:{a:2,n:"get_type",t:8,rt:System.String,fg:"type"},fn:"type"}]}}}}});Bridge.define("$AnonymousType$4",n,{$kind:"anonymous",ctors:{ctor:function(n,t,i){this.type=n;this.toolTipContent=t;this.dataPoints=i}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$4)?Bridge.equals(this.type,t.type)&&Bridge.equals(this.toolTipContent,t.toolTipContent)&&Bridge.equals(this.dataPoints,t.dataPoints):!1},getHashCode:function(){return Bridge.addHash([7550196189,this.type,this.toolTipContent,this.dataPoints])},toJSON:function(){return{type:this.type,toolTipContent:this.toolTipContent,dataPoints:this.dataPoints}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"dataPoints",t:16,rt:System.Array.type(System.Object),g:{a:2,n:"get_dataPoints",t:8,rt:System.Array.type(System.Object),fg:"dataPoints"},fn:"dataPoints"},{a:2,n:"toolTipContent",t:16,rt:System.String,g:{a:2,n:"get_toolTipContent",t:8,rt:System.String,fg:"toolTipContent"},fn:"toolTipContent"},{a:2,n:"type",t:16,rt:System.String,g:{a:2,n:"get_type",t:8,rt:System.String,fg:"type"},fn:"type"}]}}}}});Bridge.define("Core.Components.Checkbox",{inherits:[Core.Components.EditableComponent],fields:{_value:null,_input:null},props:{Value:{get:function(){return this._value},set:function(n){var t;this._value=n;this._input.checked=(t=n,t!=null?t:!1)}}},ctors:{ctor:function(n,t){t===void 0&&(t=null);this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.GuiInfo=n||function(){throw new System.ArgumentNullException.$ctor1("ui");}();this.ParentElement=t}},methods:{Render:function(){var n,t;Core.Components.Renderer.SmallCheckbox(Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(this.ParentElement),-1),(n=this._value,n!=null?n:!1));this._input=Bridge.as(Core.MVVM.Html.Context.previousElementSibling,HTMLInputElement);this.Element=this._input.parentElement;Core.MVVM.Html.Take(this._input).AsyncEvent$1("input",Bridge.fn.cacheBind(this,this.UserChange));this.SetDisableUI(!this.GuiInfo.Editable);this.SetDefaultVal();this.Value=Bridge.cast(Bridge.unbox(Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName),System.Boolean),System.Boolean,!0);Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,Bridge.box(this._value,System.Boolean,System.Nullable.toStringFn(System.Boolean.toString),System.Nullable.getHashCode));Bridge.staticEquals(t=this.DOMContentLoaded,null)?null:t()},GetValueText:function(){return this._value==null?"N/A":System.Nullable.eq(this._value,!0)?"Check":"Không check"},UserChange:function(n){var i=0,r,t=new System.Threading.Tasks.TaskCompletionSource,u,f,e=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(this.Disabled){n.preventDefault();t.setResult(null);return}if(u=this._input.checked,r=this.DataChanged(u),i=1,r.isCompleted())continue;r["continue"](e);return;case 1:r.getAwaitedResult();t.setResult(null);return;default:t.setResult(null);return}}}catch(o){f=System.Exception.create(o);t.setException(f)}},arguments);return e(),t.task},DataChanged:function(n){var i=0,r,u=new System.Threading.Tasks.TaskCompletionSource,f,t,e,o=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(f=this._value,this._value=n,this.Entity!=null&&Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,Bridge.box(n,System.Boolean,System.Boolean.toString)),this.Dirty=!0,Bridge.staticEquals(this.UserInput,null)||this.UserInput((t=new Core.MVVM.ObservableArgs,t.NewData=Bridge.box(this._value,System.Boolean,System.Nullable.toStringFn(System.Boolean.toString),System.Nullable.getHashCode),t.OldData=Bridge.box(f,System.Boolean,System.Nullable.toStringFn(System.Boolean.toString),System.Nullable.getHashCode),t.EvType="change",t)),this.PopulateFields(),this.CascadeField(),r=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity]),i=1,r.isCompleted())continue;r["continue"](o);return;case 1:r.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(s){e=System.Exception.create(s);u.setException(e)}},arguments);return o(),u.task},UpdateView:function(n,t,i){var r,u,f;n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);f=Bridge.cast(Bridge.unbox((r=this.Entity)!=null?Core.Extensions.Utils.GetComplexPropValue(r,this.GuiInfo.FieldName):null,System.Boolean),System.Boolean,!0);this.Value=f;this.Dirty||(this.OriginalText=this._input.value,Bridge.staticEquals(u=this.DOMContentLoaded,null)?null:u(),this.OldValue=this._input.value)},SetDisableUI:function(n){n?this.Element.setAttribute("disabled","disabled"):this.Element.removeAttribute("disabled");this._input.disabled=n}}});Bridge.define("Core.Components.ListView",{inherits:[Core.Components.EditableComponent],statics:{fields:{PermissionLoaded:null,IsOwner:null,CmdUrl:null,_copiedRows:null,_originRows:null},ctors:{init:function(){this.PermissionLoaded="PermissionLoaded";this.IsOwner="IsOwner";this.CmdUrl="Cmd"}},methods:{GetFormattedDataSource:function(n,t){var u={},r,i,f;return Core.Extensions.Utils.IsFunction(t,u)?Bridge.toString(u.v.call(n,n,n.EditForm)):(r=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm,n),r==null)?Core.Extensions.Utils.FormatEntity$1(t,n.Entity):(i=Core.Extensions.Utils.FormatEntity$1(t,r.Entity),f=System.String.contains(i,"EditForm.")||System.String.contains(i,"TabEditor.")||System.String.contains(i,"Entity."),Core.Extensions.Utils.FormatEntity(i,null,f?n:n.Entity,void 0,function(){return"null"}))},OrderHeaderGroup:function(n){for(var i,r,t=0;t<(n.Count-1|0);t=t+1|0)for(i=t+2|0;i<n.Count;i=i+1|0)Core.Extensions.StringExt.HasAnyChar(n.getItem(t).GroupName)&&Bridge.referenceEquals(n.getItem(t).GroupName,n.getItem(i).GroupName)&&!Bridge.referenceEquals(n.getItem(t+1|0).GroupName,n.getItem(i).GroupName)&&(r=n.getItem(t+1|0),n.setItem(t+1|0,n.getItem(i)),n.setItem(i,r))}}},fields:{_rowHeight:0,_theadTable:0,_tfooterTable:0,_scrollTable:0,RowClick:null,DblClick:null,_isFocusCell:!1,CanWrite:!1,_firstCache:!1,_noRecord:null,BodyContextMenuShow:null,_history:null,LastComponentFocus:null,LastHeaderId:0,_delay:0,_rowDataChangeAwaiter:0,CellSelected:null,Wheres:null,RecordPolicy:null,_preQueryFn:null,FeatureId:null},events:{HeaderLoaded:null},props:{AdvSearchVM:null,Editable:!1,LastListViewItem:null,LastShiftViewItem:null,LastIndex:0,LastElementFocus:null,ListViewSearch:null,Paginator:null,SortedField:null,Header:null,BasicHeader:null,BasicHeaderSearch:null,HeaderComponentMap:null,RowData:null,FormattedRowData:null,VirtualScroll:!1,Sql:null,StartRow:0,EndRow:0,StartCol:0,EndCol:0,CacheData:null,FormattedDataSource:{get:function(){var n;return Core.Components.ListView.GetFormattedDataSource(this,(n=this.DataSourceFilter,n!=null?n:this.GuiInfo.DataSourceFilter))}},SelectedIndex:0,HeaderSection:null,MainSection:null,FooterSection:null,RefData:null,DataSourceFilter:null,OnDeleteConfirmed:null,AllListViewItem:{get:function(){return System.Linq.Enumerable.from(this.MainSection.Children).select(function(n){return Bridge.cast(n,Core.Components.ListViewItem)})}},UpdatedRows:{get:function(){return System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).where(function(n){return n.Dirty}).select(function(n){return n.Entity}).distinct().toList(System.Object)}},LastUpdate:null,IgnoreConfirmHardDelete:!1,SelectedIds:null,FocusId:null,EntityFocusId:null,ShouldSetEntity:!1,_hasLoadRef:!1},ctors:{init:function(){this._rowHeight=26;this._theadTable=40;this._tfooterTable=35;this._scrollTable=10;this._delay=0;this.CellSelected=new(System.Collections.Generic.List$1(Core.Models.CellSelected).ctor);this.Wheres=new(System.Collections.Generic.List$1(Core.Models.Where).ctor);this.RecordPolicy=new(System.Collections.Generic.List$1(Core.Models.FeaturePolicy).ctor);this.BasicHeader=new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor);this.CacheData=new(System.Collections.Generic.List$1(System.Object).ctor);this.SelectedIndex=-1;this.SelectedIds=new(System.Collections.Generic.HashSet$1(System.Int32).ctor);this.ShouldSetEntity=!0},ctor:function(n,t){t===void 0&&(t=null);var i,r,u,f;this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.GuiInfo=n||function(){throw new System.ArgumentNullException.$ctor1("ui");}();this.Id=Bridge.toString(n.Id);this.Name=n.FieldName;this.Header=new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor);this.RowData=new(Core.MVVM.ObservableList$1(System.Object).ctor);this.RefData=new(System.Collections.Generic.Dictionary$2(System.String,System.Collections.Generic.List$1(System.Object)).ctor);this.AdvSearchVM=(i=new Core.Models.AdvSearchVM,i.ActiveState=Core.Enums.ActiveStateEnum.Yes,i.OrderBy=Core.Clients.LocalStorage.GetItem(System.Collections.Generic.List$1(Core.Models.OrderBy),"OrderBy"+this.GuiInfo.Id)||new(System.Collections.Generic.List$1(Core.Models.OrderBy).ctor),i);this.SortedField=System.Linq.Enumerable.from(this.AdvSearchVM.OrderBy,Core.Models.OrderBy).select(function(n){var t;return t=new Core.Components.SortedField,t.Field=n.Field.FieldName,t.Desc=System.Nullable.eq(n.OrderbyOptionId,Core.Enums.OrderbyOption.DESC)?!0:!1,t.Com=n.Field,t}).toList(Core.Components.SortedField);this.DataSourceFilter=n.DataSourceFilter;this.StopChildrenHistory=!0;this._hasLoadRef=!1;t!=null&&this.Resolve(n,t);this._rowHeight=(i=this.GuiInfo.BodyItemHeight,i!=null?i:26);this._theadTable=(r=this.GuiInfo.HeaderHeight,r!=null?r:40);this._tfooterTable=(u=this.GuiInfo.FooterHeight,u!=null?u:35);this._scrollTable=(f=this.GuiInfo.FooterHeight,f!=null?f:10);this.GuiInfo.IsRealtime&&(Core.Components.Forms.EditForm.NotificationClient!=null?Core.Components.Forms.EditForm.NotificationClient.AddListener(System.Nullable.getValue(this.GuiInfo.ReferenceId),Core.Enums.TypeEntityAction.UpdateEntity,Bridge.fn.cacheBind(this,this.RealtimeUpdateListViewItem)):null)}},methods:{RealtimeUpdateListViewItem:function(n){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,r,u,f=new System.Threading.Tasks.TaskCompletionSource,i,o,s,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4],t);switch(t){case 0:if(i=System.Linq.Enumerable.from(this.MainSection.FilterChildren(Core.Components.ListViewItem,function(t){return Bridge.referenceEquals(t.Entity[Core.Components.EditableComponent.IdField],n[Core.Components.EditableComponent.IdField])}),Core.Components.ListViewItem).firstOrDefault(null,null),i!=null){t=1;continue}t=4;continue;case 1:if(r=this.LoadMasterData(System.Array.init([n],System.Object)),t=2,r.isCompleted())continue;r["continue"](e);return;case 2:if(r.getAwaitedResult(),Bridge.referenceEquals(this.GuiInfo.ComponentType,"VirtualGrid")&&Core.Extensions.ReflectionExt.CopyPropFrom$1(System.Linq.Enumerable.from(this.CacheData,System.Object).firstOrDefault(function(t){return Bridge.referenceEquals(t[Core.Components.EditableComponent.IdField],n[Core.Components.EditableComponent.IdField])},null),n),Core.Extensions.ReflectionExt.CopyPropFrom$1(i.Entity,n),o=System.Linq.Enumerable.from(i.FilterChildren(Core.Components.EditableComponent,function(n){return!n.Dirty||Core.Extensions.StringExt.IsNullOrWhiteSpace(n.GetValueText())}),Core.Components.EditableComponent).select(function(n){return n.GuiInfo.FieldName}).ToArray(System.String),i.UpdateView$1(!1,o),u=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterWebsocket,[n,i]),t=3,u.isCompleted())continue;u["continue"](e);return;case 3:u.getAwaitedResult();t=4;continue;case 4:f.setResult(null);return;default:f.setResult(null);return}}}catch(h){s=System.Exception.create(h);f.setException(s)}},arguments);return e(),f.task}))},Resolve:function(n,t){t===void 0&&(t=null);var i=Bridge.as(document.createElement(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.textarea)),HTMLTextAreaElement);i.innerHTML=t.innerHTML;n.FormatEntity=i.value;t.innerHTML=null},CalcDatasourse:function(n,t,i){i===void 0&&(i="true");var r=this.CalcFilterQuery(!0);return System.String.contains(r,"?")||(r=(r||"")+"?"),(r||"")+(System.String.format("&$skip={0}&$top={1}{2}",Bridge.box(t,System.Int32),Bridge.box(n,System.Int32),Bridge.referenceEquals(i,"true")?System.String.format("&$count={0}",[i]):"")||"")},ReloadData:function(n,t,i,r,u){var f=0,a,it,v,rt,y,p,vt,h=new System.Threading.Tasks.TaskCompletionSource,ut,o,w,b,ft,et,k,d,g,ot,st,ht,e,c,ct,lt,nt,s,tt,at,l=Bridge.fn.bind(this,function(){try{for(;;){f=System.Array.min([0,1,2,3,4,5,6,7,8,9,10,11],f);switch(f){case 0:if(n===void 0&&(n=null),t===void 0&&(t=!1),i===void 0&&(i=null),r===void 0&&(r=null),u===void 0&&(u=!1),this.GuiInfo.LocalRender&&this.GuiInfo.LocalData!=null){this.SetRowData(this.GuiInfo.LocalData);h.setResult(this.GuiInfo.LocalData);return}if(this._preQueryFn!=null){f=1;continue}f=3;continue;case 1:if(ut=this._preQueryFn.call(null,this),a=this.CustomQuery((o=new Core.ViewModels.SqlViewModel,o.CmdId=this.GuiInfo.Id,o.CmdType="Query",o.Entity=JSON.stringify(Bridge.unbox(ut)),o)),f=2,a.isCompleted())continue;a["continue"](l);return;case 2:it=a.getAwaitedResult();h.setResult(it);return;case 3:if(n=Core.Extensions.StringExt.IsNullOrEmpty(n)?this.CalcFilterQuery(!0):n,Core.Extensions.StringExt.IsNullOrWhiteSpace(n)&&(n="?$filter=true"),this.Paginator!=null&&(this.Paginator.Options.PageSize=this.Paginator.Options.PageSize===0?(o=this.GuiInfo.Row,o!=null?o:12):this.Paginator.Options.PageSize),r=(w=r,w!=null?w:(b=(ft=this.Paginator)!=null&&(et=ft.Options)!=null?et.PageSize:null,b!=null?b:(k=this.GuiInfo.Row,k!=null?k:12))),i=(d=i,d!=null?d:(g=Bridge.Int.mul((ot=this.Paginator)!=null&&(st=ot.Options)!=null?st.PageIndex:null,r),g!=null?g:0)),System.String.contains(n,"?")||(n=(n||"")+"?"),ht=(n||"")+(System.String.format("&$skip={0}&$top={1}&$count=true",Bridge.box(i,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),Bridge.box(r,System.Int32,System.Nullable.toString,System.Nullable.getHashCode))||""),c=(ct=Bridge.as((lt=this.Entity)!=null?Core.Extensions.Utils.GetComplexPropValue(lt,this.GuiInfo.FieldName):null,System.Collections.Generic.IEnumerable$1(System.Object)))!=null?(nt=System.Object,System.Linq.Enumerable.from(ct,nt).toList(nt)):null,this.GuiInfo.CanCache&&c!=null&&System.Linq.Enumerable.from(c,System.Object).any()&&!u){f=4;continue}else{f=5;continue}case 4:e=(s=new(Core.Models.OdataResult$1(System.Object)),s.Value=c,s.Odata=(tt=new Core.Models.Odata,tt.Count=c.Count,tt),s);f=7;continue;case 5:if(v=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName,this.GuiInfo.Reference!=null?this.GuiInfo.Reference.Namespace:null).GetList(System.Object,System.Nullable.gt(r,0)?ht:n,!0),f=6,v.isCompleted())continue;v["continue"](l);return;case 6:rt=v.getAwaitedResult();e=rt;f=7;continue;case 7:if(this.Sql=e.Sql,this.UpdatePagination((s=e.Odata.Count,s!=null?s:e.Value.Count),e.Value.Count),y=this.LoadMasterData(e.Value),f=8,y.isCompleted())continue;y["continue"](l);return;case 8:if(y.getAwaitedResult(),this.SetRowData(e.Value),System.Nullable.gt(e.Odata.Count,0)&&Core.Extensions.IEnumerableExtensions.Nothing(System.Object,e.Value)){f=9;continue}f=11;continue;case 9:if(this.Paginator!=null&&(this.Paginator.Options.PageIndex=0),p=this.ReloadData(n,t,void 0,void 0,!1),f=10,p.isCompleted())continue;p["continue"](l);return;case 10:vt=p.getAwaitedResult();f=11;continue;case 11:Core.Components.Spinner.Hide();h.setResult(e.Value);return;default:h.setResult(null);return}}}catch(yt){at=System.Exception.create(yt);h.setException(at)}},arguments);return l(),h.task},CustomQuery:function(n){var i=0,f,s,e,r=new System.Threading.Tasks.TaskCompletionSource,t,h,u,c,o=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2],i);switch(i){case 0:if(f=new Core.Clients.Client.$ctor1("User").PostAsync(System.Array.type(System.Array.type(System.Object)),n,Core.Components.ListView.CmdUrl),i=1,f.isCompleted())continue;f["continue"](o);return;case 1:if(s=f.getAwaitedResult(),t=s,Core.Extensions.IEnumerableExtensions.Nothing(System.Array.type(System.Object),t)){this.SetRowData(null);r.setResult(null);return}if(h=t.length>1?t[System.Array.index(1,t)][0].total:t[System.Array.index(0,t)].length,u=new(System.Collections.Generic.List$1(System.Object).$ctor1)(t[System.Array.index(0,t)]),e=this.LoadMasterData(u),i=2,e.isCompleted())continue;e["continue"](o);return;case 2:e.getAwaitedResult();this.SetRowData(u);this.UpdatePagination(h,u.Count);r.setResult(u);return;default:r.setResult(null);return}}}catch(l){c=System.Exception.create(l);r.setException(c)}},arguments);return o(),r.task},LoadCache:function(n,t){var u=0,i=new System.Threading.Tasks.TaskCompletionSource,r,e,f,o,s,h=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0],u);switch(u){case 0:if(this.Entity==null){i.setResult(!1);return}if(r=Bridge.as((e=this.Entity)!=null?Core.Extensions.Utils.GetComplexPropValue(e,this.GuiInfo.FieldName):null,System.Collections.IEnumerable),r==null){i.setResult(!1);return}if(f=Bridge.getEnumerator(r),!f.System$Collections$IEnumerator$moveNext()){i.setResult(!1);return}if(o=Bridge.unbox(f.System$Collections$IEnumerator$Current[Core.Components.EditableComponent.IdField])===0,t||o){this.RowData._data=r;i.setResult(!0);return}i.setResult(!1);return;default:i.setResult(null);return}}}catch(n){s=System.Exception.create(n);i.setException(s)}},arguments);return h(),i.task},Render:function(){var t=this.EditForm.Feature,n=this.EditForm.GetElementPolicies(this.GuiInfo.Id,Core.Extensions.Utils.ComponentId);if(this.CanWrite=this.CanDo(n,function(n){return n.CanWrite}),Core.MVVM.Html.Take(this.ParentElement).DataAttr$1("name",this.GuiInfo.FieldName),this.AddSections(),this.SetRowDataIfExists(),this.RowData.ListChanged=Bridge.fn.combine(this.RowData.ListChanged,Bridge.fn.cacheBind(this,this.RowDataChanged)),this.EditForm.ResizeListView(),Core.Extensions.IEnumerableExtensions.HasElement(System.Object,this.GuiInfo.LocalData)&&Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.GridPolicy,this.GuiInfo.LocalHeader)){this.Header=this.GuiInfo.LocalHeader;this.HeaderComponentMap=System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Models.GridPolicy,System.Int32,this.Header,function(n){return Bridge.getHashCode(n)}),Core.Models.GridPolicy).toDictionary(function(n){return Bridge.getHashCode(n)},function(n){return Core.Extensions.Utils.MapToComponent(n)},System.Int32,Core.Models.Component);this.GuiInfo.LocalRender?this.Rerender():this.RowData.Data=this.GuiInfo.LocalData;return}System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.LoadAllData(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();this.RowData.Data=this.RowData.Data;i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},AddSections:function(){Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Div,"grid-wrapper"),this.Editable?"editable":"");this.Element=Core.MVVM.Html.Context;this.GuiInfo.CanSearch&&Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"grid-toolbar search").End.Render();this.ListViewSearch=new Core.Components.ListViewSearch(this.GuiInfo);this.AddChild(this.ListViewSearch);Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div,"list-content");this.MainSection=new Core.Components.ListViewSection.ctor(Core.MVVM.Html.Context);this.AddChild(this.MainSection);Core.MVVM.Html.Instance.EndOf$1(".list-content");this.RenderPaginator()},ApplyFilter:function(n){var t=0,i,o,r=new System.Threading.Tasks.TaskCompletionSource,u,f,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(n===void 0&&(n=!0),u=this.CalcFilterQuery(n),this.ClearRowData(),i=this.ReloadData(u,!1,void 0,void 0,!1),t=1,i.isCompleted())continue;i["continue"](e);return;case 1:o=i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(s){f=System.Exception.create(s);r.setException(f)}},arguments);return e(),r.task},ActionFilter:function(){var t=0,n=new System.Threading.Tasks.TaskCompletionSource,i,r=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0],t);switch(t){case 0:n.setResult(null);return;default:n.setResult(null);return}}}catch(r){i=System.Exception.create(r);n.setException(i)}},arguments);return r(),n.task},CalcFilterQuery:function(){var n,t=this.FormattedDataSource,i;return Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.FieldCondition,this.AdvSearchVM.Conditions)&&(i=(n=new Core.Components.AdvancedSearch(this),n.Parent=this,n.Entity=this.AdvSearchVM,n),t=i.CalcAdvSearchQuery()),this.ListViewSearch.CalcFilterQuery(t)},LoadAllData:function(){var n=0,t,i,e,r=new System.Threading.Tasks.TaskCompletionSource,f,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2],n);switch(n){case 0:if(t=this.LoadHeader(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:if(t.getAwaitedResult(),i=this.ReloadData(void 0,this.GuiInfo.CanCache,void 0,void 0,!1),n=2,i.isCompleted())continue;i["continue"](u);return;case 2:e=i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(o){f=System.Exception.create(o);r.setException(f)}},arguments);return u(),r.task},LoadHeader:function(){var t=0,i,u,r=new System.Threading.Tasks.TaskCompletionSource,n,f,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.LoadGridPolicy(),t=1,i.isCompleted())continue;i["continue"](e);return;case 1:u=i.getAwaitedResult();n=u;n=this.FilterColumns(n);this.BasicHeader=System.Linq.Enumerable.from(n,Core.Models.GridPolicy).orderBy(function(n){return n.Order}).toList(Core.Models.GridPolicy);this.BasicHeaderSearch=System.Linq.Enumerable.from(n,Core.Models.GridPolicy).where(function(n){return Bridge.referenceEquals(n.ComponentType,"Dropdown")}).toList(Core.Models.GridPolicy);this.ResetOrder();Bridge.staticEquals(this.HeaderLoaded,null)?null:this.HeaderLoaded(n);r.setResult(null);return;default:r.setResult(null);return}}}catch(o){f=System.Exception.create(o);r.setException(f)}},arguments);return e(),r.task},ResetOrder:function(){var n=0;this.BasicHeader.ForEach(function(t){t.Order=n;n=n+1|0})},FilterColumns:function(n){var r=System.Linq.Enumerable.from(n,Core.Models.GridPolicy).any(Bridge.fn.bind(this,function(n){return System.Nullable.eq(n.ComponentId,this.GuiInfo.Id)})),i,t;return n=r?System.Linq.Enumerable.from(n,Core.Models.GridPolicy).where(Bridge.fn.bind(this,function(n){return System.Nullable.eq(n.ComponentId,this.GuiInfo.Id)})).toList(Core.Models.GridPolicy):System.Linq.Enumerable.from(n,Core.Models.GridPolicy).where(function(n){return n.ComponentId==null}).toList(Core.Models.GridPolicy),i=this.EditForm.GetElementPolicies$1(System.Linq.Enumerable.from(n,Core.Models.GridPolicy).select(function(n){return n.Id}).ToArray(System.Int32),Core.Extensions.Utils.GridPolicyId),t=System.Linq.Enumerable.from(n,Core.Models.GridPolicy).where(function(n){return!n.IsPrivate||Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy,System.Linq.Enumerable.from(i,Core.Models.FeaturePolicy).where(function(t){return t.RecordId===n.Id}),function(n){return n.CanRead})}).select(Bridge.fn.cacheBind(this,this.CalcTextAlign)).orderByDescending(function(n){return n.Frozen}).thenBy(function(n){return n.Order}).toList(Core.Models.GridPolicy),Core.Components.ListView.OrderHeaderGroup(t),this.Header.clear(),this.Header.AddRange(t),this.HeaderComponentMap=System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Models.GridPolicy,System.Int32,this.Header,function(n){return Bridge.getHashCode(n)}),Core.Models.GridPolicy).toDictionary(function(n){return Bridge.getHashCode(n)},function(n){return Core.Extensions.Utils.MapToComponent(n)},System.Int32,Core.Models.Component),t},CalcTextAlign:function(n){if(Core.Extensions.StringExt.HasAnyChar(n.TextAlign)){var t={v:new Core.Enums.TextAlign},i=System.Enum.tryParse(Core.Enums.TextAlign,n.TextAlign,t);i&&(n.TextAlignEnum=t.v)}return n},RenderPaginator:function(){var n,t;if(this.GuiInfo.LocalRender){this.Paginator!=null&&(this.Paginator.Show=!1);return}(this.GuiInfo.Row==null||System.Nullable.eq(this.GuiInfo.Row,0))&&(this.GuiInfo.Row=20);this.Paginator==null&&(this.Paginator=new Core.Components.Paginator((n=new Core.Components.PaginationOptions,n.Total=0,n.PageSize=(t=this.GuiInfo.Row,t!=null?t:20),n.CurrentPageCount=System.Linq.Enumerable.from(this.RowData.Data,System.Object).count(),n)),this.AddChild(this.Paginator))},RenderRowData:function(n,t,i,r,u){var f,e,o,s;return r===void 0&&(r=null),u===void 0&&(u=!1),e=(f=new Core.Components.ListViewItem(Core.MVVM.ElementType.div),f.EmptyRow=u,f.Entity=t,f.ParentElement=i.Element,f.PreQueryFn=this._preQueryFn,f.ListView=this,f.ListViewSection=Bridge.as(i,Core.Components.ListViewSection),f.GuiInfo=this.GuiInfo,f),(o=Bridge.as(i,Core.Components.ListViewSection))!=null?e.ListViewSection=o:(s=Bridge.as(i,Core.Components.GroupViewItem))!=null&&(e.ListViewSection=s.ListViewSection),i.AddChild(e,r),e.RenderRowData(n,t,r,u),e},RenderContent:function(){(this.FormattedRowData=Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.FormattedRowData)?this.RowData.Data:this.FormattedRowData,Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.FormattedRowData))||Core.Extensions.IEnumerableExtensions.ForEach$1(System.Object,this.FormattedRowData,Bridge.fn.bind(this,function(n){var t=this.RenderRowData(this.Header,n,this.MainSection)}))},Rerender:function(){if(this.DisposeNoRecord(),this.Editable=this.GuiInfo.CanAdd&&System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).any(function(n){return n.Active&&!n.Hidden&&n.Editable}),this.MainSection.DisposeChildren(),Core.MVVM.Html.Take(this.MainSection.Element).Clear(),this.RenderContent(),this.Editable)this.AddNewEmptyRow();else if(Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.RowData.Data)){this.NoRecordFound();return}this.MainSection.Element.addEventListener("contextmenu",Bridge.fn.cacheBind(this,this.BodyContextMenuHandler));Core.Components.Spinner.Hide()},DomLoaded:function(){var n;this.GuiInfo.LocalRender||this.Header.ForEach(function(n){n.LocalData=null});Bridge.staticEquals(n=this.DOMContentLoaded,null)?null:n()},RowDataChanged:function(n){if(System.Nullable.eq(n.Action,Core.MVVM.ObservableAction.Remove)){this.RemoveRowById(Bridge.unbox(n.Item[Core.Components.EditableComponent.IdField]));return}window.clearTimeout(this._rowDataChangeAwaiter);this._rowDataChangeAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){var t=0,r,o,u,s,f,i,e=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1,2,3,4,5,6,7,8],t);switch(t){case 0:if(Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.RowData.Data)&&System.Nullable.eq(n.Action,Core.MVVM.ObservableAction.Render)){this.Rerender();return}if(i=n.Action,i===Core.MVVM.ObservableAction.Add){t=1;continue}else if(i===Core.MVVM.ObservableAction.AddRange){t=3;continue}else if(i===Core.MVVM.ObservableAction.Update){t=5;continue}else if(i===Core.MVVM.ObservableAction.Render){t=7;continue}t=8;continue;case 1:if(r=this.AddRow(n.Item,n.Index),t=2,r.isCompleted())continue;r["continue"](e);return;case 2:o=r.getAwaitedResult();t=8;continue;case 3:if(u=this.AddRows(n.ListData,n.Index),t=4,u.isCompleted())continue;u["continue"](e);return;case 4:s=u.getAwaitedResult();t=8;continue;case 5:if(f=this.AddOrUpdateRow(n.Item),t=6,f.isCompleted())continue;f["continue"](e);return;case 6:f.getAwaitedResult();t=8;continue;case 7:this.Rerender();t=8;continue;case 8:Core.Components.Spinner.Hide();return;default:return}}},arguments);e()}))},SetRowData:function(n){var t,i;this.RowData._data.clear();i=Core.Extensions.IEnumerableExtensions.HasElement(System.Object,n);i&&n.ForEach(Bridge.fn.cacheBind(this.RowData._data,this.RowData._data.add));this.RowDataChanged((t=new(Core.MVVM.ObservableListArgs$1(System.Object)),t.Action=Core.MVVM.ObservableAction.Render,t.ListData=this.RowData._data,t));this.Entity!=null&&this.ShouldSetEntity&&Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this.RowData.Data)},SetRowDataIfExists:function(){var n;this.Entity!=null&&(n=Bridge.as(Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName),System.Collections.IEnumerable))!=null&&Bridge.getEnumerator(n).System$Collections$IEnumerator$moveNext()&&(this.RowData._data=n)},LoadGridPolicy:function(){var n=0,r,s,u,h,i=new System.Threading.Tasks.TaskCompletionSource,t,f,c,l,a,e,v,y,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5],n);switch(n){case 0:if(t=null,f=null,Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.GridPolicy,this.GuiInfo.LocalHeader)){n=1;continue}else{n=4;continue}case 1:if(Bridge.referenceEquals(this.FeatureId,"null")||(this.FeatureId=((c=this.EditForm)!=null?c.Feature:null)!=null?Bridge.toString(this.EditForm.Feature.Id):Bridge.toString(this.GuiInfo.ComponentGroup.FeatureId)),r=new Core.Clients.Client.$ctor1("GridPolicy").GetRawList(Core.Models.GridPolicy,System.String.format("?$filter=Active eq true and EntityId eq {0} and FeatureId eq {1}",Bridge.box(this.GuiInfo.ReferenceId,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),this.FeatureId)),n=2,r.isCompleted())continue;r["continue"](o);return;case 2:if(s=r.getAwaitedResult(),t=s,u=new Core.Clients.Client.$ctor1("UserSetting").FirstOrDefaultAsync(Core.Models.UserSetting,System.String.format("?$filter=UserId eq {0} and Name eq 'ListView-{1}'",Bridge.box(Core.Clients.Client.Token.UserId,System.Int32),Bridge.box(this.GuiInfo.Id,System.Int32))),n=3,u.isCompleted())continue;u["continue"](o);return;case 3:h=u.getAwaitedResult();f=h;n=5;continue;case 4:t=new(System.Collections.Generic.List$1(Core.Models.GridPolicy).$ctor1)(this.GuiInfo.LocalHeader);n=5;continue;case 5:if(l=null,System.Nullable.hasValue(this.GuiInfo.Precision)&&!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.DateTimeField)&&(a=this.CalcFilterQuery(!0),l=this.ListViewSearch.CalcFilterQuery(a)),f==null){t.Count<=10&&Bridge.referenceEquals(this.GuiInfo.ComponentType,"GridView")&&(e=(Bridge.Int.div(100,t.Count)|0)+"%",t.ForEach(function(n){n.Width=e;n.MaxWidth=e;n.MinWidth=e}));i.setResult(t);return}v=f.Value;i.setResult(this.MergeGridPolicy(t,Newtonsoft.Json.JsonConvert.DeserializeObject(v,System.Collections.Generic.List$1(Core.Models.GridPolicy))));return;default:i.setResult(null);return}}}catch(p){y=System.Exception.create(p);i.setException(y)}},arguments);return o(),i.task},MergeGridPolicy:function(n,t){var i,u,r;return Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.GridPolicy,t)||this.GuiInfo.Focus?n:(u=new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor),r=(i=Core.Models.GridPolicy,System.Linq.Enumerable.from(t,i).toDictionary(function(n){return n.Id},null,System.Int32,i)),n.ForEach(function(n){var t=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.Int32,Core.Models.GridPolicy,r,n.Id);t!=null&&(Bridge.referenceEquals(t.FieldName,"InsertedBy")||Bridge.referenceEquals(t.FieldName,"InsertedDate")?(n.Width="100px",n.MaxWidth="100px",n.MinWidth="100px",n.Order=998):Bridge.referenceEquals(t.FieldName,"Id")?(n.Width="75px",n.MaxWidth="75px",n.MinWidth="75px",n.Order=999):(n.Width=t.Width,n.MaxWidth=t.MaxWidth,n.MinWidth=t.MinWidth,n.Order=t.Order,n.Frozen=t.Frozen))}),n)},UpdatePagination:function(n,t){if(this.Paginator!=null){var i=this.Paginator.Options;i.Total=n;i.CurrentPageCount=t;i.PageNumber=i.PageIndex+1|0;i.StartIndex=Bridge.Int.mul(i.PageIndex,i.PageSize)+1|0;i.EndIndex=i.StartIndex+i.CurrentPageCount|0;this.Paginator.UpdateView()}},RealtimeUpdateAsync:function(n,t){var i=0,u,f,r=new System.Threading.Tasks.TaskCompletionSource,o,e=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3,4,5],i);switch(i){case 0:if(this.EmptyRow){this.EmptyRow=!1;r.setResult(null);return}if(!this.GuiInfo.IsRealtime||t==null){r.setResult(null);return}if(n.EntityId>0){i=1;continue}else{i=3;continue}case 1:if(u=n.PatchUpdate(),i=2,u.isCompleted())continue;u["continue"](e);return;case 2:u.getAwaitedResult();i=5;continue;case 3:if(f=n.CreateUpdate(),i=4,f.isCompleted())continue;f["continue"](e);return;case 4:f.getAwaitedResult();i=5;continue;case 5:r.setResult(null);return;default:r.setResult(null);return}}}catch(s){o=System.Exception.create(s);r.setException(o)}},arguments);return e(),r.task},RowChangeHandler:function(n,t,i,r){var u=0,f,e,o,s=new System.Threading.Tasks.TaskCompletionSource,c,h=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1,2,3,4,5],u);switch(u){case 0:if(r===void 0&&(r=null),t.EmptyRow&&this.Editable){u=1;continue}u=4;continue;case 1:if(f=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforeCreated,[n]),u=2,f.isCompleted())continue;f["continue"](h);return;case 2:if(f.getAwaitedResult(),this.RowData.Data.add(n),e=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterCreated,[n]),u=3,e.isCompleted())continue;e["continue"](h);return;case 3:e.getAwaitedResult();Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this.RowData.Data);this.RowAction$1(function(n){return Bridge.referenceEquals(n.Entity,t.Entity)},function(n){n.EmptyRow=!1;Core.Extensions.IEnumerableExtensions.ForEach(Core.Components.EditableComponent,n.FilterChildren$1(function(){return!0}),function(n){n.EmptyRow=!1;n.UpdateView$1(!0)})});this.AddNewEmptyRow();u=4;continue;case 4:if(o=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[n]),u=5,o.isCompleted())continue;o["continue"](h);return;case 5:o.getAwaitedResult();s.setResult(null);return;default:s.setResult(null);return}}}catch(i){c=System.Exception.create(i);s.setException(c)}},arguments);return h(),s.task},AddNewEmptyRow:function(){},NoRecordFound:function(){var n;Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent,this.MainSection.Children)&&System.Linq.Enumerable.from(this.MainSection.Children,Core.Components.EditableComponent).where(function(n){return Bridge.is(n,Core.Components.ListViewSection)}).forEach(function(n){n.DisposeChildren()});this.DisposeNoRecord();this._noRecord=(n=new Core.Components.Section.$ctor1(Core.MVVM.ElementType.div),n.ParentElement=this.Element,n);this.AddChild(this._noRecord);Core.Extensions.HtmlElementExtension.AddClass(this._noRecord.Element,"no-records");Core.Components.Renderer.IHtml(Core.MVVM.Html.Take(this._noRecord.Element),"Không tìm thấy dữ liệu");this.DomLoaded()},BodyContextMenuHandler:function(n){n.preventDefault();n.stopPropagation();System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.TbodyContextMenu(n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task}))},LoadMasterData:function(t,i){var e=0,o,y,r=new System.Threading.Tasks.TaskCompletionSource,u,l,h,c,f,s,a,v=Bridge.fn.bind(this,function(){try{for(;;){e=System.Array.min([0,1],e);switch(e){case 0:if(t===void 0&&(t=null),i===void 0&&(i=!0),u=Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.GridPolicy,this.GuiInfo.LocalHeader)?this.Header:this.GuiInfo.LocalHeader,Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.GridPolicy,u)){r.setResult(null);return}if(t=t||this.RowData.Data,l=System.Linq.Enumerable.from(u,Core.Models.GridPolicy).where(function(n){return Core.Extensions.StringExt.HasAnyChar(n.RefName)}).toList(Core.Models.GridPolicy),this.SyncMasterData(t,u),h=System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Models.GridPolicy,System.Nullable$1(System.Int32),l,function(n){return n.ReferenceId}),Core.Models.GridPolicy).select(Bridge.fn.bind(this,function(n){return this.FormatDataSourceByEntity(n,u,t)})).where(function(n){return n!=null}).toList(Core.Models.GridPolicy),Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.GridPolicy,h)){r.setResult(null);return}if(c=System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Models.GridPolicy,System.String,System.Linq.Enumerable.from(h,Core.Models.GridPolicy).where(function(n){return!Core.Extensions.StringExt.IsNullOrWhiteSpace(n.DataSourceOptimized)}),function(n){return System.Nullable.toString(n.ReferenceId,null)+"/"+(n.DataSourceOptimized||"")}),Core.Models.GridPolicy).select(function(t){return new n.$AnonymousType$5(t,new Core.Clients.Client.$ctor1(t.RefName).LoadById(t.DataSourceOptimized,"",System.String.format("ById?FieldName={0}&DatabaseName={1}",t.FormatExcell,t.DatabaseName)))}).ToArray(System.Object),o=System.Threading.Tasks.Task.whenAll.apply(System.Threading.Tasks.Task,System.Linq.Enumerable.from(c,System.Object).select(function(n){return n.Data}).ToArray(System.Threading.Tasks.Task$1(Core.Models.OdataResult$1(System.Object)))),e=1,o.isCompleted())continue;o["continue"](v);return;case 1:y=o.getAwaitedResult();f=Bridge.getEnumerator(c);try{while(f.moveNext())s=f.Current,this.SetRemoteSource(s.Data.getResult().Value,s.Header.RefName,s.Header)}finally{Bridge.is(f,System.IDisposable)&&f.System$IDisposable$Dispose()}this.SyncMasterData(t,u);r.setResult(null);return;default:r.setResult(null);return}}}catch(p){a=System.Exception.create(p);r.setException(a)}},arguments);return v(),r.task},SetRemoteSource:function(n,t,i){var r=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String,System.Collections.Generic.List$1(System.Object),this.RefData,t);r==null?this.RefData.add(t,n):(n.AddRange(r),r.clear(),r.AddRange(Core.Extensions.BridgeExt.DistinctBy(System.Object,System.Int32,n,function(n){return Bridge.unbox(n[Core.Components.EditableComponent.IdField])})));i!=null&&(i.LocalData=n)},SyncMasterData:function(n,t){var r,u,c,l,i,a,s,f,h;n===void 0&&(n=null);t===void 0&&(t=null);n=n||this.RowData.Data;t=t||this.Header;r=Bridge.getEnumerator(System.Linq.Enumerable.from(t,Core.Models.GridPolicy).where(function(n){return System.Nullable.hasValue(n.ReferenceId)}));try{while(r.moveNext())if((i={v:r.Current},!Core.Extensions.StringExt.IsNullOrWhiteSpace(i.v.FieldName)&&!(i.v.FieldName.length<=2))&&(a=Bridge.referenceEquals(i.v.FieldName.substr(i.v.FieldName.length-2|0),Core.Components.EditableComponent.IdField),a)){u=Bridge.getEnumerator(n,System.Object);try{while(u.moveNext()){var e={v:u.Current},v=i.v.FieldName.substr(0,i.v.FieldName.length-2|0),o=(c=Core.Extensions.Utils.GetEntity(System.Nullable.getValue(i.v.ReferenceId)))!=null?c.Name:null;o!=null&&(s={v:Core.Extensions.Utils.GetComplexPropValue(e.v,v)},f=(l=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String,System.Collections.Generic.List$1(System.Object),this.RefData,o))!=null?System.Linq.Enumerable.from(l,System.Object).firstOrDefault(function(n,t,i){return function(n){return System.Nullable.eq(Bridge.unbox(n[Core.Components.EditableComponent.IdField]),Bridge.unbox(Core.Extensions.Utils.GetComplexPropValue(t.v,i.v.FieldName)))}}(this,e,i),null):null,f!=null?Core.Extensions.BridgeExt.SetComplexPropValue(e.v,v,f):s.v!=null&&f==null&&(h={v:System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String,System.Collections.Generic.List$1(System.Object),this.RefData,o)},h.v!=null?h.v.add(s.v):null))}}finally{Bridge.is(u,System.IDisposable)&&u.System$IDisposable$Dispose()}}}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}},FormatDataSourceByEntity:function(n,t,i){var r=System.Linq.Enumerable.from(t,Core.Models.GridPolicy).where(function(t){return Bridge.referenceEquals(t.RefName,n.RefName)}).selectMany(Bridge.fn.bind(this,function(n){return this.GetEntityIds(n,i)})).distinct();return Core.Extensions.IEnumerableExtensions.Nothing(System.Nullable$1(System.Int32),r)?null:(n.DataSourceOptimized=Core.Extensions.IEnumerableExtensions.Combine(System.Int32,r.where(function(n){return System.Nullable.hasValue(n)}).select(function(n){return System.Nullable.getValue(n)}).orderBy(function(n){return n})),n)},GetEntityIds:function(n,t){return Core.Extensions.IEnumerableExtensions.Nothing(System.Object,t)?System.Linq.Enumerable.empty():System.Linq.Enumerable.from(t,System.Object).select(function(t){var i,r=(i=Core.Extensions.Utils.GetComplexPropValue(t,n.FieldName))!=null?Bridge.toString(i):null;return Core.Extensions.StringExt.IsNullOrEmpty(r)?null:Core.Extensions.Utils.TryParseInt(r)}).where(function(n){return n!=null&&System.Nullable.getValue(n)>0})},DeactivateSelected:function(n){var i,t;n===void 0&&(n=null);t=(i=new Core.Components.Forms.ConfirmDialog,i.Content="Are you sure to deactivate?",i);t.Render();t.YesConfirmed=Bridge.fn.combine(t.YesConfirmed,Bridge.fn.bind(this,function(){var n=0,i,r,u=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1,2],n);switch(n){case 0:if(t.Dispose(),i=this.Deactivate(),n=1,i.isCompleted())continue;i["continue"](u);return;case 1:if(i.getAwaitedResult(),r=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.Deactivated,[this.Entity]),n=2,r.isCompleted())continue;r["continue"](u);return;case 2:r.getAwaitedResult();return;default:return}}},arguments);u()}))},SetSelect:function(n,t){this.RowAction$1(function(t){return Bridge.referenceEquals(t.Entity,n)},function(n){n.Selected=t})},SetSelectAll:function(n){this.RowAction(function(t){t.Selected=n})},HardDeleteSelected:function(n){n===void 0&&(n=null);System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,u,f,r=new System.Threading.Tasks.TaskCompletionSource,n,i,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4],t);switch(t){case 0:if(n=new(System.Collections.Generic.List$1(System.Object).ctor),Bridge.referenceEquals(this.GuiInfo.ComponentType,"VirtualGrid")){t=1;continue}else{t=3;continue}case 1:if(u=this.GetRealTimeSelectedRows(),t=2,u.isCompleted())continue;u["continue"](o);return;case 2:f=u.getAwaitedResult();n=f;t=4;continue;case 3:n=this.GetSelectedRows();t=4;continue;case 4:if(this.GuiInfo.IgnoreConfirmHardDelete&&!Bridge.staticEquals(this.OnDeleteConfirmed,null)){this.OnDeleteConfirmed();r.setResult(null);return}i=new Core.Components.Forms.ConfirmDialog;i.Title=System.String.format("Bạn có chắc xóa {0} dòng dữ liêu không!",[Bridge.box(n.Count,System.Int32)]);i.Render();i.YesConfirmed=Bridge.fn.combine(i.YesConfirmed,Bridge.fn.bind(this,function(){var t=0,r,u,c,f,s,o,h,e=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1,2,3],t);switch(t){case 0:if(!Bridge.staticEquals(this.OnDeleteConfirmed,null)){this.OnDeleteConfirmed();Bridge.staticEquals(s=this.DOMContentLoaded,null)?null:s();return}if(i.Dispose(),Core.Extensions.IEnumerableExtensions.Nothing(System.Object,n)&&(n=(o=System.Object,System.Linq.Enumerable.from(this.GetFocusedRows(),o).toList(o))),r=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforeDeleted,[n]),t=1,r.isCompleted())continue;r["continue"](e);return;case 1:if(r.getAwaitedResult(),u=this.HardDeleteConfirmed(n),t=2,u.isCompleted())continue;u["continue"](e);return;case 2:if(c=u.getAwaitedResult(),Bridge.staticEquals(h=this.DOMContentLoaded,null)?null:h(),f=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterDeleted,[n]),t=3,f.isCompleted())continue;f["continue"](e);return;case 3:f.getAwaitedResult();return;default:return}}},arguments);e()}));r.setResult(null);return;default:r.setResult(null);return}}}catch(s){e=System.Exception.create(s);r.setException(e)}},arguments);return o(),r.task}))},Deactivate:function(){var n=0,t,u,i=new System.Threading.Tasks.TaskCompletionSource,f,r,e,o,s,h,c=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(f=this.GuiInfo.RefName,r=this.GetSelectedRows(),e=System.Linq.Enumerable.from(r,System.Object).select(function(n){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(n[Core.Components.EditableComponent.IdField],System.Int32),System.Int32))}).toList(System.Int32),o=new Core.Clients.Client.$ctor1(f),t=o.DeactivateAsync(e),n=1,t.isCompleted())continue;t["continue"](c);return;case 1:u=t.getAwaitedResult();s=u;s?(Core.Extensions.Toast.Success("Hủy dữ liệu thành công"),this.AdvSearchVM.ActiveState===Core.Enums.ActiveStateEnum.Yes&&this.RemoveRange(r)):Core.Extensions.Toast.Warning("Đã có lỗi xảy ra khi hủy dữ liệu, vui lòng thử lại hoặc liên hệ hỗ trợ!");i.setResult(null);return;default:i.setResult(null);return}}}catch(l){h=System.Exception.create(l);i.setException(h)}},arguments);return c(),i.task},HardDeleteConfirmed:function(n){var i=0,r,e,t=new System.Threading.Tasks.TaskCompletionSource,o,u,f,s,h,a,c,l=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(o=this.GuiInfo.RefName,u=System.Linq.Enumerable.from(n,System.Object).select(function(n){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(n[Core.Components.EditableComponent.IdField],System.Int32),System.Int32))}).where(function(n){return n>0}).toList(System.Int32),f=System.Linq.Enumerable.from(n,System.Object).where(function(n){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(n[Core.Components.EditableComponent.IdField],System.Int32),System.Int32))<=0}).toList(System.Object),System.Linq.Enumerable.from(f,System.Object).any()&&this.RemoveRange(f),Core.Extensions.IEnumerableExtensions.Nothing(System.Int32,u)){Core.Extensions.Toast.Success("Xóa dữ liệu thành công");t.setResult(null);return}if(s=new Core.Clients.Client.$ctor1(o),r=s.HardDeleteAsync(u),i=1,r.isCompleted())continue;r["continue"](l);return;case 1:if(e=r.getAwaitedResult(),h=e,h){a=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).where(function(n){return n.Selected}).select(function(n){return n.OriginalText}),Core.Extensions.Utils.NewLine);System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).where(function(n){return n.Selected}).ToArray(Core.Components.ListViewItem).forEach(function(n){n.Dispose()});Core.Extensions.Toast.Success("Xóa dữ liệu thành công");this.ClearSelected();t.setResult(n);return}Core.Extensions.Toast.Warning("Xóa không thành công");t.setResult(null);return;default:t.setResult(null);return}}}catch(v){c=System.Exception.create(v);t.setException(c)}},arguments);return l(),t.task},RemoveRange:function(n){Core.Extensions.IEnumerableExtensions.ForEach(System.Object,n,Bridge.fn.bind(this,function(n){this.RemoveRowById(Bridge.unbox(n[Core.Components.EditableComponent.IdField]))}))},GetFocusedRows:function(){return System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).where(function(n){return n.Focused}).select(function(n){return n.Entity}).toList(System.Object)},GetItemFocus:function(){return System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).where(function(n){return n.Focused}).firstOrDefault(null,null)},GetSelectedRows:function(){return System.Linq.Enumerable.from(this.MainSection.Children,Core.Components.EditableComponent).where(function(n){var t;return(t=Bridge.as(n,Core.Components.ListViewItem))!=null&&t.Selected}).select(function(n){return n.Entity}).toList(System.Object)},GetRealTimeSelectedRows:function(){var n=0,t,u,i=new System.Threading.Tasks.TaskCompletionSource,f,r,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName,(f=this.GuiInfo.Reference)!=null?f.Namespace:null).GetRawListById(System.Object,(r=System.Int32,System.Linq.Enumerable.from(this.SelectedIds,r).toList(r))),n=1,t.isCompleted())continue;t["continue"](o);return;case 1:u=t.getAwaitedResult();i.setResult(u);return;default:i.setResult(null);return}}}catch(s){e=System.Exception.create(s);i.setException(e)}},arguments);return o(),i.task},PasteSelected:function(){Core.Extensions.IEnumerableExtensions.Nothing(System.Object,Core.Components.ListView._copiedRows)||System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,i,r,s,u,f,e=new System.Threading.Tasks.TaskCompletionSource,h,c,o,l,a,t=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5,6,7,8,9,10],n);switch(n){case 0:if(Core.Extensions.Toast.Success("Đang Sao chép liệu !"),i=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforePasted,[Core.Components.ListView._originRows,Core.Components.ListView._copiedRows]),n=1,i.isCompleted())continue;i["continue"](t);return;case 1:if(i.getAwaitedResult(),h=Core.Extensions.IEnumerableExtensions.IndexOf(Core.Components.ListViewItem,this.AllListViewItem,function(n){return n.Selected}),r=this.AddRows(Core.Components.ListView._copiedRows,h),n=2,r.isCompleted())continue;r["continue"](t);return;case 2:if(s=r.getAwaitedResult(),c=s,Bridge.ensureBaseProperty(this,"Dirty").$Core$Components$EditableComponent$Dirty=!0,Core.Components.EditableComponent.prototype.Focus.call(this),u=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterPasted,[Core.Components.ListView._originRows,Core.Components.ListView._copiedRows]),n=3,u.isCompleted())continue;u["continue"](t);return;case 3:if(u.getAwaitedResult(),this.GuiInfo.IsRealtime){n=4;continue}else{n=9;continue}case 4:o=Bridge.getEnumerator(c);n=5;continue;case 5:if(o.moveNext()){l=o.Current;n=6;continue}n=8;continue;case 6:if(f=l.CreateUpdate(),n=7,f.isCompleted())continue;f["continue"](t);return;case 7:f.getAwaitedResult();n=5;continue;case 8:Core.Extensions.Toast.Success("Sao chép dữ liệu thành công !");Bridge.ensureBaseProperty(this,"Dirty").$Core$Components$EditableComponent$Dirty=!1;this.ClearSelected();n=10;continue;case 9:Core.Extensions.Toast.Success("Sao chép dữ liệu thành công !");n=10;continue;case 10:e.setResult(null);return;default:e.setResult(null);return}}}catch(v){a=System.Exception.create(v);e.setException(a)}},arguments);return t(),e.task}))},DuplicateSelected:function(){var t,i=this.GetSelectedRows(),n=(t=System.Object,System.Linq.Enumerable.from(Core.Extensions.ReflectionExt.CopyRowWithoutId(System.Object,i),t).toList(t));!Core.Extensions.IEnumerableExtensions.Nothing(System.Object,n)&&this.CanWrite&&(Bridge._=System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,u,f,c,e,o,s=new System.Threading.Tasks.TaskCompletionSource,l,a,h,v,y,r=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4,5,6,7,8,9,10],t);switch(t){case 0:if(Core.Extensions.Toast.Success("Đang Sao chép liệu !"),u=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforePasted,[i,n]),t=1,u.isCompleted())continue;u["continue"](r);return;case 1:if(u.getAwaitedResult(),l=Core.Extensions.IEnumerableExtensions.IndexOf(Core.Components.ListViewItem,this.AllListViewItem,function(n){return n.Selected}),f=this.AddRows(n,l),t=2,f.isCompleted())continue;f["continue"](r);return;case 2:if(c=f.getAwaitedResult(),a=c,Bridge.ensureBaseProperty(this,"Dirty").$Core$Components$EditableComponent$Dirty=!0,Core.Components.EditableComponent.prototype.Focus.call(this),e=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterPasted,[i,n]),t=3,e.isCompleted())continue;e["continue"](r);return;case 3:if(e.getAwaitedResult(),this.GuiInfo.IsRealtime){t=4;continue}else{t=9;continue}case 4:h=Bridge.getEnumerator(a);t=5;continue;case 5:if(h.moveNext()){v=h.Current;t=6;continue}t=8;continue;case 6:if(o=v.CreateUpdate(),t=7,o.isCompleted())continue;o["continue"](r);return;case 7:o.getAwaitedResult();t=5;continue;case 8:Core.Extensions.Toast.Success("Sao chép dữ liệu thành công !");Bridge.ensureBaseProperty(this,"Dirty").$Core$Components$EditableComponent$Dirty=!1;this.ClearSelected();t=10;continue;case 9:Core.Extensions.Toast.Success("Sao chép dữ liệu thành công !");t=10;continue;case 10:s.setResult(null);return;default:s.setResult(null);return}}}catch(p){y=System.Exception.create(p);s.setException(y)}},arguments);return r(),s.task})))},AddOrUpdateRow:function(n,t,i,r){var u=0,e,l,o,f=new System.Threading.Tasks.TaskCompletionSource,s,c,h=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1,2,3,4,5,6],u);switch(u){case 0:if(t===void 0&&(t=!0),i===void 0&&(i=!1),r===void 0&&(r=[]),s=System.Linq.Enumerable.from(this.MainSection.FilterChildren$1(function(t){return Bridge.is(t,Core.Components.ListViewItem)&&Bridge.referenceEquals(t.Entity,n)})).select(function(n){return Bridge.cast(n,Core.Components.ListViewItem)}).firstOrDefault(null,null),s==null){u=1;continue}u=3;continue;case 1:if(t||this.RowData.Data.add(n),e=this.AddRow(n,this.RowData.Data.Count-1|0,t),u=2,e.isCompleted())continue;e["continue"](h);return;case 2:l=e.getAwaitedResult();f.setResult(null);return;case 3:if(t){u=4;continue}u=6;continue;case 4:if(o=this.LoadMasterData(function(t){return t.add(n),t}(new(System.Collections.Generic.List$1(System.Object).ctor)),!1),u=5,o.isCompleted())continue;o["continue"](h);return;case 5:o.getAwaitedResult();u=6;continue;case 6:s.EmptyRow&&this.RowData.Data.add(n);this.RowAction$1(function(t){return Bridge.referenceEquals(t.Entity,n)},function(t){Core.Extensions.ReflectionExt.CopyPropFrom$1(s.Entity,n);t.EmptyRow=!1;t.UpdateView$1(i,r);t.Dirty=!0});t&&this.FinalAddOrUpdate();f.setResult(null);return;default:f.setResult(null);return}}}catch(a){c=System.Exception.create(a);f.setException(c)}},arguments);return h(),f.task},FinalAddOrUpdate:function(){this.AddNewEmptyRow()},AddOrUpdateRows:function(n){var t=0,i,r,o,u=new System.Threading.Tasks.TaskCompletionSource,e,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2],t);switch(t){case 0:if(this.RowData.Data.AddRange(n),i=this.LoadMasterData(n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:if(i.getAwaitedResult(),r=Core.Extensions.IEnumerableExtensions.ForEachAsync(System.Object,n,Bridge.fn.bind(this,function(n){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.AddOrUpdateRow(n,!1),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task})),t=2,r.isCompleted())continue;r["continue"](f);return;case 2:o=r.getAwaitedResult();this.FinalAddOrUpdate();u.setResult(null);return;default:u.setResult(null);return}}}catch(s){e=System.Exception.create(s);u.setException(e)}},arguments);return f(),u.task},AddRow:function(n,t,i){var r=0,f,e,o,u=new System.Threading.Tasks.TaskCompletionSource,h,c,l,s=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1,2,3,4,5],r);switch(r){case 0:if(t===void 0&&(t=0),i===void 0&&(i=!0),this.DisposeNoRecord(),h=Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(this.MainSection,function(t){return Bridge.referenceEquals(t.Entity,n)}),Core.Components.ListViewItem),h!=null){u.setResult(h);return}if(i){r=1;continue}r=3;continue;case 1:if(this.RowData.Data.add(n),f=this.LoadMasterData(function(t){return t.add(n),t}(new(System.Collections.Generic.List$1(System.Object).ctor)),!1),r=2,f.isCompleted())continue;f["continue"](s);return;case 2:f.getAwaitedResult();r=3;continue;case 3:if(e=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforeCreated,[n]),r=4,e.isCompleted())continue;e["continue"](s);return;case 4:if(e.getAwaitedResult(),c=this.RenderRowData(this.Header,n,this.MainSection,t),o=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterCreated,[n]),r=5,o.isCompleted())continue;o["continue"](s);return;case 5:o.getAwaitedResult();u.setResult(c);return;default:u.setResult(null);return}}}catch(a){l=System.Exception.create(a);u.setException(l)}},arguments);return s(),u.task},DisposeNoRecord:function(){this._noRecord!=null?this._noRecord.Dispose():null;this._noRecord=null},AddRows:function(n,t){var i=0,u,f,e,l,o,s=new System.Threading.Tasks.TaskCompletionSource,h,c,r=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3,4,5,6],i);switch(i){case 0:if(t===void 0&&(t=0),t<0&&(t=0),Core.Extensions.IEnumerableExtensions.ForEach(System.Object,n,Bridge.fn.bind(this,function(n){Bridge.is(this.RowData.Data,System.Collections.IList)?this.RowData.Data.insert(t,n):this.RowData.Data.add(n)})),!this.GuiInfo.IsRealtime){i=1;continue}i=3;continue;case 1:if(u=this.LoadMasterData(n),i=2,u.isCompleted())continue;u["continue"](r);return;case 2:u.getAwaitedResult();i=3;continue;case 3:if(f=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforeCreatedList,[n]),i=4,f.isCompleted())continue;f["continue"](r);return;case 4:if(f.getAwaitedResult(),h=new(System.Collections.Generic.List$1(Core.Components.ListViewItem).ctor),e=Core.Extensions.IEnumerableExtensions.ForEachAsync(System.Object,System.Linq.Enumerable.from(n,System.Object).reverse(),Bridge.fn.bind(this,function(n){var i=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,e,o=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(r=this.AddRow(n,t,!1),i=1,r.isCompleted())continue;r["continue"](o);return;case 1:f=r.getAwaitedResult();h.add(f);u.setResult(null);return;default:u.setResult(null);return}}}catch(s){e=System.Exception.create(s);u.setException(e)}},arguments);return o(),u.task})),i=5,e.isCompleted())continue;e["continue"](r);return;case 5:if(l=e.getAwaitedResult(),o=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterCreatedList,[n]),i=6,o.isCompleted())continue;o["continue"](r);return;case 6:o.getAwaitedResult();this.AddNewEmptyRow();s.setResult(h);return;default:s.setResult(null);return}}}catch(a){c=System.Exception.create(a);s.setException(c)}},arguments);return r(),s.task},RemoveRowById:function(n){var t,i=System.Linq.Enumerable.from(this.RowData.Data,System.Object).firstOrDefault(function(t){return Bridge.unbox(t[Core.Components.EditableComponent.IdField])===n},null);i!=null&&this.RowData.Data.remove(i);(t=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(function(t){return t.EntityId===n},null))!=null?t.Dispose():null},RemoveRow:function(n){var t;n!=null&&(this.RowData.Data.remove(n),(t=Core.Components.Extensions.ComponentExt.FirstOrDefault(this.MainSection,function(t){return Bridge.referenceEquals(t.Entity,n)}))!=null?t.Dispose():null)},UpdateRow:function(n,t,i){t===void 0&&(t=!1);i===void 0&&(i=[]);this.RowAction$1(function(t){return Bridge.referenceEquals(t.Entity,n)},function(n){System.Linq.Enumerable.from(n.Children,Core.Components.EditableComponent).where(function(n){return Core.Extensions.IEnumerableExtensions.Nothing(System.String,i)||System.Array.contains(i,n.GuiInfo.FieldName,System.String)}).forEach(function(n){n.UpdateView$1(t)})})},ClearRowData:function(){var n;(this.RowData.Data.clear(),this.RowAction$1(function(n){return!n.EmptyRow},function(n){n.Dispose()}),this.MainSection.Element.innerHTML=null,this.Entity==null||Bridge.is(this.Parent,Core.Components.SearchEntry))||this.ShouldSetEntity&&((n=this.Entity)!=null?Core.Extensions.BridgeExt.SetComplexPropValue(n,this.GuiInfo.FieldName,this.RowData.Data):null)},UpdateView:function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);this.Editable?this.RowAction$1(function(n){return!n.EmptyRow},function(r){r.UpdateView(n,t,i)}):n&&System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.ListViewSearch.RefershListView(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},ValidateAsync:function(){var t=0,n=new System.Threading.Tasks.TaskCompletionSource,i,r=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0],t);switch(t){case 0:this.ValidationResult.clear();n.setResult(this.ValidateRequired$1());return;default:n.setResult(null);return}}}catch(r){i=System.Exception.create(r);n.setException(i)}},arguments);return r(),n.task},ValidateRequired$1:function(){if(this.Element==null||Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule),this.ValidationRules))return!0;if(!this.ValidationRules.containsKey(Core.Extensions.ValidationRule.Required))return this.Element.removeAttribute(Core.Extensions.ValidationRule.Required),!0;var n=this.ValidationRules.getItem(Core.Extensions.ValidationRule.Required);return this.Element.setAttribute(Core.Extensions.ValidationRule.Required,System.Boolean.toString(!0)),Core.Extensions.IEnumerableExtensions.HasElement(System.Object,this.RowData.Data)?(this.ValidationResult.remove(Core.Extensions.ValidationRule.Required),!0):(System.Collections.Generic.CollectionExtensions.TryAdd(System.String,System.String,this.ValidationResult,Core.Extensions.ValidationRule.Required,System.String.format(n.Message,Core.Components.LangSelect.Get(this.GuiInfo.Label),this.Entity)),!1)},CopySelected:function(){Core.Components.ListView._originRows=this.GetSelectedRows();Core.Components.ListView._copiedRows=Core.Extensions.ReflectionExt.CopyRowWithoutId(System.Object,Core.Components.ListView._originRows);System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterCopied,[Core.Components.ListView._originRows,Core.Components.ListView._copiedRows]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},DisposeHistory:function(){this._history.remove()},ViewHistory:function(){var n,t,u=System.Linq.Enumerable.from(this.GetSelectedRows(),System.Object).lastOrDefault(null,null),r,i;Core.Components.Renderer.Escape(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div,"backdrop").Style$1("align-items: center;"),Bridge.fn.bind(this,function(){this.Dispose()}));this._history=Core.MVVM.Html.Context;Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"popup-content confirm-dialog").Style$1("top: 0;").Div,"popup-title").InnerHTML("Xem lịch sử").Div,"icon-box").Span,"fa fa-times").Event("click",Bridge.fn.cacheBind(this,this.DisposeHistory)).EndOf$1(".popup-title").Div,"popup-body scroll-content");r=Core.MVVM.Html.Context;i=new Core.Components.GridView((n=new Core.Models.Component,n.FieldName="Conditions",n.Column=4,n.ReferenceId=Core.Extensions.Utils.GetEntity$1("History").Id,n.RefName="History",n.Reference=(t=new Core.Models.Entity,t.Name="History",t.Namespace=(Bridge.Reflection.getTypeNamespace(Core.Models.Component)||"")+".",t),n.DataSourceFilter=System.String.format("?$orderby=Id desc&$filter=Active eq true and EntityId eq {0} and RecordId eq {1}",Bridge.box(this.GuiInfo.ReferenceId,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),u[Core.Components.EditableComponent.IdField]),n));i.GuiInfo.LocalHeader=function(n){var t;return n.add((t=new Core.Models.GridPolicy,t.Id=1,t.EntityId=Core.Extensions.Utils.GetEntity$1("History").Id,t.FieldName="InsertedBy",t.ShortDesc="Người thay đổi",t.ReferenceId=Core.Extensions.Utils.GetEntity$1("User").Id,t.RefName="User",t.FormatCell="{FullName}",t.Active=!0,t.ComponentType="Dropdown",t.MaxWidth="100px",t.MinWidth="100px",t)),n.add((t=new Core.Models.GridPolicy,t.Id=2,t.EntityId=Core.Extensions.Utils.GetEntity$1("History").Id,t.FieldName="InsertedDate",t.ShortDesc="Ngày thay đổi",t.Active=!0,t.FormatCell="{0: dd/MM/yyyy HH:mm}",t.ComponentType="Datepicker",t.TextAlign="left",t.MaxWidth="150px",t.MinWidth="150px",t)),n.add((t=new Core.Models.GridPolicy,t.Id=4,t.EntityId=Core.Extensions.Utils.GetEntity$1("History").Id,t.FieldName="TextHistory",t.ShortDesc="Dữ liệu thay đổi",t.Active=!0,t.ComponentType="Label",t.MaxWidth="700px",t.MinWidth="700px",t)),n}(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor));i.ParentElement=r;this.Parent.AddChild(i)},SecurityRows:function(){var n,t,i,r=System.Linq.Enumerable.from(this.GetSelectedRows(),System.Object).where(function(n){return System.Nullable.eq(Bridge.unbox(n[Core.Components.ListView.IsOwner]),!0)}).select(function(n){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(n[Core.Components.EditableComponent.IdField],System.Int32),System.Int32))}).ToArray(System.Int32),u=(n=new Core.Components.SecurityBL,n.Entity=(t=new Core.ViewModels.SecurityVM,t.RecordIds=r,t.EntityId=(i=this.GuiInfo.ReferenceId,i!=null?i:0),t),n.ParentElement=this.TabEditor.Element,n);this.TabEditor.AddChild(u)},CanDo:function(n,t){var r=System.Linq.Enumerable.from(this.EditForm.Feature.FeaturePolicy,Core.Models.FeaturePolicy).where(function(n){return n.EntityId==null}).any(t),i;return r?(i=System.Linq.Enumerable.from(n,Core.Models.FeaturePolicy).any(),!i)?!0:System.Linq.Enumerable.from(n,Core.Models.FeaturePolicy).any(t):!1},TbodyContextMenu:function(n){var r=0,u,f,t=new System.Threading.Tasks.TaskCompletionSource,e,i,o,h,c,s=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1,2],r);switch(r){case 0:if(Core.Components.Forms.ContextMenu.Instance.MenuItems.clear(),Bridge.staticEquals(this.BodyContextMenuShow,null)?null:this.BodyContextMenuShow(),this.Disabled){t.setResult(null);return}if(this.SetSelected(n),e=this.GetSelectedRows(),Core.Extensions.IEnumerableExtensions.Nothing(System.Object,e)){t.setResult(null);return}if(i=Core.Components.Forms.ContextMenu.Instance,o=this.EditForm.GetElementPolicies(this.GuiInfo.Id,Core.Extensions.Utils.ComponentId),h=this.GuiInfo.CanAdd&&this.CanWrite,u=this.RenderViewMenu(),r=1,u.isCompleted())continue;u["continue"](s);return;case 1:if(u.getAwaitedResult(),this.RenderCopyPasteMenu(h),this.RenderEditMenu(e,o),f=this.RenderShareMenu(e,o),r=2,f.isCompleted())continue;f["continue"](s);return;case 2:f.getAwaitedResult();i.Top=Core.Extensions.EventExt.Top(n);i.Left=Core.Extensions.EventExt.Left(n);i.Render();this.Element.appendChild(i.Element);i.Element.style.position=System.Enum.toString(Core.Components.Position,Core.Components.Position.absolute);t.setResult(null);return;default:t.setResult(null);return}}}catch(l){c=System.Exception.create(l);t.setException(c)}},arguments);return s(),t.task},SetSelected:function(n){var i=Bridge.as(n.target,HTMLElement),r=Core.Extensions.HtmlElementExtension.Closest(i,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.tr)),t=Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(this,function(n){return Bridge.referenceEquals(n.Element,r)}),Core.Components.ListViewItem);Bridge.is(t,Core.Components.GroupViewItem)||(this.SelectedIds.Count===1&&this.ClearSelected(),t.Selected=!0,this.LastListViewItem=t,this.SelectedIndex=t.ListViewSection.Children.indexOf(t))},RenderViewMenu:function(){var i=0,r,f,n=new System.Threading.Tasks.TaskCompletionSource,u,e,t,o,s=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(r=new Core.Clients.Client.$ctor1("EntityRef").GetRawList(Core.Models.EntityRef,System.String.format("?$filter=ComId eq {0}",[Bridge.box(this.GuiInfo.Id,System.Int32)])),i=1,r.isCompleted())continue;r["continue"](s);return;case 1:if(f=r.getAwaitedResult(),u=f,Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.EntityRef,u)){n.setResult(null);return}e=System.Linq.Enumerable.from(u,Core.Models.EntityRef).select(Bridge.fn.bind(this,function(n){var t;return t=new Core.Components.Forms.ContextMenuItem,t.Text=n.MenuText,t.Click=Bridge.fn.bind(this,function(){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.OpenFeature(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()}),t})).toList(Core.Components.Forms.ContextMenuItem);Core.Components.Forms.ContextMenu.Instance.MenuItems.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fal fa-ellipsis-h",t.Text="Dữ liệu liên quan",t.MenuItems=e,t));n.setResult(null);return;default:n.setResult(null);return}}}catch(h){o=System.Exception.create(h);n.setException(o)}},arguments);return s(),n.task},OpenFeature:function(n){var i=0,u,h,f,e=new System.Threading.Tasks.TaskCompletionSource,t,r,c,o,l,s=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3,4,5],i);switch(i){case 0:if(t=System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs,Core.Components.Forms.TabEditor).where(function(t){return Bridge.referenceEquals(t.Name,n.ViewClass)}).firstOrDefault(null,null),t==null){i=1;continue}else{i=3;continue}case 1:if(this._hasLoadRef=!1,u=Core.Components.Extensions.ComponentExt.LoadFeatureByName(n.ViewClass),i=2,u.isCompleted())continue;u["continue"](s);return;case 2:h=u.getAwaitedResult();r=h;c=(r.Name||"")+r.Id;o=r.ViewClass!=null?Bridge.Reflection.getType(r.ViewClass):Core.Components.Forms.TabEditor;t=Bridge.as(Bridge.createInstance(o),Core.Components.Forms.TabEditor);t.Name=r.Name;t.Id=c;t.Icon=r.Icon;t.Feature=r;t.Render();t.DOMContentLoaded=Bridge.fn.combine(t.DOMContentLoaded,Bridge.fn.bind(this,function(){var i=System.Linq.Enumerable.from(t.FilterChildren(Core.Components.GridView),Core.Components.GridView).firstOrDefault(function(t){return System.Nullable.eq(t.GuiInfo.Id,n.TargetComId)},null);i.DOMContentLoaded=Bridge.fn.combine(i.DOMContentLoaded,Bridge.fn.bind(this,function(){var i=0,r,u=Bridge.fn.bind(this,function(){for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(this._hasLoadRef)return;if(r=this.Filter(t,n),i=1,r.isCompleted())continue;r["continue"](u);return;case 1:r.getAwaitedResult();this._hasLoadRef=!0;return;default:return}}},arguments);u()}))}));i=5;continue;case 3:if(t.Focus(),f=this.Filter(t,n),i=4,f.isCompleted())continue;f["continue"](s);return;case 4:f.getAwaitedResult();this._hasLoadRef=!0;i=5;continue;case 5:e.setResult(null);return;default:e.setResult(null);return}}}catch(a){l=System.Exception.create(a);e.setException(l)}},arguments);return s(),e.task},Filter:function(n,t){var r=0,f,h,e,u=new System.Threading.Tasks.TaskCompletionSource,i,c,o,l,a,s=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1,2],r);switch(r){case 0:if(i=System.Linq.Enumerable.from(n.FilterChildren(Core.Components.GridView),Core.Components.GridView).firstOrDefault(function(n){return System.Nullable.eq(n.GuiInfo.Id,t.TargetComId)},null),i==null){u.setResult(null);return}if(i.CellSelected.clear(),i.AdvSearchVM.Conditions.clear(),i.ListViewSearch.EntityVM.StartDate=null,i.ListViewSearch.EntityVM.EndDate=null,f=this.GetRealTimeSelectedRows(),r=1,f.isCompleted())continue;f["continue"](s);return;case 1:if(h=f.getAwaitedResult(),c=h,o=System.Linq.Enumerable.from(i.BasicHeader,Core.Models.GridPolicy).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,t.TargetFieldName)},null),l=System.Linq.Enumerable.from(c,System.Object).select(function(n){var i;return i=new Core.Models.CellSelected,i.FieldName=t.TargetFieldName,i.FieldText=o.ShortDesc,i.ComponentType=o.ComponentType,i.Value=Bridge.toString(Core.Extensions.BridgeExt.GetPropValue(n,t.FieldName)),i.ValueText=Bridge.toString(Core.Extensions.BridgeExt.GetPropValue(n,t.FieldName)),i.Operator="in",i.OperatorText="Chứa",i.Logic=Core.Enums.LogicOperation.Or,i.IsSearch=!0,i.Group=!0,i}),i.CellSelected.AddRange(l),e=i.ActionFilter(),r=2,e.isCompleted())continue;e["continue"](s);return;case 2:e.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(v){a=System.Exception.create(v);u.setException(a)}},arguments);return s(),u.task},RenderCopyPasteMenu:function(){},RenderEditMenu:function(n,t){var i,r=System.Linq.Enumerable.from(t,Core.Models.FeaturePolicy).any()?System.Linq.Enumerable.from(t,Core.Models.FeaturePolicy).nullableMax(function(n){return n.LockDeleteAfterCreated}):System.Linq.Enumerable.from(this.EditForm.Feature.FeaturePolicy,Core.Models.FeaturePolicy).any()?System.Linq.Enumerable.from(this.EditForm.Feature.FeaturePolicy,Core.Models.FeaturePolicy).nullableMax(function(n){return n.LockDeleteAfterCreated}):0,o=System.Nullable.gt(r,0)&&System.Linq.Enumerable.from(n,System.Object).any(function(n){return System.Nullable.gt(Core.Extensions.DateTimeExt.GetBusinessDays(Bridge.unbox(n.InsertedDate)),r)}),u,f,e;Core.Components.Forms.ContextMenu.Instance.MenuItems.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fal fa-history",i.Text="Xem lịch sử",i.Click=Bridge.fn.cacheBind(this,this.ViewHistory),i));u=this.CanDo(t,function(n){return n.CanDeactivate});u&&Core.Components.Forms.ContextMenu.Instance.MenuItems.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="mif-unlink",i.Text="Hủy (không xóa)",i.Click=Bridge.fn.cacheBind(this,this.DeactivateSelected),i));f=System.Linq.Enumerable.from(n,System.Object).all(function(n){return Core.Extensions.Utils.IsOwner(n,!0)});e=this.CanDo(t,function(n){return n.CanDelete&&f||n.CanDeleteAll});e&&!o&&Core.Components.Forms.ContextMenu.Instance.MenuItems.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fa fa-trash",i.Text="Xóa dữ liệu",i.Click=Bridge.fn.cacheBind(this,this.HardDeleteSelected),i))},RenderShareMenu:function(n,t){var u=0,f,h,i=new System.Threading.Tasks.TaskCompletionSource,e,c,o,s,l,a,r,v,y=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1],u);switch(u){case 0:if(e=System.Linq.Enumerable.from(n,System.Object).where(Bridge.fn.bind(this,function(n){var t=System.Linq.Enumerable.from(this.RecordPolicy,Core.Models.FeaturePolicy).any(Bridge.fn.bind(this,function(t){return System.Nullable.eq(t.EntityId,this.GuiInfo.ReferenceId)&&t.RecordId===Bridge.unbox(n[Core.Components.EditableComponent.IdField])})),i=Bridge.unbox(n[Core.Components.ListView.PermissionLoaded]);return!(t||System.Nullable.eq(i,!0))})),c=e.select(function(n){return Bridge.unbox(n[Core.Components.EditableComponent.IdField])}).ToArray(System.Int32),f=Core.Components.Extensions.ComponentExt.LoadRecordPolicy(c,(s=this.GuiInfo.ReferenceId,s!=null?s:0)),u=1,f.isCompleted())continue;f["continue"](y);return;case 1:if(h=f.getAwaitedResult(),o=h,o.ForEach(Bridge.fn.cacheBind(this.RecordPolicy,this.RecordPolicy.add)),e.forEach(function(n){n[Core.Components.ListView.PermissionLoaded]=Bridge.box(!0,System.Boolean,System.Boolean.toString)}),l=System.Linq.Enumerable.from(n,System.Object).where(function(n){var t=Core.Extensions.Utils.IsOwner(n);return n[Core.Components.ListView.IsOwner]=Bridge.box(t||System.Linq.Enumerable.from(o,Core.Models.FeaturePolicy).any(function(t){return t.CanShare&&Bridge.unbox(n[Core.Components.EditableComponent.IdField])===t.RecordId}),System.Boolean,System.Boolean.toString),t}).select(function(n){return Bridge.unbox(n[Core.Components.EditableComponent.IdField])}).toList(System.Int32),a=this.CanDo(t,function(n){return n.CanShare})&&System.Linq.Enumerable.from(l,System.Int32).any(),!a){i.setResult(null);return}Core.Components.Forms.ContextMenu.Instance.MenuItems.add((r=new Core.Components.Forms.ContextMenuItem,r.Icon="mif-security",r.Text="Bảo mật & Phân quyền",r.Click=Bridge.fn.cacheBind(this,this.SecurityRows),r));i.setResult(null);return;default:i.setResult(null);return}}}catch(p){v=System.Exception.create(p);i.setException(v)}},arguments);return y(),i.task},MoveDown:function(){this.ClearSelected();this.SelectedIndex>=(this.RowData.Data.Count-1|0)?this.SelectedIndex=0:this.SelectedIndex<(this.RowData.Data.Count-1|0)&&(this.SelectedIndex=this.SelectedIndex+1|0);this.RowAction$2(this.SelectedIndex,function(n){n.Selected=!0})},ClearSelected:function(){this.RowAction(function(n){n.Selected=!1});this.SelectedIds.clear();this.LastListViewItem=null},RowAction$2:function(n,t){if(!(n<0)&&!Bridge.staticEquals(t,null)&&!(n>=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).count())){var i=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).elementAt(n);t(i)}},RowAction:function(n){var t;(t=Core.Components.ListViewItem,System.Linq.Enumerable.from(this.AllListViewItem,t).toList(t)).ForEach(n)},RowAction$1:function(n,t){System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).where(function(t){return Bridge.staticEquals(n,null)||n(t)}).toList(Core.Components.ListViewItem).ForEach(function(n){t(n)})},MoveUp:function(){this.ClearSelected();this.SelectedIndex<=0?this.SelectedIndex=this.RowData.Data.Count-1|0:this.SelectedIndex>0&&(this.SelectedIndex=this.SelectedIndex-1|0);this.RowAction$2(this.SelectedIndex,function(n){n.Selected=!0})},IsRowDirty:function(n){return System.Linq.Enumerable.from(this.GetListViewItems(n),Core.Components.ListViewItem).any(function(n){return n.Dirty})},GetListViewItems:function(n){return System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).where(function(t){return Bridge.referenceEquals(t.Entity[Core.Components.EditableComponent.IdField],n[Core.Components.EditableComponent.IdField])})},BatchUpdate:function(n){var t=0,r,u,s,f,i=new System.Threading.Tasks.TaskCompletionSource,o,h,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3],t);switch(t){case 0:if(n===void 0&&(n=!1),!this.Dirty){i.setResult(null);return}if(r=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforePatchCreate,[this.Entity,null,this]),t=1,r.isCompleted())continue;r["continue"](e);return;case 1:if(r.getAwaitedResult(),u=new Core.Clients.Client.$ctor1(this.GuiInfo.Reference.Name).BulkUpdateAsync(System.Object,this.UpdatedRows),t=2,u.isCompleted())continue;u["continue"](e);return;case 2:if(s=u.getAwaitedResult(),o=s,f=this.InternalUpdateRows(n,o),t=3,f.isCompleted())continue;f["continue"](e);return;case 3:f.getAwaitedResult();i.setResult(o);return;default:i.setResult(null);return}}}catch(c){h=System.Exception.create(c);i.setException(h)}},arguments);return e(),i.task},InternalUpdateRows:function(n,t){var i=0,r,u=new System.Threading.Tasks.TaskCompletionSource,f,e=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3],i);switch(i){case 0:if(Core.Extensions.ReflectionExt.CopyPropFrom$1(this.UpdatedRows,t),this.UpdatedRows.ForEach(function(n){Core.Extensions.BridgeExt.SetComplexPropValue(n,"InsertedDate",Bridge.box(System.Convert.toDateTime(Core.Extensions.Utils.GetComplexPropValue(n,"InsertedDate")),System.DateTime,System.DateTime.format))}),n){i=1;continue}i=3;continue;case 1:if(r=this.LoadMasterData(t),i=2,r.isCompleted())continue;r["continue"](e);return;case 2:r.getAwaitedResult();this.RowAction$1(function(n){return n.Dirty&&!n.EmptyRow},function(n){n.UpdateView();Core.Extensions.HtmlElementExtension.AddClass(n.Element,"new-row")});i=3;continue;case 3:this.Dirty=!1;u.setResult(null);return;default:u.setResult(null);return}}}catch(o){f=System.Exception.create(o);u.setException(f)}},arguments);return e(),u.task},BuildTextHistory:function(n,t){var i,e,r,u,f;return(t===void 0&&(t=null),n==null&&(n=new System.Text.StringBuilder),t==null&&(t=new(System.Collections.Generic.HashSet$1(System.Object).ctor)),t.contains(this))?n:this.Editable?(t.add(this),r=(i=Core.Components.ListViewItem,System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Components.ListViewItem,System.Object,System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).where(function(n){return n.Dirty}),function(n){return n.Entity}),i).ToArray(i)),Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.ListViewItem,r)&&(u=this.GuiInfo.Label,Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.Label)&&(f=Core.Components.Extensions.ComponentExt.FindClosest$1(Core.Components.Section,this,function(n){var t;return((t=n.ComponentGroup)!=null?t.Label:null)!=null}),u=f!=null&&(e=f.ComponentGroup)!=null?e.Label:null),n.append(System.String.format("{0}:{1}",Core.Components.LangSelect.Get(u),Core.Extensions.Utils.NewLine)),r.forEach(function(t){t.BuildTextHistory(n)})),n):n},GetRowCountByHeight:function(n){return Bridge.Int.clip32(Bridge.Math.round(n/this._rowHeight,0,5))},SetRowHeight:function(){var t,n=(t=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(null,null))!=null?t.Element:null;n!=null&&(this._rowHeight=n.scrollHeight>0?n.scrollHeight:this._rowHeight)},Dispose:function(){Core.Components.Forms.EditForm.NotificationClient!=null?Core.Components.Forms.EditForm.NotificationClient.RemoveListener(Bridge.fn.cacheBind(this,this.RealtimeUpdateListViewItem),Core.Enums.TypeEntityAction.UpdateEntity,System.Nullable.getValue(this.GuiInfo.ReferenceId)):null;Core.Components.EditableComponent.prototype.Dispose.call(this)}}});Bridge.define("$AnonymousType$5",n,{$kind:"anonymous",ctors:{ctor:function(n,t){this.Header=n;this.Data=t}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$5)?Bridge.equals(this.Header,t.Header)&&Bridge.equals(this.Data,t.Data):!1},getHashCode:function(){return Bridge.addHash([7550196190,this.Header,this.Data])},toJSON:function(){return{Header:this.Header,Data:this.Data}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"Data",t:16,rt:System.Threading.Tasks.Task$1(Core.Models.OdataResult$1(System.Object)),g:{a:2,n:"get_Data",t:8,rt:System.Threading.Tasks.Task$1(Core.Models.OdataResult$1(System.Object)),fg:"Data"},fn:"Data"},{a:2,n:"Header",t:16,rt:Core.Models.GridPolicy,g:{a:2,n:"get_Header",t:8,rt:Core.Models.GridPolicy,fg:"Header"},fn:"Header"}]}}}}});Bridge.define("Core.Components.Datepicker",{inherits:[Core.Components.EditableComponent],statics:{fields:{HHmmFormat:null,_calendar:null,_renderAwaiter:0,_closeAwaiter:0,formats:null},ctors:{init:function(){this.HHmmFormat="00";this.formats=System.Array.init(["dd/MM/yyyy - HH:mm","dd/MM/yyyy - HH:m","dd/MM/yyyy - h:mm","dd/MM/yyyy - HH:","dd/MM/yyyy - h:","dd/MM/yyyy - h:m","dd/MM/yyyy - HH","dd/MM/yyyy - h","dd/MM/yyyy","ddMMyyyy","d/M/yyyy","dMyyyy","dd/MM/yy","ddMMyy","d/M","dM","dd/MM","ddMM"],System.String)}},methods:{TryParseDateTime:function(n){for(var r={v:System.DateTime.getNow()},i=!1,u=null,t=System.Int64(0);t.lt(System.Int64(Core.Components.Datepicker.formats.length));t=t.inc())if(i=System.DateTime.tryParseExact(n,Core.Components.Datepicker.formats[System.Array.index(System.Int64.toNumber(t),Core.Components.Datepicker.formats)],System.Globalization.CultureInfo.invariantCulture,r),i){u=Core.Components.Datepicker.formats[System.Array.index(System.Int64.toNumber(t),Core.Components.Datepicker.formats)];break}return new(System.ValueTuple$3(System.Boolean,System.DateTime,System.String).$ctor1)(i,r.v,u)}}},fields:{_value:null,_nullable:!1,_simpleNoEvent:!1,InitFormat:null,_currentFormat:null,show:!1,_someday:null,_hour:null,_minute:null},props:{Input:null,Value:{get:function(){return this._value},set:function(n){if(!Bridge.equals(this._value,n)){if(this._value=n,System.Nullable.hasValue(this._value)){var t=this.Input.selectionEnd;this.Input.value=Bridge.equals(this._value,System.DateTime.getMinValue())?"":System.DateTime.format(System.Nullable.getValue(this._value),this._currentFormat);this.Input.selectionStart=t;this.Input.selectionEnd=t}else this._nullable?this.Input.value=null:(this._value=System.DateTime.getNow(),this.Input.value=System.DateTime.format(System.Nullable.getValue(this._value),this._currentFormat));Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,Bridge.box(this._value,System.DateTime,System.Nullable.toStringFn(System.DateTime.format),System.Nullable.getHashCode));this.Dirty=!0}}}},ctors:{init:function(){this._someday=System.DateTime.getDefaultValue();this.InitFormat=""},ctor:function(n,t){if(t===void 0&&(t=null),this.$initialize(),Core.Components.EditableComponent.ctor.call(this,n),this.GuiInfo=n||function(){throw new System.ArgumentNullException.$ctor1("ui");}(),this.InitFormat=Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FormatData)?System.String.replaceAll(System.String.replaceAll(this.GuiInfo.FormatData,"{0:",""),"}",""):System.Nullable.eq(this.GuiInfo.Precision,7)?"dd/MM/yyyy - HH:mm":"dd/MM/yyyy",this._currentFormat=this.InitFormat,t!=null){var i;(i=Bridge.as(t.firstElementChild,HTMLInputElement))!=null||(i=Bridge.as(Core.MVVM.Html.Take(t).Input.GetContext(),HTMLInputElement));this.Input=i}}},methods:{Render:function(){var t,f,n,i,r,e,u;this.SetDefaultVal();n=Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName);Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,Bridge.box(this._value,System.DateTime,System.Nullable.toStringFn(System.DateTime.format),System.Nullable.getHashCode));i={v:System.DateTime.getMinValue()};e=(r=Bridge.as(n,System.String))!=null&&Core.Extensions.StringExt.HasAnyChar(r)&&System.DateTime.tryParse(r,null,i);this._value=e?i.v:n==null?null:Core.Extensions.ReflectionExt.IsDate(Bridge.getType(n))?Bridge.cast(Bridge.unbox(n,System.DateTime),System.DateTime,!0):null;this._nullable=this.IsNullable(System.DateTimeOffset)||this.IsNullable(System.DateTime);Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,Bridge.box(this._value,System.DateTime,System.Nullable.toStringFn(System.DateTime.format),System.Nullable.getHashCode));u=System.Nullable.hasValue(this._value)&&!Bridge.equals(this._value,System.DateTime.getMinValue())?System.DateTime.format(System.Nullable.getValue(this._value),this.InitFormat):"";this.OriginalText=u;this.OldValue=Bridge.equals(this._value,System.DateTime.getMinValue())?"":Bridge.equals(this._value,null)?null:Core.Extensions.DateTimeExt.DateConverter(System.DateTime.format(System.Nullable.getValue(this._value)));Core.MVVM.Html.Take(this.ParentElement);this.Input==null?(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"datetime-picker"),-1).Input.Render(),this.Element=(t=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement),this.Input=t,t)):(Core.MVVM.Html.Take(this.Input),this.Element=this.Input);Core.MVVM.Html.Instance.Event$1("keydown",Bridge.fn.bind(this,function(n){if(!this.Disabled&&n!=null){var t=Core.Extensions.EventExt.KeyCode(n);t===Core.Enums.KeyCodeEnum.Enter&&this.ParseDate()}}));Core.Components.Renderer.PlaceHolder(Core.MVVM.Html.Instance.Value(u).Event("focus",Bridge.fn.bind(this,function(){if(this._simpleNoEvent){this._simpleNoEvent=!1;return}this.GuiInfo.FocusSearch||this.RenderCalendar()})).Event("change",Bridge.fn.bind(this,function(){this.ParseDate()})),this.GuiInfo.PlainText);this.Input.autocomplete="off";this.Input.name=this.GuiInfo.FieldName;this.Input.parentElement.addEventListener("focusout",Bridge.fn.cacheBind(this,this.CloseCalendar));this.Input.addEventListener("keydown",Bridge.fn.bind(this,function(n){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.KeyDownDateTime(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()}));Core.Components.Renderer.ClassName(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div,"btn-group").Button,-1).Span,"icon mif-calendar").Event("click",Bridge.fn.bind(this,function(){this.Input.disabled||(this.show?this.CloseCalendar():this.RenderCalendar())}));Bridge.staticEquals(f=this.DOMContentLoaded,null)?null:f()},KeyDownDateTime:function(n){var t=0,h,g,c,l,a,v,y,o=new System.Threading.Tasks.TaskCompletionSource,nt,p,w,tt,s,b,it,r,rt,u,k,ut,i,f,ft,d,et,ot,st,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,17,19],t);switch(t){case 0:if(System.Nullable.eq(Core.Extensions.EventExt.KeyCodeEnum(n),Core.Enums.KeyCodeEnum.Enter)&&Bridge.equals(this._value,null)){if(this.Input.disabled){o.setResult(null);return}this.show?this.CloseCalendar():this.RenderCalendar()}if(!Bridge.is(this.Parent,Core.Components.ListViewItem)){o.setResult(null);return}if(nt=System.Nullable.eq(Core.Extensions.EventExt.KeyCodeEnum(n),Core.Enums.KeyCodeEnum.V)&&Core.Extensions.EventExt.CtrlOrMetaKey(n)&&Core.Extensions.EventExt.ShiftKey(n),p=new System.Threading.Tasks.TaskCompletionSource,nt){t=1;continue}t=19;continue;case 1:if(navigator.clipboard.readText().then(function(n){return p.setResult(n)}),h=p.task,t=2,h.isCompleted())continue;h["continue"](e);return;case 2:if(g=h.getAwaitedResult(),w=g,tt=System.String.contains(w,"\r\n"),tt){t=3;continue}t=18;continue;case 3:s=(b=System.String,System.Linq.Enumerable.from(w.split("\r\n"),b).toList(b));this.Input.value=s.getItem(0);this.ParseDate();it=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem,this);r=it.RowNo;rt=s.Count+r|0;u=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.VirtualGrid,this);u.AutoFocus=!0;k=Bridge.getEnumerator(System.Linq.Enumerable.from(s,System.String).take(s.Count-1|0));t=4;continue;case 4:if(k.moveNext()){ut=k.Current;t=5;continue}t=17;continue;case 5:if(i=System.Linq.Enumerable.from(u.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(function(n){return n.RowNo===r},null),i==null){t=6;continue}t=10;continue;case 6:if(r<=rt){t=7;continue}t=9;continue;case 7:if(c=System.Threading.Tasks.Task.delay(1e3),t=8,c.isCompleted())continue;c["continue"](e);return;case 8:c.getAwaitedResult();i=System.Linq.Enumerable.from(u.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(function(n){return n.RowNo===r},null);t=9;continue;case 10:if(f=System.Linq.Enumerable.from(i.FilterChildren(Core.Components.Datepicker,Bridge.fn.bind(this,function(n){return Bridge.referenceEquals(n.GuiInfo.FieldName,this.GuiInfo.FieldName)&&n.GuiInfo.Editable})),Core.Components.Datepicker).firstOrDefault(null,null),f.Dirty=!0,ft={},d={},et={},Bridge.Deconstruct(Core.Components.Datepicker.TryParseDateTime(ut).$clone(),ft,d,et),f.Value=d.v,f.UpdateView(),f.PopulateFields(),l=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(f,f.GuiInfo.Events,"change",[i.Entity]),t=11,l.isCompleted())continue;l["continue"](e);return;case 11:if(l.getAwaitedResult(),a=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(i.ListViewSection.ListView,i.ListViewSection.ListView.GuiInfo.Events,"change",[i.Entity]),t=12,a.isCompleted())continue;a["continue"](e);return;case 12:if(a.getAwaitedResult(),u.GuiInfo.IsRealtime){t=13;continue}t=15;continue;case 13:if(v=i.PatchUpdate(),t=14,v.isCompleted())continue;v["continue"](e);return;case 14:v.getAwaitedResult();t=15;continue;case 15:if((ot=u.DataTable.parentElement).scrollTop=ot.scrollTop+26|0,r=r+1|0,y=System.Threading.Tasks.Task.delay(300),t=16,y.isCompleted())continue;y["continue"](e);return;case 16:y.getAwaitedResult();t=4;continue;case 17:u.AutoFocus=!1;t=18;continue;case 19:o.setResult(null);return;default:o.setResult(null);return}}}catch(ht){st=System.Exception.create(ht);o.setException(st)}},arguments);return e(),o.task},IsNullable:function(n){return this.Entity==null||Core.Extensions.Utils.IsNullable(n,Bridge.getType(this.Entity),this.GuiInfo.FieldName,this.Entity)},ParseDate:function(){var t={},n={};Bridge.Deconstruct(Core.Components.Datepicker.TryParseDateTime(this.Input.value).$clone(),t,n,{});!t.v||Core.Extensions.StringExt.IsNullOrWhiteSpace(this.Input.value)?(this.Input.value="",this.TriggerUserChange(null)):(this.Value=n.v,this.TriggerUserChange(n.v))},CloseCalendar:function(){Core.Components.Datepicker._closeAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){this.show=!1;Core.Components.Datepicker._calendar!=null&&(Core.Components.Datepicker._calendar.style.display="none");this.Input.value=Bridge.equals(this._value,null)?null:System.DateTime.format(System.Nullable.getValue(this._value),this.InitFormat);this._hour=null;this._minute=null}),250)},RenderCalendar:function(n){(n===void 0&&(n=null),this.Disabled)||(window.clearTimeout(Core.Components.Datepicker._renderAwaiter),window.clearTimeout(Core.Components.Datepicker._closeAwaiter),Core.Components.Datepicker._renderAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){this.RenderCalendarTask(n)}),100))},RenderCalendarTask:function(n){var e,o,r,t,i,l;if(n===void 0&&(n=null),!this.Disabled){t=(e=n,e!=null?e:(o=this._value,o!=null?o:System.DateTime.getNow()));Bridge.equals(this._value,null)&&(t=System.DateTime.addHours(System.DateTime.getDate(t),12));this.show=!0;window.clearTimeout(Core.Components.Datepicker._closeAwaiter);Core.Components.Datepicker._calendar!=null?(Core.Components.Datepicker._calendar.innerHTML=null,Core.Components.Datepicker._calendar.style.display=""):(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div,"calendar compact open open-up"),-1).Trigger("focus"),Core.Components.Datepicker._calendar=Core.MVVM.Html.Context);Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(Core.Components.Datepicker._calendar).Div,"calendar-header").Div,"header-year").Text(Bridge.toString(System.DateTime.getYear(t))).End.Div,"header-day").Text(System.String.format("{0}, {1:00} {2:00}",Bridge.box(System.DateTime.getDayOfWeek(t),System.DayOfWeek,System.Enum.toStringFn(System.DayOfWeek)),Bridge.box(System.DateTime.getMonth(t),System.Int32),Bridge.box(System.DateTime.getDay(t),System.Int32))).End.End.Div,"calendar-content").Div,"calendar-toolbar").Span,"prev-month").Event("click",Bridge.fn.bind(this,function(){t=System.DateTime.addMonths(t,-1);this.RenderCalendar(t)})).Span,"fa fa-chevron-left").End.End.Span,"curr-month").Text(System.String.format("{0:00}",[Bridge.box(System.DateTime.getMonth(t),System.Int32)])).End.Span,"next-month").Event("click",Bridge.fn.bind(this,function(){t=System.DateTime.addMonths(t,1);this.RenderCalendar(t)})).Span,"fa fa-chevron-right").End.End.Span,"prev-year").Event("click",Bridge.fn.bind(this,function(){t=System.DateTime.addYears(t,-1);this.RenderCalendar(t)})).Span,"fa fa-chevron-left").End.End.Span,"curr-year").Text(Bridge.toString(System.DateTime.getYear(t))).End.Span,"next-year").Event("click",Bridge.fn.bind(this,function(){t=System.DateTime.addYears(t,1);this.RenderCalendar(t)})).Span,"fa fa-chevron-right").End.End.End.Div,"week-days").Span,"day"),"Mo").End.Span,"day"),"Tu").End.Span,"day"),"We").End.Span,"day"),"Th").End.Span,"day"),"Fr").End.Span,"day"),"Sa").End.Span,"day"),"Su").End.End.Div,"days");var s=System.DateTime.getNow(),u=System.DateTime.create(System.DateTime.getYear(t),System.DateTime.getMonth(t),1),h=System.DateTime.addDays(System.DateTime.addMonths(u,1),-1),c=System.DateTime.addDays(u,(-System.DateTime.getDayOfWeek(u)|0)+1|0),f=System.DateTime.addDays(h,(6-System.DateTime.getDayOfWeek(h)|0)+1|0);for((Bridge.Int.div(System.DateTime.subdd(f,c).getDays(),7)|0)<5&&(f=System.DateTime.addDays(f,7)),i=c;System.DateTime.lte(i,f);){r=Bridge.getEnumerator(System.Enum.getValues(System.DayOfWeek));try{while(r.moveNext())l=r.Current,System.DateTime.getDayOfWeek(i)===System.DayOfWeek.Monday&&Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"days-row"),Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"day").Text(Bridge.toString(System.DateTime.getDay(i))).Event$2(System.DateTime,"click",Bridge.fn.cacheBind(this,this.SetSelectedDay),i),System.DateTime.getDay(i)===System.DateTime.getDay(s)&&System.DateTime.getMonth(i)===System.DateTime.getMonth(s)&&System.DateTime.getYear(s)===System.DateTime.getYear(t)&&Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance,"showed today"),System.Nullable.hasValue(this._value)&&System.DateTime.getDay(i)===System.DateTime.getDay(System.Nullable.getValue(this._value))&&System.DateTime.getMonth(i)===System.DateTime.getMonth(System.Nullable.getValue(this._value))&&System.DateTime.getYear(i)===System.DateTime.getYear(System.Nullable.getValue(this._value))&&Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance,"selected"),(System.DateTime.lt(i,u)||System.DateTime.gt(i,h))&&Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance,"outside"),Core.MVVM.Html.Instance.End.Render(),System.DateTime.getDayOfWeek(i)===System.DayOfWeek.Sunday&&Core.MVVM.Html.Instance.End.Render(),i=System.DateTime.addDays(i,1)}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}}System.Nullable.eq(this.GuiInfo.Precision,7)&&(Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.EndOf$1(".calendar-content").Div,"time-picker").Div,"hour"),"fa fa-chevron-up").Event("click",Bridge.fn.bind(this,function(){this.IncreaseTime(System.Int64(1))})).End.Input.Value(System.Int32.format(System.DateTime.getHour(t),Core.Components.Datepicker.HHmmFormat)).Event("focus",function(){window.clearTimeout(Core.Components.Datepicker._closeAwaiter)}).Event$1("change",Bridge.fn.cacheBind(this,this.ChangeHour)).Event$1("keydown",Bridge.fn.cacheBind(this,this.ChangeHourHotKey)),this._hour=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement),Core.MVVM.Html.Instance.End.Render(),Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.Icon(Core.MVVM.Html.Instance,"fa fa-chevron-down").Event("mousedown",Bridge.fn.bind(this,function(){this.IncreaseTime(System.Int64(-1))})).EndOf$1(".hour").Div,"minute"),"fa fa-chevron-up").Event("click",Bridge.fn.bind(this,function(){this.IncreaseTime(System.Int64(10),!0)})).End.Input.Value(System.Int32.format(System.DateTime.getMinute(t),Core.Components.Datepicker.HHmmFormat)).Event("focus",function(){window.clearTimeout(Core.Components.Datepicker._closeAwaiter)}).Event$1("change",Bridge.fn.cacheBind(this,this.ChangeMinute)).Event$1("keydown",Bridge.fn.cacheBind(this,this.ChangeMinuteHotKey)),this._minute=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement),Core.Components.Renderer.Icon(Core.MVVM.Html.Instance.End,"fa fa-chevron-down").Event("mousedown",Bridge.fn.bind(this,function(){this.IncreaseTime(System.Int64(-10),!0)})).EndOf$1(".minute"));Core.Components.Extensions.ComponentExt.AlterPosition(Core.Components.Datepicker._calendar,this.Element)}},ChangeMinuteHotKey:function(n){var t=Core.Extensions.EventExt.KeyCode(n);(t===38||t===40)&&this.IncreaseTime(System.Int64(t===38?1:-1))},ChangeHourHotKey:function(n){var t=Core.Extensions.EventExt.KeyCode(n);(t===38||t===40)&&this.IncreaseTime(System.Int64(t===38?1:-1))},ChangeMinute:function(){var n,t,i,r;((Bridge.equals(this._value,null)||Bridge.equals(this._someday,System.DateTime.getMinValue()))&&(this._value=this._someday),n={},t=System.Int64.tryParse(this._minute.value,n),!t||n.v.lt(System.Int64(0))||n.v.gt(System.Int64(59)))||(Bridge.equals(this._someday,System.DateTime.getMinValue())&&this.OldValue!=null&&(i=System.DateTime.parse(this.OldValue),this._someday=System.Nullable.eq(this.GuiInfo.Precision,7)?i:System.DateTime.getNow()),this._someday=System.DateTime.addMinutes(System.DateTime.addMinutes(this._someday,-System.DateTime.getMinute(this._someday)|0),System.Int64.toNumber(n.v)),r=this._someday,this.TriggerUserChange(r))},ChangeHour:function(){var n={},r=System.Int64.tryParse(this._hour.value,n),t,i;!r||n.v.lt(System.Int64(0))||n.v.gt(System.Int64(23))||(this.OldValue==null&&(this._someday=System.DateTime.getDate(System.DateTime.getNow())),Bridge.equals(this._someday,System.DateTime.getMinValue())&&this.OldValue!=null&&(t=System.DateTime.parse(this.OldValue),this._someday=System.Nullable.eq(this.GuiInfo.Precision,7)?t:System.DateTime.getNow()),this._someday=System.DateTime.addHours(System.DateTime.addHours(this._someday,-System.DateTime.getHour(this._someday)|0),System.Int64.toNumber(n.v)),i=this._someday,this.TriggerUserChange(i))},IncreaseTime:function(n,t){var r,i;t===void 0&&(t=!1);window.clearTimeout(Core.Components.Datepicker._closeAwaiter);i=(r=this._value,r!=null?r:this._someday);t?(i=System.DateTime.addMinutes(i,System.Int64.toNumber(n)),this._minute.value=System.Int32.format(System.DateTime.getMinute(i),Core.Components.Datepicker.HHmmFormat)):(i=System.DateTime.addHours(i,System.Int64.toNumber(n)),this._hour.value=System.Int32.format(System.DateTime.getHour(i),Core.Components.Datepicker.HHmmFormat));this.TriggerUserChange(i)},SetSelectedDay:function(n){n=Bridge.equals(this._value,null)?System.DateTime.addMinutes(System.DateTime.addHours(System.DateTime.getDate(n),System.DateTime.getHour(this._someday)),System.DateTime.getMinute(this._someday)):System.DateTime.addMinutes(System.DateTime.addHours(System.DateTime.getDate(n),System.DateTime.getHour(System.Nullable.getValue(this._value))),System.DateTime.getMinute(System.Nullable.getValue(this._value)));this.TriggerUserChange(n)},TriggerUserChange:function(n,t){var i,r;(t===void 0&&(t=!1),this.Disabled)||(r=this._value,this.Value=n,Bridge.staticEquals(this.UserInput,null)||this.UserInput((i=new Core.MVVM.ObservableArgs,i.NewData=Bridge.box(this._value,System.DateTime,System.Nullable.toStringFn(System.DateTime.format),System.Nullable.getHashCode),i.OldData=Bridge.box(r,System.DateTime,System.Nullable.toStringFn(System.DateTime.format),System.Nullable.getHashCode),i.EvType="change",i)),this.PopulateFields(),this.CascadeField(),this._simpleNoEvent=!0,t||this.Input.focus(),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task})))},UpdateView:function(n,t,i){var u,f,e,o,r,s;n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);e=(u=this.Entity)!=null?Core.Extensions.Utils.GetComplexPropValue(u,this.GuiInfo.FieldName):null;(o=Bridge.as(e,System.String))!=null?(r={},s=System.DateTime.tryParse(o,null,r),s&&(this.Value=r.v)):this.Value=Bridge.cast(Bridge.unbox((f=this.Entity)!=null?Core.Extensions.Utils.GetComplexPropValue(f,this.GuiInfo.FieldName):null,System.DateTime),System.DateTime,!0)},ValidateAsync:function(){var t=0,i,f,n=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule),this.ValidationRules)){n.setResult(!0);return}if(i=Core.Components.EditableComponent.prototype.ValidateAsync.call(this),t=1,i.isCompleted())continue;i["continue"](u);return;case 1:f=i.getAwaitedResult();this.Validate(System.Nullable$1(System.DateTime),System.Nullable$1(System.DateTime),Core.Extensions.ValidationRule.GreaterThan,this._value,function(n,t){return Bridge.equals(t,null)||!Bridge.equals(n,null)&&System.DateTime.gt(n,t)});this.Validate(System.Nullable$1(System.DateTime),System.Nullable$1(System.DateTime),Core.Extensions.ValidationRule.LessThan,this._value,function(n,t){return Bridge.equals(t,null)||!Bridge.equals(n,null)&&System.DateTime.lt(n,t)});this.Validate(System.Nullable$1(System.DateTime),System.Nullable$1(System.DateTime),Core.Extensions.ValidationRule.GreaterThanOrEqual,this._value,function(n,t){return Bridge.equals(t,null)||!Bridge.equals(n,null)&&System.DateTime.gte(n,t)});this.Validate(System.Nullable$1(System.DateTime),System.Nullable$1(System.DateTime),Core.Extensions.ValidationRule.LessThanOrEqual,this._value,function(n,t){return Bridge.equals(t,null)||!Bridge.equals(n,null)&&System.DateTime.lte(n,t)});this.Validate(System.Nullable$1(System.DateTime),System.Nullable$1(System.DateTime),Core.Extensions.ValidationRule.Equal,this._value,function(n,t){return Bridge.equals(n,t)});this.Validate(System.Nullable$1(System.DateTime),System.Nullable$1(System.DateTime),Core.Extensions.ValidationRule.NotEqual,this._value,function(n,t){return!Bridge.equals(n,t)});this.ValidateRequired(System.Nullable$1(System.DateTime),this._value);n.setResult(this.IsValid);return;default:n.setResult(null);return}}}catch(e){r=System.Exception.create(e);n.setException(r)}},arguments);return u(),n.task},RemoveDOM:function(){this.Element!=null&&this.Element.parentElement!=null&&this.Element.parentElement.remove()},SetDisableUI:function(n){this.Input.readOnly=n}}});Bridge.define("Core.Components.Forms.ContextMenu",{inherits:[Core.Components.EditableComponent],statics:{fields:{_active:null,_root:null,_instance:null},props:{Instance:{get:function(){return Core.Components.Forms.ContextMenu._instance==null&&(Core.Components.Forms.ContextMenu._instance=new Core.Components.Forms.ContextMenu,Core.Components.Forms.ContextMenu._instance.MenuItems.clear()),Core.Components.Forms.ContextMenu._instance}}},ctors:{init:function(){this._active="active"}}},fields:{PElement:null,_selectedContextMenuItem:null,_selectedItem:null,_selectedIndex:0,MenuItems:null},props:{Top:0,Left:0,IsRoot:{get:function(){return Bridge.referenceEquals(this._selectedItem!=null?this._selectedItem.parentElement:null,this.Element)}}},ctors:{init:function(){this._selectedIndex=-1;this.MenuItems=new(System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem).ctor)},ctor:function(){this.$initialize();Core.Components.EditableComponent.ctor.call(this,null);this.IsSingleton=!0}},methods:{Render:function(){Core.Components.Forms.ContextMenu._root==null&&(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.PElement||document.body).Ul,"context-menu").Event("focusout",Bridge.fn.cacheBind(this,this.Dispose)).Event$1("keydown",Bridge.fn.cacheBind(this,this.HotKeyHandler)),Core.Components.Forms.ContextMenu._root=Core.MVVM.Html.Context);this.PElement==null&&Core.Components.Forms.ContextMenu._root!=null&&document.body.appendChild(Core.Components.Forms.ContextMenu._root);this.PElement!=null&&Core.Components.Forms.ContextMenu._root!=null&&this.PElement.appendChild(Core.Components.Forms.ContextMenu._root);this.Element=Core.Components.Forms.ContextMenu._root;Core.Components.Renderer.Floating(Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(Core.Components.Forms.ContextMenu._root).Clear(),-1),this.Top,this.Left);this.ParentElement=this.Element.parentElement;this.RenderMenuItems(this.MenuItems);window.setTimeout(Bridge.fn.bind(this,function(){Core.Extensions.HtmlElementExtension.Show(this.Element);this.Element.focus();this.AlterPosition()}))},RenderMenuItems:function(n,t){var r,i;for(t===void 0&&(t=0),r=0;r<n.Count;r=r+1|0)(i=System.Linq.Enumerable.from(n,Core.Components.Forms.ContextMenuItem).elementAt(r),i!=null)&&(Core.MVVM.Html.Instance.Li.Style$1(i.Style).Render(),i.Ele=Core.MVVM.Html.Context,r===0&&t===0&&(n.getItem(r).MenuItems==null||Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.Forms.ContextMenuItem,n.getItem(r).MenuItems))&&(this._selectedIndex=r,this.SetSelectedItem(Core.MVVM.Html.Context)),i.Disabled?Core.Components.Renderer.Disabled(Core.MVVM.Html.Instance,!0):Core.MVVM.Html.Instance.Event$4(Core.Components.Forms.ContextMenuItem,"click",Bridge.fn.cacheBind(this,this.MenuItemClickHandler),i),Core.Components.Renderer.IText(Core.Components.Renderer.Icon(Core.MVVM.Html.Instance,i.Icon).End.Span,i.Text).End.Render(),Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.Forms.ContextMenuItem,i.MenuItems)&&(Core.MVVM.Html.Instance.Ul.Render(),this.RenderMenuItems(i.MenuItems,t+1|0),Core.MVVM.Html.Instance.End.Render()),Core.MVVM.Html.Instance.End.Render())},SetSelectedItem:function(n){this._selectedItem=n;this._selectedItem!=null?Core.Extensions.HtmlElementExtension.AddClass(this._selectedItem,Core.Components.Forms.ContextMenu._active):null},MenuItemClickHandler:function(n,t){var i;(n.stopPropagation(),t==null||Bridge.staticEquals(t.Click,null))||(t.Click(t.Parameter),(i=this.Element)!=null?i.dispatchEvent(new Event(System.Enum.toString(System.String,"focusout"))):null)},HotKeyHandler:function(n){var t,r,i;if(n.preventDefault(),this.Element!=null&&!Core.Extensions.IEnumerableExtensions.Nothing(HTMLElement,this.Element.children)){t=(this._selectedItem!=null&&this._selectedItem.parentElement!=null?this._selectedItem.parentElement.children:null)||this.Element.children;r=Core.Extensions.EventExt.KeyCode(n);switch(r){case 27:this.Dispose();break;case Core.Enums.KeyCodeEnum.LeftArrow:if(this.IsRoot||this._selectedItem==null||this._selectedItem.parentElement==null)return;Core.Extensions.IEnumerableExtensions.ForEach(HTMLElement,this._selectedItem.parentElement.children,function(n){Core.Extensions.HtmlElementExtension.RemoveClass(n,Core.Components.Forms.ContextMenu._active)});this._selectedItem=this._selectedItem.parentElement;break;case Core.Enums.KeyCodeEnum.UpArrow:Core.Extensions.IEnumerableExtensions.ForEach(HTMLElement,t,function(n){Core.Extensions.HtmlElementExtension.RemoveClass(n,Core.Components.Forms.ContextMenu._active)});this._selectedIndex=this._selectedIndex>0?this._selectedIndex-1|0:t.length-1|0;this.SetSelectedItem(System.Linq.Enumerable.from(t,HTMLElement).elementAt(this._selectedIndex));break;case Core.Enums.KeyCodeEnum.RightArrow:if(i=this._selectedItem!=null?this._selectedItem.lastElementChild:null,i==null||Core.Extensions.IEnumerableExtensions.Nothing(HTMLElement,i.children))return;Core.Extensions.IEnumerableExtensions.ForEach(HTMLElement,i.children,function(n){Core.Extensions.HtmlElementExtension.RemoveClass(n,Core.Components.Forms.ContextMenu._active)});this.SetSelectedItem(i.firstElementChild);break;case Core.Enums.KeyCodeEnum.DownArrow:Core.Extensions.IEnumerableExtensions.ForEach(HTMLElement,t,function(n){Core.Extensions.HtmlElementExtension.RemoveClass(n,Core.Components.Forms.ContextMenu._active)});this._selectedIndex=this._selectedIndex<(t.length-1|0)?this._selectedIndex+1|0:0;this.SetSelectedItem(System.Linq.Enumerable.from(t,HTMLElement).elementAt(this._selectedIndex));break;case Core.Enums.KeyCodeEnum.Enter:this._selectedItem==null&&this.SetSelectedItem(this.Element.firstElementChild);this.MenuItemClickHandler(n,System.Linq.Enumerable.from(Core.Extensions.IEnumerableExtensions.Flattern(Core.Components.Forms.ContextMenuItem,this.MenuItems,function(n){return n.MenuItems}),Core.Components.Forms.ContextMenuItem).firstOrDefault(Bridge.fn.bind(this,function(n){return Bridge.referenceEquals(n.Ele,this._selectedItem)}),null))}}},AlterPosition:function(){Core.Components.Renderer.Floating(Core.MVVM.Html.Take(this.Element),this.Top,this.Left);var n=this.Element.getBoundingClientRect(),t=Core.Extensions.HtmlElementExtension.OutOfViewport(this.Element);t.Bottom&&Core.Components.Renderer.Position(Core.MVVM.Html.Take(this.Element),Core.Components.Direction.top,this.Top-n.height);t.Right&&(Core.Components.Renderer.Position(Core.MVVM.Html.Take(this.Element),Core.Components.Direction.left,this.Left-n.width),Core.Components.Renderer.Position(Core.MVVM.Html.Take(this.Element),Core.Components.Direction.top,this.Top));t=Core.Extensions.HtmlElementExtension.OutOfViewport(this.Element);t.Bottom&&(Core.Components.Renderer.Position(Core.MVVM.Html.Take(this.Element),Core.Components.Direction.top,this.Top-n.height),Core.Components.Renderer.Position(Core.MVVM.Html.Take(this.Element),Core.Components.Direction.top,this.Top-n.height-this.Element.clientHeight))},RemoveDOM:function(){Core.Extensions.HtmlElementExtension.Hide(Core.Components.Forms.ContextMenu._root)}}});Bridge.define("Core.Components.Section",{inherits:[Core.Components.EditableComponent],statics:{fields:{_imeout1:0},methods:{RenderTabGroup:function(n,t){var i,e=n.Disabled||t.Disabled,r,u,f;n.EditForm.TabGroup==null&&(n.EditForm.TabGroup=new(System.Collections.Generic.List$1(Core.Components.Forms.TabGroup).ctor));r=System.Linq.Enumerable.from(n.EditForm.TabGroup,Core.Components.Forms.TabGroup).firstOrDefault(function(n){return Bridge.referenceEquals(n.Name,t.TabGroup)},null);r==null?(r=(i=new Core.Components.Forms.TabGroup,i.Name=t.TabGroup,i.Parent=n,i.ParentElement=n.Element,i.Entity=n.Entity,i.ComponentGroup=t,i.EditForm=n.EditForm,i),r.Disabled=e,u=(i=new Core.Components.Forms.TabComponent(t),i.Parent=r,i.Entity=n.Entity,i.ComponentGroup=t,i.Name=t.Name,i.EditForm=n.EditForm,i),u.Disabled=e,r.Children.add(u),n.EditForm.TabGroup.add(r),n.Children.add(r),r.Render(),u.Render(),u.RenderTabContent(),u.Focus(),u.ToggleShow(t.ShowExp),u.ToggleShow(t.DisabledExp)):(f=(i=new Core.Components.Forms.TabComponent(t),i.Parent=r,i.ParentElement=r.Element,i.Entity=n.Entity,i.ComponentGroup=t,i.Name=t.Name,i),f.Disabled=e,r.Children.add(f),f.ToggleShow(t.ShowExp),f.ToggleDisabled(t.DisabledExp),f.Render())},RenderSection:function(n,t){var f,i,s=n.EditForm.GetElementPolicies$1(System.Array.init([t.Id],System.Int32),Core.Extensions.Utils.ComponentGroupId),l=!t.IsPrivate||Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy,s,function(n){return n.CanRead}),a=!t.IsPrivate||Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy,s,function(n){return n.CanWrite}),u,c,r;if(!l)return null;var h=t.Width,e=n.EditForm.GetOuterColumn(t),o=n.EditForm.GetInnerColumn(t.Parent),v=e>0&&o>0;return v&&(u=System.Decimal(e).div(System.Decimal(o)).mul(System.Decimal(100)),u=System.Decimal.toDecimalPlaces(u,2,4),c=System.Decimal.toDecimalPlaces(System.Decimal(t.ItemInRow).sub(System.Decimal(1)).div(System.Decimal(t.ItemInRow)),2,4),h=e===o?"100%":System.String.format("calc({0}% - {1}rem)",u,c)),Core.MVVM.Html.Take(n.Element).Div.Render(),System.String.isNullOrEmpty(t.Label)||(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Label,"header"),t.Label),Core.Clients.Client.CheckHasRole(Core.Enums.RoleEnum.System)&&(Core.MVVM.Html.Instance.Attr$1("contenteditable","true"),Core.MVVM.Html.Instance.Event$1("input",function(n){Core.Components.Section.ChangeComponentGroupLabel(n,t)}),Core.MVVM.Html.Instance.Event$1("dblclick",function(){n.EditForm.SectionProperties(t)})),Core.MVVM.Html.Instance.End.Render()),Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance,t.ClassName).Event$1("contextmenu",function(i){n.EditForm.SysConfigMenu(i,null,t)}),System.String.contains(t.ClassName,"ribbon")||Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance,"panel"),"group"),Core.Components.Renderer.Width(Core.MVVM.Html.Instance.Display$1(!t.Hidden).Style$1((f=t.Style,f!=null?f:"")),h),r=(i=new Core.Components.Section.ctor(Core.MVVM.Html.Context),i.Id=(t.Name||"")+(Bridge.toString(t.Id)||""),i.Name=t.Name,i.ComponentGroup=t,i),r.Disabled=n.Disabled||t.Disabled||!a||n.EditForm.IsLock||r.Disabled,n.AddChild(r,null,t.ShowExp),Core.MVVM.Html.Take(n.Element),Bridge.staticEquals(i=r.DOMContentLoaded,null)?null:i(),r},ChangeComponentGroupLabel:function(n,t){window.clearTimeout(Core.Components.Section._imeout1);Core.Components.Section._imeout1=window.setTimeout(function(){var i=0,r,o,u,h,f,s,e=Bridge.fn.bind(this,function(){for(;;){i=System.Array.min([0,1,2],i);switch(i){case 0:if(r=new Core.Clients.Client.$ctor1("ComponentGroup").GetAsync(Core.Models.ComponentGroup,t.Id),i=1,r.isCompleted())continue;r["continue"](e);return;case 1:if(o=r.getAwaitedResult(),f=o,s=Bridge.as(n.target,HTMLElement),f.Label=s.textContent.trim(),u=new Core.Clients.Client.$ctor1("ComponentGroup").UpdateAsync(Core.Models.ComponentGroup,f),i=2,u.isCompleted())continue;u["continue"](e);return;case 2:h=u.getAwaitedResult();return;default:return}}},arguments);e()},1e3)}}},fields:{elementType:null,InnerEle:null,_chevron:null,_waitFocusOut:0,_isAllBtn:null,_imeout:0},props:{ComponentGroup:null},ctors:{$ctor1:function(n){this.$initialize();Core.Components.EditableComponent.ctor.call(this,null);this.elementType=n},ctor:function(n){this.$initialize();Core.Components.EditableComponent.ctor.call(this,null);this.Element=Bridge.as(n,HTMLElement)}},methods:{Render:function(){if(this.elementType==null){var t=this.Element.tagName.toLowerCase(),n={v:new Core.MVVM.ElementType},i=System.Enum.tryParse(Core.MVVM.ElementType,t,n);i&&(this.elementType=n.v)}else Core.MVVM.Html.Take(this.ParentElement).Add(System.Nullable.getValue(this.elementType)),this.Element=Core.MVVM.Html.Context;(this.Element.id=this.Id,this.ComponentGroup!=null)&&(this.ComponentGroup.IsDropDown&&(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element),"dd-wrap").Style$1("position: relative;"),-1).Event("focusout",Bridge.fn.cacheBind(this,this.HideDetailIfButtonOnly)).Button,"btn ribbon"),this.ComponentGroup.Label).Event$1("click",Bridge.fn.cacheBind(this,this.DropdownBtnClick)).Span.Text("▼").EndOf(Core.MVVM.ElementType.button).Div,"dropdown"),-1).Render(),System.Nullable.eq(this.ComponentGroup.IsCollapsible,!0)&&Core.MVVM.Html.Instance.Style$1("display: none;"),this.InnerEle=Core.MVVM.Html.Context,this._chevron=this.InnerEle.previousElementSibling.firstElementChild,this.Element=Core.MVVM.Html.Context),this.ComponentGroup.Responsive&&!this.ComponentGroup.IsTab||this.ComponentGroup.IsDropDown?this.RenderComponentResponsive(this.ComponentGroup):this.RenderComponent(this.ComponentGroup),this.RenderChildrenSection(this.ComponentGroup))},HideDetailIfButtonOnly:function(){var n,t;this._isAllBtn==null&&(t=(n=Core.Components.EditableComponent,System.Linq.Enumerable.from(this.FilterChildren(Core.Components.EditableComponent,function(n){return Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,n.Children)}),n).ToArray(n)),this._isAllBtn=System.Linq.Enumerable.from(t,Core.Components.EditableComponent).all(function(n){return Bridge.Reflection.isAssignableFrom(Core.Components.Button,Bridge.getType(n))}));window.clearTimeout(this._waitFocusOut);this._waitFocusOut=window.setTimeout(Bridge.fn.bind(this,function(){System.Nullable.eq(this._isAllBtn,!0)&&(this.InnerEle.style.display="none")}),150)},DropdownBtnClick:function(n){n.stopPropagation();Bridge.referenceEquals(Bridge.toString(this.InnerEle.style.display),System.Enum.toString(System.String,"none"))?(this.InnerEle.style.display="",this._chevron.innerHTML="▼"):(this.InnerEle.style.display="none",this._chevron.innerHTML="▼")},RenderChildrenSection:function(n){var t,i;if(!Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.ComponentGroup,n.InverseParent)){t=Bridge.getEnumerator(System.Linq.Enumerable.from(n.InverseParent,Core.Models.ComponentGroup).orderBy(function(n){return n.Order}));try{while(t.moveNext())i=t.Current,i.Disabled=n.Disabled,i.IsTab?Core.Components.Section.RenderTabGroup(this,i):Core.Components.Section.RenderSection(this,i)}finally{Bridge.is(t,System.IDisposable)&&t.System$IDisposable$Dispose()}}},PrepareUpdateView:function(n,t){var i,r;Core.Components.EditableComponent.prototype.PrepareUpdateView.call(this,n,t);this.ToggleShow((i=this.ComponentGroup)!=null?i.ShowExp:null);this.ToggleDisabled((r=this.ComponentGroup)!=null?r.DisabledExp:null)},ComponentProperties:function(n,t){var i,r;t.ComponentGroup=null;r=(i=new Core.Components.Framework.ComponentBL,i.Entity=t,i.ParentElement=this.Element,i.OpenFrom=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm,this),i);this.AddChild(r)},RenderComponent:function(n){var f,o,s,c,r,u,l,t,e,i,h,v;if(!Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.Component,n.Component)){r=Core.MVVM.Html.Instance;Core.Components.Renderer.ClassName(r.Table,"ui-layout").TBody.TRow.Render();u=0;l=this.EditForm.GetElementPolicies$1(System.Linq.Enumerable.from(n.Component,Core.Models.Component).select(function(n){return n.Id}).ToArray(System.Int32),Core.Extensions.Utils.ComponentId);f=Bridge.getEnumerator(System.Linq.Enumerable.from(n.Component,Core.Models.Component).orderBy(function(n){return n.Order}));try{while(f.moveNext())if(t={v:f.Current},!t.v.Hidden){var a=System.Linq.Enumerable.from(l,Core.Models.FeaturePolicy).where(function(n,t){return function(n){return n.RecordId===t.v.Id}}(this,t)).ToArray(Core.Models.FeaturePolicy),y=!t.v.IsPrivate||Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy,a,function(n){return n.CanRead}),p=!t.v.IsPrivate||Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy,a,function(n){return n.CanWrite});y&&(e=(o=t.v.Column,o!=null?o:2),t.v.Label=(s=t.v.Label,s!=null?s:""),t.v.ShowLabel?(Core.Components.Renderer.TextAlign(Core.Components.Renderer.IText(r.TData.Visibility$1(t.v.Visibility).Label,t.v.Label),u===0?Core.Enums.TextAlign.left:Core.Enums.TextAlign.right),Core.Clients.Client.CheckHasRole(Core.Enums.RoleEnum.System)&&(Core.MVVM.Html.Instance.Attr$1("contenteditable","true"),Core.MVVM.Html.Instance.Event$1("input",function(n,t){return Bridge.fn.bind(n,function(n){this.ChangeLabel(n,t.v)})}(this,t)),Core.MVVM.Html.Instance.Event$1("dblclick",function(n,t){return Bridge.fn.bind(n,function(n){this.ComponentProperties(n,t.v)})}(this,t))),Core.Components.Renderer.ColSpan(r.EndOf(Core.MVVM.ElementType.td).TData.Visibility$1(t.v.Visibility),e-1|0).Render()):Core.Components.Renderer.ClassName(Core.Components.Renderer.ColSpan(r.TData.Visibility$1(t.v.Visibility),e),"text-left").Style$1("padding-left: 0;").Render(),Core.Extensions.StringExt.HasAnyChar(t.v.Style)&&r.Style$1(t.v.Style),Core.Extensions.StringExt.HasAnyChar(t.v.Width)&&Core.Components.Renderer.Width(r,t.v.Width),i=Core.Components.Extensions.ComponentFactory.GetComponent(t.v,this.EditForm),Bridge.Reflection.isAssignableFrom(Core.Components.ListView,Bridge.getType(i))&&this.EditForm.ListViews.add(Bridge.as(i,Core.Components.ListView)),this.AddChild(i),(h=i)!=null&&(h.Disabled=t.v.Disabled||this.Disabled||!p||h.Disabled),i.Element!=null&&(Core.Extensions.StringExt.HasAnyChar(t.v.ChildStyle)&&(v=Core.MVVM.Html.Context,Core.MVVM.Html.Take(i.Element).Style$1(t.v.ChildStyle),Core.MVVM.Html.Take(v)),Core.Extensions.StringExt.HasAnyChar(t.v.ClassName)&&((c=i.Element)!=null?Core.Extensions.HtmlElementExtension.AddClass(c,t.v.ClassName):null),System.Nullable.eq(t.v.Row,1)&&Core.Extensions.HtmlElementExtension.AddClass(i.ParentElement.parentElement,"inline-label"),Core.Clients.Client.SystemRole&&i.Element.addEventListener(System.Enum.toString(System.String,"contextmenu"),function(t,i){return Bridge.fn.bind(t,function(t){this.EditForm.SysConfigMenu(t,i.v,n)})}(this,t))),t.v.Focus&&i.Focus(),r.EndOf(Core.MVVM.ElementType.td),System.Nullable.hasValue(t.v.Offset)&&System.Nullable.gt(t.v.Offset,0)&&(Core.Components.Renderer.ColSpan(r.TData,System.Nullable.getValue(t.v.Offset)).End.Render(),u=u+System.Nullable.getValue(t.v.Offset)|0),u=u+e|0,u===this.EditForm.GetInnerColumn(n)&&(u=0,r.EndOf(Core.MVVM.ElementType.tr).TRow.Render()))}}finally{Bridge.is(f,System.IDisposable)&&f.System$IDisposable$Dispose()}}},ChangeLabel:function(n,t){window.clearTimeout(this._imeout);this._imeout=window.setTimeout(Bridge.fn.bind(this,function(){var i=0,r,o,u,h,f,s,e=Bridge.fn.bind(this,function(){for(;;){i=System.Array.min([0,1,2],i);switch(i){case 0:if(r=new Core.Clients.Client.$ctor1("Component").GetAsync(Core.Models.Component,t.Id),i=1,r.isCompleted())continue;r["continue"](e);return;case 1:if(o=r.getAwaitedResult(),f=o,s=Bridge.as(n.target,HTMLElement),f.Label=s.textContent.trim(),u=new Core.Clients.Client.$ctor1("Component").UpdateAsync(Core.Models.Component,f),i=2,u.isCompleted())continue;u["continue"](e);return;case 2:h=u.getAwaitedResult();return;default:return}}},arguments);e()}),1e3)},RenderComponentResponsive:function(n){var f,s,h,l,r,t,u,e,i,c,y;if(!Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.Component,n.Component)){var a=Core.MVVM.Html.Instance,p=this.EditForm.GetElementPolicies$1(System.Linq.Enumerable.from(n.Component,Core.Models.Component).select(function(n){return n.Id}).ToArray(System.Int32),Core.Extensions.Utils.ComponentId),o=this.EditForm.GetInnerColumn(n);o>0&&Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element),"grid").Style$1(System.String.format("grid-template-columns: repeat({0}, 1fr)",[Bridge.box(o,System.Int32)]));r=0;f=Bridge.getEnumerator(System.Linq.Enumerable.from(n.Component,Core.Models.Component).orderBy(function(n){return n.Order}));try{while(f.moveNext())if(t={v:f.Current},!t.v.Hidden){var v=System.Linq.Enumerable.from(p,Core.Models.FeaturePolicy).where(function(n,t){return function(n){return n.RecordId===t.v.Id}}(this,t)).ToArray(Core.Models.FeaturePolicy),w=!t.v.IsPrivate||Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy,v,function(n){return n.CanRead}),b=!t.v.IsPrivate||Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy,v,function(n){return n.CanWrite});w&&(Core.MVVM.Html.Take(this.Element),u=(s=t.v.Column,s!=null?s:2),t.v.Label=(h=t.v.Label,h!=null?h:""),e=null,t.v.ShowLabel&&(Core.Components.Renderer.TextAlign(Core.Components.Renderer.IText(a.Label,t.v.Label),r===0?Core.Enums.TextAlign.left:Core.Enums.TextAlign.right).Render(),e=Core.MVVM.Html.Context,a.End.Render()),i=Core.Components.Extensions.ComponentFactory.GetComponent(t.v,this.EditForm),Bridge.Reflection.isAssignableFrom(Core.Components.ListView,Bridge.getType(i))&&this.EditForm.ListViews.add(Bridge.as(i,Core.Components.ListView)),this.AddChild(i),(c=i)!=null&&(c.Disabled=t.v.Disabled||this.Disabled||!b||this.EditForm.IsLock||c.Disabled),i.Element!=null&&(Core.Extensions.StringExt.HasAnyChar(t.v.ChildStyle)&&(y=Core.MVVM.Html.Context,Core.MVVM.Html.Take(i.Element).Style$1(t.v.ChildStyle),Core.MVVM.Html.Take(y)),Core.Extensions.StringExt.HasAnyChar(t.v.ClassName)&&((l=i.Element)!=null?Core.Extensions.HtmlElementExtension.AddClass(l,t.v.ClassName):null),System.Nullable.eq(t.v.Row,1)&&Core.Extensions.HtmlElementExtension.AddClass(i.ParentElement.parentElement,"inline-label"),Core.Clients.Client.SystemRole&&i.Element.addEventListener(System.Enum.toString(System.String,"contextmenu"),function(t,i){return Bridge.fn.bind(t,function(t){this.EditForm.SysConfigMenu(t,i.v,n)})}(this,t))),t.v.Focus&&i.Focus(),u<=o?(e!=null&&e.nextElementSibling!=null&&u!==2?e.nextElementSibling.style.gridColumn=System.String.format("{0}/{1}",Bridge.box(r+2|0,System.Int32),Bridge.box((r+u|0)+1|0,System.Int32)):i.Element!=null&&(i.Element.style.gridColumn=System.String.format("{0}/{1}",Bridge.box(r+2|0,System.Int32),Bridge.box((r+u|0)+1|0,System.Int32))),r=r+u|0):r=0,r===o&&(r=0))}}finally{Bridge.is(f,System.IDisposable)&&f.System$IDisposable$Dispose()}}}}});Bridge.define("Core.Components.Forms.TabGroup",{inherits:[Core.Components.EditableComponent],fields:{ListViewType:null},props:{ComponentGroup:null,Ul:null,TabContent:null,ShouldCountBage:!1},ctors:{init:function(){this.ListViewType=function(n){return n.add("ListView"),n.add("GroupListView"),n.add("GridView"),n.add("GroupGridView"),n}(new(System.Collections.Generic.List$1(System.String).ctor))},ctor:function(){this.$initialize();Core.Components.EditableComponent.ctor.call(this,null)}},methods:{Render:function(){Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Div,"tab-group"),this.ComponentGroup.IsVertialTab?"tab-vertical":"tab-horizontal").Div,"headers-wrapper").Ul,"nav-config  nav nav-tabs nav-tabs-bottom mb-0");this.Ul=Bridge.as(Core.MVVM.Html.Context,HTMLUListElement);this.Element=this.Ul.parentElement;Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.End.Div,"tabs-content");this.TabContent=Bridge.as(Core.MVVM.Html.Context,HTMLDivElement);this.ShouldCountBage=System.Linq.Enumerable.from(this.ComponentGroup.InverseParent,Core.Models.ComponentGroup).all(Bridge.fn.bind(this,function(n){return Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.Component,n.Component)&&this.ListViewType.contains(System.Linq.Enumerable.from(n.Component,Core.Models.Component).first().ComponentType)}))}}});Bridge.define("Core.Components.ImageServer",{inherits:[Core.Components.EditableComponent],statics:{fields:{pathSeparator:null,PNGUrlPrefix:null,JpegUrlPrefix:null,GuidLength:0,_backdrop:null,_preview:null},props:{Camera:null},ctors:{init:function(){this.pathSeparator="    ";this.PNGUrlPrefix="data:image/png;base64,";this.JpegUrlPrefix="data:image/jpeg;base64,";this.GuidLength=36}},methods:{RemoveGuid:function(n){var i=n,t;return n.length>Core.Components.ImageServer.GuidLength&&(t=System.IO.Path.GetFileNameWithoutExtension(n),i=(Core.Extensions.StringExt.SubStrIndex$1(t,0,t.length-Core.Components.ImageServer.GuidLength|0)||"")+(System.IO.Path.GetExtension(n)||"")),i}}},fields:{_path:null,_input:null,_plus:null,_disabledDelete:!1,_placeHolder:null},props:{Path:{get:function(){return this._path},set:function(n){var t,i;if(this.RemoveChild$1(),this._path=n,this.Entity!=null&&Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this._path),this._path==null){this.RenderFileThumb(this._path);return}i=(t=System.String,System.Linq.Enumerable.from(this._path.split(Core.Components.ImageServer.pathSeparator),t).toList(t));i.ForEach(Bridge.fn.bind(this,function(n){this.RenderFileThumb(n)}))}},DataSourceFilter:null,Label:null,_imageSources:{get:function(){return this._path!=null?this._path.split(Core.Components.ImageServer.pathSeparator):null}},Disabled:{get:function(){return Bridge.ensureBaseProperty(this,"Disabled").$Core$Components$EditableComponent$Disabled},set:function(n){this._input!=null&&(this._input.disabled=n);Bridge.ensureBaseProperty(this,"Disabled").$Core$Components$EditableComponent$Disabled=n;n?this.ParentElement.setAttribute("disabled",""):this.ParentElement.removeAttribute("disabled")}}},ctors:{ctor:function(n){var t;this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.GuiInfo=n;this.DataSourceFilter=(t=this.GuiInfo.DataSourceFilter,t!=null?t:"image/*")}},methods:{RemoveChild$1:function(){System.Linq.Enumerable.from(this.ParentElement.querySelectorAll(".thumb-wrapper")).select(function(n){return Bridge.cast(n,HTMLElement)}).forEach(function(n){n.remove()})},Render:function(){var t,i,n,r,u;this._path=(t=this.Entity)!=null&&(i=Core.Extensions.Utils.GetComplexPropValue(t,this.GuiInfo.FieldName))!=null?Bridge.toString(i):null;u=this._path!=null?(n=System.String,System.Linq.Enumerable.from(this._path.split(Core.Components.ImageServer.pathSeparator),n).toList(n)):null;this.RenderUploadForm();this.Path=this._path;Bridge.staticEquals(r=this.DOMContentLoaded,null)?null:r()},RenderFileThumb:function(n,t){return t===void 0&&(t=!1),Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div,"thumb-wrapper").Div,"overlay"),this._disabledDelete||n==null||Bridge.referenceEquals(n,"")||Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.I,"fal fa-eye").Event$2(System.String,"click",Bridge.fn.cacheBind(this,this.Preview),n).End.I,"fa fa-times").Event$4(System.String,"click",Bridge.fn.cacheBind(this,this.RemoveFile),n).End.Render(),Core.MVVM.Html.Instance.End.Render(),Core.Extensions.StringExt.IsNullOrWhiteSpace(n)||Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Img.AsyncEvent("click",Bridge.fn.cacheBind(this,this.OpenForm)),"thumb").Style$1(this.GuiInfo.ChildStyle).Src(n).Render(),Core.MVVM.Html.Context.parentElement},SetCanDeleteImage:function(n){this._disabledDelete=!n;n?this.UpdateView():System.Linq.Enumerable.from(this.Element.querySelectorAll(".overlay .fa-times")).select(function(n){return Bridge.cast(n,HTMLElement)}).forEach(function(n){n.remove()})},Preview:function(n){if(!Core.Extensions.StringExt.IsNullOrWhiteSpace(n)){if(!System.IO.Path.IsImage(n)){Core.Clients.Client.Download(n);return}var t=null,i=0;Core.Components.Renderer.Escape(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(Bridge.ensureBaseProperty(this,"EditForm").$Core$Components$EditableComponent$EditForm.Element).Div,"dark-overlay"),function(){Core.Components.ImageServer._preview.remove()}).Event$1("keydown",Bridge.fn.bind(this,function(i){var r=Core.Extensions.EventExt.KeyCodeEnum(i);System.Nullable.neq(r,Core.Enums.KeyCodeEnum.LeftArrow)&&System.Nullable.neq(r,Core.Enums.KeyCodeEnum.RightArrow)||(n=System.Nullable.eq(r,Core.Enums.KeyCodeEnum.LeftArrow)?this.MoveLeft(n,t):this.MoveRight(n,t))}));Core.Components.ImageServer._preview=Core.MVVM.Html.Context;Core.MVVM.Html.Instance.Img.Src((Core.Clients.Client.Origin||"")+(n||""));t=Bridge.as(Core.MVVM.Html.Context,HTMLImageElement);Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.Title(Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Span,"close").Event("click",function(){Core.Components.ImageServer._preview.remove()}).End.Div,"toolbar"),"fa fa-undo ro-left").Event("click",function(){i=i-90|0;t.style.transform=System.String.format("rotate({0}deg)",[Bridge.box(i,System.Int32)])}).End,"fa fa-cloud-download-alt"),"Tải xuống").Event("click",function(){var n=Bridge.as(document.createElement("a"),HTMLAnchorElement);n.href=t.src;n.download=t.src.substr(t.src.lastIndexOf("/"));document.body.appendChild(n);n.click();n.remove()}).End,"fa fa-redo ro-right").Event("click",function(){i=i+90|0;t.style.transform=System.String.format("rotate({0}deg)",[Bridge.box(i,System.Int32)])}).End.End,"fa fa-chevron-left").Event("click",Bridge.fn.bind(this,function(){n=this.MoveLeft(n,t)})).End,"fa fa-chevron-right").Event("click",Bridge.fn.bind(this,function(){n=this.MoveRight(n,t)})).End.Render()}},MoveAround:function(n,t){var i=Core.Extensions.EventExt.KeyCodeEnum(n),r;System.Nullable.neq(i,Core.Enums.KeyCodeEnum.LeftArrow)&&System.Nullable.neq(i,Core.Enums.KeyCodeEnum.RightArrow)||(r=Bridge.as(n.target.firstElementChild,HTMLImageElement))!=null&&(System.Nullable.eq(i,Core.Enums.KeyCodeEnum.LeftArrow)?this.MoveLeft(t,r):this.MoveRight(t,r))},MoveLeft:function(n,t){var r,u,i=System.Array.indexOfT(this._imageSources,n);return i=i===0?this._imageSources.length-1|0:i-1|0,t.src=(Core.Clients.Client.Origin||"")+((r=this._imageSources)[System.Array.index(i,r)]||""),(u=this._imageSources)[System.Array.index(i,u)]},MoveRight:function(n,t){var r,u,i=System.Array.indexOfT(this._imageSources,n);return i=i===0?this._imageSources.length-1|0:i-1|0,t.src=(Core.Clients.Client.Origin||"")+((r=this._imageSources)[System.Array.index(i,r)]||""),(u=this._imageSources)[System.Array.index(i,u)]},OpenFileDialog:function(n){if(!this.Disabled){this.OpenNativeFileDialog(n);return}},RenderUploadForm:function(){this.Element=Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement),"uploader").Div.GetContext();this._plus==null&&(System.Nullable.gt(this.GuiInfo.Precision,0)?Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.I.AsyncEvent("click",Bridge.fn.cacheBind(this,this.OpenForm)),"fal fa-plus mt-3").Style$1(this.GuiInfo.ChildStyle).End.Render():Core.Extensions.StringExt.IsNullOrWhiteSpace(this.Path)&&Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.I.AsyncEvent("click",Bridge.fn.cacheBind(this,this.OpenForm)),"fal fa-plus mt-3").Style$1(this.GuiInfo.ChildStyle).End.Render(),this._plus=Core.MVVM.Html.Context)},OpenForm:function(){var n=0,t,u,i=new System.Threading.Tasks.TaskCompletionSource,r,f,e=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(Core.Components.ImageServer._backdrop==null&&(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div,"backdrop").Style$1("z-index:2000"),-1),Core.Components.ImageServer._backdrop=Core.MVVM.Html.Context),Core.Extensions.HtmlElementExtension.Show(Core.Components.ImageServer._backdrop),Core.Components.Renderer.IconForSpan(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(Core.Components.ImageServer._backdrop).Clear().Div,"popup-content").Style$1("width:100%").Div,"popup-title").Span,""),Core.MVVM.Html.Instance.End.Span.Text("Danh sách hình ảnh"),Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div,"icon-box").Span,"fa fa-times").Event("click",Bridge.fn.cacheBind(this,this.ClosePopup)).EndOf$1(".popup-title").Div,"popup-body"),Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Input.Type$1("file").Attr$1("multiple","multiple").Attr$1("name","imagefiles"),"d-none").Attr$1("accept",this.DataSourceFilter).AsyncEvent$1("change",Bridge.fn.bind(this,function(n){return this.UploadSelectedImages(n)})),this._input=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement),Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div,"col-md-12").Style$1("padding: 20px 5%;").Div,"alert alert-info").Text("Lưu ý: Hệ thống chỉ nhận các file ảnh (bmp, jpg, jpeg, gif, png) và dung lượng dưới 1Mb / file").End.Div,"gallery-buttons bottom-30px").Button.Event$1("click",Bridge.fn.bind(this,function(n){this.OpenNativeFileDialog(n)})).Id("btn-upload"),"btn btn-success btn-md dz-clickable mr-1").I,"fa fa-upload mr-1").End.Text("Upload ảnh mới").End.Button.Id("btn-upload"),"btn btn-success btn-md mr-1").I,"fa fa-heart mr-1").End.Text("Chèn ảnh đã chọn").End.Button.Id("btn-upload"),"btn btn-danger btn-md mr-1").I,"fa fa-trash mr-1").End.Text("Xóa ảnh đã chọn").End.End.Div," list-group").Div,"row").Id("previewContainer"),t=new Core.Clients.Client.$ctor1("Images").GetList(Core.Models.Images,System.String.format("?$filter=Active eq true",null)),n=1,t.isCompleted())continue;t["continue"](e);return;case 1:u=t.getAwaitedResult();r=u;r.Value!=null&&this.RenderListImage(r.Value.ToArray());i.setResult(null);return;default:i.setResult(null);return}}}catch(o){f=System.Exception.create(o);i.setException(f)}},arguments);return e(),i.task},RenderPlaceHolder:function(){Core.Extensions.StringExt.IsNullOrWhiteSpace(this._path)&&(this._placeHolder=this.RenderFileThumb(null,!0))},RemoveFile:function(n,t){this.Disabled||(this._plus=null,n.stopPropagation(),Core.Extensions.StringExt.IsNullOrEmpty(t))||System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var i=0,r,u=new System.Threading.Tasks.TaskCompletionSource,f,e,n,o,s=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(f=this._path,System.Nullable.gt(this.GuiInfo.Precision,1)?(e=System.Linq.Enumerable.from(System.String.replaceAll(this._path,t,"").split(Core.Components.ImageServer.pathSeparator),System.String).where(function(n){return Core.Extensions.StringExt.HasAnyChar(n)}).toList(System.String),this.Path=Bridge.toArray(e).join(Core.Components.ImageServer.pathSeparator)):this.Path=null,r=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity]),i=1,r.isCompleted())continue;r["continue"](s);return;case 1:r.getAwaitedResult();Bridge.staticEquals(this.UserInput,null)||this.UserInput((n=new Core.MVVM.ObservableArgs,n.NewData=this._path,n.OldData=f,n.FieldName=this.GuiInfo.FieldName,n));this.Dirty=!0;u.setResult(null);return;default:u.setResult(null);return}}}catch(h){o=System.Exception.create(h);u.setException(o)}},arguments);return s(),u.task}))},UploadSelectedImages:function(n){var t=0,u,f,i=new System.Threading.Tasks.TaskCompletionSource,e,s,r,h,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2],t);switch(t){case 0:if(n.preventDefault(),e=Bridge.as(n.target.files,FileList),Core.Extensions.IEnumerableExtensions.Nothing(File,e)){i.setResult(null);return}if(s=this._path,u=this.UploadAllFiles(e),t=1,u.isCompleted())continue;u["continue"](o);return;case 1:if(u.getAwaitedResult(),this.Dirty=!0,this._input.value="",Bridge.staticEquals(this.UserInput,null)||this.UserInput((r=new Core.MVVM.ObservableArgs,r.NewData=this._path,r.OldData=s,r.FieldName=this.GuiInfo.FieldName,r)),f=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity]),t=2,f.isCompleted())continue;f["continue"](o);return;case 2:f.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(c){h=System.Exception.create(c);i.setException(h)}},arguments);return o(),i.task},UploadBase64Image:function(n,t){var i=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,e,o=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(System.String.contains(n,Core.Components.ImageServer.PNGUrlPrefix)?n=n.substr(Core.Components.ImageServer.PNGUrlPrefix.length):System.String.contains(n,Core.Components.ImageServer.JpegUrlPrefix)&&(n=n.substr(Core.Components.ImageServer.JpegUrlPrefix.length)),r=new Core.Clients.Client.$ctor1("Images").PostAsync(Core.Models.Images,n,System.String.format("UploadImage?filename={0}&path={1}",t,Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.DataSourceFilter)?"\\upload\\images":this.GuiInfo.DataSourceFilter)),i=1,r.isCompleted())continue;r["continue"](o);return;case 1:f=r.getAwaitedResult();u.setResult(f);return;default:u.setResult(null);return}}}catch(s){e=System.Exception.create(s);u.setException(e)}},arguments);return o(),u.task},UpdateView:function(n,t,i){var r;n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);this.Path=(r=Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName))!=null?Bridge.toString(r):null;Core.Components.EditableComponent.prototype.UpdateView.call(this)},UploadFile:function(n){var t=new System.Threading.Tasks.TaskCompletionSource,i=new FileReader,r=Core.Extensions.IEnumerableExtensions.HasElement(System.String,n.type.match("image.*"));return r?(i.onload=Bridge.fn.bind(this,function(i){var r=0,u,f,e,o=Bridge.fn.bind(this,function(){for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(u=this.ResizeAndUploadImage(Bridge.toString(i.target.result),n.name),r=1,u.isCompleted())continue;u["continue"](o);return;case 1:f=u.getAwaitedResult();e=f;t.setResult(e);return;default:return}}},arguments);o()}),i.readAsDataURL(n)):System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var i=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,e,o,s=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(r=new Core.Clients.Client.$ctor1("Images").PostFilesAsync(Core.Models.Images,n,"file"),i=1,r.isCompleted())continue;r["continue"](s);return;case 1:f=r.getAwaitedResult();e=f;t.setResult(e);u.setResult(null);return;default:u.setResult(null);return}}}catch(h){o=System.Exception.create(h);u.setException(o)}},arguments);return s(),u.task})),t.task},ResizeAndUploadImage:function(n,t){var r=new System.Threading.Tasks.TaskCompletionSource,i=new Image;return i.onload=Bridge.fn.combine(i.onload,Bridge.fn.bind(this,function(){var o=0,s,h,e,f,n,u,c,l,a,v=Bridge.fn.bind(this,function(){for(;;){o=System.Array.min([0,1],o);switch(o){case 0:if(e=document.createElement("canvas"),f=1024,n=i.width,u=i.height,n>u?n>f&&(u=Bridge.Int.clip32(u*(f/n)),n=f):u>f&&(n=Bridge.Int.clip32(n*(f/u)),u=f),e.width=n,e.height=u,c=e.getContext("2d"),c.drawImage(i,0,0,n,u),l=e.toDataURL(),s=this.UploadBase64Image(l,t),o=1,s.isCompleted())continue;s["continue"](v);return;case 1:h=s.getAwaitedResult();a=h;r.setResult(a);return;default:return}}},arguments);v()})),i.src=n,r.task},UploadAllFiles:function(n){var i=0,r,f,t=new System.Threading.Tasks.TaskCompletionSource,e,u,o,s=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(Core.Components.Spinner.AppendTo(Core.Components.ImageServer._backdrop),e=System.Linq.Enumerable.from(n,File).select(Bridge.fn.cacheBind(this,this.UploadFile)),r=System.Threading.Tasks.Task.whenAll(e),i=1,r.isCompleted())continue;r["continue"](s);return;case 1:if(f=r.getAwaitedResult(),u=f,Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.Images,u)){t.setResult(null);return}this.RenderListImage(u);Core.Components.Spinner.Hide();t.setResult(null);return;default:t.setResult(null);return}}}catch(h){o=System.Exception.create(h);t.setException(o)}},arguments);return s(),t.task},RenderListImage:function(n){n.forEach(Bridge.fn.bind(this,function(n){Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take$1("#previewContainer").Div,"item col-md-1 col-sm-3").Div,"thumbnail").Div.Img.Event("click",Bridge.fn.bind(this,function(){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.ChooseImage(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()})).Src(n.Url),"list-group-image").End.Input.Type$1("checkbox").Event("change",Bridge.fn.bind(this,function(){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.DeleteImage(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()})).End.End.End.End.Render()}))},ChooseImage:function(n){var i=0,r,u=new System.Threading.Tasks.TaskCompletionSource,t,f,e=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(System.Nullable.gt(this.GuiInfo.Precision,1)?this.Path=(this.Path||"")+(System.String.format("{0}{1}",Core.Components.ImageServer.pathSeparator,n.Url)||""):(this.Path=System.String.format("{0}",[n.Url]),this.ClosePopup()),this.Dirty=!0,Bridge.staticEquals(this.UserInput,null)||this.UserInput((t=new Core.MVVM.ObservableArgs,t.NewData=this._path,t.FieldName=this.GuiInfo.FieldName,t.EvType="change",t)),r=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity]),i=1,r.isCompleted())continue;r["continue"](e);return;case 1:r.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(o){f=System.Exception.create(o);u.setException(f)}},arguments);return e(),u.task},DeleteImage:function(){var t=0,n=new System.Threading.Tasks.TaskCompletionSource,i,r=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0],t);switch(t){case 0:n.setResult(null);return;default:n.setResult(null);return}}}catch(r){i=System.Exception.create(r);n.setException(i)}},arguments);return r(),n.task},OpenNativeFileDialog:function(n){n!=null?n.preventDefault():null;this._input.click()},GetValueText:function(){return Core.Extensions.IEnumerableExtensions.Nothing(System.String,this._imageSources)?null:Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this._imageSources,System.String).select(function(n){var t=Core.Components.ImageServer.RemoveGuid(n);return System.String.format('<a target="_blank" href="{0}">{1}<\/a>',n,t)}),",")},ClosePopup:function(){Core.Components.ImageServer._backdrop!=null?Core.Extensions.HtmlElementExtension.Hide(Core.Components.ImageServer._backdrop):null}}});Bridge.define("Core.Components.ImageUploader",{inherits:[Core.Components.EditableComponent],statics:{fields:{PathSeparator:null,PNGUrlPrefix:null,JpegUrlPrefix:null,GuidLength:0,_preview:null,_webcam:null},props:{Camera:null},ctors:{init:function(){this.PathSeparator="    ";this.PNGUrlPrefix="data:image/png;base64,";this.JpegUrlPrefix="data:image/jpeg;base64,";this.GuidLength=36}},methods:{RemoveGuid:function(n){var i=n,t;return n.length>Core.Components.ImageUploader.GuidLength&&(t=System.IO.Path.GetFileNameWithoutExtension(n),i=(Core.Extensions.StringExt.SubStrIndex$1(t,0,t.length-Core.Components.ImageUploader.GuidLength|0)||"")+(System.IO.Path.GetExtension(n)||"")),i}}},fields:{_path:null,_input:null,_disabledDelete:!1,_placeHolder:null,_gallerys:null,zoomLevel:0,flagZoomIn:0,zoomMaxLevel:0},events:{FileUploaded:null},props:{Path:{get:function(){return this._path},set:function(n){var t,i;(System.Linq.Enumerable.from(this.ParentElement.querySelectorAll(".gallery")).select(function(n){return Bridge.cast(n,HTMLElement)}).forEach(function(n){n.remove()}),this._path=n,this.Entity!=null&&Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this._path),Core.Extensions.StringExt.IsNullOrWhiteSpace(this._path))||(i=(t=System.String,System.Linq.Enumerable.from(this._path.split(Core.Components.ImageUploader.PathSeparator),t).toList(t)),Core.Extensions.IEnumerableExtensions.Nothing(System.String,i))||i.ForEach(Bridge.fn.bind(this,function(n){this.RenderFileThumb(n)}))}},DataSourceFilter:null,Label:null,_imageSources:{get:function(){return this._path!=null?this._path.split(Core.Components.ImageUploader.PathSeparator):null}},Disabled:{get:function(){return Bridge.ensureBaseProperty(this,"Disabled").$Core$Components$EditableComponent$Disabled},set:function(n){this._input!=null&&(this._input.disabled=n);Bridge.ensureBaseProperty(this,"Disabled").$Core$Components$EditableComponent$Disabled=n;n?this.ParentElement.setAttribute("disabled",""):this.ParentElement.removeAttribute("disabled")}}},ctors:{init:function(){this.flagZoomIn=1;this.zoomMaxLevel=3},ctor:function(n){var t,i;this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.GuiInfo=n;this.Label=(t=this.GuiInfo.PlainText,t!=null?t:"image/invoice.svg");this.DataSourceFilter=(i=this.GuiInfo.DataSourceFilter,i!=null?i:"image/*")}},methods:{Render:function(){var t,i,n,r,u;this._path=(t=this.Entity)!=null&&(i=Core.Extensions.Utils.GetComplexPropValue(t,this.GuiInfo.FieldName))!=null?Bridge.toString(i):null;u=this._path!=null?(n=System.String,System.Linq.Enumerable.from(this._path.split(Core.Components.ImageUploader.PathSeparator),n).toList(n)):null;this.RenderUploadForm();this.Path=this._path;Bridge.staticEquals(r=this.DOMContentLoaded,null)?null:r()},RenderFileThumb:function(n){Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this._gallerys).Div,"gallery");var t=Core.Components.ImageUploader.RemoveGuid(n),i=System.IO.Path.IsImage(n);return i?Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"file-upload").Img,"image").Style$1(this.GuiInfo.ChildStyle).Src(((System.String.contains(n,"http")?"":Core.Clients.Client.Origin)||"")+(Core.Extensions.Utils.DecodeSpecialChar(n)||"")).Render():Core.Components.Renderer.Title(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Span,System.String.contains(t,"pdf")?"fal fa-file-pdf":"fal fa-file"),Core.Extensions.Utils.DecodeSpecialChar(t)).Style$1(this.GuiInfo.ChildStyle).Href(((System.String.contains(n,"http")?"":Core.Clients.Client.Origin)||"")+(Core.Extensions.Utils.DecodeSpecialChar(n)||"")).Render(),Core.MVVM.Html.Instance.End.Render(),Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"middle d-flex").Div,"preview").Event$2(System.String,"click",Bridge.fn.cacheBind(this,this.Preview),Core.Extensions.Utils.DecodeSpecialChar(n)).I,"fas fa-eye").EndOf(Core.MVVM.ElementType.div),this.Disabled||Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"delete").Event$4(System.String,"click",Bridge.fn.cacheBind(this,this.RemoveFile),n).I,"fas fa-trash-alt").EndOf(Core.MVVM.ElementType.div),Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div,"middle-secondery").Style$1("font-size:8px").Text(Core.Extensions.Utils.DecodeSpecialChar(t)).Render(),this._gallerys},SetCanDeleteImage:function(n){this._disabledDelete=!n;n&&this.UpdateView()},Preview:function(n){if(!Core.Extensions.StringExt.IsNullOrWhiteSpace(n)){if(!System.IO.Path.IsImage(n)){Core.Clients.Client.Download(n);return}var t=null,i=0;Core.Components.Renderer.Escape(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(Bridge.ensureBaseProperty(this,"EditForm").$Core$Components$EditableComponent$EditForm.Element).Div,"dark-overlay zoom"),function(){Core.Components.ImageUploader._preview.remove()}).Event$1("keydown",Bridge.fn.bind(this,function(i){var r=Core.Extensions.EventExt.KeyCodeEnum(i);System.Nullable.neq(r,Core.Enums.KeyCodeEnum.LeftArrow)&&System.Nullable.neq(r,Core.Enums.KeyCodeEnum.RightArrow)||(n=System.Nullable.eq(r,Core.Enums.KeyCodeEnum.LeftArrow)?this.MoveLeft(n,t):this.MoveRight(n,t))}));Core.Components.ImageUploader._preview=Core.MVVM.Html.Context;Core.MVVM.Html.Instance.Img.Src(((System.String.contains(n,"http")?"":Core.Clients.Client.Origin)||"")+(n||""));t=Bridge.as(Core.MVVM.Html.Context,HTMLImageElement);Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.Title(Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Span,"close").Event("click",function(){Core.Components.ImageUploader._preview.remove()}).End.Div,"toolbar"),"fa fa-undo ro-left").Event("click",function(){i=i-90|0;t.style.transform=System.String.format("rotate({0}deg)",[Bridge.box(i,System.Int32)])}).End,"fa fa-cloud-download-alt"),"Tải xuống").Event("click",function(){var n=Bridge.as(document.createElement("a"),HTMLAnchorElement);n.href=t.src;n.download=t.src.substr(t.src.lastIndexOf("/"));document.body.appendChild(n);n.click();n.remove()}).End,"fa fa-redo ro-right").Event("click",function(){i=i+90|0;t.style.transform=System.String.format("rotate({0}deg)",[Bridge.box(i,System.Int32)])}).End.End,"fa fa-chevron-left").Event("click",Bridge.fn.bind(this,function(){n=this.MoveLeft(n,t)})).End,"fa fa-chevron-right").Event("click",Bridge.fn.bind(this,function(){n=this.MoveRight(n,t)})).End.Render();zoom()}},ZoomImage:function(n){this.flagZoomIn<this.zoomMaxLevel?(this.zoomLevel===0||this.zoomLevel<this.zoomMaxLevel)&&(n.style.cursor="zoom-in",n.height=n.height+450|0,n.width=n.width+400|0,this.zoomLevel=this.zoomLevel+1|0,this.flagZoomIn=this.flagZoomIn+1|0):this.flagZoomIn===this.zoomMaxLevel&&(this.zoomLevel===1&&(this.flagZoomIn=1),n.style.cursor="zoom-out",n.height=n.height-450|0,n.width=n.width-400|0,this.zoomLevel=this.zoomLevel-1|0)},MoveAround:function(n,t){var i=Core.Extensions.EventExt.KeyCodeEnum(n),r;System.Nullable.neq(i,Core.Enums.KeyCodeEnum.LeftArrow)&&System.Nullable.neq(i,Core.Enums.KeyCodeEnum.RightArrow)||(r=Bridge.as(n.target.firstElementChild,HTMLImageElement))!=null&&(System.Nullable.eq(i,Core.Enums.KeyCodeEnum.LeftArrow)?this.MoveLeft(t,r):this.MoveRight(t,r))},MoveLeft:function(n,t){var r,u,i=System.Array.indexOfT(this._imageSources,n);return i=i===0?this._imageSources.length-1|0:i-1|0,t.src=((System.String.contains(n,"http")?"":Core.Clients.Client.Origin)||"")+((r=this._imageSources)[System.Array.index(i,r)]||""),(u=this._imageSources)[System.Array.index(i,u)]},MoveRight:function(n,t){var r,u,i=System.Array.indexOfT(this._imageSources,n);return i=i===0?this._imageSources.length-1|0:i-1|0,t.src=((System.String.contains(n,"http")?"":Core.Clients.Client.Origin)||"")+((r=this._imageSources)[System.Array.index(i,r)]||""),(u=this._imageSources)[System.Array.index(i,u)]},OpenFileDialog:function(n){if(!this.Disabled){this.OpenNativeFileDialog(n);return}},RenderUploadForm:function(){var n=System.Nullable.eq(this.GuiInfo.Precision,0);Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement),"choose-files").Input.Type$1("file").Attr$1("name","files"),"d-none").Attr$1("accept",this.DataSourceFilter).AsyncEvent$1("change",Bridge.fn.cacheBind(this,this.UploadSelectedImages)).Render();this.Element=this._input=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement);n&&Core.MVVM.Html.Instance.Attr$1("multiple","multiple");Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Div,"file-upload").I,"fal fa-file-alt").Event$1("click",Bridge.fn.cacheBind(this,this.OpenFileDialog)).End.Div,"gallerys").Render();this._gallerys=Bridge.as(Core.MVVM.Html.Context,HTMLDivElement)},RemoveFile:function(n,t){this.Disabled||(n.stopPropagation(),Core.Extensions.StringExt.IsNullOrEmpty(t))||Core.Components.Forms.ConfirmDialog.RenderConfirm(System.String.format("Bạn chắc chắn muốn xóa {0}",[(System.IO.Path.GetFileNameWithoutExtension(Core.Components.ImageUploader.RemoveGuid(Core.Extensions.Utils.DecodeSpecialChar(t)))||"")+(System.IO.Path.GetExtension(Core.Components.ImageUploader.RemoveGuid(Core.Extensions.Utils.DecodeSpecialChar(t)))||"")]),Bridge.fn.bind(this,function(){var i=0,r,e,u,h,n,o,s,f=Bridge.fn.bind(this,function(){for(;;){i=System.Array.min([0,1,2],i);switch(i){case 0:if(r=(n=new Core.Clients.Client.$ctor1("User"),n.CustomPrefix=Core.Clients.Client.FileFTP,n).PostAsync(System.Boolean,t,"DeleteFile"),i=1,r.isCompleted())continue;r["continue"](f);return;case 1:if(e=r.getAwaitedResult(),h=e,o=this._path,s=System.Linq.Enumerable.from(System.String.replaceAll(System.String.replaceAll(this._path,t,""),"        ","").split(Core.Components.ImageUploader.PathSeparator),System.String).where(function(n){return Core.Extensions.StringExt.HasAnyChar(n)}).distinct().toList(System.String),this.Path=Bridge.toArray(s).join(Core.Components.ImageUploader.PathSeparator),this.Dirty=!0,Bridge.staticEquals(this.UserInput,null)||this.UserInput((n=new Core.MVVM.ObservableArgs,n.NewData=this._path,n.OldData=o,n.FieldName=this.GuiInfo.FieldName,n.EvType="change",n)),u=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity]),i=2,u.isCompleted())continue;u["continue"](f);return;case 2:u.getAwaitedResult();return;default:return}}},arguments);f()}))},UploadSelectedImages:function(n){var r=0,u,f,t=new System.Threading.Tasks.TaskCompletionSource,e,s,i,h,o=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1,2],r);switch(r){case 0:if(n.preventDefault(),this.EditForm.IsLock){t.setResult(null);return}if(e=Bridge.as(n.target.files,FileList),Core.Extensions.IEnumerableExtensions.Nothing(File,e)){t.setResult(null);return}if(s=this._path,u=this.UploadAllFiles(e),r=1,u.isCompleted())continue;u["continue"](o);return;case 1:if(u.getAwaitedResult(),this.Dirty=!0,this._input.value="",Bridge.staticEquals(this.UserInput,null)||this.UserInput((i=new Core.MVVM.ObservableArgs,i.NewData=this._path,i.OldData=s,i.FieldName=this.GuiInfo.FieldName,i.EvType="change",i)),f=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity]),r=2,f.isCompleted())continue;f["continue"](o);return;case 2:f.getAwaitedResult();t.setResult(null);return;default:t.setResult(null);return}}}catch(c){h=System.Exception.create(c);t.setException(h)}},arguments);return o(),t.task},UploadBase64Image:function(n,t){var i=0,r,e,u=new System.Threading.Tasks.TaskCompletionSource,f,o,s=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(System.String.contains(n,Core.Components.ImageUploader.PNGUrlPrefix)?n=n.substr(Core.Components.ImageUploader.PNGUrlPrefix.length):System.String.contains(n,Core.Components.ImageUploader.JpegUrlPrefix)&&(n=n.substr(Core.Components.ImageUploader.JpegUrlPrefix.length)),r=(f=new Core.Clients.Client.$ctor1("FileUpload"),f.CustomPrefix=Core.Clients.Client.FileFTP,f).PostAsync(System.String,n,System.String.format("Image?name={0}&tanentcode={1}&userid={2}",Core.Extensions.Utils.DecodeSpecialChar(t),Core.Clients.Client.Tenant,Bridge.box(Core.Clients.Client.Token.UserId,System.Int32)),!1,!0),i=1,r.isCompleted())continue;r["continue"](s);return;case 1:e=r.getAwaitedResult();u.setResult(e);return;default:u.setResult(null);return}}}catch(h){o=System.Exception.create(h);u.setException(o)}},arguments);return s(),u.task},UpdateView:function(n,t,i){var r;n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);this.Path=(r=Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName))!=null?Bridge.toString(r):null;Core.Components.EditableComponent.prototype.UpdateView.call(this,n,t,i)},UploadFile:function(n){var t=new System.Threading.Tasks.TaskCompletionSource,i=new FileReader;return!this.GuiInfo.IsRealtime&&Core.Extensions.IEnumerableExtensions.HasElement(System.String,n.type.match("image.*"))?(i.onload=Bridge.fn.bind(this,function(i){var u=0,f,h,e,l,o,c,r,s=Bridge.fn.bind(this,function(){for(;;){u=System.Array.min([0,1,2],u);switch(u){case 0:if(f=this.UploadBase64Image(Bridge.toString(i.target.result),n.name),u=1,f.isCompleted())continue;f["continue"](s);return;case 1:if(h=f.getAwaitedResult(),o=h,c=(r=new Core.ViewModels.FileUpload,r.EntityName=Bridge.Reflection.getTypeName(Bridge.getType(this.Entity)),r.RecordId=this.EntityId,r.SectionId=this.GuiInfo.ComponentGroupId,r.FieldName=this.GuiInfo.FieldName,r.FileName=n.name,r.FilePath=o,r),e=new Core.Clients.Client.$ctor1("FileUpload").CreateAsync(Core.ViewModels.FileUpload,c),u=2,e.isCompleted())continue;e["continue"](s);return;case 2:l=e.getAwaitedResult();t.setResult(o);return;default:return}}},arguments);s()}),i.readAsDataURL(n)):System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var i=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,e,o,s=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(r=new Core.Clients.Client.$ctor1("FileUpload").PostFilesAsync(System.String,n,System.String.format("file?&tanentcode={0}&userid={1}",Core.Clients.Client.Tenant,Bridge.box(Core.Clients.Client.Token.UserId,System.Int32))),i=1,r.isCompleted())continue;r["continue"](s);return;case 1:f=r.getAwaitedResult();e=f;t.setResult(e);u.setResult(null);return;default:u.setResult(null);return}}}catch(h){o=System.Exception.create(h);u.setException(o)}},arguments);return s(),u.task})),t.task},UploadAllFiles:function(n){var r=0,u,f,t=new System.Threading.Tasks.TaskCompletionSource,e,i,o,c,s,h=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(Core.Components.Spinner.AppendTo(this.EditForm.Element),e=System.Linq.Enumerable.from(n,File).select(Bridge.fn.cacheBind(this,this.UploadFile)),u=System.Threading.Tasks.Task.whenAll(e),r=1,u.isCompleted())continue;u["continue"](h);return;case 1:if(f=u.getAwaitedResult(),i=f,Core.Extensions.IEnumerableExtensions.Nothing(System.String,i)){t.setResult(null);return}System.Nullable.eq(this.GuiInfo.Precision,0)&&(o=(this.Path||"")+(Core.Components.ImageUploader.PathSeparator||"")+(i.join(Core.Components.ImageUploader.PathSeparator)||""),i=System.Linq.Enumerable.from(o.trim().split(Core.Components.ImageUploader.PathSeparator),System.String).distinct().ToArray(System.String));c=this._path;this.Path=i.join(Core.Components.ImageUploader.PathSeparator);Core.Components.Spinner.Hide();Bridge.staticEquals(this.FileUploaded,null)?null:this.FileUploaded();t.setResult(null);return;default:t.setResult(null);return}}}catch(l){s=System.Exception.create(l);t.setException(s)}},arguments);return h(),t.task},OpenNativeFileDialog:function(n){n!=null?n.preventDefault():null;this._input.click()},GetValueText:function(){return Core.Extensions.IEnumerableExtensions.Nothing(System.String,this._imageSources)?null:Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this._imageSources,System.String).select(function(n){var t=Core.Components.ImageUploader.RemoveGuid(n);return System.String.format('<a target="_blank" href="{0}">{1}<\/a>',n,t)}),",")}}});Bridge.define("Core.Components.LangSelect",{inherits:[Core.Components.EditableComponent],statics:{fields:{LangProp:null,LangKey:null,LangParam:null,LangCode:null,Active:null,culture:null,_dictionaries:null},props:{Culture:{get:function(){if(Core.Components.LangSelect.culture!=null)return Core.Components.LangSelect.culture!=null?System.String.replaceAll(Core.Components.LangSelect.culture,'"',""):null;var n=Core.Clients.LocalStorage.GetItem(System.String,"Culture");return n!=null&&(Core.Components.LangSelect.culture=n!=null?System.String.replaceAll(n,'"',""):null),n!=null?System.String.replaceAll(n,'"',""):null},set:function(n){Bridge.referenceEquals(Core.Components.LangSelect.culture,n)||(Core.Components.LangSelect.culture=n!=null?System.String.replaceAll(n,'"',""):null,Core.Clients.LocalStorage.SetItem(System.String,"Culture",n!=null?System.String.replaceAll(n,'"',""):null))}}},ctors:{init:function(){this.LangProp="langprop";this.LangKey="langkey";this.LangParam="Para";this.LangCode="langcode";this.Active="Active";this._dictionaries=new(System.Collections.Generic.Dictionary$2(System.String,System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor)}},methods:{SetCultureAndTranslate:function(n){Core.Components.LangSelect.Culture=n;System.Threading.Tasks.Task.run(Core.Components.LangSelect.Translate)},Get:function(n){if(Core.Extensions.StringExt.IsNullOrEmpty(n))return"";if(Core.Components.LangSelect.Culture==null)return n;var t=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String,System.Collections.Generic.Dictionary$2(System.String,System.String),Core.Components.LangSelect._dictionaries,Core.Components.LangSelect.Culture);return t==null&&(t=Core.Clients.LocalStorage.GetItem(System.Collections.Generic.Dictionary$2(System.String,System.String),Core.Components.LangSelect.Culture),Core.Components.LangSelect._dictionaries.containsKey(Core.Components.LangSelect.Culture)&&Core.Components.LangSelect._dictionaries.remove(Core.Components.LangSelect.Culture),System.Collections.Generic.CollectionExtensions.TryAdd(System.String,System.Collections.Generic.Dictionary$2(System.String,System.String),Core.Components.LangSelect._dictionaries,Core.Components.LangSelect.Culture,t)),t!=null&&t.containsKey(n)?t.getItem(n):n},Translate:function(){var t=0,i,u,r=new System.Threading.Tasks.TaskCompletionSource,f,n,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=new Core.Clients.Client.$ctor1("Dictionary").GetRawList(Core.Models.Dictionary,System.String.format("/?t={0}&$filter=LangCode eq '{1}'",Core.Clients.Client.Tenant,Core.Components.LangSelect.Culture),!1,!0,!0,void 0),t=1,i.isCompleted())continue;i["continue"](o);return;case 1:u=i.getAwaitedResult();f=u;n=System.Linq.Enumerable.from(f,Core.Models.Dictionary).toDictionary(function(n){return n.Key},function(n){return n.Value},System.String,System.String);Core.Components.LangSelect._dictionaries.containsKey(Core.Components.LangSelect.Culture)&&(Core.Components.LangSelect._dictionaries.remove(Core.Components.LangSelect.Culture),Core.Components.LangSelect._dictionaries.add(Core.Components.LangSelect.Culture,n));Core.Clients.LocalStorage.SetItem(System.Collections.Generic.Dictionary$2(System.String,System.String),Core.Components.LangSelect.Culture,n);Core.Extensions.IEnumerableExtensions.ForEach(Node,Core.Components.LangSelect.Travel(document),function(t){var i,r=(i=t[Core.Components.LangSelect.LangProp])!=null?Bridge.toString(i):null;r!=null&&r.split(",").forEach(function(i){var e,u=(e=t[(Core.Components.LangSelect.LangKey||"")+(i||"")])!=null?Bridge.toString(e):null,o=Bridge.as(t[(Core.Components.LangSelect.LangParam||"")+(i||"")],System.Array.type(System.Object)),r=n.containsKey(u)?n.getItem(u):u,s,f;if(r=Core.Extensions.IEnumerableExtensions.HasElement(System.Object,o)?System.String.format.apply(System.String,[r].concat(o)):r,(s=Bridge.as(t,Text))!=null&&Bridge.referenceEquals(i,"TextContent")){s.textContent=r;return}f=Bridge.as(t,HTMLElement);Bridge.referenceEquals(i,"ClassName")?f.className=System.String.replaceAll(f.className,u,r):f.setAttribute(i,r)})});r.setResult(null);return;default:r.setResult(null);return}}}catch(s){e=System.Exception.create(s);r.setException(e)}},arguments);return o(),r.task},Travel:function(){return new(Bridge.GeneratorEnumerable$1(Node))(Bridge.fn.bind(this,function(n){var t=0,i,r,u,e,o,f=new(Bridge.GeneratorEnumerator$1(Node))(Bridge.fn.bind(this,function(){try{for(;;)switch(t){case 0:i=Bridge.getEnumerator(n.childNodes,"getEnumerator");t=1;continue;case 1:if(i.moveNext()){r=i.Current;t=2;continue}t=8;continue;case 2:return f.current=r,t=3,!0;case 3:u=Bridge.getEnumerator(Core.Components.LangSelect.Travel(r),Node);t=4;continue;case 4:if(u.moveNext()){e=u.Current;t=5;continue}t=7;continue;case 5:return f.current=e,t=6,!0;case 6:t=4;continue;case 7:t=1;continue;case 8:default:return!1}}catch(s){o=System.Exception.create(s);throw o;}}));return f},arguments))}}},ctors:{ctor:function(n,t){this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.ParentElement=t}},methods:{Render:function(){var n={};this.GuiInfo!=null&&!Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.FormatData)&&Core.Extensions.Utils.IsFunction(this.GuiInfo.FormatData,n)&&(Core.MVVM.Html.Take(this.ParentElement),n.v.call(null,this),this.Element=this.ParentElement.firstElementChild);this.Element==null&&(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Ul,"lang-select").Li.DataAttr$1(Core.Components.LangSelect.LangCode,"vi").Attr$1(Core.Components.LangSelect.Active,System.Boolean.toString(!0).toLowerCase()).Img.Src("./icons/vn.png").EndOf(Core.MVVM.ElementType.li).Li.DataAttr$1(Core.Components.LangSelect.LangCode,"en").Img.Src("./icons/eg.png").EndOf(Core.MVVM.ElementType.li),this.Element=Core.MVVM.Html.Context);System.Linq.Enumerable.from(Core.Components.LangSelect.Travel(this.Element),Node).where(function(n){return Bridge.is(n,HTMLElement)}).select(function(n){return Bridge.cast(n,HTMLElement)}).forEach(Bridge.fn.bind(this,function(n){var t=n.dataset[Core.Components.LangSelect.LangCode];Core.Extensions.StringExt.IsNullOrEmpty(t)||(n.addEventListener("click",Bridge.fn.bind(this,function(){Bridge.referenceEquals(n.getAttribute(Core.Components.LangSelect.Active),System.Boolean.toString(!0).toLowerCase())||(System.Linq.Enumerable.from(this.Element.querySelectorAll("[Active=true]")).select(function(n){return Bridge.cast(n,HTMLElement)}).forEach(function(n){n.removeAttribute(Core.Components.LangSelect.Active)}),n.setAttribute(Core.Components.LangSelect.Active,System.Boolean.toString(!0).toLowerCase()),Core.Components.LangSelect.SetCultureAndTranslate(t))})),Core.Components.LangSelect.Culture==null&&Bridge.referenceEquals(n.getAttribute(Core.Components.LangSelect.Active),System.Boolean.toString(!0).toLowerCase())&&Core.Components.LangSelect.SetCultureAndTranslate(t))}));Core.MVVM.Html.Take(this.ParentElement)}}});Bridge.define("Core.Components.Link",{inherits:[Core.Components.EditableComponent],ctors:{ctor:function(n,t){t===void 0&&(t=null);this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.GuiInfo=n||function(){throw new System.ArgumentNullException.$ctor1("ui");}();this.Element=t}},methods:{Render:function(){var n,t;this.Element==null&&(this.Element=Core.Components.Renderer.IText(Core.MVVM.Html.Take(this.ParentElement).A,(n=this.GuiInfo.PlainText,n!=null?n:this.GuiInfo.Label)).GetContext());this.Element.addEventListener("click",Bridge.fn.bind(this,function(n){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.DispatchClick(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()}));Bridge.staticEquals(t=this.DOMContentLoaded,null)?null:t()},UpdateView:function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[])},DispatchClick:function(n){var t=0,r,u,c,i=new System.Threading.Tasks.TaskCompletionSource,f,s,e,h,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4],t);switch(t){case 0:if(n.preventDefault(),Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.Events)&&System.String.contains(this.GuiInfo.Events.toLowerCase(),"click")){t=1;continue}t=3;continue;case 1:if(r=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"click",[this.Entity]),t=2,r.isCompleted())continue;r["continue"](o);return;case 2:r.getAwaitedResult();i.setResult(null);return;case 3:if(f=Bridge.as(this.Element,HTMLAnchorElement),s=Core.Extensions.Utils.GetUrlParam(Core.Extensions.Utils.FeatureField,f.href),Core.Components.Spinner.AppendTo(Bridge.as(document.querySelector("header"),HTMLElement)||document.body,!0,!0,1e3),u=Core.Components.Extensions.ComponentExt.InitFeatureByName((e=s,e!=null?e:"Home")),t=4,u.isCompleted())continue;u["continue"](o);return;case 4:c=u.getAwaitedResult();window.history.pushState(null,f.title,f.href);i.setResult(null);return;default:i.setResult(null);return}}}catch(l){h=System.Exception.create(l);i.setException(h)}},arguments);return o(),i.task}}});Bridge.define("Core.Components.ListViewSearch",{inherits:[Core.Components.EditableComponent],fields:{_uploader:null,_fullTextSearch:null,BasicSearch:null,parentListView:null,parentGridView:null},props:{EntityVM:{get:function(){return Bridge.as(this.Entity,Core.Components.ListViewSearchVM)}},DateTimeField:null,ParentListView:{get:function(){return this.parentListView!=null?this.parentListView:Bridge.as(this.Parent,Core.Components.ListView)},set:function(n){this.parentListView=n}},ParentGridView:{get:function(){return this.parentGridView!=null?this.parentGridView:Bridge.as(this.Parent,Core.Components.GridView)},set:function(n){this.parentGridView=n}},Disabled:{get:function(){return!1},set:function(){this._disabled=!1}}},ctors:{ctor:function(n){var t;this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.PopulateDirty=!1;this.AlwaysValid=!0;this.GuiInfo=n||function(){throw new System.ArgumentNullException.$ctor1("ui");}();this.DateTimeField=(t=n.DateTimeField,t!=null?t:"InsertedDate");this.Entity=new Core.Components.ListViewSearchVM}},methods:{ParentListView_HeaderLoaded:function(n){var t;if(this.BasicSearch=System.Linq.Enumerable.from(n,Core.Models.GridPolicy).where(function(n){return n.BasicSearch}).orderByDescending(function(n){return n.Order}).ToArray(Core.Models.GridPolicy),!Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.GridPolicy,this.BasicSearch)){Core.MVVM.Html.Take(this.Element);var r=System.Linq.Enumerable.from(this.BasicSearch,Core.Models.GridPolicy).select(Bridge.fn.bind(this,function(n){var i,r,t=Core.Extensions.Utils.MapToComponent(n),u=Core.Extensions.Utils.TryParse(Core.Enums.ComponentTypeTypeEnum,t.ComponentType);return t.ShowLabel=!1,t.PlainText=n.ShortDesc,t.Visibility=!0,t.Column=1,this.ParentListView.AdvSearchVM.Conditions.add((i=new Core.Models.FieldCondition,i.FieldId=t.Id,i.CompareOperatorId=System.Linq.Enumerable.from(Core.Components.AdvancedSearch.OperatorFactory((r=u,r!=null?r:Core.Enums.ComponentTypeTypeEnum.Textbox)),Core.Models.Entity).firstOrDefault(null,null).Id,i.LogicOperatorId=Core.Enums.LogicOperation.And,i.Field=n,i)),t})).ToArray(Core.Models.Component),u=(t=new Core.Models.ComponentGroup,t.Component=r,t.Responsive=!0,t.Column=r.length,t.ClassName="wrapper",t),i=Core.Components.Section.RenderSection(this,u);for(i.Children.ForEach(Bridge.fn.bind(this,function(n){n.UserInput=Bridge.fn.combine(n.UserInput,Bridge.fn.bind(this,function(){var t,i=System.Linq.Enumerable.from(this.ParentListView.AdvSearchVM.Conditions,Core.Models.FieldCondition).firstOrDefault(function(t){return t.FieldId===n.GuiInfo.Id},null);i.Value=(t=Core.Components.Extensions.ComponentExt.GetValue(n,!0))!=null?Bridge.toString(t):null}))}));i.Element.children.length>0;)this.Element.insertBefore(i.Element.firstChild,this.Element.firstChild)}},Render:function(){var t,n,r,u,i,f,e,o,s;(this.ParentListView=Bridge.as(this.Parent,Core.Components.ListView),this.ParentListView.addHeaderLoaded(Bridge.fn.cacheBind(this,this.ParentListView_HeaderLoaded)),this.GuiInfo.CanSearch)&&(Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(this.Parent.Element.firstElementChild),-1).AsyncEvent$1("keypress",Bridge.fn.cacheBind(this,this.EnterSearch)),this.Element=Core.MVVM.Html.Context,(Bridge.referenceEquals(this.GuiInfo.ComponentType,"GridView")||Bridge.referenceEquals(this.GuiInfo.ComponentType,"TreeView"))&&(u=(t=new Core.Components.Textbox((n=new Core.Models.Component,n.FieldName="SearchTerm",n.Visibility=!0,n.Label="Tìm kiếm",n.PlainText="Tìm kiếm",n.ShowLabel=!1,n)),t.ParentElement=this.Element,t),u.UserInput=null,this.AddChild(u)),Bridge.referenceEquals(this.GuiInfo.ComponentType,"ListView")||Bridge.referenceEquals(this.GuiInfo.ComponentType,"TreeView")||(i=(t=new Core.Components.Textbox((n=new Core.Models.Component,n.FieldName="FullTextSearch",n.Visibility=!0,n.Label="Lọc hiển thị",n.PlainText="Lọc hiển thị",n.ShowLabel=!1,n)),t.ParentElement=this.Element,t),i.UserInput=null,this.AddChild(i),this._fullTextSearch=i.Input,this._fullTextSearch.addEventListener("input",Bridge.fn.cacheBind(this.ParentGridView,this.ParentGridView.FullTextSearch))),this.GuiInfo.UpperCase&&(f=(t=new Core.Components.Textbox((n=new Core.Models.Component,n.FieldName="ScanTerm",n.Visibility=!0,n.Label="Scan",n.PlainText="Scan",n.ShowLabel=!1,n.Focus=!0,n.Events="{'input':'ScanGridView'}",n)),t.ParentElement=this.Element,t),f.UserInput=null,this.AddChild(f)),e=(t=new Core.Components.Datepicker((n=new Core.Models.Component,n.FieldName="StartDate",n.Visibility=!0,n.Label="Từ ngày",n.PlainText="Từ ngày",n.ShowLabel=!1,n)),t.ParentElement=this.Element,t),e.UserInput=null,this.AddChild(e),o=(t=new Core.Components.Datepicker((n=new Core.Models.Component,n.FieldName="EndDate",n.Visibility=!0,n.Label="Đến ngày",n.PlainText="Đến ngày",n.ShowLabel=!1,n)),t.ParentElement=this.Element,t),o.UserInput=null,this.AddChild(o),this.ParentListView.GuiInfo.ShowDatetimeField!=null&&System.Nullable.getValue(this.ParentListView.GuiInfo.ShowDatetimeField)&&(s=(t=new Core.Components.SearchEntry((n=new Core.Models.Component,n.FieldName="DateTimeField",n.PlainText="Loại ngày",n.FormatData="{ShortDesc}",n.DataSourceFilter=System.String.format("?$filter=Active eq true and ComponentType eq '{0}' and FeatureId eq {1}","Datepicker",Bridge.box(this.EditForm.Feature.Id,System.Int32)),n.ShowLabel=!1,n.ReferenceId=Core.Extensions.Utils.GetEntity$1("GridPolicy").Id,n.RefName="GridPolicy",n.Reference=(r=new Core.Models.Entity,r.Name="GridPolicy",r),n)),t.ParentElement=this.Element,t),s.UserInput=null,this.AddChild(s)),Core.Components.Renderer.Title(Core.Components.Renderer.Button(Core.Components.Renderer.Title(Core.Components.Renderer.Button(Core.Components.Renderer.Icon(Core.Components.Renderer.Title(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div,"searching-block"),"Tìm kiếm","button secondary small btn-toolbar","fa fa-search").Event("click",Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(this.ParentListView.ClearSelected(),t=this.ParentListView.ActionFilter(),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()})).End,"","button secondary small btn-toolbar right","fa fa-cog"),"Nâng cao"),"fa fa-chevron-down").End.Event$1("click",Bridge.fn.cacheBind(this,this.AdvancedOptions)).End,"","btnSearch button secondary small btn-toolbar right","fa fa-undo"),"Làm mới").Event("click",Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.RefershListView(),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()})).End,"","btn btn-secondary btn-sm","fal fa-compress-wide"),"Phóng to").Event("click",Bridge.fn.cacheBind(this,this.FullScreen)).End.Render(),this.GuiInfo.ShowHotKey&&Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div,"hotkey-block"),"F1","btn btn-light btn-sm","").Event("click",Bridge.fn.cacheBind(this.ParentGridView,this.ParentGridView.ToggleAll)).Attr$1("title","Bỏ chọn tất cả").End,"F2","btn btn-light btn-sm","").Event$1("click",Bridge.fn.bind(this,function(n){var t=System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children,Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this,function(n){return n.GuiInfo.Id===this.ParentGridView.LastComponentFocus.Id}),null);this.ParentGridView.ActionKeyHandler(n,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,t,Core.Extensions.HtmlElementExtension.Closest(t.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),Core.Enums.KeyCodeEnum.F2)})).Attr$1("title","Lọc loại trừ").End,"F3","btn btn-light btn-sm","").Event$1("click",Bridge.fn.bind(this,function(n){var t=System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children,Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this,function(n){return n.GuiInfo.Id===this.ParentGridView.LastComponentFocus.Id}),null);this.ParentGridView.ActionKeyHandler(n,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,t,Core.Extensions.HtmlElementExtension.Closest(t.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),Core.Enums.KeyCodeEnum.F3)})).Attr$1("title","Cộng tổng dòng được chọn").End,"F4","btn btn-light btn-sm","").Event$1("click",Bridge.fn.bind(this,function(n){var t=System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children,Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this,function(n){return n.GuiInfo.Id===this.ParentGridView.LastComponentFocus.Id}),null);this.ParentGridView.ActionKeyHandler(n,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,t,Core.Extensions.HtmlElementExtension.Closest(t.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),Core.Enums.KeyCodeEnum.F4)})).Attr$1("title","Lọc tiếp theo các phép tính (Chứa: Bằng; Lớn hơn; Nhỏ hơn; Lớn hơn hoặc bằng;...)").End,"F6","btn btn-light btn-sm","").Event$1("click",Bridge.fn.bind(this,function(n){this.ParentGridView.HotKeyF6Handler(n,Core.Enums.KeyCodeEnum.F6)})).Attr$1("title","Quay lại lần lọc trước").End,"F8","btn btn-light btn-sm","").Event$1("click",Bridge.fn.bind(this,function(n){var t=System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children,Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this,function(n){return n.GuiInfo.Id===this.ParentGridView.LastComponentFocus.Id}),null);this.ParentGridView.ActionKeyHandler(n,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,t,Core.Extensions.HtmlElementExtension.Closest(t.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),Core.Enums.KeyCodeEnum.F8)})).Attr$1("title","Xóa/ Vô hiệu hóa dòng hiện thời hoặc các dòng đánh dấu").End,"F9","btn btn-light btn-sm","").Event$1("click",Bridge.fn.bind(this,function(n){var t=System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children,Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this,function(n){return n.GuiInfo.Id===this.ParentGridView.LastComponentFocus.Id}),null);this.ParentGridView.ActionKeyHandler(n,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,t,Core.Extensions.HtmlElementExtension.Closest(t.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),Core.Enums.KeyCodeEnum.F9)})).Attr$1("title","Lọc tại chỗ theo giá trị ô hiện thời").End,"F10","btn btn-light btn-sm","").Event$1("click",Bridge.fn.bind(this,function(n){var t=System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children,Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this,function(n){return n.GuiInfo.Id===this.ParentGridView.LastComponentFocus.Id}),null);this.ParentGridView.ActionKeyHandler(n,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,t,Core.Extensions.HtmlElementExtension.Closest(t.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),Core.Enums.KeyCodeEnum.F10)})).Attr$1("title","Gộp theo cột hiện thời(thống kê lại số nội dung trong cột)").End,"F11","btn btn-light btn-sm","").Event$1("click",Bridge.fn.bind(this,function(n){var t=System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children,Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this,function(n){return n.GuiInfo.Id===this.ParentGridView.LastComponentFocus.Id}),null);this.ParentGridView.ActionKeyHandler(n,this.ParentGridView.LastComponentFocus,this.ParentGridView.LastListViewItem,t,Core.Extensions.HtmlElementExtension.Closest(t.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),Core.Enums.KeyCodeEnum.F11)})).Attr$1("title","Sắp xếp thứ tự tăng dần, giảm dần").End.Render())},FullScreen:function(){var n=this.ParentListView.Element;n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()},EnterSearch:function(n){var i=0,r,t=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(Core.Extensions.EventExt.KeyCode(n)!==13){t.setResult(null);return}if(r=this.ParentListView.ApplyFilter(),i=1,r.isCompleted())continue;r["continue"](f);return;case 1:r.getAwaitedResult();t.setResult(null);return;default:t.setResult(null);return}}}catch(e){u=System.Exception.create(e);t.setException(u)}},arguments);return f(),t.task},UploadCsv:function(n){var r=0,u,e,i=new System.Threading.Tasks.TaskCompletionSource,f,o,s,h,c,l,t,a,v=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(f=Bridge.as(n.target.files,FileList),Core.Extensions.IEnumerableExtensions.Nothing(File,f)){i.setResult(null);return}if(o=System.Linq.Enumerable.from(f,File).firstOrDefault(null,null).name,s=Bridge.as(this._uploader.parentElement,HTMLFormElement),h=new FormData(s),c=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm,this),u=c.Client.SubmitAsync(Blob,(t=new Core.Clients.XHRWrapper,t.FormData=h,t.Url="importCsv",t.Method=Core.Enums.HttpMethod.POST,t.ResponseMimeType=Core.Extensions.Utils.GetMimeType("csv"),t)),r=1,u.isCompleted())continue;u["continue"](v);return;case 1:e=u.getAwaitedResult();l=e;Core.Components.Extensions.ComponentExt.DownloadFile(o,l);Core.Extensions.Toast.Success("Import excel thành công");this._uploader.value="";i.setResult(null);return;default:i.setResult(null);return}}}catch(y){a=System.Exception.create(y);i.setException(a)}},arguments);return v(),i.task},AdvancedOptions:function(n){var i,r=n.target.getBoundingClientRect(),u=Core.Clients.LocalStorage.GetItem(System.Nullable$1(System.Boolean),"Show"+this.GuiInfo.Id)==null?!1:Core.Clients.LocalStorage.GetItem(System.Nullable$1(System.Boolean),"Show"+this.GuiInfo.Id),t=Core.Components.Forms.ContextMenu.Instance;t.Top=r.bottom;t.Left=r.left;t.MenuItems=Bridge.fn.bind(this,function(n){var t;return n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fa-search-plus mr-1",t.Text="Nâng cao",t.Click=Bridge.fn.cacheBind(this,this.AdvancedSearch),t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fa-search mr-1",t.Text="Lọc dữ liệu đã chọn",t.Click=Bridge.fn.cacheBind(this,this.FilterSelected),t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fa-download mr-1",t.Text="Excel toàn bộ",t.Click=Bridge.fn.cacheBind(this,this.ExportAllData),t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fal fa-ballot-check mr-1",t.Text="Excel đã chọn",t.Click=Bridge.fn.cacheBind(this,this.ExportSelectedData),t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fa-download mr-1",t.Text="Excel tùy chọn",t.Click=Bridge.fn.cacheBind(this,this.ExportCustomData),t)),n})(new(System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem).ctor));t.Render();Core.MVVM.Html.Take(this.Element).Form.Attr$1("method","POST").Attr$1("enctype","multipart/form-data").Display$1(!1).Input.Type$1("file").Id(System.String.format("id_{0}",[Bridge.box(Bridge.getHashCode(this),System.Int32)])).Attr$1("name","files").Attr$1("accept",".csv");this._uploader=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement);this._uploader.addEventListener(System.Enum.toString(System.String,"change"),Bridge.fn.bind(this,function(n){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.UploadCsv(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()}));(i=System.Linq.Enumerable.from(t.Element.children,HTMLElement).firstOrDefault(null,null))!=null?i.appendChild(this._uploader.parentElement):null},FilterSelected:function(){var n=this.ParentListView.SelectedIds;if(Core.Extensions.IEnumerableExtensions.Nothing(System.Int32,n)){Core.Extensions.Toast.Warning("Vui lòng chọn dòng cần lọc");return}System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var i=0,r,u=new System.Threading.Tasks.TaskCompletionSource,t,f,e=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(System.Linq.Enumerable.from(this.ParentListView.CellSelected,Core.Models.CellSelected).any(function(n){return Bridge.referenceEquals(n.FieldName,Core.Components.EditableComponent.IdField)})?(System.Linq.Enumerable.from(this.ParentListView.CellSelected,Core.Models.CellSelected).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,Core.Components.EditableComponent.IdField)},null).Value=Core.Extensions.IEnumerableExtensions.Combine(System.Int32,n),System.Linq.Enumerable.from(this.ParentListView.CellSelected,Core.Models.CellSelected).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,Core.Components.EditableComponent.IdField)},null).ValueText=Core.Extensions.IEnumerableExtensions.Combine(System.Int32,n)):(this.ParentListView.CellSelected.add((t=new Core.Models.CellSelected,t.FieldName=Core.Components.EditableComponent.IdField,t.FieldText="Mã",t.ComponentType="Input",t.Value=Core.Extensions.IEnumerableExtensions.Combine(System.Int32,n),t.ValueText=Core.Extensions.IEnumerableExtensions.Combine(System.Int32,n),t.Operator="in",t.OperatorText="Chứa",t.Logic=Core.Enums.LogicOperation.And,t)),this.ParentGridView._summarys.add(document.createElement("div"))),r=this.ParentListView.ActionFilter(),i=1,r.isCompleted())continue;r["continue"](e);return;case 1:r.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(o){f=System.Exception.create(o);u.setException(f)}},arguments);return e(),u.task}))},LiteGridView:function(){var n=Core.Clients.LocalStorage.GetItem(System.Nullable$1(System.Boolean),"Show"+this.GuiInfo.Id)==null?!1:Core.Clients.LocalStorage.GetItem(System.Nullable$1(System.Boolean),"Show"+this.GuiInfo.Id);Core.Clients.LocalStorage.SetItem(System.Nullable$1(System.Boolean),"Show"+this.GuiInfo.Id,!System.Nullable.getValue(n));window.location.reload()},ExportCustomData:function(){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,f,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.OpenPopup(this.TabEditor,"Export CustomData",Bridge.fn.bind(this,function(){var n;return n=new Core.Components.ExportCustomData(this.ParentListView),n.ParentListView=Bridge.as(this.Parent,Core.Components.ListView),n.ParentElement=this.TabEditor.Element,n})),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:f=t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(e){r=System.Exception.create(e);i.setException(r)}},arguments);return u(),i.task}))},ShowHidden:function(n){var i,r=n.target.getBoundingClientRect(),t=Core.Components.Forms.ContextMenu.Instance;t.Top=r.bottom;t.Left=r.left;t.MenuItems=Bridge.fn.bind(this,function(n){var t;return n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fa-cloud-upload-alt",t.Text="Nhập excel",t.Click=Bridge.fn.cacheBind(this,this.OpenExcelFileDialog),t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fa-download",t.Text="Xuất hiển thị",t.Click=Bridge.fn.cacheBind(this,this.ExportDisplay),t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fa-download",t.Text="Xuất toàn bộ",t.Click=Bridge.fn.cacheBind(this,this.ExportAllData),t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fa-download",t.Text="Xuất tùy chọn",t.Click=Bridge.fn.cacheBind(this,this.ExportAllData),t)),n})(new(System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem).ctor));t.Render();Core.MVVM.Html.Take(this.Element).Form.Attr$1("method","POST").Attr$1("enctype","multipart/form-data").Display$1(!1).Input.Type$1("file").Id(System.String.format("id_{0}",[Bridge.box(Bridge.getHashCode(this),System.Int32)])).Attr$1("name","files").Attr$1("accept",".csv");this._uploader=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement);this._uploader.addEventListener(System.Enum.toString(System.String,"change"),Bridge.fn.bind(this,function(n){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.UploadCsv(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()}));(i=System.Linq.Enumerable.from(t.Element.children,HTMLElement).firstOrDefault(null,null))!=null?i.appendChild(this._uploader.parentElement):null},AdvancedSearch:function(){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,f,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.OpenPopup(this.TabEditor,"AdvancedSearch",Bridge.fn.bind(this,function(){var n;return n=new Core.Components.AdvancedSearch(this.ParentListView),n.ParentListView=Bridge.as(this.Parent,Core.Components.ListView),n.ParentElement=this.TabEditor.Element,n})),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:f=t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(e){r=System.Exception.create(e);i.setException(r)}},arguments);return u(),i.task}))},ExportAllData:function(){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var r=0,u,a,f=new System.Threading.Tasks.TaskCompletionSource,e,n,v,o,s,h,t,y,i,c,p,l,w,b=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(Core.Extensions.Toast.Success("Đang xuất excel"),e=System.Linq.Enumerable.from(this.ParentListView.AdvSearchVM.OrderBy,Core.Models.OrderBy).select(Bridge.fn.bind(this,function(n){return System.String.format("[{0}].{1} {2}",this.ParentListView.GuiInfo.RefName,n.Field.FieldName,System.Nullable.toString(n.OrderbyOptionId,System.Enum.toStringFn(Core.Enums.OrderbyOption)).toLowerCase())})),n="",Core.Extensions.IEnumerableExtensions.HasElement(System.String,e)&&(n=Core.Extensions.IEnumerableExtensions.Combine(System.String,e)),Core.Extensions.StringExt.IsNullOrWhiteSpace(n)&&(n=Core.Extensions.OdataExt.GetClausePart(this.ParentListView.FormattedDataSource,Core.Extensions.OdataExt.OrderByKeyword),System.String.contains(n,",")?(v=(o=System.String,System.Linq.Enumerable.from(n.split(","),o).toList(o)),n=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(v,System.String).select(Bridge.fn.bind(this,function(n){return System.String.format("[{0}].{1}",this.ParentListView.GuiInfo.RefName,n)})))):n=System.String.format("[{0}].{1}",this.ParentListView.GuiInfo.RefName,n)),s=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).where(function(n){return!n.Group}).select(function(n){return n.FieldName})," and "),h=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).where(function(n){return n.Group}).select(function(n){return n.FieldName})," or "),t=new(System.Collections.Generic.List$1(System.String).ctor),Core.Extensions.StringExt.IsNullOrWhiteSpace(s)||t.add(System.String.format("({0})",[s])),Core.Extensions.StringExt.IsNullOrWhiteSpace(h)||t.add(System.String.format("({0})",[h])),y=System.Linq.Enumerable.from(t,System.String).any()?System.String.format("({0})",[Core.Extensions.IEnumerableExtensions.Combine(System.String,t," and ")]):"",i=this.ParentListView.GuiInfo.PreQuery,c={},i!=null&&Core.Extensions.Utils.IsFunction(i,c)&&(i=Bridge.toString(c.v.call(this,this,this.EditForm))),u=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName).GetAsync$1(System.String,(System.String.format("/ExportExcel?componentId={0}",[Bridge.box(this.ParentListView.GuiInfo.Id,System.Int32)])||"")+(System.String.format("&sql={0}",[this.ParentListView.Sql])||"")+(System.String.format("&showNull={0}",[Bridge.box((l=this.GuiInfo.ShowNull,l!=null?l:!1),System.Boolean,System.Boolean.toString)])||"")+(System.String.format("&where={0} {1}",y,Core.Extensions.StringExt.IsNullOrWhiteSpace(i)?"":System.String.format("{0} {1}",System.Linq.Enumerable.from(t,System.String).any()?" and ":"",i))||"")+(System.String.format("&custom=false&featureId={0}&orderby={1}",Bridge.box(this.EditForm.Feature.Id,System.Int32),n)||"")),r=1,u.isCompleted())continue;u["continue"](b);return;case 1:a=u.getAwaitedResult();p=a;Core.Clients.Client.Download(System.String.format("/excel/Download/{0}",[p]));Core.Extensions.Toast.Success("Xuất file thành công");f.setResult(null);return;default:f.setResult(null);return}}}catch(k){w=System.Exception.create(k);f.setException(w)}},arguments);return b(),f.task}))},ExportSelectedData:function(){var n=this.ParentListView.SelectedIds;if(Core.Extensions.IEnumerableExtensions.Nothing(System.Int32,n)){Core.Extensions.Toast.Warning("Vui lòng chọn dòng muốn xuất");return}System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var u=0,f,v,e=new System.Threading.Tasks.TaskCompletionSource,o,t,y,s,h,c,i,p,r,l,w,a,b,k=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1],u);switch(u){case 0:if(Core.Extensions.Toast.Success("Đang xuất excel"),o=System.Linq.Enumerable.from(this.ParentListView.AdvSearchVM.OrderBy,Core.Models.OrderBy).select(Bridge.fn.bind(this,function(n){return System.String.format("[{0}].{1} {2}",this.ParentListView.GuiInfo.RefName,n.Field.FieldName,System.Nullable.toString(n.OrderbyOptionId,System.Enum.toStringFn(Core.Enums.OrderbyOption)).toLowerCase())})),t="",Core.Extensions.IEnumerableExtensions.HasElement(System.String,o)&&(t=Core.Extensions.IEnumerableExtensions.Combine(System.String,o)),Core.Extensions.StringExt.IsNullOrWhiteSpace(t)&&(t=Core.Extensions.OdataExt.GetClausePart(this.ParentListView.FormattedDataSource,Core.Extensions.OdataExt.OrderByKeyword),System.String.contains(t,",")?(y=(s=System.String,System.Linq.Enumerable.from(t.split(","),s).toList(s)),t=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(y,System.String).select(Bridge.fn.bind(this,function(n){return System.String.format("[{0}].{1}",this.ParentListView.GuiInfo.RefName,n)})))):t=System.String.format("[{0}].{1}",this.ParentListView.GuiInfo.RefName,t)),h=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).where(function(n){return!n.Group}).select(function(n){return n.FieldName})," and "),c=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).where(function(n){return n.Group}).select(function(n){return n.FieldName})," or "),i=new(System.Collections.Generic.List$1(System.String).ctor),Core.Extensions.StringExt.IsNullOrWhiteSpace(h)||i.add(System.String.format("({0})",[h])),Core.Extensions.StringExt.IsNullOrWhiteSpace(c)||i.add(System.String.format("({0})",[c])),p=System.Linq.Enumerable.from(i,System.String).any()?System.String.format("({0})",[Core.Extensions.IEnumerableExtensions.Combine(System.String,i," and ")]):"",r=this.ParentListView.GuiInfo.PreQuery,l={},r!=null&&Core.Extensions.Utils.IsFunction(r,l)&&(r=Bridge.toString(l.v.call(this,this,this.EditForm))),f=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName).GetAsync$1(System.String,(System.String.format("/ExportExcel?componentId={0}",[Bridge.box(this.ParentListView.GuiInfo.Id,System.Int32)])||"")+(System.String.format("&sql={0}",[this.ParentListView.Sql])||"")+(System.String.format("&showNull={0}",[Bridge.box((a=this.GuiInfo.ShowNull,a!=null?a:!1),System.Boolean,System.Boolean.toString)])||"")+(System.String.format("&where={0} {1} {2}",p,Core.Extensions.StringExt.IsNullOrWhiteSpace(r)?"":System.String.format("{0} {1}",System.Linq.Enumerable.from(i,System.String).any()?" and ":"",r),System.String.format(" and [{0}].Id in ({1})",this.ParentListView.GuiInfo.RefName,Core.Extensions.IEnumerableExtensions.Combine(System.Int32,n)))||"")+(System.String.format("&custom=false&featureId={0}&orderby={1}",Bridge.box(this.EditForm.Feature.Id,System.Int32),t)||"")),u=1,f.isCompleted())continue;f["continue"](k);return;case 1:v=f.getAwaitedResult();w=v;Core.Clients.Client.Download(System.String.format("/excel/Download/{0}",[w]));Core.Extensions.Toast.Success("Xuất file thành công");e.setResult(null);return;default:e.setResult(null);return}}}catch(d){b=System.Exception.create(d);e.setException(b)}},arguments);return k(),e.task}))},ExportDisplay:function(){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.ExportData(!0),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},ExportData:function(n){var r=0,u,l,f,e=new System.Threading.Tasks.TaskCompletionSource,o,s,a,v,i,t,h,y,c=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1,2],r);switch(r){case 0:if(o=this.ParentListView.CalcFilterQuery(!1),s=this.ParentListView.Paginator.Options,n&&(o=(o||"")+(System.String.format("&$skip={0}&$top={1}",Bridge.box(Bridge.Int.mul(s.PageIndex,s.PageSize),System.Int32),Bridge.box(s.PageSize,System.Int32))||"")),Core.Components.Spinner.AppendTo(this.ParentElement,!0,!0,7e3),u=new Core.Clients.Client.$ctor1(this.GuiInfo.Reference.Name).GetList(System.Object,o),r=1,u.isCompleted())continue;u["continue"](c);return;case 1:if(l=u.getAwaitedResult(),a=l,v=System.Linq.Enumerable.from(this.ParentListView.Header,Core.Models.GridPolicy).where(function(n){return!Bridge.referenceEquals(n.ComponentType,"Button")}).select(function(n){var t=new Core.Models.GridPolicy;return Core.Extensions.ReflectionExt.CopyPropFrom$1(t,n),t.Editable=!1,Bridge.referenceEquals(n.ComponentType,"Checkbox")&&(t.SimpleText=!0),t.ComponentType="Label",t}).toList(Core.Models.GridPolicy),i=new Core.Models.Component,Core.Extensions.ReflectionExt.CopyPropFrom$1(i,this.ParentListView.GuiInfo),i.CanSearch=!1,i.LocalData=a.Value,i.LocalHeader=v,t=(h=new Core.Components.GridView(i),h.ParentElement=this.ParentListView.ParentElement,h),f=t.LoadMasterData(i.LocalData),r=2,f.isCompleted())continue;f["continue"](c);return;case 2:f.getAwaitedResult();this.ParentListView.Parent.AddChild(t);t.Element.style.display="none";t.DOMContentLoaded=Bridge.fn.combine(t.DOMContentLoaded,Bridge.fn.bind(this,function(){var n;Core.Extensions.IEnumerableExtensions.ForEach(Node,t.Element.querySelector("table").querySelectorAll("td"),function(n){n.style="border:1px solid;white-space: nowrap;font-family: 'times new roman', times, serif;"});Core.Extensions.IEnumerableExtensions.ForEach(Node,t.Element.querySelector("table").querySelectorAll("th"),function(n){n.style="border:1px solid;white-space: nowrap;font-family: 'times new roman', times, serif;"});Core.Extensions.ExcelExt.ExportTableToExcel(null,(n=this.GuiInfo.FieldName,n!=null?n:"Export"),Bridge.as(t.Element.querySelector("table"),HTMLElement));t.Dispose()}));e.setResult(null);return;default:e.setResult(null);return}}}catch(p){y=System.Exception.create(p);e.setException(y)}},arguments);return c(),e.task},OpenExcelFileDialog:function(){this._uploader.click()},CalcFilterQuery:function(n){var f,a,v,y,p,i,b,r,o,s,h,u,c,l,k;this.EntityVM.DateTimeField!=null&&(this.DateTimeField=System.Linq.Enumerable.from(this.ParentListView.Header,Core.Models.GridPolicy).firstOrDefault(Bridge.fn.bind(this,function(n){return System.Nullable.eq(n.Id,this.EntityVM.DateTimeField)}),null).FieldName);var e=this.ParentListView.Header,w=(f=(a=this.EntityVM.SearchTerm)!=null?Core.Extensions.Utils.EncodeSpecialChar(a.trim()):null,f!=null?f:""),t=Core.Components.Extensions.ComponentExt.FilterById(w,e);return(Core.Extensions.StringExt.IsNullOrEmpty(t)&&(e.ForEach(Bridge.fn.bind(this,function(n){n.FilterEq=this.GuiInfo.FilterEq})),b=System.Linq.Enumerable.from(e,Core.Models.GridPolicy).select(function(n){return Core.Components.Extensions.ComponentExt.MapToFilterOperator(n,w)}).where(function(n){return Core.Extensions.StringExt.HasAnyChar(n)}),t=Bridge.toArray(b).join(" or ")),r=(v=this.ParentListView.BasicHeader)!=null&&(y=System.Linq.Enumerable.from(v,Core.Models.GridPolicy).where(function(n){return n.AddDate}))!=null&&(p=y.select(function(n){return n.Id}))!=null?p.ToArray(System.Int32):null,o=r!=null&&System.Linq.Enumerable.from(r,System.Int32).any()&&System.Linq.Enumerable.from(this.ParentGridView.AdvSearchVM.Conditions,Core.Models.FieldCondition).any(function(n){return System.Array.contains(r,n.FieldId,System.Int32)&&!Core.Extensions.StringExt.IsNullOrWhiteSpace(n.Value)}),o||Bridge.equals(this.EntityVM.StartDate,null)?Bridge.equals(this.EntityVM.StartDate,null)&&(h=System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).firstOrDefault(Bridge.fn.bind(this,function(n){return System.String.contains(n.FieldName,System.String.format("[{0}].[{1}] >=",this.ParentListView.GuiInfo.RefName,this.DateTimeField))}),null),System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).any()&&h!=null&&this.ParentListView.Wheres.remove(h),Core.Clients.LocalStorage.RemoveItem("FromDate"+this.ParentListView.GuiInfo.Id)):(Core.Extensions.StringExt.HasAnyChar(t)&&(t=(t||"")+" and "),s=System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).firstOrDefault(Bridge.fn.bind(this,function(n){return System.String.contains(n.FieldName,System.String.format("[{0}].[{1}] >=",this.ParentListView.GuiInfo.RefName,this.DateTimeField))}),null),s==null?this.ParentListView.Wheres.add((i=new Core.Models.Where,i.FieldName=System.String.format("[{0}].[{1}] >= '{2}'",this.ParentListView.GuiInfo.RefName,this.DateTimeField,System.DateTime.format(System.Nullable.getValue(this.EntityVM.StartDate),"yyyy-MM-dd")),i.Group=!1,i)):s.FieldName=System.String.format("[{0}].[{1}] >= '{2}'",this.ParentListView.GuiInfo.RefName,this.DateTimeField,System.DateTime.format(System.Nullable.getValue(this.EntityVM.StartDate),"yyyy-MM-dd")),this.EntityVM.StartDate=System.DateTime.getDate(System.Nullable.getValue(this.EntityVM.StartDate)),t=(t||"")+(System.String.format("cast({0},Edm.DateTimeOffset) ge cast({1},Edm.DateTimeOffset)",this.DateTimeField,Core.Extensions.DateTimeExt.ToISOFormat(System.Nullable.getValue(this.EntityVM.StartDate)))||""),Core.Clients.LocalStorage.SetItem(System.String,"FromDate"+this.ParentListView.GuiInfo.Id,System.DateTime.format(System.Nullable.getValue(this.EntityVM.StartDate),"MM/dd/yyyy"))),o||Bridge.equals(this.EntityVM.EndDate,null)?Bridge.equals(this.EntityVM.EndDate,null)&&(l=System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).firstOrDefault(Bridge.fn.bind(this,function(n){return System.String.contains(n.FieldName,System.String.format("[{0}].[{1}] <",this.ParentListView.GuiInfo.RefName,this.DateTimeField))}),null),System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).any()&&l!=null&&this.ParentListView.Wheres.remove(l),Core.Clients.LocalStorage.RemoveItem("ToDate"+this.ParentListView.GuiInfo.Id)):(Core.Extensions.StringExt.HasAnyChar(t)&&(t=(t||"")+" and "),u=System.DateTime.addDays(System.DateTime.getDate(System.Nullable.getValue(this.EntityVM.EndDate)),1),c=System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).firstOrDefault(Bridge.fn.bind(this,function(n){return System.String.contains(n.FieldName,System.String.format("[{0}].[{1}] <",this.ParentListView.GuiInfo.RefName,this.DateTimeField))}),null),c==null?this.ParentListView.Wheres.add((i=new Core.Models.Where,i.FieldName=System.String.format("[{0}].[{1}] < '{2}'",this.ParentListView.GuiInfo.RefName,this.DateTimeField,System.DateTime.format(u,"yyyy-MM-dd")),i.Group=!1,i)):c.FieldName=System.String.format("[{0}].[{1}] < '{2}'",this.ParentListView.GuiInfo.RefName,this.DateTimeField,System.DateTime.format(u,"yyyy-MM-dd")),t=(t||"")+(System.String.format("cast({0},Edm.DateTimeOffset) lt cast({1},Edm.DateTimeOffset)",this.DateTimeField,Core.Extensions.DateTimeExt.ToISOFormat(u))||""),Core.Clients.LocalStorage.SetItem(System.String,"ToDate"+this.ParentListView.GuiInfo.Id,System.DateTime.format(System.Nullable.getValue(this.EntityVM.EndDate),"MM/dd/yyyy"))),Bridge.equals(this.EntityVM.EndDate,null)&&Bridge.equals(this.EntityVM.StartDate,null)||this.ParentListView.GuiInfo.ShowNull==null||!System.Nullable.getValue(this.ParentListView.GuiInfo.ShowNull)||(t=(t||"")+(System.String.format(" or {0} eq null",[this.DateTimeField])||"")),Core.Extensions.StringExt.IsNullOrWhiteSpace(t))?this.ApplyOrder(n):(k=Core.Extensions.OdataExt.GetClausePart(n,Core.Extensions.OdataExt.FilterKeyword),t=Core.Extensions.OdataExt.AppendClause(n,Core.Extensions.StringExt.IsNullOrWhiteSpace(k)?t:System.String.format(" and ({0})",[t])),this.ApplyOrder(t))},ApplyOrder:function(n){var t=System.Linq.Enumerable.from(this.ParentListView.AdvSearchVM.OrderBy,Core.Models.OrderBy).select(function(n){return System.String.format("{0} {1}",n.Field.FieldName,System.Nullable.toString(n.OrderbyOptionId,System.Enum.toStringFn(Core.Enums.OrderbyOption)).toLowerCase())});return Core.Extensions.IEnumerableExtensions.HasElement(System.String,t)&&(n=Core.Extensions.OdataExt.ApplyClause(n,Core.Extensions.IEnumerableExtensions.Combine(System.String,t),Core.Extensions.OdataExt.OrderByKeyword)),n},RefershListView:function(){var i=0,r,t=new System.Threading.Tasks.TaskCompletionSource,n,u,f=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(this.EntityVM.SearchTerm="",this.EntityVM.StartDate=null,this.EntityVM.EndDate=null,this.UpdateView(),!((n=Bridge.as(this.Parent,Core.Components.ListView))!=null)){t.setResult(null);return}if(n.DataSourceFilter=n.GuiInfo.DataSourceFilter,n.ClearSelected(),n.CellSelected.clear(),n.AdvSearchVM.Conditions.clear(),n.Wheres.clear(),r=n.ApplyFilter(),i=1,r.isCompleted())continue;r["continue"](f);return;case 1:r.getAwaitedResult();t.setResult(null);return;default:t.setResult(null);return}}}catch(e){u=System.Exception.create(e);t.setException(u)}},arguments);return f(),t.task}}});Bridge.define("Core.Components.SearchEntry",{inherits:[Core.Components.EditableComponent],statics:{fields:{SEntryClass:null},ctors:{init:function(){this.SEntryClass="search-entry"}}},fields:{_value:null,_input:null,_gv:null,_waitForInput:0,_waitForDispose:0,_findMatchTextAwaiter:0,_contextMenu:!1,RowData:null,dataSourceFilter:null,_rootResult:null,_parentInput:null,_backdrop:null,_isRendering:!1},props:{IdFieldName:null,Value:{get:function(){return this._value},set:function(n){var t;System.Nullable.neq(this._value,n)&&(this.Dirty=!0);this._value=n;(t=this.Entity)!=null?Core.Extensions.BridgeExt.SetComplexPropValue(t,this.GuiInfo.FieldName,Bridge.box(n,System.Int32,System.Nullable.toString,System.Nullable.getHashCode)):null;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(this._value=n,i=this.FindMatchTextAsync(),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task}))}},Text:{get:function(){return this._input.value},set:function(n){this._input.value=n}},SearchResultEle:null,DataSourceFilter:{get:function(){return this.dataSourceFilter},set:function(n){this.dataSourceFilter=Core.Extensions.Utils.DecodeSpecialChar(n)}},Matched:null,FormattedDataSource:{get:function(){var t={};if(Core.Extensions.Utils.IsFunction(this.DataSourceFilter,t))return Bridge.toString(t.v.call(this,this,this.EditForm));var n=Core.Extensions.StringExt.HasAnyChar(this.DataSourceFilter)?this.DataSourceFilter:"",i=System.String.contains(n,"EditForm.")||System.String.contains(n,"TabEditor.")||System.String.contains(n,"Entity.");return Core.Extensions.Utils.FormatEntity(n,null,i?this:this.Entity,void 0,function(){return"null"})}}},ctors:{ctor:function(n,t){t===void 0&&(t=null);var i;this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.DataSourceFilter=n.DataSourceFilter;this.DeserializeLocalData(n);this.GuiInfo.ComponentGroup=null;this.GuiInfo.Row=(i=this.GuiInfo.Row,i!=null?i:20);this.RowData=new(Core.MVVM.ObservableList$1(System.Object).ctor);this.Element=t;this.IdFieldName=this.GuiInfo.FieldName}},methods:{DeserializeLocalData:function(n){Core.Extensions.StringExt.IsNullOrEmpty(n.Query)||(this.GuiInfo.LocalData=Newtonsoft.Json.JsonConvert.DeserializeObject(n.Query,System.Collections.Generic.List$1(System.Object)),this.GuiInfo.LocalRender=!0)},Render:function(){var t,n,i;this.SetDefaultVal();n=Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.IdFieldName);this._value=(i=Bridge.as(n,System.String))!=null?Core.Extensions.Utils.TryParseInt(i):Bridge.as(n,System.Int32,!0);this.RenderInputAndEvents();this.RenderIcons();this.FindMatchText();this.SearchResultEle=((t=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListView,this))!=null?t.Element:null)||document.body},RenderInputAndEvents:function(){if(this.Element==null)this.Element=this._input=Bridge.as(Core.Components.Renderer.ClassName(Core.Components.Renderer.Position$1(Core.MVVM.Html.Take(this.ParentElement).Div,Core.Components.Position.relative),Core.Components.SearchEntry.SEntryClass).Input.GetContext(),HTMLInputElement),this._parentInput=this._input.parentElement;else if(this._input=Bridge.as(this.Element,HTMLInputElement),!Core.Extensions.HtmlElementExtension.HasClass(this._input.parentElement,Core.Components.SearchEntry.SEntryClass)){var n=document.createElement(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.div));Core.Extensions.HtmlElementExtension.AddClass(n,Core.Components.SearchEntry.SEntryClass);this._input.parentElement.appendChild(n);this._input.parentElement.insertBefore(n,this._input)}this._input.autocomplete="off";Core.Components.Renderer.PlaceHolder(Core.MVVM.Html.Take(this._input),this.GuiInfo.PlainText).Attr$1("name",this.IdFieldName).Event("contextmenu",Bridge.fn.bind(this,function(){this._contextMenu=!0})).Event("focus",Bridge.fn.cacheBind(this,this.FocusIn)).Event$1("blur",Bridge.fn.cacheBind(this,this.DiposeGvWrapper)).AsyncEvent("click",Bridge.fn.cacheBind(this,this.SEClickOpenRef)).Event("change",Bridge.fn.cacheBind(this,this.SEChangeHandler)).Event$1("keydown",Bridge.fn.cacheBind(this,this.SEKeydownHanlder)).Event("input",Bridge.fn.bind(this,function(){this.Search(this._input.value,!0,500,!0)}))},SEClickOpenRef:function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3],n);switch(n){case 0:if(this.Disabled&&!this.GuiInfo.FocusSearch){n=1;continue}n=3;continue;case 1:if(t=this.OpenRefDetail(),n=2,t.isCompleted())continue;t["continue"](u);return;case 2:t.getAwaitedResult();n=3;continue;case 3:i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task},SEChangeHandler:function(){this._value==null&&(this._input.value="")},SEKeydownHanlder:function(n){if(!this.Disabled&&n!=null){var t=Core.Extensions.EventExt.KeyCodeEnum(n);do{if(System.Nullable.eq(t,Core.Enums.KeyCodeEnum.Escape)&&this._gv!=null){n.stopPropagation();this._gv.Show=!1;break}if(System.Nullable.eq(t,Core.Enums.KeyCodeEnum.UpArrow)&&(this._gv!=null?this._gv.Element:null)!=null){this._gv.Show&&(n.stopPropagation(),this._gv.MoveUp());break}if(System.Nullable.eq(t,Core.Enums.KeyCodeEnum.DownArrow)&&(this._gv!=null?this._gv.Element:null)!=null){this._gv.Show&&(n.stopPropagation(),this._gv.MoveDown());break}if(System.Nullable.eq(t,Core.Enums.KeyCodeEnum.Enter)){this.EnterKeydownHandler(t);break}if(System.Nullable.eq(t,Core.Enums.KeyCodeEnum.F6)){this._gv!=null&&this._gv.Show&&(n.preventDefault(),this._gv.HotKeyF6Handler(n,Core.Enums.KeyCodeEnum.F6));break}Core.Extensions.EventExt.ShiftKey(n)&&System.Nullable.eq(t,Core.Enums.KeyCodeEnum.Delete)&&(this._input.value=null,this.Search());break}while(0)}},EnterKeydownHandler:function(n){this._gv!=null&&this._gv.Show?this.EnterKeydownTableStillShow(n):this.Search(void 0,!0,0,!1)},EnterKeydownTableStillShow:function(n){var t;this._gv.SelectedIndex>=0?this.EntrySelected(this._gv!=null&&(t=this._gv.RowData)!=null?t.Data.getItem(this._gv.SelectedIndex):null):(this._gv!=null?this._gv.RowData:null)!=null&&this._gv.RowData.Data.Count===1&&System.Nullable.eq(n,Core.Enums.KeyCodeEnum.Enter)&&this.EntrySelected(this._gv!=null?this._gv.RowData.Data.getItem(0):null)},FocusIn:function(){if(Core.Extensions.HtmlElementExtension.AddClass(this.ParentElement,"cell-selected"),this._contextMenu){this._contextMenu=!1;return}this.Disabled||this.GuiInfo.FocusSearch||this.Search(void 0,!1,0,!1)},FocusOut:function(){Core.Extensions.HtmlElementExtension.RemoveClass(this.ParentElement,"cell-selected")},Dispose:function(){this.DisposeGv();Core.Components.EditableComponent.prototype.Dispose.call(this)},DiposeGvWrapper:function(n){(n===void 0&&(n=null),n!=null&&n.shiftKey!=null&&Core.Extensions.EventExt.ShiftKey(n))||(window.clearTimeout(this._waitForDispose),this._waitForDispose=window.setTimeout(Bridge.fn.cacheBind(this,this.DisposeGv),300))},DisposeGv:function(){this.DisposeMobileSearchResult();this._gv!=null&&(this._gv.Show=!1);this._parentInput.appendChild(this._input)},RenderIcons:function(){var t=Core.Components.LangSelect.Get("Tạo mới dữ liệu "),n;Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element.parentElement).Div,"search-icons");n=Core.Components.Renderer.Title(Core.Components.Renderer.Icon(Core.Components.Renderer.Title(Core.Components.Renderer.Icon(Core.MVVM.Html.Instance,"fa fa-info-circle"),(Core.Components.LangSelect.Get("Thông tin chi tiết ")||"")+(Core.Components.LangSelect.Get(this.GuiInfo.Label).toLowerCase()||"")).AsyncEvent("click",Bridge.fn.cacheBind(this,this.OpenRefDetail)).End,"fa fa-plus"),System.String.format("{0} {1}",t,Core.Components.LangSelect.Get(this.GuiInfo.Label).toLowerCase())).AsyncEvent("click",Bridge.fn.cacheBind(this,this.CreateNewRef)).End.GetContext();this.Element.nextElementSibling!=null?this.Element.parentElement.insertBefore(n,this.Element.nextElementSibling):this.Element.parentElement.appendChild(n)},OpenRefDetail:function(){var t=0,r,h,u,c,f,n=new System.Threading.Tasks.TaskCompletionSource,o,s,l,i,a,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3],t);switch(t){case 0:if(Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.RefClass)||this.Matched==null){n.setResult(null);return}if(r=Core.Components.Extensions.ComponentExt.LoadFeatureByNameOrViewClass(this.GuiInfo.RefClass),t=1,r.isCompleted())continue;r["continue"](e);return;case 1:if(h=r.getAwaitedResult(),o=h,o==null){n.setResult(null);return}if(s=Bridge.Reflection.getType(this.GuiInfo.RefClass),s==null){n.setResult(null);return}if(u=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName,this.GuiInfo.Reference!=null?this.GuiInfo.Reference.Namespace:null).GetRawAsync(System.Nullable.getValue(this.Value)),t=2,u.isCompleted())continue;u["continue"](e);return;case 2:if(c=u.getAwaitedResult(),l=c,i=Bridge.as(Bridge.createInstance(s),Core.Components.Forms.TabEditor),i.Id=o.Name,i.Entity=l,i.ParentForm=this.TabEditor,i.ParentElement=this.TabEditor.Element,this.TabEditor.AddChild(i),f=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterCreated,[this.TabEditor]),t=3,f.isCompleted())continue;f["continue"](e);return;case 3:f.getAwaitedResult();n.setResult(null);return;default:n.setResult(null);return}}}catch(v){a=System.Exception.create(v);n.setException(a)}},arguments);return e(),n.task},CreateNewRef:function(){var i=0,r,e,t=new System.Threading.Tasks.TaskCompletionSource,o,n,u,f,s,h,c=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.RefClass)){t.setResult(null);return}if(r=Core.Components.Extensions.ComponentExt.LoadFeatureByNameOrViewClass(this.GuiInfo.RefClass),i=1,r.isCompleted())continue;r["continue"](c);return;case 1:e=r.getAwaitedResult();o=e;n=Bridge.as(Bridge.createInstance(Bridge.Reflection.getType(this.GuiInfo.RefClass)),Core.Components.Forms.TabEditor);n.Id=o.Name;n.ParentForm=this.TabEditor;n.ParentElement=this.TabEditor.Element;this.TabEditor.AddChild(n);Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.Template)||(f={},u=Core.Extensions.Utils.IsFunction(this.GuiInfo.Template,f)?Bridge.toString(f.v.call(this,Bridge.unbox(this.Matched),Bridge.unbox(this.Entity))):Core.Extensions.Utils.FormatEntity(this.GuiInfo.Template,null,this.Matched,Core.Extensions.Utils.EmptyFormat,Core.Extensions.Utils.EmptyFormat),s=Newtonsoft.Json.JsonConvert.DeserializeObject(u,System.Object),n.Entity=s);n.DOMContentLoaded=Bridge.fn.combine(n.DOMContentLoaded,Bridge.fn.bind(this,function(){var i=Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section,n,"Button"),t=document.createElement(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),r=Bridge.as(i.Element.querySelector(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.tr)),HTMLElement);Core.Extensions.HtmlElementExtension.Prepend(r,t);Core.Components.Renderer.IText(Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(t).Button,"btn btn-secondary"),"fal fa-file-check").End,"Áp dụng").Event("click",Bridge.fn.bind(this,function(){var t=0,i,e,r,o,u,f=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1,2,3,4],t);switch(t){case 0:if(i=n.IsFormValid(),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:if(e=i.getAwaitedResult(),!e){t=2;continue}t=3;continue;case 2:return;case 3:if(Core.Extensions.ReflectionExt.ClearReferences(n.Entity),r=n.AddOrUpdate(n.Entity),t=4,r.isCompleted())continue;r["continue"](f);return;case 4:o=r.getAwaitedResult();u=o;u!=null&&(this.SaveAndApply(u),n.Dispose());return;default:return}}},arguments);f()})).End.Render()}));t.setResult(null);return;default:t.setResult(null);return}}}catch(l){h=System.Exception.create(l);t.setException(h)}},arguments);return c(),t.task},SaveAndApply:function(n){var t,i=Bridge.as(this.Parent,Core.Components.ListViewItem),r=this.Value;if(this.Value=Bridge.unbox(n[Core.Components.EditableComponent.IdField]),this.Dirty=!0,this.Matched=n,i==null){this.Value=Bridge.unbox(n[Core.Components.EditableComponent.IdField]);this.Dirty=!0;Bridge.staticEquals(this.UserInput,null)||(this.CascadeAndPopulate(),Bridge.staticEquals(this.UserInput,null)||this.UserInput((t=new Core.MVVM.ObservableArgs,t.NewData=Bridge.box(this._value,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),t.OldData=Bridge.box(r,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),t.EvType="change",t)));return}Bridge.staticEquals(this.UserInput,null)||(this.CascadeAndPopulate(),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity,i.Entity,this.Matched]),n=1,t.isCompleted())continue;t["continue"](f);return;case 1:t.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task})),Bridge.staticEquals(this.UserInput,null)||this.UserInput((t=new Core.MVVM.ObservableArgs,t.NewData=Bridge.box(this._value,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),t.OldData=Bridge.box(r,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),t.EvType="change",t)))},Search:function(n,t,i,r){n===void 0&&(n=null);t===void 0&&(t=!0);i===void 0&&(i=500);r===void 0&&(r=!1);window.clearTimeout(this._waitForInput);this._waitForInput=window.setTimeout(Bridge.fn.bind(this,function(){if(this._gv!=null&&(this._gv.Wheres.clear(),this._gv.AdvSearchVM.Conditions.clear(),this._gv.CellSelected.clear()),t&&Core.Extensions.StringExt.IsNullOrEmpty(this._input.value)){this.InputEmptyHandler(r);return}this.TriggerSearch(n)}),i)},TriggerSearch:function(n){n===void 0&&(n=null);this.RenderGridView(Core.Extensions.Utils.DecodeSpecialChar(n))},RenderGridView:function(n){var t,i,r;if(n===void 0&&(n=null),!this._isRendering){if(this._isRendering=!0,this._gv!=null){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(this.RenderRootResult(),this._gv.ParentElement=this._rootResult,this._gv.Entity=this.Entity,this._gv.ListViewSearch.EntityVM.SearchTerm=n,this._gv.ClearRowData(),i=this._gv.ActionFilter(),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();this.GridResultDomLoaded();this._isRendering=!1;r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task}));return}this._gv=Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.GroupBy)?new Core.Components.GridView(this.GuiInfo):new Core.Components.GroupGridView(this.GuiInfo);this._gv.FeatureId="null";this.RenderRootResult();this.ParentElement=this._rootResult;this._gv.EditForm=this.EditForm;this._gv.GuiInfo=this.GuiInfo;this._gv.ParentElement=this._rootResult;this._gv.Entity=this.Entity;this._gv.Parent=this;this._gv.AlwaysValid=!0;this._gv.PopulateDirty=!1;this._gv.ShouldSetEntity=!1;this._gv.DOMContentLoaded=Bridge.fn.cacheBind(this,this.GridResultDomLoaded);this._gv.AddSections();this._gv.Show=!1;this._gv.ListViewSearch.EntityVM.SearchTerm=n;this._gv.Render();Core.Extensions.HtmlElementExtension.AddClass(this._gv.Element,"floating");this._gv.RowClick=Bridge.fn.cacheBind(this,this.EntrySelected);this._isRendering=!1;((t=this._gv.Paginator)!=null?t.Element:null)!=null&&(this._gv.Paginator.Element.tabIndex=-1,this._gv.Paginator.Element.addEventListener("focusin",Bridge.fn.bind(this,function(){window.clearTimeout(this._waitForDispose)})),this._gv.Paginator.Element.addEventListener("focusout",Bridge.fn.cacheBind(this,this.DiposeGvWrapper)));((i=this._gv.MainSection)!=null?i.Element:null)!=null&&(this._gv.MainSection.Element.tabIndex=-1,this._gv.MainSection.Element.addEventListener("focusin",Bridge.fn.bind(this,function(){window.clearTimeout(this._waitForDispose)})),this._gv.MainSection.Element.addEventListener("focusout",Bridge.fn.cacheBind(this,this.DiposeGvWrapper)));((r=this._gv.HeaderSection)!=null?r.Element:null)!=null&&(this._gv.HeaderSection.Element.tabIndex=-1,this._gv.HeaderSection.Element.addEventListener("focusin",Bridge.fn.bind(this,function(){window.clearTimeout(this._waitForDispose)})),this._gv.HeaderSection.Element.addEventListener("focusout",Bridge.fn.cacheBind(this,this.DiposeGvWrapper)));this.GuiInfo.LocalHeader==null&&(this.GuiInfo.LocalHeader=new(System.Collections.Generic.List$1(Core.Models.GridPolicy).$ctor1)(System.Linq.Enumerable.from(this._gv.Header,Core.Models.GridPolicy).where(function(n){return n.Id>0})))}},RenderRootResult:function(){this._rootResult==null&&(Core.Components.EditableComponent.IsSmallUp||this._backdrop!=null?Core.Components.EditableComponent.IsSmallUp&&(this._rootResult=document.createElement(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.div)),Core.Extensions.HtmlElementExtension.AddClass(this._rootResult,"result-wrapper"),this.SearchResultEle.appendChild(this._rootResult)):(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(Core.Components.Forms.TabEditor.TabContainer).Div,"backdrop"),this._backdrop=Core.MVVM.Html.Context,Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.IconForSpan(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"popup-content").Style$1("top: 0;width: 100%;").Div,"popup-title").Span,"fa fal fa-search").End.Span,"Search").End.Div,"icon-box").Span,"fa fa-times").Event("click",Bridge.fn.cacheBind(this,this.DisposeMobileSearchResult)).End.End.End.Div,"popup-body scroll-content"),this._rootResult=Core.MVVM.Html.Context,this._rootResult.appendChild(this._input)))},DisposeMobileSearchResult:function(){this._parentInput.appendChild(this._input);this._backdrop!=null?this._backdrop.remove():null;this._backdrop=null;this._rootResult!=null?this._rootResult.remove():null;this._rootResult=null},GridResultDomLoaded:function(){this.FocusBackWithoutEvent();this._gv.SelectedIndex=-1;this._gv.RowAction(function(n){n.Selected=!1});this._gv.Element.style.inset=null;this.RenderRootResult();this._rootResult.appendChild(this._gv.Element);this._gv.Show=!0;Core.Components.EditableComponent.IsSmallUp?Core.Components.Extensions.ComponentExt.AlterPosition(this._gv.Element,this._input):(this._gv.Element.style.maxWidth="100%",this._gv.Element.style.minWidth="calc(100% - 2rem)");this.FocusBackWithoutEvent()},FocusBackWithoutEvent:function(){window.clearTimeout(this._waitForDispose);window.clearTimeout(this._waitForInput);this.GuiInfo.IsPivot||this._input.focus()},InputEmptyHandler:function(n){var i,t,u=this._value,r=this.Matched;(this.Matched=null,this._value=null,this._input.value="",Bridge.referenceEquals(r,this.Matched)||((i=this.Entity)!=null?Core.Extensions.BridgeExt.SetComplexPropValue(i,this.GuiInfo.FieldName,null):null,this.Dirty=!0,this.CascadeAndPopulate(),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity,this.Matched,r]),n=1,t.isCompleted())continue;t["continue"](f);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(e){u=System.Exception.create(e);i.setException(u)}},arguments);return f(),i.task})),Bridge.staticEquals(this.UserInput,null)||this.UserInput((t=new Core.MVVM.ObservableArgs,t.NewData=null,t.OldData=Bridge.box(u,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),t.EvType="change",t))),n&&Core.Extensions.StringExt.IsNullOrEmpty(this._input.value))||this.TriggerSearch(null)},FindMatchText:function(n){if(n===void 0&&(n=0),n===0){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.FindMatchTextAsync(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}));return}window.clearTimeout(this._findMatchTextAwaiter);this._findMatchTextAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.FindMatchTextAsync(),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()}),n)},FindMatchTextAsync:function(n){var t=0,f,h,e,c,o,l,i=new System.Threading.Tasks.TaskCompletionSource,a,r,v,u,y,s=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4,5,6,7,8,9,10,12],t);switch(t){case 0:if(n===void 0&&(n=!1),this.EmptyRow||!n&&this.ProcessLocalMatch()){i.setResult(null);return}if(r=null,Bridge.referenceEquals((v=this.GuiInfo.DefaultVal)!=null?v.trim():null,Bridge.toString(0))&&this.Value==null&&Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField])<=0){t=1;continue}else{t=3;continue}case 1:if(a=(this.FormattedDataSource||"")+"&$top=1",f=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName).GetList(System.Object,a),t=2,f.isCompleted())continue;f["continue"](s);return;case 2:h=f.getAwaitedResult();r=h;t=12;continue;case 3:if(System.Nullable.hasValue(this.Value)){t=4;continue}else{t=10;continue}case 4:if(u=this.FormattedDataSource,System.String.startsWith(u,"/")){t=5;continue}else{t=7;continue}case 5:if(u=Core.Extensions.OdataExt.ApplyClause(u,System.String.format("Id in ({0})",[Bridge.box(this.Value,System.Int32,System.Nullable.toString,System.Nullable.getHashCode)])),e=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName).GetList(System.Object,(u||"")+"&$top=1"),t=6,e.isCompleted())continue;e["continue"](s);return;case 6:c=e.getAwaitedResult();r=c;t=9;continue;case 7:if(o=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName).LoadById(System.Nullable.toString(this.Value,null)),t=8,o.isCompleted())continue;o["continue"](s);return;case 8:l=o.getAwaitedResult();r=l;t=9;continue;case 9:t=11;continue;case 10:if(this.Value==null){this.Matched=null;this._input.value=null;i.setResult(null);return}t=11;continue;case 12:if(r==null||r.Value==null){i.setResult(null);return}this.Matched=System.Linq.Enumerable.from(r.Value,System.Object).firstOrDefault(Bridge.fn.bind(this,function(n){return System.Nullable.eq(System.Nullable.getValue(Bridge.cast(Bridge.unbox(n[Core.Components.EditableComponent.IdField],System.Int32),System.Int32)),this._value)}),null);this.SetMatchedValue();i.setResult(null);return;default:i.setResult(null);return}}}catch(p){y=System.Exception.create(p);i.setException(y)}},arguments);return s(),i.task},ProcessLocalMatch:function(){var n=this._gv!=null&&Core.Extensions.IEnumerableExtensions.HasElement(System.Object,this.RowData.Data)||this.GuiInfo.LocalData!=null;return(n&&(this.Matched=Core.Extensions.IEnumerableExtensions.HasElement(System.Object,this.GuiInfo.LocalData)?System.Linq.Enumerable.from(this.GuiInfo.LocalData,System.Object).firstOrDefault(Bridge.fn.bind(this,function(n){return System.Nullable.eq(System.Nullable.getValue(Bridge.cast(Bridge.unbox(n[Core.Components.EditableComponent.IdField],System.Int32),System.Int32)),this._value)}),null):System.Linq.Enumerable.from(this.RowData.Data,System.Object).firstOrDefault(Bridge.fn.bind(this,function(n){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(n[Core.Components.EditableComponent.IdField],System.Int32),System.Int32))===System.Nullable.getValue(this.Value)}),null)),n||this.Matched!=null&&System.Nullable.eq(Bridge.cast(Bridge.unbox(this.Matched[Core.Components.EditableComponent.IdField],System.Int32),System.Int32,!0),this.Value)||this.Matched==null&&(this.Value==null||System.Nullable.eq(this.Value,0)))?(this.SetMatchedValue(),!0):!1},CascadeAndPopulate:function(){this.CascadeField();this.PopulateFields(this.Matched)},SetMatchedValue:function(){this._input.value=this.EmptyRow?"":this.GetMatchedText(this.Matched);this.GuiInfo.AutoFit&&Core.Components.Extensions.ComponentExt.SetAutoWidth(this,this._input.value,Core.Extensions.HtmlElementExtension.GetComputedStyle(this._input).font,48);this.UpdateValue()},UpdateValue:function(){var n;this.Dirty||(this.OriginalText=this._input.value,Bridge.staticEquals(n=this.DOMContentLoaded,null)?null:n(),this.OldValue=System.Nullable.toString(this._value,null))},GetMatchedText:function(n){var t,i;return n==null?"":(Core.Extensions.StringExt.HasNonSpaceChar(this.GuiInfo.FormatEntity)?(i={},t=Core.Extensions.Utils.IsFunction(this.GuiInfo.FormatEntity,i)?Bridge.toString(i.v.call(this,Bridge.unbox(n),Bridge.unbox(this.Entity),this.Element)):Core.Extensions.Utils.FormatEntity(this.GuiInfo.FormatEntity,null,n,Core.Extensions.Utils.EmptyFormat,Core.Extensions.Utils.EmptyFormat)):t=n!=null?Core.Extensions.Utils.FormatEntity(this.GuiInfo.FormatData,null,n,Core.Extensions.Utils.EmptyFormat,Core.Extensions.Utils.EmptyFormat):"",Core.Extensions.Utils.DecodeSpecialChar(t))},EntrySelected:function(n){var t,i,r;(window.clearTimeout(this._waitForDispose),this.EmptyRow=!1,n==null||this.Disabled)||(i=this.Matched,this.Matched=n,r=this._value,this._value=System.Nullable.getValue(Bridge.cast(Bridge.unbox(n[Core.Components.EditableComponent.IdField],System.Int32),System.Int32)),this.Entity!=null&&Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FieldName)&&(Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,Bridge.box(this._value,System.Int32,System.Nullable.toString,System.Nullable.getHashCode)),Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName.substr(0,this.GuiInfo.FieldName.length-2|0),n)),this.Dirty=!0,this.Matched=n,this.SetMatchedValue(),this._gv!=null&&(this._gv.Show=!1),this.CascadeAndPopulate(),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,r,u=new System.Threading.Tasks.TaskCompletionSource,f,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(r=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity,n,i]),t=1,r.isCompleted())continue;r["continue"](e);return;case 1:r.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(o){f=System.Exception.create(o);u.setException(f)}},arguments);return e(),u.task})),Bridge.staticEquals(this.UserInput,null)||this.UserInput((t=new Core.MVVM.ObservableArgs,t.NewData=Bridge.box(this._value,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),t.OldData=Bridge.box(r,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),t.EvType="change",t)),this.DiposeGvWrapper())},UpdateView:function(n,t,i){var f,r,u;if(n===void 0&&(n=!1),t===void 0&&(t=null),i===void 0&&(i=[]),r=null,u=(f=this.Entity)!=null?Core.Extensions.Utils.GetComplexPropValue(f,this.GuiInfo.FieldName):null,u!=null?Core.Extensions.ReflectionExt.IsNumber(Bridge.getType(u))&&(r=System.Convert.toInt32(u)):r=null,this._value=r,r==null){this.Matched=null;this._input.value=null;this.UpdateValue();return}System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.FindMatchTextAsync(n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task}))},ValidateAsync:function(){var t=0,n=new System.Threading.Tasks.TaskCompletionSource,i,r=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0],t);switch(t){case 0:if(Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule),this.ValidationRules)){n.setResult(!0);return}this.ValidationResult.clear();this.ValidateRequired(System.Nullable$1(System.Int32),this._value);this.Validate(System.Nullable$1(System.Int64),System.Nullable$1(System.Int64),Core.Extensions.ValidationRule.Equal,System.Int64.lift(this._value),function(n,t){return System.Nullable.lifteq("equals",n,t)});this.Validate(System.Nullable$1(System.Int64),System.Nullable$1(System.Int64),Core.Extensions.ValidationRule.NotEqual,System.Int64.lift(this._value),function(n,t){return System.Nullable.liftne("ne",n,t)});n.setResult(this.IsValid);return;default:n.setResult(null);return}}}catch(r){i=System.Exception.create(r);n.setException(i)}},arguments);return r(),n.task},SetDisableUI:function(n){this._input!=null&&(this._input.readOnly=n)},RemoveDOM:function(){this._input!=null&&this._input.parentElement!=null&&this._input.parentElement.remove()}}});Bridge.define("Core.Components.Number",{inherits:[Core.Components.EditableComponent],statics:{fields:{_decimalSeparator:0},ctors:{init:function(){this._decimalSeparator=46}}},fields:{_input:null,_value:null,_nullable:!1,_isString:!1},props:{SetSeclection:!1,Value:{get:function(){return this._value},set:function(n){var t,o=this._value,i,e,r,u,f;this._value=n;System.Nullable.liftne("ne",this._value,System.Decimal.lift(null))?(this._value=System.Convert.toDecimal(this._value),i=System.Convert.toInt32(Bridge.box((t=this.GuiInfo.Precision,t!=null?t:0),System.Int32)),this._value=System.Decimal.toDecimalPlaces(System.Nullable.getValue(this._value),i,7),e=System.Linq.Enumerable.from(this._input.value,System.Char).where(function(n){return n===44}).count(),r=this._input.selectionEnd,this._input.value=this.EmptyRow?"":System.String.format("{0:n"+i+"}",[this._value]),u=System.Linq.Enumerable.from(this._input.value,System.Char).where(function(n){return n===44}).count()-e|0,this.SetSeclection&&(this._input.selectionStart=r+u|0,this._input.selectionEnd=r+u|0)):this._nullable?this._input.value=null:(this._value=System.Decimal(0),this._input.value=this._value.toString());System.Nullable.liftne("ne",o,this._value)&&(this.Dirty=!0);Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this._value);this.PopulateFields();Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.ChildStyle)||(f={},Core.Extensions.Utils.IsFunction(this.GuiInfo.ChildStyle,f)&&Bridge.toString(f.v.call(this,Bridge.unbox(this.Entity),this._input)))}}},ctors:{init:function(){this.SetSeclection=!0},ctor:function(n,t){t===void 0&&(t=null);this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this._input=Bridge.as(t,HTMLInputElement)}},methods:{Render:function(){var n,t;this.SetDefaultVal();this.Entity!=null&&(t=Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName),this._isString=Bridge.is(t,System.String),this._nullable=this.IsNullable(System.Int32)||this.IsNullable(System.Int64)||this.IsNullable(System.Decimal),this._value=this.GetDecimalValue(),Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this._value));this._input==null?(Core.MVVM.Html.Take(this.ParentElement).Input.Render(),this.Element=this._input=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement)):this.Element=this._input;this._input.type="tel";this._input.setAttribute("autocorrect","off");this._input.setAttribute("spellcheck","false");this._input.addEventListener("input",Bridge.fn.cacheBind(this,this.SetValue));this._input.addEventListener("keydown",Bridge.fn.bind(this,function(n){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.KeyDownNumber(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()}));this._input.addEventListener("change",Bridge.fn.cacheBind(this,this.ChangeSetValue));this._input.autocomplete="off";this.Value=this._value;this.GuiInfo.AutoFit&&Core.Components.Extensions.ComponentExt.SetAutoWidth(this,this._input.value,Core.Extensions.HtmlElementExtension.GetComputedStyle(this._input).font);window.setTimeout(Bridge.fn.bind(this,function(){if(!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.ChildStyle)){var n={};Core.Extensions.Utils.IsFunction(this.GuiInfo.ChildStyle,n)&&Bridge.toString(n.v.call(this,Bridge.unbox(this.Entity),this._input))}}),100);Bridge.staticEquals(n=this.DOMContentLoaded,null)?null:n()},KeyDownNumber:function(n){var t=0,h,g,c,l,a,v,y,o=new System.Threading.Tasks.TaskCompletionSource,nt,p,w,tt,s,b,it,r,rt,u,k,d,i,f,ut,ft,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,17,19],t);switch(t){case 0:if(!Bridge.is(this.Parent,Core.Components.ListViewItem)){o.setResult(null);return}if(nt=System.Nullable.eq(Core.Extensions.EventExt.KeyCodeEnum(n),Core.Enums.KeyCodeEnum.V)&&Core.Extensions.EventExt.CtrlOrMetaKey(n)&&Core.Extensions.EventExt.ShiftKey(n),p=new System.Threading.Tasks.TaskCompletionSource,nt){t=1;continue}t=19;continue;case 1:if(navigator.clipboard.readText().then(function(n){return p.setResult(n)}),h=p.task,t=2,h.isCompleted())continue;h["continue"](e);return;case 2:if(g=h.getAwaitedResult(),w=g,tt=System.String.contains(w,"\r\n"),tt){t=3;continue}t=18;continue;case 3:s=(b=System.String,System.Linq.Enumerable.from(w.split("\r\n"),b).toList(b));this._input.value=s.getItem(0);this.SetValue();it=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem,this);r=it.RowNo;rt=s.Count+r|0;u=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.VirtualGrid,this);u.AutoFocus=!0;k=Bridge.getEnumerator(System.Linq.Enumerable.from(s,System.String).take(s.Count-1|0));t=4;continue;case 4:if(k.moveNext()){d=k.Current;t=5;continue}t=17;continue;case 5:if(i=System.Linq.Enumerable.from(u.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(function(n){return n.RowNo===r},null),i==null){t=6;continue}t=10;continue;case 6:if(r<=rt){t=7;continue}t=9;continue;case 7:if(c=System.Threading.Tasks.Task.delay(1e3),t=8,c.isCompleted())continue;c["continue"](e);return;case 8:c.getAwaitedResult();i=System.Linq.Enumerable.from(u.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(function(n){return n.RowNo===r},null);t=9;continue;case 10:if(f=System.Linq.Enumerable.from(i.FilterChildren(Core.Components.Number,Bridge.fn.bind(this,function(n){return Bridge.referenceEquals(n.GuiInfo.FieldName,this.GuiInfo.FieldName)})),Core.Components.Number).firstOrDefault(null,null),f.Dirty=!0,f.Value=Core.Extensions.StringExt.IsNullOrWhiteSpace(System.String.replaceAll(System.String.replaceAll(d,",",""),".",""))?Bridge.getDefaultValue(System.Decimal):System.Decimal(System.String.replaceAll(System.String.replaceAll(d,",",""),".","")),f.UpdateView(),f.PopulateFields(),l=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(f,f.GuiInfo.Events,"change",[i.Entity]),t=11,l.isCompleted())continue;l["continue"](e);return;case 11:if(l.getAwaitedResult(),a=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(i.ListViewSection.ListView,i.ListViewSection.ListView.GuiInfo.Events,"change",[i.Entity]),t=12,a.isCompleted())continue;a["continue"](e);return;case 12:if(a.getAwaitedResult(),u.GuiInfo.IsRealtime){t=13;continue}t=15;continue;case 13:if(v=i.PatchUpdate(),t=14,v.isCompleted())continue;v["continue"](e);return;case 14:v.getAwaitedResult();t=15;continue;case 15:if((ut=u.DataTable.parentElement).scrollTop=ut.scrollTop+26|0,r=r+1|0,y=System.Threading.Tasks.Task.delay(300),t=16,y.isCompleted())continue;y["continue"](e);return;case 16:y.getAwaitedResult();t=4;continue;case 17:u.AutoFocus=!1;t=18;continue;case 19:o.setResult(null);return;default:o.setResult(null);return}}}catch(et){ft=System.Exception.create(et);o.setException(ft)}},arguments);return e(),o.task},IsNullable:function(n){return Core.Extensions.Utils.IsNullable(n,Bridge.getType(this.Entity),this.GuiInfo.FieldName,this.Entity)},ChangeSetValue:function(){var n,i=this._value;if(this.EmptyRow=!1,Core.Extensions.StringExt.IsNullOrWhiteSpace(this._input.value)){this.Value=System.Decimal.lift(null);Bridge.staticEquals(this.UserInput,null)||this.UserInput((n=new Core.MVVM.ObservableArgs,n.NewData=null,n.OldData=i,n.EvType="change",n));return}this._input.value=this._input.value.trim();System.Linq.Enumerable.from(this._input.value,System.Char).last()===Core.Components.Number._decimalSeparator&&(this._input.value=this._input.value.substr(0,this._input.value.length-1|0));var r=System.String.replaceAll(this._input.value,",",""),t={},u=System.Decimal.tryParse(r,System.Globalization.CultureInfo.invariantCulture.numberFormat,t);if(!u){this.Value=this._value;return}this.Value=t.v;Bridge.staticEquals(this.UserInput,null)||this.UserInput((n=new Core.MVVM.ObservableArgs,n.NewData=t.v,n.OldData=i,n.EvType="change",n));this.PopulateFields();System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,u=new System.Threading.Tasks.TaskCompletionSource,f,e=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity,t.v,i]),n=1,r.isCompleted())continue;r["continue"](e);return;case 1:r.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(o){f=System.Exception.create(o);u.setException(f)}},arguments);return e(),u.task}))},SetValue:function(){var n,i;if(this.EmptyRow=!1,Core.Extensions.StringExt.IsNullOrWhiteSpace(this._input.value)){this.Value=System.Decimal.lift(null);return}this._input.value=this._input.value.trim();System.Linq.Enumerable.from(this._input.value,System.Char).last()===Core.Components.Number._decimalSeparator&&(this._input.value=this._input.value.substr(0,this._input.value.length-1|0));var r=System.String.replaceAll(this._input.value,",",""),t={},u=System.Decimal.tryParse(r,System.Globalization.CultureInfo.invariantCulture.numberFormat,t);if(!u){this.Value=this._value;return}i=this._value;this.Value=t.v;Bridge.staticEquals(this.UserInput,null)||this.UserInput((n=new Core.MVVM.ObservableArgs,n.NewData=t.v,n.OldData=i,n.EvType="input",n));System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,u=new System.Threading.Tasks.TaskCompletionSource,f,e=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"input",[this.Entity,t.v,i]),n=1,r.isCompleted())continue;r["continue"](e);return;case 1:r.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(o){f=System.Exception.create(o);u.setException(f)}},arguments);return e(),u.task}))},GetDecimalValue:function(){var n;if(this.Entity==null||(n=Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName),n==null)||this._isString&&Core.Extensions.StringExt.IsNullOrWhiteSpace(Bridge.toString(n)))return System.Decimal.lift(null);try{return System.Convert.toDecimal(n)}catch(t){t=System.Exception.create(t)}return System.Decimal.lift(null)},UpdateView:function(n,t,i){var r;n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);this.Value=this.GetDecimalValue();this.Dirty||(this.OriginalText=this._input.value,Bridge.staticEquals(r=this.DOMContentLoaded,null)?null:r(),this.OldValue=this._input.value)},ValidateAsync:function(){var t=0,n=new System.Threading.Tasks.TaskCompletionSource,i,r=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0],t);switch(t){case 0:if(Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule),this.ValidationRules)){n.setResult(!0);return}this.ValidationResult.clear();this.ValidateRequired(System.Nullable$1(System.Decimal),this._value);this.Validate(System.Nullable$1(System.Decimal),System.Nullable$1(System.Decimal),Core.Extensions.ValidationRule.GreaterThan,this._value,function(n,t){return System.Nullable.lifteq("equals",t,System.Decimal.lift(null))||System.Nullable.liftne("ne",n,System.Decimal.lift(null))&&System.Nullable.liftcmp("gt",n,t)});this.Validate(System.Nullable$1(System.Decimal),System.Nullable$1(System.Decimal),Core.Extensions.ValidationRule.LessThan,this._value,function(n,t){return System.Nullable.lifteq("equals",t,System.Decimal.lift(null))||System.Nullable.liftne("ne",n,System.Decimal.lift(null))&&System.Nullable.liftcmp("lt",n,t)});this.Validate(System.Nullable$1(System.Decimal),System.Nullable$1(System.Decimal),Core.Extensions.ValidationRule.GreaterThanOrEqual,this._value,function(n,t){return System.Nullable.lifteq("equals",t,System.Decimal.lift(null))||System.Nullable.liftne("ne",n,System.Decimal.lift(null))&&System.Nullable.liftcmp("gte",n,t)});this.Validate(System.Nullable$1(System.Decimal),System.Nullable$1(System.Decimal),Core.Extensions.ValidationRule.LessThanOrEqual,this._value,function(n,t){return System.Nullable.lifteq("equals",t,System.Decimal.lift(null))||System.Nullable.liftne("ne",n,System.Decimal.lift(null))&&System.Nullable.liftcmp("lte",n,t)});this.Validate(System.Nullable$1(System.Decimal),System.Nullable$1(System.Decimal),Core.Extensions.ValidationRule.Equal,this._value,function(n,t){return System.Nullable.lifteq("equals",n,t)});this.Validate(System.Nullable$1(System.Decimal),System.Nullable$1(System.Decimal),Core.Extensions.ValidationRule.NotEqual,this._value,function(n,t){return System.Nullable.liftne("ne",n,t)});n.setResult(this.IsValid);return;default:n.setResult(null);return}}}catch(r){i=System.Exception.create(r);n.setException(i)}},arguments);return r(),n.task},SetDisableUI:function(n){this._input.readOnly=n}}});Bridge.define("Core.Components.Paginator",{inherits:[Core.Components.EditableComponent],props:{Options:{get:function(){return Bridge.as(this.Entity,Core.Components.PaginationOptions)}},Disabled:{get:function(){return!1},set:function(){this._disabled=!1}}},ctors:{ctor:function(n){this.$initialize();Core.Components.EditableComponent.ctor.call(this,null);this.Entity=n||function(){throw new System.ArgumentNullException.$ctor1("paginator");}();this.PopulateDirty=!1;this.AlwaysValid=!0;this.StopChildrenHistory=!0}},methods:{Render:function(){var n,t;Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Parent.Element).Div,"grid-toolbar paging").Label,"Phân trang").End.Render();this.Element=Core.MVVM.Html.Context;var i=(n=new Core.Components.Number((t=new Core.Models.Component,t.FieldName="PageSize",t),null),n.SetSeclection=!1,n),u=new Core.Components.CellText((n=new Core.Models.Component,n.FieldName="StartIndex",n)),f=new Core.Components.CellText((n=new Core.Models.Component,n.FieldName="EndIndex",n)),e=new Core.Components.CellText((n=new Core.Models.Component,n.FieldName="Total",n.FormatData="{0:n0}",n)),o=new Core.Components.CellText((n=new Core.Models.Component,n.FieldName="Selected",n.FormatData="{0:n0}",n)),r=(n=new Core.Components.Number((t=new Core.Models.Component,t.FieldName="PageNumber",t),null),n.AlwaysValid=!0,n.SetSeclection=!1,n);this.AddChild(i);i.Element.addEventListener(System.Enum.toString(System.String,"change"),Bridge.fn.cacheBind(this,this.ReloadListView));Core.MVVM.Html.Instance.End.Span.Render();this.AddChild(u);Core.MVVM.Html.Instance.Text("-");this.AddChild(f);Core.Components.Renderer.IText(Core.MVVM.Html.Instance," trong số ");this.AddChild(e);Core.Components.Renderer.IText(Core.MVVM.Html.Instance,System.String.format(" đang chọn ",null));this.AddChild(o);Core.Components.Renderer.IText(Core.MVVM.Html.Instance,System.String.format(" dòng ",null));Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Ul,"pagination").Li.Text("❮").Event("click",Bridge.fn.cacheBind(this,this.PrevPage)).End.Render();this.AddChild(r);r.Element.addEventListener(System.Enum.toString(System.String,"change"),Bridge.fn.bind(this,function(){this.Options.PageIndex=this.Options.PageNumber-1|0;this.ReloadListView()}));Core.MVVM.Html.Instance.End.Li.Text("❯").Event("click",Bridge.fn.cacheBind(this,this.NextPage)).End.Render()},NextPage:function(){var n,t,i=System.Decimal.toDecimalPlaces(System.Decimal(this.Options.Total).div(System.Decimal(this.Options.PageSize)),0,0);System.Decimal(this.Options.PageNumber).gte(i)||((n=this.Options).PageIndex=n.PageIndex+1|0,Bridge.staticEquals(t=this.Options.ClickHandler,null)?null:t(this.Options.PageIndex,null),this.ReloadListView())},PrevPage:function(){var n,t;this.Options.PageIndex<=0||((n=this.Options).PageIndex=n.PageIndex-1|0,Bridge.staticEquals(t=this.Options.ClickHandler,null)?null:t(this.Options.PageIndex,null),this.ReloadListView())},ReloadListView:function(){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){return Bridge.as(this.Parent,Core.Components.ListView).ActionFilter()}))},UpdateView:function(n,t,i){var r;n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);this.Show=this.Options.Total>=this.Options.PageSize;(r=this.Children)!=null?r.ForEach(function(n){n.UpdateView()}):null},BuildTextHistory:function(n,t){return t===void 0&&(t=null),n}}});Bridge.define("Core.Components.PdfReport",{inherits:[Core.Components.EditableComponent],statics:{fields:{ErrorMessage:null,DataNotFound:null,TemplateNotFound:null},ctors:{init:function(){this.ErrorMessage="ErrorMessage";this.DataNotFound="Không tìm thấy dữ liệu";this.TemplateNotFound="Template is null or empty"}}},fields:{_rptContent:null,_updateViewAwaiter$1:0},props:{Selected:null,Data:null,HiddenButton:!1},ctors:{ctor:function(n,t){t===void 0&&(t=null);this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.GuiInfo=n||function(){throw new System.ArgumentNullException.$ctor1("ui");}();this.Element=t}},methods:{Render:function(){this.Element==null&&(this.Element=Core.MVVM.Html.Take(this.ParentElement).Div.GetContext());this.Element.innerHTML=null;this.AddSections();System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this,this.RenderAsync))},AddSections:function(){if(this._rptContent==null&&this.Show){this.Element.style.display="none";var n=Core.MVVM.Html.Take(this.Element);System.Nullable.eq(this.GuiInfo.Precision,2)?(Core.Components.Renderer.ClassName(n.Div,"printable").Style$1("page-break-before: always;"),this._rptContent=n.GetContext()):(Core.Components.Renderer.ClassName(n.Div,"container-rpt"),Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(n.Div,"menuBar").Div,"printBtn").Button,"fa fal fa-expand").Event("click",Bridge.fn.bind(this,function(){var n;(n=Bridge.unbox(this.Element.requestFullscreen))!=null?n.call(this.Element):null;this.Element.style.overflow="auto"})).End.Button,"fa fa-print").Event("click",Bridge.fn.bind(this,function(){Core.Components.Forms.EditForm.PrintSection(Bridge.as(this.Element.querySelector(".printable"),HTMLElement),!0,void 0,!0)})).End.Button,"fal fa-file-pdf").Event("click",Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.GeneratePdf(),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()})).End.Button,"fa fa-file-excel").Event("click",Bridge.fn.bind(this,function(){var n,t;if(!((t=Bridge.as(this._rptContent.querySelector("table"),HTMLTableElement))!=null)){Core.Components.Forms.ConfirmDialog.RenderConfirm$1("Excel data not found in the report");return}Core.Extensions.ExcelExt.ExportTableToExcel(null,(n=this.GuiInfo.Label,n!=null?n:this.GuiInfo.FieldName),t)})).End.Render(),Core.Clients.Client.SystemRole&&Core.Components.Renderer.ClassName(n.Button,"far fa-eye").Event("click",Bridge.fn.bind(this,function(){Core.Components.Forms.EditForm.PrintSection(Bridge.as(this.Element.querySelector(".printable"),HTMLElement))})).End.Render(),n.EndOf$1(".menuBar"),Core.Components.Renderer.ClassName(n.Div,"printable").Style$1("page-break-before: always;"),this._rptContent=n.GetContext())}},GeneratePdf:function(){var n=0,t,e,i=new System.Threading.Tasks.TaskCompletionSource,r,u,f=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Clients.Client.LoadScript("https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"),n=1,t.isCompleted())continue;t["continue"](f);return;case 1:e=t.getAwaitedResult();r=Bridge.as(this.Element.querySelector(".printable"),HTMLElement);var o=function(n){var t=n.output("blob");window.open(window.URL.createObjectURL(t))};html2pdf(r,{margin:0,filename:"bb",image:{type:"jpeg",quality:1},html2canvas:{scale:2,logging:!0},jsPDF:{unit:"pt",format:"a4",orientation:"l"},pdfCallback:o});i.setResult(null);return;default:i.setResult(null);return}}}catch(s){u=System.Exception.create(s);i.setException(u)}},arguments);return f(),i.task},RenderAsync:function(){var n=0,r,h,u,c,f,t=new System.Threading.Tasks.TaskCompletionSource,e,l,i,a,o,v,s=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5,6,7,8],n);switch(n){case 0:if(!this.Show){t.setResult(null);return}if(this.DisposeChildren(),Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.Template)){n=1;continue}else{n=2;continue}case 1:e=this.GuiInfo.Template;n=4;continue;case 2:if(r=new Core.Clients.Client.$ctor1("Feature").FirstOrDefaultAsync(Core.Models.Feature,this.GuiInfo.DataSourceFilter),n=3,r.isCompleted())continue;r["continue"](s);return;case 3:h=r.getAwaitedResult();l=h;e=l.Template;n=4;continue;case 4:if(Core.Extensions.StringExt.IsNullOrEmpty(e))throw new System.InvalidOperationException.$ctor1(Core.Components.PdfReport.TemplateNotFound);if(u=this.LoadData(),n=5,u.isCompleted())continue;u["continue"](s);return;case 5:if(c=u.getAwaitedResult(),i=c,i==null){this.ShowErrorMessage(Core.Components.PdfReport.DataNotFound);t.setResult(null);return}if(i[Core.Components.PdfReport.ErrorMessage]!=null){this.ShowErrorMessage(Bridge.toString(i[Core.Components.PdfReport.ErrorMessage]));t.setResult(null);return}if(this.Element.style.display="",a=Core.Extensions.Utils.FormatEntity(e,null,i,function(){return""},void 0),this._rptContent.innerHTML=a,o=0,Core.Extensions.IEnumerableExtensions.ForEach(HTMLElement,this._rptContent.children,Bridge.fn.bind(this,function(n){this.EditForm.BindingTemplate(n,this,!1,i,Bridge.fn.bind(this,function(n,t,r,u,f){var e,s,l;if((s=Bridge.as(n,HTMLTableElement))!=null&&Bridge.referenceEquals(s.dataset.grid,"true")){o=o+1|0;var a=i["ds"+o],v=(e=new Core.Components.Section.$ctor1(Core.MVVM.ElementType.table),e.Element=n,e),h=s.tBodies[0],c=Bridge.as(a,System.Array.type(System.Object));return Core.Extensions.IEnumerableExtensions.Nothing(System.Object,c)&&(c=System.Array.init([{}],System.Object)),l=System.Linq.Enumerable.from(c,System.Object).select(Bridge.fn.bind(this,function(n){var t,i=this.CloneRow((t=HTMLTableRowElement,System.Linq.Enumerable.from(h.rows,t).ToArray(t)));return this.BindingRowData(i,n)})).selectMany(function(n){return n}).ToArray(HTMLTableRowElement),h.innerHTML=null,l.forEach(function(n){h.appendChild(n)}),v}return this.EditForm.BindingData(n,t,r,u,f)}),void 0)})),this.GuiInfo!=null&&Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.Events)){n=6;continue}n=8;continue;case 6:if(f=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"DOMContentLoaded",[this.Entity]),n=7,f.isCompleted())continue;f["continue"](s);return;case 7:f.getAwaitedResult();n=8;continue;case 8:t.setResult(null);return;default:t.setResult(null);return}}}catch(y){v=System.Exception.create(y);t.setException(v)}},arguments);return s(),t.task},ShowErrorMessage:function(n){Core.Extensions.HtmlElementExtension.Hidden(this.Element)||(this.Element.style.display="none",Core.Components.Forms.ConfirmDialog.RenderConfirm$1(n))},BindingRowData:function(n,t){var u,r,i,e,f;if(t==null||Core.Extensions.IEnumerableExtensions.Nothing(HTMLTableRowElement,n))return null;for(u=new(System.Collections.Generic.List$1(HTMLTableRowElement).ctor),r=Core.Extensions.IEnumerableExtensions.IndexOf(HTMLTableRowElement,n,function(n){return Bridge.referenceEquals(n.dataset.subRpt,"true")}),i=0;r>=0&&i<r||r<=0&&i<n.length;i=i+1|0)n[System.Array.index(i,n)].innerHTML=Core.Extensions.Utils.FormatEntity(n[System.Array.index(i,n)].innerHTML,null,t,Core.Extensions.Utils.EmptyFormat,Core.Extensions.Utils.EmptyFormat),u.add(n[System.Array.index(i,n)]);return r<0?u.ToArray():(e=System.Linq.Enumerable.from(n,HTMLTableRowElement).skip(r).ToArray(HTMLTableRowElement),f=this.BindingSubGrid(e,t),Core.Extensions.IEnumerableExtensions.HasElement(HTMLTableRowElement,f)&&u.AddRange(f),u.ToArray())},BindingSubGrid:function(n,t){var s="SubRpt",f,u,i,l,o;for(f in t)t[f]instanceof Array&&(s=f);var h=System.Linq.Enumerable.from(n,HTMLTableRowElement).selectMany(function(n){return n.cells}).select(function(n){return Bridge.cast(n,HTMLElement)}),e=Core.Extensions.IEnumerableExtensions.IndexOf(HTMLTableRowElement,n,function(n){var t;return Bridge.referenceEquals(n,(t=h.firstOrDefault(function(t){return System.String.contains(t.innerHTML,"{")&&System.String.contains(n.innerHTML,"}")},null))!=null?t.parentElement:null)}),c=Core.Extensions.IEnumerableExtensions.IndexOf(HTMLTableRowElement,n,function(n){var t;return Bridge.referenceEquals(n,(t=h.lastOrDefault(function(t){return System.String.contains(t.innerHTML,"{")&&System.String.contains(n.innerHTML,"}")},null))!=null?t.parentElement:null)}),r;if(!((r=Bridge.as(t[s],System.Array.type(System.Object)))!=null))return null;for(u=new(System.Collections.Generic.List$1(HTMLTableRowElement).$ctor1)(System.Linq.Enumerable.from(n,HTMLTableRowElement).take(e)),i=0;i<r.length;i=i+1|0)l=this.CloneRow(System.Linq.Enumerable.from(n,HTMLTableRowElement).skip(e).take((c-e|0)+1|0).ToArray(HTMLTableRowElement)),o=this.BindingRowData(l,r[System.Array.index(i,r)]),Core.Extensions.IEnumerableExtensions.HasElement(HTMLTableRowElement,o)&&u.AddRange(o);return u.AddRange(System.Linq.Enumerable.from(n,HTMLTableRowElement).skip(c+1|0)),u.ToArray()},CloneRow:function(n){for(var i=new(System.Collections.Generic.List$1(HTMLTableRowElement).ctor),t=0;t<n.length;t=t+1|0)i.add(Bridge.as(n[System.Array.index(t,n)].cloneNode(!0),HTMLTableRowElement));return i.ToArray()},LoadData:function(){var t=0,u,l,f,a,i=new System.Threading.Tasks.TaskCompletionSource,n,e,o,s,r,h,v,c=Bridge.fn.bind(this,function(){var it,y,p,k,w,tt;try{for(;;){t=System.Array.min([0,1,2,3,4],t);switch(t){case 0:if(n=null,u=this.TryGetDataSource(),t=1,u.isCompleted())continue;u["continue"](c);return;case 1:if(l=u.getAwaitedResult(),e=l,Core.Extensions.StringExt.IsNullOrWhiteSpace(e)){i.setResult(null);return}if(this.Data==null){t=2;continue}t=4;continue;case 2:if(f=new Core.Clients.Client.$ctor1("User").PostAsync(System.Array.type(System.Array.type(System.Object)),e,System.String.format("ReportDataSet?sys={0}",[(o=this.GuiInfo.System,o!=null?o:this.GuiInfo.IdField)])),t=3,f.isCompleted())continue;f["continue"](c);return;case 3:if(a=f.getAwaitedResult(),n=(s=a,this.Data=s,s),Core.Extensions.IEnumerableExtensions.Nothing(System.Array.type(System.Object),n)||System.Linq.Enumerable.from(n,System.Array.type(System.Object)).all(function(n){return Core.Extensions.IEnumerableExtensions.Nothing(System.Object,n)})){i.setResult(null);return}t=4;continue;case 4:for(r={},h={},it=!1,y=0;y<n.length;y++){for(p=0;p<n[y].length;p++)for(k in n[y][p])typeof n[y][p][k]=="string"&&(n[y][p][k]=Core.Extensions.Utils.DecodeSpecialChar(n[y][p][k]));if(y==0)for(w in n[0][0])r[w]=n[0][0][w];else{var b=n[y],d=[],g=[],nt;if(b==null||b.length==0)continue;for(w in b[0])w.indexOf(".")>=0?d.push(w):g.push(w);d.length>0&&(nt=d[0].split(".")[0],tt=d.map(function(n){return{field:n.split(".").reverse()[0],fullField:n}}),b=System.Linq.Enumerable.from(b).groupBy(function(n){return System.String.concat(g.map(function(t){return n[t]}))}).select(function(n){var t=n.ToArray(),i=t[0],r=t.map(function(n){var t={};return tt.forEach(function(i){t[i.field]=n[i.fullField];delete n[i.fullField]}),t});return i[nt]=r,i}).ToArray());r["ds"+y]=b}}if(Core.Extensions.Utils.IsFunction(this.GuiInfo.FormatEntity,h)){i.setResult(h.v.call(null,Bridge.unbox(r),this));return}i.setResult(r);return;default:i.setResult(null);return}}}catch(rt){v=System.Exception.create(rt);i.setException(v)}},arguments);return c(),i.task},TryGetDataSource:function(){var i,n=new System.Threading.Tasks.TaskCompletionSource,t;try{var u={},o=Core.Extensions.Utils.IsFunction(this.GuiInfo.Query,u),f={},s=Core.Extensions.Utils.IsFunction(this.GuiInfo.PreQuery,f),h=s?f.v.call(this,Bridge.unbox(this.Entity),this,Bridge.unbox(this.Selected)):null,e=null;o?(t=u.v.call(this,Bridge.unbox((i=h,i!=null?i:this.Entity)),this,Bridge.unbox(this.Selected)),t==null&&n.setException(new System.NullReferenceException.$ctor1("Query is null")),Bridge.referenceEquals(Bridge.getType(t),System.String)?n.setResult(Bridge.toString(t)):t.then(function(t){n.setResult(t)})):(e=Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.Query,this.Entity),n.setResult(e))}catch(r){r=System.Exception.create(r);n.setException(r)}return n.task},UpdateView:function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);this.Data=null;window.clearTimeout(this._updateViewAwaiter$1);this._updateViewAwaiter$1=window.setTimeout(Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.RenderAsync(),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()}),100)}}});Bridge.define("Core.Components.Rating",{inherits:[Core.Components.EditableComponent],fields:{InputList:null,_value:null},props:{Value:{get:function(){return this._value},set:function(n){System.Nullable.eq(this._value,n)||(this._value=n,System.Nullable.hasValue(this._value)&&(this._value=System.Nullable.getValue(this._value),this.SetSelected(n)),Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,Bridge.box(this._value,System.Int32,System.Nullable.toString,System.Nullable.getHashCode)),this.Dirty=!0)}},Disabled:{get:function(){return Bridge.ensureBaseProperty(this,"Disabled").$Core$Components$EditableComponent$Disabled},set:function(n){Bridge.ensureBaseProperty(this,"Disabled").$Core$Components$EditableComponent$Disabled=n;this.InputList.ForEach(function(t){t.disabled=n})}}},ctors:{init:function(){this.InputList=new(System.Collections.Generic.List$1(HTMLInputElement).ctor)},ctor:function(n,t){t===void 0&&(t=null);var i;this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this.GuiInfo=n||function(){throw new System.ArgumentNullException.$ctor1("ui");}();this.GuiInfo.Precision=(i=this.GuiInfo.Precision,i!=null?i:5);this.ParentElement=t}},methods:{SetSelected:function(n){n==null||System.Nullable.lte(n,0)||System.Nullable.gt(n,this.GuiInfo.Precision)||(this.InputList.getItem(System.Nullable.getValue(this.GuiInfo.Precision)-System.Nullable.getValue(n)|0).checked=!0)},Render:function(){var r,t,n,i;for(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Div,"rate"),this.Element=Core.MVVM.Html.Context,t=(this.GuiInfo.FieldName||"")+this.GuiInfo.Id+Bridge.getHashCode(this),n=this.GuiInfo.Precision;System.Nullable.gte(n,1);n=Bridge.Int.clip32(System.Nullable.sub(n,1)))i=System.String.format("{0}_{1}",t,Bridge.box(n,System.Int32,System.Nullable.toString,System.Nullable.getHashCode)),Core.MVVM.Html.Take(this.Element).Input.Attr$1("type","radio").Id(i).Attr$1("name",t).Value(System.Nullable.toString(n,null)).Event$1("change",Bridge.fn.cacheBind(this,this.DispatchChange)).Style$1(this.GuiInfo.Style),this.InputList.add(Core.MVVM.Html.Context),Core.MVVM.Html.Take(this.Element).Label.Attr$1("for",i).Text(System.String.format("{0} stars",[Bridge.box(n,System.Int32,System.Nullable.toString,System.Nullable.getHashCode)]));Core.MVVM.Html.Take(this.Element).End.Render();this._value=Bridge.unbox(Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName));this.SetSelected(this._value);Bridge.staticEquals(r=this.DOMContentLoaded,null)?null:r()},DispatchChange:function(){var n,t,i;this.Disabled||Core.Extensions.IEnumerableExtensions.Nothing(HTMLInputElement,this.InputList)||(t=System.Linq.Enumerable.from(this.InputList,HTMLInputElement).firstOrDefault(function(n){return n.checked},null),i=this.Value,this.Value=System.Int32.parse(t.value),Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,Bridge.box(this._value,System.Int32,System.Nullable.toString,System.Nullable.getHashCode)),Bridge.staticEquals(this.UserInput,null)||this.UserInput((n=new Core.MVVM.ObservableArgs,n.NewData=Bridge.box(this.Value,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),n.OldData=Bridge.box(i,System.Int32,System.Nullable.toString,System.Nullable.getHashCode),n)),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"click",[this.Entity]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task})))},UpdateView:function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);this.Value=Bridge.unbox(Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName))},GetValueText:function(){return this._value==null?"Không đánh giá":System.Nullable.toString(this._value,null)+" sao"},ValidateAsync:function(){var n=0,t,f,i=new System.Threading.Tasks.TaskCompletionSource,r,u,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5],n);switch(n){case 0:if(t=Core.Components.EditableComponent.prototype.ValidateAsync.call(this),n=1,t.isCompleted())continue;t["continue"](o);return;case 1:if(f=t.getAwaitedResult(),f){n=2;continue}r=!1;n=3;continue;case 2:r=System.Nullable.hasValue(this.Value);n=3;continue;case 3:if(r){n=4;continue}u=!1;n=5;continue;case 4:u=this.ValidateRequired(System.Int32,System.Nullable.getValue(this.Value));n=5;continue;case 5:i.setResult(u);return;default:i.setResult(null);return}}}catch(s){e=System.Exception.create(s);i.setException(e)}},arguments);return o(),i.task}}});Bridge.define("Core.Components.RichTextBox",{inherits:[Core.Components.EditableComponent],fields:{_textArea:null,editor:null},ctors:{ctor:function(n,t){t===void 0&&(t=null);this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);this._textArea=Bridge.as(t,HTMLTextAreaElement)}},methods:{Render:function(){System.Nullable.lte(this.GuiInfo.Row,0)&&(this.GuiInfo.Row=1);this._textArea==null&&(this._textArea=Bridge.as(Core.MVVM.Html.Take(this.ParentElement).TextArea.Id("RE_"+System.Guid.NewGuid()).GetContext(),HTMLTextAreaElement));System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,f,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Clients.Client.LoadScript("https://support.pavietnam.vn/js/tinymce/tinymce.min.js?v=1.9.84"),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:f=t.getAwaitedResult();var e=this;tinymce.init({selector:"#"+this._textArea.id,menubar:"file edit view insert format tools table tc help",plugins:"print preview code powerpaste casechange importcss tinydrive searchreplace autolink autosave save directionality advcode visualblocks visualchars fullscreen image link media mediaembed template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists checklist wordcount tinymcespellchecker a11ychecker imagetools textpattern noneditable help formatpainter permanentpen pageembed charmap tinycomments mentions quickbars linkchecker emoticons advtable export",toolbar:"undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist checklist | forecolor backcolor anchor link media image table | hr code removeformat | fullscreen | casechange permanentpen formatpainter | pagebreak | charmap emoticons | preview save print | insertfile pageembed template | a11ycheck ltr rtl | showcomments addcomment",fontsize_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 17pt 18pt 24pt 36pt 48pt",images_upload_handler:e.ImageUploadHandler,setup:function(n){e.editor=n;n.on("init",function(){n.setContent(e.Entity[e.GuiInfo.FieldName]||"")});n.on("input",function(){e.Entity[e.GuiInfo.FieldName]=n.getContent();e.Dirty=!0})}});i.setResult(null);return;default:i.setResult(null);return}}}catch(o){r=System.Exception.create(o);i.setException(r)}},arguments);return u(),i.task}))},ImageUploadHandler:function(n,t){var r=Bridge.unbox(n.blob)(),i=new FileReader;i.onload=Bridge.fn.combine(i.onload,Bridge.fn.bind(this,function(n){var i=0,u,e,o,s,f,h=Bridge.fn.bind(this,function(){for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(o=new Core.Components.ImageUploader(new Core.Models.Component),u=o.UploadBase64Image(Bridge.toString(n.target.result),r.name),i=1,u.isCompleted())continue;u["continue"](h);return;case 1:e=u.getAwaitedResult();s=e;Bridge.staticEquals(t,null)||(t(s),f=null,f=this.editor.setContent(text),Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,f));return;default:return}}},arguments);h()}));i.readAsDataURL(r)},UpdateView:function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);var r=Core.Extensions.Utils.GetComplexPropValue(this.Entity,this.GuiInfo.FieldName);this.editor.setContent(r||"")}}});Bridge.define("Core.Components.Textbox",{inherits:[Core.Components.EditableComponent],fields:{_value:null,_oldText:null,_text:null},props:{Input:null,TextArea:null,MultipleLine:!1,Password:!1,Value:{get:function(){return this._value},set:function(n){var r,u,f,t,i;this._value=n;this._value==null||(f=Bridge.as(this._value,System.String))==null||(this.EditForm.Feature==null||this.EditForm.Feature.IgnoreEncode)&&this.EditForm.Feature!=null||((r=this.Entity)!=null?Core.Extensions.BridgeExt.SetComplexPropValue(r,this.GuiInfo.FieldName,Core.Extensions.Utils.EncodeSpecialChar(Core.Extensions.Utils.DecodeSpecialChar(f))):null);this.Entity!=null&&Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this._value);t=this.EditForm.Feature!=null&&this.EditForm.Feature.IgnoreEncode?this._value!=null?Bridge.toString(this._value):null:this._value!=null?Core.Extensions.Utils.DecodeSpecialChar(Bridge.toString(this._value)):null;Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FormatData)&&(t=Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.FormatData,(u=this.Entity)!=null?Core.Extensions.Utils.GetComplexPropValue(u,this.GuiInfo.FieldName):null));Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FormatEntity)&&(t=Core.Extensions.Utils.FormatEntity(this.GuiInfo.FormatEntity,null,this.Entity,Core.Extensions.Utils.EmptyFormat,Core.Extensions.Utils.EmptyFormat));Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.ChildStyle)||(i={},Core.Extensions.Utils.IsFunction(this.GuiInfo.ChildStyle,i)&&Bridge.toString(i.v.call(this,Bridge.unbox(this.Entity),this.Element)));this.Text=t;this.PopulateFields()}},Text:{get:function(){return this._text},set:function(n){this._text=n;this.Input!=null&&(this.Input.value=this._text);this.TextArea!=null&&(this.TextArea.value=this._text)}}},ctors:{ctor:function(n,t){t===void 0&&(t=null);this.$initialize();Core.Components.EditableComponent.ctor.call(this,n);Bridge.is(t,HTMLInputElement)?this.Input=Bridge.as(t,HTMLInputElement):Bridge.is(t,HTMLTextAreaElement)&&(this.TextArea=Bridge.as(t,HTMLTextAreaElement));document.addEventListener("visibilitychange",Bridge.fn.bind(this,function(){this.Dirty&&this.PopulateUIChange("visibilitychange")}))}},methods:{KeyDownNumber:function(n){var t=0,h,d,c,l,a,v,y,o=new System.Threading.Tasks.TaskCompletionSource,g,p,w,nt,s,b,tt,r,it,u,k,rt,i,f,ut,ft,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,17,19],t);switch(t){case 0:if(!Bridge.is(this.Parent,Core.Components.ListViewItem)){o.setResult(null);return}if(g=System.Nullable.eq(Core.Extensions.EventExt.KeyCodeEnum(n),Core.Enums.KeyCodeEnum.V)&&Core.Extensions.EventExt.CtrlOrMetaKey(n)&&Core.Extensions.EventExt.ShiftKey(n),p=new System.Threading.Tasks.TaskCompletionSource,g){t=1;continue}t=19;continue;case 1:if(navigator.clipboard.readText().then(function(n){return p.setResult(n)}),h=p.task,t=2,h.isCompleted())continue;h["continue"](e);return;case 2:if(d=h.getAwaitedResult(),w=d,nt=System.String.contains(w,"\r\n"),nt){t=3;continue}t=18;continue;case 3:s=(b=System.String,System.Linq.Enumerable.from(w.split("\r\n"),b).toList(b));this.Input.value=s.getItem(0);tt=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem,this);r=tt.RowNo;it=s.Count+r|0;u=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.VirtualGrid,this);u.AutoFocus=!0;k=Bridge.getEnumerator(System.Linq.Enumerable.from(s,System.String).take(s.Count-1|0));t=4;continue;case 4:if(k.moveNext()){rt=k.Current;t=5;continue}t=17;continue;case 5:if(i=System.Linq.Enumerable.from(u.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(function(n){return n.RowNo===r},null),i==null){t=6;continue}t=10;continue;case 6:if(r<=it){t=7;continue}t=9;continue;case 7:if(c=System.Threading.Tasks.Task.delay(1e3),t=8,c.isCompleted())continue;c["continue"](e);return;case 8:c.getAwaitedResult();i=System.Linq.Enumerable.from(u.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(function(n){return n.RowNo===r},null);t=9;continue;case 10:if(f=System.Linq.Enumerable.from(i.FilterChildren(Core.Components.Textbox,Bridge.fn.bind(this,function(n){return Bridge.referenceEquals(n.GuiInfo.FieldName,this.GuiInfo.FieldName)})),Core.Components.Textbox).firstOrDefault(null,null),f.Dirty=!0,f.Value=rt,f.UpdateView(),f.PopulateFields(),l=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(f,f.GuiInfo.Events,"change",[i.Entity]),t=11,l.isCompleted())continue;l["continue"](e);return;case 11:if(l.getAwaitedResult(),a=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(i.ListViewSection.ListView,i.ListViewSection.ListView.GuiInfo.Events,"change",[i.Entity]),t=12,a.isCompleted())continue;a["continue"](e);return;case 12:if(a.getAwaitedResult(),u.GuiInfo.IsRealtime){t=13;continue}t=15;continue;case 13:if(v=i.PatchUpdate(),t=14,v.isCompleted())continue;v["continue"](e);return;case 14:v.getAwaitedResult();t=15;continue;case 15:if((ut=u.DataTable.parentElement).scrollTop=ut.scrollTop+26|0,r=r+1|0,y=System.Threading.Tasks.Task.delay(500),t=16,y.isCompleted())continue;y["continue"](e);return;case 16:y.getAwaitedResult();t=4;continue;case 17:u.AutoFocus=!1;t=18;continue;case 19:o.setResult(null);return;default:o.setResult(null);return}}}catch(et){ft=System.Exception.create(et);o.setException(ft)}},arguments);return e(),o.task},Render:function(){var o,s,i,r,u,f,h,n,c,t,e;this.SetDefaultVal();n=(o=this.Entity)!=null?Core.Extensions.Utils.GetComplexPropValue(o,this.GuiInfo.FieldName):null;n==null||(c=Bridge.as(n,System.String))==null||this.EditForm==null||this.EditForm.Feature==null||this.EditForm.Feature.IgnoreEncode||((s=this.Entity)!=null?Core.Extensions.BridgeExt.SetComplexPropValue(s,this.GuiInfo.FieldName,Core.Extensions.Utils.EncodeSpecialChar(Core.Extensions.Utils.DecodeSpecialChar(c))):null);t=n!=null?Bridge.toString(n):null;Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FormatData)&&(t=Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.FormatData,n));Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FormatEntity)&&(t=Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.FormatEntity,this.Entity));this._text=this.EditForm!=null&&this.EditForm.Feature!=null&&this.EditForm.Feature.IgnoreEncode?t:Core.Extensions.Utils.DecodeSpecialChar(t);this.MultipleLine||this.TextArea!=null?(this.TextArea==null?(Core.Components.Renderer.PlaceHolder(Core.MVVM.Html.Take(this.ParentElement).TextArea.Value(this._text),this.GuiInfo.PlainText),this.Element=(i=Bridge.as(Core.MVVM.Html.Context,HTMLTextAreaElement),this.TextArea=i,i)):(this.Element=this.TextArea,this.TextArea.value=this._text),System.Nullable.gt(this.GuiInfo.Row,0)&&Core.MVVM.Html.Instance.Attr("rows",(r=this.GuiInfo.Row,r!=null?r:1)),this.TextArea.oninput=Bridge.fn.combine(this.TextArea.oninput,Bridge.fn.bind(this,function(){this.PopulateUIChange("input")})),this.TextArea.onchange=Bridge.fn.combine(this.TextArea.onchange,Bridge.fn.bind(this,function(){this.PopulateUIChange("change")})),this.TextArea.addEventListener("keydown",Bridge.fn.bind(this,function(n){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.KeyDownNumber(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()}))):(this.Input==null?(Core.Components.Renderer.PlaceHolder(Core.MVVM.Html.Take(this.ParentElement).Input.Value(this._text),this.GuiInfo.PlainText),this.Element=(u=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement),this.Input=u,u)):(this.Element=this.Input,this.Input.value=this._text),this.Input.autocomplete="off",this.Input.name=(f=this.GuiInfo.DataSourceFilter,f!=null?f:this.GuiInfo.FieldName),this.Input.oninput=Bridge.fn.combine(this.Input.oninput,Bridge.fn.bind(this,function(){this.PopulateUIChange("input")})),this.Input.onchange=Bridge.fn.combine(this.Input.onchange,Bridge.fn.bind(this,function(){this.PopulateUIChange("change")})),this.GuiInfo.AutoFit&&Core.Components.Extensions.ComponentExt.SetAutoWidth(this,this.Input.value,Core.Extensions.HtmlElementExtension.GetComputedStyle(this.Input).font),this.Input.addEventListener("keydown",Bridge.fn.bind(this,function(n){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.KeyDownNumber(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()})));Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.ChildStyle)||(e={},Core.Extensions.Utils.IsFunction(this.GuiInfo.ChildStyle,e)&&Bridge.toString(e.v.call(this,Bridge.unbox(this.Entity),this.Element)));this.Password&&Core.MVVM.Html.Instance.Style$1("text-security: disc;-webkit-text-security: disc;-moz-text-security: disc;");this.GuiInfo.ShowLabel||Core.Components.Renderer.PlaceHolder(Core.MVVM.Html.Instance,this.GuiInfo.PlainText);Bridge.staticEquals(h=this.DOMContentLoaded,null)?null:h()},PopulateUIChange:function(n,t){var r,u,i;(t===void 0&&(t=!1),this.Disabled)||(this._oldText=this._text,this._text=(r=(u=this.Input)!=null?u.value:null,r!=null?r:this.TextArea.value),this._text=this.Password?this._text:t?this._text!=null?this._text.trim():null:this._text,this.GuiInfo.UpperCase&&this._text!=null&&(this.Text=this._text.toLocaleUpperCase()),this._value=this.EditForm!=null&&this.EditForm.Feature!=null&&this.EditForm.Feature.IgnoreEncode?this._text:Core.Extensions.Utils.EncodeSpecialChar(this._text),this.Entity!=null&&Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this._value),this.Dirty=!0,Bridge.staticEquals(this.UserInput,null)||this.UserInput((i=new Core.MVVM.ObservableArgs,i.NewData=this._text,i.OldData=this._oldText,i.EvType=n,i)),this.PopulateFields(),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,n,[this.Entity]),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task})))},UpdateView:function(n,t,i){var r,u;n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);this.Value=(r=this.Entity)!=null?Core.Extensions.Utils.GetComplexPropValue(r,this.GuiInfo.FieldName):null;this.Dirty||(this.OriginalText=this._text,Bridge.staticEquals(u=this.DOMContentLoaded,null)?null:u(),this.OldValue=this._text)},ValidateAsync:function(){var n=0,i,e,r,t=new System.Threading.Tasks.TaskCompletionSource,f,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2],n);switch(n){case 0:if(Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule),this.ValidationRules)){t.setResult(!0);return}if(i=Core.Components.EditableComponent.prototype.ValidateAsync.call(this),n=1,i.isCompleted())continue;i["continue"](u);return;case 1:if(e=i.getAwaitedResult(),this.Validate(System.String,System.Int64,Core.Extensions.ValidationRule.MinLength,this._text,Bridge.fn.bind(this,function(n,t){return this._text!=null&&System.Int64(this._text.length).gte(t)})),this.Validate(System.String,System.Int64,Core.Extensions.ValidationRule.CheckLength,this._text,Bridge.fn.bind(this,function(n,t){return this._text==null||Bridge.referenceEquals(this._text,"")||System.Int64(this._text.length).equals(t)})),this.Validate(System.String,System.Int64,Core.Extensions.ValidationRule.MaxLength,this._text,Bridge.fn.bind(this,function(n,t){return this._text==null||System.Int64(this._text.length).lte(t)})),this.Validate(System.String,System.String,Core.Extensions.ValidationRule.RegEx,this._text,Bridge.fn.cacheBind(this,this.ValidateRegEx)),this.ValidateRequired(System.String,this.Text),r=this.ValidateUnique(),n=2,r.isCompleted())continue;r["continue"](u);return;case 2:r.getAwaitedResult();t.setResult(this.IsValid);return;default:t.setResult(null);return}}}catch(o){f=System.Exception.create(o);t.setException(f)}},arguments);return u(),t.task},ValidateUnique:function(){var i=0,r,h,n=new System.Threading.Tasks.TaskCompletionSource,u,f,e,t,o,c,l,s,a,v,y=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(!this.ValidationRules.containsKey(Core.Extensions.ValidationRule.Unique)){n.setResult(null);return}if(u=this.ValidationRules.getItem(Core.Extensions.ValidationRule.Unique),u==null||Core.Extensions.StringExt.IsNullOrWhiteSpace(this._text)){n.setResult(null);return}if(f=this.GuiInfo.FieldName,e=Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField]),t=(o=u.Condition,o!=null?o:System.String.format("Active eq true and ",null)),t=System.Nullable.gt(e,0)?(t||"")+(System.String.format("{0} eq '{1}' and Id ne {2}",f,Core.Extensions.Utils.EncodeSpecialChar(this._text),Bridge.box(e,System.Int32,System.Nullable.toString,System.Nullable.getHashCode))||""):(t||"")+(System.String.format("{0} eq '{1}'",f,Core.Extensions.Utils.EncodeSpecialChar(this._text))||""),c=(l=Core.Extensions.Utils.GetEntity((s=this.EditForm.Feature.EntityId,s!=null?s:0)))!=null?l.Name:null,r=new Core.Clients.Client.$ctor1(c).GetAsync$1(System.Boolean,System.String.format("/Exists/?$select={0},{1}&$filter={2}",Core.Components.EditableComponent.IdField,f,t)),i=1,r.isCompleted())continue;r["continue"](y);return;case 1:h=r.getAwaitedResult();a=h;a?System.Collections.Generic.CollectionExtensions.TryAdd(System.String,System.String,this.ValidationResult,Core.Extensions.ValidationRule.Unique,System.String.format(u.Message,Core.Components.LangSelect.Get(this.GuiInfo.Label),this._text)):this.ValidationResult.remove(Core.Extensions.ValidationRule.Unique);n.setResult(null);return;default:n.setResult(null);return}}}catch(p){v=System.Exception.create(p);n.setException(v)}},arguments);return y(),n.task},ValidateRegEx:function(n,t){var i;if(n==null)return!0;var r=new RegExp(t),u=r.test(n),f=this.ValidationRules.getItem(Core.Extensions.ValidationRule.RegEx);return!u&&f.RejectInvalid?(i=this.Input.selectionEnd,this.Text=this._oldText,this._value=this._oldText,this.Input.selectionStart=i,this.Input.selectionEnd=i,r.test(this._oldText)):u},SetDisableUI:function(n){this.Input!=null&&(this.Input.readOnly=n);this.TextArea!=null&&(this.TextArea.readOnly=n)}}});Bridge.define("Core.Fw.Menu",{inherits:[Core.Components.EditableComponent],statics:{fields:{ActiveClass:null,ASIDE_WIDTH:null,_timeperiodToExit:0,TranslateY50:null,_main:null,_instance:null,_lastTimeBackPress:null},props:{Instance:{get:function(){return Core.Fw.Menu._instance==null&&(Core.Fw.Menu._instance=new Core.Fw.Menu),Core.Fw.Menu._instance}}},ctors:{init:function(){this._lastTimeBackPress=System.DateTime.getDefaultValue();this.ActiveClass="active";this.ASIDE_WIDTH="44px";this._timeperiodToExit=2e3;this.TranslateY50="translateY(-50%)"}},methods:{PressToExit:function(){if(typeof navigator.app!="undefined"){var n=System.DateTime.subdd(System.DateTime.getNow(),Core.Fw.Menu._lastTimeBackPress);if(n.getTotalMilliseconds()<2e3){navigator.app.exitApp();return}Core.Fw.Menu._lastTimeBackPress=System.DateTime.getNow();Core.Extensions.Toast.Small("Bấm quay lại 2 lần để thoát",1e3)}},AlterPositionSubMenu:function(n,t){var i,r;t!=null&&(i=Bridge.as(t.querySelector(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.ul)),HTMLElement),i!=null)&&(i.style.top=System.Single.format(n-20)+(Core.Extensions.Utils.Pixel||""),i.style.bottom=null,i.style.transform=null,r=Core.Extensions.HtmlElementExtension.OutOfViewport(i),r.Bottom&&(i.style.top=null,i.style.bottom=System.Single.format(document.body.clientHeight-n)+(Core.Extensions.Utils.Pixel||""),r=Core.Extensions.HtmlElementExtension.OutOfViewport(i),r.Top&&(i.style.top="50%",i.style.bottom=null,i.style.transform=Core.Fw.Menu.TranslateY50)))},OpenFeature:function(n){var r=0,u,s,i=new System.Threading.Tasks.TaskCompletionSource,f,e,o,t,h,c=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(n==null||n.ViewClass==null&&n.Entity==null){i.setResult(null);return}if(u=Core.Components.Extensions.ComponentExt.LoadFeatureByName(n.Name),r=1,u.isCompleted())continue;u["continue"](c);return;case 1:s=u.getAwaitedResult();n=s;f=n.ViewClass!=null?Bridge.Reflection.getType(n.ViewClass):Core.Components.Forms.TabEditor;e=(n.Name||"")+n.Id;o=System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs,Core.Components.Forms.TabEditor).firstOrDefault(function(n){return Bridge.referenceEquals(n.Id,e)},null);o!=null?o.Focus():(t=Bridge.as(Bridge.createInstance(f),Core.Components.Forms.EditForm),t.Name=n.Name,t.Id=e,t.Icon=n.Icon,t.Feature=n,t.Render());Core.Components.EditableComponent.IsSmallUp||(Core.Fw.Menu.Instance.Show=!1);i.setResult(null);return;default:i.setResult(null);return}}}catch(l){h=System.Exception.create(l);i.setException(h)}},arguments);return c(),i.task}}},fields:{_feature:null,_hasRender:!1,_btnBack:null,_btnToggle:null},props:{Show:{get:function(){return Bridge.ensureBaseProperty(this,"Show").$Core$Components$EditableComponent$Show},set:function(n){Bridge.ensureBaseProperty(this,"Show").$Core$Components$EditableComponent$Show=n;n?this.ShowAside():this.HideAside()}}},ctors:{ctor:function(){this.$initialize();Core.Components.EditableComponent.ctor.call(this,null)}},methods:{BuildFeatureTree:function(){var n,r=System.Linq.Enumerable.from(this._feature,Core.Models.Feature).where(function(n){return n.IsMenu}).toDictionary(function(n){return n.Id},null,System.Int32,Core.Models.Feature),t,i;n=Bridge.getEnumerator(r.Values);try{while(n.moveNext())t=n.Current,t.ParentId!=null&&r.containsKey(System.Nullable.getValue(t.ParentId))&&(i=r.getItem(System.Nullable.getValue(t.ParentId)),i.InverseParent==null?i.InverseParent=new(System.Collections.Generic.List$1(Core.Models.Feature).ctor):System.Array.add(i.InverseParent,t,Core.Models.Feature))}finally{Bridge.is(n,System.IDisposable)&&n.System$IDisposable$Dispose()}this._feature=System.Linq.Enumerable.from(this._feature,Core.Models.Feature).where(function(n){return n.ParentId==null&&n.IsMenu}).toList(Core.Models.Feature)},ReloadMenu:function(n){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,i,u,r=new System.Threading.Tasks.TaskCompletionSource,f,e,o,s,h=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(f=new Core.Clients.Client.$ctor1("Feature",Bridge.Reflection.getTypeNamespace(Core.Models.Feature)).GetRawList(Core.Models.Feature,"?$expand=Entity($select=Name)&$filter=Active eq true and IsMenu eq true&$orderby=Order"),i=f,t=1,i.isCompleted())continue;i["continue"](h);return;case 1:u=i.getAwaitedResult();e=u;this._feature=e;this.BuildFeatureTree();Core.MVVM.Html.Take$1(".sidebar-items").Clear();this.RenderMenuItems(this._feature);Bridge.staticEquals(o=this.DOMContentLoaded,null)?null:o();n!=null&&this.FocusFeature(System.Nullable.getValue(n));r.setResult(null);return;default:r.setResult(null);return}}}catch(c){s=System.Exception.create(c);r.setException(s)}},arguments);return h(),r.task}))},Render:function(){var n;this._hasRender||(this._hasRender=!0,this.RenderLayout(),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i,y,r,u=new System.Threading.Tasks.TaskCompletionSource,o,p,s,f,c,h,l,a,v,e=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5],n);switch(n){case 0:if(o=new Core.Clients.Client.$ctor1("Feature").GetRawList(Core.Models.Feature,"?$expand=Entity($select=Name)&$filter=Active eq true and IsMenu eq true&$orderby=Order"),p=Bridge.toArray(Core.Clients.Client.Token.RoleIds).join("\\"),s=new Core.Clients.Client.$ctor1("UserSetting").GetRawList(Core.Models.UserSetting,"?$filter=Name eq 'StartApp'"),t=System.Threading.Tasks.Task.whenAll(o,s),n=1,t.isCompleted())continue;t["continue"](e);return;case 1:if(t.getAwaitedResult(),f=o.getResult(),c=System.Linq.Enumerable.from(Core.Extensions.IEnumerableExtensions.Combine$1(Core.Models.UserSetting,System.String,s.getResult(),function(n){return n.Value}).split(","),System.String).select(function(n){var t;return t=Core.Extensions.Utils.TryParseInt(n),t!=null?t:0}).distinct(),this._feature=f,this.BuildFeatureTree(),Core.MVVM.Html.Take$1(".sidebar-items"),this.RenderMenuItems(this._feature),i=Core.Extensions.IEnumerableExtensions.ForEachAsync(Core.Models.Feature,System.Linq.Enumerable.from(f,Core.Models.Feature).where(function(n){return c.contains(n.Id)||n.StartUp}),Core.Fw.Menu.OpenFeature),n=2,i.isCompleted())continue;i["continue"](e);return;case 2:if(y=i.getAwaitedResult(),h=System.String.replaceAll(Core.Extensions.Utils.GetUrlParam(Core.Extensions.Utils.FeatureField),"-"," "),!Core.Extensions.StringExt.IsNullOrWhiteSpace(h)){n=3;continue}n=5;continue;case 3:if(l=System.Linq.Enumerable.from(f,Core.Models.Feature).firstOrDefault(function(n){return Bridge.referenceEquals(n.Name,h)},null),r=Core.Fw.Menu.OpenFeature(l),n=4,r.isCompleted())continue;r["continue"](e);return;case 4:r.getAwaitedResult();n=5;continue;case 5:Bridge.staticEquals(a=this.DOMContentLoaded,null)?null:a();u.setResult(null);return;default:u.setResult(null);return}}}catch(w){v=System.Exception.create(w);u.setException(v)}},arguments);return e(),u.task})),this._btnBack=document.getElementById("btnBack"),this._btnToggle=(n=HTMLElement,System.Linq.Enumerable.from(document.getElementsByClassName("sidebar-toggle"),n).ToArray(n)),this._btnBack!=null)&&(this._btnBack.addEventListener("click",Bridge.fn.cacheBind(this,this.RoutingHandler)),this._btnToggle.forEach(Bridge.fn.bind(this,function(n){n.addEventListener("click",Bridge.fn.bind(this,function(){this.Show=!this.Show}))})))},RoutingHandler:function(){Core.Fw.Menu.PressToExit();var n;(n=Core.Components.Forms.TabEditor.ActiveTab)!=null&&n.DirtyCheckAndCancel()},RenderLayout:function(){Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Aside,"sidebar").Div,"sidebar-header").End.Div,"sidebar-items"),-1).Event("focusout",Bridge.fn.bind(this,function(){this.HideAll(this.Element)})).End.Render();this.Element=Core.MVVM.Html.Context;this.AlterMainSectionWidth();document.body.insertBefore(this.Element,document.body.firstChild)},HideAll:function(n){n===void 0&&(n=null);n==null&&(n=document.body);var t=n.querySelectorAll("li.active");Core.Extensions.IEnumerableExtensions.ForEach(Node,t,function(n){Core.Extensions.HtmlElementExtension.RemoveClass(n,Core.Fw.Menu.ActiveClass)})},AlterMainSectionWidth:function(){Core.Fw.Menu._main=document.querySelector("#main");this.Element.tabIndex=-1;this.Element.focus();this.Element.addEventListener("focusout",Bridge.fn.bind(this,function(){this.Show=Core.Components.EditableComponent.IsSmallUp}));this.Show=Core.Components.EditableComponent.IsSmallUp},ShowAside:function(){this.Element.style.left="0";Core.Fw.Menu._main.style.left=Core.Fw.Menu.ASIDE_WIDTH;Core.Components.EditableComponent.IsSmallUp?Core.Fw.Menu._main.style.width=System.String.format("calc(100% - {0})",[Core.Fw.Menu.ASIDE_WIDTH]):(Core.Fw.Menu._main.style.width="100%",Core.Fw.Menu._main.style.left="0")},HideAside:function(){this.Element.style.left=System.String.format("-{0}",[Core.Fw.Menu.ASIDE_WIDTH]);Core.Fw.Menu._main.style.width="100%";Core.Fw.Menu._main.style.left="0"},RenderMenuItems:function(n,t){t===void 0&&(t=!1);Core.MVVM.Html.Instance.Ul.ForEach$2(Core.Models.Feature,n,Bridge.fn.bind(this,function(n){var i;n.IsGroup?Core.Components.Renderer.Title(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Li,"group-title"),n.Label).End.Render():n.IsDevider?Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Li,"divider").End.Render():(Core.Components.Renderer.IText(Core.Components.Renderer.Title(Core.Components.Renderer.Icon(Core.MVVM.Html.Instance.Li.DataAttr$1("feature",Bridge.toString(n.Id)).A.Attr$1("data-role","ripple").AsyncEvent$3(Core.Models.Feature,"click",Bridge.fn.cacheBind(this,this.MenuItemClick),n).Event$4(Core.Models.Feature,"contextmenu",Bridge.fn.cacheBind(this,this.FeatureContextMenu),n),n.Icon).End,n.Label),t?n.Label:null).EndOf(Core.MVVM.ElementType.a).Render(),n.InverseParent!=null&&System.Array.getCount(n.InverseParent,Core.Models.Feature)>0&&this.RenderMenuItems((i=Core.Models.Feature,System.Linq.Enumerable.from(n.InverseParent,i).toList(i)),!0))}))},FindMenuItemByID:function(n){var t,r=document.querySelectorAll(".sidebar-items li"),i;t=Bridge.getEnumerator(r,"getEnumerator");try{while(t.moveNext())if(i=Bridge.cast(t.Current,HTMLElement),System.String.equals(i.getAttribute("data-feature"),Bridge.toString(n)))return i}finally{Bridge.is(t,System.IDisposable)&&t.System$IDisposable$Dispose()}return null},FeatureContextMenu:function(n,t){if(Core.Clients.Client.SystemRole){n.preventDefault();var i=Core.Components.Forms.ContextMenu.Instance;i.Top=Core.Extensions.EventExt.Top(n);i.Left=Core.Extensions.EventExt.Left(n);i.MenuItems=Bridge.fn.bind(this,function(n){var i;return n.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fa fa-plus",i.Text="New feature",i.Click=Bridge.fn.cacheBind(this,this.EditFeature),i.Parameter=new Core.Models.Feature,i)),n.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="mif-unlink",i.Text="Deactivate this feature",i.Click=Bridge.fn.cacheBind(this,this.Deactivate),i.Parameter=t,i)),n.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fa fa-clone",i.Text="Clone this feature",i.Click=Bridge.fn.cacheBind(this,this.CloneFeature),i.Parameter=t,i)),n.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fa fa-list",i.Text="Manage features",i.Click=Bridge.fn.cacheBind(this,this.FeatureManagement),i)),n.add((i=new Core.Components.Forms.ContextMenuItem,i.Icon="fa fa-wrench",i.Text="Properties",i.Click=Bridge.fn.cacheBind(this,this.EditFeature),i.Parameter=t,i)),n})(new(System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem).ctor));i.Render()}},EditFeature:function(n){var t=Bridge.as(n,Core.Models.Feature),i=(t.Name||"")+"Prop"+t.Id;Core.Components.Extensions.ComponentExt.OpenTab(this,i,function(){var n,r,u;return n=new Core.Components.Framework.FeatureDetailBL,n.Id=i,n.Entity=t,n.Title=System.String.format("Feature {0}",[(r=t.Name,r!=null?r:(u=t.Label,u!=null?u:t.Description))]),n})},CloneFeature:function(n){var t,r=Bridge.as(n,Core.Models.Feature),i=(t=new Core.Components.Forms.ConfirmDialog,t.Content="Bạn có muốn clone feature này?",t);i.YesConfirmed=Bridge.fn.combine(i.YesConfirmed,Bridge.fn.bind(this,function(){var n=0,t,f,i,u=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(i=new Core.Clients.Client.$ctor1("Feature",Bridge.Reflection.getTypeNamespace(Core.Models.Feature)),t=i.CloneFeatureAsync(r.Id),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:f=t.getAwaitedResult();this.ReloadMenu(r.ParentId);return;default:return}}},arguments);u()}));this.AddChild(i)},FeatureManagement:function(){var n=Bridge.toString(Bridge.getHashCode(this));Core.Components.Extensions.ComponentExt.OpenTab(this,n,Bridge.fn.bind(this,function(){var n;return n=new Core.Components.Framework.FeatureBL,n.Id=Bridge.toString(Bridge.getHashCode(this)),n}))},Deactivate:function(n){var i=Bridge.as(n,Core.Models.Feature),t=new Core.Components.Forms.ConfirmDialog;t.Content="Bạn có muốn deactivate feature này?";t.YesConfirmed=Bridge.fn.combine(t.YesConfirmed,Bridge.fn.bind(this,function(){var n=0,t,f,r,u=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=new Core.Clients.Client.$ctor1("Feature"),t=r.DeactivateAsync(function(n){return n.add(i.Id),n}(new(System.Collections.Generic.List$1(System.Int32).ctor))),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:f=t.getAwaitedResult();return;default:return}}},arguments);u()}));this.AddChild(t)},MenuItemClick:function(n,t){var r=0,u,f=new System.Threading.Tasks.TaskCompletionSource,i,e,o,s=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(i=Bridge.as(t.target,HTMLElement),Bridge.is(i,HTMLLIElement)||(i=Bridge.as(Core.Extensions.HtmlElementExtension.Closest(i,"li"),HTMLLIElement)),this.HideAll(i.parentElement.parentElement),i.focus(),Core.Extensions.HtmlElementExtension.AddClass(i,Core.Fw.Menu.ActiveClass),(e=Core.Extensions.HtmlElementExtension.Closest(i,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.li)))!=null?Core.Extensions.HtmlElementExtension.AddClass(e,Core.Fw.Menu.ActiveClass):null,Core.Fw.Menu.AlterPositionSubMenu(Core.Extensions.EventExt.Top(t),i),u=Core.Fw.Menu.OpenFeature(n),r=1,u.isCompleted())continue;u["continue"](s);return;case 1:u.getAwaitedResult();f.setResult(null);return;default:f.setResult(null);return}}}catch(h){o=System.Exception.create(h);f.setException(o)}},arguments);return s(),f.task},FocusFeature:function(n){var t,i=this.FindMenuItemByID(n),u,r;if(i!=null){u=document.querySelectorAll(".sidebar-items li.active");t=Bridge.getEnumerator(u,"getEnumerator");try{while(t.moveNext())(r=Bridge.cast(t.Current,HTMLElement),r.contains(i))||Core.Extensions.HtmlElementExtension.RemoveClass(r,"active")}finally{Bridge.is(t,System.IDisposable)&&t.System$IDisposable$Dispose()}Core.Extensions.HtmlElementExtension.AddClass(i,Core.Fw.Menu.ActiveClass);Core.Extensions.HtmlElementExtension.AddClass(i.parentElement,Core.Fw.Menu.ActiveClass)}},RemoveDOM:function(){Core.MVVM.Html.Take$1(".sidebar-wrapper").Clear()},UpdateView:function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[])}}});Bridge.define("Core.Notifications.NotificationBL",{inherits:[Core.Components.EditableComponent],statics:{fields:{_instance:null,_countNtf:null},props:{Notifications:null,Instance:{get:function(){return Core.Notifications.NotificationBL._instance==null&&(Core.Notifications.NotificationBL._instance=new Core.Notifications.NotificationBL),Core.Notifications.NotificationBL._instance}}}},fields:{_profile:null,_task:null,_countBadge:null},props:{CurrentUser:null},ctors:{ctor:function(){this.$initialize();Core.Components.EditableComponent.ctor.call(this,null);Core.Notifications.NotificationBL.Notifications=new(Core.MVVM.ObservableList$1(Core.Models.TaskNotification).ctor);Core.Notifications.NotificationBL._countNtf=new(Core.MVVM.Observable$1(System.String).ctor);Core.Components.Forms.EditForm.NotificationClient!=null?Core.Components.Forms.EditForm.NotificationClient.AddListener$1("TaskNotification",Core.Enums.TypeEntityAction.Message,Bridge.fn.cacheBind(this,this.ProcessIncomMessage)):null}},methods:{ProcessIncomMessage:function(n){var u=this,i,r,t,f,e;n!=null&&(t=Bridge.cast(n,Core.Models.TaskNotification),t!=null)&&(f=System.Linq.Enumerable.from(Core.Notifications.NotificationBL.Notifications.Data,Core.Models.TaskNotification).firstOrDefault(function(n){return n.Id===t.Id},null),f==null&&(Core.Notifications.NotificationBL.Notifications.Add(t,0),this.ToggleBageCount(System.Linq.Enumerable.from(Core.Notifications.NotificationBL.Notifications.Data,Core.Models.TaskNotification).count(function(n){return System.Nullable.eq(n.StatusId,Core.Enums.TaskStateEnum.UnreadStatus)})),this.PopupNotification(t)),this.SetBadgeNumber(),e=Core.Extensions.Utils.GetEntity((i=t.EntityId,i!=null?i:0)),t.Entity=(r=new Core.Models.Entity,r.Name=e.Name,r),typeof Notification!="undefined"&&Notification.permission==="granted"?this.ShowNativeNtf(t):typeof Notification!="undefined"&&Notification.permission!=="denied"?Notification.requestPermission().then(function(n){n!=="granted"?u.ShowToast(t):u.ShowNativeNtf(t)}):this.ShowToast(t))},SetBadgeNumber:function(){var n=System.Linq.Enumerable.from(Core.Notifications.NotificationBL.Notifications.Data,Core.Models.TaskNotification).count(function(n){return System.Nullable.eq(n.StatusId,Core.Enums.TaskStateEnum.UnreadStatus)}),t;return Core.Notifications.NotificationBL._countNtf.Data=n>9?"9+":Bridge.toString(n),t=n>9?9:n,typeof cordova!="undefined"&&typeof cordova.plugins!="undefined"&&typeof cordova.plugins.notification!="undefined"&&cordova.plugins.notification.badge.requestPermission(function(){cordova.plugins.notification.badge.set(n)}),t},ShowNativeNtf:function(n){var i=this,t;n!=null&&(t=null,t=new Notification(n.Title,{body:n.Description,icon:n.Attachment,vibrate:[200,100,200],badge:"./favicon.ico"}),t.addEventListener("click",function(){return i.OpenNotification(n)}),window.setTimeout(function(){t.close()},7e3))},ShowToast:function(n){Core.Extensions.Toast.Success(System.String.format("Thông báo từ hệ thống <br /> {0} - {1}",n.Title,n.Description))},Render:function(){System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this,this.RenderAsync))},RenderAsync:function(){var n=0,t,r,i=new System.Threading.Tasks.TaskCompletionSource,u,f,e=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(Core.MVVM.Html.Take$1("#notification").Clear(),t=new Core.Clients.Client.$ctor1("TaskNotification").GetRawList(Core.Models.TaskNotification,System.String.format("?$expand=Entity&$orderby=InsertedDate desc&$top=50",null)),n=1,t.isCompleted())continue;t["continue"](e);return;case 1:r=t.getAwaitedResult();u=r;Core.Notifications.NotificationBL.Notifications.Data=u;this.SetBadgeNumber();this.CurrentUser=Core.Clients.Client.Token;this.CurrentUser.Avatar=(Core.Clients.Client.Origin||"")+((Core.Extensions.StringExt.IsNullOrWhiteSpace(this.CurrentUser.Avatar)?"./image/chinese.jfif":this.CurrentUser.Avatar)||"");this.RenderNotification();this.RenderProfile();i.setResult(null);return;default:i.setResult(null);return}}}catch(o){f=System.Exception.create(o);i.setException(f)}},arguments);return e(),i.task},RenderProfile:function(){var n,t,i=Core.MVVM.Html.Instance,r;Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take$1("#notification .app-bar-container").A,"app-bar-item").Event("click",Bridge.fn.cacheBind(this,this.ShowProfile)).Img.Src(this.CurrentUser.Avatar).Attr$1("alt","Avatar"),"user-image").Id("user-image").End.Span,"hidden-xs").Id("name-user").Text(this.CurrentUser.FullName).EndOf(Core.MVVM.ElementType.a);Core.Components.Renderer.ClassName(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(i.Div,"pos-relative fix-pos-relative shadow"),-1).Div,"fg-black");this._profile=Core.MVVM.Html.Context.parentElement;this._profile.style.display="none";this._profile.addEventListener("focusout",Bridge.fn.bind(this,function(){this._profile.style.display="none"}));Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(i.Ul,"ul-Warning").Li,"user-header").Img.Src(this.CurrentUser.Avatar).Attr$1("alt","Avatar"),"img-circle").Id("img-detail").End.P.Id("Username-text").Text(System.String.format("{0} {1}",Core.Clients.Client.Token.TenantCode,this.CurrentUser.FullName)).End.Span.Id("text-address").Text((n=this.CurrentUser.Address,n!=null?n:"")).End.EndOf$1(".user-header").Li,"user-footer").Span.AsyncEvent$1("click",Bridge.fn.cacheBind(this,this.ViewProfile)),"Trang cá nhân").EndOf(Core.MVVM.ElementType.span);r=(t=new Core.Components.LangSelect(null,null),t.ParentElement=Core.MVVM.Html.Context,t);r.Render();Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(i.Span,"pull-right").AsyncEvent$1("click",Bridge.fn.cacheBind(this,this.SignOut)),"Đăng xuất")},ShowProfile:function(){this._profile.style.display="block";this._profile.focus()},SignOut:function(n){var t=0,i,s,r,u=new System.Threading.Tasks.TaskCompletionSource,e,o,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2],t);switch(t){case 0:if(n.preventDefault(),e=new Core.Clients.Client.$ctor1("User"),i=e.CreateAsync(System.Boolean,Core.Clients.Client.Token,"SignOut"),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:if(s=i.getAwaitedResult(),Bridge.staticEquals(Core.Clients.Client.SignOutEventHandler,null)?null:Core.Clients.Client.SignOutEventHandler(),Core.Clients.Client.Token=null,Core.Components.Forms.EditForm.NotificationClient!=null?Core.Components.Forms.EditForm.NotificationClient.Close():null,r=System.Threading.Tasks.Task.delay(1e3),t=2,r.isCompleted())continue;r["continue"](f);return;case 2:r.getAwaitedResult();window.location.reload();u.setResult(null);return;default:u.setResult(null);return}}}catch(h){o=System.Exception.create(h);u.setException(o)}},arguments);return f(),u.task},ViewProfile:function(n){var t=0,i,e,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(n.preventDefault(),i=Core.Components.Extensions.ComponentExt.OpenTab$1(this,"User"+Core.Clients.Client.Token.UserId,"UserProfile",function(){var n=Bridge.Reflection.getType("Core.Fw.User.UserProfileBL");return Bridge.as(Bridge.createInstance(n),Core.Components.Forms.TabEditor)},!1,!1),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:e=i.getAwaitedResult();this.Dispose();r.setResult(null);return;default:r.setResult(null);return}}}catch(o){u=System.Exception.create(o);r.setException(u)}},arguments);return f(),r.task},RenderNotification:function(){var n=Core.Components.Renderer.ClassName(Core.MVVM.Html.Take$1("#notification").Div,"app-bar-container");Core.Components.Renderer.ClassName(n.A,"app-bar-item").Event("click",Bridge.fn.cacheBind(this,this.ToggleNotification));Core.Components.Renderer.ClassName(n.Span,"fas fa-bell");Core.Components.Renderer.ClassName(n.Span,"badge bg-orange fg-white").Id("span-count").Text$1(System.String,Core.Notifications.NotificationBL._countNtf);this._countBadge=Core.MVVM.Html.Context;this.ToggleBageCount(System.Linq.Enumerable.from(Core.Notifications.NotificationBL.Notifications.Data,Core.Models.TaskNotification).count(function(n){return System.Nullable.eq(n.StatusId,Core.Enums.TaskStateEnum.UnreadStatus)}));n.EndOf(Core.MVVM.ElementType.a);Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(n.Div,"pos-relative fix-pos-relative hide shadow"),-1);this._task=Core.MVVM.Html.Context;this._task.addEventListener("focusout",Bridge.fn.bind(this,function(){this._task.style.display="none"}));n.DataAttr$1("role","dropdown");Core.Components.Renderer.ClassName(n.Div,"fg-black");Core.Components.Renderer.ClassName(n.Ul,"ul-Warning");Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(n.Li,"header1").Span.Id("span-count-liabilitiesWarning").Text$1(System.String,Core.Notifications.NotificationBL._countNtf).End," thông báo mới !").End.Render();Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(n.Li,"li-Root").Ul,"menu").ForEach(Core.Models.TaskNotification,Core.Notifications.NotificationBL.Notifications,Bridge.fn.bind(this,function(t){var i,r;t!=null&&(i=System.Nullable.eq(t.StatusId,Core.Enums.TaskStateEnum.UnreadStatus)?"task-unread":"task-read",Core.Components.Renderer.ClassName(n.Li,"task "+(i||"")),r=Core.MVVM.Html.Context,Core.Components.Renderer.ClassName(n.Div,"a-items").Event("click",Bridge.fn.bind(this,function(){var n=0,i,u=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(i=this.OpenNotification(t),n=1,i.isCompleted())continue;i["continue"](u);return;case 1:i.getAwaitedResult();Core.Extensions.HtmlElementExtension.ReplaceClass(r,"task-unread","task-read");return;default:return}}},arguments);u()})),Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(n.Div,"pull-left").I,(t.Attachment||"")+" text-red").EndOf$1(".pull-left"),Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(n.H4,"h4-items"),t.Title).End.Render(),Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(n.P,"p-warning").Text(Core.Extensions.DateTimeExt.DateString(t.Deadline)).End.P,"p-warning"),t.Description).EndOf(Core.MVVM.ElementType.li))}));Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.ul).Ul,"footer-viewall").Li.Span.Text("Xem thêm").AsyncEvent$1("click",Bridge.fn.cacheBind(this,this.SeeMore)).End.Span.Text("Đọc tất cả").AsyncEvent$1("click",Bridge.fn.cacheBind(this,this.MarkAllAsRead));Core.Notifications.NotificationBL.Notifications.Data.ForEach(Bridge.fn.cacheBind(this,this.PopupNotification))},ToggleBageCount:function(n){this._countBadge.style.display=n===0?"none":"inline-block"},PopupNotification:function(n){var u,t,o,i;if(!System.Nullable.neq(n.StatusId,Core.Enums.TaskStateEnum.UnreadStatus)&&System.Nullable.eq(n.EntityId,(u=Core.Extensions.Utils.GetEntity$1("CoordinationDetail"))!=null?u.Id:null)&&(Core.Clients.Client.CheckHasRole(Core.Enums.RoleEnum.Driver_Cont)||Core.Clients.Client.CheckHasRole(Core.Enums.RoleEnum.Driver_Truck))){n.StatusId=Core.Enums.TaskStateEnum.Read;var s=System.DateTime.subdd(System.DateTime.getNow(),n.Deadline),r={},f={},e={};Bridge.Deconstruct(Core.Extensions.DateTimeExt.ToDayHourMinute(s).$clone(),r,f,e);o=r.v>0?r.v+" ngày":"";i=(t=new Core.Components.Forms.ConfirmDialog,t.Title=System.String.format('<b>Thông báo<\/b> - <span class="text-small">{0} {1}h {2} phút trước<\/span>',o,Bridge.box(f.v,System.Int32),Bridge.box(e.v,System.Int32)),t.Content=System.String.format("{0}<br />{1}",n.Title,n.Description),t.IgnoreNoButton=!0,t.YesText="Đồng ý",t.CancelText="Đóng",t);i.YesConfirmed=Bridge.fn.combine(i.YesConfirmed,Bridge.fn.bind(this,function(){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.OpenNotification(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()}));i.Canceled=Bridge.fn.combine(i.Canceled,Bridge.fn.bind(this,function(){var t=0,i,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.MarkAsRead(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()}));i.Render()}},ToggleNotification:function(){this._task.style.display="block";this._task.focus()},SeeMore:function(){var n=0,t,f,i=new System.Threading.Tasks.TaskCompletionSource,r,e,u,o,s,h,c=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=System.Linq.Enumerable.from(Core.Notifications.NotificationBL.Notifications.Data,Core.Models.TaskNotification).lastOrDefault(null,null),e=(u=r!=null?r.InsertedDate:null,u!=null?u:System.DateTime.getNow()),t=new Core.Clients.Client.$ctor1("TaskNotification").GetRawList(Core.Models.TaskNotification,System.String.format("?$filter=InsertedDate lt {0}&$expand=Entity&$orderby=InsertedDate desc&$top=50",[Core.Extensions.DateTimeExt.ToISOFormat(e)])),n=1,t.isCompleted())continue;t["continue"](c);return;case 1:f=t.getAwaitedResult();o=f;s=System.Linq.Enumerable.from(Core.Notifications.NotificationBL.Notifications.Data,Core.Models.TaskNotification).union(o).toList(Core.Models.TaskNotification);Core.Notifications.NotificationBL.Notifications.Data=s;i.setResult(null);return;default:i.setResult(null);return}}}catch(l){h=System.Exception.create(l);i.setException(h)}},arguments);return c(),i.task},MarkAllAsRead:function(n){var t=0,i,u,r=new System.Threading.Tasks.TaskCompletionSource,f,s,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(n.preventDefault(),f=new Core.Clients.Client.$ctor1("TaskNotification"),i=f.PostAsync(System.Boolean,null,"MarkAllAsRead"),t=1,i.isCompleted())continue;i["continue"](o);return;case 1:u=i.getAwaitedResult();s=u;this.ToggleBageCount(System.Linq.Enumerable.from(Core.Notifications.NotificationBL.Notifications.Data,Core.Models.TaskNotification).count(function(n){return System.Nullable.eq(n.StatusId,Core.Enums.TaskStateEnum.UnreadStatus)}));Core.Extensions.IEnumerableExtensions.ForEach(Node,this._task.querySelectorAll(".task-unread"),function(n){Core.Extensions.HtmlElementExtension.ReplaceClass(n,"task-unread","task-read")});r.setResult(null);return;default:r.setResult(null);return}}}catch(h){e=System.Exception.create(h);r.setException(e)}},arguments);return o(),r.task},OpenNotification:function(n){var t=0,i,r,u=new System.Threading.Tasks.TaskCompletionSource,e,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2],t);switch(t){case 0:if(i=this.MarkAsRead(n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:if(i.getAwaitedResult(),r=this.OpenTaskFeature(n,this),t=2,r.isCompleted())continue;r["continue"](f);return;case 2:r.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(o){e=System.Exception.create(o);u.setException(e)}},arguments);return f(),u.task},OpenTaskFeature:function(){var t=0,n=new System.Threading.Tasks.TaskCompletionSource,i,r=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0],t);switch(t){case 0:n.setResult(null);return;default:n.setResult(null);return}}}catch(r){i=System.Exception.create(r);n.setException(i)}},arguments);return r(),n.task},RemoveDOM:function(){Core.MVVM.Html.Take$1("#notification").Clear()},MarkAsRead:function(n){var t=0,i,e,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(n.StatusId=Core.Enums.TaskStateEnum.Read,i=new Core.Clients.Client.$ctor1("TaskNotification").UpdateAsync(Core.Models.TaskNotification,n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:e=i.getAwaitedResult();this.SetBadgeNumber();r.setResult(null);return;default:r.setResult(null);return}}}catch(o){u=System.Exception.create(o);r.setException(u)}},arguments);return f(),r.task},Dispose:function(){Core.Extensions.HtmlElementExtension.AddClass(this._task,"hide")}}});Bridge.define("Core.ViewModels.SecurityVM",{inherits:[Core.Models.FeaturePolicy],props:{AllPermission:!1,RecordIds:null,StrRecordIds:{get:function(){return Bridge.toArray(this.RecordIds).join(",")}},FeaturePolicy:null}});Bridge.define("Core.ViewModels.UserProfileVM",{inherits:[Core.Models.User],props:{OldPassword:null,NewPassword:null,ConfirmedPassword:null}});Bridge.define("Core.Components.Forms.TabEditor",{inherits:[Core.Components.Forms.EditForm],statics:{fields:{ActiveClass:null,TabContainer:null,Tabs:null},props:{ActiveTab:{get:function(){return System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs,Core.Components.Forms.TabEditor).firstOrDefault(function(n){return n.Show},null)}},ShowTabText:!1},ctors:{init:function(){this.ActiveClass="active";this.TabContainer=document.getElementById("tab-content");this.Tabs=new(System.Collections.Generic.List$1(Core.Components.Forms.TabEditor).ctor)}},methods:{FindTab:function(n){return System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs,Core.Components.Forms.TabEditor).firstOrDefault(function(t){return Bridge.referenceEquals(t.Id,n)},null)}}},fields:{_backdrop:null,_backdropGridView:null,_tab:null,_li:null,_hotKeyComponents:null},props:{Popup:!1,ChildForm:!1,TabTitle:{get:function(){var n,t;return n=(t=this.Feature)!=null?t.Label:null,n!=null?n:this.Title}},Show:{get:function(){return Bridge.ensureBaseProperty(this,"Show").$Core$Components$EditableComponent$Show},set:function(n){(Bridge.ensureBaseProperty(this,"Show").$Core$Components$EditableComponent$Show=n,this._li!=null)&&(n?(Core.Extensions.HtmlElementExtension.AddClass(this._li,Core.Components.Forms.TabEditor.ActiveClass),Core.Extensions.HtmlElementExtension.AddClass(this._li.querySelector(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.a)),Core.Components.Forms.TabEditor.ActiveClass),this.Element.focus()):(Core.Extensions.HtmlElementExtension.RemoveClass(this._li,Core.Components.Forms.TabEditor.ActiveClass),Core.Extensions.HtmlElementExtension.RemoveClass(this._li.querySelector(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.a)),Core.Components.Forms.TabEditor.ActiveClass)))}}},ctors:{ctor:function(n){this.$initialize();Core.Components.Forms.EditForm.ctor.call(this,n);this.PopulateDirty=!1;this.ShouldLoadEntity=!0}},methods:{Render:function(){var n;this.ParentElement!=null||this.ChildForm||(this.ParentElement=((n=this.TabEditor)!=null?n.Element:null)||Core.Components.Forms.TabEditor.TabContainer);this.Popup?this.RenderPopup():this.RenderTab();this.Focus()},RenderTab:function(){var n,t;if(this.ChildForm){Core.MVVM.Html.Take(this.ParentElement).Div.Render();this.Element=Core.MVVM.Html.Context;Core.Components.Forms.EditForm.prototype.Render.call(this);return}n=Core.MVVM.Html.Take$1("#tabs");Core.Components.Renderer.ClassName(Core.Components.Renderer.Title(Core.Components.Renderer.ClassName(n.Li,"nav-item"),this.TabTitle).A,"nav-link pl-lg-2 pr-lg-2 pl-xl-3 pr-xl-3").Event("click",Bridge.fn.cacheBind(this,this.Focus)).Event$1("mouseup",Bridge.fn.cacheBind(this,this.Close));Core.Extensions.StringExt.IsNullOrWhiteSpace(this.Icon)||Core.Components.Renderer.Icon(n,this.Icon).End.Render();Core.Components.Renderer.Icon(n,"fa fal fa-compress-wide").Event$1("click",Bridge.fn.bind(this,function(){this.FullScreen()})).End.Render();Core.Components.Renderer.Icon(n,"fa fa-times").Event$1("click",Bridge.fn.bind(this,function(n){n.stopPropagation();this.DirtyCheckAndCancel()})).End.Render();Core.Components.Forms.TabEditor.ShowTabText&&Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(n.Span,"title"),this.TabTitle).End.Render();this._li=Core.MVVM.Html.Context.parentElement;this.IconElement=this._li.firstElementChild;Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(Core.Components.Forms.TabEditor.TabContainer).Div,-1).Trigger("focus").Event$1("keydown",Bridge.fn.cacheBind(this,this.HotKeyHandler)).Render();this.Element=Core.MVVM.Html.Context;this.ParentElement=Core.Components.Forms.TabEditor.TabContainer;Core.Components.Forms.TabEditor.Tabs.add(this);t=System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs,Core.Components.Forms.TabEditor).select(function(n){return n.Name}).toList(System.String);window.localStorage.setItem("tabs",Core.Extensions.IEnumerableExtensions.Combine(System.String,t));Core.Components.Forms.EditForm.prototype.Render.call(this)},FullScreen:function(){var n=this.Element;n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()},RenderPopup:function(){var n,t;Bridge.is(this.Parent,Core.Components.GridView)?(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement||((n=this.Parent)!=null?n.Element:null)||Core.Components.Forms.TabEditor.TabContainer).Div,"backdrop-gridview"),-1).Trigger("focus").Event$1("keydown",Bridge.fn.cacheBind(this,this.HotKeyHandler)),this._backdropGridView=Core.MVVM.Html.Context,Core.Components.Renderer.IconForSpan(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"popup-content").Div,"popup-title").Span,this.Icon),this.IconElement=Core.MVVM.Html.Context,Core.Components.Renderer.IText(Core.MVVM.Html.Instance.End.Span,this.Title),this.TitleElement=Core.MVVM.Html.Context,Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div,"icon-box").Span,"fa fa-times").Event("click",Bridge.fn.cacheBind(this,this.Dispose)).EndOf$1(".popup-title").Div,"popup-body"),this.Element=Core.MVVM.Html.Context,Core.Components.Forms.EditForm.prototype.Render.call(this),Core.Extensions.HtmlElementExtension.OutOfViewport(this._backdropGridView).Top&&this._backdropGridView.scrollIntoView(!0)):(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement||((t=this.Parent)!=null?t.Element:null)||Core.Components.Forms.TabEditor.TabContainer).Div,"backdrop"),-1).Trigger("focus").Event$1("keydown",Bridge.fn.cacheBind(this,this.HotKeyHandler)),this._backdrop=Core.MVVM.Html.Context,Core.Components.Renderer.IconForSpan(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"popup-content").Div,"popup-title").Span,this.Icon),this.IconElement=Core.MVVM.Html.Context,Core.Components.Renderer.IText(Core.MVVM.Html.Instance.End.Span,this.Title),this.TitleElement=Core.MVVM.Html.Context,Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div,"icon-box").Span,"fa fa-times").Event("click",Bridge.fn.cacheBind(this,this.Dispose)).EndOf$1(".popup-title").Div,"popup-body"),this.Element=Core.MVVM.Html.Context,Core.Components.Forms.EditForm.prototype.Render.call(this),Core.Extensions.HtmlElementExtension.OutOfViewport(this._backdrop).Top&&this._backdrop.scrollIntoView(!0))},HotKeyHandler:function(n){var u,t,r,i;if(n.keyCode!=null){if(t=Core.Extensions.EventExt.KeyCodeEnum(n),System.Nullable.eq(t,Core.Enums.KeyCodeEnum.F6)){r=System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.GridView,this),Core.Components.GridView).firstOrDefault(null,null);r==null||System.Linq.Enumerable.from(r.AllListViewItem,Core.Components.ListViewItem).any(function(n){return n.Selected})||(System.Linq.Enumerable.from(r.AllListViewItem,Core.Components.ListViewItem).any()?System.Linq.Enumerable.from(r.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(null,null).Focus():r.ListViewSearch.Focus());return}if(Core.Extensions.EventExt.AltKey(n)&&System.Nullable.eq(t,Core.Enums.KeyCodeEnum.GraveAccent)){if(Core.Components.Forms.TabEditor.Tabs.Count<=1)return;if(i=Core.Components.Forms.TabEditor.Tabs.indexOf(this),i=i>=(Core.Components.Forms.TabEditor.Tabs.Count-1|0)?0:i+1|0,i<0||i>Core.Components.Forms.TabEditor.Tabs.Count)return;(u=System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs,Core.Components.Forms.TabEditor).elementAt(i))!=null?u.Focus():null}var f=Core.Extensions.EventExt.ShiftKey(n),e=Core.Extensions.EventExt.CtrlOrMetaKey(n),o=Core.Extensions.EventExt.AltKey(n),s=this.DefaultHotKeys(t,f,e,o);if(s){n.preventDefault();n.stopPropagation();return}System.Nullable.gte(t,Core.Enums.KeyCodeEnum.Shift)&&System.Nullable.lte(t,Core.Enums.KeyCodeEnum.Alt)||this.TriggerMatchHotKey(n,t,f,e,o)}},DisposeTabView:function(){Core.Extensions.HtmlElementExtension.Hide(this._tab)},TriggerMatchHotKey:function(n,t,i,r,u){var e,h,f,o,s;if(t!=null){f=new(System.Collections.Generic.List$1(Core.Enums.KeyCodeEnum).ctor);i&&f.add(Core.Enums.KeyCodeEnum.Shift);r&&f.add(Core.Enums.KeyCodeEnum.Ctrl);u&&f.add(Core.Enums.KeyCodeEnum.Alt);System.Nullable.lt(t,Core.Enums.KeyCodeEnum.Shift)?f.insert(0,System.Nullable.getValue(t)):System.Nullable.gt(t,Core.Enums.KeyCodeEnum.Alt)&&f.add(System.Nullable.getValue(t));this._hotKeyComponents=this._hotKeyComponents||System.Linq.Enumerable.from(this.FilterChildren$1(function(n){return Bridge.is(n,Core.Components.Button)&&!Core.Extensions.StringExt.IsNullOrWhiteSpace(n.GuiInfo.HotKey)})).select(function(n){return Bridge.cast(n,Core.Components.Button)}).toList(Core.Components.Button);e=Bridge.getEnumerator(this._hotKeyComponents);try{while(e.moveNext())if(o=e.Current,s=o.GuiInfo.HotKey.split(","),!Core.Extensions.IEnumerableExtensions.Nothing(System.String,s)){var c=System.Linq.Enumerable.from(s,System.String).lastOrDefault(null,null),l=System.Linq.Enumerable.from(c.split("-"),System.String).select(function(n){var t={v:new Core.Enums.KeyCodeEnum},i=System.Enum.tryParse(Core.Enums.KeyCodeEnum,n,t);return i?Bridge.cast(t.v,System.Int32,!0):null}).where(function(n){return n!=null}).select(function(n){return Bridge.cast(n,Core.Enums.KeyCodeEnum)}).orderBy(function(n){return n}),a=System.Linq.Enumerable.from(f,Core.Enums.KeyCodeEnum).sequenceEqual(l);if(a){n.preventDefault();n.stopPropagation();(h=o.Element)!=null?h.click():null;return}}}finally{Bridge.is(e,System.IDisposable)&&e.System$IDisposable$Dispose()}}},DefaultHotKeys:function(n,t,i,r){var e,u,f;if(n==null)return!1;if(!System.Nullable.eq(n,Core.Enums.KeyCodeEnum.Escape)||t||i||r){if(i&&r&&(System.Nullable.eq(n,Core.Enums.KeyCodeEnum.LeftArrow)||System.Nullable.eq(n,Core.Enums.KeyCodeEnum.RightArrow)))return(u=Core.Components.Forms.TabEditor.Tabs.indexOf(this),u=System.Nullable.eq(n,Core.Enums.KeyCodeEnum.LeftArrow)?u===0?Core.Components.Forms.TabEditor.Tabs.Count-1|0:u-1|0:u>=(Core.Components.Forms.TabEditor.Tabs.Count-1|0)?0:u+1|0,u<0||u>Core.Components.Forms.TabEditor.Tabs.Count)?!1:((e=System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs,Core.Components.Forms.TabEditor).elementAt(u))!=null?e.Focus():null,!0);if(i&&t&&System.Nullable.eq(n,Core.Enums.KeyCodeEnum.F))return(f=System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.ListView,this),Core.Components.ListView).firstOrDefault(null,null),f==null||!f.GuiInfo.CanSearch)?!0:(f.ListViewSearch.AdvancedSearch(null),!0)}else return this.DirtyCheckAndCancel(),!0;return!1},Focus:function(){this.Popup||this.ChildForm||Core.Components.Forms.TabEditor.Tabs.ForEach(function(n){n.Show=!1});this.ChildForm||(this.Show=!0);this.Feature==null||this.Feature.Name==null||this.Popup||this.ChildForm||window.history.replaceState(null,Core.Components.LangSelect.Get(this.TabTitle),(window.location.origin||"")+"/"+(System.String.replaceAll(this.Feature.Name," ","-")||"")+(System.String.format("{0}",[this.Feature.IsMenu?"":System.String.format("?Id={0}",[Bridge.box(System.Int32.parse(Bridge.toString(this.Entity[Core.Components.EditableComponent.IdField])),System.Int32)])])||""));document.title=Core.Components.LangSelect.Get(this.TabTitle);Core.Components.Forms.EditForm.prototype.Focus.call(this);window.dispatchEvent(new Event(System.Enum.toString(System.String,"resize")))},Close:function(n){var i,r,u={},t;System.Int32.tryParse((i=n.which)!=null?Bridge.toString(i):null,u);t={};System.Int32.tryParse((r=n.button)!=null?Bridge.toString(r):null,t);(u.v===2||t.v===1)&&(n.preventDefault(),this.DirtyCheckAndCancel())},Dispose:function(){this.ParentForm!=null?this.ParentForm.Focus():this.Parent!=null?this.Parent.Focus():this.ParentElement!=null&&this.ParentElement.focus();this.Popup||this._li==null||(this._li.remove(),this.DisposeTab());var n=System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.GridView,this.Parent),Core.Components.GridView).firstOrDefault(null,null);n!=null&&n.LastListViewItem!=null&&n.LastElementFocus!=null&&(n.LastListViewItem.Focused=!0,n.LastElementFocus.focus());Core.Components.Forms.EditForm.prototype.Dispose.call(this)},DisposeTab:function(){var n,t;this.ParentForm==null?(n=System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs,Core.Components.Forms.TabEditor).lastOrDefault(Bridge.fn.bind(this,function(n){return!Bridge.referenceEquals(n,this)}),null))!=null?n.Focus():null:(this.ParentForm.Focus(),this.ParentForm=null);Core.Components.Forms.TabEditor.Tabs.remove(this);t=System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs,Core.Components.Forms.TabEditor).select(function(n){return n.Name}).toList(System.String);window.localStorage.setItem("tabs",Core.Extensions.IEnumerableExtensions.Combine(System.String,t))},RemoveDOM:function(){var n;(n=this.Element)!=null?n.remove():null;this._li!=null?this._li.remove():null;this._backdrop!=null?this._backdrop.remove():null;this._backdropGridView!=null?this._backdropGridView.remove():null}}});Bridge.define("Core.Components.ButtonPdf",{inherits:[Core.Components.Button],props:{_preview:null,_pdfReport:null},ctors:{ctor:function(n,t){t===void 0&&(t=null);this.$initialize();Core.Components.Button.ctor.call(this,n,t)}},methods:{DispatchClickAsync:function(){var n=0,i,r=new System.Threading.Tasks.TaskCompletionSource,o,t,u,f,s,h,c,e,l,a=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5,6,7,8,9,10],n);switch(n){case 0:if(Core.Components.Renderer.Escape(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div,"backdrop").Style$1("align-items: center;"),Bridge.fn.bind(this,function(){this.Dispose()})),this._preview=Core.MVVM.Html.Context,Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"popup-content confirm-dialog").Style$1("top: 0;").Div,"popup-title").InnerHTML(this.GuiInfo.PlainText).Div,"icon-box").Span,"fa fa-times").Event("click",Bridge.fn.cacheBind(this,this.ClosePreview)).EndOf$1(".popup-title").Div,"popup-body scroll-content"),o=Core.MVVM.Html.Context,this._pdfReport=(t=new Core.Components.PdfReport(this.GuiInfo),t.ParentElement=o,t),this.GuiInfo.FocusSearch){n=1;continue}else{n=9;continue}case 1:if(System.Nullable.eq(this.GuiInfo.Precision,2)){n=2;continue}else{n=7;continue}case 2:u=System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.GridView,this.TabEditor),Core.Components.GridView).firstOrDefault(null,null);f=u.CacheData;Core.Extensions.IEnumerableExtensions.Nothing(System.Object,f)&&(f=u.RowData.Data);s=System.Linq.Enumerable.from(f,System.Object).where(function(n){return u.SelectedIds.contains(System.Int32.parse(Bridge.toString(n.Id)))}).toList(System.Object);t=Bridge.getEnumerator(s);n=3;continue;case 3:if(t.moveNext()){h=t.Current;n=4;continue}n=6;continue;case 4:if(i=System.Threading.Tasks.Task.delay(200),n=5,i.isCompleted())continue;i["continue"](a);return;case 5:i.getAwaitedResult();c=(e=new Core.Components.PdfReport(this.GuiInfo),e.ParentElement=o,e.Selected=h,e);this.Parent.AddChild(c);n=3;continue;case 6:window.setTimeout(Bridge.fn.bind(this,function(){var r=System.Linq.Enumerable.from(this._preview.querySelectorAll(".printable")).select(function(n){return Bridge.cast(n,HTMLElement)}).toList(HTMLElement),t=new System.Text.StringBuilder("<html><head>"),i,n;t.append("<body><div style='padding:7pt'>").append(Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(r,HTMLElement).select(function(n){return n.outerHTML}),"<\/br>")).append("<\/div><\/body><\/html>");i=t.toString();n=window.open("","_blank");n.document.open();n.document.write(i);n.document.close();n.print();n.addEventListener("mousemove",function(){n.close()});n.addEventListener("click",function(){n.close()});n.addEventListener("keyup",function(){n.close()});this._pdfReport.Dispose();this._preview.remove()}),2e3);n=8;continue;case 7:this.Parent.AddChild(this._pdfReport);window.setTimeout(Bridge.fn.bind(this,function(){var t=new System.Text.StringBuilder("<html><head>"),i,n;t.append("<body><div style='padding:7pt'>").append(this._pdfReport.Element.querySelector(".printable").outerHTML).append("<\/div><\/body><\/html>");i=t.toString();n=window.open("","_blank");n.document.write(i);n.document.close();n.print();n.addEventListener("mousemove",function(){n.close()});n.addEventListener("click",function(){n.close()});n.addEventListener("keyup",function(){n.close()});this._pdfReport.Dispose();this._preview.remove()}),2e3);n=8;continue;case 8:n=10;continue;case 9:this.Parent.AddChild(this._pdfReport);n=10;continue;case 10:r.setResult(null);return;default:r.setResult(null);return}}}catch(v){l=System.Exception.create(v);r.setException(l)}},arguments);return a(),r.task},ClosePreview:function(){this._preview.remove()}}});Bridge.define("Core.Components.GridView",{inherits:[Core.Components.ListView],statics:{fields:{SummaryClass:null,CellCountNoSticky:0,ToolbarColumn:null},ctors:{init:function(){var n;this.SummaryClass="summary";this.CellCountNoSticky=50;this.ToolbarColumn=(n=new Core.Models.GridPolicy,n.StatusBar=!0,n.ShortDesc="",n.Frozen=!0,n)}},methods:{SetSummaryHeaderText:function(n,t){if(!Core.Extensions.StringExt.IsNullOrWhiteSpace(n.Summary)){var i=t.cells[0];i.colSpan=System.Nullable.getValue(n.SummaryColSpan)>>>0;i.textContent=n.Summary;Core.Extensions.HtmlElementExtension.AddClass(i,"summary-header")}},ResetSummaryRow:function(n,t){for(var r,i=1;i<t;i=i+1|0)(r=n.cells[0])!=null?r.remove():null;Core.Components.GridView.ClearSummaryContent(n)},ClearSummaryContent:function(n){var t,i;t=Bridge.getEnumerator(n.cells,"getEnumerator");try{while(t.moveNext())i=t.Current,i.innerHTML=""}finally{Bridge.is(t,System.IDisposable)&&t.System$IDisposable$Dispose()}}}},fields:{_summarys:null,_sum:!1,_summaryId:null,AutoFocus:!1,LoadRerender:!1,_waitingLoad:!1,_renderPrepareCacheAwaiter:0,_hasFirstLoad:!1,_imeout:0,awaiter1:0,_renderIndexAwaiter:0,_lastScrollTop:0},props:{EmptyRowSection:null,DataTable:null,_settings:null},ctors:{init:function(){this._summarys=new(System.Collections.Generic.List$1(HTMLElement).ctor);this._sum=!1;this.AutoFocus=!1;this.LoadRerender=!1;this._hasFirstLoad=!1},ctor:function(n){this.$initialize();Core.Components.ListView.ctor.call(this,n);this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.cacheBind(this,this.DOMContentLoadedHandler))}},methods:{DOMContentLoadedHandler:function(){this.GuiInfo.IsSumary&&this.AddSummaries();this.PopulateFields$1();!this._sum&&(Bridge.referenceEquals(this.GuiInfo.ComponentType,"GridView")||Bridge.referenceEquals(this.GuiInfo.ComponentType,"VirtualGrid"))&&System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.AddSubTotal(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();this._sum=!0;i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},AddSubTotal:function(){var u=0,f,a,t=new System.Threading.Tasks.TaskCompletionSource,e,v,o,s,i,r,h,y,c,n,l,p,w,b,k=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1],u);switch(u){case 0:if(Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.GridPolicy,this.BasicHeader)){t.setResult(null);return}if(e=System.Linq.Enumerable.from(this.BasicHeader,Core.Models.GridPolicy).where(function(n){return!Bridge.referenceEquals(n.FieldName,Core.Components.EditableComponent.IdField)&&Bridge.referenceEquals(n.ComponentType,"Number")&&System.Nullable.eq(n.IsSumary,!0)}).toList(Core.Models.GridPolicy),Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.GridPolicy,e)){t.setResult(null);return}if(v=System.Linq.Enumerable.from(e,Core.Models.GridPolicy).select(Bridge.fn.bind(this,function(n){return System.String.format("FORMAT(SUM(isnull([{0}].{1},0)),'#,#') as {2}",this.GuiInfo.RefName,n.FieldName,n.FieldName)})).toList(System.String),o=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this.Wheres,Core.Models.Where).where(function(n){return!n.Group}).select(function(n){return n.FieldName})," and "),s=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this.Wheres,Core.Models.Where).where(function(n){return n.Group}).select(function(n){return n.FieldName})," or "),i=new(System.Collections.Generic.List$1(System.String).ctor),Core.Extensions.StringExt.IsNullOrWhiteSpace(o)||i.add(System.String.format("({0})",[o])),Core.Extensions.StringExt.IsNullOrWhiteSpace(s)||i.add(System.String.format("({0})",[s])),r=this.GuiInfo.PreQuery,h={},r!=null&&Core.Extensions.Utils.IsFunction(r,h)&&(r=Bridge.toString(h.v.call(this,this,this.EditForm))),y=System.Linq.Enumerable.from(i,System.String).any()?System.String.format("({0})",[Core.Extensions.IEnumerableExtensions.Combine(System.String,i," and ")]):"",f=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName).SubmitAsync(System.Array.type(System.Array.type(System.Object)),(n=new Core.Clients.XHRWrapper,n.Value=Core.Extensions.IEnumerableExtensions.Combine(System.String,v),n.Url=(System.String.format("SubTotal?group=",null)||"")+(System.String.format("&tablename={0}",[this.GuiInfo.RefName])||"")+(System.String.format("&refname=",null)||"")+(System.String.format("&formatsumary={0}",[this.GuiInfo.FormatSumaryField])||"")+(System.String.format("&dateTimeField={0}",[this.GuiInfo.DateTimeField])||"")+(System.String.format("&showNull={0}",[Bridge.box((l=this.GuiInfo.ShowNull,l!=null?l:!1),System.Boolean,System.Boolean.toString)])||"")+(System.String.format("&sql={0}",[this.Sql])||"")+(System.String.format("&orderby={0}",[this.GuiInfo.OrderBySumary])||"")+(System.String.format("&where={0} {1}",y,Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.PreQuery)?"":System.String.format("{0} {1}",System.Linq.Enumerable.from(i,System.String).any()?" and ":"",r))||""),n.Method=Core.Enums.HttpMethod.POST,n.AllowNestedObject=!0,n.ErrorHandler=function(){},n)),u=1,f.isCompleted())continue;f["continue"](k);return;case 1:a=f.getAwaitedResult();c=a;p=(n=c[System.Array.index(0,c)])[System.Array.index(0,n)];w=System.Linq.Enumerable.from(this.HeaderSection.Children,Core.Components.EditableComponent).where(function(n){return!Bridge.referenceEquals(n.GuiInfo.FieldName,Core.Components.EditableComponent.IdField)&&Bridge.referenceEquals(n.GuiInfo.ComponentType,"Number")&&n.GuiInfo.IsSumary===!0}).toList(Core.Components.EditableComponent);w.ForEach(function(n){n.Element.children[1].innerHTML=System.String.concat("(",p[n.GuiInfo.FieldName])+")"});t.setResult(null);return;default:t.setResult(null);return}}}catch(d){b=System.Exception.create(d);t.setException(b)}},arguments);return k(),t.task},PopulateFields$1:function(){if(!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.PopulateField)){var n=this.GuiInfo.PopulateField.split(",");n.length>0&&this.EditForm.UpdateView$1(!0,n)}},Rerender:function(){if(this.LoadRerender=!0,this.DisposeNoRecord(),this.Editable=this.GuiInfo.CanAdd&&System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).any(function(n){return!n.Hidden&&n.Editable}),this.Header=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).where(function(n){return!n.Hidden}).toList(Core.Models.GridPolicy),this.RenderTableHeader(this.Header),this.Editable&&this.AddNewEmptyRow(),this.RenderContent(),this.StickyColumn(this),!this.Editable&&Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.RowData.Data)){this.NoRecordFound();return}this.RenderIndex();var n;(n=Bridge.as(this.MainSection.Element,HTMLTableSectionElement))!=null&&n.addEventListener("contextmenu",Bridge.fn.cacheBind(this,this.BodyContextMenuHandler))},StickyColumn:function(n,t){var i,r,u;t===void 0&&(t=null);r=System.Array.init(["th","td"],System.String);u=(i=Core.Components.EditableComponent,System.Linq.Enumerable.from(n.FilterChildren(Core.Components.EditableComponent,function(n){return n.GuiInfo!=null&&n.GuiInfo.Frozen},function(n){return Bridge.is(n,Core.Components.ListViewSearch)},void 0),i).ToArray(i));u.forEach(function(n){var i=n.Element,u=System.Array.contains(r,n.Element.tagName.toLowerCase(),System.String);u||(i=Core.Extensions.HtmlElementExtension.Closest(n.Element,"td"));Core.Extensions.StringExt.HasAnyChar(t)?Core.Components.Renderer.Sticky(Core.MVVM.Html.Take(i),t,void 0):Core.Components.Renderer.Sticky(Core.MVVM.Html.Take(i),void 0,Bridge.toString(0))})},AddSections:function(){var u,n,e,i,o,r;if(((u=this.HeaderSection)!=null?u.Element:null)==null){var f=Core.MVVM.Html.Take(this.ParentElement),t="collapse"+this.GuiInfo.Id,s="tb"+this.GuiInfo.Id;this.GuiInfo.IsCollapsible&&Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(f.Div,"card mb-0").Div,"card-header").H5,"mb-0").A,"btn btn-primary").DataAttr$1("toggle","collapse").Href("#"+(t||"")).Attr$1("aria-expanded","false").Attr$1("aria-controls",t).Text(this.GuiInfo.Label).EndOf$1(".card");Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(f.Div.Event$1("keydown",Bridge.fn.bind(this,function(n){this.HotKeyF6Handler(n,Core.Extensions.EventExt.KeyCodeEnum(n))})),"grid-wrapper "+((this.GuiInfo.IsCollapsible?"collapse multi-collapse":"")||"")).Id(t),this.Editable?"editable":"");this.Element=Core.MVVM.Html.Context;this.GuiInfo.CanSearch&&Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"grid-toolbar search").End.Render();this.ListViewSearch=(n=new Core.Components.ListViewSearch(this.GuiInfo),n.Entity=new Core.Components.ListViewSearchVM,n);System.Nullable.hasValue(this.GuiInfo.DefaultAddStart)&&(e=System.Convert.toDouble(Bridge.box(System.Nullable.getValue(this.GuiInfo.DefaultAddStart),System.Int32)),this.ListViewSearch.EntityVM.StartDate=System.DateTime.addDays(System.DateTime.getNow(),e));i=window.localStorage.getItem("FromDate"+this.GuiInfo.Id);i!=null?(this.ListViewSearch.EntityVM.StartDate=System.DateTime.parse(Bridge.toString(i)),System.DateTime.lt(this.ListViewSearch.EntityVM.StartDate,System.DateTime.addMonths(System.DateTime.getNow(),-2))&&(this.ListViewSearch.EntityVM.StartDate=System.DateTime.addMonths(System.DateTime.getNow(),-2))):Bridge.referenceEquals(this.GuiInfo.ComponentType,"VirtualGrid")&&this.GuiInfo.AddDate!=null&&System.Nullable.getValue(this.GuiInfo.AddDate)&&(this.ListViewSearch.EntityVM.StartDate=System.DateTime.addMonths(System.DateTime.getNow(),-2));System.Nullable.hasValue(this.GuiInfo.DefaultAddEnd)&&(o=System.Convert.toDouble(Bridge.box(System.Nullable.getValue(this.GuiInfo.DefaultAddEnd),System.Int32)),this.ListViewSearch.EntityVM.EndDate=System.DateTime.addDays(System.DateTime.getNow(),o));r=window.localStorage.getItem("ToDate"+this.GuiInfo.Id);r!=null&&(this.ListViewSearch.EntityVM.EndDate=System.DateTime.parse(Bridge.toString(r)));this.AddChild(this.ListViewSearch);this.DataTable=Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div,"table-wrapper").Table,"table").Id(s).GetContext();Core.Components.Renderer.ClassName(Core.Components.Renderer.TabIndex(Core.MVVM.Html.Instance.Thead,-1).End.TBody,"empty").End.TBody.End.TFooter.Render();this.FooterSection=(n=new Core.Components.ListViewSection.ctor(Core.MVVM.Html.Context),n.ParentElement=this.DataTable,n);this.AddChild(this.FooterSection);this.MainSection=(n=new Core.Components.ListViewSection.ctor(this.FooterSection.Element.previousElementSibling),n.ParentElement=this.DataTable,n);this.AddChild(this.MainSection);this.EmptyRowSection=(n=new Core.Components.ListViewSection.ctor(this.MainSection.Element.previousElementSibling),n.ParentElement=this.DataTable,n);this.AddChild(this.EmptyRowSection);this.HeaderSection=(n=new Core.Components.ListViewSection.ctor(this.EmptyRowSection.Element.previousElementSibling),n.ParentElement=this.DataTable,n);this.AddChild(this.HeaderSection);Core.MVVM.Html.Instance.EndOf$1(".table-wrapper");this.RenderPaginator()}},SwapList:function(n,t){var i=this.BasicHeader.getItem(n);this.BasicHeader.removeAt(n);this.BasicHeader.insert(t,i)},SwapHeader:function(n,t){var i=this.Header.getItem(n);this.Header.removeAt(n);this.Header.insert(t,i)},ClickHeader:function(n){var t=Core.Extensions.HtmlElementExtension.Closest(Bridge.as(n.target,HTMLElement),"th"),r=t.parentElement.querySelectorAll("th"),i=Core.Extensions.IEnumerableExtensions.FindItemAndIndex(Node,r,function(n){return Bridge.referenceEquals(n,t)}).Item2;i<0||t.parentElement.parentElement.parentElement.querySelectorAll("tr:not(.summary)").forEach(function(n){if(!n.hasAttribute("virtualrow")&&!n.classList.contains("group-row")){var t=[].slice.call(n.querySelectorAll("th, td"));t[i].style.backgroundColor="#cbdcc2";t[i].style.color="#000"}})},FocusOutHeader:function(n){var t=Core.Extensions.HtmlElementExtension.Closest(Bridge.as(n.target,HTMLElement),"th"),r=t.parentElement.querySelectorAll("th"),i=Core.Extensions.IEnumerableExtensions.FindItemAndIndex(Node,r,function(n){return Bridge.referenceEquals(n,t)}).Item2;i<0||t.parentElement.parentElement.parentElement.querySelectorAll("tr:not(.summary)").forEach(function(n){if(!n.hasAttribute("virtualrow")&&!n.classList.contains("group-row")){var t=[].slice.call(n.querySelectorAll("th, td"));t[i].style.removeProperty("background-color");t[i].style.removeProperty("color")}})},ThHotKeyHandler:function(n){var f;if(!this.GuiInfo.Focus)if(f=Core.Extensions.EventExt.KeyCodeEnum(n),System.Nullable.eq(f,Core.Enums.KeyCodeEnum.RightArrow)){n.stopPropagation();var r=Core.Extensions.HtmlElementExtension.Closest(Bridge.as(n.target,HTMLElement),"th"),e=r.parentElement.querySelectorAll("th"),t=Core.Extensions.IEnumerableExtensions.FindItemAndIndex(Node,e,function(n){return Bridge.referenceEquals(n,r)}).Item2;r.parentElement.parentElement.parentElement.querySelectorAll("tr").forEach(function(n){var i,u,r;n.hasAttribute("virtualrow")||n.classList.contains("group-row")||(i=[].slice.call(n.querySelectorAll("th, td")),i[0].classList.contains("summary-header"))||(u=t,r=t+1,u>r?i[r].parentNode&&i[r].parentNode.insertBefore(i[u],i[r]):i[r].parentNode&&i[r].parentNode.insertBefore(i[u],i[r].nextSibling),i[u].style.backgroundColor="#cbdcc2")});this.SwapList(t-1|0,t);this.SwapHeader(t,t+1|0);this.ResetOrder();this.UpdateHeader();r.focus()}else if(System.Nullable.eq(f,Core.Enums.KeyCodeEnum.LeftArrow)){n.stopPropagation();var u=Core.Extensions.HtmlElementExtension.Closest(Bridge.as(n.target,HTMLElement),"th"),o=u.parentElement.querySelectorAll("th"),i=Core.Extensions.IEnumerableExtensions.FindItemAndIndex(Node,o,function(n){return Bridge.referenceEquals(n,u)}).Item2;u.parentElement.parentElement.parentElement.querySelectorAll("tr").forEach(function(n){var t,u,r;n.hasAttribute("virtualrow")||n.classList.contains("group-row")||(t=[].slice.call(n.querySelectorAll("th, td")),t[0].classList.contains("summary-header"))||(u=i,r=i-1,u>r?t[r].parentNode&&t[r].parentNode.insertBefore(t[u],t[r]):t[r].parentNode&&t[r].parentNode.insertBefore(t[u],t[r].nextSibling),t[u].style.backgroundColor="#cbdcc2")});this.SwapList(i-1|0,i-2|0);this.SwapHeader(i,i-1|0);this.ResetOrder();this.UpdateHeader();u.focus()}},FilterInSelected:function(t){var u,i,e,o,s;if(t.Operator!=null){var r=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,Bridge.toString(t.FieldName))},null),f="",h=window.localStorage.getItem("LastSearch"+this.GuiInfo.Id+r.Id);h!=null&&(f=Bridge.toString(h));i=(u=new Core.Components.Forms.ConfirmDialog,u.Content=System.String.concat(System.String.format("Nhập {0} cần tìm",[r.ShortDesc]),t.Text),u.NeedAnswer=!0,u.MultipleLine=!1,u.ComType=Bridge.referenceEquals(r.ComponentType,"Datepicker")||Bridge.referenceEquals(r.ComponentType,"Number")?r.ComponentType:"Textbox",u.Precision=r.Precision,u.PElement=this.MainSection.Element,u);i.YesConfirmed=Bridge.fn.combine(i.YesConfirmed,Bridge.fn.bind(this,function(){var e=0,o,u,f,n,s=Bridge.fn.bind(this,function(){for(;;){e=System.Array.min([0,1],e);switch(e){case 0:if(u=null,f=null,Bridge.referenceEquals(r.ComponentType,"Datepicker")?(f=i.Datepicker.OriginalText,u=System.Nullable.toString(i.Datepicker.Value,function(n){return System.DateTime.format(n)})):Bridge.referenceEquals(r.ComponentType,"Number")?(f=i.Number.GetValueText(),u=i.Number.Value.toString()):(f=Core.Extensions.Utils.EncodeSpecialChar(i.Textbox.Text.trim()),u=Core.Extensions.Utils.EncodeSpecialChar(i.Textbox.Text.trim())),window.localStorage.setItem("LastSearch"+this.GuiInfo.Id+r.Id,u),System.Linq.Enumerable.from(this.CellSelected,Core.Models.CellSelected).any(function(n){return Bridge.referenceEquals(n.FieldName,Bridge.toString(t.FieldName))&&Bridge.referenceEquals(n.Operator,"in")})&&!System.Nullable.getValue(Bridge.cast(Bridge.unbox(t.Shift,System.Boolean),System.Boolean))?(System.Linq.Enumerable.from(this.CellSelected,Core.Models.CellSelected).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,Bridge.toString(t.FieldName))&&Bridge.referenceEquals(n.Operator,"in")},null).Value=u,System.Linq.Enumerable.from(this.CellSelected,Core.Models.CellSelected).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,Bridge.toString(t.FieldName))&&Bridge.referenceEquals(n.Operator,"in")},null).ValueText=f):this.CellSelected.add((n=new Core.Models.CellSelected,n.FieldName=Bridge.toString(t.FieldName),n.FieldText=r.ShortDesc,n.ComponentType=r.ComponentType,n.Shift=System.Nullable.getValue(Bridge.cast(Bridge.unbox(t.Shift,System.Boolean),System.Boolean)),n.Value=u,n.ValueText=f,n.Operator=Bridge.toString(t.Operator),n.OperatorText=Bridge.toString(t.OperatorText),n)),this._summarys.add(document.createElement("div")),o=this.ActionFilter(),e=1,o.isCompleted())continue;o["continue"](s);return;case 1:o.getAwaitedResult();i.Textbox.Text=null;return;default:return}}},arguments);s()}));i.Entity=new n.$AnonymousType$6("");i.Render();Core.Extensions.StringExt.IsNullOrWhiteSpace(f)||(Bridge.referenceEquals(r.ComponentType,"Datepicker")?(i.Datepicker.Value=System.DateTime.parse(f),e=Bridge.as(i.Datepicker.Element,HTMLInputElement),e.selectionStart=0,e.selectionEnd=f.length):Bridge.referenceEquals(r.ComponentType,"Number")?(i.Number.Value=System.Convert.toDecimal(f),o=Bridge.as(i.Number.Element,HTMLInputElement),o.selectionStart=0,o.selectionEnd=f.length):(i.Textbox.Text=f,s=Bridge.as(i.Textbox.Element,HTMLInputElement),s.selectionStart=0,s.selectionEnd=f.length))}},ActionFilter:function(){var n=0,r,u,v,f,i=new System.Threading.Tasks.TaskCompletionSource,y,s,l,h,e,t,c,a,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5],n);switch(n){case 0:if(Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.CellSelected,this.CellSelected)){n=1;continue}n=3;continue;case 1:if(y=this.GuiInfo.DataSourceFilter,this.MainSection.DisposeChildren(),r=this.ApplyFilter(!0),n=2,r.isCompleted())continue;r["continue"](o);return;case 2:r.getAwaitedResult();Bridge.referenceEquals(this.GuiInfo.ComponentType,"VirtualGrid")&&this.GuiInfo.CanSearch&&this.HeaderSection.Element.focus();Bridge.referenceEquals(this.GuiInfo.ComponentType,"Dropdown")&&(s=Bridge.as(this.Parent,Core.Components.SearchEntry),s!=null?s._input.focus():null);i.setResult(null);return;case 3:if(Core.Components.Spinner.AppendTo(this.DataTable),l=System.Linq.Enumerable.from(this.CellSelected,Core.Models.CellSelected).where(function(n){return(!Core.Extensions.StringExt.IsNullOrWhiteSpace(n.Value)||!Core.Extensions.StringExt.IsNullOrWhiteSpace(n.ValueText))&&(Bridge.referenceEquals(n.ComponentType,"Dropdown")||Bridge.referenceEquals(n.ComponentType,"SearchEntry"))}).toList(Core.Models.CellSelected),h=System.Linq.Enumerable.from(l,Core.Models.CellSelected).select(Bridge.fn.bind(this,function(n){var i,t=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).firstOrDefault(function(t){return Bridge.referenceEquals(t.FieldName,n.FieldName)},null),r;return n.IsSearch?new Core.Clients.Client.$ctor1(t.RefName).GetRawList(System.Object,(System.String.format("?$select=Id&$filter=Id eq ",null)||"")+(Core.Extensions.Utils.EncodeSpecialChar(n.Value)||""),!1,!1,!1,t.RefName):(r=System.String.replaceAll((i=t.FormatCell.split("}"))[System.Array.index(0,i)],"{",""),new Core.Clients.Client.$ctor1(t.RefName).GetRawList(System.Object,(System.String.format("?$select=Id&$filter=contains({0},'",[r])||"")+(Core.Extensions.Utils.EncodeSpecialChar(n.ValueText)||"")+"')",!1,!1,!1,t.RefName))})).toList(System.Threading.Tasks.Task$1(System.Collections.Generic.List$1(System.Object))),u=System.Threading.Tasks.Task.whenAll(h),n=4,u.isCompleted())continue;u["continue"](o);return;case 4:if(v=u.getAwaitedResult(),e=0,t=new(System.Collections.Generic.List$1(System.String).ctor),this.CellSelected.ForEach(Bridge.fn.bind(this,function(n){var a,i,v,u="",r=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).firstOrDefault(function(t){return Bridge.referenceEquals(t.FieldName,n.FieldName)},null),l=null,o=Core.Extensions.StringExt.IsNullOrWhiteSpace(n.Value),f=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotIn:Core.Enums.AdvSearchOperation.In,y,p,w,s,c;if(Bridge.referenceEquals(r.FieldName,Core.Components.EditableComponent.IdField))u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("[{0}].{1} not in ({2})",this.GuiInfo.RefName,n.FieldName,n.Value):System.String.format("[{0}].{1} in ({2})",this.GuiInfo.RefName,n.FieldName,n.Value),t.add((n.FieldText||"")+" <span class='text-danger'>"+(n.OperatorText||"")+"<\/span> "+(n.ValueText||""));else if((Bridge.referenceEquals(r.ComponentType,"Dropdown")||Bridge.referenceEquals(r.ComponentType,"SearchEntry"))&&!Core.Extensions.StringExt.IsNullOrWhiteSpace(r.FormatCell))o?(f=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotEqualNull:Core.Enums.AdvSearchOperation.EqualNull,u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("[{0}].{1} is not null",this.GuiInfo.RefName,n.FieldName):System.String.format("[{0}].{1} is null",this.GuiInfo.RefName,n.FieldName)):(y=h.getItem(e).getResult(),System.Linq.Enumerable.from(y,System.Object).any()?(l=Core.Extensions.IEnumerableExtensions.Combine(System.Int32,System.Linq.Enumerable.from(y,System.Object).select(function(n){return n.Id}).select(function(n){return Bridge.cast(n,System.Int32)})),u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("[{0}].{1} not in ({2})",this.GuiInfo.RefName,n.FieldName,l):System.String.format("[{0}].{1} in ({2})",this.GuiInfo.RefName,n.FieldName,l)):u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("[{0}].{1} != {2}",this.GuiInfo.RefName,n.FieldName,n.Value):System.String.format("[{0}].{1} = {2}",this.GuiInfo.RefName,n.FieldName,n.Value),e=e+1|0),t.add((r.ShortDesc||"")+" <span class='text-danger'>"+(n.OperatorText||"")+"<\/span> "+(n.ValueText||""));else if(Bridge.referenceEquals(r.ComponentType,"Input")||Bridge.referenceEquals(r.ComponentType,"Textbox")||Bridge.referenceEquals(r.ComponentType,"Textarea"))o?(f=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotEqualNull:Core.Enums.AdvSearchOperation.EqualNull,u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("([{0}].{1} is not null and [{2}].{3} != '')",this.GuiInfo.RefName,n.FieldName,this.GuiInfo.RefName,n.FieldName):System.String.format("([{0}].{1} is null or [{2}].{3} = '')",this.GuiInfo.RefName,n.FieldName,this.GuiInfo.RefName,n.FieldName)):(f=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotLike:Core.Enums.AdvSearchOperation.Like,u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("(CHARINDEX(N'{0}', [{1}].{2}) = 0 or [{3}].{4} is null)",n.Value,this.GuiInfo.RefName,n.FieldName,this.GuiInfo.RefName,n.FieldName):System.String.format("CHARINDEX(N'{0}', [{1}].{2}) > 0",n.Value,this.GuiInfo.RefName,n.FieldName)),t.add((r.ShortDesc||"")+" <span class='text-danger'>"+(n.OperatorText||"")+"<\/span> "+(n.ValueText||""));else if(Bridge.referenceEquals(r.ComponentType,"Number")||Bridge.referenceEquals(r.ComponentType,"Label")&&System.String.contains(r.FieldName,"Id"))Bridge.referenceEquals(n.Operator,"not in")||Bridge.referenceEquals(n.Operator,"in")?o?(f=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotEqualNull:Core.Enums.AdvSearchOperation.EqualNull,u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("[{0}].{1} is not null",this.GuiInfo.RefName,n.FieldName):System.String.format("[{0}].{1} is null",this.GuiInfo.RefName,n.FieldName)):(f=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotEqual:Core.Enums.AdvSearchOperation.Equal,u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("[{0}].{1} != {2}",this.GuiInfo.RefName,n.FieldName,System.String.replaceAll(n.Value,",","")):System.String.format("[{0}].{1} = {2}",this.GuiInfo.RefName,n.FieldName,System.String.replaceAll(n.Value,",",""))):Bridge.referenceEquals(n.Operator,"gt")||Bridge.referenceEquals(n.Operator,"lt")?(u=Bridge.referenceEquals(n.Operator,"gt")?System.String.format("[{0}].{1} > {2}",this.GuiInfo.RefName,n.FieldName,n.Value):System.String.format("[{0}].{1} < {2}",this.GuiInfo.RefName,n.FieldName,n.Value),f=Bridge.referenceEquals(n.Operator,"gt")?Core.Enums.AdvSearchOperation.GreaterThan:Core.Enums.AdvSearchOperation.LessThan):(Bridge.referenceEquals(n.Operator,"ge")||Bridge.referenceEquals(n.Operator,"le"))&&(u=Bridge.referenceEquals(n.Operator,"ge")?System.String.format("[{0}].{1} >= {2}",this.GuiInfo.RefName,n.FieldName,n.Value):System.String.format("[{0}].{1} <= {2}",this.GuiInfo.RefName,n.FieldName,n.Value),f=Bridge.referenceEquals(n.Operator,"ge")?Core.Enums.AdvSearchOperation.GreaterThanOrEqual:Core.Enums.AdvSearchOperation.LessThanOrEqual),t.add((r.ShortDesc||"")+" <span class='text-danger'>"+(n.OperatorText||"")+"<\/span> "+(n.ValueText||""));else if(Bridge.referenceEquals(r.ComponentType,"Checkbox"))o?(f=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotEqualNull:Core.Enums.AdvSearchOperation.EqualNull,u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("[{0}].{1} is not null",this.GuiInfo.RefName,n.FieldName):System.String.format("[{0}].{1} is null",this.GuiInfo.RefName,n.FieldName)):u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("[{0}].{1} != {2}",this.GuiInfo.RefName,n.FieldName,Bridge.referenceEquals(n.Value,"true")?"1":"0"):System.String.format("[{0}].{1} = {2}",this.GuiInfo.RefName,n.FieldName,Bridge.referenceEquals(n.Value,"true")?"1":"0"),t.add((r.ShortDesc||"")+" <span class='text-danger'>"+(n.OperatorText||"")+"<\/span> "+(n.ValueText||""));else if(Bridge.referenceEquals(r.ComponentType,"Datepicker")){if(n.Value=Core.Extensions.Utils.DecodeSpecialChar(n.Value),n.ValueText=Core.Extensions.Utils.DecodeSpecialChar(n.Value),Bridge.referenceEquals(n.Operator,"not in")||Bridge.referenceEquals(n.Operator,"in"))if(o)u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("[{0}].{1} is not null",this.GuiInfo.RefName,n.FieldName):System.String.format("[{0}].{1} is null",this.GuiInfo.RefName,n.FieldName),f=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotEqualNull:Core.Enums.AdvSearchOperation.EqualNull;else try{p=System.DateTime.parseExact(n.Value,"dd/MM/yyyy",System.Globalization.CultureInfo.invariantCulture);(Bridge.referenceEquals(n.Operator,"not in")||Bridge.referenceEquals(n.Operator,"in"))&&(u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("[{0}].{1} != '{2:yyyy-MM-dd}'",this.GuiInfo.RefName,n.FieldName,Bridge.box(p,System.DateTime,System.DateTime.format)):System.String.format("[{0}].{1} = '{2:yyyy-MM-dd}'",this.GuiInfo.RefName,n.FieldName,Bridge.box(p,System.DateTime,System.DateTime.format)),f=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotEqualDatime:Core.Enums.AdvSearchOperation.EqualDatime)}catch(b){b=System.Exception.create(b);w=System.DateTime.parseExact(n.Value,"MM/dd/yyyy HH:mm:ss",System.Globalization.CultureInfo.invariantCulture);u=Bridge.referenceEquals(n.Operator,"not in")?System.String.format("[{0}].{1} != '{2:yyyy-MM-dd}'",this.GuiInfo.RefName,n.FieldName,Bridge.box(w,System.DateTime,System.DateTime.format)):System.String.format("[{0}].{1} = '{2:yyyy-MM-dd}'",this.GuiInfo.RefName,n.FieldName,Bridge.box(w,System.DateTime,System.DateTime.format));f=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotEqualDatime:Core.Enums.AdvSearchOperation.EqualDatime}else if(!o){try{s=System.DateTime.parseExact(n.Value,"dd/MM/yyyy",System.Globalization.CultureInfo.invariantCulture)}catch(k){k=System.Exception.create(k);s=System.DateTime.parseExact(n.Value,"MM/dd/yyyy HH:mm:ss",System.Globalization.CultureInfo.invariantCulture)}Bridge.referenceEquals(n.Operator,"gt")||Bridge.referenceEquals(n.Operator,"lt")?(u=Bridge.referenceEquals(n.Operator,"gt")?System.String.format("[{0}].{1} > '{2:yyyy-MM-dd HH:mm}'",this.GuiInfo.RefName,n.FieldName,Bridge.box(s,System.DateTime,System.DateTime.format)):System.String.format("[{0}].{1} < '{2:yyyy-MM-dd HH:mm}'",this.GuiInfo.RefName,n.FieldName,Bridge.box(s,System.DateTime,System.DateTime.format)),f=Bridge.referenceEquals(n.Operator,"gt")?Core.Enums.AdvSearchOperation.GreaterThanDatime:Core.Enums.AdvSearchOperation.LessThanDatime):(Bridge.referenceEquals(n.Operator,"ge")||Bridge.referenceEquals(n.Operator,"le"))&&(u=Bridge.referenceEquals(n.Operator,"ge")?System.String.format("[{0}].{1} >= '{2:yyyy-MM-dd HH:mm}'",this.GuiInfo.RefName,n.FieldName,Bridge.box(s,System.DateTime,System.DateTime.format)):System.String.format("[{0}].{1} <= '{2:yyyy-MM-dd HH:mm}'",this.GuiInfo.RefName,n.FieldName,Bridge.box(s,System.DateTime,System.DateTime.format)),f=Bridge.referenceEquals(n.Operator,"ge")?Core.Enums.AdvSearchOperation.GreaterEqualDatime:Core.Enums.AdvSearchOperation.LessEqualDatime)}t.add((r.ShortDesc||"")+" <span class='text-danger'>"+(n.OperatorText||"")+"<\/span> "+(n.ValueText||""))}c=(a=l,a!=null?a:n.Value);System.Linq.Enumerable.from(this.AdvSearchVM.Conditions,Core.Models.FieldCondition).any(function(t){return Bridge.referenceEquals(t.Field.FieldName,n.FieldName)&&System.Nullable.eq(t.CompareOperatorId,f)&&(System.Nullable.eq(t.CompareOperatorId,Core.Enums.AdvSearchOperation.Like)||System.Nullable.eq(t.CompareOperatorId,Core.Enums.AdvSearchOperation.In)||System.Nullable.eq(t.CompareOperatorId,Core.Enums.AdvSearchOperation.EqualDatime))})&&!n.Shift?(System.Linq.Enumerable.from(this.AdvSearchVM.Conditions,Core.Models.FieldCondition).firstOrDefault(function(t){return Bridge.referenceEquals(t.Field.FieldName,n.FieldName)&&System.Nullable.eq(t.CompareOperatorId,f)},null).Value=Core.Extensions.StringExt.IsNullOrWhiteSpace(c)?n.ValueText:c,System.Linq.Enumerable.from(this.Wheres,Core.Models.Where).firstOrDefault(Bridge.fn.bind(this,function(t){return System.String.contains(t.FieldName,System.String.format("[{0}].{1}",this.GuiInfo.RefName,n.FieldName))}),null).FieldName=u):System.Linq.Enumerable.from(this.AdvSearchVM.Conditions,Core.Models.FieldCondition).any(function(t){return Bridge.referenceEquals(t.Field.FieldName,n.FieldName)&&System.Nullable.eq(t.CompareOperatorId,f)&&Bridge.referenceEquals(t.Value,n.Value)})||(Bridge.referenceEquals(n.ComponentType,"Input")&&Core.Extensions.StringExt.IsNullOrWhiteSpace(n.Value)?(this.AdvSearchVM.Conditions.add((i=new Core.Models.FieldCondition,i.Field=r,i.CompareOperatorId=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotEqualNull:Core.Enums.AdvSearchOperation.EqualNull,i.LogicOperatorId=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.LogicOperation.And:Core.Enums.LogicOperation.Or,i.Value=null,i.Group=!0,i)),this.AdvSearchVM.Conditions.add((i=new Core.Models.FieldCondition,i.Field=r,i.CompareOperatorId=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.AdvSearchOperation.NotEqual:Core.Enums.AdvSearchOperation.Equal,i.LogicOperatorId=Bridge.referenceEquals(n.Operator,"not in")?Core.Enums.LogicOperation.And:Core.Enums.LogicOperation.Or,i.Value="",i.Group=!0,i))):this.AdvSearchVM.Conditions.add((i=new Core.Models.FieldCondition,i.Field=r,i.CompareOperatorId=f,i.LogicOperatorId=(v=n.Logic,v!=null?v:Core.Enums.LogicOperation.And),i.Value=Core.Extensions.StringExt.IsNullOrWhiteSpace(c)?n.ValueText:c,i.Group=n.Group,i)),this.Wheres.add((i=new Core.Models.Where,i.FieldName=u,i.Group=n.Group,i)))})),f=this.ApplyFilter(!0),n=5,f.isCompleted())continue;f["continue"](o);return;case 5:f.getAwaitedResult();Core.Components.Spinner.Hide();Bridge.referenceEquals(this.GuiInfo.ComponentType,"VirtualGrid")&&this.GuiInfo.CanSearch&&this.HeaderSection.Element.focus();Bridge.referenceEquals(this.GuiInfo.ComponentType,"Dropdown")&&(c=Bridge.as(this.Parent,Core.Components.SearchEntry),c!=null?c._input.focus():null);Core.Extensions.Toast.Success(Core.Extensions.IEnumerableExtensions.Combine(System.String,t,"<\/br>"));i.setResult(null);return;default:i.setResult(null);return}}}catch(p){a=System.Exception.create(p);i.setException(a)}},arguments);return o(),i.task},FilterSelected:function(n){var t,r;if(n.Operator!=null){var u=n.Value==null?null:Bridge.toString(n.Value),f=n.ValueText==null?null:Bridge.toString(n.ValueText),i=n.FieldName==null?null:Bridge.toString(n.FieldName),e=n.Operator==null?null:Bridge.toString(n.Operator),o=n.OperatorText==null?null:Bridge.toString(n.OperatorText),s=n.IsSearch==null?!0:!1;System.Linq.Enumerable.from(this.CellSelected,Core.Models.CellSelected).any(function(n){return Bridge.referenceEquals(n.FieldName,i)&&Bridge.referenceEquals(n.Value,u)&&Bridge.referenceEquals(n.ValueText,f)&&Bridge.referenceEquals(n.Operator,e)})||(r=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,i)},null),this.CellSelected.add((t=new Core.Models.CellSelected,t.FieldName=i,t.FieldText=r.ShortDesc,t.ComponentType=r.ComponentType,t.Value=u,t.ValueText=f,t.Operator=e,t.OperatorText=o,t.IsSearch=s,t)));this._summarys.add(document.createElement("div"));System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.ActionFilter(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))}},DisposeSumary:function(){System.Linq.Enumerable.from(this._summarys,HTMLElement).any()&&(System.Linq.Enumerable.from(this._summarys,HTMLElement).elementAtOrDefault(this._summarys.Count-1|0,null).remove(),this._summarys.removeAt(this._summarys.Count-1|0));this.LastListViewItem!=null&&this.LastElementFocus!=null&&(this.LastListViewItem.Focused=!0,this.LastElementFocus.focus())},HiddenSumary:function(){Core.Extensions.HtmlElementExtension.Hide(System.Linq.Enumerable.from(this._summarys,HTMLElement).elementAtOrDefault(this._summarys.Count-1|0,null))},ExportExcel:function(n){var t=0,i,f,r=new System.Threading.Tasks.TaskCompletionSource,c,e,o,u,s,h=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(c=Bridge.as(n.target,HTMLInputElement),e=Bridge.as(document.getElementById(this._summaryId),HTMLTableElement),i=(u=new Core.Clients.Client.$ctor1("FileUpload"),u.CustomPrefix="https://cdn-tms.softek.com.vn/api",u).PostAsync(System.String,e.outerHTML,System.String.format("ExportExcelFromHtml?fileName=Summary{0:ddMMyyyyHHmm}",[Bridge.box(System.DateTime.getNow(),System.DateTime,System.DateTime.format)]),!1,!0),t=1,i.isCompleted())continue;i["continue"](h);return;case 1:f=i.getAwaitedResult();o=f;Core.Clients.Client.Download(o);r.setResult(null);return;default:r.setResult(null);return}}}catch(l){s=System.Exception.create(l);r.setException(s)}},arguments);return h(),r.task},SearchTable:function(n){for(var u,f,i,e,o=Bridge.as(n.target,HTMLInputElement),s=Bridge.as(document.getElementById(this._summaryId),HTMLTableElement),r=System.Linq.Enumerable.from(s.tBodies,HTMLTableSectionElement).firstOrDefault(null,null).children,t=0;t<r.length;t=t+1|0){for(u=r[t].childNodes,f=!1,i=0;i<u.length;i=i+1|0)if(e=u[i].textContent,System.String.indexOf(e.toLowerCase(),o.value.toLowerCase())>-1){f=!0;break}f?Core.Extensions.HtmlElementExtension.RemoveClass(r[t],"d-none"):Core.Extensions.HtmlElementExtension.AddClass(r[t],"d-none")}},FullTextSearch:function(){for(var r,u,t,o=Bridge.as(this.DataTable,HTMLTableElement),i=System.Linq.Enumerable.from(o.tBodies,HTMLTableSectionElement).lastOrDefault(null,null).children,n=0;n<i.length;n=n+1|0)if(!Core.Extensions.HtmlElementExtension.HasClass(i[n],"virtual-row")){for(r=i[n].childNodes,u=!1,t=0;t<r.length;t=t+1|0){var s=Bridge.as(r[t],HTMLElement),f="",e=s.querySelector("input:first-child");if(f=e!=null?Bridge.toString(Core.Extensions.BridgeExt.GetPropValue(e,"value")):r[t].textContent==null?"":r[t].textContent,System.String.indexOf(Core.Extensions.Utils.DecodeSpecialChar(f).toLowerCase(),Core.Extensions.Utils.DecodeSpecialChar(this.ListViewSearch.EntityVM.FullTextSearch.toLowerCase()))>-1){u=!0;break}}u?Core.Extensions.HtmlElementExtension.RemoveClass(i[n],"d-none"):Core.Extensions.HtmlElementExtension.AddClass(i[n],"d-none")}},SortTable:function(n,t){var u=Bridge.as(n.target,HTMLElement),s=Core.Extensions.HtmlElementExtension.Closest(u,"tr");Core.Extensions.IEnumerableExtensions.ForEach(HTMLElement,s.children,function(n){Core.Extensions.HtmlElementExtension.RemoveClass(n,"desc");Core.Extensions.HtmlElementExtension.RemoveClass(n,"asc")});var i=document.getElementById(this._summaryId),f=i.querySelector("tbody"),h=i.querySelector("thead"),r=i.getAttribute("data-sort-order"),e=u.getAttribute("data-sort-type"),o=Array.from(f.children);o.sort(function(n,i){var o=n.getElementsByTagName("td")[t],s=i.getElementsByTagName("td")[t],u=o.textContent||o.innerText,f=s.textContent||s.innerText;return e==="number"?((u===null||u===undefined||u==="")&&(u="0"),(f===null||f===undefined||f==="")&&(f="0"),u=parseFloat(u.replaceAll(",","")),f=parseFloat(f.replaceAll(",",""))):e==="date"&&(u=o.getAttribute("data-value"),f=s.getAttribute("data-value"),u=new Date(u),f=new Date(f)),u<f?r==="asc"?-1:1:u>f?r==="asc"?1:-1:0});o.forEach(function(n){f.appendChild(n)});Core.Extensions.HtmlElementExtension.AddClass(u,Bridge.referenceEquals(r,"asc")?"desc":"asc");i.setAttribute("data-sort-order",Bridge.referenceEquals(r,"asc")?"desc":"asc")},FocusCell:function(n){var t=Bridge.as(n.target,HTMLElement),i=$(n.target).closest("table");i.find("tbody tr").removeClass("focus");i.find("tbody td").removeClass("cell-selected");Core.Extensions.HtmlElementExtension.AddClass(Core.Extensions.HtmlElementExtension.Closest(t,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.tr)),"focus");Core.Extensions.HtmlElementExtension.AddClass(Core.Extensions.HtmlElementExtension.Closest(t,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),"cell-selected")},FilterSumary:function(n,t,i){var r,u=System.Linq.Enumerable.from(this.CellSelected,Core.Models.CellSelected).firstOrDefault(function(t){return Bridge.referenceEquals(n.ComponentType,"Datepicker")&&Bridge.referenceEquals(t.FieldName,n.FieldName)&&Bridge.referenceEquals(t.Operator,"in")},null),f;u==null?System.Linq.Enumerable.from(this.CellSelected,Core.Models.CellSelected).any(function(i){return Bridge.referenceEquals(i.FieldName,n.FieldName)&&Bridge.referenceEquals(i.Value,t)&&Bridge.referenceEquals(i.Operator,"in")})||(f=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).firstOrDefault(function(t){return Bridge.referenceEquals(t.FieldName,n.FieldName)},null),this.CellSelected.add((r=new Core.Models.CellSelected,r.FieldName=n.FieldName,r.FieldText=f.ShortDesc,r.ComponentType=f.ComponentType,r.Value=t,r.ValueText=i,r.Operator="in",r.OperatorText="chứa",r.IsSearch=!0,r))):(u.Value=t,u.ValueText=i);this.HiddenSumary();System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.ActionFilter(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},HotKeyHandler:function(n,t,i){var f=System.Linq.Enumerable.from(i.Children,Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this,function(n){return n.GuiInfo.Id===this.LastComponentFocus.Id}),null),r=Bridge.as(n.target,HTMLElement),u;r=Core.Extensions.HtmlElementExtension.Closest(r,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td));u=Core.Extensions.EventExt.KeyCodeEnum(n);this.ActionKeyHandler(n,t,i,f,r,u)},ActionKeyHandler:function(t,i,r,u,f,e){var nt,st,ht,s="",c="",o="",y,tt,ct,p,b,w,k,it,a,rt,d,v,ut,pt,ft,lt,et,ot,l,g,h;if(System.Nullable.eq(e,Core.Enums.KeyCodeEnum.F4)||System.Nullable.eq(e,Core.Enums.KeyCodeEnum.F8)||System.Nullable.eq(e,Core.Enums.KeyCodeEnum.F9)||System.Nullable.eq(e,Core.Enums.KeyCodeEnum.F10)||System.Nullable.eq(e,Core.Enums.KeyCodeEnum.F11)||System.Nullable.eq(e,Core.Enums.KeyCodeEnum.F2)||System.Nullable.eq(e,Core.Enums.KeyCodeEnum.UpArrow)||System.Nullable.eq(e,Core.Enums.KeyCodeEnum.DownArrow)||System.Nullable.eq(e,Core.Enums.KeyCodeEnum.Home)||System.Nullable.eq(e,Core.Enums.KeyCodeEnum.End)||System.Nullable.eq(e,Core.Enums.KeyCodeEnum.Insert)||Core.Extensions.EventExt.CtrlOrMetaKey(t)&&System.Nullable.eq(e,Core.Enums.KeyCodeEnum.D)){if(t.preventDefault(),t.stopPropagation(),u==null)return;s=u.GuiInfo.FieldName;switch(u.GuiInfo.ComponentType){case"Dropdown":o=Core.Extensions.BridgeExt.GetPropValue(r.Entity,i.FieldName)==null?null:Core.Extensions.Utils.EncodeSpecialChar(Bridge.toString(Core.Extensions.BridgeExt.GetPropValue(r.Entity,i.FieldName)));break;case"Number":o=Core.Extensions.BridgeExt.GetPropValue(r.Entity,i.FieldName)==null?null:System.String.replaceAll(Bridge.toString(Core.Extensions.BridgeExt.GetPropValue(r.Entity,i.FieldName)),",","");break;case"Checkbox":o=Core.Components.Extensions.ComponentExt.GetValue(u)==null?null:Core.Extensions.Utils.EncodeSpecialChar(Bridge.toString(Core.Components.Extensions.ComponentExt.GetValue(u))).toLowerCase();break;default:o=Core.Components.Extensions.ComponentExt.GetValue(u)==null?null:Core.Extensions.Utils.EncodeSpecialChar(Bridge.toString(Core.Components.Extensions.ComponentExt.GetValue(u)))}c=o==null?null:Core.Components.Extensions.ComponentExt.GetValue(u)==null?null:Core.Extensions.Utils.DecodeSpecialChar(Bridge.toString(Core.Components.Extensions.ComponentExt.GetValue(u)))}switch(e){case Core.Enums.KeyCodeEnum.F11:System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var e=0,o,i=new System.Threading.Tasks.TaskCompletionSource,n,r,f,s,h=Bridge.fn.bind(this,function(){try{for(;;){e=System.Array.min([0,1],e);switch(e){case 0:if(Bridge.referenceEquals(u.GuiInfo.ComponentType,"Label")||Bridge.referenceEquals(u.GuiInfo.ComponentType,"Button")){i.setResult(null);return}if(n=System.Linq.Enumerable.from(this.HeaderSection.Children,Core.Components.EditableComponent).firstOrDefault(function(n){return n.GuiInfo.Id===u.GuiInfo.Id},null),Core.Extensions.HtmlElementExtension.RemoveClass(n.Element,"desc"),Core.Extensions.HtmlElementExtension.RemoveClass(n.Element,"asc"),this.SortedField==null?(this.SortedField=function(n){var t;return n.add((t=new Core.Components.SortedField,t.Field=u.GuiInfo.FieldName,t.Desc=!0,t.Com=Core.Extensions.BridgeExt.CastProp(Core.Models.GridPolicy,u.GuiInfo),t)),n}(new(System.Collections.Generic.List$1(Core.Components.SortedField).ctor)),Core.Extensions.HtmlElementExtension.AddClass(n.Element,"desc")):(r=System.Linq.Enumerable.from(this.SortedField,Core.Components.SortedField).firstOrDefault(function(n){return Bridge.referenceEquals(n.Field,u.GuiInfo.FieldName)},null),r!=null?!r.Desc==!1?(System.Linq.Enumerable.from(this.SortedField,Core.Components.SortedField).firstOrDefault(function(n){return Bridge.referenceEquals(n.Field,u.GuiInfo.FieldName)},null).Desc=!r.Desc,Core.Extensions.HtmlElementExtension.AddClass(n.Element,r.Desc?"desc":"asc")):this.SortedField.remove(System.Linq.Enumerable.from(this.SortedField,Core.Components.SortedField).firstOrDefault(function(n){return Bridge.referenceEquals(n.Field,u.GuiInfo.FieldName)},null)):(Core.Extensions.EventExt.ShiftKey(t)||(this.HeaderSection.Children.ForEach(function(n){Core.Extensions.HtmlElementExtension.RemoveClass(n.Element,"desc");Core.Extensions.HtmlElementExtension.RemoveClass(n.Element,"asc")}),this.SortedField.clear()),Core.Extensions.HtmlElementExtension.AddClass(n.Element,"desc"),this.SortedField.add((f=new Core.Components.SortedField,f.Field=u.GuiInfo.FieldName,f.Com=Core.Extensions.BridgeExt.CastProp(Core.Models.GridPolicy,u.GuiInfo),f.Desc=!0,f)))),this.AdvSearchVM.OrderBy.clear(),this.AdvSearchVM.OrderBy.AddRange(System.Linq.Enumerable.from(this.SortedField,Core.Components.SortedField).select(function(n){var t;return t=new Core.Models.OrderBy,t.Field=n.Com,t.FieldId=n.Com.Id,t.OrderbyOptionId=n.Desc?Core.Enums.OrderbyOption.DESC:Core.Enums.OrderbyOption.ASC,t}).toList(Core.Models.OrderBy)),Core.Clients.LocalStorage.SetItem(System.Collections.Generic.List$1(Core.Models.OrderBy),"OrderBy"+this.GuiInfo.Id,this.AdvSearchVM.OrderBy),o=this.ActionFilter(),e=1,o.isCompleted())continue;o["continue"](h);return;case 1:o.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(c){s=System.Exception.create(c);i.setException(s)}},arguments);return h(),i.task}));break;case Core.Enums.KeyCodeEnum.F4:if(r==null)return;y=Core.Components.Forms.ContextMenu.Instance;y.PElement=this.MainSection.Element;y.Top=f.getBoundingClientRect().top;y.Left=f.getBoundingClientRect().left;y.MenuItems=Bridge.fn.bind(this,function(i){var r;return i.add((r=new Core.Components.Forms.ContextMenuItem,r.Icon="fal fa-angle-double-right",r.Text="Chứa",r.Click=Bridge.fn.cacheBind(this,this.FilterInSelected),r.Parameter=new n.$AnonymousType$7("in","Chứa",o,s,c,Core.Extensions.EventExt.ShiftKey(t)),r)),i.add((r=new Core.Components.Forms.ContextMenuItem,r.Icon="fal fa-not-equal",r.Text="Không chứa",r.Click=Bridge.fn.cacheBind(this,this.FilterInSelected),r.Parameter=new n.$AnonymousType$7("not in","Không chứa",o,s,c,Core.Extensions.EventExt.ShiftKey(t)),r)),i})(new(System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem).ctor));(Bridge.referenceEquals(u.GuiInfo.ComponentType,"Number")||Bridge.referenceEquals(u.GuiInfo.ComponentType,"Datepicker"))&&y.MenuItems.AddRange(Bridge.fn.bind(this,function(i){var r;return i.add((r=new Core.Components.Forms.ContextMenuItem,r.Icon="fal fa-greater-than",r.Text="Lớn hơn",r.Click=Bridge.fn.cacheBind(this,this.FilterInSelected),r.Parameter=new n.$AnonymousType$7("gt","Lớn hơn",o,s,c,Core.Extensions.EventExt.ShiftKey(t)),r)),i.add((r=new Core.Components.Forms.ContextMenuItem,r.Icon="fal fa-less-than",r.Text="Nhỏ hơn",r.Click=Bridge.fn.cacheBind(this,this.FilterInSelected),r.Parameter=new n.$AnonymousType$7("lt","Nhỏ hơn",o,s,c,Core.Extensions.EventExt.ShiftKey(t)),r)),i.add((r=new Core.Components.Forms.ContextMenuItem,r.Icon="fal fa-greater-than-equal",r.Text="Lớn hơn bằng",r.Click=Bridge.fn.cacheBind(this,this.FilterInSelected),r.Parameter=new n.$AnonymousType$7("ge","Lớn hơn bằng",o,s,c,Core.Extensions.EventExt.ShiftKey(t)),r)),i.add((r=new Core.Components.Forms.ContextMenuItem,r.Icon="fal fa-less-than-equal",r.Text="Nhỏ hơn bằng",r.Click=Bridge.fn.cacheBind(this,this.FilterInSelected),r.Parameter=new n.$AnonymousType$7("le","Nhỏ hơn bằng",o,s,c,Core.Extensions.EventExt.ShiftKey(t)),r)),i})(new(System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem).ctor)));y.Render();break;case Core.Enums.KeyCodeEnum.F8:if(tt=(nt=System.Object,System.Linq.Enumerable.from(this.GetSelectedRows(),nt).toList(nt)),Core.Extensions.IEnumerableExtensions.Nothing(System.Object,tt)){Core.Extensions.Toast.Warning("Vui lòng chọn dòng cần xóa");return}var at=this.EditForm.GetElementPolicies(this.GuiInfo.Id,Core.Extensions.Utils.ComponentId),vt=System.Linq.Enumerable.from(tt,System.Object).all(function(n){return Core.Extensions.Utils.IsOwner(n,!1)}),yt=this.CanDo(at,function(n){return n.CanDelete&&vt||n.CanDeleteAll});yt&&this.HardDeleteSelected();break;case Core.Enums.KeyCodeEnum.F9:Core.Extensions.StringExt.IsNullOrWhiteSpace(o)?this.FilterSelected(new n.$AnonymousType$8("in","Chứa",o,s,c,!1)):this.FilterSelected(new n.$AnonymousType$9("in","Chứa",o,s,c));u.Focus();break;case Core.Enums.KeyCodeEnum.F10:ct=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).firstOrDefault(function(n){return n.Id===u.GuiInfo.Id},null);this.ViewSumary(t,ct);break;case Core.Enums.KeyCodeEnum.F2:Core.Extensions.StringExt.IsNullOrWhiteSpace(o)?this.FilterSelected(new n.$AnonymousType$8("not in","Loại trừ",o,s,c,!1)):this.FilterSelected(new n.$AnonymousType$9("not in","Loại trừ",o,s,c));break;case Core.Enums.KeyCodeEnum.UpArrow:if(p=this.GetItemFocus(),p.RowNo===0)return;if(b=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).where(function(n){return!n.GroupRow}).firstOrDefault(function(n){return n.RowNo===(p.RowNo-1|0)},null),b==null){p.Focus();return}if(b.EmptyRow)return;this.CoppyValue(t,u,s,p,b);break;case Core.Enums.KeyCodeEnum.DownArrow:if(w=this.GetItemFocus(),w==null)return;if(k=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).where(function(n){return!n.GroupRow}).firstOrDefault(function(n){return n.RowNo===(w.RowNo+1|0)},null),k==null){w.Focus();return}if(k.EmptyRow)return;this.CoppyValue(t,u,s,w,k);break;case Core.Enums.KeyCodeEnum.LeftArrow:if(!this.GuiInfo.IsRealtime)return;if(t.preventDefault(),t.stopPropagation(),it=this.LastListViewItem,a=System.Linq.Enumerable.from(it.Children,Core.Components.EditableComponent).firstOrDefault(function(n){return Bridge.referenceEquals(Core.Extensions.HtmlElementExtension.Closest(n.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),Core.Extensions.HtmlElementExtension.Closest(u.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)).previousElementSibling)},null),a==null||Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,it.Children))return;(st=a.ParentElement)!=null?st.focus():null;a.Focus();a.GuiInfo.Editable&&!a.Disabled&&(rt=Bridge.as(a.Element,HTMLInputElement))!=null&&(rt.selectionStart=0,rt.selectionEnd=a.GetValueText().length);break;case Core.Enums.KeyCodeEnum.RightArrow:if(!this.GuiInfo.IsRealtime)return;if(t.preventDefault(),t.stopPropagation(),d=this.LastListViewItem,d==null||Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,d.Children))return;if(v=System.Linq.Enumerable.from(d.Children,Core.Components.EditableComponent).firstOrDefault(function(n){return Bridge.referenceEquals(Core.Extensions.HtmlElementExtension.Closest(n.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),Core.Extensions.HtmlElementExtension.Closest(u.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)).nextElementSibling)},null),v==null)return;(ht=v.ParentElement)!=null?ht.focus():null;v.Focus();v.GuiInfo.Editable&&!v.Disabled&&(ut=Bridge.as(v.Element,HTMLInputElement))!=null&&(ut.selectionStart=0,ut.selectionEnd=v.GetValueText().length);break;case Core.Enums.KeyCodeEnum.Home:pt=System.Linq.Enumerable.from(this.GetSelectedRows(),System.Object).lastOrDefault(null,null);ft=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(null,null);ft!=null&&(ft.Focused=!1);this.DataTable.parentElement.scrollTop=0;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,n,u,f,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.RenderViewPort(),t=1,i.isCompleted())continue;i["continue"](o);return;case 1:i.getAwaitedResult();n=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(null,null);n!=null&&(n.Focused=!0,u=Core.Components.Extensions.ComponentExt.FirstOrDefault(n,function(n){return Bridge.referenceEquals(n.GuiInfo.FieldName,s)}),f=Core.Extensions.HtmlElementExtension.Closest(u.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),n.Focus(),f.focus());r.setResult(null);return;default:r.setResult(null);return}}}catch(h){e=System.Exception.create(h);r.setException(e)}},arguments);return o(),r.task}));break;case Core.Enums.KeyCodeEnum.End:lt=System.Linq.Enumerable.from(this.GetSelectedRows(),System.Object).lastOrDefault(null,null);et=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(function(n){return Bridge.referenceEquals(n.Entity,lt)},null);et!=null&&(et.Focused=!1);this.DataTable.parentElement.scrollTop=this.DataTable.parentElement.scrollHeight;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,n,u,f,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.RenderViewPort(),t=1,i.isCompleted())continue;i["continue"](o);return;case 1:i.getAwaitedResult();n=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).lastOrDefault(null,null);n!=null&&(n.Focused=!0,u=Core.Components.Extensions.ComponentExt.FirstOrDefault(n,function(n){return Bridge.referenceEquals(n.GuiInfo.FieldName,s)}),f=Core.Extensions.HtmlElementExtension.Closest(u.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),n.Focus(),f.focus());r.setResult(null);return;default:r.setResult(null);return}}}catch(h){e=System.Exception.create(h);r.setException(e)}},arguments);return o(),r.task}));break;case Core.Enums.KeyCodeEnum.Insert:ot=this.GetItemFocus();ot.Selected=!ot.Selected;break;case Core.Enums.KeyCodeEnum.D:if(Core.Extensions.EventExt.CtrlOrMetaKey(t)){if(t.stopPropagation(),t.preventDefault(),l=this.GetItemFocus(),l.RowNo===0)return;g=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(function(n){return n.RowNo===(l.RowNo-1|0)},null);Core.Extensions.BridgeExt.SetComplexPropValue(l.Entity,s,Core.Extensions.BridgeExt.GetPropValue(g.Entity,u.GuiInfo.FieldName));h=System.Linq.Enumerable.from(l.FilterChildren$1(function(n){return Bridge.referenceEquals(n.GuiInfo.FieldName,u.GuiInfo.FieldName)}),Core.Components.EditableComponent).firstOrDefault(null,null);h.Dirty=!0;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,i,r,f,e,o=new System.Threading.Tasks.TaskCompletionSource,s,c,t=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5,6,7,8,9],n);switch(n){case 0:if(Bridge.referenceEquals(h.GuiInfo.ComponentType,"SearchEntry")||Bridge.referenceEquals(h.GuiInfo.ComponentType,"Dropdown")){n=1;continue}else{n=3;continue}case 1:if(h.UpdateView(),s=Bridge.as(u,Core.Components.SearchEntry),h.PopulateFields(s.Matched),i=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(h,h.GuiInfo.Events,"change",[l.Entity,s.Matched]),n=2,i.isCompleted())continue;i["continue"](t);return;case 2:i.getAwaitedResult();n=5;continue;case 3:if(h.UpdateView(),h.PopulateFields(),r=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(h,h.GuiInfo.Events,"change",[l.Entity]),n=4,r.isCompleted())continue;r["continue"](t);return;case 4:r.getAwaitedResult();n=5;continue;case 5:if(f=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(l.ListViewSection.ListView,g.ListViewSection.ListView.GuiInfo.Events,"change",[g.Entity]),n=6,f.isCompleted())continue;f["continue"](t);return;case 6:if(f.getAwaitedResult(),this.GuiInfo.IsRealtime){n=7;continue}n=9;continue;case 7:if(e=l.PatchUpdate(),n=8,e.isCompleted())continue;e["continue"](t);return;case 8:e.getAwaitedResult();n=9;continue;case 9:o.setResult(null);return;default:o.setResult(null);return}}}catch(a){c=System.Exception.create(a);o.setException(c)}},arguments);return t(),o.task}))}}},RenderViewPort:function(n,t){var r=0,i=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0],r);switch(r){case 0:n===void 0&&(n=!0);t===void 0&&(t=!1);i.setResult(null);return;default:i.setResult(null);return}}}catch(f){u=System.Exception.create(f);i.setException(u)}},arguments);return f(),i.task},HotKeyF6Handler:function(n,t){var i,r,u,f;switch(t){case Core.Enums.KeyCodeEnum.F6:n.preventDefault();n.stopPropagation();System.Linq.Enumerable.from(this._summarys,HTMLElement).any()&&(i=System.Linq.Enumerable.from(this._summarys,HTMLElement).lastOrDefault(null,null),Bridge.referenceEquals(i.innerHTML,"")?(this.CellSelected.removeAt(this.CellSelected.Count-1|0),this.Wheres.removeAt(this.Wheres.Count-1|0),r=System.Linq.Enumerable.from(this.AdvSearchVM.Conditions,Core.Models.FieldCondition).lastOrDefault(null,null),r!=null&&Bridge.referenceEquals(r.Field.ComponentType,"Input")&&Core.Extensions.StringExt.IsNullOrWhiteSpace(r.Value)?(this.AdvSearchVM.Conditions.removeAt(this.AdvSearchVM.Conditions.Count-1|0),this.AdvSearchVM.Conditions.removeAt(this.AdvSearchVM.Conditions.Count-1|0)):this.AdvSearchVM.Conditions.removeAt(this.AdvSearchVM.Conditions.Count-1|0),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.ActionFilter(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();this._summarys.removeAt(this._summarys.Count-1|0);i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))):(this._waitingLoad&&window.clearTimeout(this._renderPrepareCacheAwaiter),Bridge.referenceEquals(Bridge.toString(i.style.display),"none")?(this.CellSelected.removeAt(this.CellSelected.Count-1|0),this.Wheres.removeAt(this.Wheres.Count-1|0),u=System.Linq.Enumerable.from(this.AdvSearchVM.Conditions,Core.Models.FieldCondition).lastOrDefault(null,null),u!=null&&Bridge.referenceEquals(u.Field.ComponentType,"Input")&&Core.Extensions.StringExt.IsNullOrWhiteSpace(u.Value)?(this.AdvSearchVM.Conditions.removeAt(this.AdvSearchVM.Conditions.Count-1|0),this.AdvSearchVM.Conditions.removeAt(this.AdvSearchVM.Conditions.Count-1|0)):this.AdvSearchVM.Conditions.removeAt(this.AdvSearchVM.Conditions.Count-1|0),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.ActionFilter(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task})),Core.Extensions.HtmlElementExtension.Show(i)):(this._summarys.removeAt(this._summarys.Count-1|0),i.remove())));break;case Core.Enums.KeyCodeEnum.F3:n.preventDefault();n.stopPropagation();System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,i,e,n=new System.Threading.Tasks.TaskCompletionSource,r,u,f,o,s,h=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.GetRealTimeSelectedRows(),t=1,i.isCompleted())continue;i["continue"](h);return;case 1:if(e=i.getAwaitedResult(),r=e,r.Count===0&&(r=(u=System.Object,System.Linq.Enumerable.from(this.RowData.Data,u).toList(u))),f=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).where(function(n){return Bridge.referenceEquals(n.ComponentType,"Number")}).toList(Core.Models.GridPolicy),f.Count===0){Core.Extensions.Toast.Warning("Vui lòng cấu hình");n.setResult(null);return}o=System.Linq.Enumerable.from(f,Core.Models.GridPolicy).select(function(n){var t=System.Linq.Enumerable.from(r,System.Object).select(function(t){return t[n.FieldName]}).where(function(n){return n!=null}).select(function(n){return System.Convert.toDecimal(n)}).sum(System.Decimal.Zero);return(n.ShortDesc||"")+" : "+((t.mod(System.Decimal(2)).gt(System.Decimal(0))?Bridge.Int.format(t,"N2"):Bridge.Int.format(t,"N0"))||"")});Core.Extensions.Toast.Success(Core.Extensions.IEnumerableExtensions.Combine(System.String,o,"<\/br>"),6e3);n.setResult(null);return;default:n.setResult(null);return}}}catch(c){s=System.Exception.create(c);n.setException(s)}},arguments);return h(),n.task}));break;case Core.Enums.KeyCodeEnum.F1:n.preventDefault();n.stopPropagation();this.ToggleAll();break;case Core.Enums.KeyCodeEnum.U:Core.Extensions.EventExt.CtrlOrMetaKey(n)&&(n.preventDefault(),n.stopPropagation(),this.DuplicateSelected(n))}this.LastListViewItem!=null&&this.LastListViewItem.Children!=null&&(f=System.Linq.Enumerable.from(this.LastListViewItem.Children,Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this,function(n){return n.GuiInfo.Id===this.LastComponentFocus.Id}),null),f!=null)&&this.ActionKeyHandler(n,this.LastComponentFocus,this.LastListViewItem,f,Core.Extensions.HtmlElementExtension.Closest(f.Element,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),t)},ViewSumary:function(n,t){this._waitingLoad&&window.clearTimeout(this._renderPrepareCacheAwaiter);Core.Components.Renderer.Escape(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div,"backdrop").Style$1("align-items: center;"),Bridge.fn.bind(this,function(){this.DisposeSumary()}));this._summarys.add(Core.MVVM.Html.Context);Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"popup-content confirm-dialog").Style$1("top: 0;min-width: 90%").Div,"popup-title").InnerHTML("Gộp theo cột hiện thời").Div,"icon-box").Span,"fa fa-times").Event("click",Bridge.fn.cacheBind(this,this.DisposeSumary)).EndOf$1(".popup-title").Div,"popup-body scroll-content");Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"container-rpt");Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"menuBar d-flex");Core.Components.Renderer.PlaceHolder(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"search-input").Style$1("margin-bottom: 12px;").Input.Style$1("width: 300px;").Event$1("input",Bridge.fn.bind(this,function(n){this.SearchTable(n)})),"Tìm kiếm").End.End.Render();Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"search-button").Style$1("margin-bottom: 12px;").Button,"btn btn-info").AsyncEvent$1("click",Bridge.fn.bind(this,function(n){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.ExportExcel(n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task})).I,"fa fal fa-print").End.End.End.Render();Core.MVVM.Html.Instance.EndOf$1(".menuBar");Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"printable");var i=Core.MVVM.Html.Context;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var y=0,p,et,w=new System.Threading.Tasks.TaskCompletionSource,g,nt,h,ot,c,st,u,tt,f,b,k,e,ht,it,ct,l,n,rt,i,o,ut,s,d,lt,r,ft,a,at,v,vt,yt,pt,wt,bt=Bridge.fn.bind(this,function(){try{for(;;){y=System.Array.min([0,1],y);switch(y){case 0:if(g=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this.Wheres,Core.Models.Where).where(function(n){return!n.Group}).select(function(n){return n.FieldName})," and "),nt=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this.Wheres,Core.Models.Where).where(function(n){return n.Group}).select(function(n){return n.FieldName})," or "),h=new(System.Collections.Generic.List$1(System.String).ctor),Core.Extensions.StringExt.IsNullOrWhiteSpace(g)||h.add(System.String.format("({0})",[g])),Core.Extensions.StringExt.IsNullOrWhiteSpace(nt)||h.add(System.String.format("({0})",[nt])),ot=System.Linq.Enumerable.from(h,System.String).any()?System.String.format("({0})",[Core.Extensions.IEnumerableExtensions.Combine(System.String,h," and ")]):"",c=System.Linq.Enumerable.from(this.BasicHeader,Core.Models.GridPolicy).where(function(n){return Bridge.referenceEquals(n.ComponentType,"Number")&&!Bridge.referenceEquals(n.FieldName,t.FieldName)}).toList(Core.Models.GridPolicy),st=System.Linq.Enumerable.from(c,Core.Models.GridPolicy).select(Bridge.fn.bind(this,function(n){return System.String.format("FORMAT(SUM(isnull([{0}].{1},0)),'#,#') as {2}",this.GuiInfo.RefName,n.FieldName,n.FieldName)})).toList(System.String),u=this.GuiInfo.PreQuery,tt={},u!=null&&Core.Extensions.Utils.IsFunction(u,tt)&&(u=Bridge.toString(tt.v.call(this,this,this.EditForm))),p=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName).PostAsync(System.Array.type(System.Array.type(System.Object)),Core.Extensions.IEnumerableExtensions.Combine(System.String,st),(System.String.format("ViewSumary?group={0}",[t.FieldName])||"")+(System.String.format("&tablename={0}",[this.GuiInfo.RefName])||"")+(System.String.format("&refname={0}",[t.RefName])||"")+(System.String.format("&formatsumary={0}",[this.GuiInfo.FormatSumaryField])||"")+(System.String.format("&sql={0}&orderby={1}",this.Sql,this.GuiInfo.OrderBySumary)||"")+(System.String.format("&where={0} {1}",ot,Core.Extensions.StringExt.IsNullOrWhiteSpace(u)?"":System.String.format("{0} {1}",System.Linq.Enumerable.from(this.Wheres,Core.Models.Where).any()?" and ":"",u))||"")),y=1,p.isCompleted())continue;p["continue"](bt);return;case 1:et=p.getAwaitedResult();f=et;b=f[System.Array.index(0,f)];k=null;f.length>1&&(k=f[System.Array.index(1,f)]);e="";e=Bridge.referenceEquals(t.ComponentType,"Dropdown")?"text":Bridge.referenceEquals(t.ComponentType,"Datepicker")?"date":Bridge.referenceEquals(t.ComponentType,"Number")?"number":"text";this._summaryId="sumary"+Bridge.getHashCode(new System.Random.$ctor1(10));ht=k!=null?(it=System.Object,System.Linq.Enumerable.from(k,it).toDictionary(function(n){return n[Core.Components.EditableComponent.IdField]},null,System.Object,it)):null;Core.Components.Renderer.ClassName(Core.Components.Renderer.Width(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"grid-wrapper sticky").Style$1("max-height: calc(100vh - 317px) !important;").Div,"table-wrapper printable").Table.Id(this._summaryId),"100%"),"table").Thead.TRow.Render();Core.Components.Renderer.IText(Core.MVVM.Html.Instance.Th.DataAttr$1("sort-type",e).Event$1("click",Bridge.fn.bind(this,function(n){this.SortTable(n,0)})).Style$1("max-width: 100%;"),t.ShortDesc).End.Render();Core.Components.Renderer.IText(Core.MVVM.Html.Instance.Th.DataAttr$1("sort-type","number").Event$1("click",Bridge.fn.bind(this,function(n){this.SortTable(n,1)})).Style$1("max-width: 100%;"),"Tổng dữ liệu").End.Render();Core.Extensions.IEnumerableExtensions.ForEach$1(Core.Models.GridPolicy,c,Bridge.fn.bind(this,function(n,t){var i="";i=Bridge.referenceEquals(n.ComponentType,"Dropdown")?"text":Bridge.referenceEquals(n.ComponentType,"Datepicker")?"date":Bridge.referenceEquals(n.ComponentType,"Number")?"number":"text";Core.Components.Renderer.IHtml(Core.MVVM.Html.Instance.Th.Event$1("click",Bridge.fn.bind(this,function(n){this.SortTable(n,t+2|0)})).DataAttr$1("sort-type",i).Style$1("max-width: 100%;"),n.ShortDesc).End.Render()}));Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.thead);Core.MVVM.Html.Instance.TBody.Render();ct=System.Linq.Enumerable.from(b,System.Object).sum(function(n){return System.Convert.toDecimal(Bridge.referenceEquals(System.String.replaceAll(Bridge.toString(n.TotalRecord),",",""),"")?"0":System.String.replaceAll(Bridge.toString(n.TotalRecord),",",""))},System.Decimal.Zero);l=Bridge.getEnumerator(b);try{while(l.moveNext()){n=l.Current;n[t.FieldName]=(rt=n[t.FieldName],rt!=null?rt:"");i=Bridge.toString(n[t.FieldName]);o={v:""};ut="";s={v:""};Bridge.referenceEquals(t.ComponentType,"Dropdown")?(d=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.Object,System.Object,ht,n[t.FieldName]),d==null?i="":(i=Bridge.toString(d[System.String.replaceAll((lt=t.FormatCell.split("}"))[System.Array.index(0,lt)],"{","")]),o.v=Bridge.toString(d.Id),s.v=i)):Bridge.referenceEquals(t.ComponentType,"Datepicker")?(r=Core.Extensions.DateTimeExt.TryParseDateTime(Bridge.toString(n[t.FieldName])),i=Bridge.equals(r,null)?null:System.DateTime.format(System.Nullable.getValue(r),"dd/MM/yyyy"),o.v=Bridge.equals(r,null)?null:System.DateTime.format(System.Nullable.getValue(r),"dd/MM/yyyy"),s.v=Bridge.equals(r,null)?null:System.DateTime.format(System.Nullable.getValue(r),"dd/MM/yyyy"),ut=System.Nullable.toString(r,function(n){return System.DateTime.format(n)})):Bridge.referenceEquals(t.ComponentType,"Number")?(ft=n[t.FieldName]==null||Bridge.referenceEquals(Bridge.toString(n[t.FieldName]),"")?Bridge.getDefaultValue(System.Decimal):System.Decimal(Bridge.toString(n[t.FieldName])),i=ft.equalsT(Bridge.getDefaultValue(System.Decimal))?"":Bridge.Int.format(ft,"N0"),o.v=Bridge.toString(n[t.FieldName]),s.v=i):(o.v=Bridge.toString(n[t.FieldName]),s.v=Bridge.toString(n[t.FieldName]));Core.MVVM.Html.Instance.TRow.Event("dblclick",function(n,i,r){return Bridge.fn.bind(n,function(){this.FilterSumary(t,i.v,r.v)})}(this,o,s)).Event$1("click",Bridge.fn.bind(this,function(n){this.FocusCell(n,this.HeaderComponentMap.getItem(Bridge.getHashCode(t)))})).Render();Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.TData.Style$1("max-width: 100%;").DataAttr$1("value",ut),Bridge.referenceEquals(t.ComponentType,"Number")?"text-right":"text-left"),Core.Extensions.Utils.DecodeSpecialChar(i)).End.Render();Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.TData.Style$1("max-width: 100%;"),"text-right"),Bridge.toString(n.TotalRecord)).End.Render();a=Bridge.getEnumerator(c);try{while(a.moveNext())at=a.Current,Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.TData.Style$1("max-width: 100%;"),"text-right"),Bridge.toString(n[at.FieldName])).End.Render()}finally{Bridge.is(a,System.IDisposable)&&a.System$IDisposable$Dispose()}Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.tr)}}finally{Bridge.is(l,System.IDisposable)&&l.System$IDisposable$Dispose()}Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.tbody);Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.TFooter.TRow,"summary").Render();Core.Components.Renderer.IText(Core.MVVM.Html.Instance.TData.Style$1("max-width: 100%;"),"Tổng cộng").End.Render();Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.TData,"text-right").Style$1("max-width: 100%;"),Bridge.Int.format(ct,"N0")).End.Render();v=Bridge.getEnumerator(c);try{while(v.moveNext())vt={v:v.Current},yt=System.Linq.Enumerable.from(b,System.Object).select(function(n,t){return function(n){return System.String.replaceAll(Bridge.toString(n[t.v.FieldName]),",","")}}(this,vt)).toList(System.String),pt=System.Linq.Enumerable.from(yt,System.String).where(function(n){return!Core.Extensions.StringExt.IsNullOrWhiteSpace(n)}).sum(function(n){return System.Decimal(n)},System.Decimal.Zero),Core.Components.Renderer.IHtml(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.TData,"text-right").Style$1("max-width: 100%;"),Bridge.Int.format(pt,"N0")).End.Render()}finally{Bridge.is(v,System.IDisposable)&&v.System$IDisposable$Dispose()}w.setResult(null);return;default:w.setResult(null);return}}}catch(kt){wt=System.Exception.create(kt);w.setException(wt)}},arguments);return bt(),w.task}))},RenderCopyPasteMenu:function(n){var t;n&&(Core.Components.Forms.ContextMenu.Instance.MenuItems.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fa-copy",t.Text="Copy",t.Click=Bridge.fn.cacheBind(this,this.CopySelected),t)),Core.Components.Forms.ContextMenu.Instance.MenuItems.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fa fa-clone",t.Text="Copy & Dán",t.Click=Bridge.fn.cacheBind(this,this.DuplicateSelected),t)));n&&Core.Extensions.IEnumerableExtensions.HasElement(System.Object,Core.Components.ListView._copiedRows)&&Core.Components.Forms.ContextMenu.Instance.MenuItems.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-paste",t.Text="Dán",t.Click=Bridge.fn.cacheBind(this,this.PasteSelected),t))},CoppyValue:function(n,t,i,r,u){var s,e,o,f;if((this.LastListViewItem=u,r.Focused=!1,u.Focused=!0,!Core.Extensions.StringExt.IsNullOrWhiteSpace(i))&&(e=System.Linq.Enumerable.from(u.FilterChildren$1(function(n){return n.GuiInfo.Id===t.GuiInfo.Id}),Core.Components.EditableComponent).firstOrDefault(null,null),e!=null&&(this.LastComponentFocus=e.GuiInfo,(s=e.ParentElement)!=null?s.focus():null,e.Focus(),e.GuiInfo.Editable&&!e.Disabled&&(o=Bridge.as(e.Element,HTMLInputElement))!=null&&(o.selectionStart=0,o.selectionEnd=e.GetValueText().length),this.LastElementFocus=e.Element,Core.Extensions.EventExt.ShiftKey(n)))){if(Core.Extensions.BridgeExt.SetComplexPropValue(u.Entity,i,Core.Components.Extensions.ComponentExt.GetValue(t)),f=System.Linq.Enumerable.from(u.FilterChildren$1(function(n){return Bridge.referenceEquals(n.GuiInfo.FieldName,e.GuiInfo.FieldName)}),Core.Components.EditableComponent).firstOrDefault(null,null),f.Disabled||!f.GuiInfo.Editable)return;f.Dirty=!0;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,r,e,o,s,h,c=new System.Threading.Tasks.TaskCompletionSource,l,a,i=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5,6,7,8,9,10,11,13],n);switch(n){case 0:if(Bridge.referenceEquals(f.GuiInfo.ComponentType,"SearchEntry")||Bridge.referenceEquals(f.GuiInfo.ComponentType,"Dropdown")){n=1;continue}else{n=3;continue}case 1:if(f.UpdateView(),l=Bridge.as(t,Core.Components.SearchEntry),f.PopulateFields(l.Matched),r=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(f,f.GuiInfo.Events,"change",[u.Entity,l.Matched]),n=2,r.isCompleted())continue;r["continue"](i);return;case 2:r.getAwaitedResult();n=5;continue;case 3:if(f.UpdateView(),f.PopulateFields(),e=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(f,f.GuiInfo.Events,"change",[u.Entity]),n=4,e.isCompleted())continue;e["continue"](i);return;case 4:e.getAwaitedResult();n=5;continue;case 5:if(o=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(u.ListViewSection.ListView,u.ListViewSection.ListView.GuiInfo.Events,"change",[u.Entity]),n=6,o.isCompleted())continue;o["continue"](i);return;case 6:if(o.getAwaitedResult(),this.GuiInfo.IsRealtime){n=7;continue}n=13;continue;case 7:if(System.Int32.parse(Bridge.toString(u.Entity[Core.Components.EditableComponent.IdField]))>0){n=8;continue}else{n=10;continue}case 8:if(s=u.PatchUpdate(),n=9,s.isCompleted())continue;s["continue"](i);return;case 9:s.getAwaitedResult();n=12;continue;case 10:if(h=u.CreateUpdate(),n=11,h.isCompleted())continue;h["continue"](i);return;case 11:h.getAwaitedResult();n=12;continue;case 13:c.setResult(null);return;default:c.setResult(null);return}}}catch(v){a=System.Exception.create(v);c.setException(a)}},arguments);return i(),c.task}))}},AddRow:function(n,t,i){var r=0,u,o,f=new System.Threading.Tasks.TaskCompletionSource,e,s,h=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(t===void 0&&(t=0),i===void 0&&(i=!0),u=Core.Components.ListView.prototype.AddRow.call(this,n,t,i),r=1,u.isCompleted())continue;u["continue"](h);return;case 1:o=u.getAwaitedResult();e=o;this.StickyColumn(e);this.RenderIndex();f.setResult(e);return;default:f.setResult(null);return}}}catch(c){s=System.Exception.create(c);f.setException(s)}},arguments);return h(),f.task},AddNewEmptyRow:function(){var r,n,t,i,u,f;this.Disabled||!this.Editable||System.Nullable.eq((r=this.EmptyRowSection)!=null?Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent,r.Children):null,!0)||(n=this.EmptyRowData(),Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.DefaultVal)||(t="",i={},Core.Extensions.Utils.IsFunction(this.GuiInfo.DefaultVal,i)&&(t=Bridge.toString(i.v.call(this,Bridge.unbox(n),Bridge.unbox(this.Entity)))),u=Newtonsoft.Json.JsonConvert.DeserializeObject(t,System.Object),Core.Extensions.ReflectionExt.CopyPropFromAct(n,u)),n[Core.Components.EditableComponent.IdField]=Bridge.box(-Math.abs(Bridge.getHashCode(n))|0,System.Int32),f=this.RenderRowData(this.Header,n,this.EmptyRowSection,null,!0),this.GuiInfo.TopEmpty?this.DataTable.insertBefore(this.EmptyRowSection.Element,this.MainSection.Element):this.DataTable.insertBefore(this.MainSection.Element,this.EmptyRowSection.Element),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterEmptyRowCreated,[Bridge.box(this.emptyRow,System.Boolean,System.Nullable.toStringFn(System.Boolean.toString),System.Nullable.getHashCode)]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task})))},EmptyRowData:function(){var n,t=Bridge.Reflection.getType(((n=this.GuiInfo.Reference.Namespace,n!=null?n:Core.Clients.Client.ModelNamespace)||"")+(this.GuiInfo.RefName||""))||System.Object;return Bridge.createInstance(t)},FilterColumns:function(n){var r=System.Linq.Enumerable.from(n,Core.Models.GridPolicy).any(Bridge.fn.bind(this,function(n){return System.Nullable.eq(n.ComponentId,this.GuiInfo.Id)})),i,t;return n=r?System.Linq.Enumerable.from(n,Core.Models.GridPolicy).where(Bridge.fn.bind(this,function(n){return System.Nullable.eq(n.ComponentId,this.GuiInfo.Id)})).toList(Core.Models.GridPolicy):System.Linq.Enumerable.from(n,Core.Models.GridPolicy).where(function(n){return n.ComponentId==null}).toList(Core.Models.GridPolicy),i=this.EditForm.GetElementPolicies$1(System.Linq.Enumerable.from(n,Core.Models.GridPolicy).select(function(n){return n.Id}).ToArray(System.Int32),Core.Extensions.Utils.GridPolicyId),t=System.Linq.Enumerable.from(n,Core.Models.GridPolicy).where(function(n){return!n.Hidden}).where(function(n){return!n.IsPrivate||Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy,System.Linq.Enumerable.from(i,Core.Models.FeaturePolicy).where(function(t){return t.RecordId===n.Id}),function(n){return n.CanRead})}).select(Bridge.fn.cacheBind(this,this.CalcTextAlign)).orderByDescending(function(n){return n.Frozen}).thenByDescending(function(n){return Bridge.referenceEquals(n.ComponentType,"Button")}).thenBy(function(n){return n.Order}).toList(Core.Models.GridPolicy),Core.Components.ListView.OrderHeaderGroup(t),this.Header.clear(),this.Header.add(Core.Components.GridView.ToolbarColumn),this.Header.AddRange(t),this.HeaderComponentMap=System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Models.GridPolicy,System.Int32,this.Header,function(n){return Bridge.getHashCode(n)}),Core.Models.GridPolicy).toDictionary(function(n){return Bridge.getHashCode(n)},function(n){return Core.Extensions.Utils.MapToComponent(n)},System.Int32,Core.Models.Component),t},ApplyFilter:function(n){var t=0,i,o,r=new System.Threading.Tasks.TaskCompletionSource,u,f,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(n===void 0&&(n=!0),this._sum=!1,u=this.CalcFilterQuery(n),this.DataTable.parentElement.scrollTop=0,i=this.ReloadData(u,!1,void 0,void 0,n),t=1,i.isCompleted())continue;i["continue"](e);return;case 1:o=i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(s){f=System.Exception.create(s);r.setException(f)}},arguments);return e(),r.task},ColumnResizeHandler:function(){var n=this,t=function(n){if(n!=null){var t=n.querySelectorAll("th");[].forEach.call(t,function(n){var t=document.createElement("div");t.classList.add("resizer");n.appendChild(t);i(n,t)})}},i=function(t,i){var u=0,r=0,o=function(n){n.preventDefault();u=n.clientX;var o=window.getComputedStyle(t);r=parseInt(o.width,10);document.addEventListener("mousemove",f);document.addEventListener("mouseup",e);i.classList.add("resizing")},f=function(n){n.preventDefault();var i=n.clientX-u;t.style.width=r+i+"px";t.style.minWidth=r+i+"px";t.style.maxWidth=r+i+"px"},e=function e(){n.UpdateHeader();i.classList.remove("resizing");document.removeEventListener("mousemove",f);document.removeEventListener("mouseup",e)};i.addEventListener("mousedown",o)};t(this.DataTable)},RenderContent:function(){var t,n;if(this.LoadRerender||this.Rerender(),this.AddSections(),!this._hasFirstLoad&&this.VirtualScroll){this._hasFirstLoad=!0;return}if(n=this.GetViewPortItem(),this.FormattedRowData=this.GuiInfo.LocalRender?this.GuiInfo.LocalData:this.RowData.Data,Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.FormattedRowData)){this.MainSection.DisposeChildren();this.DomLoaded();return}if(this.DisposeNoRecord(),this.VirtualScroll&&this.FormattedRowData.Count>n&&(this.FormattedRowData=System.Linq.Enumerable.from(this.FormattedRowData,System.Object).take(n).toList(System.Object)),Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent,this.MainSection.Children)){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.UpdateExistRowsWrapper(!0,!1,0,n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task}));return}this.MainSection.Show=!1;(t=System.Object,System.Linq.Enumerable.from(this.FormattedRowData,t).toList(t)).ForEach(Bridge.fn.bind(this,function(n){Core.MVVM.Html.Take(this.MainSection.Element);this.RenderRowData(this.Header,n,this.MainSection)}));this.MainSection.Show=!0;this.RenderIndex();this.DomLoaded()},SetFocusingCom:function(){var n,t;this.AutoFocus||(this.EntityFocusId!=null&&this.LastComponentFocus!=null?(n=System.Linq.Enumerable.from(Core.Extensions.IEnumerableExtensions.Flattern(Core.Components.EditableComponent,this.MainSection.Children,function(n){return n.Children}),Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this,function(n){return System.Nullable.eq(Bridge.unbox(n.Entity[Core.Components.EditableComponent.IdField]),this.EntityFocusId)&&n.GuiInfo.Id===this.LastComponentFocus.Id}),null),n!=null?(t=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(Bridge.fn.bind(this,function(n){return System.Nullable.eq(Bridge.unbox(n.Entity[Core.Components.EditableComponent.IdField]),this.EntityFocusId)}),null),t.Focused=!0,Core.Extensions.HtmlElementExtension.AddClass(n.ParentElement,"cell-selected"),this.LastListViewItem=t,this.LastComponentFocus=n.GuiInfo,this.LastElementFocus=n.Element):this.HeaderSection.Element.focus()):this.HeaderSection.Element.focus())},UpdateExistRowsWrapper:function(n,t){var i=0,u,r=new System.Threading.Tasks.TaskCompletionSource,f,e=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3],i);switch(i){case 0:if(!this._hasFirstLoad){this._hasFirstLoad=!0;r.setResult(null);return}if(n){i=1;continue}i=3;continue;case 1:if(u=this.LoadMasterData(this.FormattedRowData),i=2,u.isCompleted())continue;u["continue"](e);return;case 2:u.getAwaitedResult();i=3;continue;case 3:this.UpdateExistRows(t);this.RenderIndex();this.DomLoaded();r.setResult(null);return;default:r.setResult(null);return}}}catch(o){f=System.Exception.create(o);r.setException(f)}},arguments);return e(),r.task},UpdateExistRows:function(n){var t=this.FormattedRowData.ToArray(),i=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).take(t.length).ToArray(Core.Components.ListViewItem),r;Core.Extensions.IEnumerableExtensions.ForEach$1(Core.Components.ListViewItem,i,function(n,i){n.Entity=t[System.Array.index(i,t)];Core.Extensions.IEnumerableExtensions.ForEach(Core.Components.EditableComponent,Core.Extensions.IEnumerableExtensions.Flattern(Core.Components.EditableComponent,n.Children,function(n){return n.Children}),function(n){n.Entity=t[System.Array.index(i,t)]});n.UpdateView()});r=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).count()<=t.length;r?System.Linq.Enumerable.from(t,System.Object).skip(i.length).forEach(Bridge.fn.bind(this,function(n){var t=this.RenderRowData(this.Header,n,this.MainSection);this.StickyColumn(t)})):System.Linq.Enumerable.from(this.MainSection.Children,Core.Components.EditableComponent).skip(t.length).ToArray(Core.Components.EditableComponent).forEach(function(n){n.Dispose()});System.Nullable.hasValue(n)&&(this.Dirty=System.Nullable.getValue(n));this.RenderIndex()},RenderRowData:function(n,t,i,r,u){var e,s,f,c,o,h,l;return r===void 0&&(r=null),u===void 0&&(u=!1),s=i.Element,Core.MVVM.Html.Take(s),f=(e=new Core.Components.GridViewItem(Core.MVVM.ElementType.tr),e.EmptyRow=u,e.Entity=t,e.ParentElement=s,e.PreQueryFn=this._preQueryFn,e.ListView=this,e.GuiInfo=this.GuiInfo,e),i.AddChild(f,r),c=Bridge.unbox(t[Core.Components.EditableComponent.IdField]),c<=0&&!u&&(f.Dirty=!0),o=Bridge.as(Core.MVVM.Html.Context,HTMLTableRowElement),o.tabIndex=-1,System.Nullable.hasValue(r)&&((System.Nullable.gte(r,System.Linq.Enumerable.from(o.parentElement.children,HTMLElement).count())||System.Nullable.lt(r,0))&&(r=0),o.parentElement.insertBefore(o,o.parentElement.children[System.Nullable.getValue(r)])),Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.GridPolicy,n)&&n.ForEach(Bridge.fn.bind(this,function(n){f.RenderTableCell(t,this.HeaderComponentMap.getItem(Bridge.getHashCode(n)))})),u&&this.Children.ForEach(function(n){n.AlwaysLogHistory=!0}),h=System.Nullable.eq(Bridge.unbox(t.StatusId),Core.Enums.ApprovalStatusEnum.Approved)||System.Nullable.eq(Bridge.unbox(t.StatusId),Core.Enums.ReceiptStatusEnum.Finished),h&&(f.Disabled=!0,Core.Components.Extensions.ComponentExt.SetDisabled$1(f,!1,["btnEdit"])),this.Disabled&&Core.Components.Extensions.ComponentExt.SetDisabled$1(f,!1,["btnEdit"]),l=System.Nullable.eq(Bridge.unbox(t.InsertedBy),Core.Clients.Client.Token.UserId),h&&(f.Disabled=!0,Core.Components.Extensions.ComponentExt.SetDisabled$1(f,!1,["btnEdit"])),this.Disabled&&Core.Components.Extensions.ComponentExt.SetDisabled$1(f,!1,["btnEdit"]),System.Nullable.gt(Bridge.unbox(t.Id),0)?Core.Extensions.HtmlElementExtension.RemoveClass(f.Element,"new-row"):Core.Extensions.HtmlElementExtension.AddClass(f.Element,"new-row"),f},AddSummaries:function(){var n,t;System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).all(function(n){return Core.Extensions.StringExt.IsNullOrEmpty(n.Summary)})||(n=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).where(function(n){return!Core.Extensions.StringExt.IsNullOrWhiteSpace(n.Summary)}),System.Linq.Enumerable.from(this.MainSection.Element.children,HTMLElement).where(function(n){return Core.Extensions.HtmlElementExtension.HasClass(n,Core.Components.GridView.SummaryClass)}).ToArray(HTMLElement).forEach(function(n){n.remove()}),t=System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Models.GridPolicy,System.String,n,function(n){return n.Summary}),Core.Models.GridPolicy).count(),n.forEach(Bridge.fn.bind(this,function(n){this.AddNewEmptyRow();this.RenderSummaryRow(n,this.Header,Bridge.as(this.FooterSection.Element,HTMLTableSectionElement),t)})))},RenderSummaryRow:function(n,t,i,r){var f,u=this.CreateSummaryTableRow(n,i,r),o,e;if(u!=null){if(o=Core.Extensions.HtmlElementExtension.HasClass(u,Core.Components.GridView.SummaryClass),e=(f=n.SummaryColSpan,f!=null?f:0),Core.Extensions.HtmlElementExtension.AddClass(u,Core.Components.GridView.SummaryClass),!o&&t.contains(n)&&Core.Components.GridView.ResetSummaryRow(u,e),!t.contains(n)){Core.Components.GridView.ClearSummaryContent(u);return}Core.Components.GridView.SetSummaryHeaderText(n,u);this.CalcSumCol(n,t,u,e)}},SetRowData:function(n){this.RowData._data.clear();var t=Core.Extensions.IEnumerableExtensions.HasElement(System.Object,n);t&&n.ForEach(Bridge.fn.cacheBind(this.RowData._data,this.RowData._data.add));this.RenderContent();this.Entity!=null&&this.ShouldSetEntity&&Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this.RowData.Data)},CreateSummaryTableRow:function(n,t,i){var e=n.Summary,f,r,u;return t==null?null:(f=System.Linq.Enumerable.from(t.rows,HTMLTableRowElement).count(function(n){return Core.Extensions.HtmlElementExtension.HasClass(n,Core.Components.GridView.SummaryClass)}),r=System.Linq.Enumerable.from(t.rows,HTMLTableRowElement).reverse().firstOrDefault(function(n){return Core.Extensions.HtmlElementExtension.HasClass(n,Core.Components.GridView.SummaryClass)&&System.Linq.Enumerable.from(n.children,HTMLElement).any(function(n){return Bridge.referenceEquals(n.textContent,e)})},null),r==null&&(r=System.Linq.Enumerable.from(t.rows,HTMLTableRowElement).lastOrDefault(null,null)),f>=i)?r:this.MainSection.FirstChild==null?null:(u=Bridge.as(this.MainSection.FirstChild.Element.cloneNode(!0),HTMLTableRowElement),t.appendChild(u),Core.Extensions.IEnumerableExtensions.ForEach(HTMLElement,u.children,function(n){n.innerHTML=null}),u)},CalcSumCol:function(n,t,i,r){var u=t.indexOf(n),f=i.cells[(u-r|0)+1|0],e=Core.Extensions.StringExt.IsNullOrWhiteSpace(n.FormatCell)?"{0:n0}":n.FormatCell,o=System.Linq.Enumerable.from(this.RowData.Data,System.Object).any(function(t){return Core.Extensions.ReflectionExt.IsNumber(Bridge.Reflection.getMembers(Bridge.getType(t),16,284,n.FieldName).rt)}),s=System.Linq.Enumerable.from(this.RowData.Data,System.Object).sum(function(t){var i=t[n.FieldName];return i==null?System.Decimal(0):System.Convert.toDecimal(i)},System.Decimal.Zero);f.textContent=Core.Extensions.Utils.FormatEntity$1(e,o?s:System.Decimal(System.Linq.Enumerable.from(this.RowData.Data,System.Object).count()))},RowChangeHandler:function(n,t,i,r){var u=0,h,c,l,d,a,v,y,p,w=new System.Threading.Tasks.TaskCompletionSource,e,b,o,s,k,g,nt,tt,f=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],u);switch(u){case 0:if(r===void 0&&(r=null),h=System.Threading.Tasks.Task.delay(50),u=1,h.isCompleted())continue;h["continue"](f);return;case 1:if(h.getAwaitedResult(),t.EmptyRow&&i.EvType==="change"){u=2;continue}u=10;continue;case 2:if(c=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforeCreated,[n,this]),u=3,c.isCompleted())continue;c["continue"](f);return;case 3:if(c.getAwaitedResult(),this.GuiInfo.IsRealtime){u=4;continue}else{u=6;continue}case 4:if(b=n,Core.Extensions.ReflectionExt.ClearReferences(b),l=new Core.Clients.Client.$ctor1(this.GuiInfo.Reference.Name).CreateAsync(System.Object,b),u=5,l.isCompleted())continue;l["continue"](f);return;case 5:d=l.getAwaitedResult();e=d;Core.Extensions.ReflectionExt.CopyPropFrom$1(t.Entity,e);Bridge.referenceEquals(this.GuiInfo.ComponentType,"VirtualGrid")&&this.CacheData.add(e);this.Dirty=!1;u=7;continue;case 6:e=t.Entity;this.Dirty=!0;u=7;continue;case 7:if(Bridge.referenceEquals(this.GuiInfo.ComponentType,"VirtualGrid")||Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this.RowData.Data),a=this.LoadMasterData(System.Array.init([e],System.Object)),u=8,a.isCompleted())continue;a["continue"](f);return;case 8:if(a.getAwaitedResult(),t.UpdateView$1(!0),this.MoveEmptyRow(t),this.EmptyRowSection.Children.clear(),this.AddNewEmptyRow(),v=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterCreated,[n]),u=9,v.isCompleted())continue;v["continue"](f);return;case 9:v.getAwaitedResult();u=10;continue;case 10:if(r!=null&&Bridge.referenceEquals(r.ComponentType,"GridView")){u=11;continue}u=13;continue;case 11:if(y=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,r.GuiInfo.Events,i.EvType,[n,t]),u=12,y.isCompleted())continue;y["continue"](f);return;case 12:y.getAwaitedResult();u=13;continue;case 13:if(p=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,i.EvType,[n,t]),u=14,p.isCompleted())continue;p["continue"](f);return;case 14:p.getAwaitedResult();i.EvType==="change"&&(this.PopulateFields$1(),this.RenderIndex(),this.GuiInfo.IsSumary&&this.AddSummaries(),this.LastListViewItem=t,o=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).where(function(n){return n.Editable}).toList(Core.Models.GridPolicy),s=System.Linq.Enumerable.from(o,Core.Models.GridPolicy).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,r!=null?r.GuiInfo.FieldName:null)},null),(Bridge.referenceEquals(s.ComponentType,"SearchEntry")||Bridge.referenceEquals(s.ComponentType,"Dropdown"))&&n[s.FieldName]!=null&&(k=o.indexOf(s),o.Count>(k+1|0)&&(g=o.getItem(k+1|0),nt=System.Linq.Enumerable.from(t.Children,Core.Components.EditableComponent).where(function(n){return Bridge.referenceEquals(n!=null?n.GuiInfo.FieldName:null,g.FieldName)}).firstOrDefault(null,null),t.Focused=!0,nt.Focus())));w.setResult(null);return;default:w.setResult(null);return}}}catch(it){tt=System.Exception.create(it);w.setException(tt)}},arguments);return f(),w.task},MoveEmptyRow:function(n){this.RowData.Data.contains(n.Entity)||(this.GuiInfo.TopEmpty?(this.RowData.Data.insert(0,n.Entity),this.MainSection.Children.contains(this.EmptyRowSection.FirstChild)||this.MainSection.Children.insert(0,this.EmptyRowSection.FirstChild),Core.Extensions.HtmlElementExtension.Prepend(this.MainSection.Element,this.EmptyRowSection.Element.firstElementChild)):(this.RowData.Data.add(n.Entity),this.MainSection.Element.appendChild(this.EmptyRowSection.Element.firstElementChild),this.MainSection.Children.contains(this.EmptyRowSection.FirstChild)||this.MainSection.Children.add(this.EmptyRowSection.FirstChild)),this.GuiInfo.IsRealtime&&Core.Extensions.HtmlElementExtension.RemoveClass(n.Element,"new-row"),n.Parent=this.MainSection,n.ListViewSection=this.MainSection)},RenderTableHeader:function(n){Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.GridPolicy,n)&&(n=this.Header);this.HeaderSection.Element==null&&this.AddSections();Core.Extensions.IEnumerableExtensions.ForEach$1(Core.Models.GridPolicy,n,function(n,t){n.PostOrder=t});this.HeaderSection.DisposeChildren();var t=System.Linq.Enumerable.from(n,Core.Models.GridPolicy).any(function(n){return!System.String.isNullOrEmpty(n.GroupName)});Core.MVVM.Html.Take(this.HeaderSection.Element).Clear().TRow.ForEach$2(Core.Models.GridPolicy,n,Bridge.fn.bind(this,function(i){var r,u;if(t&&!System.String.isNullOrEmpty(i.GroupName)){if(!Bridge.referenceEquals(i,System.Linq.Enumerable.from(n,Core.Models.GridPolicy).firstOrDefault(function(n){return Bridge.referenceEquals(n.GroupName,i.GroupName)},null)))return;Core.MVVM.Html.Instance.Th.Render();Core.Components.Renderer.ColSpan(Core.MVVM.Html.Instance,System.Linq.Enumerable.from(n,Core.Models.GridPolicy).count(function(n){return Bridge.referenceEquals(n.GroupName,i.GroupName)}));Core.Components.Renderer.IHtml(Core.MVVM.Html.Instance,i.GroupName).Render();return}Core.Components.Renderer.TextAlign(Core.Components.Renderer.Width(Core.Components.Renderer.TabIndex(Core.MVVM.Html.Instance.Th,-1).DataAttr$1("field",i.FieldName).DataAttr("id",Bridge.box(i.Id,System.Int32)),i.AutoFit?"auto":i.Width).Style$1(System.String.format("{0};min-width: {1}; max-width: {2}",i.Style,i.MinWidth,i.MaxWidth)),Core.Enums.TextAlign.center).Event$4(Core.Models.GridPolicy,"contextmenu",Bridge.fn.cacheBind(this,this.HeaderContextMenu),i).Event$1("focusout",Bridge.fn.bind(this,function(n){this.FocusOutHeader(n,i)})).Event$1("keydown",Bridge.fn.bind(this,function(n){this.ThHotKeyHandler(n,i)}));this.HeaderSection.AddChild((r=new Core.Components.Section.ctor(Core.MVVM.Html.Context),r.GuiInfo=Core.Extensions.Utils.MapToComponent(i),r));t&&System.String.isNullOrEmpty(i.GroupName)&&Core.Components.Renderer.RowSpan(Core.MVVM.Html.Instance,2);!t&&System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).any(function(n){return Core.Extensions.StringExt.HasAnyChar(n.GroupName)})&&Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance,"header-group");i.StatusBar&&Core.Components.Renderer.Icon(Core.MVVM.Html.Instance,"fa fa-edit").Event("click",Bridge.fn.cacheBind(this,this.ToggleAll)).End.Render();u=System.Linq.Enumerable.from(this.AdvSearchVM.OrderBy,Core.Models.OrderBy).firstOrDefault(function(n){return n.FieldId===i.Id},null);u!=null&&Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance,System.Nullable.eq(u.OrderbyOptionId,Core.Enums.OrderbyOption.ASC)?"asc":"desc").Render();Core.Extensions.StringExt.IsNullOrWhiteSpace(i.Icon)?i.StatusBar||Core.Components.Renderer.IHtml(Core.MVVM.Html.Instance.Event$1("click",Bridge.fn.bind(this,function(n){this.ClickHeader(n,i)})),i.ShortDesc).Render():Core.Components.Renderer.Margin(Core.Components.Renderer.Icon(Core.MVVM.Html.Instance,i.Icon),Core.Components.Direction.right,0).End.Render();Bridge.referenceEquals(i.ComponentType,"Number")&&(Core.MVVM.Html.Instance.Div.End.Render(),Core.MVVM.Html.Instance.Span.Style$1("display: block;").End.Render());i.Description!=null&&Core.MVVM.Html.Instance.Attr$1("title",i.Description);Core.Clients.Client.CheckHasRole(Core.Enums.RoleEnum.System)&&(Core.MVVM.Html.Instance.Attr$1("contenteditable","true"),Core.MVVM.Html.Instance.Event$1("input",Bridge.fn.bind(this,function(n){this.ChangeHeader(n,i)})));Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.th)})).EndOf(Core.MVVM.ElementType.tr).Render();t&&Core.MVVM.Html.Instance.TRow.ForEach$2(Core.Models.GridPolicy,n,Bridge.fn.bind(this,function(n){var i;t&&!System.String.isNullOrEmpty(n.GroupName)&&(Core.Components.Renderer.TextAlign(Core.Components.Renderer.Width(Core.MVVM.Html.Instance.Th.DataAttr$1("field",n.FieldName),n.Width).Style$1(System.String.format("min-width: {0}; max-width: {1}",n.MinWidth,n.MaxWidth)),n.TextAlignEnum).Event$4(Core.Models.GridPolicy,"contextmenu",Bridge.fn.cacheBind(this,this.HeaderContextMenu),n).InnerHTML(n.ShortDesc),this.HeaderSection.AddChild((i=new Core.Components.Section.ctor(Core.MVVM.Html.Context.parentElement),i.GuiInfo=Core.Extensions.Utils.MapToComponent(n),i)))}));this.HeaderSection.Children=System.Linq.Enumerable.from(this.HeaderSection.Children,Core.Components.EditableComponent).orderBy(function(n){return n.GuiInfo.PostOrder}).toList(Core.Components.EditableComponent);this.GuiInfo.Focus||this.ColumnResizeHandler()},ChangeHeader:function(n,t){window.clearTimeout(this._imeout);this._imeout=window.setTimeout(Bridge.fn.bind(this,function(){var i=0,r,o,u,h,f,s,e=Bridge.fn.bind(this,function(){for(;;){i=System.Array.min([0,1,2],i);switch(i){case 0:if(r=new Core.Clients.Client.$ctor1("GridPolicy").GetAsync(Core.Models.GridPolicy,t.Id),i=1,r.isCompleted())continue;r["continue"](e);return;case 1:if(o=r.getAwaitedResult(),f=o,s=Bridge.as(n.target,HTMLElement),f.ShortDesc=s.textContent.trim(),u=new Core.Clients.Client.$ctor1("GridPolicy").UpdateAsync(Core.Models.GridPolicy,f),i=2,u.isCompleted())continue;u["continue"](e);return;case 2:h=u.getAwaitedResult();return;default:return}}},arguments);e()}),1e3)},CustomQuery:function(n){var i=0,e,c,o,r=new System.Threading.Tasks.TaskCompletionSource,t,l,a,u,v,f,s,y,h=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3,4,5],i);switch(i){case 0:if(e=new Core.Clients.Client.$ctor1("User").PostAsync(System.Array.type(System.Array.type(System.Object)),n,"Cmd"),i=1,e.isCompleted())continue;e["continue"](h);return;case 1:if(c=e.getAwaitedResult(),t=c,Core.Extensions.IEnumerableExtensions.Nothing(System.Array.type(System.Object),t)){this.SetRowData(null);r.setResult(null);return}if(l=t.length>1?t[System.Array.index(1,t)][0].total:t[System.Array.index(0,t)].length,t.length>3&&(a=System.Linq.Enumerable.from(t[System.Array.index(2,t)],System.Object).select(function(n){return Core.Extensions.BridgeExt.CastProp(Core.Models.GridPolicy,n)}).toList(Core.Models.GridPolicy),this.FilterColumns(a),this.RenderTableHeader(this.Header)),u=new(System.Collections.Generic.List$1(System.Object).$ctor1)(t[System.Array.index(0,t)]),t.length>4){i=2;continue}else{i=3;continue}case 2:v=System.Linq.Enumerable.from(t[System.Array.index(3,t)]).select(function(n){return Bridge.cast(n,System.Object)}).groupBy(function(n){return n.RefName});f=Bridge.getEnumerator(v);try{while(f.moveNext())s={v:f.Current},this.SetRemoteSource(s.v.toList(System.Object),s.v.key(),System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).firstOrDefault(function(n,t){return function(n){return Bridge.referenceEquals(n.RefName,t.v.key())}}(this,s),null))}finally{Bridge.is(f,System.IDisposable)&&f.System$IDisposable$Dispose()}this.SyncMasterData(t[System.Array.index(3,t)],this.Header);i=5;continue;case 3:if(o=this.LoadMasterData(u),i=4,o.isCompleted())continue;o["continue"](h);return;case 4:o.getAwaitedResult();i=5;continue;case 5:this.SetRowData(u);this.UpdatePagination(l,u.Count);r.setResult(u);return;default:r.setResult(null);return}}}catch(p){y=System.Exception.create(p);r.setException(y)}},arguments);return h(),r.task},MoveLeft:function(n,t){var u=Bridge.as(t.target,HTMLElement),r=u.parentElement,f=r.parentElement.querySelectorAll("th"),i=Core.Extensions.IEnumerableExtensions.FindItemAndIndex(Node,f,function(n){return Bridge.referenceEquals(n,r)}).Item2;r.parentElement.parentElement.parentElement.querySelectorAll("tr").forEach(function(n){var t=[].slice.call(n.querySelectorAll("th, td")),u,r;t[0].classList.contains("summary-header")||(u=i,r=i-1,u>r?t[r].parentNode&&t[r].parentNode.insertBefore(t[u],t[r]):t[r].parentNode&&t[r].parentNode.insertBefore(t[u],t[r].nextSibling))});this.SwapList(i-1|0,i-2|0);this.SwapHeader(i,i-1|0);this.ResetOrder();this.UpdateHeader()},MoveRight:function(n,t){var u=Bridge.as(t.target,HTMLElement),r=u.parentElement,f=r.parentElement.querySelectorAll("th"),i=Core.Extensions.IEnumerableExtensions.FindItemAndIndex(Node,f,function(n){return Bridge.referenceEquals(n,r)}).Item2;r.parentElement.parentElement.parentElement.querySelectorAll("tr").forEach(function(n){var t=[].slice.call(n.querySelectorAll("th, td")),u,r;t[0].classList.contains("summary-header")||(u=i,r=i+1,u>r?t[r].parentNode&&t[r].parentNode.insertBefore(t[u],t[r]):t[r].parentNode&&t[r].parentNode.insertBefore(t[u],t[r].nextSibling))});this.SwapList(i-1|0,i);this.SwapHeader(i,i+1|0);this.ResetOrder();this.UpdateHeader()},ChangeFieldOrder:function(n,t){var i,f;if(!this.GuiInfo.CanCache&&!Core.Extensions.StringExt.IsNullOrWhiteSpace(n.ShortDesc)){i=this.GetSortedFields();i.containsKey(n.FieldName)||i.add(n.FieldName,!1);var u=t.target,e=Core.MVVM.Html.Take(u).Closest(Core.MVVM.ElementType.th).GetContext(),r=e.querySelector(".fa");r==null?Core.Components.Renderer.Icon(Core.MVVM.Html.Take(u),"fa fa-sort-amount-up-alt").End.Render():Core.Extensions.HtmlElementExtension.HasClass(r,"fa-sort-amount-down-alt")?(i.remove(n.FieldName),Core.Extensions.HtmlElementExtension.RemoveClass(r,"fa-sort-amount-down-alt")):Core.Extensions.HtmlElementExtension.HasClass(r,"fa-sort-amount-up-alt")&&(i.setItem(n.FieldName,!0),Core.Extensions.HtmlElementExtension.ReplaceClass(r,"fa-sort-amount-up-alt","fa-sort-amount-down-alt"));f=Bridge.toArray(System.Linq.Enumerable.from(i,System.Collections.Generic.KeyValuePair$2(System.String,System.Boolean)).select(function(n){return(n.key||"")+((n.value?" desc":"")||"")})).join(",");this.DataSourceFilter=Core.Extensions.OdataExt.ApplyClause(this.DataSourceFilter,f,Core.Extensions.OdataExt.OrderByKeyword);this.UpdateView()}},GetSortedFields:function(){var r=new(System.Collections.Generic.Dictionary$2(System.String,System.Boolean).ctor),t=this.DataSourceFilter,i;return Core.Extensions.StringExt.IsNullOrWhiteSpace(t)?r:(t=t.replace(new RegExp("\\s+")," "),i=Core.Extensions.OdataExt.GetClausePart(t,Core.Extensions.OdataExt.OrderByKeyword),Core.Extensions.StringExt.IsNullOrWhiteSpace(i))?r:System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(System.Object,System.String,System.Linq.Enumerable.from(i.split(","),System.String).select(function(t){if(Core.Extensions.StringExt.IsNullOrWhiteSpace(t))return null;var i=t.split(" ");return i.length<1?null:new n.$AnonymousType$10(i[System.Array.index(0,i)],i.length===2&&Bridge.referenceEquals(i[System.Array.index(1,i)].toLowerCase(),"desc"))}).where(function(n){return n!=null}),function(n){return n.Field}),System.Object).toDictionary(function(n){return n.Field},function(n){return n.Desc},System.String,System.Boolean)},ToggleAll:function(){var n=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).any(function(n){return n.Selected});n?this.ClearSelected():this.RowAction(function(n){n.EmptyRow||(n.Selected=!0)});this.VirtualScroll&&System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var t=0,i,u,r=new System.Threading.Tasks.TaskCompletionSource,f,e,o,s,h,c=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3],t);switch(t){case 0:if(!n){t=1;continue}t=3;continue;case 1:if(f=this.CalcDatasourse(this.Paginator.Options.Total,0,"false"),i=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName,(o=this.GuiInfo.Reference)!=null?o.Namespace:null).GetList(System.Object,System.String.format("{0}&$select=Id",[f]),!0),t=2,i.isCompleted())continue;i["continue"](c);return;case 2:u=i.getAwaitedResult();e=u;s=System.Linq.Enumerable.from(e.Value,System.Object).select(function(n){return n[Core.Components.EditableComponent.IdField]}).select(function(n){return Bridge.cast(n,System.Int32)}).toList(System.Int32);this.SelectedIds=s;t=3;continue;case 3:r.setResult(null);return;default:r.setResult(null);return}}}catch(l){h=System.Exception.create(l);r.setException(h)}},arguments);return c(),r.task}))},HeaderContextMenu:function(t,i){t.preventDefault();t.stopPropagation();var r=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm,this),f=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Section,this),u=Core.Components.Forms.ContextMenu.Instance;u.Top=Core.Extensions.EventExt.Top(t);u.Left=Core.Extensions.EventExt.Left(t);u.MenuItems=Bridge.fn.bind(this,function(r){var u;return r.add((u=new Core.Components.Forms.ContextMenuItem,u.Icon="fal fa-eye",u.Text="Hiện tiêu đề",u.Click=Bridge.fn.cacheBind(this,this.ShowWidth),u.Parameter=new n.$AnonymousType$11(i,t),u)),r.add((u=new Core.Components.Forms.ContextMenuItem,u.Icon="fal fa-eye-slash",u.Text="Ẩn tiêu đề",u.Click=Bridge.fn.cacheBind(this,this.HideWidth),u.Parameter=new n.$AnonymousType$11(i,t),u)),r.add((u=new Core.Components.Forms.ContextMenuItem,u.Icon=i.Frozen?"fal fa-snowflakes":"fal fa-snowflake",u.Text=i.Frozen?"Hủy định cột":"Cố định cột",u.Click=Bridge.fn.cacheBind(this,this.FrozenColumn),u.Parameter=new n.$AnonymousType$11(i,t),u)),r})(new(System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem).ctor));Core.Clients.Client.SystemRole&&u.MenuItems.AddRange(Bridge.fn.bind(this,function(n){var t;return n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-wrench",t.Text="Tùy chọn cột dữ liệu",t.Click=Bridge.fn.cacheBind(r,r.HeaderProperties),t.Parameter=i,t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-clone",t.Text="Clone cột",t.Click=Bridge.fn.cacheBind(this,this.CloneHeader),t.Parameter=i,t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-trash-alt",t.Text="Xóa cột",t.Click=Bridge.fn.cacheBind(this,this.RemoveHeader),t.Parameter=i,t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-cog",t.Text="Tùy chọn bảng dữ liệu",t.Click=Bridge.fn.cacheBind(r,r.ComponentProperties),t.Parameter=this.GuiInfo,t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-cogs",t.Text="Tùy chọn vùng dữ liệu",t.Click=Bridge.fn.cacheBind(r,r.SectionProperties),t.Parameter=f.ComponentGroup,t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Icon="fal fa-folder-open",t.Text="Thiết lập chung",t.Click=Bridge.fn.cacheBind(r,r.FeatureProperties),t.Parameter=r.Feature,t)),n})(new(System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem).ctor)));u.Render()},UpdateHeader:function(){var n=window.localStorage.getItem("isSave");n==null&&(window.clearTimeout(this.awaiter1),this.awaiter1=window.setTimeout(Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.UpdateUserSetting(),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()}),100))},HideWidth:function(n){var i=Bridge.as(n.header,Core.Models.GridPolicy),t=Bridge.as(n.events,Event);t.target.firstChild.remove();t.target.style.minWidth="";t.target.style.maxWidth="";t.target.style.width="";System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.UpdateUserSetting(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},HideColumn:function(n){var f=Bridge.as(n.header,Core.Models.GridPolicy),t=Bridge.as(n.events,Event),i=$(t.target).closest("table"),r=$(t.target).closest("th,td"),u=r[0].cellIndex+1;i.find("tbody tr, thead tr").children(":nth-child("+u+")").hide();console.log($(t.target).attr("data-field"));System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.UpdateUserSettingColumn(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},UpdateUserSetting:function(){var n=0,i,h,r,c,u,l,f=new System.Threading.Tasks.TaskCompletionSource,a,o,v,s,t,y,e=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5,6],n);switch(n){case 0:if(i=new Core.Clients.Client.$ctor1("UserSetting").FirstOrDefaultAsync(Core.Models.UserSetting,System.String.format("?$filter=UserId eq {0} and Name eq 'ListView-{1}'",Bridge.box(Core.Clients.Client.Token.UserId,System.Int32),Bridge.box(this.GuiInfo.Id,System.Int32))),n=1,i.isCompleted())continue;i["continue"](e);return;case 1:if(h=i.getAwaitedResult(),this._settings=h,a=(o=Core.Components.EditableComponent,System.Linq.Enumerable.from(System.Linq.Enumerable.from(this.HeaderSection.Children,Core.Components.EditableComponent).where(function(n){return n.GuiInfo!=null}).toList(Core.Components.EditableComponent),o).toDictionary(function(n){return n.GuiInfo.Id},null,System.Int32,o)),this.BasicHeader.ForEach(function(n){var t=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.Int32,Core.Components.EditableComponent,a,n.Id);t!=null&&(n.Width=t.Element.offsetWidth+"px",n.MaxWidth=t.Element.offsetWidth+"px",n.MinWidth=t.Element.offsetWidth+"px")}),v=this.BasicHeader,s=Newtonsoft.Json.JsonConvert.SerializeObject(v),this._settings==null){n=2;continue}else{n=4;continue}case 2:if(this._settings=(t=new Core.Models.UserSetting,t.UserId=Core.Clients.Client.Token.UserId,t.Name="ListView-"+this.GuiInfo.Id,t.Value=s,t),r=new Core.Clients.Client.$ctor1("UserSetting").CreateAsync(Core.Models.UserSetting,this._settings),n=3,r.isCompleted())continue;r["continue"](e);return;case 3:c=r.getAwaitedResult();this._settings=c;n=6;continue;case 4:if(this._settings.Value=s,this._settings.Name="ListView-"+this.GuiInfo.Id,u=new Core.Clients.Client.$ctor1("UserSetting").UpdateAsync(Core.Models.UserSetting,this._settings),n=5,u.isCompleted())continue;u["continue"](e);return;case 5:l=u.getAwaitedResult();this._settings=l;n=6;continue;case 6:f.setResult(null);return;default:f.setResult(null);return}}}catch(p){y=System.Exception.create(p);f.setException(y)}},arguments);return e(),f.task},UpdateUserSettingColumn:function(){var n=0,i,s,r,h,u,c,f=new System.Threading.Tasks.TaskCompletionSource,l,o,t,a,e=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5,6],n);switch(n){case 0:if(i=new Core.Clients.Client.$ctor1("UserSetting").FirstOrDefaultAsync(Core.Models.UserSetting,System.String.format("?$filter=UserId eq {0} and Name eq 'ListView-{1}'",Bridge.box(Core.Clients.Client.Token.UserId,System.Int32),Bridge.box(this.GuiInfo.Id,System.Int32))),n=1,i.isCompleted())continue;i["continue"](e);return;case 1:if(s=i.getAwaitedResult(),this._settings=s,this.BasicHeader.ForEach(function(n){n.Active=!1}),l=this.BasicHeader,o=Newtonsoft.Json.JsonConvert.SerializeObject(l),this._settings==null){n=2;continue}else{n=4;continue}case 2:if(this._settings=(t=new Core.Models.UserSetting,t.UserId=Core.Clients.Client.Token.UserId,t.Name="ListView-"+this.GuiInfo.Id,t.Value=o,t),r=new Core.Clients.Client.$ctor1("UserSetting").CreateAsync(Core.Models.UserSetting,this._settings),n=3,r.isCompleted())continue;r["continue"](e);return;case 3:h=r.getAwaitedResult();this._settings=h;n=6;continue;case 4:if(this._settings.Value=o,this._settings.Name="ListView-"+this.GuiInfo.Id,u=new Core.Clients.Client.$ctor1("UserSetting").UpdateAsync(Core.Models.UserSetting,this._settings),n=5,u.isCompleted())continue;u["continue"](e);return;case 5:c=u.getAwaitedResult();this._settings=c;n=6;continue;case 6:f.setResult(null);return;default:f.setResult(null);return}}}catch(v){a=System.Exception.create(v);f.setException(a)}},arguments);return e(),f.task},ShowWidth:function(n){var i=Bridge.as(n.header,Core.Models.GridPolicy),t=Bridge.as(n.events,Event);t.target.firstChild.length||t.target.prepend(i.ShortDesc);t.target.style.minWidth="";t.target.style.maxWidth="";t.target.style.width="";System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.UpdateUserSetting(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},FrozenColumn:function(n){var t=Bridge.as(n.header,Core.Models.GridPolicy);System.Linq.Enumerable.from(this.BasicHeader,Core.Models.GridPolicy).firstOrDefault(function(n){return n.Id===t.Id},null).Frozen=!t.Frozen;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.UpdateUserSetting(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();window.location.reload();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},CloneHeader:function(n){var t,i=Bridge.as(n,Core.Models.GridPolicy),r=(t=new Core.Components.Forms.ConfirmDialog,t.Content="Bạn có chắc chắn muốn clone cột này không?",t);r.Render();r.YesConfirmed=Bridge.fn.combine(r.YesConfirmed,Bridge.fn.bind(this,function(){var n=0,t,u,o,f,r,e=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(o=function(n){return n.add(i.Id),n}(new(System.Collections.Generic.List$1(System.Int32).ctor)),f=new Core.Clients.Client.$ctor1("GridPolicy"),i.Id=0,t=f.CreateAsync(Core.Models.GridPolicy,i),n=1,t.isCompleted())continue;t["continue"](e);return;case 1:u=t.getAwaitedResult();r=u;r!=null?(this.Header.add(r),this.Header=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).orderByDescending(function(n){return n.Frozen}).thenByDescending(function(n){return Bridge.referenceEquals(n.ComponentType,"Button")}).thenBy(function(n){return n.Order}).toList(Core.Models.GridPolicy),this.Rerender(),Core.Extensions.Toast.Success("Clone thàng công")):Core.Extensions.Toast.Warning("Clone error");return;default:return}}},arguments);e()}))},RemoveHeader:function(n){var t,r=Bridge.as(n,Core.Models.GridPolicy),i=(t=new Core.Components.Forms.ConfirmDialog,t.Content="Bạn có chắc chắn muốn xóa cột này không?",t);i.Render();i.YesConfirmed=Bridge.fn.combine(i.YesConfirmed,Bridge.fn.bind(this,function(){var n=0,t,i,u,f,e=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(u=function(n){return n.add(r.Id),n}(new(System.Collections.Generic.List$1(System.Int32).ctor)),t=new Core.Clients.Client.$ctor1("GridPolicy").HardDeleteAsync(u),n=1,t.isCompleted())continue;t["continue"](e);return;case 1:i=t.getAwaitedResult();f=i;f?(this.Header.remove(r),this.Rerender(),Core.Extensions.Toast.Success("delete success")):Core.Extensions.Toast.Warning("delete error");return;default:return}}},arguments);e()}))},AddOrUpdateRows:function(n){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=Core.Components.ListView.prototype.AddOrUpdateRows.call(this,n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task},RemoveRowById:function(n){Core.Components.ListView.prototype.RemoveRowById.call(this,n);this.RenderIndex()},RemoveRow:function(n){Core.Components.ListView.prototype.RemoveRow.call(this,n);this.RenderIndex()},HardDeleteConfirmed:function(n){var t=0,i,f,r=new System.Threading.Tasks.TaskCompletionSource,u,e,o,s=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=Core.Components.ListView.prototype.HardDeleteConfirmed.call(this,n),t=1,i.isCompleted())continue;i["continue"](s);return;case 1:f=i.getAwaitedResult();u=f;Bridge.referenceEquals(this.GuiInfo.ComponentType,"VirtualGrid")&&u!=null&&(e=System.Linq.Enumerable.from(u,System.Object).select(function(n){return System.Int32.parse(Bridge.toString(n[Core.Components.EditableComponent.IdField]))}).toList(System.Int32),this.CacheData.RemoveAll(function(n){return e.contains(System.Int32.parse(Bridge.toString(n[Core.Components.EditableComponent.IdField])))}));this.RenderIndex();this.GuiInfo.IsSumary&&this.AddSummaries();r.setResult(u);return;default:r.setResult(null);return}}}catch(h){o=System.Exception.create(h);r.setException(o)}},arguments);return s(),r.task},RenderIndex:function(n){var t,i,r;(n===void 0&&(n=null),n==null&&(n=(t=(i=this.Paginator)!=null&&(r=i.Options)!=null?r.StartIndex:null,t!=null?t:0)),Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,this.MainSection.Children))||System.Linq.Enumerable.from(this.MainSection.Children).select(function(n){return Bridge.cast(n,Core.Components.ListViewItem)}).forEach(Bridge.fn.bind(this,function(t,i){var r,u;Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,t.Children)||t.FirstChild==null||t.FirstChild.Element==null||(r=Core.Extensions.HtmlElementExtension.Closest(t.FirstChild.Element,"td").previousElementSibling,r!=null)&&(u=Bridge.Int.clip32(System.Nullable.add(n,i)),r.innerHTML=System.Nullable.toString(u,null),t.Selected=this.SelectedIds.contains(Bridge.unbox(t.Entity[Core.Components.EditableComponent.IdField])),t.RowNo=System.Nullable.getValue(u))}))},UpdateView:function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);this.Editable||this.GuiInfo.CanCache?this.RowAction$1(function(n){return!n.EmptyRow},function(r){r.UpdateView(n,t,i)}):n&&(this.DisposeNoRecord(),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.ListViewSearch.RefershListView(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task})))},RowChangeHandlerGrid:function(n,t,i,r){var u=0,o,s,h,c,l=new System.Threading.Tasks.TaskCompletionSource,f,v,a,y,p,w,e=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1,2,3,4,5,6],u);switch(u){case 0:if(r===void 0&&(r=null),o=System.Threading.Tasks.Task.delay(Core.Components.GridView.CellCountNoSticky),u=1,o.isCompleted())continue;o["continue"](e);return;case 1:if(o.getAwaitedResult(),t.EmptyRow&&i.EvType==="change"){u=2;continue}u=5;continue;case 2:if(s=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforeCreated,[n]),u=3,s.isCompleted())continue;s["continue"](e);return;case 3:if(s.getAwaitedResult(),t.EmptyRow=!1,this.MoveEmptyRow(t),f=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).where(function(n){return n.Editable}).toList(Core.Models.GridPolicy),v=System.Linq.Enumerable.from(f,Core.Models.GridPolicy).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,r!=null?r.GuiInfo.FieldName:null)},null),a=f.indexOf(v),f.Count>(a+1|0)&&(y=f.getItem(a+1|0),p=System.Linq.Enumerable.from(t.Children,Core.Components.EditableComponent).where(function(n){return Bridge.referenceEquals(n!=null?n.GuiInfo.FieldName:null,y.FieldName)}).firstOrDefault(null,null),p.Focus()),this.EmptyRowSection.Children.clear(),this.AddNewEmptyRow(),Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this.RowData.Data),h=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterCreated,[n]),u=4,h.isCompleted())continue;h["continue"](e);return;case 4:h.getAwaitedResult();u=5;continue;case 5:if(this.AddSummaries(),this.PopulateFields$1(),this.RenderIndex(),c=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[n]),u=6,c.isCompleted())continue;c["continue"](e);return;case 6:c.getAwaitedResult();l.setResult(null);return;default:l.setResult(null);return}}}catch(b){w=System.Exception.create(b);l.setException(w)}},arguments);return e(),l.task},GetViewPortItem:function(){var t,i,n;return this.Element==null||!Core.Extensions.HtmlElementExtension.HasClass(this.Element,System.Enum.toString(Core.Components.Position,Core.Components.Position.sticky))?System.Linq.Enumerable.from(this.RowData.Data,System.Object).count():(n=((this.Element.clientHeight-(t=(i=this.HeaderSection.Element)!=null?i.clientHeight:null,t!=null?t:0)|0)-this.Paginator.Element.clientHeight|0)-this._theadTable|0,System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).all(function(n){return Core.Extensions.StringExt.IsNullOrEmpty(n.Summary)})||(n=n-this._tfooterTable|0),this.GuiInfo.CanAdd&&(n=n-this._rowHeight|0),this.GetRowCountByHeight(n))}}});Bridge.define("$AnonymousType$6",n,{$kind:"anonymous",ctors:{ctor:function(n){this.ReasonOfChange=n}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$6)?Bridge.equals(this.ReasonOfChange,t.ReasonOfChange):!1},getHashCode:function(){return Bridge.addHash([7550196191,this.ReasonOfChange])},toJSON:function(){return{ReasonOfChange:this.ReasonOfChange}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"ReasonOfChange",t:16,rt:System.String,g:{a:2,n:"get_ReasonOfChange",t:8,rt:System.String,fg:"ReasonOfChange"},fn:"ReasonOfChange"}]}}}}});Bridge.define("$AnonymousType$7",n,{$kind:"anonymous",ctors:{ctor:function(n,t,i,r,u,f){this.Operator=n;this.OperatorText=t;this.Value=i;this.FieldName=r;this.ValueText=u;this.Shift=f}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$7)?Bridge.equals(this.Operator,t.Operator)&&Bridge.equals(this.OperatorText,t.OperatorText)&&Bridge.equals(this.Value,t.Value)&&Bridge.equals(this.FieldName,t.FieldName)&&Bridge.equals(this.ValueText,t.ValueText)&&Bridge.equals(this.Shift,t.Shift):!1},getHashCode:function(){return Bridge.addHash([7550196192,this.Operator,this.OperatorText,this.Value,this.FieldName,this.ValueText,this.Shift])},toJSON:function(){return{Operator:this.Operator,OperatorText:this.OperatorText,Value:this.Value,FieldName:this.FieldName,ValueText:this.ValueText,Shift:this.Shift}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"FieldName",t:16,rt:System.String,g:{a:2,n:"get_FieldName",t:8,rt:System.String,fg:"FieldName"},fn:"FieldName"},{a:2,n:"Operator",t:16,rt:System.String,g:{a:2,n:"get_Operator",t:8,rt:System.String,fg:"Operator"},fn:"Operator"},{a:2,n:"OperatorText",t:16,rt:System.String,g:{a:2,n:"get_OperatorText",t:8,rt:System.String,fg:"OperatorText"},fn:"OperatorText"},{a:2,n:"Shift",t:16,rt:System.Boolean,g:{a:2,n:"get_Shift",t:8,rt:System.Boolean,fg:"Shift",box:function(n){return Bridge.box(n,System.Boolean,System.Boolean.toString)}},fn:"Shift"},{a:2,n:"Value",t:16,rt:System.String,g:{a:2,n:"get_Value",t:8,rt:System.String,fg:"Value"},fn:"Value"},{a:2,n:"ValueText",t:16,rt:System.String,g:{a:2,n:"get_ValueText",t:8,rt:System.String,fg:"ValueText"},fn:"ValueText"}]}}}}});Bridge.define("$AnonymousType$8",n,{$kind:"anonymous",ctors:{ctor:function(n,t,i,r,u,f){this.Operator=n;this.OperatorText=t;this.Value=i;this.FieldName=r;this.ValueText=u;this.IsSearch=f}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$8)?Bridge.equals(this.Operator,t.Operator)&&Bridge.equals(this.OperatorText,t.OperatorText)&&Bridge.equals(this.Value,t.Value)&&Bridge.equals(this.FieldName,t.FieldName)&&Bridge.equals(this.ValueText,t.ValueText)&&Bridge.equals(this.IsSearch,t.IsSearch):!1},getHashCode:function(){return Bridge.addHash([7550196193,this.Operator,this.OperatorText,this.Value,this.FieldName,this.ValueText,this.IsSearch])},toJSON:function(){return{Operator:this.Operator,OperatorText:this.OperatorText,Value:this.Value,FieldName:this.FieldName,ValueText:this.ValueText,IsSearch:this.IsSearch}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"FieldName",t:16,rt:System.String,g:{a:2,n:"get_FieldName",t:8,rt:System.String,fg:"FieldName"},fn:"FieldName"},{a:2,n:"IsSearch",t:16,rt:System.Boolean,g:{a:2,n:"get_IsSearch",t:8,rt:System.Boolean,fg:"IsSearch",box:function(n){return Bridge.box(n,System.Boolean,System.Boolean.toString)}},fn:"IsSearch"},{a:2,n:"Operator",t:16,rt:System.String,g:{a:2,n:"get_Operator",t:8,rt:System.String,fg:"Operator"},fn:"Operator"},{a:2,n:"OperatorText",t:16,rt:System.String,g:{a:2,n:"get_OperatorText",t:8,rt:System.String,fg:"OperatorText"},fn:"OperatorText"},{a:2,n:"Value",t:16,rt:System.String,g:{a:2,n:"get_Value",t:8,rt:System.String,fg:"Value"},fn:"Value"},{a:2,n:"ValueText",t:16,rt:System.String,g:{a:2,n:"get_ValueText",t:8,rt:System.String,fg:"ValueText"},fn:"ValueText"}]}}}}});Bridge.define("$AnonymousType$9",n,{$kind:"anonymous",ctors:{ctor:function(n,t,i,r,u){this.Operator=n;this.OperatorText=t;this.Value=i;this.FieldName=r;this.ValueText=u}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$9)?Bridge.equals(this.Operator,t.Operator)&&Bridge.equals(this.OperatorText,t.OperatorText)&&Bridge.equals(this.Value,t.Value)&&Bridge.equals(this.FieldName,t.FieldName)&&Bridge.equals(this.ValueText,t.ValueText):!1},getHashCode:function(){return Bridge.addHash([7550196194,this.Operator,this.OperatorText,this.Value,this.FieldName,this.ValueText])},toJSON:function(){return{Operator:this.Operator,OperatorText:this.OperatorText,Value:this.Value,FieldName:this.FieldName,ValueText:this.ValueText}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"FieldName",t:16,rt:System.String,g:{a:2,n:"get_FieldName",t:8,rt:System.String,fg:"FieldName"},fn:"FieldName"},{a:2,n:"Operator",t:16,rt:System.String,g:{a:2,n:"get_Operator",t:8,rt:System.String,fg:"Operator"},fn:"Operator"},{a:2,n:"OperatorText",t:16,rt:System.String,g:{a:2,n:"get_OperatorText",t:8,rt:System.String,fg:"OperatorText"},fn:"OperatorText"},{a:2,n:"Value",t:16,rt:System.String,g:{a:2,n:"get_Value",t:8,rt:System.String,fg:"Value"},fn:"Value"},{a:2,n:"ValueText",t:16,rt:System.String,g:{a:2,n:"get_ValueText",t:8,rt:System.String,fg:"ValueText"},fn:"ValueText"}]}}}}});Bridge.define("$AnonymousType$10",n,{$kind:"anonymous",ctors:{ctor:function(n,t){this.Field=n;this.Desc=t}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$10)?Bridge.equals(this.Field,t.Field)&&Bridge.equals(this.Desc,t.Desc):!1},getHashCode:function(){return Bridge.addHash([7550208474,this.Field,this.Desc])},toJSON:function(){return{Field:this.Field,Desc:this.Desc}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"Desc",t:16,rt:System.Boolean,g:{a:2,n:"get_Desc",t:8,rt:System.Boolean,fg:"Desc",box:function(n){return Bridge.box(n,System.Boolean,System.Boolean.toString)}},fn:"Desc"},{a:2,n:"Field",t:16,rt:System.String,g:{a:2,n:"get_Field",t:8,rt:System.String,fg:"Field"},fn:"Field"}]}}}}});Bridge.define("$AnonymousType$11",n,{$kind:"anonymous",ctors:{ctor:function(n,t){this.header=n;this.events=t}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$11)?Bridge.equals(this.header,t.header)&&Bridge.equals(this.events,t.events):!1},getHashCode:function(){return Bridge.addHash([7550208730,this.header,this.events])},toJSON:function(){return{header:this.header,events:this.events}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"events",t:16,rt:Event,g:{a:2,n:"get_events",t:8,rt:Event,fg:"events"},fn:"events"},{a:2,n:"header",t:16,rt:Core.Models.GridPolicy,g:{a:2,n:"get_header",t:8,rt:Core.Models.GridPolicy,fg:"header"},fn:"header"}]}}}}});Bridge.define("Core.Components.Forms.ConfirmDialog",{inherits:[Core.Components.Forms.EditForm],statics:{methods:{RenderConfirm:function(n,t,i){var u,r;return i===void 0&&(i=null),r=(u=new Core.Components.Forms.ConfirmDialog,u.Content=n,u),r.Render(),r.YesConfirmed=Bridge.fn.combine(r.YesConfirmed,t),r.NoConfirmed=Bridge.fn.combine(r.NoConfirmed,i),r},RenderConfirm$1:function(n,t){var r,i;return t===void 0&&(t="Đóng"),i=(r=new Core.Components.Forms.ConfirmDialog,r.Content=n,r),i.YesText=t,i.IgnoreNoButton=!0,i.Render(),i}}},fields:{_cancel:!1,_yesBtn:null,PElement:null,Precision:null,YesConfirmed:null,NoConfirmed:null,Canceled:null},props:{Textbox:null,Number:null,Datepicker:null,SearchEntry:null,IgnoreNoButton:!1,MultipleLine:!1,YesText:null,NoText:null,CancelText:null,Content:null,NeedAnswer:!1,ComType:null,IgnoreCancelButton:!1,DisposeAfterYes:!1},ctors:{init:function(){this.MultipleLine=!0;this.YesText="Đồng ý";this.NoText="Không";this.CancelText="Đóng";this.Content="Bạn có chắc chắn muốn xóa dữ liệu?";this.ComType="Textbox";this.IgnoreCancelButton=!0;this.DisposeAfterYes=!0},ctor:function(){this.$initialize();Core.Components.Forms.EditForm.ctor.call(this,null);this.PopulateDirty=!1;this.Title="Xác nhận"}},methods:{Render:function(){var n,t;Core.Components.Renderer.Escape(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.PElement||document.body).Div,"backdrop").Style$1("align-items: center;"),Bridge.fn.bind(this,function(){this.Dispose()}));this.PElement!=null&&Core.MVVM.Html.Instance.Style$1("position: fixed !important;");this.Element=Core.MVVM.Html.Context;this.ParentElement=this.Element.parentElement;Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.IHtml(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"popup-content confirm-dialog").Style$1("top: auto;").Div,"popup-title"),this.Title).Div,"icon-box").Span,"fa fa-times").Event("click",Bridge.fn.cacheBind(this,this.CloseDispose)).EndOf$1(".popup-title").Div,"popup-body");Core.Components.Renderer.MarginRem(Core.Components.Renderer.IHtml(Core.MVVM.Html.Instance.P,this.Content).End.Div.Event$1("keydown",Bridge.fn.cacheBind(this,this.HotKeyHandler)),Core.Components.Direction.top,1);this.NeedAnswer&&(Bridge.referenceEquals(this.ComType,"Textbox")&&(this.Textbox=(n=new Core.Components.Textbox((t=new Core.Models.Component,t.PlainText="Nhập câu trả lời",t.ShowLabel=!1,t.FieldName=Core.Components.CompareGridView.ReasonOfChange,t.Row=2,t)),n.MultipleLine=this.MultipleLine,n),this.AddChild(this.Textbox),Core.MVVM.Html.Instance.End.Render()),Bridge.referenceEquals(this.ComType,"Number")&&(this.Number=new Core.Components.Number((n=new Core.Models.Component,n.PlainText="Nhập câu trả lời",n.FieldName=Core.Components.CompareGridView.ReasonOfChange,n.Visibility=!0,n.ShowLabel=!1,n)),this.AddChild(this.Number),Core.MVVM.Html.Instance.End.Render()),Bridge.referenceEquals(this.ComType,"Datepicker")&&(this.Datepicker=new Core.Components.Datepicker((n=new Core.Models.Component,n.PlainText="Chọn ngày",n.ShowLabel=!1,n.FieldName=Core.Components.CompareGridView.ReasonOfChange,n.Row=2,n.FocusSearch=!0,n.Visibility=!0,n.Precision=this.Precision,n)),this.AddChild(this.Datepicker),Core.MVVM.Html.Instance.EndOf$1(".datetime-picker")));Core.Components.Renderer.Button(Core.MVVM.Html.Instance,this.YesText,"button info small","fa fa-check").Event("click",Bridge.fn.bind(this,function(){var n=0,t,i,r,u=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.IsFormValid(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:if(i=t.getAwaitedResult(),r=i,!r)return;try{Bridge.staticEquals(this.YesConfirmed,null)?null:this.YesConfirmed()}catch(f){f=System.Exception.create(f);System.Console.WriteLine(f.StackTrace)}this.DisposeAfterYes&&this.Dispose();return;default:return}}},arguments);u()})).Render();this._yesBtn=Core.MVVM.Html.Context;Core.MVVM.Html.Instance.End.Render();this.IgnoreNoButton||Core.Components.Renderer.MarginRem(Core.Components.Renderer.Button(Core.MVVM.Html.Instance,this.NoText,"button alert small","mif-exit"),Core.Components.Direction.left,1).Event("click",Bridge.fn.bind(this,function(){try{Bridge.staticEquals(this.NoConfirmed,null)?null:this.NoConfirmed()}catch(n){n=System.Exception.create(n);System.Console.WriteLine(n.StackTrace)}this.CloseDispose()})).End.Render();this.IgnoreCancelButton||Core.Components.Renderer.MarginRem(Core.Components.Renderer.Button(Core.MVVM.Html.Instance,this.CancelText,"button info small","fa fa-times"),Core.Components.Direction.left,1).Event("click",Bridge.fn.bind(this,function(){this._cancel=!0;this.Dispose()}));this.NeedAnswer?(this.Textbox!=null&&this.Textbox.Element.focus(),this.Datepicker!=null&&this.Datepicker.Element.focus(),this.Number!=null&&this.Number.Element.focus()):this._yesBtn.focus()},Dispose:function(){Core.Components.Forms.EditForm.prototype.Dispose.call(this)},CloseDispose:function(){Bridge.staticEquals(this.Canceled,null)?null:this.Canceled();Core.Components.Forms.EditForm.prototype.Dispose.call(this)},HotKeyHandler:function(n){var t=Core.Extensions.EventExt.KeyCodeEnum(n);System.Nullable.eq(t,Core.Enums.KeyCodeEnum.Enter)&&this._yesBtn.click()}}});Bridge.define("Core.Components.Forms.TabComponent",{inherits:[Core.Components.Section],statics:{fields:{ActiveClass:null},ctors:{init:function(){this.ActiveClass="active"}},methods:{CalcBadgeMonth:function(n,t){var i,r;return t==null?n:(i=System.DateTime.addMonths(System.DateTime.getNow(),-System.Nullable.getValue(t)|0),i=System.DateTime.addDays(i,-System.DateTime.getDay(i)|0),r=(Core.Extensions.OdataExt.GetClausePart(n,Core.Extensions.OdataExt.FilterKeyword)||"")+(System.String.format(" and {0} ge cast({1},Edm.DateTimeOffset)","InsertedDate",Core.Extensions.DateTimeExt.ToISOFormat(i))||""),Core.Extensions.OdataExt.ApplyClause(n,r,Core.Extensions.OdataExt.FilterKeyword))}}},fields:{_li:null,_badge:null,BadgeElement:null,_displayBadge:!1},props:{HasRendered:!1,NextTab:{get:function(){var t=System.Linq.Enumerable.from(this.Parent.Children,Core.Components.EditableComponent).count(),n=this.Parent.Children.indexOf(this);return n===t?Bridge.cast(System.Linq.Enumerable.from(this.Parent.Children,Core.Components.EditableComponent).firstOrDefault(null,null),Core.Components.Forms.TabComponent):Bridge.cast(this.Parent.Children.getItem(n+1|0),Core.Components.Forms.TabComponent)}},Badge:{get:function(){return this._badge},set:function(n){this._badge=n;this.BadgeElement!=null&&(this.BadgeElement.textContent=this._badge)}},DisplayBadge:{get:function(){return this._displayBadge},set:function(n){this._displayBadge=n;n?Core.Extensions.HtmlElementExtension.Show(this.BadgeElement):Core.Extensions.HtmlElementExtension.Hide(this.BadgeElement)}},Show:{get:function(){return Bridge.ensureBaseProperty(this,"Show").$Core$Components$EditableComponent$Show},set:function(n){this._li!=null&&(Bridge.ensureBaseProperty(this,"Show").$Core$Components$EditableComponent$Show=n,n?(Core.Extensions.HtmlElementExtension.AddClass(this._li,Core.Components.Forms.TabComponent.ActiveClass),Core.Extensions.HtmlElementExtension.AddClass(this._li.querySelector(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.a)),Core.Components.Forms.TabComponent.ActiveClass),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.ComponentGroup.Events,"focusin",[this.Entity]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))):(Core.Extensions.HtmlElementExtension.RemoveClass(this._li,Core.Components.Forms.TabComponent.ActiveClass),Core.Extensions.HtmlElementExtension.RemoveClass(this._li.querySelector(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.a)),Core.Components.Forms.TabComponent.ActiveClass),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.ComponentGroup.Events,"focusout",[this.Entity]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))))}},Disabled:{get:function(){return Bridge.ensureBaseProperty(this,"Disabled").$Core$Components$EditableComponent$Disabled},set:function(n){this._li!=null&&(n?this._li.setAttribute("disabled",""):this._li.removeAttribute("disabled"))}},Hidden:{get:function(){return Bridge.ensureBaseProperty(this,"Disabled").$Core$Components$EditableComponent$Disabled},set:function(n){if(this._li.hidden=n,this.Show)this.Show=!1;else return;this.NextTab.HasRendered?this.NextTab.Focus():(this.NextTab.RenderTabContent(),this.NextTab.Focus())}}},ctors:{ctor:function(n){this.$initialize();Core.Components.Section.ctor.call(this,null);this.ComponentGroup=n;this.Name=n.Name}},methods:{Render:function(){var n,t,i,r,u=this.EditForm.GetElementPolicies$1(System.Array.init([this.ComponentGroup.Id],System.Int32),Core.Extensions.Utils.ComponentGroupId),f=!this.ComponentGroup.IsPrivate||Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy,u,function(n){return n.CanRead});f&&(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Parent.Ul).Li.A,"nav-link tab-default").I,(n=this.ComponentGroup.Icon,n!=null?n:"")).End,(t=this.ComponentGroup.Label,t!=null?t:this.ComponentGroup.Name)).Span,"ml-1 badge badge-warning"),this.BadgeElement=Core.MVVM.Html.Context,this.DisplayBadge?Core.MVVM.Html.Instance.Text((i=this.Badge,i!=null?i:"")):Core.Extensions.HtmlElementExtension.Hide(this.BadgeElement),this._li=Core.MVVM.Html.Context.parentElement.parentElement,Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div,"desc"),(r=this.ComponentGroup.Description,r!=null?r:"")).End.Render(),this._li.addEventListener("click",Bridge.fn.bind(this,function(){this.HasRendered?this.Focus():(this.Focus(),this.RenderTabContent())})),System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this,this.CountBadge)))},RealtimeUpdateBadge:function(){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.CountBadge(),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},CountBadge:function(){var n=0,u,h,t=new System.Threading.Tasks.TaskCompletionSource,a,i,c,e,l,f,r,o,s=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4],n);switch(n){case 0:if(a=Bridge.as(this.Parent,Core.Components.Forms.TabGroup),this.ComponentGroup.BadgeMonth==null){t.setResult(null);return}if(i=System.Linq.Enumerable.from(this.ComponentGroup.Component,Core.Models.Component).firstOrDefault(null,null),i==null||Core.Extensions.StringExt.IsNullOrEmpty(i.DataSourceFilter)){t.setResult(null);return}Core.Components.Forms.EditForm.NotificationClient!=null?Core.Components.Forms.EditForm.NotificationClient.AddListener(System.Nullable.getValue(i.ReferenceId),Core.Enums.TypeEntityAction.UpdateCountBadge,Bridge.fn.cacheBind(this,this.RealtimeUpdateBadge)):null;Core.Components.Forms.EditForm.NotificationClient!=null?Core.Components.Forms.EditForm.NotificationClient.AddListener(System.Nullable.getValue(i.ReferenceId),Core.Enums.TypeEntityAction.MessageCountBadge,Bridge.fn.cacheBind(this,this.RealtimeUpdateBadge)):null;n=1;continue;case 1:if(c=Core.Components.ListView.GetFormattedDataSource(this,i.DataSourceFilter),e=this.ComponentGroup.BadgeMonth,System.Nullable.eq(e,0)){t.setResult(null);return}if(l=(Core.Components.Forms.TabComponent.CalcBadgeMonth(c,e)||"")+"&$count=true",u=new Core.Clients.Client.$ctor1(i.RefName).GetAsync$1(Core.Models.OdataResult$1(System.Object),l),n=2,u.isCompleted())continue;u["continue"](s);return;case 2:if(h=u.getAwaitedResult(),f=h,f==null||f.Odata==null){t.setResult(null);return}this.DisplayBadge=!0;r=f.Odata.Count;this.Badge=System.Nullable.lte(r,1e3)?System.Nullable.toString(r,null):System.Nullable.lt(r,1e6)?System.Nullable.toString(Bridge.Int.clip32(Bridge.Int.div(r,1e3)),null)+"K":System.Nullable.toString(Bridge.Int.clip32(Bridge.Int.div(r,1e6)),null)+"M";n=4;continue;case 3:o=null;n=4;continue;case 4:t.setResult(null);return;default:t.setResult(null);return}}}catch(v){if(o=System.Exception.create(v),n>=1&&n<=2){n=3;s();return}t.setException(o)}},arguments);return s(),t.task},RenderTabContent:function(){Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Parent.TabContent).Div,"tab-content");this.Element=Core.MVVM.Html.Context;var n=Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm,this);Core.Components.Section.RenderSection(this,this.ComponentGroup);this.HasRendered=!0;System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.ComponentGroup.Events,"DOMContentLoaded",[this.Entity]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},Focus:function(){System.Linq.Enumerable.from(this.Parent.Children).select(function(n){return Bridge.cast(n,Core.Components.Forms.TabComponent)}).where(Bridge.fn.bind(this,function(n){return!Bridge.referenceEquals(n,this)})).ToArray(Core.Components.Forms.TabComponent).forEach(function(n){n.Show=!1});this.Show=!0;this.EditForm.ResizeListView();System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.ComponentGroup.Events,"focusin",[this.Entity]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},UpdateView:function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this,this.CountBadge));Core.Components.Section.prototype.UpdateView.call(this,n,t,i)}}});Bridge.define("Core.Components.ListViewItem",{inherits:[Core.Components.Section],statics:{fields:{EmptyRowClass:null,SelectedClass:null,FocusedClass:null,HoveringClass:null,CmdUrl:null,NotCellText:null},ctors:{init:function(){this.EmptyRowClass="empty-row";this.SelectedClass="__selected__";this.FocusedClass="focus";this.HoveringClass="hovering";this.CmdUrl="Cmd";this.NotCellText=function(n){return n.add("Button"),n.add("Image"),n.add("Checkbox"),n}(new(System.Collections.Generic.List$1(System.String).ctor))}}},fields:{_selected:!1,_focused:!1,_emptyRow:!1,awaitUpdate:0},props:{GroupSection:null,lastpathModel:null,ListViewSection:null,ListView:null,PreQueryFn:null,RowNo:0,Selected:{get:function(){return this._selected},set:function(n){this._selected=n;this.SetSelected(n);var t=Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField]);n?this.ListViewSection.ListView.SelectedIds.contains(t)||this.ListViewSection.ListView.SelectedIds.add(t):this.ListViewSection.ListView.SelectedIds.remove(t)}},Focused:{get:function(){return this._focused},set:function(n){this._focused=n;n?Core.Extensions.HtmlElementExtension.AddClass(this.Element,Core.Components.ListViewItem.FocusedClass):Core.Extensions.HtmlElementExtension.RemoveClass(this.Element,Core.Components.ListViewItem.FocusedClass);var t=Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField]);this.ListViewSection.ListView.FocusId=n?t:null}},EmptyRow:{get:function(){return this._emptyRow},set:function(n){this._emptyRow=n;n?Core.Extensions.HtmlElementExtension.AddClass(this.Element,Core.Components.ListViewItem.EmptyRowClass):Core.Extensions.HtmlElementExtension.RemoveClass(this.Element,Core.Components.ListViewItem.EmptyRowClass);Core.Extensions.IEnumerableExtensions.ForEach(Core.Components.EditableComponent,this.FilterChildren(Core.Components.EditableComponent),function(t){t.EmptyRow=n});this.AlwaysValid=n}},GroupRow:!1,Show:{get:function(){return Bridge.ensureBaseProperty(this,"Show").$Core$Components$EditableComponent$Show},set:function(n){this.Toggle(n)}}},ctors:{init:function(){this.awaitUpdate=0},ctor:function(n){n===void 0&&(n=96);this.$initialize();Core.Components.Section.$ctor1.call(this,n);this.StopChildrenHistory=!0;this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.cacheBind(this,this.RowItemReady))}},methods:{SetSelected:function(n){n?Core.Extensions.HtmlElementExtension.AddClass(this.Element,Core.Components.ListViewItem.SelectedClass):Core.Extensions.HtmlElementExtension.RemoveClass(this.Element,Core.Components.ListViewItem.SelectedClass)},RowItemReady:function(){var n=new System.Text.StringBuilder;this.BuildTextHistory(n);this.OriginalText=n.toString()},Render:function(){this.ListViewSection=this.ListViewSection||Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewSection,this);this.ListView=this.ListView||Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListView,this);this.GuiInfo=this.ListView.GuiInfo;Core.Components.Section.prototype.Render.call(this);this._selected&&Core.Extensions.HtmlElementExtension.AddClass(this.Element,Core.Components.ListViewItem.SelectedClass);Core.MVVM.Html.Take(this.Element).AsyncEvent$1("click",Bridge.fn.cacheBind(this,this.RowItemClick)).AsyncEvent$1("dblclick",Bridge.fn.cacheBind(this,this.RowDblClick)).Event("focusin",Bridge.fn.bind(this,function(){Core.Extensions.IEnumerableExtensions.ForEach(Core.Components.ListViewItem,this.ListView.AllListViewItem,function(n){n.Focused&&(n.Focused=!1)});this.Focused=!0})).Event("focusout",Bridge.fn.cacheBind(this,this.RowFocusOut)).Event("mouseenter",Bridge.fn.cacheBind(this,this.MouseEnter)).Event("mouseleave",Bridge.fn.cacheBind(this,this.MouseLeave))},RenderRowData:function(n,t,i,r){var e,u,o,f;i===void 0&&(i=null);r===void 0&&(r=!1);System.Nullable.hasValue(i)&&((System.Nullable.gte(i,System.Linq.Enumerable.from(this.Element.parentElement.children,HTMLElement).count())||System.Nullable.lt(i,0))&&(i=0),this.Element.parentElement.insertBefore(this.Element,this.Element.parentElement.children[System.Nullable.getValue(i)]));u={};Core.Extensions.Utils.IsFunction(this.GuiInfo.FormatEntity,u)?(o=(e=u.v.call(this,this))!=null?Bridge.toString(e):null,this.Element.innerHTML=o,this.EditForm.BindingTemplate(this.Element,this)):System.Linq.Enumerable.from(n,Core.Models.GridPolicy).where(function(n){return!n.Hidden}).forEach(Bridge.fn.bind(this,function(n){this.RenderTableCell(t,this.ListView.HeaderComponentMap.getItem(Bridge.getHashCode(n)),this.Element)}));f=Bridge.unbox(t[Core.Components.EditableComponent.IdField]);this.Dirty=(!System.Nullable.hasValue(f)||System.Nullable.lte(f,0))&&!r},RenderTableCell:function(n,t,i){var u,r,f,e,o,s;(i===void 0&&(i=null),System.String.isNullOrEmpty(t.FieldName))||(r=(t.Editable||Core.Components.ListViewItem.NotCellText.contains(t.ComponentType))&&this.ListViewSection.ListView.CanWrite?Core.Components.Extensions.ComponentFactory.GetComponent(t,this.EditForm):new Core.Components.CellText(t),(f=Bridge.as(r,Core.Components.CellText))!=null&&(f.RefData=this.ListView.RefData),System.Nullable.hasValue(t.ReferenceId)&&(e=t.LocalData||(Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,System.Collections.Generic.List$1(System.Object)),this.ListView.RefData)?null:System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String,System.Collections.Generic.List$1(System.Object),this.ListView.RefData,t.RefName)),t.LocalData=e),(o=Bridge.as(r,Core.Components.SearchEntry))!=null&&(s=(u=t.LocalData)!=null?System.Linq.Enumerable.from(u,System.Object).firstOrDefault(function(i){return System.Nullable.eq(System.Nullable.getValue(Bridge.cast(Bridge.unbox(i[Core.Components.EditableComponent.IdField],System.Int32),System.Int32)),Bridge.cast(Bridge.unbox(n!=null?Core.Extensions.Utils.GetComplexPropValue(n,t.FieldName):null,System.Int32),System.Int32,!0))},null):null,o.Matched=s),r.Id=Bridge.toString(t.Id),r.Name=t.FieldName,r.Entity=n,r.ParentElement=i||Core.MVVM.Html.Context,this.AddChild(r),(this.Disabled||t.Disabled)&&Core.Components.Extensions.ComponentExt.SetDisabled(r,!0),r.Element==null||Core.Extensions.StringExt.IsNullOrWhiteSpace(t.ChildStyle)||(r.Element.style.cssText=t.ChildStyle),r.UserInput=Bridge.fn.combine(r.UserInput,Bridge.fn.bind(this,function(n){var t=0,u,f,e,o,i=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1,2,3,4,5,6,7,8,9,11],t);switch(t){case 0:if(Bridge.referenceEquals(r.ComponentType,"Input")||Bridge.referenceEquals(r.ComponentType,"Textbox")||Bridge.referenceEquals(r.ComponentType,"Textarea")){t=1;continue}else{t=6;continue}case 1:if(n.EvType==="abort"||n.EvType==="change"||n.EvType==="blur"){t=2;continue}t=5;continue;case 2:if(r.Disabled)return;if(u=this.ListView.RowChangeHandler(r.Entity,this,n,r),t=3,u.isCompleted())continue;u["continue"](i);return;case 3:if(u.getAwaitedResult(),f=this.ListView.RealtimeUpdateAsync(this,n),t=4,f.isCompleted())continue;f["continue"](i);return;case 4:f.getAwaitedResult();t=5;continue;case 5:t=11;continue;case 6:if(e=this.ListView.RowChangeHandler(r.Entity,this,n,r),t=7,e.isCompleted())continue;e["continue"](i);return;case 7:if(e.getAwaitedResult(),n.EvType==="change"){t=8;continue}t=10;continue;case 8:if(r.Disabled)return;if(o=this.ListView.RealtimeUpdateAsync(this,n),t=9,o.isCompleted())continue;o["continue"](i);return;case 9:o.getAwaitedResult();t=10;continue;case 11:return;default:return}}},arguments);i()})))},CreateUpdate:function(){var n=0,u,f,e,l,o,s,h,i=new System.Threading.Tasks.TaskCompletionSource,c,r,a,t=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5,6,7,8,9,10,11,12],n);switch(n){case 0:if(!this.Dirty){i.setResult(null);return}if(this.GuiInfo.IsRealtime){n=1;continue}n=3;continue;case 1:if(u=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforeCreated,[this.Entity]),n=2,u.isCompleted())continue;u["continue"](t);return;case 2:u.getAwaitedResult();n=3;continue;case 3:if(f=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforeCreated,[this.Entity,this]),n=4,f.isCompleted())continue;f["continue"](t);return;case 4:if(f.getAwaitedResult(),c=this.Entity,Core.Extensions.ReflectionExt.ClearReferences(c),e=new Core.Clients.Client.$ctor1(this.GuiInfo.Reference.Name).CreateAsync(System.Object,c),n=5,e.isCompleted())continue;e["continue"](t);return;case 5:if(l=e.getAwaitedResult(),r=l,Core.Extensions.ReflectionExt.CopyPropFrom$1(this.Entity,r),Bridge.referenceEquals(this.GuiInfo.ComponentType,"VirtualGrid")&&this.ListViewSection.ListView.CacheData.add(r),o=this.ListViewSection.ListView.LoadMasterData(System.Array.init([r],System.Object)),n=6,o.isCompleted())continue;o["continue"](t);return;case 6:if(o.getAwaitedResult(),this.UpdateView$1(!0),Core.Extensions.HtmlElementExtension.RemoveClass(this.Element,"new-row"),r!=null){n=7;continue}n=9;continue;case 7:if(s=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterPatchUpdate,[this.Entity,this]),n=8,s.isCompleted())continue;s["continue"](t);return;case 8:s.getAwaitedResult();n=9;continue;case 9:if(this.GuiInfo.IsRealtime){n=10;continue}n=12;continue;case 10:if(h=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterCreated,[this.Entity]),n=11,h.isCompleted())continue;h["continue"](t);return;case 11:h.getAwaitedResult();n=12;continue;case 12:this.EmptyRow=!1;i.setResult(null);return;default:i.setResult(null);return}}}catch(v){a=System.Exception.create(v);i.setException(a)}},arguments);return t(),i.task},CompareEx:function(n,t){var i,o=System.Linq.Enumerable.from(this.ListViewSection.ListView.BasicHeaderSearch,Core.Models.GridPolicy).select(function(n){return n.FieldName}).toList(System.String),f=!1;i=Bridge.getEnumerator(System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Bridge.getType(n),16,28),System.Reflection.PropertyInfo).where(function(n){return o.contains(n.n)}).toList(System.Reflection.PropertyInfo));try{while(i.moveNext()){var e=i.Current,r=Bridge.Reflection.midel(e.g,Bridge.unbox(n))(),u=Bridge.Reflection.midel(e.g,Bridge.unbox(t))();if((r!=null||u!=null)&&(r!=null&&u==null||r==null&&u!=null||r!=null&&u!=null&&!Bridge.referenceEquals(Bridge.toString(r),Bridge.toString(u)))){f=!0;break}}}finally{Bridge.is(i,System.IDisposable)&&i.System$IDisposable$Dispose()}return f},PatchUpdate:function(n){var t=0,o,s,h,c,d,l,g,a,v,tt,y,f=new System.Threading.Tasks.TaskCompletionSource,i,p,w,u,b,nt,k,e,r=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],t);switch(t){case 0:if(n===void 0&&(n=!1),!this.Dirty){f.setResult(null);return}if(i=this.GetPathEntity(),o=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.BeforePatchUpdate,[this.Entity,i,this]),t=1,o.isCompleted())continue;o["continue"](r);return;case 1:if(o.getAwaitedResult(),Core.Extensions.StringExt.IsNullOrWhiteSpace(System.Linq.Enumerable.from(i.Changes,Core.ViewModels.PatchUpdateDetail).firstOrDefault(function(n){return Bridge.referenceEquals(n.Field,Core.Components.EditableComponent.IdField)},null).Value)&&!n){t=2;continue}t=4;continue;case 2:if(s=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterPatchUpdate,[this.Entity,i,this]),t=3,s.isCompleted())continue;s["continue"](r);return;case 3:s.getAwaitedResult();f.setResult(null);return;case 4:if(i==null&&!n){t=5;continue}t=7;continue;case 5:if(h=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterPatchUpdate,[this.Entity,i,this]),t=6,h.isCompleted())continue;h["continue"](r);return;case 6:h.getAwaitedResult();f.setResult(null);return;case 7:this.lastpathModel=i;p="false";i.Changes.Count===2&&(w=System.Linq.Enumerable.from(this.ListViewSection.ListView.BasicHeader,Core.Models.GridPolicy).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,System.Linq.Enumerable.from(i.Changes,Core.ViewModels.PatchUpdateDetail).firstOrDefault(null,null).Field)&&n.Editable},null),w!=null&&w.IgnoreSync&&(p="true"));u=this.Entity;t=8;continue;case 8:if(c=new Core.Clients.Client.$ctor1(this.GuiInfo.Reference.Name).PatchAsync(System.Object,i,"",System.String.format("&disableTrigger={0}",[p]),!1,!1),t=9,c.isCompleted())continue;c["continue"](r);return;case 9:d=c.getAwaitedResult();u=d;t=12;continue;case 10:if(Core.Extensions.Toast.Warning("Dữ liệu của bạn chưa được lưu vui lòng nhập lại!"),l=new Core.Clients.Client.$ctor1(this.GuiInfo.Reference.Name).GetList(System.Object,System.String.format("?$filter=Id eq {0}",[this.Entity[Core.Components.EditableComponent.IdField]])),t=11,l.isCompleted())continue;l["continue"](r);return;case 11:g=l.getAwaitedResult();u=System.Linq.Enumerable.from(g.Value,System.Object).firstOrDefault(null,null);Core.Extensions.ReflectionExt.CopyPropFrom$1(this.Entity,u);this.UpdateView();f.setResult(null);return;case 12:if(Bridge.referenceEquals(this.GuiInfo.ComponentType,"VirtualGrid")&&Core.Extensions.ReflectionExt.CopyPropFrom$1(System.Linq.Enumerable.from(this.ListViewSection.ListView.CacheData,System.Object).firstOrDefault(function(n){return Bridge.referenceEquals(n[Core.Components.EditableComponent.IdField],u[Core.Components.EditableComponent.IdField])},null),u),Core.Extensions.ReflectionExt.CopyPropFrom$1(this.Entity,u),a=this.ListViewSection.ListView.LoadMasterData(System.Array.init([u],System.Object)),t=13,a.isCompleted())continue;a["continue"](r);return;case 13:if(a.getAwaitedResult(),this.EmptyRow=!1,nt=System.Linq.Enumerable.from(this.FilterChildren(Core.Components.EditableComponent,function(n){return!n.Dirty||Core.Extensions.StringExt.IsNullOrWhiteSpace(n.GetValueText())}),Core.Components.EditableComponent).select(function(n){return n.GuiInfo.FieldName}).ToArray(System.String),this.UpdateView$1(!0,nt),k=this.BuildTextHistory().toString(),!Core.Extensions.StringExt.IsNullOrWhiteSpace(k)){t=14;continue}t=16;continue;case 14:if(v=new Core.Clients.Client.$ctor1("History").CreateAsync(Core.Models.History,(e=new Core.Models.History,e.ReasonOfChange="Auto update",e.TextHistory=Bridge.toString(k),e.RecordId=this.EntityId,e.EntityId=Core.Extensions.Utils.GetEntity$1(this.GuiInfo.RefName).Id,e)),t=15,v.isCompleted())continue;v["continue"](r);return;case 15:tt=v.getAwaitedResult();t=16;continue;case 16:if(this.Dirty=!1,u!=null&&!n){t=17;continue}t=19;continue;case 17:if(y=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.AfterPatchUpdate,[this.Entity,i,this]),t=18,y.isCompleted())continue;y["continue"](r);return;case 18:y.getAwaitedResult();t=19;continue;case 19:f.setResult(null);return;default:f.setResult(null);return}}}catch(it){if(b=System.Exception.create(it),t>=8&&t<=9){t=10;r();return}f.setException(b)}},arguments);return r(),f.task},GetPathEntity:function(){var n,t=System.Linq.Enumerable.from(this.Children,Core.Components.EditableComponent).where(function(n){var t;return(t=n)!=null&&t.Dirty}).select(Bridge.fn.bind(this,function(n){var i,r,t=Core.Extensions.Utils.GetComplexPropValue(n.Entity,n.GuiInfo.FieldName),u=Core.Extensions.BridgeExt.GetComplexPropType(Bridge.getType(n.Entity),n.GuiInfo.FieldName,n.Entity);return i=new Core.ViewModels.PatchUpdateDetail,i.Field=n.GuiInfo.FieldName,i.OldVal=n.OldValue!=null&&Core.Extensions.ReflectionExt.IsDate(u)?Core.Extensions.DateTimeExt.DateConverter(Bridge.toString(n.OldValue)):(r=n.OldValue)!=null?Bridge.toString(r):null,i.Value=t!=null&&Core.Extensions.ReflectionExt.IsDate(u)?Core.Extensions.DateTimeExt.DateConverter(Bridge.toString(t)):this.EditForm.Feature.IgnoreEncode?t!=null?Bridge.toString(t).trim():null:t!=null?Core.Extensions.Utils.EncodeSpecialChar(Bridge.toString(t).trim()):null,i})).toList(Core.ViewModels.PatchUpdateDetail);return t.add((n=new Core.ViewModels.PatchUpdateDetail,n.Field=Core.Extensions.Utils.IdField,n.Value=Bridge.toString(this.EntityId),n)),n=new Core.ViewModels.PatchUpdate,n.Changes=t,n},RowDblClick:function(n){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(n.stopPropagation(),Bridge.staticEquals(u=this.ListViewSection.ListView.DblClick,null)?null:u(this.Entity),i=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"dblclick",[this.Entity]),t=1,i.isCompleted())continue;i["continue"](e);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(o){f=System.Exception.create(o);r.setException(f)}},arguments);return e(),r.task},RowItemClick:function(n){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,f,e,u,o,s,h,c=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(n.stopPropagation(),f=Core.Extensions.EventExt.CtrlOrMetaKey(n),e=Core.Extensions.EventExt.ShiftKey(n),u=Bridge.as(n.target,Node),o=Core.Components.Extensions.ComponentExt.FirstOrDefault(this,function(n){return Bridge.referenceEquals(n.Element,u)||n.ParentElement.contains(u)})!=null,this.HotKeySelectRow(f,e,o),Core.Extensions.EventExt.ShiftKey(n)||(Bridge.staticEquals(s=this.ListViewSection.ListView.RowClick,null)?null:s(this.Entity)),this.ListViewSection.ListView.LastListViewItem=this,i=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"click",[this.Entity]),t=1,i.isCompleted())continue;i["continue"](c);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(l){h=System.Exception.create(l);r.setException(h)}},arguments);return c(),r.task},HotKeySelectRow:function(n,t){var o,i,r,s,u,c;if(!this.EmptyRow)if(this.ListViewSection.ListView.VirtualScroll)(n||t)&&(this.Selected=!this._selected,this._selected&&(this.ListViewSection.ListView.SelectedIndex=this.ListViewSection.Children.indexOf(this))),t&&(o=this.ListViewSection.ListView.AllListViewItem,this.ListViewSection.ListView.LastShiftViewItem==null&&(this.ListViewSection.ListView.LastShiftViewItem=this,this.ListViewSection.ListView.LastIndex=this.RowNo),i={v:this.ListViewSection.ListView.LastIndex},r={v:this.RowNo},i.v>r.v&&Bridge.Deconstruct(new(System.ValueTuple$2(System.Int32,System.Int32).$ctor1)(r.v,i.v).$clone(),i,r),this.ListViewSection.ListView.VirtualScroll&&r.v>i.v?(s=this.ListViewSection.ListView.CalcDatasourse((r.v-i.v|0)+1|0,i.v-1|0,"false"),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,e,u=new System.Threading.Tasks.TaskCompletionSource,h,c,f,l,a=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName,(c=this.GuiInfo.Reference)!=null?c.Namespace:null).GetList(System.Object,System.String.format("{0}&$select=Id",[s]),!0),n=1,t.isCompleted())continue;t["continue"](a);return;case 1:e=t.getAwaitedResult();h=e;f=System.Linq.Enumerable.from(h.Value,System.Object).select(function(n){return n[Core.Components.EditableComponent.IdField]}).select(function(n){return Bridge.cast(n,System.Int32)}).toList(System.Int32);this.Selected?System.Linq.Enumerable.from(f,System.Int32).except(this.ListViewSection.ListView.SelectedIds).forEach(Bridge.fn.cacheBind(this.ListViewSection.ListView.SelectedIds,this.ListViewSection.ListView.SelectedIds.add)):f.ForEach(Bridge.fn.bind(this,function(n){this.ListViewSection.ListView.SelectedIds.remove(n)}));this.SetSeletedListViewItem(o,i.v,r.v);this.ListViewSection.ListView.LastShiftViewItem=null;u.setResult(null);return;default:u.setResult(null);return}}}catch(v){l=System.Exception.create(v);u.setException(l)}},arguments);return a(),u.task}))):this.SetSeletedListViewItem(o,i.v,r.v));else{if(!n&&!t){this.ListViewSection.ListView.SelectedIds.Count<=1&&(this.ListViewSection.ListView.ClearSelected(),this.Selected=!this._selected,this._selected&&(this.ListViewSection.ListView.SelectedIndex=this.ListViewSection.Children.indexOf(this)));return}if(this.Selected=!this._selected,t||n||!this._selected||(this.ListViewSection.ListView.SelectedIndex=this.ListViewSection.Children.indexOf(this)),t){var h=this.ListViewSection.ListView.AllListViewItem,l=System.Linq.Enumerable.from(h,Core.Components.ListViewItem).firstOrDefault(function(n){return n.Selected},null),f={v:Core.Extensions.IEnumerableExtensions.IndexOf(Core.Components.ListViewItem,h,function(n){return Bridge.referenceEquals(n,l)})},e={v:this.ListViewSection.Children.indexOf(this)};for(f.v>e.v&&Bridge.Deconstruct(new(System.ValueTuple$2(System.Int32,System.Int32).$ctor1)(e.v,f.v).$clone(),f,e),u=f.v;u<=e.v;u=u+1|0)(c=Bridge.as(this.ListViewSection.Children.getItem(u),Core.Components.ListViewItem))!=null&&(c.Selected=!0)}}},SetSeletedListViewItem:function(n,t,i){var r,o=System.Linq.Enumerable.from(n,Core.Components.ListViewItem).firstOrDefault(null,null).RowNo>t?System.Linq.Enumerable.from(n,Core.Components.ListViewItem).firstOrDefault(null,null).RowNo:t,f=System.Linq.Enumerable.from(this.ListViewSection.ListView.AllListViewItem,Core.Components.ListViewItem).where(function(n){return n.RowNo>=o&&n.RowNo<=i}).toList(Core.Components.ListViewItem),u,e;this.ListViewSection.ListView.VirtualScroll||(this.ListViewSection.ListView.SelectedIds=System.Linq.Enumerable.from(f,Core.Components.ListViewItem).select(function(n){return Bridge.unbox(n.Entity[Core.Components.EditableComponent.IdField])}));r=Bridge.getEnumerator(f);try{while(r.moveNext())u=r.Current,e=System.Int32.parse(Bridge.toString(u.Entity[Core.Components.EditableComponent.IdField])),u.Selected=this.ListViewSection.ListView.SelectedIds.contains(e)?this.Selected:!1}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}},ToastSelected:function(){this.ListViewSection.ListView.SelectedIds.Count%10==0&&this.ListViewSection.ListView.SelectedIds.Count>0},RowFocusOut:function(){System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.GuiInfo.Events,Core.Enums.CustomEventType.RowFocusOut,[this.Entity]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},MouseEnter:function(){Core.Extensions.HtmlElementExtension.AddClass(this.Element,Core.Components.ListViewItem.HoveringClass);System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.ListViewSection.ListView.GuiInfo.Events,Core.Enums.CustomEventType.RowMouseEnter,[this.Entity]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},MouseLeave:function(){Core.Extensions.HtmlElementExtension.RemoveClass(this.Element,Core.Components.ListViewItem.HoveringClass);System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchCustomEventAsync(this,this.ListViewSection.ListView.GuiInfo.Events,Core.Enums.CustomEventType.RowMouseLeave,[this.Entity]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task}))},BuildTextHistory:function(n,t){n===void 0&&(n=null);t===void 0&&(t=null);var i=n==null;return(i&&(n=new System.Text.StringBuilder),t==null&&(t=new(System.Collections.Generic.HashSet$1(System.Object).ctor)),t.contains(this))?n:Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent,this.Children)?n:(t.add(this),i||n.append(Core.Extensions.Utils.Indent).append(this.BasicUpdateText).append(" dòng ").append(this.RowNo+1|0).append(":").append(Core.Extensions.Utils.NewLine),this.Children.ForEach(function(t){i||n.append(Core.Extensions.Utils.Indent);t.BuildTextHistory(n)}),n)}}});Bridge.define("Core.Components.GroupListView",{inherits:[Core.Components.ListView],statics:{fields:{_groupKey:null,GroupRowClass:null},ctors:{init:function(){this._groupKey="__groupkey__";this.GroupRowClass="group-row"}}},ctors:{ctor:function(n){this.$initialize();Core.Components.ListView.ctor.call(this,n)}},methods:{Render:function(){Core.Components.ListView.prototype.Render.call(this);Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element),"group-listview").End.Render()},RowDataChanged:function(n){if(System.Nullable.eq(n.Action,Core.MVVM.ObservableAction.Remove)){this.RemoveRowById(Bridge.unbox(n.Item[Core.Components.EditableComponent.IdField]));return}window.clearTimeout(this._rowDataChangeAwaiter);this._rowDataChangeAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){var t=0,i,s,r,h,u,f,o,e=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1,2,3,4,5,6,7],t);switch(t){case 0:if(Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.GroupBy))return;if(Core.Extensions.IEnumerableExtensions.Nothing(System.Object,n.ListData)){this.NoRecordFound();return}if(f=n.Action,f===Core.MVVM.ObservableAction.Add){t=1;continue}else if(f===Core.MVVM.ObservableAction.AddRange){t=3;continue}else if(f===Core.MVVM.ObservableAction.Update){t=5;continue}t=7;continue;case 1:if(i=this.AddRow(n.Item),t=2,i.isCompleted())continue;i["continue"](e);return;case 2:s=i.getAwaitedResult();return;case 3:if(r=this.AddRows(n.ListData),t=4,r.isCompleted())continue;r["continue"](e);return;case 4:h=r.getAwaitedResult();return;case 5:if(u=this.AddOrUpdateRow(n.Item),t=6,u.isCompleted())continue;u["continue"](e);return;case 6:u.getAwaitedResult();return;case 7:this.FormattedRowData=(o=System.Object,System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.BuildGroupTree(n.ListData,this.GuiInfo.GroupBy.split(",")),o).toList(o));Core.Components.ListView.prototype.Rerender.call(this);return;default:return}}},arguments);e()}))},AddRow:function(n,t,i){var r=0,f,e=new System.Threading.Tasks.TaskCompletionSource,l,s,u,h,c,o,a,v,y=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1,2,3],r);switch(r){case 0:if(t===void 0&&(t=0),i===void 0&&(i=!0),this.DisposeNoRecord(),l=this.GuiInfo.GroupBy.split(","),i){r=1;continue}r=3;continue;case 1:if(f=this.LoadMasterData(function(t){return t.add(n),t}(new(System.Collections.Generic.List$1(System.Object).ctor))),r=2,f.isCompleted())continue;f["continue"](y);return;case 2:f.getAwaitedResult();r=3;continue;case 3:n[Core.Components.GroupListView._groupKey]=Bridge.toArray(System.Linq.Enumerable.from(l,System.String).select(function(t){var i;return(i=Core.Extensions.Utils.GetComplexPropValue(n,t))!=null?Bridge.toString(i):null})).join(" ");s=n[Core.Components.GroupListView._groupKey];u=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(function(n){return n.GroupRow&&Bridge.referenceEquals(Bridge.unbox(n.Entity).Key,s)},null);u==null?(c=(o=new Core.Components.GroupRowData,o.Key=s,o.Children=function(t){return t.add(n),t}(new(System.Collections.Generic.List$1(System.Object).ctor)),o),this.FormattedRowData.add(c),h=this.RenderRowData(this.Header,c,this.MainSection,this.MainSection.Children.Count)):(Bridge.unbox(u.Entity).Children.add(n),a=this.MainSection.Children.indexOf(u),h=this.RenderRowData(this.Header,n,this.MainSection,Bridge.Int.clip32(a+u.Children.Count)));i&&this.FinalAddOrUpdate();this.Dirty=!0;e.setResult(h);return;default:e.setResult(null);return}}}catch(p){v=System.Exception.create(p);e.setException(v)}},arguments);return y(),e.task},AddRows:function(n,t){var i=0,r,u,h,f=new System.Threading.Tasks.TaskCompletionSource,e,s,o=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3,4],i);switch(i){case 0:if(t===void 0&&(t=0),!this.GuiInfo.IsRealtime){i=1;continue}i=3;continue;case 1:if(r=this.LoadMasterData(n),i=2,r.isCompleted())continue;r["continue"](o);return;case 2:r.getAwaitedResult();i=3;continue;case 3:if(e=new(System.Collections.Generic.List$1(Core.Components.ListViewItem).ctor),u=Core.Extensions.IEnumerableExtensions.ForEachAsync(System.Object,n,Bridge.fn.bind(this,function(n){var t=0,i,u,r=new System.Threading.Tasks.TaskCompletionSource,f,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.AddRow(n,0,!1),t=1,i.isCompleted())continue;i["continue"](o);return;case 1:u=i.getAwaitedResult();e.add(u);r.setResult(null);return;default:r.setResult(null);return}}}catch(s){f=System.Exception.create(s);r.setException(f)}},arguments);return o(),r.task})),i=4,u.isCompleted())continue;u["continue"](o);return;case 4:h=u.getAwaitedResult();f.setResult(e);return;default:f.setResult(null);return}}}catch(c){s=System.Exception.create(c);f.setException(s)}},arguments);return o(),f.task},RenderRowData:function(n,t,i,r,u){var e,o,h,c,f,s,l;return(u===void 0&&(u=!1),!((o=Bridge.as(t,Core.Components.GroupRowData))!=null))?Core.Components.ListView.prototype.RenderRowData.call(this,n,t,i,r,u):(h=i.Element,o.Key==null||Core.Extensions.StringExt.IsNullOrWhiteSpace(Bridge.toString(o.Key)))?(c=null,o.Children.ForEach(Bridge.fn.bind(this,function(t){Core.MVVM.Html.Take(h);c=this.RenderRowData(n,t,i,null)})),c):(f=(e=new Core.Components.GroupViewItem(Core.MVVM.ElementType.div),e.Entity=t,e.ParentElement=h,e.GroupRow=!0,e.PreQueryFn=this._preQueryFn,e.ListView=this,e.GuiInfo=this.GuiInfo,e),i.AddChild(f),s=System.Linq.Enumerable.from(o.Children,System.Object).firstOrDefault(null,null),l=Core.Extensions.Utils.FormatEntity(this.GuiInfo.GroupFormat,null,s,function(){return"N/A"},function(){return"N/A"}),Core.Components.Renderer.Icon(Core.MVVM.Html.Take(f.Element).AsyncEvent$2(System.Object,"click",Bridge.fn.cacheBind(this,this.DispatchClick),s).AsyncEvent$2(System.Object,"dblclick",Bridge.fn.cacheBind(this,this.DispatchDblClick),s),"fa fa-chevron-right").Event$3(Core.Components.GroupViewItem,"click",Bridge.fn.cacheBind(this,this.ToggleGroupRow),f).End.Span.InnerHTML(l),f.GroupText=Core.MVVM.Html.Context,o.Children.ForEach(Bridge.fn.bind(this,function(t){var i,r;Core.MVVM.Html.Take(f.Element);i=this.RenderRowData(n,t,f,null);i.GroupSection=f;Core.Components.Renderer.SmallCheckbox(Core.MVVM.Html.Take(i.Element)).Render();r=Bridge.as(Core.MVVM.Html.Context.previousElementSibling,HTMLInputElement);Core.MVVM.Html.Instance.End.End.Event$1("click",function(n){n.preventDefault();i.Selected=!i.Selected;r.checked=i.Selected})})),f)},DispatchClick:function(n){return Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.GroupEvent,"click",[n])},DispatchDblClick:function(n){return Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.GroupEvent,"dblclick",[n])},ToggleGroupRow:function(n,t){var i;(i=Bridge.as(t.target,HTMLElement))!=null&&(Core.Extensions.HtmlElementExtension.HasClass(i,"fa-chevron-right")?(Core.Extensions.HtmlElementExtension.ReplaceClass(i,"fa-chevron-right","fa-chevron-down"),n.Children.ForEach(function(n){n.Show=!1})):(Core.Extensions.HtmlElementExtension.ReplaceClass(i,"fa-chevron-down","fa-chevron-right"),n.Children.ForEach(function(n){n.Show=!0})))},RemoveRowById:function(n){var t=Core.Extensions.IEnumerableExtensions.IndexOf(System.Object,this.RowData.Data,function(t){return Bridge.unbox(t[Core.Components.EditableComponent.IdField])===n});t<0||(this.RowData.Data.removeAt(t),System.Linq.Enumerable.from(this.FilterChildren$1(function(t){return Bridge.is(t,Core.Components.ListViewItem)&&Bridge.unbox(t.Entity[Core.Components.EditableComponent.IdField])===n})).select(function(n){return Bridge.cast(n,Core.Components.ListViewItem)}).toList(Core.Components.ListViewItem).ForEach(Bridge.fn.bind(this,function(n){if(n.GroupSection!=null&&Bridge.is(n.GroupSection.Entity,Core.Components.GroupRowData)){var t=Bridge.unbox(n.GroupSection.Entity).Children;t.remove(n.Entity);Core.Extensions.IEnumerableExtensions.Nothing(System.Object,t)&&(this.RowData.Data.remove(n.GroupSection.Entity),n.GroupSection.Dispose())}n.Dispose()})),Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.RowData.Data)&&this.NoRecordFound())},RemoveRange:function(n){Core.Extensions.IEnumerableExtensions.ForEach(System.Object,n,Bridge.fn.bind(this,function(n){this.RemoveRowById(Bridge.unbox(n[Core.Components.EditableComponent.IdField]))}))},AddOrUpdateRow:function(n,t,i,r){var u=0,o,a,s,h,v,e=new System.Threading.Tasks.TaskCompletionSource,f,l,c=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1,2,3,4,5,6,7,8,9,10],u);switch(u){case 0:if(t===void 0&&(t=!0),i===void 0&&(i=!1),r===void 0&&(r=[]),f=System.Linq.Enumerable.from(this.FilterChildren$1(function(t){return Bridge.is(t,Core.Components.ListViewItem)&&Bridge.referenceEquals(t.Entity,n)})).select(function(n){return Bridge.cast(n,Core.Components.ListViewItem)}).firstOrDefault(null,null),f==null){u=1;continue}u=3;continue;case 1:if(o=this.AddRow(n,0,t),u=2,o.isCompleted())continue;o["continue"](c);return;case 2:a=o.getAwaitedResult();e.setResult(null);return;case 3:if(t){u=4;continue}u=6;continue;case 4:if(s=this.LoadMasterData(function(t){return t.add(n),t}(new(System.Collections.Generic.List$1(System.Object).ctor)),!1),u=5,s.isCompleted())continue;s["continue"](c);return;case 5:s.getAwaitedResult();u=6;continue;case 6:if(f.EmptyRow){u=7;continue}else{u=9;continue}case 7:if(f.Entity=null,h=this.AddRow(n,0,t),u=8,h.isCompleted())continue;h["continue"](c);return;case 8:v=h.getAwaitedResult();u=10;continue;case 9:Core.Extensions.ReflectionExt.CopyPropFrom$1(f.Entity,n);this.RowAction$1(function(n){return Bridge.referenceEquals(n.Entity,f.Entity)},function(n){n.EmptyRow=!1;n.UpdateView$1(i,r);n.Dirty=!0});u=10;continue;case 10:t&&this.FinalAddOrUpdate();e.setResult(null);return;default:e.setResult(null);return}}}catch(y){l=System.Exception.create(y);e.setException(l)}},arguments);return c(),e.task},AddOrUpdateRows:function(n){var t=0,i,r,o,u=new System.Threading.Tasks.TaskCompletionSource,e,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2],t);switch(t){case 0:if(i=this.LoadMasterData(n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:if(i.getAwaitedResult(),r=Core.Extensions.IEnumerableExtensions.ForEachAsync(System.Object,n,Bridge.fn.bind(this,function(n){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.AddOrUpdateRow(n,!1),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task})),t=2,r.isCompleted())continue;r["continue"](f);return;case 2:o=r.getAwaitedResult();this.AddNewEmptyRow();u.setResult(null);return;default:u.setResult(null);return}}}catch(s){e=System.Exception.create(s);u.setException(e)}},arguments);return f(),u.task}}});Bridge.define("Core.Components.ListViewSection",{inherits:[Core.Components.Section],props:{ListView:null},ctors:{$ctor1:function(n){this.$initialize();Core.Components.Section.$ctor1.call(this,n)},ctor:function(n){this.$initialize();Core.Components.Section.ctor.call(this,n)}},methods:{Render:function(){this.ListView=Bridge.as(this.Parent,Core.Components.ListView);Core.Components.Section.prototype.Render.call(this)}}});Bridge.define("Core.Components.MultipleSearchEntry",{inherits:[Core.Components.SearchEntry],statics:{fields:{MultipleClass:null},ctors:{init:function(){this.MultipleClass="multiple"}}},fields:{_isStringSource:!1,_fieldName:null,_toggleButton:null,_listValues:null},props:{ListValues:{get:function(){return this._listValues},set:function(n){Core.Extensions.IEnumerableExtensions.Nothing(System.Int32,n)?this._listValues!=null?this._listValues.clear():null:Bridge.referenceEquals(this._listValues,n)||(this._listValues.clear(),System.Linq.Enumerable.from(n,System.Int32).distinct().forEach(Bridge.fn.cacheBind(this._listValues,this._listValues.add)));this.SetEntityValue(n);this.CascadeField();this.PopulateFields()}},MatchedItems:null},ctors:{init:function(){this._listValues=new(System.Collections.Generic.List$1(System.Int32).ctor);this.MatchedItems=new(System.Collections.Generic.List$1(System.Object).ctor)},ctor:function(n){this.$initialize();Core.Components.SearchEntry.ctor.call(this,n);this._fieldName=this.GuiInfo.FieldName}},methods:{Render:function(){this._isStringSource=this.Entity!=null&&Bridge.equals(Core.Extensions.BridgeExt.GetComplexPropType(Bridge.getType(this.Entity),this._fieldName,this.Entity),System.String);Core.Components.SearchEntry.prototype.Render.call(this);Core.Extensions.HtmlElementExtension.AddClass(this.Element.parentElement,Core.Components.MultipleSearchEntry.MultipleClass);this.TryParseData();this.FindMatchText()},TryParseData:function(){var n,t;this.Entity!=null&&(n=Core.Extensions.Utils.GetComplexPropValue(this.Entity,this._fieldName),n!=null)&&(t=null,t=this._isStringSource?System.Linq.Enumerable.from(Bridge.as(n,System.String).split(","),System.String).select(function(n){var t;return t=Core.Extensions.Utils.TryParseInt(n),t!=null?t:0}).where(function(n){return n!==0}).toList(System.Int32):Bridge.unbox(n),System.Linq.Enumerable.from(t,System.Int32).except(this._listValues).ToArray(System.Int32).forEach(Bridge.fn.cacheBind(this._listValues,this._listValues.add)))},GridResultDomLoaded:function(){(Core.Components.SearchEntry.prototype.GridResultDomLoaded.call(this),this._toggleButton==null)&&(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this._gv.Element).Div,"dropdown-toolbar").Button.Event("click",Bridge.fn.cacheBind(this,this.ToggleAllRecord)),"fa fa-check").Attr$1("title","Chọn tất cả").End.Button.Event("click",Bridge.fn.cacheBind(this,this.Dispose)),"fa fa-times").Attr$1("title","Đóng gợi ý"),this._toggleButton=Bridge.as(Core.MVVM.Html.Context.previousElementSibling,HTMLButtonElement))},ToggleAllRecord:function(){var n=this.ListValues;n==null?(this.ListValues=new(System.Collections.Generic.List$1(System.Int32).ctor),this._toggleButton.setAttribute("title","Chọn tất cả")):(this.ListValues=null,this._toggleButton.setAttribute("title","Hủy chọn"));this.FindMatchText()},SetEntityValue:function(n){this._isStringSource?Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this._fieldName,Core.Extensions.IEnumerableExtensions.Combine(System.Int32,n)):Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this._fieldName,n)},FindMatchText:function(n){if(n===void 0&&(n=250),!this.EmptyRow&&!this.ProcessLocalMatch()){var t=this.ListValues;if(this.ClearTagIfNotExists(),Core.Extensions.IEnumerableExtensions.HasElement(System.Object,this.MatchedItems)&&Core.Extensions.IEnumerableExtensions.Nothing(System.Int32,System.Linq.Enumerable.from(t,System.Int32).except(System.Linq.Enumerable.from(this.MatchedItems,System.Object).select(function(n){return Bridge.unbox(n[Core.Components.EditableComponent.IdField])})))){this.SetMatchedValue();return}System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,f,s,e,h,i=new System.Threading.Tasks.TaskCompletionSource,r,u,c,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5],n);switch(n){case 0:if(u=this.FormattedDataSource,System.String.startsWith(u,"/")){n=1;continue}else{n=3;continue}case 1:if(u=Core.Extensions.OdataExt.ApplyClause(u,System.String.format("Id in ({0})",[Core.Extensions.IEnumerableExtensions.Combine(System.Int32,t)])),f=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName).GetList(System.Object,u),n=2,f.isCompleted())continue;f["continue"](o);return;case 2:s=f.getAwaitedResult();r=s;n=5;continue;case 3:if(e=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName).LoadById(Core.Extensions.IEnumerableExtensions.Combine(System.Int32,t)),n=4,e.isCompleted())continue;e["continue"](o);return;case 4:h=e.getAwaitedResult();r=h;n=5;continue;case 5:if(r==null||r.Value==null){i.setResult(null);return}this.MatchedItems=r.Value;this.SetMatchedValue();i.setResult(null);return;default:i.setResult(null);return}}}catch(l){c=System.Exception.create(l);i.setException(c)}},arguments);return o(),i.task}))}},ProcessLocalMatch:function(){var t=this._gv!=null&&Core.Extensions.IEnumerableExtensions.HasElement(System.Object,this.RowData.Data)||this.GuiInfo.LocalData!=null,n;return(t&&(n=Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.GuiInfo.LocalData)?this.RowData.Data:this.GuiInfo.LocalData,this.MatchedItems=System.Linq.Enumerable.from(n,System.Object).where(Bridge.fn.bind(this,function(n){return this._listValues.contains(System.Nullable.getValue(Bridge.cast(Bridge.unbox(n[Core.Components.EditableComponent.IdField],System.Int32),System.Int32)))})).toList(System.Object)),Core.Extensions.IEnumerableExtensions.HasElement(System.Object,this.MatchedItems)&&this.MatchedItems.Count===this._listValues.Count)?(this.SetMatchedValue(),!0):!1},SetMatchedValue:function(){var n,t;for(this._input.value="",this.ClearTagIfNotExists(),n=0;n<this.ListValues.Count;n=n+1|0)t=System.Linq.Enumerable.from(this.MatchedItems,System.Object).firstOrDefault(Bridge.fn.bind(this,function(t){return Bridge.unbox(t[Core.Components.EditableComponent.IdField])===this.ListValues.getItem(n)}),null),this.RenderTag(t)},ClearTagIfNotExists:function(){var n,t,u=this.ParentElement.querySelectorAll("div > span"),i,r;n=Bridge.getEnumerator(u,"getEnumerator");try{while(n.moveNext())i=Bridge.cast(n.Current,HTMLElement),r=i.dataset.id,r==null||this.ListValues.contains((t=Core.Extensions.Utils.TryParseInt(r),t!=null?t:0))||i.remove()}finally{Bridge.is(n,System.IDisposable)&&n.System$IDisposable$Dispose()}},RenderTag:function(n){var t,i,r;n!=null&&(t=Bridge.toString(n[Core.Components.EditableComponent.IdField]),i=this.Element.parentElement.querySelector(System.String.format("span[data-id='{0}']",[t])),i==null)&&(Core.MVVM.Html.Take(this.Element.parentElement).Span.Attr$1("data-id",t).InnerHTML(this.GetMatchedText(n)),r=Core.MVVM.Html.Context,this.Element.parentElement.insertBefore(Core.MVVM.Html.Context,this._input),Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Button,"fa fa-times").End.Event("click",Bridge.fn.bind(this,function(){var t=0,i,f,e,o,u,s=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:for(f=(e=System.Int32,System.Linq.Enumerable.from(this.ListValues,e).toList(e)),this.MatchedItems.remove(n),o=Bridge.unbox(n[Core.Components.EditableComponent.IdField]);this.ListValues.contains(o);)this.ListValues.remove(o);if(this.ListValues=this.ListValues,this.Dirty=!0,this.FindMatchText(),Bridge.staticEquals(this.UserInput,null)||this.UserInput((u=new Core.MVVM.ObservableArgs,u.NewData=this.ListValues,u.OldData=f,u)),i=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity,this.ListValues,f]),t=1,i.isCompleted())continue;i["continue"](s);return;case 1:i.getAwaitedResult();r.remove();return;default:return}}},arguments);s()})).End.Render())},EntrySelected:function(n){var t,i,r;(window.clearTimeout(this._waitForDispose),n!=null)&&(i=Bridge.unbox(n[Core.Components.EditableComponent.IdField]),this.ListValues==null&&(this.ListValues=new(System.Collections.Generic.List$1(System.Int32).ctor)),this.ListValues.contains(i)?(this.ListValues.remove(i),r=System.Linq.Enumerable.from(this.MatchedItems,System.Object).firstOrDefault(function(n){return Bridge.unbox(n[Core.Components.EditableComponent.IdField])===i},null),this.MatchedItems.remove(r)):(this.ListValues.add(i),this.MatchedItems.add(n)),this.ListValues=this.ListValues,this.Dirty=!0,this.FindMatchText(),this._input.focus(),Bridge.staticEquals(this.UserInput,null)||this.UserInput((t=new Core.MVVM.ObservableArgs,t.NewData=this.ListValues,t.OldData=this.ListValues,t.NewMatch=n,t)),System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.Events,"change",[this.Entity]),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task})))},UpdateView:function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=null);i===void 0&&(i=[]);this.TryParseData();this.FindMatchText()}}});Bridge.define("Core.Components.RecordDetail",{inherits:[Core.Components.Number],props:{EntityEnum:{get:function(){var n,t;return(n=this.Entity)!=null&&(t=n.EntityId)!=null?Bridge.unbox(t):null}},EntityTye:{get:function(){var t,n;return(t=Core.Extensions.Utils.GetEntity((n=this.EntityEnum,n!=null?n:0)))!=null?t.GetEntityType():null}}},ctors:{ctor:function(n){this.$initialize();Core.Components.Number.ctor.call(this,n)}},methods:{Render:function(){Core.Components.Number.prototype.Render.call(this);this.RecordDetailIcon();Core.MVVM.Html.Take(this.Element).Event("click",Bridge.fn.bind(this,function(){this.Disabled&&System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this,this.OpenDetail))}))},RecordDetailIcon:function(){Core.Components.Renderer.Title(Core.Components.Renderer.Icon(Core.MVVM.Html.Take(this.Element.parentElement),"fa fa-info-circle inline-acc"),System.String.format("Chi tiết dữ liệu",null)).AsyncEvent("click",Bridge.fn.cacheBind(this,this.OpenDetail))},OpenDetail:function(){var i=0,r,n=new System.Threading.Tasks.TaskCompletionSource,u,f,t,e,o=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.RefClass)||System.Nullable.lifteq("equals",this.Value,System.Decimal.lift(null))||System.Nullable.lifteq("equals",this.Value,System.Decimal(0))||this.EntityEnum==null){n.setResult(null);return}if(u=Core.Components.Extensions.ComponentExt.LoadEditorFeatureByNameByEntity(System.Nullable.getValue(this.EntityEnum)),f=new Core.Clients.Client.$ctor1(Bridge.Reflection.getTypeName(this.EntityTye)).GetRawAsync(System.Decimal.toInt(System.Nullable.getValue(this.Value),System.Int32)),r=System.Threading.Tasks.Task.whenAll(u,f),i=1,r.isCompleted())continue;r["continue"](o);return;case 1:if(r.getAwaitedResult(),u.getResult()==null||f.getResult()==null){n.setResult(null);return}t=Bridge.as(Bridge.createInstance(Bridge.Reflection.getType(this.GuiInfo.RefClass)),Core.Components.Forms.TabEditor);t.Id=u.getResult().Name;t.Entity=f.getResult();t.ParentForm=this.TabEditor;this.TabEditor.AddChild(t);n.setResult(null);return;default:n.setResult(null);return}}}catch(s){e=System.Exception.create(s);n.setException(e)}},arguments);return o(),n.task}}});Bridge.define("Core.Components.Timepicker",{inherits:[Core.Components.Textbox],statics:{fields:{_waiter:0,_hour:null,_minute:null},methods:{ClearClosingWaiter:function(){window.clearTimeout(Core.Components.Timepicker._waiter)}}},props:{HHmmFormat:{get:function(){return Core.Components.Datepicker.HHmmFormat}},Hour:{get:function(){var n;return(Core.Extensions.StringExt.IsNullOrWhiteSpace(this.Text)||!Core.Extensions.StringExt.IsMatch(this.Text,"\\d{2}h\\d{2}"))&&(this.Value="00h00"),System.Int64((n=Core.Extensions.Utils.TryParseInt(System.Linq.Enumerable.from(this.Text.split("h"),System.String).firstOrDefault(null,null)),n!=null?n:0))}},Minute:{get:function(){var n;return(Core.Extensions.StringExt.IsNullOrWhiteSpace(this.Text)||!Core.Extensions.StringExt.IsMatch(this.Text,"\\d{2}h\\d{2}"))&&(this.Value="00h00"),System.Int64((n=Core.Extensions.Utils.TryParseInt(System.Linq.Enumerable.from(this.Text.split("h"),System.String).lastOrDefault(null,null)),n!=null?n:0))}}},ctors:{ctor:function(n){this.$initialize();Core.Components.Textbox.ctor.call(this,n)}},methods:{Render:function(){Core.Components.Textbox.prototype.Render.call(this);this.Disabled=!0;this.Input.style.backgroundColor="transparent";this.Input.addEventListener("focusin",Bridge.fn.cacheBind(this,this.RenderTimepicker));this.Input.addEventListener("focusout",Bridge.fn.cacheBind(this,this.WaitToClose))},WaitToClose:function(){window.clearTimeout(Core.Components.Timepicker._waiter);Core.Components.Timepicker._waiter=window.setTimeout(function(){Core.Components.Timepicker._hour.parentElement.parentElement.remove()},250)},RenderTimepicker:function(){Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element.parentElement).Div,"time-picker"),-1).Event("focusin",Core.Components.Timepicker.ClearClosingWaiter).Event("focusout",Bridge.fn.cacheBind(this,this.WaitToClose)).Div,"hour"),"fa fa-chevron-up").Event("click",Bridge.fn.bind(this,function(){this.IncreaseTime(System.Int64(1))})).End.Input.Value(this.Hour.toString(this.HHmmFormat));Core.Components.Timepicker._hour=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement);Core.Components.Timepicker._hour.addEventListener("change",Bridge.fn.cacheBind(this,this.ChangeHour));Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.Icon(Core.MVVM.Html.Instance.End,"fa fa-chevron-down").Event("click",Bridge.fn.bind(this,function(){this.IncreaseTime(System.Int64(-1))})).EndOf$1(".hour").Div,"minute"),"fa fa-chevron-up").Event("click",Bridge.fn.bind(this,function(){this.IncreaseTime(System.Int64(5),!0)})).End.Input.Value(this.Minute.toString(this.HHmmFormat));Core.Components.Timepicker._minute=Bridge.as(Core.MVVM.Html.Context,HTMLInputElement);Core.Components.Timepicker._minute.addEventListener("change",Bridge.fn.cacheBind(this,this.ChangeMinute));Core.Components.Renderer.Icon(Core.MVVM.Html.Instance.End,"fa fa-chevron-down").Event("click",Bridge.fn.bind(this,function(){this.IncreaseTime(System.Int64(-5),!0)})).EndOf$1(".minute")},ChangeMinute:function(){var n={},t=System.Int64.tryParse(Core.Components.Timepicker._minute.value,n);Core.Components.Timepicker._minute.value=t?n.v.toString(this.HHmmFormat):this.Minute.toString(this.HHmmFormat);this.Value=(Core.Components.Timepicker._hour.value||"")+"h"+(Core.Components.Timepicker._minute.value||"")},ChangeHour:function(){var n={},t=System.Int64.tryParse(Core.Components.Timepicker._hour.value,n);Core.Components.Timepicker._hour.value=t?n.v.toString(this.HHmmFormat):this.Hour.toString(this.HHmmFormat);this.Value=(Core.Components.Timepicker._hour.value||"")+"h"+(Core.Components.Timepicker._minute.value||"")},IncreaseTime:function(n,t){t===void 0&&(t=!1);Core.Components.Timepicker.ClearClosingWaiter();var i=this.Hour.add(n),r=this.Minute.add(n);!t&&i.gte(System.Int64(0))&&i.lt(System.Int64(24))?Core.Components.Timepicker._hour.value=i.toString(this.HHmmFormat):r.gte(System.Int64(0))&&r.lt(System.Int64(60))&&(Core.Components.Timepicker._minute.value=r.toString(this.HHmmFormat));this.Value=(Core.Components.Timepicker._hour.value||"")+"h"+(Core.Components.Timepicker._minute.value||"");this.Dirty=!0}}});Bridge.define("Core.Components.TreeView",{inherits:[Core.Components.ListView],ctors:{ctor:function(n){this.$initialize();Core.Components.ListView.ctor.call(this,n)}},methods:{Rerender:function(){var n,t,i;if(this.DisposeNoRecord(),this.Editable=this.GuiInfo.CanAdd&&System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).any(function(n){return!n.Hidden&&n.Editable}),this.Header=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).where(function(n){return!n.Hidden}).toList(Core.Models.GridPolicy),Core.Extensions.HtmlElementExtension.AddClass(this.MainSection.Element,"overflow"),t=(n=Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.FormattedRowData)?this.RowData.Data:this.FormattedRowData,this.FormattedRowData=n,n),this.RenderContent$1(this.Header,this.MainSection,!0,t),this.MainSection.DisposeChildren(),this.Editable)this.AddNewEmptyRow();else if(Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.RowData.Data)){this.NoRecordFound();this.DomLoaded();return}(i=Bridge.as(this.MainSection.Element,HTMLTableSectionElement))!=null&&i.addEventListener("contextmenu",Bridge.fn.cacheBind(this,this.BodyContextMenuHandler));this.DomLoaded();Core.Components.Spinner.Hide()},RenderContent$1:function(n,t,i,r){if(!Core.Extensions.IEnumerableExtensions.Nothing(System.Object,r)){Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(t.Element).Ul,((i?" ":"d-block ")||"")+((i?" treeview":" ")||""));var u=Core.MVVM.Html.Context;r.ForEach(Bridge.fn.bind(this,function(i){var r=0,f,e=Bridge.fn.bind(this,function(){for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(f=this.RenderRow(n,t,i,u),r=1,f.isCompleted())continue;f["continue"](e);return;case 1:f.getAwaitedResult();return;default:return}}},arguments);e()}))}},RenderRow:function(n,t,i,r){var f=0,e,l,o=new System.Threading.Tasks.TaskCompletionSource,a,h,v,u,s,c,y,p,w=Bridge.fn.bind(this,function(){try{for(;;){f=System.Array.min([0,1],f);switch(f){case 0:if(e=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName).GetList(System.Object,System.String.format("?$filter=ParentId eq {0}",[Core.Extensions.BridgeExt.GetPropValue(i,Core.Components.EditableComponent.IdField)])),f=1,e.isCompleted())continue;e["continue"](w);return;case 1:l=e.getAwaitedResult();a=l;h=a.Value;v=h.Count;Core.MVVM.Html.Take(r);u=(s=new Core.Components.ListViewItem(Core.MVVM.ElementType.li),s.Entity=i,s.ListViewSection=this.MainSection,s);t.AddChild(u);Core.Extensions.HtmlElementExtension.AddClass(u.Element,"tree-node");Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"d-inline-flex-fs").Table,"table").TRow.Render();c=Core.MVVM.Html.Context;y=Bridge.Int.div(95,System.Linq.Enumerable.from(n,Core.Models.GridPolicy).count())|0;Core.Extensions.IEnumerableExtensions.ForEach(Core.Models.GridPolicy,n,function(n){var t=Core.Extensions.Utils.MapToComponent(n);Core.Components.Renderer.Width(Core.MVVM.Html.Take(c).TData,System.String.format("{0}%",[Bridge.box(y,System.Int32)])).Render();u.RenderTableCell(i,t);Core.MVVM.Html.Take(c).EndOf(Core.MVVM.ElementType.td)});v>0&&Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(u.Element).Span,"node-toggle").Event("click",Bridge.fn.bind(this,function(){this.FocusIn(u,i,h)}));o.setResult(null);return;default:o.setResult(null);return}}}catch(b){p=System.Exception.create(b);o.setException(p)}},arguments);return w(),o.task},FocusIn:function(n,t,i){var r=n.Element.querySelector("ul");Core.Extensions.HtmlElementExtension.HasClass(n.Element,"expanded")?(Core.Extensions.HtmlElementExtension.RemoveClass(r,"d-block"),Core.Extensions.HtmlElementExtension.AddClass(r,"d-none"),Core.Extensions.HtmlElementExtension.RemoveClass(n.Element,"expanded")):(Core.Extensions.HtmlElementExtension.AddClass(n.Element,"expanded"),r==null?this.RenderContent$1(this.Header,n,!1,i):(Core.Extensions.HtmlElementExtension.RemoveClass(r,"d-none"),Core.Extensions.HtmlElementExtension.AddClass(r,"d-block"),Core.Extensions.HtmlElementExtension.AddClass(n.Element,"expanded")))},CalcFilterQuery:function(n){var i=Core.Components.ListView.prototype.CalcFilterQuery.call(this,n),r=Core.Extensions.StringExt.IsNullOrWhiteSpace(this.ListViewSearch.EntityVM.SearchTerm)&&Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.FieldCondition,this.AdvSearchVM.Conditions),t;return n&&!r?(t=Core.Extensions.OdataExt.GetClausePart(i,Core.Extensions.OdataExt.FilterKeyword),t=t.replace(new RegExp("((and|or) )?Parent(\\w|\\W)* eq null( (and|or)$)?"),""),t=t.replace(new RegExp("^Parent(\\w|\\W)* eq null( (and|or))?"),""),Core.Extensions.OdataExt.ApplyClause(i,t)):i}}});Bridge.define("TMS.UI.PortalBL",{inherits:[Core.Components.Forms.EditForm],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.EditForm.ctor.call(this,"User");this.Name="Home";this.Entity=new Core.Models.User}},methods:{Render:function(){System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this,this.RenderLandingPage))},RenderLandingPage:function(){var n=0,t,f,i,r=new System.Threading.Tasks.TaskCompletionSource,e,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4],n);switch(n){case 0:if(this.Feature==null){n=1;continue}n=3;continue;case 1:if(t=Core.Components.Extensions.ComponentExt.LoadFeatureByName(this.Name,!0),n=2,t.isCompleted())continue;t["continue"](u);return;case 2:f=t.getAwaitedResult();this.Feature=f;n=3;continue;case 3:if(i=this.RenderAsync(),n=4,i.isCompleted())continue;i["continue"](u);return;case 4:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(o){e=System.Exception.create(o);r.setException(e)}},arguments);return u(),r.task}}});Bridge.define("Core.Components.Forms.PopupEditor",{inherits:[Core.Components.Forms.TabEditor],ctors:{ctor:function(n){var t;this.$initialize();Core.Components.Forms.TabEditor.ctor.call(this,n);this.Popup=!0;this.ParentElement=(t=this.TabEditor)!=null?t.Element:null;this.ShouldLoadEntity=!1}}});Bridge.define("Core.Components.CompareGridView",{inherits:[Core.Components.GridView],statics:{fields:{ContentFieldName:null,ReasonOfChange:null,Style:null},ctors:{init:function(){this.ContentFieldName="TextHistory";this.ReasonOfChange="ReasonOfChange";this.Style="white-space: pre-wrap;"}}},ctors:{ctor:function(n){this.$initialize();Core.Components.GridView.ctor.call(this,n);this.GuiInfo.LocalHeader=function(n){var t,i,u,r;return n.add((t=new Core.Models.GridPolicy,t.FieldName="InsertedBy",t.ComponentType="Label",t.ShortDesc="Người thao tác",t.Description="Người thao tác",t.ReferenceId=(i=(u=Core.Extensions.Utils.GetEntity$1("User"))!=null?u.Id:null,i!=null?i:0),t.Reference=(r=new Core.Models.Entity,r.Name="User",r),t.RefName="User",t.FormatCell="{FullName}",t.Active=!0,t)),n.add((t=new Core.Models.GridPolicy,t.FieldName="InsertedDate",t.ComponentType="Label",t.ShortDesc="Ngày thao tác",t.Description="Ngày thao tác",t.Active=!0,t.TextAlign="left",t.FormatCell="{0:dd/MM/yyyy HH:mm zz}",t)),n.add((t=new Core.Models.GridPolicy,t.FieldName="ReasonOfChange",t.ComponentType="Label",t.ShortDesc="Nội dung",t.Description="Nội dung",t.HasFilter=!0,t.Active=!0,t)),n.add((t=new Core.Models.GridPolicy,t.FieldName="TextHistory",t.ComponentType="Label",t.ChildStyle=Core.Components.CompareGridView.Style,t.ShortDesc="Chi tiết thay đổi",t.Description="Chi tiết thay đổi",t.HasFilter=!0,t.Active=!0,t)),n}(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor))}},methods:{FilterColumns:function(n){return Core.Components.GridView.prototype.FilterColumns.call(this,n),n.ForEach(function(n){n.Frozen=!1}),this.Header.remove(System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).firstOrDefault(function(n){return Bridge.referenceEquals(n,Core.Components.GridView.ToolbarColumn)},null)),n}}});Bridge.define("Core.Components.FileUploadGrid",{inherits:[Core.Components.GridView],ctors:{ctor:function(n){this.$initialize();Core.Components.GridView.ctor.call(this,n);this.GuiInfo=n;n.LocalHeader=Bridge.fn.bind(this,function(t){var i,r,f,u,e;return t.add((i=new Core.Models.GridPolicy,i.FieldName="FileName",i.Editable=!0,i.ShortDesc="Name",i.ComponentType="Input",i.Order=2,i)),t.add((i=new Core.Models.GridPolicy,i.FieldName="FilePath",i.Editable=!0,i.Active=!0,i.ComponentType="ImageUploader",i.DataSource=Core.Extensions.StringExt.IsNullOrEmpty(n.DataSourceFilter)?"*.*":n.DataSourceFilter,i.ShortDesc="File",i.IsRealtime=this.GuiInfo.IsRealtime,i.Precision=1,i.Order=1,i)),t.add((i=new Core.Models.GridPolicy,i.FieldName="InsertedBy",i.Active=!0,i.RefName="User",i.ReferenceId=(r=(f=Core.Extensions.Utils.GetEntity$1("User"))!=null?f.Id:null,r!=null?r:0),i.FormatCell="{FullName}",i.ComponentType="Label",i.ShortDesc="Created by",i.Order=3,i)),t.add((i=new Core.Models.GridPolicy,i.FieldName="InsertedDate",i.Active=!0,i.ComponentType="Label",i.ShortDesc="Created date",i.Order=4,i)),t.add((i=new Core.Models.GridPolicy,i.FieldName="UpdatedBy",i.Active=!0,i.RefName="User",i.ReferenceId=(u=(e=Core.Extensions.Utils.GetEntity$1("User"))!=null?e.Id:null,u!=null?u:0),i.FormatCell="{FullName}",i.ComponentType="Label",i.ShortDesc="Updated by",i.Order=5,i)),t.add((i=new Core.Models.GridPolicy,i.FieldName="UpdatedDate",i.Active=!0,i.ComponentType="Label",i.ShortDesc="Updated date",i.Order=6,i)),t})(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor));n.Row=2147483647;this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.cacheBind(this,this.SetEntityPath))}},methods:{Render:function(){this.RowData._data=new(System.Collections.Generic.List$1(System.Object).ctor);this.GuiInfo.DataSourceFilter=System.String.format("?$filter=EntityName eq '{0}' and RecordId eq {1} and FieldName eq '{2}' and SectionId eq {3} and RecordId ne 0",this.GuiInfo.IdField,this.Entity[Core.Components.EditableComponent.IdField],this.GuiInfo.FieldName,Bridge.box(this.GuiInfo.ComponentGroupId,System.Int32));this.DataSourceFilter=this.GuiInfo.DataSourceFilter;Core.Components.GridView.prototype.Render.call(this);this.Paginator.Show=!1},AddSections:function(){var n;((n=this.HeaderSection)!=null?n.Element:null)==null&&(Core.Components.GridView.prototype.AddSections.call(this),Core.Components.Renderer.Title(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div,"toolbar").Button,"btn fa fa-download"),"Download all").Event("click",Bridge.fn.cacheBind(this,this.DownloadAll)).End.Render(),Core.Extensions.HtmlElementExtension.Prepend(this.Element,Core.MVVM.Html.Context))},DownloadAll:function(){System.Linq.Enumerable.from(this.RowData.Data,System.Object).select(function(n){return Core.Extensions.BridgeExt.CastProp(Core.ViewModels.FileUpload,n)}).forEach(function(n){Core.Clients.Client.Download(n.FilePath)})},RowChangeHandler:function(n,t,i,r){var u=0,f,e,o=new System.Threading.Tasks.TaskCompletionSource,h,s=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1,2,3,4],u);switch(u){case 0:if(r===void 0&&(r=null),System.Nullable.lte(Bridge.unbox(n.Id),0)?(n.InsertedBy=Bridge.box(Core.Clients.Client.Token.UserId,System.Int32),n.InsertedDate=Bridge.box(System.DateTime.getNow(),System.DateTime,System.DateTime.format)):(n.UpdatedBy=Bridge.box(Core.Clients.Client.Token.UserId,System.Int32),n.UpdatedDate=Bridge.box(System.DateTime.getNow(),System.DateTime,System.DateTime.format)),n.EntityName=this.GuiInfo.IdField,n.RecordId=Bridge.box(this.EntityId,System.Int32),n.SectionId=Bridge.box(this.GuiInfo.ComponentGroupId,System.Int32),n.FieldName=this.GuiInfo.FieldName,n.FileName=Core.Components.ImageUploader.RemoveGuid(Bridge.as(n.FilePath,System.String)),f=this.RowChangeHandlerGrid(n,t,i),u=1,f.isCompleted())continue;f["continue"](s);return;case 1:if(f.getAwaitedResult(),t.UpdateView$1(!0),this.SetEntityPath(),this.GuiInfo.IsRealtime&&this.EntityId>0){u=2;continue}u=4;continue;case 2:if(e=this.RealtimeUpdateAsync(t,i),u=3,e.isCompleted())continue;e["continue"](s);return;case 3:e.getAwaitedResult();u=4;continue;case 4:this.Dirty=!0;o.setResult(null);return;default:o.setResult(null);return}}}catch(c){h=System.Exception.create(c);o.setException(h)}},arguments);return s(),o.task},BatchUpdate:function(n){return n===void 0&&(n=!1),this.UpdatedRows.ForEach(Bridge.fn.bind(this,function(n){n.RecordId=Bridge.box(this.EntityId,System.Int32)})),Core.Components.GridView.prototype.BatchUpdate.call(this,n)},SetEntityPath:function(){this.Entity[this.GuiInfo.FieldName]=Core.Extensions.IEnumerableExtensions.Combine$1(Core.Components.ListViewItem,System.String,this.AllListViewItem,function(n){return Bridge.as(n.Entity.FilePath,System.String)},Core.Components.ImageUploader.PathSeparator)},SetRowData:function(n){n==null&&(n=new(System.Collections.Generic.List$1(System.Object).ctor));n=this.MergePaths(n);this.RowData._data=new(System.Collections.Generic.List$1(System.Object).ctor);Core.Extensions.IEnumerableExtensions.HasElement(System.Object,n)&&n.ForEach(Bridge.fn.cacheBind(this.RowData._data,this.RowData._data.add));this.RenderContent();this.SetEntityPath()},MergePaths:function(n){var t=Bridge.as(this.Entity[this.GuiInfo.FieldName],System.String);if(Core.Extensions.StringExt.IsNullOrWhiteSpace(t))return n;var i=Core.Extensions.ReflectionExt.ToDictionaryDistinct(System.Object,System.String,n,function(n){return Bridge.unbox(n.FilePath)}),r=t.split(Core.Components.ImageUploader.PathSeparator),u=System.Linq.Enumerable.from(r,System.String).select(Bridge.fn.bind(this,function(n){var t,r=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String,System.Object,i,n);return t=new Core.ViewModels.FileUpload,t.EntityName=this.GuiInfo.IdField,t.RecordId=this.EntityId,t.SectionId=this.GuiInfo.ComponentGroupId,t.FieldName=this.GuiInfo.FieldName,t.FileName=Core.Components.ImageUploader.RemoveGuid(n),t.FilePath=n,t.Id=(r!=null?r.Id:null)||0,t.InsertedBy=(r!=null?r.InsertedBy:null)||1,t.InsertedDate=(r!=null?r.InsertedDate:null)||System.DateTime.getNow(),t.UpdatedBy=r!=null?r.UpdatedBy:null,t.UpdatedDate=r!=null?r.UpdatedDate:null,t})).ToArray(Core.ViewModels.FileUpload);return System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.ViewModels.FileUpload,System.String,System.Linq.Enumerable.from(u,Core.ViewModels.FileUpload).union(System.Linq.Enumerable.from(n,System.Object).select(function(n){return Core.Extensions.BridgeExt.CastProp(Core.ViewModels.FileUpload,n)})),function(n){return n.FilePath})).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object)},HardDeleteConfirmed:function(n){var t=0,i,u,r=new System.Threading.Tasks.TaskCompletionSource,f,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=Core.Components.GridView.prototype.HardDeleteConfirmed.call(this,n),t=1,i.isCompleted())continue;i["continue"](o);return;case 1:u=i.getAwaitedResult();f=u;this.Dirty=!0;this.SetEntityPath();r.setResult(f);return;default:r.setResult(null);return}}}catch(s){e=System.Exception.create(s);r.setException(e)}},arguments);return o(),r.task}}});Bridge.define("Core.Components.Framework.FeatureBL",{inherits:[Core.Components.Forms.TabEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.TabEditor.ctor.call(this,"Feature");this.Name="Feature management";this.Title="Feature";this.Icon="icons/config.png";this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.cacheBind(this,this.AlterPosition))}},methods:{AlterPosition:function(){Core.Extensions.HtmlElementExtension.AddClass(this.Element.parentElement,"properties")},EditFeature:function(n){var t="Feature_"+n.Id;Core.Components.Extensions.ComponentExt.OpenTab(this,t,function(){var i,r,u;return i=new Core.Components.Framework.FeatureDetailBL,i.Id=t,i.Entity=n,i.Title=System.String.format("Feature {0}",[(r=n.Name,r!=null?r:(u=n.Label,u!=null?u:n.Description))]),i})}}});Bridge.define("Core.Components.GridViewItem",{inherits:[Core.Components.ListViewItem],ctors:{ctor:function(n){this.$initialize();Core.Components.ListViewItem.ctor.call(this,n)}},methods:{Render:function(){Core.Components.ListViewItem.prototype.Render.call(this)},RenderTableCell:function(n,t,i){(i===void 0&&(i=null),Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(this.Element).TData,-1).Event$1("focusin",Bridge.fn.bind(this,function(n){this.FocusCell(n,t)})).DataAttr$1("field",t.FieldName).Render(),t.StatusBar&&Core.Components.Renderer.Icon(Core.MVVM.Html.Instance,"fa fa-pencil").End.Render(),System.String.isNullOrEmpty(t.FieldName))||(Core.Components.ListViewItem.prototype.RenderTableCell.call(this,n,t,i||Core.MVVM.Html.Context),Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.td))},FocusCell:function(n,t){this.ListViewSection.ListView.LastElementFocus!=null&&Core.Extensions.HtmlElementExtension.RemoveClass(Core.Extensions.HtmlElementExtension.Closest(this.ListViewSection.ListView.LastElementFocus,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),"cell-selected");var i=Bridge.as(n.target,HTMLElement);Core.Extensions.HtmlElementExtension.AddClass(Core.Extensions.HtmlElementExtension.Closest(i,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),"cell-selected");this.ListViewSection.ListView.LastElementFocus=i;this.ListViewSection.ListView.LastComponentFocus=t;this.ListViewSection.ListView.EntityFocusId=Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField])}}});Bridge.define("Core.Components.GroupGridView",{inherits:[Core.Components.GridView],statics:{fields:{_groupKey:null,GroupRowClass:null},ctors:{init:function(){this._groupKey="__groupkey__";this.GroupRowClass="group-row"}}},ctors:{ctor:function(n){this.$initialize();Core.Components.GridView.ctor.call(this,n)}},methods:{Render:function(){Core.Components.GridView.prototype.Render.call(this);Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element),"group-table").End.Render()},RowDataChanged:function(n){if(System.Nullable.eq(n.Action,Core.MVVM.ObservableAction.Remove)){if(n.Item==null&&Bridge.unbox(n.Item[Core.Components.EditableComponent.IdField])!=null)return;this.RemoveRowById(Bridge.unbox(n.Item[Core.Components.EditableComponent.IdField]));return}window.clearTimeout(this._rowDataChangeAwaiter);this._rowDataChangeAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){var t=0,i,s,r,h,u,f,o,e=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1,2,3,4,5,6,7],t);switch(t){case 0:if(Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.GroupBy))return;if(System.Nullable.eq(n.Action,Core.MVVM.ObservableAction.Render)&&this.NoRowData(n.ListData),f=n.Action,f===Core.MVVM.ObservableAction.Add){t=1;continue}else if(f===Core.MVVM.ObservableAction.AddRange){t=3;continue}else if(f===Core.MVVM.ObservableAction.Update){t=5;continue}t=7;continue;case 1:if(i=this.AddRow(n.Item),t=2,i.isCompleted())continue;i["continue"](e);return;case 2:s=i.getAwaitedResult();return;case 3:if(r=this.AddRows(n.ListData,n.Index),t=4,r.isCompleted())continue;r["continue"](e);return;case 4:h=r.getAwaitedResult();return;case 5:if(u=this.AddOrUpdateRow(n.Item),t=6,u.isCompleted())continue;u["continue"](e);return;case 6:u.getAwaitedResult();return;case 7:o=this.GuiInfo.GroupBy.split(",");this.FormattedRowData=System.Linq.Enumerable.from(n.ListData,System.Object).select(function(n){return n[Core.Components.GroupGridView._groupKey]=Bridge.toArray(System.Linq.Enumerable.from(o,System.String).select(function(t){var i;return(i=Core.Extensions.Utils.GetComplexPropValue(n,t))!=null?Bridge.toString(i):null})).join(" "),n}).groupBy(function(n){return n[Core.Components.GroupGridView._groupKey]}).select(function(n){var t;return t=new Core.Components.GroupRowData,t.Key=n.key(),t.Children=n.toList(System.Object),t}).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object);Core.Components.GridView.prototype.Rerender.call(this);this.DomLoaded();return;default:return}}},arguments);e()}))},RenderContent:function(){(this.AddSections(),this.FormattedRowData=Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.FormattedRowData)?this.RowData.Data:this.FormattedRowData,Core.Extensions.IEnumerableExtensions.Nothing(System.Object,this.FormattedRowData))||(this.MainSection.Show=!1,Core.Extensions.IEnumerableExtensions.ForEach$1(System.Object,this.FormattedRowData,Bridge.fn.bind(this,function(n){Core.MVVM.Html.Take(this.MainSection.Element);this.RenderRowData(this.Header,n,this.MainSection,null)})),this.MainSection.Show=!0)},ApplyFilter:function(n){return n===void 0&&(n=!0),this.MainSection.DisposeChildren(),Core.Components.GridView.prototype.ApplyFilter.call(this,n)},NoRowData:function(n){this.Editable=this.GuiInfo.CanAdd&&System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).any(function(n){return!n.Hidden&&n.Editable});this.Editable?this.AddNewEmptyRow():Core.Extensions.IEnumerableExtensions.Nothing(System.Object,n)&&this.NoRecordFound()},AddRow:function(n,t,i){var r=0,f,e=new System.Threading.Tasks.TaskCompletionSource,l,s,u,h,c,o,a,v,y=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1,2,3],r);switch(r){case 0:if(t===void 0&&(t=0),i===void 0&&(i=!0),this.DisposeNoRecord(),l=this.GuiInfo.GroupBy.split(","),i){r=1;continue}r=3;continue;case 1:if(f=this.LoadMasterData(function(t){return t.add(n),t}(new(System.Collections.Generic.List$1(System.Object).ctor))),r=2,f.isCompleted())continue;f["continue"](y);return;case 2:f.getAwaitedResult();r=3;continue;case 3:n[Core.Components.GroupGridView._groupKey]=Bridge.toArray(System.Linq.Enumerable.from(l,System.String).select(function(t){var i;return(i=Core.Extensions.Utils.GetComplexPropValue(n,t))!=null?Bridge.toString(i):null})).join(" ");s=n[Core.Components.GroupGridView._groupKey];u=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).firstOrDefault(function(n){return n.GroupRow&&Bridge.referenceEquals(Bridge.unbox(n.Entity).Key,s)},null);u==null?(c=(o=new Core.Components.GroupRowData,o.Key=s,o.Children=function(t){return t.add(n),t}(new(System.Collections.Generic.List$1(System.Object).ctor)),o),this.FormattedRowData.add(c),h=this.RenderRowData(this.Header,c,this.MainSection,0)):(Bridge.unbox(u.Entity).Children.add(n),a=this.MainSection.Children.indexOf(u),h=this.RenderRowData(this.Header,n,this.MainSection,Bridge.Int.clip32((a+u.Children.Count|0)+1)));this.Dirty=!0;e.setResult(h);return;default:e.setResult(null);return}}}catch(p){v=System.Exception.create(p);e.setException(v)}},arguments);return y(),e.task},RenderRowData:function(n,t,i,r,u){var e,o,s,c,f,h,a,l;if(u===void 0&&(u=!1),!((o=Bridge.as(t,Core.Components.GroupRowData))!=null))return Core.Components.GridView.prototype.RenderRowData.call(this,n,t,i,r,u);if(!((s=Bridge.as(i.Element,HTMLTableSectionElement))!=null))throw new System.InvalidOperationException.$ctor1("The section is not HTML table element");return(Core.MVVM.Html.Take(s),o.Key==null||Core.Extensions.StringExt.IsNullOrWhiteSpace(Bridge.toString(o.Key)))?(c=null,o.Children.ForEach(Bridge.fn.bind(this,function(t){Core.MVVM.Html.Take(s);c=Core.Components.GridView.prototype.RenderRowData.call(this,n,t,i,null)})),c):(f=(e=new Core.Components.GroupViewItem(Core.MVVM.ElementType.tr),e.Entity=t,e.ParentElement=s,e.GroupRow=!0,e.ListViewSection=Bridge.as(i,Core.Components.ListViewSection),e.ListView=this,e),i.AddChild(f),f.Element.tabIndex=-1,h=System.Linq.Enumerable.from(o.Children,System.Object).firstOrDefault(null,null),l={},a=Core.Extensions.Utils.IsFunction(this.GuiInfo.GroupFormat,l)?Bridge.toString(l.v.call(this,this,Bridge.unbox(h))):Core.Extensions.Utils.FormatEntity(this.GuiInfo.GroupFormat,null,h,Core.Extensions.Utils.EmptyFormat,Core.Extensions.Utils.EmptyFormat),Core.Components.Renderer.ClassName(Core.Components.Renderer.Icon(Core.Components.Renderer.ColSpan(Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.TData,"status-cell"),"mif-pencil").EndOf(Core.MVVM.ElementType.td).TData,n.Count-1|0).AsyncEvent$2(System.Object,"click",Bridge.fn.cacheBind(this,this.DispatchClick),h).AsyncEvent$2(System.Object,"dblclick",Bridge.fn.cacheBind(this,this.DispatchDblClick),h),"fa fa-chevron-down").Event("click",function(){f.ShowChildren=!f.ShowChildren}).End.Div,"d-flex").InnerHTML(a),f.GroupText=Core.MVVM.Html.Context,f.Chevron=Core.MVVM.Html.Context.previousElementSibling,f.Chevron.parentElement.previousElementSibling.appendChild(f.Chevron),Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.td),Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.tr),o.Children.ForEach(Bridge.fn.bind(this,function(t){Core.MVVM.Html.Take(s);var r=Core.Components.GridView.prototype.RenderRowData.call(this,n,t,i);Core.Extensions.HtmlElementExtension.AddClass(r.Element,"group-detail");f.ChildrenItems.add(r);r.GroupSection=f})),f)},DispatchClick:function(n){return Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.GroupEvent,"click",[n])},DispatchDblClick:function(n){return Core.Components.Extensions.ComponentExt.DispatchEventToHandlerAsync(this,this.GuiInfo.GroupEvent,"dblclick",[n])},ToggleAll:function(){var n=System.Linq.Enumerable.from(this.AllListViewItem,Core.Components.ListViewItem).where(function(n){return!n.GroupRow&&!n.EmptyRow}).all(function(n){return n.Selected});n?this.ClearSelected():this.RowAction(function(n){n.Selected=!n.GroupRow&&!n.EmptyRow})},RemoveRowById:function(n){var t=Core.Extensions.IEnumerableExtensions.IndexOf(System.Object,this.RowData.Data,function(t){return Bridge.unbox(t[Core.Components.EditableComponent.IdField])===n});t<0||(this.RowData.Data.removeAt(t),System.Linq.Enumerable.from(this.FilterChildren$1(function(t){return Bridge.is(t,Core.Components.ListViewItem)&&Bridge.unbox(t.Entity[Core.Components.EditableComponent.IdField])===n})).select(function(n){return Bridge.cast(n,Core.Components.ListViewItem)}).toList(Core.Components.ListViewItem).ForEach(Bridge.fn.bind(this,function(n){if(n.GroupSection!=null&&Bridge.is(n.GroupSection.Entity,Core.Components.GroupRowData)){var t=Bridge.unbox(n.GroupSection.Entity).Children;t.remove(n.Entity);Core.Extensions.IEnumerableExtensions.Nothing(System.Object,t)&&(this.RowData.Data.remove(n.GroupSection.Entity),n.GroupSection.Dispose())}n.Dispose()})),this.NoRowData(this.RowData.Data))},RemoveRange:function(n){Core.Extensions.IEnumerableExtensions.ForEach(System.Object,n,Bridge.fn.bind(this,function(n){this.RemoveRowById(Bridge.unbox(n[Core.Components.EditableComponent.IdField]))}))},AddRows:function(n,t){var i=0,r,u,h,f=new System.Threading.Tasks.TaskCompletionSource,e,s,o=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3,4],i);switch(i){case 0:if(t===void 0&&(t=0),!this.GuiInfo.IsRealtime){i=1;continue}i=3;continue;case 1:if(r=this.LoadMasterData(n),i=2,r.isCompleted())continue;r["continue"](o);return;case 2:r.getAwaitedResult();i=3;continue;case 3:if(e=new(System.Collections.Generic.List$1(Core.Components.ListViewItem).ctor),u=Core.Extensions.IEnumerableExtensions.ForEachAsync(System.Object,n,Bridge.fn.bind(this,function(n){var i=0,r,f,u=new System.Threading.Tasks.TaskCompletionSource,o,s=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(r=this.AddRow(n,t,!1),i=1,r.isCompleted())continue;r["continue"](s);return;case 1:f=r.getAwaitedResult();e.add(f);u.setResult(null);return;default:u.setResult(null);return}}}catch(h){o=System.Exception.create(h);u.setException(o)}},arguments);return s(),u.task})),i=4,u.isCompleted())continue;u["continue"](o);return;case 4:h=u.getAwaitedResult();f.setResult(e);return;default:f.setResult(null);return}}}catch(c){s=System.Exception.create(c);f.setException(s)}},arguments);return o(),f.task},AddOrUpdateRow:function(n,t,i,r){var u=0,o,a,s,h,v,e=new System.Threading.Tasks.TaskCompletionSource,f,l,c=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1,2,3,4,5,6,7,8,9,10],u);switch(u){case 0:if(t===void 0&&(t=!0),i===void 0&&(i=!1),r===void 0&&(r=[]),f=System.Linq.Enumerable.from(this.FilterChildren$1(function(t){return Bridge.is(t,Core.Components.ListViewItem)&&Bridge.referenceEquals(t.Entity[Core.Components.EditableComponent.IdField],n[Core.Components.EditableComponent.IdField])})).select(function(n){return Bridge.cast(n,Core.Components.ListViewItem)}).firstOrDefault(null,null),f==null){u=1;continue}u=3;continue;case 1:if(o=this.AddRow(n,0,t),u=2,o.isCompleted())continue;o["continue"](c);return;case 2:a=o.getAwaitedResult();e.setResult(null);return;case 3:if(t){u=4;continue}u=6;continue;case 4:if(s=this.LoadMasterData(function(t){return t.add(n),t}(new(System.Collections.Generic.List$1(System.Object).ctor)),!1),u=5,s.isCompleted())continue;s["continue"](c);return;case 5:s.getAwaitedResult();u=6;continue;case 6:if(f.EmptyRow){u=7;continue}else{u=9;continue}case 7:if(f.Entity=null,h=this.AddRow(n,0,t),u=8,h.isCompleted())continue;h["continue"](c);return;case 8:v=h.getAwaitedResult();u=10;continue;case 9:Core.Extensions.ReflectionExt.CopyPropFrom$1(f.Entity,n);this.RowAction$1(function(n){return Bridge.referenceEquals(n.Entity,f.Entity)},function(n){n.UpdateView$1(i,r)});u=10;continue;case 10:e.setResult(null);return;default:e.setResult(null);return}}}catch(y){l=System.Exception.create(y);e.setException(l)}},arguments);return c(),e.task},AddOrUpdateRows:function(n){var t=0,i,r,o,u=new System.Threading.Tasks.TaskCompletionSource,e,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2],t);switch(t){case 0:if(i=this.LoadMasterData(n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:if(i.getAwaitedResult(),r=Core.Extensions.IEnumerableExtensions.ForEachAsync(System.Object,n,Bridge.fn.bind(this,function(n){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.AddOrUpdateRow(n,!1),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task})),t=2,r.isCompleted())continue;r["continue"](f);return;case 2:o=r.getAwaitedResult();u.setResult(null);return;default:u.setResult(null);return}}}catch(s){e=System.Exception.create(s);u.setException(e)}},arguments);return f(),u.task},RenderIndex:function(n){n===void 0&&(n=null);window.clearTimeout(this._renderIndexAwaiter);this._renderIndexAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){var n=0,t=0,i=!1;System.Linq.Enumerable.from(this.MainSection.Children).select(function(n){return Bridge.cast(n,Core.Components.ListViewItem)}).forEach(function(r){if(r.GroupRow){n=0;i=!0;return}!Core.Extensions.HtmlElementExtension.HasClass(r.Element,"group-detail")&&i&&(n=0,i=!1);var u=Core.Extensions.HtmlElementExtension.Closest(r.FirstChild.Element,"td").previousElementSibling;u!=null&&(r.EmptyRow?(n=0,u.innerHTML="<i class='fal fa-plus'><\/i>"):(u.innerHTML=Bridge.toString(n+1|0),r.RowNo=t,t=t+1|0,n=n+1|0))})}))},SetRowData:function(n){var t,i;this.RowData._data.clear();i=Core.Extensions.IEnumerableExtensions.HasElement(System.Object,n);i&&n.ForEach(Bridge.fn.cacheBind(this.RowData._data,this.RowData._data.add));this.RowDataChanged((t=new(Core.MVVM.ObservableListArgs$1(System.Object)),t.Action=Core.MVVM.ObservableAction.Render,t.ListData=this.RowData._data,t));this.Entity!=null&&this.ShouldSetEntity&&Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity,this.GuiInfo.FieldName,this.RowData.Data)}}});Bridge.define("Core.Components.GroupViewItem",{inherits:[Core.Components.ListViewItem],statics:{fields:{ChevronDown:null,ChevronRight:null},ctors:{init:function(){this.ChevronDown="fa-chevron-down";this.ChevronRight="fa-chevron-right"}}},fields:{_showChildren:!1},props:{ParentItem:null,ChildrenItems:null,GroupText:null,Chevron:null,Selected:{get:function(){return!1},set:function(){this._selected=!1}},ShowChildren:{get:function(){return this._showChildren},set:function(n){this._showChildren=n;this.ChildrenItems.ForEach(function(t){t.Show=n});n?Core.Extensions.HtmlElementExtension.ReplaceClass(this.Chevron,Core.Components.GroupViewItem.ChevronRight,Core.Components.GroupViewItem.ChevronDown):Core.Extensions.HtmlElementExtension.ReplaceClass(this.Chevron,Core.Components.GroupViewItem.ChevronDown,Core.Components.GroupViewItem.ChevronRight)}}},ctors:{ctor:function(n){this.$initialize();Core.Components.ListViewItem.ctor.call(this,n);this.GroupRow=!0;this.ChildrenItems=new(System.Collections.Generic.List$1(Core.Components.ListViewItem).ctor)}},methods:{Render:function(){Core.Components.ListViewItem.prototype.Render.call(this);Core.Extensions.HtmlElementExtension.AddClass(this.Element,Core.Components.GroupGridView.GroupRowClass)},AppendGroupText:function(n){this.GroupText!=null&&(this.GroupText.innerHTML=(this.GroupText.firstElementChild.outerHTML||"")+(n||""))},SetGroupText:function(n){this.GroupText!=null&&(this.GroupText.innerHTML=n)}}});Bridge.define("Core.Components.Table",{inherits:[Core.Components.GridView],fields:{_bodyEle:null,_headerEle:null,_btnEle:null},props:{Data:null},ctors:{ctor:function(n){this.$initialize();Core.Components.GridView.ctor.call(this,n);this.GuiInfo=n||function(){throw new System.ArgumentNullException.$ctor1("ui");}()}},methods:{Render:function(){Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Div,"table-report").Style$1("overflow: auto;").Button,"btn-toolbar fas fa-bars box-shadow").Style$1("padding: 8px;").Event$1("click",Bridge.fn.cacheBind(this,this.ShowExportMenu)).End.Table,"table").Thead.End.TBody.Render();this._bodyEle=Bridge.as(Core.MVVM.Html.Context,HTMLTableSectionElement);this._headerEle=this._bodyEle.previousElementSibling;this.Element=this._bodyEle.parentElement.parentElement;this._btnEle=this.Element.firstElementChild;System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this,this.RenderAsync))},ShowExportMenu:function(n){var t=Core.Components.Forms.ContextMenu.Instance;t.Top=Core.Extensions.EventExt.Top(n);t.Left=Core.Extensions.EventExt.Left(n);t.MenuItems=Bridge.fn.bind(this,function(n){var t;return n.add((t=new Core.Components.Forms.ContextMenuItem,t.Text="Excel",t.Icon="fa fa-file-excel",t.Click=Bridge.fn.cacheBind(this,this.ExportExcel$1),t)),n.add((t=new Core.Components.Forms.ContextMenuItem,t.Text="Pdf",t.Icon="fa fa-file-pdf",t.Click=Bridge.fn.cacheBind(this,this.ExportPdf),t)),n})(new(System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem).ctor));t.Render();Core.Components.Extensions.ComponentExt.AlterPosition(t.Element,this._btnEle)},ExportExcel$1:function(){Core.Extensions.ExcelExt.ExportTableToExcel(null,this.GuiInfo.FieldName,this.Element.parentElement)},ExportPdf:function(){Core.Components.Forms.EditForm.PrintSection(this.Element.parentElement)},RenderAsync:function(){var n=0,u,l,f,i=new System.Threading.Tasks.TaskCompletionSource,e,o,a,v,s,y,t,b,r,h,p,w,c=Bridge.fn.bind(this,function(){var k,d;try{for(;;){n=System.Array.min([0,1,2,3,4],n);switch(n){case 0:if(Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FormatData)&&(this.Header=(e=Core.Models.GridPolicy,System.Linq.Enumerable.from(Newtonsoft.Json.JsonConvert.DeserializeObject(this.GuiInfo.FormatData,System.Array.type(Core.Models.GridPolicy)),e).toList(e))),o={},a=Core.Extensions.Utils.IsFunction(this.GuiInfo.Query,o),!a){i.setResult(null);return}if(v=Bridge.toString(o.v.call(this,Bridge.unbox(this.Entity))),this.Data==null){n=1;continue}n=3;continue;case 1:if(u=new Core.Clients.Client.$ctor1("User").PostAsync(System.Array.type(System.Array.type(System.Object)),v,"ReportDataSet"),n=2,u.isCompleted())continue;u["continue"](c);return;case 2:l=u.getAwaitedResult();this.Data=l;n=3;continue;case 3:if(Core.Extensions.IEnumerableExtensions.Nothing(System.Array.type(System.Object),this.Data)){this.NoRecordFound();i.setResult(null);return}this.DisposeNoRecord();s=(y=System.Linq.Enumerable.from(this.Data,System.Array.type(System.Object)).firstOrDefault(null,null))!=null?System.Linq.Enumerable.from(y,System.Object).firstOrDefault(null,null):null;t=this.Header.ToArray();this.HeaderComponentMap=System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Models.GridPolicy,System.Int32,this.Header,function(n){return Bridge.getHashCode(n)}),Core.Models.GridPolicy).toDictionary(function(n){return Bridge.getHashCode(n)},function(n){return Core.Extensions.Utils.MapToComponent(n)},System.Int32,Core.Models.Component);Core.MVVM.Html.Take(this._headerEle).Render();b=Core.MVVM.Html.Instance;for(k in s)t!=null&&t.map(function(n){return n.FieldName}).indexOf(k)>=0?(d=t.filter(function(n){return n.FieldName==k})[0],this.RenderHeader(d&&d.ShortDesc)):this.RenderHeader(k);if(f=this.LoadMasterData(this.Data),n=4,f.isCompleted())continue;f["continue"](c);return;case 4:f.getAwaitedResult();r=Bridge.getEnumerator(this.Data);try{while(r.moveNext()){h=r.Current;Core.MVVM.Html.Take(this._bodyEle).TRow.Render();for(k in s)t!=null&&t.map(function(n){return n.FieldName}).indexOf(k)>=0?(d=t.filter(function(n){return n.FieldName==k}),this.RenderCell(h[k],d[0]&&d[0].FormatCell)):this.RenderCell(h[k])}}finally{Bridge.is(r,System.IDisposable)&&r.System$IDisposable$Dispose()}Bridge.staticEquals(p=this.DOMContentLoaded,null)?null:p();i.setResult(null);return;default:i.setResult(null);return}}}catch(g){w=System.Exception.create(g);i.setException(w)}},arguments);return c(),i.task},RenderHeader:function(n){var t;this.Header.add((t=new Core.Models.GridPolicy,t.ShortDesc=n,t));Core.Components.Renderer.IText(Core.MVVM.Html.Instance.Th,n).End.Render()},RenderCell:function(n,t){var i=Core.Extensions.StringExt.IsNullOrEmpty(t)?n:System.String.format(t,[n]);Core.Components.Renderer.IText(Core.MVVM.Html.Instance.TData,i).End.Render()}}});Bridge.define("Core.Components.VirtualGrid",{inherits:[Core.Components.GridView],statics:{fields:{RowNo:null,VirtualRow:null,cacheAhead:0},ctors:{init:function(){this.RowNo="_index";this.VirtualRow="virtualRow";this.cacheAhead=5}}},fields:{_renderViewPortAwaiter:0,_renderingViewPort:!1,LastData:null,_f6:!1,viewPortCount:0,_skip:0},ctors:{ctor:function(n){this.$initialize();Core.Components.GridView.ctor.call(this,n)}},methods:{AddSections:function(){Core.Components.GridView.prototype.AddSections.call(this);this.DataTable.parentElement.addEventListener(System.Enum.toString(System.String,"scroll"),Bridge.fn.cacheBind(this,this.RenderViewPortWrapper));this.DataTable.parentElement.addEventListener(System.Enum.toString(System.String,"resize"),Bridge.fn.bind(this,function(n){this._lastScrollTop=-1;this.RenderViewPortWrapper(n)}))},ApplyFilter:function(n){var t=0,i,o,r=new System.Threading.Tasks.TaskCompletionSource,u,f,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(n===void 0&&(n=!0),this._sum=!1,this.CacheData.clear(),u=this.CalcFilterQuery(n),this.DataTable.parentElement.scrollTop=0,i=this.ReloadData(u,!1,void 0,void 0,!1),t=1,i.isCompleted())continue;i["continue"](e);return;case 1:o=i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(s){f=System.Exception.create(s);r.setException(f)}},arguments);return e(),r.task},PrepareCache:function(n){var i=0,u,c,f,t=new System.Threading.Tasks.TaskCompletionSource,s,l,r,e,o,a,v,h=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2],i);switch(i){case 0:if(n===void 0&&(n=0),Core.Extensions.IEnumerableExtensions.HasElement(System.Object,this.CacheData)&&(s=System.Nullable.getValue(Bridge.cast(Bridge.unbox(System.Linq.Enumerable.from(this.CacheData,System.Object).first()[Core.Components.VirtualGrid.RowNo],System.Int32),System.Int32)),l=s+Bridge.Int.mul(this.viewPortCount,Core.Components.VirtualGrid.cacheAhead)|0,n>s&&n<l)){this._waitingLoad=!1;t.setResult(null);return}if(r=n-Bridge.Int.mul(this.viewPortCount,Core.Components.VirtualGrid.cacheAhead)|0,r<0&&(r=0),e=this.CalcDatasourse(this.viewPortCount+Bridge.Int.mul(Bridge.Int.mul(this.viewPortCount,Core.Components.VirtualGrid.cacheAhead),2)|0,r,"false"),Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.DescValue)||(e=Core.Extensions.OdataExt.AppendClause(e,this.GuiInfo.DescValue,"$select=")),u=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName,(a=this.GuiInfo.Reference)!=null?a.Namespace:null).GetList(System.Object,e),i=1,u.isCompleted())continue;u["continue"](h);return;case 1:if(c=u.getAwaitedResult(),o=c,Core.Extensions.IEnumerableExtensions.Nothing(System.Object,o.Value)){this._waitingLoad=!1;t.setResult(null);return}if(this.CacheData.clear(),this.CacheData.AddRange(o.Value),Core.Extensions.IEnumerableExtensions.ForEach$1(System.Object,this.CacheData,function(n,t){n[Core.Components.VirtualGrid.RowNo]=Bridge.box((r+t|0)+1|0,System.Int32)}),f=this.LoadMasterData(o.Value,!1),i=2,f.isCompleted())continue;f["continue"](h);return;case 2:f.getAwaitedResult();this._waitingLoad=!1;t.setResult(null);return;default:t.setResult(null);return}}}catch(y){v=System.Exception.create(y);t.setException(v)}},arguments);return h(),t.task},RenderViewPort:function(n,t){var i=0,e,a,o,v,u=new System.Threading.Tasks.TaskCompletionSource,s,f,h,r,c,y,p,w,l=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3,4,5,7],i);switch(i){case 0:if(n===void 0&&(n=!0),t===void 0&&(t=!1),this._renderingViewPort=!0,this.viewPortCount=this.GetViewPortItem(),s=this.DataTable.parentElement.scrollTop,s===this._lastScrollTop){u.setResult(null);return}if(f=this.GetRowCountByHeight(s),this.viewPortCount<=0&&(this.viewPortCount=(h=this.GuiInfo.Row,h!=null?h:20)),t){i=1;continue}else{i=3;continue}case 1:if(e=this.FirstLoadData(n,f),i=2,e.isCompleted())continue;e["continue"](l);return;case 2:a=e.getAwaitedResult();r=a;i=7;continue;case 3:if(r=(c=System.Object,System.Linq.Enumerable.from(this.ReadCache(f,this.viewPortCount),c).toList(c)),r.Count<this.viewPortCount&&r.Count<this.Paginator.Options.Total){i=4;continue}i=6;continue;case 4:if(o=this.FirstLoadData(n,f),i=5,o.isCompleted())continue;o["continue"](l);return;case 5:v=o.getAwaitedResult();r=v;i=6;continue;case 7:this.FormattedRowData=r;s===0&&(this.LastData=this.FormattedRowData);this.RenderVirtualRow(Bridge.as(this.MainSection.Element,HTMLTableSectionElement),f,this.viewPortCount);this.UpdateExistRows(!1);y=System.Linq.Enumerable.from(this.MainSection.Element.children,HTMLElement).firstOrDefault(function(n){return Bridge.referenceEquals(n.getAttribute(Core.Components.VirtualGrid.VirtualRow),System.Enum.toString(Core.Components.Direction,Core.Components.Direction.bottom))},null);this.MainSection.Element.appendChild(y);this.RowData.Data.clear();r.ForEach(Bridge.fn.cacheBind(this.RowData.Data,this.RowData.Data.add));(p=this.Entity)!=null?Core.Extensions.BridgeExt.SetComplexPropValue(p,this.GuiInfo.FieldName,r):null;this.RowAction(function(n){n.Focused=!1});Core.Components.EditableComponent.IsSmallUp&&this.SetFocusingCom();this._renderingViewPort=!1;this.RenderIndex();this.DomLoaded();u.setResult(null);return;default:u.setResult(null);return}}}catch(b){w=System.Exception.create(b);u.setException(w)}},arguments);return l(),u.task},ReadCache:function(){return new(Bridge.GeneratorEnumerable$1(System.Object))(Bridge.fn.bind(this,function(n,t){var i=0,r,u,f=new(Bridge.GeneratorEnumerator$1(System.Object))(Bridge.fn.bind(this,function(){try{for(;;)switch(i){case 0:r=-1;i=1;continue;case 1:r=Core.Extensions.IEnumerableExtensions.IndexOf(System.Object,this.CacheData,function(t){return System.Nullable.getValue(Bridge.cast(Bridge.unbox(t[Core.Components.VirtualGrid.RowNo],System.Int32),System.Int32))===(n+1|0)});i=3;continue;case 2:return this.CacheData.clear(),!1;case 3:if(r<0){i=4;continue}i=5;continue;case 4:return this.CacheData.clear(),!1;case 5:if(t>0&&this.CacheData.Count>r){i=6;continue}i=8;continue;case 6:return f.current=this.CacheData.getItem(r),i=7,!0;case 7:r=r+1|0;t=t-1|0;i=5;continue;case 8:default:return!1}}catch(e){if(u=System.Exception.create(e),i>=1&&i<=1){i=2;f.moveNext();return}throw u;}}));return f},arguments))},FirstLoadData:function(n,t){var r=0,u,l,f,e=new System.Threading.Tasks.TaskCompletionSource,i,o,s,a,h,v,c=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1,2],r);switch(r){case 0:if(this._skip=t,o=this.CalcDatasourse(this.viewPortCount,t,n?"true":"false"),Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.DescValue)||(o=Core.Extensions.OdataExt.AppendClause(o,this.GuiInfo.DescValue,"$select=")),u=new Core.Clients.Client.$ctor1(this.GuiInfo.RefName,(a=this.GuiInfo.Reference)!=null?a.Namespace:null).GetList(System.Object,o),r=1,u.isCompleted())continue;u["continue"](c);return;case 1:if(l=u.getAwaitedResult(),s=l,this.Sql=s.Sql,i=s.Value,this.Paginator!=null&&n&&(this.Paginator.Options.Total=(h=s.Odata.Count,h!=null?h:i.Count)),this.FormattedRowData=i,f=this.LoadMasterData(this.FormattedRowData,!1),r=2,f.isCompleted())continue;f["continue"](c);return;case 2:f.getAwaitedResult();Core.Extensions.IEnumerableExtensions.ForEach$1(System.Object,i,function(n,i){n[Core.Components.VirtualGrid.RowNo]=Bridge.box((t+i|0)+1|0,System.Int32)});i.Count<this.Paginator.Options.Total&&(window.clearTimeout(this._renderPrepareCacheAwaiter),this._waitingLoad=!0,this._renderPrepareCacheAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){var n=0,i,r=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(i=this.PrepareCache(t),n=1,i.isCompleted())continue;i["continue"](r);return;case 1:i.getAwaitedResult();return;default:return}}},arguments);r()}),7e3));e.setResult(i);return;default:e.setResult(null);return}}}catch(y){v=System.Exception.create(y);e.setException(v)}},arguments);return c(),e.task},ReloadData:function(n,t,i,r,u){var f=0,e,o=new System.Threading.Tasks.TaskCompletionSource,s,h=Bridge.fn.bind(this,function(){try{for(;;){f=System.Array.min([0,1],f);switch(f){case 0:if(n===void 0&&(n=null),t===void 0&&(t=!1),i===void 0&&(i=null),r===void 0&&(r=null),u===void 0&&(u=!1),this.DisposeNoRecord(),this.VirtualScroll=Core.Extensions.IEnumerableExtensions.Nothing(System.Char,this.GuiInfo.GroupBy)&&this.GuiInfo.VirtualScroll&&!Bridge.referenceEquals(Bridge.toString(this.Element.style.display),System.Enum.toString(System.String,"none")),this._lastScrollTop=-1,e=this.RenderViewPort(!0,!0),f=1,e.isCompleted())continue;e["continue"](h);return;case 1:e.getAwaitedResult();o.setResult(this.FormattedRowData);return;default:o.setResult(null);return}}}catch(c){s=System.Exception.create(c);o.setException(s)}},arguments);return h(),o.task},RenderViewPortWrapper:function(n){if(this._waitingLoad&&(window.clearTimeout(this._renderPrepareCacheAwaiter),this._renderPrepareCacheAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.PrepareCache(this._skip),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()}),7e3)),this._renderingViewPort||!this.VirtualScroll){this._renderingViewPort=!1;n.preventDefault();return}window.clearTimeout(this._renderViewPortAwaiter);this._renderViewPortAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.RenderViewPort(!1),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()}),100)},RenderVirtualRow:function(n,t,i){var h=System.Linq.Enumerable.from(n.children,HTMLElement).firstOrDefault(function(n){return Bridge.referenceEquals(n.getAttribute(Core.Components.VirtualGrid.VirtualRow),System.Enum.toString(Core.Components.Direction,Core.Components.Direction.top))},null),u=h||document.createElement(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.tr)),e,s,r,o,f;if(!Core.Extensions.HtmlElementExtension.HasClass(u,"virtual-row"))for(Core.Extensions.HtmlElementExtension.AddClass(u,"virtual-row"),e=0;e<this.Header.Count;e=e+1|0)u.appendChild(document.createElement(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)));if(u.style.height=Bridge.Int.mul(t,this._rowHeight)+(Core.Extensions.Utils.Pixel||""),u.setAttribute(Core.Components.VirtualGrid.VirtualRow,System.Enum.toString(Core.Components.Direction,Core.Components.Direction.top)),n.insertBefore(u,n.firstChild),s=System.Linq.Enumerable.from(n.children,HTMLElement).lastOrDefault(function(n){return Bridge.referenceEquals(n.getAttribute(Core.Components.VirtualGrid.VirtualRow),System.Enum.toString(Core.Components.Direction,Core.Components.Direction.bottom))},null),r=s||document.createElement(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.tr)),!Core.Extensions.HtmlElementExtension.HasClass(r,"virtual-row"))for(Core.Extensions.HtmlElementExtension.AddClass(r,"virtual-row"),o=0;o<this.Header.Count;o=o+1|0)r.appendChild(document.createElement(System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)));f=Bridge.Int.mul((this.Paginator.Options.Total-i|0)-t|0,this._rowHeight);f=f>=this._rowHeight?f:0;r.style.height=f+(Core.Extensions.Utils.Pixel||"");r.setAttribute(Core.Components.VirtualGrid.VirtualRow,System.Enum.toString(Core.Components.Direction,Core.Components.Direction.bottom));n.appendChild(r);this.MainSection.Element.parentElement.parentElement.scrollTop=Bridge.Int.mul(t,this._rowHeight);this._lastScrollTop=Bridge.Int.mul(t,this._rowHeight);this.Paginator.Options.PageSize=this.Paginator.Options.Total;this.Paginator.Options.StartIndex=t+1|0;this.Paginator.Options.EndIndex=t+i|0;Core.Extensions.HtmlElementExtension.AddClass(this.Paginator.Element,"infinite-scroll");this.Paginator.Children.ForEach(function(n){n.UpdateView()})},DisposeSumary:function(){this._renderPrepareCacheAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.PrepareCache(this._skip),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()}),7e3);Core.Components.GridView.prototype.DisposeSumary.call(this)},FocusCell$1:function(n){var t=Bridge.as(n.target,HTMLElement),i=$(n.target).closest("table");i.find("tbody tr").removeClass("focus");i.find("tbody td").removeClass("cell-selected");Core.Extensions.HtmlElementExtension.AddClass(Core.Extensions.HtmlElementExtension.Closest(t,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.tr)),"focus");Core.Extensions.HtmlElementExtension.AddClass(Core.Extensions.HtmlElementExtension.Closest(t,System.Enum.toString(Core.MVVM.ElementType,Core.MVVM.ElementType.td)),"cell-selected")},FilterInSelected:function(t){var u,i,e,o,s;if(this._waitingLoad&&window.clearTimeout(this._renderPrepareCacheAwaiter),t.Operator!=null){var r=System.Linq.Enumerable.from(this.Header,Core.Models.GridPolicy).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,Bridge.toString(t.FieldName))},null),f="",h=window.localStorage.getItem("LastSearch"+this.GuiInfo.Id+r.Id);h!=null&&(f=Bridge.toString(h));i=(u=new Core.Components.Forms.ConfirmDialog,u.Content=System.String.concat(System.String.format("Nhập {0} cần tìm",[r.ShortDesc]),t.Text),u.NeedAnswer=!0,u.MultipleLine=!1,u.ComType=Bridge.referenceEquals(r.ComponentType,"Datepicker")||Bridge.referenceEquals(r.ComponentType,"Number")?r.ComponentType:"Textbox",u.Precision=r.Precision,u.PElement=this.MainSection.Element,u);i.YesConfirmed=Bridge.fn.combine(i.YesConfirmed,Bridge.fn.bind(this,function(){var e=0,o,u,f,n,s=Bridge.fn.bind(this,function(){for(;;){e=System.Array.min([0,1],e);switch(e){case 0:if(u=null,f=null,Bridge.referenceEquals(r.ComponentType,"Datepicker")?(f=i.Datepicker.OriginalText,u=System.Nullable.toString(i.Datepicker.Value,function(n){return System.DateTime.format(n)})):Bridge.referenceEquals(r.ComponentType,"Number")?(f=i.Number.GetValueText(),u=i.Number.Value.toString()):(f=Core.Extensions.Utils.EncodeSpecialChar(i.Textbox.Text.trim()),u=Core.Extensions.Utils.EncodeSpecialChar(i.Textbox.Text.trim())),window.localStorage.setItem("LastSearch"+this.GuiInfo.Id+r.Id,u),System.Linq.Enumerable.from(this.CellSelected,Core.Models.CellSelected).any(function(n){return Bridge.referenceEquals(n.FieldName,Bridge.toString(t.FieldName))&&Bridge.referenceEquals(n.Operator,"in")})&&!System.Nullable.getValue(Bridge.cast(Bridge.unbox(t.Shift,System.Boolean),System.Boolean))?(System.Linq.Enumerable.from(this.CellSelected,Core.Models.CellSelected).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,Bridge.toString(t.FieldName))&&Bridge.referenceEquals(n.Operator,"in")},null).Value=u,System.Linq.Enumerable.from(this.CellSelected,Core.Models.CellSelected).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,Bridge.toString(t.FieldName))&&Bridge.referenceEquals(n.Operator,"in")},null).ValueText=f):this.CellSelected.add((n=new Core.Models.CellSelected,n.FieldName=Bridge.toString(t.FieldName),n.FieldText=r.ShortDesc,n.ComponentType=r.ComponentType,n.Value=u,n.Shift=System.Nullable.getValue(Bridge.cast(Bridge.unbox(t.Shift,System.Boolean),System.Boolean)),n.ValueText=f,n.Operator=Bridge.toString(t.Operator),n.OperatorText=Bridge.toString(t.OperatorText),n)),this._summarys.add(document.createElement("div")),o=this.ActionFilter(),e=1,o.isCompleted())continue;o["continue"](s);return;case 1:o.getAwaitedResult();i.Textbox.Text=null;return;default:return}}},arguments);s()}));i.Canceled=Bridge.fn.combine(i.Canceled,Bridge.fn.bind(this,function(){this._renderPrepareCacheAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.PrepareCache(this._skip),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();return;default:return}}},arguments);i()}),7e3)}));i.Entity=new n.$AnonymousType$6("");i.Render();Core.Extensions.StringExt.IsNullOrWhiteSpace(f)||(Bridge.referenceEquals(r.ComponentType,"Datepicker")?(i.Datepicker.Value=System.DateTime.parse(f),e=Bridge.as(i.Datepicker.Element,HTMLInputElement),e.selectionStart=0,e.selectionEnd=f.length):Bridge.referenceEquals(r.ComponentType,"Number")?(i.Number.Value=System.Convert.toDecimal(f),o=Bridge.as(i.Number.Element,HTMLInputElement),o.selectionStart=0,o.selectionEnd=f.length):(i.Textbox.Text=f,s=Bridge.as(i.Textbox.Element,HTMLInputElement),s.selectionStart=0,s.selectionEnd=f.length))}}}});Bridge.define("Core.Fw.Authentication.PolicyManagementBL",{inherits:[Core.Components.Forms.TabEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.TabEditor.ctor.call(this,"Role");this.Name="Policy";this.Title=this.Name}},methods:{CopyRole:function(n,t){t.ForEach(function(n){n.InverseParentRole=null})},EditRole:function(n){var t=0,i,e,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=Core.Components.Extensions.ComponentExt.OpenPopup(this,"Role Detail",function(){var i=Bridge.Reflection.getType("Core.Fw.Setting.RoleDetailBL"),t=Bridge.as(Bridge.createInstance(i),Core.Components.Forms.PopupEditor);return t.Entity=n||new Core.Models.Role,t},!1,!1),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:e=i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(o){u=System.Exception.create(o);r.setException(u)}},arguments);return f(),r.task}}});Bridge.define("Core.Fw.Setting.MasterDataBL",{inherits:[Core.Components.Forms.TabEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.TabEditor.ctor.call(this,"MasterData");this.Name="Master Data";this.Title=this.Name}},methods:{EditMasterData:function(n){var t=0,i,e,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=Core.Components.Extensions.ComponentExt.OpenPopup(this,"MasterData Detail",function(){var i=Bridge.Reflection.getType("Core.Fw.Setting.MasterDataDetailsBL"),t=Bridge.as(Bridge.createInstance(i),Core.Components.Forms.PopupEditor);return t.Title=n==null?"Thêm tham chiếu mới":"Cập nhật tham chiếu",t.Entity=n||new Core.Models.MasterData,t},!1,!1),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:e=i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(o){u=System.Exception.create(o);r.setException(u)}},arguments);return f(),r.task}}});Bridge.define("Core.Fw.User.UserBL",{inherits:[Core.Components.Forms.TabEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.TabEditor.ctor.call(this,"User");this.Name="User List";this.Title=this.Name}},methods:{EditUser:function(n){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.InitUserForm(n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task},CreateUser:function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.InitUserForm(new Core.Models.User),n=1,t.isCompleted())continue;t["continue"](u);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(f){r=System.Exception.create(f);i.setException(r)}},arguments);return u(),i.task},InitUserForm:function(n){var t=0,i,e,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=Core.Components.Extensions.ComponentExt.OpenTab$1(this,"User"+n.Id,"User Detail",function(){var i=Bridge.Reflection.getType("Core.Fw.User.UserDetailBL"),t=Bridge.as(Bridge.createInstance(i),Core.Components.Forms.TabEditor);return t.Entity=n,t},!1,!1),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:e=i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(o){u=System.Exception.create(o);r.setException(u)}},arguments);return f(),r.task}}});Bridge.define("Core.Fw.User.UserDetailBL",{inherits:[Core.Components.Forms.TabEditor],props:{UserEntity:{get:function(){return Bridge.as(this.Entity,Core.Models.User)}}},ctors:{ctor:function(){this.$initialize();Core.Components.Forms.TabEditor.ctor.call(this,"User");this.Entity=new Core.Models.User;this.Name="User Detail";this.Title="User Detail"}},methods:{ReSend:function(){var n=0,t,f,i=new System.Threading.Tasks.TaskCompletionSource,e,o,u,r,s,h=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(e=new Core.Clients.Client.$ctor1("User"),t=e.GetAsync$1(System.String,System.String.format("/ReSendUser/{0}",[Bridge.box(this.UserEntity.Id,System.Int32)])),n=1,t.isCompleted())continue;t["continue"](h);return;case 1:f=t.getAwaitedResult();o=f;u=(r=new Core.Components.Forms.ConfirmDialog,r.Title=System.String.format("Đổi mật khẩu cho user {0}",[this.UserEntity.UserName]),r.Content=System.String.format("Đổi mật khẩu cho user thành công.<br />Mật khẩu mới là {0}",[o]),r);u.IgnoreNoButton=!0;u.Render();i.setResult(null);return;default:i.setResult(null);return}}}catch(c){s=System.Exception.create(c);i.setException(s)}},arguments);return h(),i.task}}});Bridge.define("Core.Fw.User.UserProfileBL",{inherits:[Core.Components.Forms.TabEditor],ctors:{ctor:function(){var n,t;this.$initialize();Core.Components.Forms.TabEditor.ctor.call(this,"User");t=(n=new Core.ViewModels.UserProfileVM,n.Id=Core.Clients.Client.Token.UserId,n);this.ShouldLoadEntity=!0;this.Entity=t;this.Name="UserProfile";this.Title="User profile";this.Icon="/icons/profile.png";this.Client=new Core.Clients.Client.$ctor1("User");this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.bind(this,function(){this.CheckShowNative()}))}},methods:{OpenChangePassword:function(){var n=0,t,e,i=new System.Threading.Tasks.TaskCompletionSource,r,u,f=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=Bridge.as(this.Entity,Core.ViewModels.UserProfileVM),t=Core.Components.Extensions.ComponentExt.OpenPopup(this,"ChangePassword",function(){var t=Bridge.Reflection.getType("Core.Fw.User.ChangePasswordBL"),n=Bridge.as(Bridge.createInstance(t),Core.Components.Forms.PopupEditor);return n.Entity=r,n},!1,!1),n=1,t.isCompleted())continue;t["continue"](f);return;case 1:e=t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(o){u=System.Exception.create(o);i.setException(u)}},arguments);return f(),i.task},ShowButtonNative:function(){Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Button,this,"btnNative").Show=!1;Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section,this,"Image").UpdateView()},ShowNative:function(){Notification.requestPermission()},Save:function(){var n=0,r,s,u,h,f,t=new System.Threading.Tasks.TaskCompletionSource,c,i,o,l,e=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5,6],n);switch(n){case 0:if(!this.Dirty){Core.Extensions.Toast.Warning(Core.Components.Forms.EditForm.NotDirtyMessage);t.setResult(!1);return}if(r=this.IsFormValid(),n=1,r.isCompleted())continue;r["continue"](e);return;case 1:if(s=r.getAwaitedResult(),c=s,!c){t.setResult(!1);return}if(i=Bridge.as(this.Entity,Core.ViewModels.UserProfileVM),Core.Extensions.ReflectionExt.ClearReferences(i),i.OldPassword=null,i.NewPassword=null,i.ConfirmedPassword=null,u=this.Client.UpdateAsync(System.Boolean,i,"UpdateProfile"),n=2,u.isCompleted())continue;u["continue"](e);return;case 2:if(h=u.getAwaitedResult(),o=h,o){n=3;continue}else{n=5;continue}case 3:if(Core.Extensions.Toast.Success("Update profile succeeded!"),f=Core.Notifications.NotificationBL.Instance.RenderAsync(),n=4,f.isCompleted())continue;f["continue"](e);return;case 4:f.getAwaitedResult();n=6;continue;case 5:Core.Extensions.Toast.Warning("Update profile failed!");n=6;continue;case 6:this.Dirty=!1;t.setResult(o);return;default:t.setResult(null);return}}}catch(a){l=System.Exception.create(a);t.setException(l)}},arguments);return e(),t.task},CheckShowNative:function(){Notification.permission==="granted"?this.ShowButtonNative():Notification.permission==="denied"&&Core.Extensions.Toast.Warning("Vui lòng gỡ block thông báo cho trang này!")}}});Bridge.define("Core.Fw.User.VendorBL",{inherits:[Core.Components.Forms.TabEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.TabEditor.ctor.call(this,"Vendor");this.Entity=new Core.Fw.User.VendorListVM;this.Name="Vendor List";this.Title=this.Name}},methods:{EditVendor:function(n){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.InitVendorForm(n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task},CreateVendor:function(){var n=0,t,i=new System.Threading.Tasks.TaskCompletionSource,r,u,f=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.InitVendorForm((r=new Core.Models.Vendor,r.VendorTypeId=Core.Enums.VendorTypeEnum.Vendor,r)),n=1,t.isCompleted())continue;t["continue"](f);return;case 1:t.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(e){u=System.Exception.create(e);i.setException(u)}},arguments);return f(),i.task},InitVendorForm:function(n){var t=0,i,e,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=Core.Components.Extensions.ComponentExt.OpenTab$1(this,"Vendor"+n.Id,"VendorDetail",function(){var i=Bridge.Reflection.getType("Core.Fw.User.VendorDetailBL"),t=Bridge.as(Bridge.createInstance(i),Core.Components.Forms.TabEditor);return t.Entity=n,t},!1,!1),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:e=i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(o){u=System.Exception.create(o);r.setException(u)}},arguments);return f(),r.task}}});Bridge.define("Core.Notifications.TaskNotificationListBL",{inherits:[Core.Components.Forms.TabEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.TabEditor.ctor.call(this,"TaskNotification");this.Name="TaskNotification List";this.Entity=new Core.Models.TaskNotification}},methods:{EditNotification:function(n){var t=0,i,r=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=Core.Notifications.NotificationBL.Instance.OpenNotification(n),t=1,i.isCompleted())continue;i["continue"](f);return;case 1:i.getAwaitedResult();r.setResult(null);return;default:r.setResult(null);return}}}catch(e){u=System.Exception.create(e);r.setException(u)}},arguments);return f(),r.task}}});Bridge.define("Core.Components.AdvancedSearch",{inherits:[Core.Components.Forms.PopupEditor],statics:{methods:{GetLogicOp:function(n){return n.LogicOperatorId==null?null:System.Nullable.eq(n.LogicOperatorId,Core.Enums.LogicOperation.And)?" and ":" or "},SetSearchString:function(n,t){var i;return t.ComponentType="Textbox",i=new Core.Components.Textbox(t),n.GuiInfo.LocalData=System.Linq.Enumerable.from(Core.Components.AdvancedSearch.OperatorFactory(Core.Enums.ComponentTypeTypeEnum.Textbox)).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object),i},OperatorFactory:function(n){var t=System.Linq.Enumerable.from(Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.AdvSearchOperation)).select(function(n){return Bridge.cast(n,Core.Models.Entity)});switch(n){case Core.Enums.ComponentTypeTypeEnum.Textbox:return t.where(function(n){return n.Id>=Core.Enums.AdvSearchOperation.Contains&&n.Id<Core.Enums.AdvSearchOperation.In||n.Id===Core.Enums.AdvSearchOperation.Equal||n.Id===Core.Enums.AdvSearchOperation.NotEqual}).orderByDescending(function(n){return n.Id===Core.Enums.AdvSearchOperation.Contains});case Core.Enums.ComponentTypeTypeEnum.Datepicker:return t.where(function(n){return n.Id<Core.Enums.AdvSearchOperation.Contains});case Core.Enums.ComponentTypeTypeEnum.Number:return t.where(function(n){return n.Id<Core.Enums.AdvSearchOperation.Contains});case Core.Enums.ComponentTypeTypeEnum.Checkbox:return t.where(function(n){return n.Id===Core.Enums.AdvSearchOperation.Equal});case Core.Enums.ComponentTypeTypeEnum.SearchEntry:return t.where(function(n){return n.Id===Core.Enums.AdvSearchOperation.In||n.Id===Core.Enums.AdvSearchOperation.NotIn})}return null},SetSearchDecimal:function(n,t){var i;return t.ComponentType="Number",i=new Core.Components.Number(t),n.GuiInfo.LocalData=System.Linq.Enumerable.from(Core.Components.AdvancedSearch.OperatorFactory(Core.Enums.ComponentTypeTypeEnum.Number)).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object),i},SetSearchBool:function(n,t){var i;return t.FormatData="{Description}",t.ComponentType="SearchEntry",t.LocalRender=!0,t.LocalData=Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.ActiveStateEnum),t.LocalHeader=function(n){var t;return n.add((t=new Core.Models.GridPolicy,t.FieldName="Name",t.ShortDesc="Trạng thái",t.Active=!0,t)),n.add((t=new Core.Models.GridPolicy,t.FieldName="Description",t.ShortDesc="Miêu tả",t.Active=!0,t)),n}(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor)),i=new Core.Components.SearchEntry(t),n.GuiInfo.LocalData=System.Linq.Enumerable.from(Core.Components.AdvancedSearch.OperatorFactory(Core.Enums.ComponentTypeTypeEnum.Checkbox)).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object),i},SetSearchDateTime:function(n,t){var i;return t.ComponentType="Datepicker",t.Precision=7,i=new Core.Components.Datepicker(t),n.GuiInfo.LocalData=System.Linq.Enumerable.from(Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.AdvSearchOperation)).select(function(n){return Bridge.cast(n,Core.Models.Entity)}).where(function(n){return n.Id<Core.Enums.AdvSearchOperation.Contains}).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object),i}}},fields:{_filterGrid:null,_orderByGrid:null,_activeState:null,_entityType:null,_headers:null,ParentListView:null,_orderById:0,_fieldConditionId:0,_gridPolicyId:0,_entityId:0},props:{ModelNameSpace:null,AdvSearchEntity:{get:function(){return Bridge.as(this.Entity,Core.Models.AdvSearchVM)}}},ctors:{init:function(){this._orderById=System.Linq.Enumerable.from(Core.Clients.Client.Entities.Values,Core.Models.Entity).firstOrDefault(function(n){return Bridge.referenceEquals(n.Name,"OrderBy")},null).Id;this._fieldConditionId=System.Linq.Enumerable.from(Core.Clients.Client.Entities.Values,Core.Models.Entity).firstOrDefault(function(n){return Bridge.referenceEquals(n.Name,"FieldCondition")},null).Id;this._gridPolicyId=System.Linq.Enumerable.from(Core.Clients.Client.Entities.Values,Core.Models.Entity).firstOrDefault(function(n){return Bridge.referenceEquals(n.Name,"GridPolicy")},null).Id;this._entityId=System.Linq.Enumerable.from(Core.Clients.Client.Entities.Values,Core.Models.Entity).firstOrDefault(function(n){return Bridge.referenceEquals(n.Name,"Entity")},null).Id},ctor:function(n){var t,i;this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"GridPolicy");this.Name="AdvancedSearch";this.Title="Tìm kiếm nâng cao";this.Icon="fa fa-search-plus";this.ParentListView=n;this._entityType=Bridge.Reflection.getType(((t=(i=this.ParentListView.GuiInfo.Reference)!=null?i.Namespace:null,t!=null?t:Core.Clients.Client.ModelNamespace)||"")+(this.ParentListView.GuiInfo.RefName||""));this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.cacheBind(this,this.LocalRender))}},methods:{LocalRender:function(){var n,r,i,t;this._headers=System.Linq.Enumerable.from(this.ParentListView.Header,Core.Models.GridPolicy).where(function(n){return n.Id>0&&!Core.Extensions.StringExt.IsNullOrWhiteSpace(n.ShortDesc)&&n.Active&&!n.Hidden}).toList(Core.Models.GridPolicy);System.Array.add(this.Feature.FeaturePolicy,(n=new Core.Models.FeaturePolicy,n.CanRead=!0,n.CanWrite=!0,n.CanDelete=!0,n),Core.Models.FeaturePolicy);this.Entity=this.ParentListView.AdvSearchVM;r=this.HeaderForAdvSearch();i=Core.Extensions.OdataExt.GetClausePart(this.ParentListView.FormattedDataSource,Core.Extensions.OdataExt.OrderByKeyword);this.ParentListView.AdvSearchVM.OrderBy=System.Linq.Enumerable.from(i.split(","),System.String).select(Bridge.fn.bind(this,function(n){var i,t=n.trim().replace(new RegExp("\\s+")," ").split(" "),r,u,f,e;return t.length<1?null:(r=System.Linq.Enumerable.from(this._headers,Core.Models.GridPolicy).firstOrDefault(function(n){return Bridge.referenceEquals(n.FieldName,t[System.Array.index(0,t)])},null),r==null)?null:(u=(i=new Core.Models.OrderBy,i.FieldId=r.Id,i.Field=r,i),t.length===1?u.OrderbyOptionId=Core.Enums.OrderbyOption.ASC:(f={v:new Core.Enums.OrderbyOption},e=System.Enum.tryParse(Core.Enums.OrderbyOption,Bridge.toString(t[System.Array.index(1,t)]).toUpperCase(),f),u.OrderbyOptionId=e?f.v:Core.Enums.OrderbyOption.ASC),u)})).where(function(n){return n!=null}).toList(Core.Models.OrderBy);t=this.AddSection();this.AddFilters(t);this.AddOrderByGrid(t)},AddSection:function(){var i,n,t=(i=new Core.Components.Section.$ctor1(Core.MVVM.ElementType.div),i.ComponentGroup=(n=new Core.Models.ComponentGroup,n.Column=4,n.Label="Bộ lọc",n.Active=!0,n.ClassName="scroll-content",n),i),r;return this.AddChild(t),r=document.createElement("label"),t.Element.appendChild(r),r.textContent="Trạng thái",t.ClassName="filter-warpper panel group wrapper",t},AddFilters:function(n){var t,i;this._activeState=new Core.Components.SearchEntry((t=new Core.Models.Component,t.FieldName="ActiveState",t.Column=4,t.Label="Trạng thái",t.FormatData="{Description}",t.ShowLabel=!0,t.LocalRender=!0,t.ReferenceId=this._entityId,t.RefName="Entity",t.Reference=(i=new Core.Models.Entity,i.Name="Entity",i),t.Validation='[{"Rule": "required", "Message": "{0} is required"}]',t));this._activeState.GuiInfo.LocalData=Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.ActiveStateEnum);this._activeState.GuiInfo.LocalHeader=function(n){var t;return n.add((t=new Core.Models.GridPolicy,t.FieldName="Name",t.ShortDesc="Trạng thái",t.Active=!0,t)),n.add((t=new Core.Models.GridPolicy,t.FieldName="Description",t.ShortDesc="Miêu tả",t.Active=!0,t)),n}(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor));this._activeState.ParentElement=n.Element;n.AddChild(this._activeState);this._filterGrid=new Core.Components.GridView((t=new Core.Models.Component,t.FieldName="Conditions",t.Column=4,t.ReferenceId=this._fieldConditionId,t.RefName="FieldCondition",t.Reference=(i=new Core.Models.Entity,i.Name="FieldCondition",i.Namespace=(Bridge.Reflection.getTypeNamespace(Core.Models.Component)||"")+".",i),t.LocalRender=!0,t.IgnoreConfirmHardDelete=!0,t.CanAdd=!0,t.Events="{'DOMContentLoaded': 'FilterDomLoaded'}",t));this._filterGrid.OnDeleteConfirmed=Bridge.fn.combine(this._filterGrid.OnDeleteConfirmed,Bridge.fn.bind(this,function(){this._filterGrid.GetSelectedRows().ForEach(Bridge.fn.cacheBind(this._filterGrid.RowData,this._filterGrid.RowData.Remove))}));this._filterGrid.GuiInfo.LocalHeader=Bridge.fn.bind(this,function(n){var t;return n.add((t=new Core.Models.GridPolicy,t.Id=1,t.EntityId=this._fieldConditionId,t.FieldName="FieldId",t.Events="{'change': 'FieldId_Changed'}",t.ShortDesc="Tên cột",t.ReferenceId=this._gridPolicyId,t.RefName="GridPolicy",t.FormatCell="{ShortDesc}",t.Active=!0,t.Editable=!0,t.ComponentType="Dropdown",t.MinWidth="100px",t.MaxWidth="200px",t.LocalRender=!0,t.LocalData=System.Linq.Enumerable.from(this._headers,Core.Models.GridPolicy).where(function(n){return!Bridge.referenceEquals(n.FieldName,Core.Components.EditableComponent.IdField)}).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object),t.LocalHeader=Bridge.fn.bind(this,function(n){var t;return n.add((t=new Core.Models.GridPolicy,t.EntityId=this._gridPolicyId,t.FieldName="ShortDesc",t.ShortDesc="Tên cột",t.Active=!0,t)),n})(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor)),t.Validation='[{"Rule": "required", "Message": "{0} is required"}]',t)),n.add((t=new Core.Models.GridPolicy,t.Id=2,t.EntityId=this._fieldConditionId,t.FieldName="CompareOperatorId",t.ShortDesc="Toán tử",t.ReferenceId=this._entityId,t.RefName="Entity",t.ComponentType="Dropdown",t.FormatCell="{Description}",t.Active=!0,t.Editable=!0,t.MinWidth="150px",t.LocalRender=!0,t.LocalData=Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.AdvSearchOperation),t.LocalHeader=Bridge.fn.bind(this,function(n){var t;return n.add((t=new Core.Models.GridPolicy,t.EntityId=this._entityId,t.FieldName="Name",t.ShortDesc="Toán tử",t.Active=!0,t)),n.add((t=new Core.Models.GridPolicy,t.EntityId=this._entityId,t.FieldName="Description",t.ShortDesc="Ký hiệu",t.Active=!0,t)),n})(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor)),t.Validation='[{"Rule": "required", "Message": "{0} is required"}]',t)),n.add((t=new Core.Models.GridPolicy,t.Id=3,t.EntityId=this._fieldConditionId,t.FieldName="Value",t.ShortDesc="Giá trị",t.ReferenceId=this._entityId,t.RefName="Entity",t.ComponentType="Input",t.Active=!0,t.Editable=!0,t.MinWidth="450px",t.Validation='[{"Rule": "required", "Message": "{0} is required"}]',t)),n.add((t=new Core.Models.GridPolicy,t.Id=2,t.EntityId=this._fieldConditionId,t.FieldName="LogicOperatorId",t.ShortDesc="Kết hợp",t.ReferenceId=this._entityId,t.RefName="Entity",t.ComponentType="Dropdown",t.FormatCell="{Description}",t.Active=!0,t.Editable=!0,t.DefaultVal="0",t.LocalRender=!0,t.LocalData=Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.LogicOperation),t.LocalHeader=Bridge.fn.bind(this,function(n){var t;return n.add((t=new Core.Models.GridPolicy,t.EntityId=this._entityId,t.FieldName="Name",t.ShortDesc="Kết hợp",t.Active=!0,t)),n.add((t=new Core.Models.GridPolicy,t.EntityId=this._entityId,t.FieldName="Description",t.ShortDesc="Miêu tả",t.Active=!0,t)),n})(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor)),t)),n})(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor));this._filterGrid.GuiInfo.LocalData=System.Linq.Enumerable.from(this.AdvSearchEntity.Conditions).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object);this._filterGrid.ParentElement=n.Element;n.AddChild(this._filterGrid);this._filterGrid.Element.addEventListener("keydown",Bridge.fn.cacheBind(this,this.ToggleIndent))},FilterDomLoaded:function(){this._filterGrid.MainSection.Children.ForEach(Bridge.fn.bind(this,function(n){var t=Bridge.unbox(n.Entity);Bridge._=this.FieldId_Changed(t,t.Field)}))},HeaderForAdvSearch:function(){return System.Linq.Enumerable.from(this.ParentListView.Header,Core.Models.GridPolicy).where(function(n){return n.Id>0&&!Core.Extensions.StringExt.IsNullOrWhiteSpace(n.ShortDesc)&&n.Active&&!n.Hidden})},AddOrderByGrid:function(n){var t,i;this._orderByGrid=new Core.Components.GridView((t=new Core.Models.Component,t.FieldName="OrderBy",t.Column=4,t.ReferenceId=this._orderById,t.RefName="Entity",t.Reference=(i=new Core.Models.Entity,i.Name="OrderBy",i.Namespace=(Bridge.Reflection.getTypeNamespace(Core.Models.OrderBy)||"")+".",i),t.CanAdd=!0,t.IgnoreConfirmHardDelete=!0,t.LocalRender=!0,t));this._orderByGrid.OnDeleteConfirmed=Bridge.fn.combine(this._orderByGrid.OnDeleteConfirmed,Bridge.fn.bind(this,function(){this._orderByGrid.GetSelectedRows().ForEach(Bridge.fn.cacheBind(this._orderByGrid.RowData,this._orderByGrid.RowData.Remove))}));this._orderByGrid.GuiInfo.LocalHeader=Bridge.fn.bind(this,function(n){var t;return n.add((t=new Core.Models.GridPolicy,t.Id=1,t.EntityId=this._fieldConditionId,t.FieldName="FieldId",t.Events="{'change': 'FieldId_Changed'}",t.ShortDesc="Tên cột",t.ReferenceId=this._gridPolicyId,t.RefName="GridPolicy",t.FormatCell="{ShortDesc}",t.Active=!0,t.Editable=!0,t.ComponentType="Dropdown",t.MinWidth="100px",t.MaxWidth="200px",t.LocalData=System.Linq.Enumerable.from(this._headers).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object),t.LocalRender=!0,t.LocalHeader=Bridge.fn.bind(this,function(n){var t;return n.add((t=new Core.Models.GridPolicy,t.EntityId=this._gridPolicyId,t.FieldName="ShortDesc",t.ShortDesc="Tên cột",t.Active=!0,t)),n})(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor)),t)),n.add((t=new Core.Models.GridPolicy,t.Id=2,t.EntityId=this._orderById,t.FieldName="OrderbyOptionId",t.ShortDesc="Thứ tự",t.ReferenceId=this._entityId,t.RefName="Entity",t.ComponentType="Dropdown",t.FormatCell="{Description}",t.Active=!0,t.Editable=!0,t.MinWidth="100px",t.MaxWidth="120px",t.LocalData=Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.OrderbyOption),t.LocalHeader=Bridge.fn.bind(this,function(n){var t;return n.add((t=new Core.Models.GridPolicy,t.EntityId=this._entityId,t.FieldName="Name",t.ShortDesc="Thứ tự",t.Active=!0,t)),n})(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor)),t.LocalRender=!0,t)),n})(new(System.Collections.Generic.List$1(Core.Models.GridPolicy).ctor));this._orderByGrid.GuiInfo.LocalData=System.Linq.Enumerable.from(this.AdvSearchEntity.OrderBy).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object);this._orderByGrid.ParentElement=n.Element;n.AddChild(this._orderByGrid)},ToggleIndent:function(n){var t,i=Core.Extensions.EventExt.KeyCodeEnum(n);if(!System.Nullable.neq(i,Core.Enums.KeyCodeEnum.Tab)){n.preventDefault();var r=Core.Extensions.EventExt.ShiftKey(n),u=this._filterGrid.GetSelectedRows(),f=(t=System.Object,System.Linq.Enumerable.from(u,t).toDictionary(function(n){return Bridge.unbox(n[Core.Components.EditableComponent.IdField])},null,System.Int32,t));this._filterGrid.RowAction$1(function(n){return f.containsKey(Bridge.unbox(n.Entity[Core.Components.EditableComponent.IdField]))},function(n){var t=Bridge.as(n.Entity,Core.Models.FieldCondition);t.Level=t.Level+(r?-1:1)|0;System.Linq.Enumerable.from(n.Element.querySelectorAll("td")).select(function(n){return Bridge.cast(n,HTMLElement)}).forEach(function(n){n.style.paddingLeft=t.Level+"rem"})})}},DirtyCheckAndCancel:function(){Core.Components.Forms.PopupEditor.prototype.Dispose.call(this)},ApplyFilter:function(){var n=0,i,f,r,h,t=new System.Threading.Tasks.TaskCompletionSource,e,o,s,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2],n);switch(n){case 0:if(i=this.IsFormValid(),n=1,i.isCompleted())continue;i["continue"](u);return;case 1:if(f=i.getAwaitedResult(),e=f,!e){t.setResult(null);return}if(o=this.CalcAdvSearchQuery(),r=this.ParentListView.ReloadData(o),n=2,r.isCompleted())continue;r["continue"](u);return;case 2:h=r.getAwaitedResult();t.setResult(null);return;default:t.setResult(null);return}}}catch(c){s=System.Exception.create(c);t.setException(s)}},arguments);return u(),t.task},CalcAdvSearchQuery:function(){var t=this.ParentListView.FormattedDataSource,e,o;t=t.replace(new RegExp("(Active eq true (and|or)?)|( (and|or)?Active eq true^)"),"");this.AdvSearchEntity.ActiveState!==Core.Enums.ActiveStateEnum.Yes||System.String.contains(t,"Active eq false")?this.AdvSearchEntity.ActiveState!==Core.Enums.ActiveStateEnum.No||System.String.contains(t,"Active eq true")||(t=Core.Extensions.OdataExt.AppendClause(t," and Active eq false")):t=Core.Extensions.OdataExt.AppendClause(t," and Active eq true");var s=Core.Extensions.OdataExt.GetClausePart(t),r=System.Linq.Enumerable.from(this.AdvSearchEntity.Conditions,Core.Models.FieldCondition).select(Bridge.fn.bind(this,function(t){var i;return new n.$AnonymousType$12(this.GetSearchValue(t),(i=Core.Components.AdvancedSearch.GetLogicOp(t),i!=null?i:" and "),t.Group)})).where(function(n){return Core.Extensions.StringExt.HasAnyChar(n.Term)}).toList(System.Object),u=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(r,System.Object).where(function(n){return!n.Group}).select(function(n,t){return t<(r.Count-1|0)?(n.Term||"")+(n.Operator||""):n.Term}),""),f=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(r,System.Object).where(function(n){return n.Group}).select(function(n,t){return t<(r.Count-1|0)?(n.Term||"")+(n.Operator||""):n.Term}),""),i=System.String.format("({0})",[s]);return Core.Extensions.StringExt.IsNullOrWhiteSpace(u)||(i=(i||"")+(System.String.replaceAll(System.String.replaceAll(System.String.format(" and ({0})",[u]),"and )",")"),"or )",")")||"")),Core.Extensions.StringExt.IsNullOrWhiteSpace(f)||(i=(i||"")+(System.String.replaceAll(System.String.replaceAll(System.String.format(" and ({0})",[f]),"and )",")"),"or )",")")||"")),Core.Extensions.StringExt.IsNullOrWhiteSpace(u)&&Core.Extensions.StringExt.IsNullOrWhiteSpace(f)||(t=Core.Extensions.OdataExt.ApplyClause(t,i)),e=System.Linq.Enumerable.from(this.AdvSearchEntity.OrderBy,Core.Models.OrderBy).select(function(n){return System.String.format("{0} {1}",n.Field.FieldName,System.Nullable.toString(n.OrderbyOptionId,System.Enum.toStringFn(Core.Enums.OrderbyOption)).toLowerCase())}),o=Bridge.toArray(e).join(","),Core.Extensions.StringExt.IsNullOrWhiteSpace(o)||(t=Core.Extensions.OdataExt.ApplyClause(t,Bridge.toArray(e).join(","),Core.Extensions.OdataExt.OrderByKeyword)),t},GetSearchValue:function(n){var u,f,t=(u=n.Value)!=null?Bridge.toString(u):null,i,e,s,h,r,c,l,a;if(t==null&&System.Nullable.neq(n.CompareOperatorId,Core.Enums.AdvSearchOperation.EqualNull)&&System.Nullable.neq(n.CompareOperatorId,Core.Enums.AdvSearchOperation.NotEqualNull))return null;if(i=Bridge.Reflection.getMembers(this._entityType,16,284,n.Field.FieldName).rt,Core.Extensions.ReflectionExt.IsDate(i)){if(!Core.Extensions.StringExt.IsNullOrWhiteSpace(t))try{e=Core.Extensions.DateTimeExt.ToISOFormat(System.DateTime.parseExact(t,"dd/MM/yyyy",System.Globalization.CultureInfo.invariantCulture));t=System.String.format("cast({0},Edm.DateTimeOffset)",[e])}catch(o){o=System.Exception.create(o);s=Core.Extensions.DateTimeExt.ToISOFormat(System.DateTime.parseExact(t,"MM/dd/yyyy HH:mm:ss",System.Globalization.CultureInfo.invariantCulture));t=System.String.format("cast({0},Edm.DateTimeOffset)",[s])}}else Core.Extensions.ReflectionExt.IsInt32(i)&&System.String.endsWith(n.Field.FieldName,Core.Components.EditableComponent.IdField)?t!=null&&(h=System.Linq.Enumerable.from(t.split(","),System.String).select(function(n){return Core.Extensions.Utils.TryParseInt(n)}).where(function(n){return n!=null}).select(function(n){return Bridge.cast(n,System.Int32)}),t=Bridge.toArray(h).join(",")):Core.Extensions.ReflectionExt.IsNumber(i)?t=System.String.format("{0}",[t]):Core.Extensions.ReflectionExt.IsBool(i)?(r={v:new Core.Enums.ActiveStateEnum},c=System.Enum.tryParse(Core.Enums.ActiveStateEnum,t,r),c&&r.v===Core.Enums.ActiveStateEnum.Yes?t="true":r.v===Core.Enums.ActiveStateEnum.No&&(t="false")):t=System.String.format("'{0}'",[Core.Extensions.Utils.EncodeSpecialChar(t)]);return l=Core.Extensions.AdvOptionExt.OperationToOdata.getItem(System.Nullable.getValue(n.CompareOperatorId)),a=System.String.format(l,(f=n.Field)!=null?f.FieldName:null,t),a},FieldId_Changed:function(n,t){var r=0,h,a,e=new System.Threading.Tasks.TaskCompletionSource,o,s,u,v,c,f,i,y,p,w,l,b,k,d,g=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1,2,3,4,5,7],r);switch(r){case 0:if(n==null||t==null){e.setResult(null);return}if(n.Field=t,o=Bridge.Reflection.getMembers(this._entityType,16,284,t.FieldName).rt,s=Core.Components.Extensions.ComponentExt.FirstOrDefault(this._filterGrid,function(t){return t.GuiInfo!=null&&Bridge.referenceEquals(t.Entity,n)&&Bridge.referenceEquals(t.GuiInfo.FieldName,"Value")}),u=Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(this._filterGrid,function(t){return t.GuiInfo!=null&&Bridge.referenceEquals(t.Entity,n)&&Bridge.referenceEquals(t.GuiInfo.FieldName,"CompareOperatorId")}),Core.Components.SearchEntry),s==null){e.setResult(null);return}if(v=s.ParentElement,c=s.Parent,s.Dispose(),f=Core.Extensions.Utils.MapToComponent(t),f.FieldName="Value",i=null,y=System.Array.init(["Dropdown","SearchEntry","MultipleSearchEntry"],System.String),p=System.Array.contains(y,t.ComponentType,System.String)||Core.Extensions.ReflectionExt.IsInt32(o)&&(System.Nullable.eq((w=t.FieldName)!=null?System.String.endsWith(w,Core.Components.EditableComponent.IdField):null,!0)||Bridge.referenceEquals(t.FieldName,"InsertedBy")||Bridge.referenceEquals(t.FieldName,"UpdatedBy")),Core.Extensions.ReflectionExt.IsDate(o)){r=1;continue}else{r=2;continue}case 1:i=Core.Components.AdvancedSearch.SetSearchDateTime(u,f);n.Value=System.DateTime.format(System.DateTime.getNow());r=7;continue;case 2:if(p){r=3;continue}else{r=5;continue}case 3:if(h=this.SetSearchId(t,u,f,i),r=4,h.isCompleted())continue;h["continue"](g);return;case 4:a=h.getAwaitedResult();i=a;n.Value="";r=6;continue;case 5:Core.Extensions.ReflectionExt.IsBool(o)?(i=Core.Components.AdvancedSearch.SetSearchBool(u,f),n.Value=Bridge.toString(Core.Enums.ActiveStateEnum.All)):Core.Extensions.ReflectionExt.IsNumber(o)?(i=Core.Components.AdvancedSearch.SetSearchDecimal(u,f),n.Value=Bridge.toString(0)):i=Core.Components.AdvancedSearch.SetSearchString(u,f);r=6;continue;case 7:n.LogicOperatorId=(l=n.LogicOperatorId,l!=null?l:Core.Enums.LogicOperation.And);(b=Core.Components.Extensions.ComponentExt.FirstOrDefault(this._filterGrid,function(t){return t.GuiInfo!=null&&Bridge.referenceEquals(t.Entity,n)&&Bridge.referenceEquals(t.GuiInfo.FieldName,"LogicOperatorId")}))!=null?b.UpdateView():null;n.CompareOperatorId=(k=System.Linq.Enumerable.from(u.GuiInfo.LocalData).select(function(n){return Bridge.cast(n,Core.Models.Entity)}).firstOrDefault(null,null))!=null?k.Id:null;u.Value=n.CompareOperatorId;u.UpdateView();i.Entity=n;Core.Components.Extensions.ComponentExt.SetValue(i,"Value",n.Value);i.Parent=c;c.Children.insert(2,i);i.ParentElement=v;i.Render();e.setResult(null);return;default:e.setResult(null);return}}}catch(nt){d=System.Exception.create(nt);e.setException(d)}},arguments);return g(),e.task},SetSearchId:function(n,t,i,r){var u=0,f,l,e=new System.Threading.Tasks.TaskCompletionSource,o,s,h,c,a,v=Bridge.fn.bind(this,function(){try{for(;;){u=System.Array.min([0,1],u);switch(u){case 0:if(i.ComponentType="MultipleSearchEntry",o=(s=n.ReferenceId,s!=null?s:(h=this.ParentListView.GuiInfo.ReferenceId,h!=null?h:0)),i.ReferenceId=o,i.Reference=Core.Extensions.Utils.GetEntity(o),i.DataSourceFilter=n.DataSource,f=new Core.Clients.Client.$ctor1("GridPolicy",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.GridPolicy,System.String.format("?$filter=Active eq true and FeatureId eq null and EntityId eq {0}",[Bridge.box((c=n.ReferenceId,c!=null?c:n.EntityId),System.Int32)])),u=1,f.isCompleted())continue;f["continue"](v);return;case 1:l=f.getAwaitedResult();i.LocalHeader=l;t.GuiInfo.LocalData=System.Linq.Enumerable.from(Core.Components.AdvancedSearch.OperatorFactory(Core.Enums.ComponentTypeTypeEnum.SearchEntry)).select(function(n){return Bridge.cast(n,System.Object)}).toList(System.Object);r=new Core.Components.MultipleSearchEntry(i);r.EntityType=Core.Models.FieldCondition;t.Value=Core.Enums.AdvSearchOperation.In;e.setResult(r);return;default:e.setResult(null);return}}}catch(y){a=System.Exception.create(y);e.setException(a)}},arguments);return v(),e.task}}});Bridge.define("$AnonymousType$12",n,{$kind:"anonymous",ctors:{ctor:function(n,t,i){this.Term=n;this.Operator=t;this.Group=i}},methods:{equals:function(t){return Bridge.is(t,n.$AnonymousType$12)?Bridge.equals(this.Term,t.Term)&&Bridge.equals(this.Operator,t.Operator)&&Bridge.equals(this.Group,t.Group):!1},getHashCode:function(){return Bridge.addHash([7550208986,this.Term,this.Operator,this.Group])},toJSON:function(){return{Term:this.Term,Operator:this.Operator,Group:this.Group}}},statics:{methods:{$metadata:function(){return{m:[{a:2,n:"Group",t:16,rt:System.Boolean,g:{a:2,n:"get_Group",t:8,rt:System.Boolean,fg:"Group",box:function(n){return Bridge.box(n,System.Boolean,System.Boolean.toString)}},fn:"Group"},{a:2,n:"Operator",t:16,rt:System.String,g:{a:2,n:"get_Operator",t:8,rt:System.String,fg:"Operator"},fn:"Operator"},{a:2,n:"Term",t:16,rt:System.String,g:{a:2,n:"get_Term",t:8,rt:System.String,fg:"Term"},fn:"Term"}]}}}}});Bridge.define("Core.Components.ExportCustomData",{inherits:[Core.Components.Forms.PopupEditor],fields:{ParentListView:null,_ul:null,_tbody:null,_ul1:null,_settings:null,_headers:null},ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"GridPolicy");this.Name="Export CustomData";this.Title="Xuất excel tùy chọn";this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.bind(this,function(){var n=0,t,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.LocalRender(),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:t.getAwaitedResult();this.Move();return;default:return}}},arguments);i()}))}},methods:{Move:function(){var a=this,i=document.getElementById("exTable"),n=undefined,u=undefined,t=undefined,r=undefined,e=!1,o=0,s=0,f=function(n,t){var i=n.parentNode,r=n.nextSibling===t?n:n.nextSibling;t.parentNode.insertBefore(n,t);i.insertBefore(t,r)},h=function(n,t){var i=n.getBoundingClientRect(),r=t.getBoundingClientRect();return i.top+i.height/2<r.top+r.height/2},v=function(){var t=i.getBoundingClientRect(),n=parseInt(window.getComputedStyle(i).width);r=document.createElement("div");r.classList.add("clone-list");r.style.position="absolute";i.parentNode.insertBefore(r,i);i.style.visibility="hidden";i.querySelectorAll("tr").forEach(function(t){var u=document.createElement("div"),i,f,e;u.classList.add("draggable");i=document.createElement("table");i.setAttribute("class","clone-table");i.style.width=n+"px";f=document.createElement("tr");e=[].slice.call(t.children);e.forEach(function(n){var t=n.cloneNode(!0);t.style.width=parseInt(window.getComputedStyle(n).width)+"px";f.appendChild(t)});i.appendChild(f);u.appendChild(i);r.appendChild(u)})},y=function(n){var t=n.target.parentNode;u=[].slice.call(i.querySelectorAll("tr")).indexOf(t);o=n.clientX;s=n.clientY;document.addEventListener("mousemove",c);document.addEventListener("mouseup",l)},c=function(i){e||(e=!0,v(),n=[].slice.call(r.children)[u],n.classList.add("dragging"),t=document.createElement("div"),t.classList.add("placeholder"),n.parentNode.insertBefore(t,n.nextSibling),t.style.height=n.offsetHeight+"px");n.style.position="absolute";n.style.top=n.offsetTop+i.clientY-s+"px";n.style.left=n.offsetLeft+i.clientX-o+"px";o=i.clientX;s=i.clientY;var c=n.previousElementSibling,l=t.nextElementSibling;if(c&&c.previousElementSibling&&h(n,c)){f(t,n);f(t,c);return}l&&h(l,n)&&(f(l,t),f(l,n))},l=function l(){var o,f;t&&t.parentNode.removeChild(t);n.classList.remove("dragging");n.style.removeProperty("top");n.style.removeProperty("left");n.style.removeProperty("position");o=[].slice.call(r.children).indexOf(n);e=!1;r.parentNode.removeChild(r);f=[].slice.call(i.querySelectorAll("tr"));u>o?f[o].parentNode.insertBefore(f[u],f[o]):f[o].parentNode.insertBefore(f[u],f[o].nextSibling);i.style.removeProperty("visibility");document.removeEventListener("mousemove",c);document.removeEventListener("mouseup",l);a.OrderBy()};i.querySelectorAll("tr").forEach(function(n,t){if(t!==0){var i=n.firstElementChild;i.classList.add("draggable");i.addEventListener("mousedown",y)}})},LocalRender:function(){var i=0,r,s,u=new System.Threading.Tasks.TaskCompletionSource,e,h,o,c,f,n,t,l,a=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(this._headers=System.Linq.Enumerable.from(this.ParentListView.BasicHeader,Core.Models.GridPolicy).where(function(n){return!Bridge.referenceEquals(n.ComponentType,"Button")&&!Core.Extensions.StringExt.IsNullOrWhiteSpace(n.ShortDesc)}).toList(Core.Models.GridPolicy),r=new Core.Clients.Client.$ctor1("UserSetting").FirstOrDefaultAsync(Core.Models.UserSetting,System.String.format("?$filter=UserId eq {0} and Name eq 'Export-{1}'",Bridge.box(Core.Clients.Client.Token.UserId,System.Int32),Bridge.box(this.ParentListView.GuiInfo.Id,System.Int32))),i=1,r.isCompleted())continue;r["continue"](a);return;case 1:s=r.getAwaitedResult();e=s;e!=null&&(h=(o=Core.Models.GridPolicy,System.Linq.Enumerable.from(Newtonsoft.Json.JsonConvert.DeserializeObject(e.Value,System.Collections.Generic.List$1(Core.Models.GridPolicy)),o).toDictionary(function(n){return n.Id},null,System.Int32,o)),this._headers.ForEach(function(n){var t=System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.Int32,Core.Models.GridPolicy,h,n.Id);t!=null&&(n.IsExport=t.IsExport,n.OrderExport=t.OrderExport)}));this._headers=System.Linq.Enumerable.from(this._headers,Core.Models.GridPolicy).orderBy(function(n){return n.OrderExport}).toList(Core.Models.GridPolicy);c=Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section,this,"Content");Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(c.Element).Table,"table").Id("exTable").Thead.TRow.TData.Text("STT").End.TData.Checkbox(!1).Event$1("input",Bridge.fn.bind(this,function(n){this.TongleAll(n)})).End.End.TData.Text("Tên cột").EndOf(Core.MVVM.ElementType.thead);Core.MVVM.Html.Instance.TBody.Render();this._tbody=Core.MVVM.Html.Context;f=1;n=Bridge.getEnumerator(this._headers);try{while(n.moveNext())t={v:n.Current},Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.MVVM.Html.Instance.TRow.DataAttr("id",Bridge.box(t.v.Id,System.Int32)).TData.Style$1("padding:0"),Bridge.toString(f)).End.TData.Style$1("padding:0").Checkbox(t.v.IsExport).Event$1("input",function(n,t){return function(n){t.v.IsExport=Bridge.cast(n.target,HTMLInputElement).checked}}(this,t)).End.End.TData.Style$1("padding:0"),"text-left"),t.v.ShortDesc).End.EndOf(Core.MVVM.ElementType.tr),f=f+1|0}finally{Bridge.is(n,System.IDisposable)&&n.System$IDisposable$Dispose()}u.setResult(null);return;default:u.setResult(null);return}}}catch(v){l=System.Exception.create(v);u.setException(l)}},arguments);return a(),u.task},TongleAll:function(n){var i,r,t;Core.MVVM.Html.Take(this._tbody).Clear();this._headers.ForEach(function(t){t.IsExport=Bridge.cast(n.target,HTMLInputElement).checked});r=1;i=Bridge.getEnumerator(this._headers);try{while(i.moveNext())t={v:i.Current},Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.MVVM.Html.Instance.TRow.DataAttr("id",Bridge.box(t.v.Id,System.Int32)).TData.DataAttr("id",Bridge.box(t.v.Id,System.Int32)).Style$1("padding:0"),Bridge.toString(r)).End.TData.Style$1("padding:0").Checkbox(t.v.IsExport).Event$1("input",function(n,t){return function(n){t.v.IsExport=Bridge.cast(n.target,HTMLInputElement).checked}}(this,t)).End.End.TData.Style$1("padding:0"),"text-left"),t.v.ShortDesc).End.EndOf(Core.MVVM.ElementType.tr),r=r+1|0}finally{Bridge.is(i,System.IDisposable)&&i.System$IDisposable$Dispose()}this.Move()},OrderBy:function(){var n=1;Core.Extensions.IEnumerableExtensions.ForEach(HTMLElement,this._tbody.children,Bridge.fn.bind(this,function(t){System.Linq.Enumerable.from(this._headers,Core.Models.GridPolicy).firstOrDefault(function(n){return n.Id===System.Int32.parse(t.getAttribute("data-id"))},null).OrderExport=n;n=n+1|0}))},ExportData:function(){var n=0,o,b,s,it,h,rt,c,k,l=new System.Threading.Tasks.TaskCompletionSource,r,i,a,t,d,v,y,f,g,u,p,nt,w,tt,e=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2,3,4,5,6,7],n);switch(n){case 0:if(Core.Extensions.Toast.Success("Đang xuất excel"),o=new Core.Clients.Client.$ctor1("UserSetting").FirstOrDefaultAsync(Core.Models.UserSetting,System.String.format("?$filter=UserId eq {0} and Name eq 'Export-{1}'",Bridge.box(Core.Clients.Client.Token.UserId,System.Int32),Bridge.box(this.ParentListView.GuiInfo.Id,System.Int32))),n=1,o.isCompleted())continue;o["continue"](e);return;case 1:if(b=o.getAwaitedResult(),r=b,r==null){n=2;continue}else{n=4;continue}case 2:if(r=(i=new Core.Models.UserSetting,i.Name=System.String.format("Export-{0}",[Bridge.box(this.ParentListView.GuiInfo.Id,System.Int32)]),i.UserId=Core.Clients.Client.Token.UserId,i.Value=Newtonsoft.Json.JsonConvert.SerializeObject(this._headers),i),s=new Core.Clients.Client.$ctor1("UserSetting").CreateAsync(Core.Models.UserSetting,r),n=3,s.isCompleted())continue;s["continue"](e);return;case 3:it=s.getAwaitedResult();n=6;continue;case 4:if(r.Value=Newtonsoft.Json.JsonConvert.SerializeObject(this._headers),h=new Core.Clients.Client.$ctor1("UserSetting").UpdateAsync(Core.Models.UserSetting,r),n=5,h.isCompleted())continue;h["continue"](e);return;case 5:rt=h.getAwaitedResult();n=6;continue;case 6:if(a=System.Linq.Enumerable.from(this.ParentListView.AdvSearchVM.OrderBy,Core.Models.OrderBy).select(Bridge.fn.bind(this,function(n){return System.String.format("[{0}].{1} {2}",this.ParentListView.GuiInfo.RefName,n.Field.FieldName,System.Nullable.toString(n.OrderbyOptionId,System.Enum.toStringFn(Core.Enums.OrderbyOption)).toLowerCase())})),t="",Core.Extensions.IEnumerableExtensions.HasElement(System.String,a)&&(t=Core.Extensions.IEnumerableExtensions.Combine(System.String,a)),Core.Extensions.StringExt.IsNullOrWhiteSpace(t)&&(t=Core.Extensions.OdataExt.GetClausePart(this.ParentListView.FormattedDataSource,Core.Extensions.OdataExt.OrderByKeyword),System.String.contains(t,",")?(d=(i=System.String,System.Linq.Enumerable.from(t.split(","),i).toList(i)),t=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(d,System.String).select(Bridge.fn.bind(this,function(n){return System.String.format("[{0}].{1}",this.ParentListView.GuiInfo.RefName,n)})))):t=System.String.format("[{0}].{1}",this.ParentListView.GuiInfo.RefName,t)),v=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).where(function(n){return!n.Group}).select(function(n){return n.FieldName})," and "),y=Core.Extensions.IEnumerableExtensions.Combine(System.String,System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).where(function(n){return n.Group}).select(function(n){return n.FieldName})," or "),f=new(System.Collections.Generic.List$1(System.String).ctor),Core.Extensions.StringExt.IsNullOrWhiteSpace(v)||f.add(System.String.format("({0})",[v])),Core.Extensions.StringExt.IsNullOrWhiteSpace(y)||f.add(System.String.format("({0})",[y])),g=System.Linq.Enumerable.from(f,System.String).any()?System.String.format("({0})",[Core.Extensions.IEnumerableExtensions.Combine(System.String,f," and ")]):"",u=this.ParentListView.GuiInfo.PreQuery,p={},u!=null&&Core.Extensions.Utils.IsFunction(u,p)&&(u=Bridge.toString(p.v.call(this,this,this.EditForm))),c=new Core.Clients.Client.$ctor1(this.ParentListView.GuiInfo.RefName).GetAsync$1(System.String,(System.String.format("/ExportExcel?componentId={0}",[Bridge.box(this.ParentListView.GuiInfo.Id,System.Int32)])||"")+(System.String.format("&sql={0}",[this.ParentListView.Sql])||"")+(System.String.format("&showNull={0}",[Bridge.box((w=this.ParentListView.GuiInfo.ShowNull,w!=null?w:!1),System.Boolean,System.Boolean.toString)])||"")+(System.String.format("&where={0} {1}",g,Core.Extensions.StringExt.IsNullOrWhiteSpace(u)?"":System.String.format("{0} {1}",System.Linq.Enumerable.from(this.ParentListView.Wheres,Core.Models.Where).any()?" and ":"",u))||"")+(System.String.format("&custom=true&featureId={0}&orderby={1}",Bridge.box(this.Parent.EditForm.Feature.Id,System.Int32),t)||"")),n=7,c.isCompleted())continue;c["continue"](e);return;case 7:k=c.getAwaitedResult();nt=k;Core.Clients.Client.Download(System.String.format("/excel/Download/{0}",[nt]));Core.Extensions.Toast.Success("Xuất file thành công");l.setResult(null);return;default:l.setResult(null);return}}}catch(ut){tt=System.Exception.create(ut);l.setException(tt)}},arguments);return e(),l.task}}});Bridge.define("Core.Components.Framework.ComponentBL",{inherits:[Core.Components.Forms.PopupEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"Component");this.Name="ComponentEditor";this.Title="Component properties";this.Icon="fa fa-wrench";this.Id="EditComponent_"+(this.Id||"");this.Entity=new Core.Models.Component;this.PopulateDirty=!1;this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.cacheBind(this,this.AlterPosition))}},methods:{AlterPosition:function(){Core.Extensions.HtmlElementExtension.AddClass(this.Element.parentElement,"properties")},Save:function(n){var t=0,i,u,r=new System.Threading.Tasks.TaskCompletionSource,f,e,o,s=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(f=Bridge.unbox(this.Entity),Core.Extensions.ReflectionExt.ClearReferences(f),i=Core.Components.Forms.PopupEditor.prototype.Save.call(this,n),t=1,i.isCompleted())continue;i["continue"](s);return;case 1:u=i.getAwaitedResult();e=u;r.setResult(e);return;default:r.setResult(null);return}}}catch(h){o=System.Exception.create(h);r.setException(o)}},arguments);return s(),r.task}}});Bridge.define("Core.Components.Framework.ComponentGroupBL",{inherits:[Core.Components.Forms.PopupEditor],fields:{_syncConfig:null},props:{ComGroupEntity:{get:function(){return Bridge.as(this.Entity,Core.Models.ComponentGroup)}}},ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"ComponentGroup");this.Name="ComponentGroup";this.Title="Section properties";this.Icon="fa fa-wrench";this.PopulateDirty=!1;this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.cacheBind(this,this.AlterPosition))}},methods:{AlterPosition:function(){Core.Extensions.HtmlElementExtension.AddClass(this.Element.parentElement,"properties")},Save:function(n){var i=0,r,u,t=new System.Threading.Tasks.TaskCompletionSource,f,e,o=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1],i);switch(i){case 0:if(this.ComGroupEntity==null){t.setResult(!1);return}if(Core.Extensions.ReflectionExt.ClearReferences(this.ComGroupEntity),Core.Extensions.IEnumerableExtensions.ForEach(Core.Models.Component,this.ComGroupEntity.Component,function(n){n.Reference=null;n.ComponentGroup=null}),r=Core.Components.Forms.PopupEditor.prototype.Save.call(this,n),i=1,r.isCompleted())continue;r["continue"](o);return;case 1:u=r.getAwaitedResult();f=u;t.setResult(f);return;default:t.setResult(null);return}}}catch(s){e=System.Exception.create(s);t.setException(e)}},arguments);return o(),t.task}}});Bridge.define("Core.Components.Framework.FeatureDetailBL",{inherits:[Core.Components.Forms.PopupEditor],props:{FeatureEntity:{get:function(){return Core.Extensions.BridgeExt.CastProp(Core.Models.Feature,this.Entity)}}},ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"Feature");this.Name="FeatureEditor";this.Title="Feature";this.PopulateDirty=!1;this.Entity=new Core.Models.Feature;this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.cacheBind(this,this.AlterPosition))}},methods:{AlterPosition:function(){Core.Extensions.HtmlElementExtension.AddClass(this.Element.parentElement,"properties")},SaveFeature:function(n){var t=0,r,u,i=new System.Threading.Tasks.TaskCompletionSource,f,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3],t);switch(t){case 0:if(f=n.Properties,!Core.Extensions.StringExt.HasAnyChar(f)){t=1;continue}t=3;continue;case 1:if(r=this.SaveFeatureInternal(n),t=2,r.isCompleted())continue;r["continue"](o);return;case 2:u=r.getAwaitedResult();i.setResult(u);return;case 3:Core.Components.Forms.ConfirmDialog.RenderConfirm("Feature properties has data.<br />Do you want to merge to the database?",Bridge.fn.bind(this,function(){var t=0,i,r,f,u=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1,2],t);switch(t){case 0:if(i=this.MergeFeatureProp(n,n.Properties),t=1,i.isCompleted())continue;i["continue"](u);return;case 1:if(i.getAwaitedResult(),n.Properties=null,r=this.SaveFeatureInternal(n),t=2,r.isCompleted())continue;r["continue"](u);return;case 2:f=r.getAwaitedResult();return;default:return}}},arguments);u()}),Bridge.fn.bind(this,function(){var t=0,i,u,r=Bridge.fn.bind(this,function(){for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.SaveFeatureInternal(n),t=1,i.isCompleted())continue;i["continue"](r);return;case 1:u=i.getAwaitedResult();return;default:return}}},arguments);r()}));i.setResult(!0);return;default:i.setResult(null);return}}}catch(s){e=System.Exception.create(s);i.setException(e)}},arguments);return o(),i.task},MergeFeatureProp:function(n,t){var r=0,u,i=new System.Threading.Tasks.TaskCompletionSource,f,e,o=Bridge.fn.bind(this,function(){try{for(;;){r=System.Array.min([0,1],r);switch(r){case 0:if(Core.Extensions.StringExt.IsNullOrWhiteSpace(t)){i.setResult(null);return}if(f=Newtonsoft.Json.JsonConvert.DeserializeObject(t,Core.Models.Feature),this.MergeFeature(n,f),u=this.CreateSection(n,f),r=1,u.isCompleted())continue;u["continue"](o);return;case 1:u.getAwaitedResult();i.setResult(null);return;default:i.setResult(null);return}}}catch(s){e=System.Exception.create(s);i.setException(e)}},arguments);return o(),i.task},CreateSection:function(n,t){var i=0,o,v,r=new System.Threading.Tasks.TaskCompletionSource,s,y,h,c,u,f,e,p,l,a=Bridge.fn.bind(this,function(){try{for(;;){i=System.Array.min([0,1,2,3,4],i);switch(i){case 0:if(Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.ComponentGroup,t.ComponentGroup)){r.setResult(null);return}s=new(System.Collections.Generic.List$1(System.Object).ctor);y=Core.Extensions.ReflectionExt.ToDictionaryDistinct(Core.Models.ComponentGroup,System.Int32,t.ComponentGroup,function(n){return n.Id});h=(c=Core.Models.ComponentGroup,System.Linq.Enumerable.from(n.ComponentGroup,c).toDictionary(function(n){return n.Id},null,System.Int32,c));u=Bridge.getEnumerator(y);try{while(u.moveNext())f=u.Current,h.containsKey(f.key)?Core.Extensions.ReflectionExt.CopyPropFrom$1(h.getItem(f.key),f.value):(e=new Core.Models.ComponentGroup,Core.Extensions.ReflectionExt.CopyPropFrom$1(e,f.value),Core.Extensions.ReflectionExt.ClearReferences(e),Core.Extensions.ReflectionExt.ProcessObjectRecursive(e,Bridge.fn.bind(this,function(n){n.hasOwnProperty(Core.Components.EditableComponent.IdField)&&(n[Core.Components.EditableComponent.IdField]=Bridge.box(0,System.Int32));n.hasOwnProperty("FeatureId")&&(n.FeatureId=Bridge.box(this.FeatureEntity.Id,System.Int32));n.hasOwnProperty("ParentId")&&(n.ParentId=null);n.hasOwnProperty("ComponentId")&&(n.ComponentId=null)})),s.add(e))}finally{Bridge.is(u,System.IDisposable)&&u.System$IDisposable$Dispose()}i=1;continue;case 1:if(o=new Core.Clients.Client.$ctor1("ComponentGroup",Bridge.Reflection.getTypeNamespace(Core.Models.User)).BulkUpdateAsync(System.Object,s),i=2,o.isCompleted())continue;o["continue"](a);return;case 2:v=o.getAwaitedResult();p=v;i=4;continue;case 3:l=null;i=4;continue;case 4:r.setResult(null);return;default:r.setResult(null);return}}}catch(w){if(l=System.Exception.create(w),i>=1&&i<=2){i=3;a();return}r.setException(l)}},arguments);return a(),r.task},MergeFeature:function(n,t){n.Id!==t.Id&&Core.Extensions.ReflectionExt.CopyPropFrom(n,t,1,System.Array.init([Core.Components.EditableComponent.IdField,"Name"],System.String))},LoadEntity:function(){var n=0,t,i,h,r=new System.Threading.Tasks.TaskCompletionSource,e,u,o,f,c,l,s=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2],n);switch(n){case 0:if(e=new Core.Clients.Client.$ctor1("Feature",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetAsync(Core.Models.Feature,this.FeatureEntity.Id),u=new Core.Clients.Client.$ctor1("ComponentGroup",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.ComponentGroup,System.String.format("?$expad=Component&$filter=Active eq true and FeatureId eq {0}",[Bridge.box(this.FeatureEntity.Id,System.Int32)])),o=new Core.Clients.Client.$ctor1("GridPolicy",Bridge.Reflection.getTypeNamespace(Core.Models.User)).GetRawList(Core.Models.GridPolicy,System.String.format("?$filter=Active eq true and FeatureId eq {0}",[Bridge.box(this.FeatureEntity.Id,System.Int32)])),t=System.Threading.Tasks.Task.whenAll(e,u,o),n=1,t.isCompleted())continue;t["continue"](s);return;case 1:if(t.getAwaitedResult(),f=e.getResult(),this.BuildTree(u.getResult()),f.ComponentGroup=u.getResult(),f.GridPolicy=o.getResult(),Core.Extensions.ReflectionExt.ClearReferences(f),i=Core.Components.Forms.PopupEditor.prototype.LoadEntity.call(this),n=2,i.isCompleted())continue;i["continue"](s);return;case 2:h=i.getAwaitedResult();c=h;r.setResult(c);return;default:r.setResult(null);return}}}catch(a){l=System.Exception.create(a);r.setException(l)}},arguments);return s(),r.task},SaveFeatureInternal:function(n){var t=0,i,r,a,u=new System.Threading.Tasks.TaskCompletionSource,f,e,o,s,h,c,v,y,l=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2],t);switch(t){case 0:if(Core.Extensions.ReflectionExt.ClearReferences(n),f=Core.Extensions.IEnumerableExtensions.ForEach(Core.Models.ComponentGroup,n.ComponentGroup,function(t){t.Component=null;t.InverseParent=null;t.Parent=null;t.Feature=null;t.FeatureId=n.Id}),e=Core.Extensions.IEnumerableExtensions.ForEach(Core.Models.Component,n.Component,function(n){n.ComponentGroup=null}),o=Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.ComponentGroup,f)?new Core.Clients.Client.$ctor1("ComponentGroup",Bridge.Reflection.getTypeNamespace(Core.Models.User)).BulkUpdateAsync(Core.Models.ComponentGroup,(s=Core.Models.ComponentGroup,System.Linq.Enumerable.from(f,s).toList(s))):System.Threading.Tasks.Task.fromResult(new(System.Collections.Generic.List$1(Core.Models.ComponentGroup).ctor),System.Collections.Generic.List$1(Core.Models.ComponentGroup)),h=Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.Component,e)?new Core.Clients.Client.$ctor1("Component",Bridge.Reflection.getTypeNamespace(Core.Models.User)).BulkUpdateAsync(Core.Models.Component,(c=Core.Models.Component,System.Linq.Enumerable.from(e,c).toList(c))):System.Threading.Tasks.Task.fromResult(new(System.Collections.Generic.List$1(Core.Models.Component).ctor),System.Collections.Generic.List$1(Core.Models.Component)),i=System.Threading.Tasks.Task.whenAll(o,h),t=1,i.isCompleted())continue;i["continue"](l);return;case 1:if(i.getAwaitedResult(),n.Active=!0,Core.Extensions.ReflectionExt.CopyPropFrom$1(n.ComponentGroup,o.getResult()),Core.Extensions.ReflectionExt.CopyPropFrom$1(n.Component,h.getResult()),r=Core.Components.Forms.PopupEditor.prototype.Save.call(this,Bridge.box(!0,System.Boolean,System.Boolean.toString)),t=2,r.isCompleted())continue;r["continue"](l);return;case 2:a=r.getAwaitedResult();v=a;u.setResult(v);return;default:u.setResult(null);return}}}catch(p){y=System.Exception.create(p);u.setException(y)}},arguments);return l(),u.task},EditGridColumn:function(n){var t,r=Bridge.as(n,Core.Models.GridPolicy),u=(t=new Core.Components.HeaderEditor,t.Entity=r,t.ParentElement=this.TabEditor.Element,t),i=System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs,Core.Components.Forms.TabEditor).firstOrDefault(function(n){return n.Show},null);i!=null?i.AddChild(u):null}}});Bridge.define("Core.Components.HeaderEditor",{inherits:[Core.Components.Forms.PopupEditor],fields:{_syncConfig:null},ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"GridPolicy");this.Name="HeaderEditor";this.Title="Properties";this.Icon="fa fa-wrench";this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.cacheBind(this,this.AlterPosition));this.PopulateDirty=!1;this.ShouldLoadEntity=!0}},methods:{AlterPosition:function(){Core.Extensions.HtmlElementExtension.AddClass(this.Element.parentElement,"properties")},SyncConfig:function(){var t=0,r,l,u=new System.Threading.Tasks.TaskCompletionSource,a,f,n,i,o,e,s,h,c=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3],t);switch(t){case 0:if(a=Bridge.as(this.Entity,Core.Models.GridPolicy),this.Dirty){t=1;continue}t=3;continue;case 1:if(r=this.Save(),t=2,r.isCompleted())continue;r["continue"](c);return;case 2:l=r.getAwaitedResult();t=3;continue;case 3:f=Bridge.as(this.Entity,Core.Models.GridPolicy);f.Feature=Bridge.as(this.Parent,Core.Components.Forms.EditForm).Feature;this._syncConfig=(n=new Core.ViewModels.SyncConfigVM,n.GridPolicy=f,n);i=(n=new Core.Components.Forms.ConfirmDialog,n.Entity=this._syncConfig,n.Content="Chọn danh sách khách hàng cần đồng bộ",n);this.AddChild(i);o=new Core.Components.MultipleSearchEntry((n=new Core.Models.Component,n.PlainText="Cập nhật cho các công ty",n.ShowLabel=!0,n.Label="Công ty",n.FieldName="VendorId",n.FormatData="{CompanyLocalShortName}",n.Row=12,n.ReferenceId=(e=(s=Core.Extensions.Utils.GetEntity$1("Vendor"))!=null?s.Id:null,e!=null?e:0),n.DataSourceFilter="?$filter=Active eq true and IsTenant eq true",n.Visibility=!0,n));i.AddChild(o);i.DisposeAfterYes=!1;i.YesConfirmed=Bridge.fn.combine(i.YesConfirmed,Bridge.fn.bind(this,function(){System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this,this.SyncDialog_YesConfirmed))}));u.setResult(!0);return;default:u.setResult(null);return}}}catch(v){h=System.Exception.create(v);u.setException(h)}},arguments);return c(),u.task},SyncDialog_YesConfirmed:function(){var n=0,t,r,i=new System.Threading.Tasks.TaskCompletionSource,u,f,e=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(Core.Extensions.ReflectionExt.ClearReferences(this._syncConfig.GridPolicy),t=new Core.Clients.Client.$ctor1("Component",Bridge.Reflection.getTypeNamespace(Core.Models.User)).PostAsync(System.Boolean,this._syncConfig,"SyncTenant",!1,!0),n=1,t.isCompleted())continue;t["continue"](e);return;case 1:r=t.getAwaitedResult();u=r;u&&Core.Extensions.Toast.Success("Cập nhật cấu hình thành công");i.setResult(null);return;default:i.setResult(null);return}}}catch(o){f=System.Exception.create(o);i.setException(f)}},arguments);return e(),i.task}}});Bridge.define("Core.Components.SecurityBL",{inherits:[Core.Components.Forms.PopupEditor],props:{Security:{get:function(){return Bridge.as(this.Entity,Core.ViewModels.SecurityVM)}}},ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"FeaturePolicy");this.Name="SecurityEditor";this.Title="Bảo mật & Phân quyền";this.Icon="mif-security"}}});Bridge.define("Core.Components.SecurityEditorBL",{inherits:[Core.Components.Forms.PopupEditor],props:{SecurityEntity:{get:function(){return Bridge.as(this.Entity,Core.ViewModels.SecurityVM)}}},ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"FeaturePolicy");this.Name="CreateSecurity";this.Title="Bảo mật & Phân quyền";this.Icon="mif-security";this.DOMContentLoaded=Bridge.fn.combine(this.DOMContentLoaded,Bridge.fn.cacheBind(this,this.CheckAllPolicy))}},methods:{CheckAllPolicy:function(){this.SecurityEntity.CanDelete=this.SecurityEntity.AllPermission;this.SecurityEntity.CanDeactivate=this.SecurityEntity.AllPermission;this.SecurityEntity.CanRead=this.SecurityEntity.AllPermission;this.SecurityEntity.CanWrite=this.SecurityEntity.AllPermission;this.SecurityEntity.CanShare=this.SecurityEntity.AllPermission;Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section,this,"Properties").UpdateView()},CheckPolicy:function(){this.SecurityEntity.AllPermission=!(!this.SecurityEntity.CanDeactivate||!this.SecurityEntity.CanDelete||!this.SecurityEntity.CanRead||!this.SecurityEntity.CanShare||!this.SecurityEntity.CanWrite);Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section,this,"Properties").UpdateView()},Save:function(){var t=0,i,r,n=new System.Threading.Tasks.TaskCompletionSource,u,f,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(this.SecurityEntity.UserId==null&&this.SecurityEntity.RoleId==null){Core.Extensions.Toast.Warning("User và Role không thể đồng thời để trống");n.setResult(!1);return}if(this.SecurityEntity.UserId!=null&&this.SecurityEntity.RoleId!=null){Core.Extensions.Toast.Warning("User và Role không thể đồng thời có giá trị");n.setResult(!1);return}if(i=this.Client.PostAsync(System.Boolean,this.SecurityEntity,"SharePermission"),t=1,i.isCompleted())continue;i["continue"](e);return;case 1:r=i.getAwaitedResult();u=r;u?Core.Extensions.Toast.Success("Đã tạo mới thành công"):Core.Extensions.Toast.Warning("Chia sẻ quyền hạn không thành công");this.SecurityEntity.RoleId=null;this.SecurityEntity.UserId=null;this.Parent.UpdateView();this.Dirty=!1;n.setResult(!0);return;default:n.setResult(null);return}}}catch(o){f=System.Exception.create(o);n.setException(f)}},arguments);return e(),n.task}}});Bridge.define("Core.Fw.Authentication.LoginBL",{inherits:[Core.Components.Forms.PopupEditor],statics:{fields:{_instance:null,_initApp:!1},props:{MenuComponent:null,TaskList:null,Instance:{get:function(){return Core.Fw.Authentication.LoginBL._instance==null&&(Core.Fw.Authentication.LoginBL._instance=new Core.Fw.Authentication.LoginBL),Core.Fw.Authentication.LoginBL._instance}}},methods:{InitFCM:function(n){var r,u,i,t;if(n===void 0&&(n=!1),System.Console.WriteLine("Init fcm"),r=Core.Clients.Client.Token.TenantCode.toUpperCase(),u=System.String.format("U{0:0000000}",[Bridge.box(Core.Clients.Client.Token.UserId,System.Int32)]),typeof PushNotification!="undefined"){if(i=["/topics/"+r+u],t=PushNotification.init({android:{senderID:"9681598079",topics:i},ios:{alert:"true",badge:"true",sound:"true",topics:i}}),n&&t.unregister){t.unregister();return}t.on("registration",function(){});t.on("notification",function(n){typeof cordova!="undefined"&&typeof cordova.plugins!="undefined"&&typeof cordova.plugins.notification!="undefined"&&cordova.plugins.notification.local.schedule({title:n.title,text:n.message,foreground:!0})});t.on("error",function(){})}},DiposeAll:function(){for(var n;Core.Components.Forms.TabEditor.Tabs.Count>0;)(n=Core.Components.Forms.TabEditor.Tabs.getItem(0))!=null?n.Dispose():null;Core.Fw.Authentication.LoginBL.MenuComponent!=null&&Core.Fw.Authentication.LoginBL.MenuComponent.Dispose();Core.Fw.Authentication.LoginBL.TaskList!=null&&Core.Fw.Authentication.LoginBL.TaskList.Dispose();Core.Fw.Authentication.LoginBL.MenuComponent=null;Core.Fw.Authentication.LoginBL.TaskList=null}}},fields:{_renderAwaiter:0},props:{LoginEntity:{get:function(){return Bridge.as(this.Entity,Core.ViewModels.LoginVM)}},SignedInHandler:null,InitAppHanlder:null,TokenRefreshedHandler:null},ctors:{ctor:function(){var n,t;this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"User");this.Entity=(n=new Core.ViewModels.LoginVM,n.CompanyName=(t=Core.Clients.LocalStorage.GetItem(System.String,"Tanent"),t!=null?t:"Softek"),n.AutoSignIn=!0,n);this.Name="Login";this.Title="Đăng nhập";window.addEventListener("beforeunload",function(){Core.Components.Forms.EditForm.NotificationClient!=null?Core.Components.Forms.EditForm.NotificationClient.Close():null});this.Public=!0}},methods:{Render:function(){var n=Core.Clients.Client.Token;n==null||System.DateTime.lte(n.RefreshTokenExp,Core.Clients.Client.EpsilonNow)?this.RenderLoginForm():System.DateTime.gt(n.AccessTokenExp,Core.Clients.Client.EpsilonNow)?this.InitAppIfEmpty():System.DateTime.gt(n.RefreshTokenExp,Core.Clients.Client.EpsilonNow)&&System.Threading.Tasks.Task.run(Bridge.fn.bind(this,function(){var n=0,t,r,i=new System.Threading.Tasks.TaskCompletionSource,u,f=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=Core.Clients.Client.RefreshToken(Bridge.fn.bind(this,function(){this.InitAppIfEmpty()})),n=1,t.isCompleted())continue;t["continue"](f);return;case 1:r=t.getAwaitedResult();i.setResult(r);return;default:i.setResult(null);return}}}catch(e){u=System.Exception.create(e);i.setException(u)}},arguments);return f(),i.task}))},RenderLoginForm:function(n){n===void 0&&(n="Login");window.clearTimeout(this._renderAwaiter);this._renderAwaiter=window.setTimeout(Bridge.fn.bind(this,function(){var n;if(this._backdrop!=null){document.body.appendChild(this._backdrop);Core.Extensions.HtmlElementExtension.Show(this._backdrop);return}this._backdrop=Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div,"modal is-open"),-1).Event$1("keypress",Bridge.fn.cacheBind(this,this.KeyCodeEnter)).GetContext();Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div,"modal-container").Button,"fa fa-times").Event("click",Bridge.fn.cacheBind(this,this.Dispose)).End.Div,"modal-left").H1,"modal-title"),"Welcome!").End.P,"modal-desc"),"Administrator management!").End.Div,"input-block").Label,"input-label"),"Company name").End.Input.Id("CompanyName").Event$1("input",Bridge.fn.bind(this,function(n){this.LoginEntity.CompanyName=Bridge.cast(n.target,HTMLInputElement).value})).Attr$1("name","CompanyName").Value(this.LoginEntity.CompanyName).Type$1("text").End.End.Div,"input-block").Label,"input-label"),"User name").End.Input.Event$1("input",Bridge.fn.bind(this,function(n){this.LoginEntity.UserName=Bridge.cast(n.target,HTMLInputElement).value})).Attr$1("name","UserName").Value(this.LoginEntity.UserName).Type$1("text").End.End.Div,"input-block").Label,"input-label"),"Password").End.Input.Event$1("input",Bridge.fn.bind(this,function(n){this.LoginEntity.Password=Bridge.cast(n.target,HTMLInputElement).value})).Attr$1("name","Password").Value(this.LoginEntity.Password).Type$1("password").End.End.Div,"input-block").Label,"input-label"),"Auto signin").End.Label,"checkbox input-small transition-on style2").Checkbox(this.LoginEntity.AutoSignIn).Event$1("input",Bridge.fn.bind(this,function(n){this.LoginEntity.AutoSignIn=Bridge.cast(n.target,HTMLInputElement).checked})).Attr$1("name","AutoSignIn").Attr$1("name","AutoSignIn").End.Span,"check myCheckbox").End.End.End.Div,"modal-buttons").A.Href(""),"Forgot your password?").End.Button.Id("btnLogin").Event("click",Bridge.fn.bind(this,function(){var n=0,t,r,i=Bridge.fn.bind(this,function(){for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(t=this.Login(this.LoginEntity),n=1,t.isCompleted())continue;t["continue"](i);return;case 1:r=t.getAwaitedResult();return;default:return}}},arguments);i()})),"input-button"),"Login").End.End.End.Div,"modal-right").Img.Src("../image/bg-launch.jpg").End.Render();(n=Bridge.as(this._backdrop.querySelector("#CompanyName"),HTMLInputElement))!=null?n.focus():null}),100)},KeyCodeEnter:function(n){switch(Core.Extensions.EventExt.KeyCode(n)){case Core.Enums.KeyCodeEnum.Enter:n.preventDefault();document.getElementById("btnLogin").click();break;case Core.Enums.KeyCodeEnum.Escape:this.Dispose()}},Login:function(n){var t=0,u,s,f,h,i=new System.Threading.Tasks.TaskCompletionSource,c,r,o,l,a,v,e=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1,2,3,4,5],t);switch(t){case 0:if(u=this.IsFormValid(),t=1,u.isCompleted())continue;u["continue"](e);return;case 1:if(s=u.getAwaitedResult(),c=s,!c){i.setResult(!1);return}n.RecoveryToken=Core.Extensions.Utils.GetUrlParam("recovery");r=null;t=2;continue;case 2:if(f=this.Client.CreateAsync(Core.ViewModels.Token,n,"SignIn?t="+(n.CompanyName||"")),t=3,f.isCompleted())continue;f["continue"](e);return;case 3:h=f.getAwaitedResult();r=h;t=5;continue;case 4:o=null;t=5;continue;case 5:n.AutoSignIn||(n.Password="");r==null?Core.Extensions.Toast.Warning("Tên đăng nhập hoặc mật khẩu không chính xác!"):(Core.Extensions.Toast.Success(System.String.format("Xin chào {0}!",[r.FullName])),Core.Clients.Client.Token=r,n.UserName="",Core.Clients.LocalStorage.SetItem(System.String,"Tanent",n.CompanyName),(l=Core.Components.Forms.EditForm.LayoutForm)!=null?l.UpdateView():null,Core.Fw.Authentication.LoginBL.InitFCM(),Bridge.staticEquals(a=this.SignedInHandler,null)?null:a(Core.Clients.Client.Token),Core.Clients.Client.SignOutEventHandler=function(){Core.Fw.Authentication.LoginBL.InitFCM(!1)},this.Dispose());(v=Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section,this,"Form"))!=null?v.UpdateView():null;i.setResult(!0);return;default:i.setResult(null);return}}}catch(y){if(o=System.Exception.create(y),t>=2&&t<=3){t=4;e();return}i.setException(o)}},arguments);return e(),i.task},ForgotPassword:function(n){var t=0,i,f,r=new System.Threading.Tasks.TaskCompletionSource,u,e,o=Bridge.fn.bind(this,function(){try{for(;;){t=System.Array.min([0,1],t);switch(t){case 0:if(i=this.Client.PostAsync(System.Nullable$1(System.Boolean),n,"ForgotPassword"),t=1,i.isCompleted())continue;i["continue"](o);return;case 1:f=i.getAwaitedResult();u=f;u!=null&&System.Nullable.getValue(u)?Core.Extensions.Toast.Success(System.String.format("A recovery email has been sent to your email address. Please check and follow the steps in the email!",null)):Core.Extensions.Toast.Warning("An error occurs. Please contact the administrator to get your password!");r.setResult(!0);return;default:r.setResult(null);return}}}catch(s){e=System.Exception.create(s);r.setException(e)}},arguments);return o(),r.task},InitAppIfEmpty:function(){var n,t,i;(Core.Clients.Client.SystemRole=Core.Clients.Client.Token.RoleIds.contains(Core.Enums.RoleEnum.System),(n=Core.Components.Forms.EditForm.LayoutForm)!=null?n.UpdateView():null,Core.Fw.Authentication.LoginBL._initApp||Core.Components.Forms.EditForm.Portal)||(Core.Fw.Authentication.LoginBL._initApp=!0,Bridge.staticEquals(t=this.InitAppHanlder,null)?null:t(Core.Clients.Client.Token),i=Core.Clients.Client.Token.UserId,Core.Components.Forms.EditForm.NotificationClient==null,Core.Fw.Authentication.LoginBL.MenuComponent==null&&Core.Fw.Menu.Instance.Render(),Core.Fw.Authentication.LoginBL.TaskList==null&&(Core.Fw.Authentication.LoginBL.TaskList=this.InitNotification(),Core.Fw.Authentication.LoginBL.TaskList.Render(),Core.Fw.Authentication.LoginBL.TaskList.DOMContentLoaded=Bridge.fn.combine(Core.Fw.Authentication.LoginBL.TaskList.DOMContentLoaded,function(){document.getElementById("name-user").textContent=Core.Clients.Client.Token.UserName;document.getElementById("Username-text").textContent=Core.Clients.Client.Token.FullName;document.getElementById("text-address").textContent=Core.Clients.Client.Token.Address;Core.MVVM.Html.Take$1("#user-image").Src("./image/"+(Core.Clients.Client.Token.Avatar||""));Core.MVVM.Html.Take$1("#img-detail").Src("./image/"+(Core.Clients.Client.Token.Avatar||""))})))},InitNotification:function(){return Core.Notifications.NotificationBL.Instance},Dispose:function(){Core.Extensions.HtmlElementExtension.Hide(this._backdrop)}}});Bridge.define("Core.Fw.Authentication.PolicyEditorBL",{inherits:[Core.Components.Forms.PopupEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"FeaturePolicy");this.Name="PolicyEditor";this.Title="Policy detail"}}});Bridge.define("Core.Fw.Setting.EntityDetailBL",{inherits:[Core.Components.Forms.PopupEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"Entity");this.Entity=new Core.Models.Entity;this.Name="Entity Detail";this.Title="Entity Detail"}}});Bridge.define("Core.Fw.Setting.GridPolicyDetailBL",{inherits:[Core.Components.Forms.PopupEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"GridPolicy");this.Entity=new Core.Models.GridPolicy;this.Name="GridDetail";this.Title="Grid Detail"}}});Bridge.define("Core.Fw.Setting.MasterDataDetailsBL",{inherits:[Core.Components.Forms.PopupEditor],props:{masEntity:{get:function(){return Bridge.as(this.Entity,Core.Models.MasterData)}}},ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"MasterData");this.Name="MasterData Detail";this.Title="MasterData Detail";this.Entity=new Core.Models.MasterData}}});Bridge.define("Core.Fw.Setting.RoleDetailBL",{inherits:[Core.Components.Forms.PopupEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"Role");this.Entity=new Core.Models.Role;this.Name="Role Detail";this.Title="Chi tiết loại quyền hạn"}}});Bridge.define("Core.Fw.User.ChangePasswordBL",{inherits:[Core.Components.Forms.PopupEditor],ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"User");this.Name="ChangePassword";this.Entity=new Core.ViewModels.UserProfileVM}},methods:{Save:function(){var n=0,t,f,i=new System.Threading.Tasks.TaskCompletionSource,r,u,e,o=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1],n);switch(n){case 0:if(r=Bridge.as(this.Entity,Core.ViewModels.UserProfileVM),Core.Extensions.ReflectionExt.ClearReferences(r),t=this.Client.UpdateAsync(System.Boolean,r,"UpdateProfile"),n=1,t.isCompleted())continue;t["continue"](o);return;case 1:f=t.getAwaitedResult();u=f;u?Core.Extensions.Toast.Success("Update profile succeeded!"):Core.Extensions.Toast.Warning("Update profile failed!");i.setResult(u);return;default:i.setResult(null);return}}}catch(s){e=System.Exception.create(s);i.setException(e)}},arguments);return o(),i.task}}});Bridge.define("Core.Fw.User.RegistrationBL",{inherits:[Core.Components.Forms.PopupEditor],props:{VM:{get:function(){return Bridge.as(this.Entity,Core.ViewModels.RegistrationVM)}}},ctors:{ctor:function(){this.$initialize();Core.Components.Forms.PopupEditor.ctor.call(this,"User");this.Entity=new Core.ViewModels.RegistrationVM;this.Name="Registration";this.Title=this.Name;this.Public=!0}},methods:{Register:function(){var n=0,i,f,r,e,t=new System.Threading.Tasks.TaskCompletionSource,o,s,h,u=Bridge.fn.bind(this,function(){try{for(;;){n=System.Array.min([0,1,2],n);switch(n){case 0:if(i=this.IsFormValid(),n=1,i.isCompleted())continue;i["continue"](u);return;case 1:if(f=i.getAwaitedResult(),o=f,!o){t.setResult(null);return}if(r=this.Client.PostAsync(System.Boolean,this.VM,"Register",!0),n=2,r.isCompleted())continue;r["continue"](u);return;case 2:e=r.getAwaitedResult();s=e;s&&this.ShowDialog();t.setResult(null);return;default:t.setResult(null);return}}}catch(c){h=System.Exception.create(c);t.setException(h)}},arguments);return u(),t.task},ShowDialog:function(){var n;this._confirm=(n=new Core.Components.Forms.ConfirmDialog,n.Content=(System.String.format("Bạn đã đăng ký thành công, 1 email đã được gởi vào địa chỉ {0}.<br />",[this.VM.Email])||"")+(System.String.format("Vui lòng kiểm tra email để xác nhận việc đăng ký.<br />",null)||"")+(System.String.format("Email gởi đến có thể nằm trong thùng rác.<br />",null)||"")+(System.String.format("Xin lưu ý, duyệt tài khoản của bạn có thể diễn ra trong 1 - 3 ngày làm việc.",null)||""),n);this._confirm.YesText="Đồng ý";this._confirm.YesConfirmed=Bridge.fn.combine(this._confirm.YesConfirmed,Bridge.fn.cacheBind(this,this.Dispose));this._confirm.Canceled=Bridge.fn.combine(this._confirm.Canceled,Bridge.fn.cacheBind(this,this.Dispose));this._confirm.IgnoreNoButton=!0;this._confirm.Render()},Dispose:function(){this._confirm!=null?this._confirm.Dispose():null;Core.Components.Forms.PopupEditor.prototype.Dispose.call(this)}}})});