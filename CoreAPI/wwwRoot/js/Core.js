/**
 * @version 1.0.0.0
 * @copyright Copyright Â©  2020
 * @compiler Bridge.NET 17.10.1
 */
Bridge.assembly("Core", function ($asm, globals) {
    "use strict";

    Bridge.define("Core.App", {
        main: function Main () {
            if (Core.Components.LangSelect.Culture == null) {
                Core.Components.LangSelect.Culture = "vi";
            }
            Core.Clients.Client.ExecTask(System.Boolean, Core.Components.LangSelect.Translate(), function (x) {
                Core.App.InitApp();
            });
        },
        statics: {
            methods: {
                InitApp: function () {
                    Core.Clients.Client.ModelNamespace = (Bridge.Reflection.getTypeNamespace(Core.Models.User) || "") + ".";
                    Core.Components.Spinner.Init();
                    Core.Components.Framework.LoginBL.Instance.Render();
                    Core.App.AlterDeviceScreen();
                },
                AlterDeviceScreen: function () {
                    var iPhone = new RegExp("(iPod|iPhone)").test(window.navigator.userAgent) && new RegExp("AppleWebKit").test(window.navigator.userAgent);
                    if (iPhone) {
                        var className = "iphone ";
                        if (window.screen.availHeight === 812 && window.screen.availWidth === 375) {
                            className = (className || "") + "portrait";
                        } else {
                            className = (className || "") + "landscape";
                        }
                        document.documentElement.className = className;
                    }
                },
                IsMobile: function () {
                    if (typeof(cordova) == 'undefined') {
                        return false;
                    }
                    return true;
                }
            }
        }
    });

    Bridge.define("Core.Clients.BadGatewayQueue", {
        fields: {
            _queue: null
        },
        props: {
            Count: {
                get: function () {
                    return this._queue.Count;
                }
            }
        },
        ctors: {
            init: function () {
                this._queue = new (System.Collections.Generic.Queue$1(Core.Clients.XHRWrapper)).ctor();
            }
        },
        methods: {
            Enqueue: function (options) {
                if (!options.NoQueue && options.Method !== Core.Enums.HttpMethod.GET) {
                    options.Retry = true;
                    this._queue.Enqueue(options);
                }
            },
            Dequeue: function () {
                return this._queue.Dequeue();
            },
            Peek: function () {
                return this._queue.Peek();
            }
        }
    });

    Bridge.define("Core.Clients.Client", {
        statics: {
            fields: {
                ErrorMessage: null,
                ModelNamespace: null,
                entities: null,
                token: null,
                GuidLength: 0,
                ConnKey: null,
                Tenant: null,
                Env: null,
                BadGatewayRequest: null,
                UnAuthorizedEventHandler: null,
                SignOutEventHandler: null,
                _instance: null
            },
            props: {
                EpsilonNow: {
                    get: function () {
                        return System.DateTimeOffset.Now.AddMinutes(1);
                    }
                },
                Host: {
                    get: function () {
                        return window.Host != null ? Bridge.toString(window.Host) : window.location.host;
                    }
                },
                Origin: {
                    get: function () {
                        return window.OriginLocation != null ? Bridge.toString(window.OriginLocation) : ((window.location.origin || "") + "/");
                    }
                },
                Prefix: {
                    get: function () {
                        return (Core.Clients.Client.Origin || "") + "api";
                    }
                },
                FileFTP: {
                    get: function () {
                        var $t;
                        return ($t = Bridge.as((Core.Extensions.Utils.HeadChildren.file != null ? Core.Extensions.Utils.HeadChildren.file.content : null), System.String), $t != null ? $t : "/user");
                    }
                },
                Config: {
                    get: function () {
                        var $t;
                        return ($t = Bridge.as((Core.Extensions.Utils.HeadChildren.config != null ? Core.Extensions.Utils.HeadChildren.config.content : null), System.String), $t != null ? $t : "");
                    }
                },
                Token: {
                    get: function () {
                        if (Core.Clients.Client.token == null) {
                            Core.Clients.Client.token = Core.Clients.LocalStorage.GetItem(Core.ViewModels.Token, "UserInfo");
                        }

                        return Core.Clients.Client.token;
                    },
                    set: function (value) {
                        Core.Clients.Client.token = value;
                        Core.Clients.LocalStorage.SetItem(Core.ViewModels.Token, "UserInfo", value);
                    }
                },
                Entities: {
                    get: function () {
                        if (Core.Clients.Client.entities != null) {
                            return Core.Clients.Client.entities;
                        }
                        return Core.Clients.LocalStorage.GetItem(System.Collections.Generic.Dictionary$2(System.String,Core.Models.Entity), "Entities");
                    },
                    set: function (value) {
                        Core.Clients.Client.entities = value;
                        Core.Clients.LocalStorage.SetItem(System.Collections.Generic.Dictionary$2(System.String,Core.Models.Entity), "Entities", value);
                    }
                },
                SystemRole: false,
                Instance: {
                    get: function () {
                        if (Core.Clients.Client._instance == null) {
                            Core.Clients.Client._instance = new Core.Clients.Client.ctor();
                        }
                        return Core.Clients.Client._instance;
                    }
                }
            },
            ctors: {
                init: function () {
                    var $t, $t1, $t2;
                    this.ErrorMessage = "H\u1ec7 th\u1ed1ng \u0111ang c\u1eadp nh\u1eadt vui l\u00f2ng ch\u1edd trong 30s!";
                    this.GuidLength = 36;
                    this.ConnKey = ($t = Bridge.as((Core.Extensions.Utils.HeadChildren.connKey != null ? Core.Extensions.Utils.HeadChildren.connKey.content : null), System.String), $t != null ? $t : "default");
                    this.Tenant = ($t1 = Bridge.as((Core.Extensions.Utils.HeadChildren.tenant != null ? Core.Extensions.Utils.HeadChildren.tenant.content : null), System.String), $t1 != null ? $t1 : "System");
                    this.Env = ($t2 = Bridge.as((Core.Extensions.Utils.HeadChildren.env != null ? Core.Extensions.Utils.HeadChildren.env.content : null), System.String), $t2 != null ? $t2 : "test");
                    this.BadGatewayRequest = new Core.Clients.BadGatewayQueue();
                }
            },
            methods: {
                CheckHasRole: function (role) {
                    if (Core.Clients.Client.Token == null) {
                        return false;
                    }

                    return System.Linq.Enumerable.from(Core.Clients.Client.Token.RoleNames, System.String).any(function (x) {
                            return System.String.indexOf(x, System.String.replaceAll(System.Enum.toString(Core.Enums.RoleEnum, role), "_", " "), 0, null, 5) >= 0;
                        });
                },
                CheckHasRole$1: function (roleNames, role) {
                    return System.Linq.Enumerable.from(roleNames, System.String).any(function (x) {
                            return System.String.indexOf(x, System.String.replaceAll(System.Enum.toString(Core.Enums.RoleEnum, role), "_", " "), 0, null, 5) >= 0;
                        });
                },
                CheckIsRole: function (roleName, role) {
                    return System.String.indexOf(roleName, System.String.replaceAll(System.Enum.toString(Core.Enums.RoleEnum, role), "_", " "), 0, null, 5) >= 0;
                },
                ApplyParameter: function (T, param) {
                    var propVal = System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Bridge.getType(param, T), 16, 28), System.Reflection.PropertyInfo).select(function (prop) {
                            return System.String.format("{0}={1}", prop.n, Bridge.Reflection.midel(prop.g, param)());
                        });
                    return Bridge.toArray(propVal).join("&");
                },
                ErrorHandler: function (T, options, tcs, xhr) {
                    var $t;
                    if (options.Retry) {
                        tcs.trySetResult(false);
                        return;
                    }
                    var exp;
                    try {
                        exp = Bridge.unbox(JSON.parse(xhr.responseText));
                        exp.StatusCode = xhr.status;
                    } catch ($e1) {
                        $e1 = System.Exception.create($e1);
                        exp = ($t = new Core.Clients.TmpException(), $t.Message = "\u0110\u00e3 c\u00f3 l\u1ed7i x\u1ea3y ra trong qu\u00e1 tr\u00ecnh x\u1eed l\u00fd", $t.StackTrace = xhr.responseText, $t);
                    }
                    if (!Bridge.staticEquals(options.ErrorHandler, null)) {
                        options.ErrorHandler(xhr);
                        tcs.trySetException(($t = new Core.Clients.HttpException.$ctor1(exp.Message), $t.XHR = xhr, $t));
                        return;
                    }
                    if (xhr.status >= Core.Enums.HttpStatusCode.BadRequest && xhr.status < Core.Enums.HttpStatusCode.InternalServerError) {
                        if (exp != null && !Core.Extensions.StringExt.IsNullOrWhiteSpace(exp.Message) && options.ShowError) {
                            Core.Extensions.Toast.Warning(exp.Message);
                        }
                        System.Console.WriteLine(exp);
                    } else if (xhr.status === Core.Enums.HttpStatusCode.InternalServerError || xhr.status === Core.Enums.HttpStatusCode.NotFound) {
                        System.Console.WriteLine(exp);
                    } else if (xhr.status === Core.Enums.HttpStatusCode.Unauthorized) {
                        !Bridge.staticEquals(Core.Clients.Client.UnAuthorizedEventHandler, null) ? Core.Clients.Client.UnAuthorizedEventHandler(options) : null;
                    } else if (xhr.status >= Core.Enums.HttpStatusCode.BadGateway || xhr.status === Core.Enums.HttpStatusCode.GatewayTimeout || xhr.status === Core.Enums.HttpStatusCode.ServiceUnavailable) {
                        if (options.ShowError) {
                            Core.Extensions.Toast.Warning("L\u1ed7i k\u1ebft n\u1ed1i t\u1edbi m\u00e1y ch\u1ee7, vui l\u00f2ng ch\u1edd trong gi\u00e2y l\u00e1t...");
                        }
                        if (!options.Retry) {
                            Core.Clients.Client.BadGatewayRequest.Enqueue(options);
                        }
                    } else {
                        if (!System.String.isNullOrWhiteSpace(xhr.responseText)) {
                            Core.Extensions.Toast.Warning(xhr.responseText);
                        }
                    }
                    tcs.trySetException(($t = new Core.Clients.HttpException.$ctor1(exp.Message), $t.XHR = xhr, $t));
                },
                ProcessSuccessRequest: function (T, options, tcs, xhr) {
                    if (options.Retry) {
                        tcs.trySetResult(true);
                        return;
                    }
                    if (Core.Extensions.StringExt.IsNullOrEmpty(xhr.responseText)) {
                        tcs.trySetResult(Bridge.getDefaultValue(T));
                        return;
                    }
                    if (!Bridge.staticEquals(options.CustomParser, null)) {
                        tcs.trySetResult(Bridge.unbox(options.CustomParser(xhr.response)));
                        return;
                    }
                    var type = T;
                    if (Core.Extensions.ReflectionExt.IsInt32(type)) {
                        tcs.trySetResult(Core.Extensions.Utils.TryParseInt(xhr.responseText));
                    } else if (Core.Extensions.ReflectionExt.IsDecimal(type)) {
                        tcs.trySetResult(Core.Extensions.Utils.TryParseDecimal(xhr.responseText));
                    } else if (Bridge.referenceEquals(T, System.String)) {
                        tcs.trySetResult(xhr.responseText);
                    } else if (Bridge.referenceEquals(T, Blob)) {
                        var result = null;
                        var blob = new Blob([xhr.response], xhr.responseType);
                        tcs.trySetResult(result);
                    } else {
                        try {
                            var parsed = Newtonsoft.Json.JsonConvert.DeserializeObject(xhr.responseText, T);
                            tcs.trySetResult(parsed);
                        } catch ($e1) {
                            $e1 = System.Exception.create($e1);
                            var jsonT = JSON.parse(xhr.responseText);
                            tcs.trySetResult(Bridge.unbox(System.Convert.changeType(jsonT, T)));
                        }
                    }
                },
                ClearCacheHeader: function (clearCache) {
                    var headers = new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor();
                    if (clearCache) {
                        headers.add("Pragma", "no-cache");
                        headers.add("Expires", "0");
                        headers.add("Last-Modified", System.DateTime.format(System.DateTime.getDefaultValue()));
                        headers.add("If-Modified-Since", System.DateTime.format(System.DateTime.getDefaultValue()));
                        headers.add("Cache-Control", "no-store, no-cache, must-revalidate, post-check=0, pre-check=0");
                    }

                    return headers;
                },
                LoadScript: function (src) {
                    var tcs = new System.Threading.Tasks.TaskCompletionSource();
                    var scriptExists = System.Linq.Enumerable.from(document.body.children, HTMLElement).where(function (x) {
                            return Bridge.is(x, HTMLScriptElement);
                        }).select(function (x) {{ return Bridge.cast(x, HTMLScriptElement); }}).any(function (x) {
                        return Bridge.referenceEquals(System.Linq.Enumerable.from(x.src.split("/"), System.String).lastOrDefault(null, null), System.Linq.Enumerable.from(src.split("/"), System.String).lastOrDefault(null, null));
                    });
                    if (scriptExists) {
                        tcs.setResult(true);
                        return tcs.task;
                    }
                    var script = document.createElement(System.Enum.toString(System.String, "script"));
                    script.src = src;
                    script.onload = Bridge.fn.combine(script.onload, function (e) {
                        tcs.setResult(true);
                    });
                    script.onerror = Bridge.fn.combine(script.onerror, function (message, url, lineNumber, columnNumber, error) {
                        tcs.setResult(true);
                        return false;
                    });
                    document.body.appendChild(script);
                    return tcs.task;
                },
                LoadLink: function (src) {
                    var tcs = new System.Threading.Tasks.TaskCompletionSource();
                    var scriptExists = System.Linq.Enumerable.from(document.head.children, HTMLElement).any(function (x) {
                            var styleElement;
                            return ((styleElement = Bridge.as(x, HTMLLinkElement))) != null && Bridge.referenceEquals(System.String.replaceAll(styleElement.href, document.location.origin, ""), src);
                        });
                    if (scriptExists) {
                        tcs.setResult(true);
                        return tcs.task;
                    }
                    var link = document.createElement(System.Enum.toString(System.String, "style"));
                    link.href = src;
                    link.onload = Bridge.fn.combine(link.onload, function (e) {
                        tcs.setResult(true);
                    });
                    link.onerror = Bridge.fn.combine(link.onerror, function (message, url, lineNumber, columnNumber, error) {
                        tcs.setResult(true);
                        return false;
                    });
                    document.head.appendChild(link);
                    return tcs.task;
                },
                RefreshToken: function (success) {
                    if (success === void 0) { success = null; }
                    var tcs = new System.Threading.Tasks.TaskCompletionSource();
                    var oldToken = Core.Clients.Client.Token;
                    if (oldToken == null || System.DateTimeOffset.op_LessThanOrEqual(oldToken.RefreshTokenExp.$clone(), Core.Clients.Client.EpsilonNow.$clone())) {
                        return System.Threading.Tasks.Task.fromResult(null, Core.ViewModels.Token);
                    }
                    if (System.DateTimeOffset.op_GreaterThan(oldToken.AccessTokenExp.$clone(), Core.Clients.Client.EpsilonNow.$clone())) {
                        return System.Threading.Tasks.Task.fromResult(oldToken, Core.ViewModels.Token);
                    }
                    if (System.DateTimeOffset.op_LessThanOrEqual(oldToken.AccessTokenExp.$clone(), Core.Clients.Client.EpsilonNow.$clone()) && System.DateTimeOffset.op_GreaterThan(oldToken.RefreshTokenExp.$clone(), Core.Clients.Client.EpsilonNow.$clone())) {
                        Core.Extensions.EventExt.Catch(Core.Extensions.EventExt.Done$1(Core.ViewModels.Token, Core.Clients.Client.GetToken(oldToken), function (newToken) {
                            if (newToken != null) {
                                Core.Clients.Client.Token = newToken;
                                !Bridge.staticEquals(success, null) ? success(newToken) : null;
                            }
                            tcs.trySetResult(newToken);
                        }), function (e) {
                            tcs.trySetException(e);
                        });
                    }
                    return tcs.task;
                },
                GetToken: function (oldToken) {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        newToken, 
                        $t, 
                        $t1, 
                        $t2, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Clients.Client.Instance.SubmitAsync(Core.ViewModels.Token, ($t = new Core.Clients.XHRWrapper(), $t.NoQueue = true, $t.Url = System.String.format("/user/Refresh?t={0}", [($t1 = Core.Clients.Client.Token.TenantCode, $t1 != null ? $t1 : Core.Clients.Client.Tenant)]), $t.Method = Core.Enums.HttpMethod.POST, $t.Value = ($t2 = new Core.ViewModels.RefreshVM(), $t2.AccessToken = oldToken.AccessToken, $t2.RefreshToken = oldToken.RefreshToken, $t2), $t.AllowAnonymous = true, $t.ErrorHandler = function (xhr) {
                                                if (xhr.status === Core.Enums.HttpStatusCode.BadRequest) {
                                                    Core.Clients.Client.Token = null;
                                                    Core.Extensions.Toast.Warning("Phi\u00ean truy c\u1eadp \u0111\u00e3 h\u1ebft h\u1ea1n! Vui l\u00f2ng ch\u1edd trong gi\u00e2y l\u00e1t, h\u1ec7 th\u1ed1ng \u0111ang t\u1ea3i l\u1ea1i trang");
                                                    window.location.reload();
                                                }
                                            }, $t));
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            newToken = $taskResult1;
                                            $tcs.setResult(newToken);
                                            return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                },
                Download: function (path) {
                    var $t;
                    var removePath = Core.Clients.Client.RemoveGuid(path);
                    var a = ($t = document.createElement("a"), $t.href = System.String.contains(path,"http") ? path : System.IO.Path.Combine([Core.Clients.Client.Origin, path]), $t.target = "_blank", $t);
                    a.setAttribute("download", removePath);
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                },
                RemoveGuid: function (path) {
                    var thumbText = path;
                    if (path.length > Core.Clients.Client.GuidLength) {
                        var fileName = System.IO.Path.GetFileNameWithoutExtension(path);
                        thumbText = (Core.Extensions.StringExt.SubStrIndex$1(fileName, 0, ((fileName.length - Core.Clients.Client.GuidLength) | 0)) || "") + (System.IO.Path.GetExtension(path) || "");
                    }
                    return thumbText;
                },
                ToPromise: function (T, task) {
                    if (task == null) {
                        return null;
                    }
                    return new Promise((resolve, reject) => {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $returnValue, 
                        t, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            if (task == null) {
                                                resolve(null);
                                                return;
                                            }
                                            $task1 = task;
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            t = $taskResult1;
                                            resolve(t);
                                            return;
                                        }
                                        default: {
                                            resolve(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                reject($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    });
                    return null;
                },
                ToPromiseNoResult: function (task) {
                    if (task == null) {
                        return null;
                    }
                    return new Promise((resolve, reject) => {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $returnValue, 
                        t, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            if (task == null) {
                                                resolve(null);
                                                return;
                                            }
                                            $task1 = task;
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            t = $taskResult1;
                                            resolve(t);
                                            return;
                                        }
                                        default: {
                                            resolve(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                reject($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    });
                    return null;
                },
                ExecTask: function (T, task, handler, errorHandler) {
                    if (handler === void 0) { handler = null; }
                    if (errorHandler === void 0) { errorHandler = null; }
                    var promise = Core.Clients.Client.ToPromise(T, task);
                    promise.then(handler).catch(errorHandler);
                },
                ExecTaskNoResult: function (task, handler, errorHandler) {
                    if (handler === void 0) { handler = null; }
                    if (errorHandler === void 0) { errorHandler = null; }
                    var promise = Core.Clients.Client.ToPromiseNoResult(task);
                    promise.then(handler).catch(errorHandler);
                }
            }
        },
        fields: {
            _nameSpace: null,
            _config: false
        },
        props: {
            NameSpace: {
                get: function () {
                    return Core.Extensions.StringExt.IsNullOrEmpty(this._nameSpace) ? Core.Clients.Client.ModelNamespace : this._nameSpace;
                }
            },
            CustomPrefix: null,
            EntityName: null,
            FileName: null,
            FileType: null
        },
        ctors: {
            init: function () {
                var $t;
                this.CustomPrefix = ($t = System.Linq.Enumerable.from(document.head.children, HTMLElement).where(function (x) {
                            return Bridge.is(x, HTMLMetaElement);
                        }).select(function (x) {{ return Bridge.cast(x, HTMLMetaElement); }}).firstOrDefault(function (x) {
                            var meta;
                            return ((meta = x)) != null && Bridge.referenceEquals(meta.name, "prefix");
                        }, null)) != null ? $t.content : null;
            },
            ctor: function () {
                this.$initialize();

            },
            $ctor1: function (entityName, ns, config) {
                if (ns === void 0) { ns = ""; }
                if (config === void 0) { config = false; }

                this.$initialize();
                this._nameSpace = ns;
                this._config = config;
                if (Core.Extensions.StringExt.HasAnyChar(this._nameSpace) && System.Linq.Enumerable.from(this._nameSpace, System.Char).last() !== 46) {
                    this._nameSpace = (this._nameSpace || "") + String.fromCharCode(46);
                }
                this.EntityName = entityName;
            }
        },
        methods: {
            ComQuery: function (vm) {
                var $t;
                return this.SubmitAsync(System.Array.type(System.Array.type(System.Object)), ($t = new Core.Clients.XHRWrapper(), $t.Value = JSON.stringify(vm), $t.Url = Core.Extensions.Utils.ComQuery, $t.IsRawString = true, $t.Method = Core.Enums.HttpMethod.POST, $t));
            },
            GetIds: function (sqlVm) {
                var $t;
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                sqlVm.Select = "ds.Id";
                sqlVm.Count = false;
                sqlVm.SkipXQuery = true;
                Core.Extensions.EventExt.Catch(Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), this.SubmitAsync(System.Array.type(System.Array.type(System.Object)), ($t = new Core.Clients.XHRWrapper(), $t.Url = Core.Extensions.Utils.ComQuery, $t.Value = JSON.stringify(sqlVm), $t.IsRawString = true, $t.Method = Core.Enums.HttpMethod.POST, $t)), function (ds) {
                    var res = ds.length === 0 || ds[System.Array.index(0, ds)].length === 0 ? System.Array.init([], System.String) : System.Linq.Enumerable.from(ds[System.Array.index(0, ds)], System.Object).select(function (x) {
                            return Bridge.as(x.Id, System.String);
                        }).ToArray(System.String);
                    tcs.trySetResult(res);
                }), function (e) {
                    tcs.trySetException(e);
                });
                return tcs.task;
            },
            SubmitAsync: function (T, options) {
                var $t, $t1, $t2;
                this.CustomPrefix = this._config ? Core.Clients.Client.Config : this.CustomPrefix;
                var isNotFormData = options.FormData == null;
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                var xhr = new XMLHttpRequest();
                if (options.Headers == null && options.FormData == null) {
                    options.Headers = function (_o1) {
                            _o1.add("content-type", "application/json");
                            return _o1;
                        }(new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor());
                }
                if (Core.Extensions.StringExt.HasAnyChar(options.Url) && options.Url.charCodeAt(0) === 47) {
                    options.Url = options.Url.substr(1);
                }

                if (options.FinalUrl == null) {
                    var url = options.Url;
                    var tenant = Core.Extensions.Utils.GetUrlParam(Core.Extensions.Utils.TenantField);
                    if (Core.Extensions.StringExt.IsNullOrEmpty(tenant)) {
                        tenant = Core.Clients.Client.Tenant;
                    }
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(Core.Extensions.Utils.GetUrlParam(Core.Extensions.Utils.TenantField, options.Url)) && Core.Clients.Client.Token == null && options.AddTenant) {
                        var tenantQuery = "t=" + ((($t = tenant, $t != null ? $t : "wr1")) || "");
                        url = (url || "") + ((System.String.contains(url,Core.Extensions.Utils.QuestionMark) ? "&" + (tenantQuery || "") : ((Core.Extensions.Utils.QuestionMark || "") + (tenantQuery || ""))) || "");
                    }
                    options.FinalUrl = encodeURI(System.IO.Path.Combine([($t1 = this.CustomPrefix, $t1 != null ? $t1 : Core.Clients.Client.Prefix), this.EntityName, url]));
                }
                xhr.open(System.Enum.toString(Core.Enums.HttpMethod, options.Method), options.FinalUrl, true);
                Core.Extensions.IEnumerableExtensions.SelectForEach(System.Collections.Generic.KeyValuePair$2(System.String,System.String), options.Headers, function (x) {
                    xhr.setRequestHeader(x.key, x.value);
                });
                if (!options.AllowAnonymous) {
                    xhr.setRequestHeader(Core.Extensions.Utils.Authorization, "Bearer " + ((($t2 = Core.Clients.Client.Token) != null ? $t2.AccessToken : null) || ""));
                }

                xhr.onreadystatechange = Bridge.fn.combine(xhr.onreadystatechange, function () {
                    if (xhr.readyState !== 4) {
                        return;
                    }

                    if (xhr.status >= Core.Enums.HttpStatusCode.OK && xhr.status < Core.Enums.HttpStatusCode.MultipleChoices) {
                        Core.Clients.Client.ProcessSuccessRequest(T, options, tcs, xhr);
                    } else {
                        Core.Clients.Client.ErrorHandler(T, options, tcs, xhr);
                    }
                });
                if (!Bridge.staticEquals(options.ProgressHandler, null)) {
                    xhr.addEventListener("progress", options.ProgressHandler);
                }
                if (isNotFormData) {
                    xhr.send(options.JsonData);
                } else {
                    xhr.send(options.FormData);
                }
                return tcs.task;
            },
            FirstOrDefaultAsync: function (T, filter, clearCache, addTenant) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    headers, 
                    res, 
                    $t, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        if (filter === void 0) { filter = null; }
                                        if (clearCache === void 0) { clearCache = false; }
                                        if (addTenant === void 0) { addTenant = false; }
                                        filter = Core.Extensions.OdataExt.ApplyClause(filter, Bridge.toString((1)), Core.Extensions.OdataExt.TopKeyword);
                                        this.EntityName = Bridge.Reflection.getTypeName(T);
                                        headers = Core.Clients.Client.ClearCacheHeader(clearCache);
                                        $task1 = this.SubmitAsync(Core.Models.OdataResult$1(T), ($t = new Core.Clients.XHRWrapper(), $t.Value = null, $t.AddTenant = addTenant, $t.Url = filter, $t.Headers = headers, $t.Method = Core.Enums.HttpMethod.GET, $t));
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        res = $taskResult1;
                                        $tcs.setResult(res != null && ($t = res.Value) != null ? System.Linq.Enumerable.from($t, T).firstOrDefault(null, null) : null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            GetByIdAsync: function (table, connKey, ids) {
                var $t, $t1;
                if (ids === void 0) { ids = []; }
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(table) || Core.Extensions.IEnumerableExtensions.Nothing(System.String, ids)) {
                    return System.Threading.Tasks.Task.fromResult(null, System.Array.type(System.Object));
                }
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                var vm = ($t = new Core.ViewModels.SqlViewModel(), $t.Params = JSON.stringify(new $asm.$AnonymousType$1(table, ids)), $t.ComId = "Entity", $t.Action = "ById", $t.ConnKey = ($t1 = connKey, $t1 != null ? $t1 : Core.Clients.Client.ConnKey), $t);
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), this.SubmitAsync(System.Array.type(System.Array.type(System.Object)), ($t = new Core.Clients.XHRWrapper(), $t.Value = JSON.stringify(vm), $t.IsRawString = true, $t.Method = Core.Enums.HttpMethod.POST, $t.Url = Core.Extensions.Utils.UserSvc, $t.Headers = function (_o1) {
                        _o1.add("content-type", "application/json");
                        return _o1;
                    }(new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor()), $t)), function (ds) {
                    tcs.trySetResult(ds.length > 0 ? ds[System.Array.index(0, ds)] : null);
                });
                return tcs.task;
            },
            PostAsync: function (T, value, subUrl, annonymous, allowNested) {
                var $t;
                if (subUrl === void 0) { subUrl = ""; }
                if (annonymous === void 0) { annonymous = false; }
                if (allowNested === void 0) { allowNested = false; }
                return this.SubmitAsync(T, ($t = new Core.Clients.XHRWrapper(), $t.Value = value, $t.Url = subUrl, $t.Method = Core.Enums.HttpMethod.POST, $t.AllowAnonymous = annonymous, $t));
            },
            PatchAsync: function (value, errHandler, annonymous) {
                var $t;
                if (errHandler === void 0) { errHandler = null; }
                if (annonymous === void 0) { annonymous = false; }
                return this.SubmitAsync(System.Int32, ($t = new Core.Clients.XHRWrapper(), $t.Value = JSON.stringify(value), $t.IsRawString = true, $t.Url = Core.Extensions.Utils.PatchSvc, $t.Headers = function (_o1) {
                        _o1.add("Content-type", "application/json");
                        return _o1;
                    }(new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor()), $t.Method = Core.Enums.HttpMethod.PATCH, $t.AllowAnonymous = annonymous, $t.ErrorHandler = errHandler, $t));
            },
            PostFilesAsync: function (T, file, url, progressHandler) {
                var $t;
                if (url === void 0) { url = ""; }
                if (progressHandler === void 0) { progressHandler = null; }
                var formData = new FormData();
                formData.append("file", file);
                this.CustomPrefix = Core.Clients.Client.FileFTP;
                return this.SubmitAsync(T, ($t = new Core.Clients.XHRWrapper(), $t.FormData = formData, $t.File = file, $t.ProgressHandler = progressHandler, $t.Method = Core.Enums.HttpMethod.POST, $t.Url = url, $t));
            },
            SendMail: function (email) {
                var $t;
                return this.SubmitAsync(System.Boolean, ($t = new Core.Clients.XHRWrapper(), $t.Value = email, $t.Method = Core.Enums.HttpMethod.POST, $t.Url = "Email", $t));
            },
            DeactivateAsync: function (ids, table, connKey) {
                var $t, $t1;
                var vm = ($t = new Core.ViewModels.SqlViewModel(), $t.Ids = ids, $t.Params = table, $t.ConnKey = ($t1 = connKey, $t1 != null ? $t1 : Core.Clients.Client.ConnKey), $t);
                return this.SubmitAsync(System.Array.type(System.String), ($t = new Core.Clients.XHRWrapper(), $t.Url = Core.Extensions.Utils.DeactivateSvc, $t.Value = JSON.stringify(vm), $t.Method = Core.Enums.HttpMethod.DELETE, $t.IsRawString = true, $t.Headers = function (_o1) {
                        _o1.add("content-type", "application/json");
                        return _o1;
                    }(new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor()), $t));
            },
            HardDeleteAsync: function (ids, table, connKey) {
                var $t, $t1;
                if (connKey === void 0) { connKey = null; }
                var vm = ($t = new Core.ViewModels.SqlViewModel(), $t.ComId = table, $t.Action = "HardDelete", $t.Ids = ids, $t.ConnKey = ($t1 = connKey, $t1 != null ? $t1 : Core.Clients.Client.ConnKey), $t);
                return this.SubmitAsync(System.Array.type(System.String), ($t = new Core.Clients.XHRWrapper(), $t.Url = Core.Extensions.Utils.UserSvc, $t.Value = JSON.stringify(vm), $t.Method = Core.Enums.HttpMethod.POST, $t.IsRawString = true, $t.Headers = function (_o1) {
                        _o1.add("content-type", "application/json");
                        return _o1;
                    }(new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor()), $t));
            },
            HardDeleteAsync$1: function (strings, entityName, connKey) {
                throw new System.NotImplementedException.ctor();
            }
        }
    });

    Bridge.define("$AnonymousType$1", $asm, {
        $kind: "anonymous",
        ctors: {
            ctor: function (table, ids) {
                this.Table = table;
                this.Ids = ids;
            }
        },
        methods: {
            equals: function (o) {
                if (!Bridge.is(o, $asm.$AnonymousType$1)) {
                    return false;
                }
                return Bridge.equals(this.Table, o.Table) && Bridge.equals(this.Ids, o.Ids);
            },
            getHashCode: function () {
                var h = Bridge.addHash([7550196186, this.Table, this.Ids]);
                return h;
            },
            toJSON: function () {
                return {
                    Table : this.Table,
                    Ids : this.Ids
                };
            }
        },
        statics : {
            methods: {
                $metadata : function () { return {"m":[{"a":2,"n":"Ids","t":16,"rt":System.Array.type(System.String),"g":{"a":2,"n":"get_Ids","t":8,"rt":System.Array.type(System.String),"fg":"Ids"},"fn":"Ids"},{"a":2,"n":"Table","t":16,"rt":System.String,"g":{"a":2,"n":"get_Table","t":8,"rt":System.String,"fg":"Table"},"fn":"Table"}]}; }
            }
        }
    });

    Bridge.define("Core.Clients.HttpException", {
        inherits: [System.Exception],
        props: {
            XHR: null,
            StatusCode: {
                get: function () {
                    return this.XHR.status;
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                System.Exception.ctor.call(this);
            },
            $ctor1: function (message) {
                this.$initialize();
                System.Exception.ctor.call(this, message);
            },
            $ctor2: function (message, innerException) {
                this.$initialize();
                System.Exception.ctor.call(this, message, innerException);
            }
        }
    });

    Bridge.define("Core.Clients.LocalStorage", {
        statics: {
            fields: {
                _hasRegisteredCrossTab: false,
                StorageEventMap: null
            },
            props: {
                Instance: {
                    get: function () {
                        return window.localStorage;
                    }
                }
            },
            ctors: {
                init: function () {
                    this.StorageEventMap = new (System.Collections.Generic.Dictionary$2(System.String,System.Collections.Generic.List$1(Function))).ctor();
                }
            },
            methods: {
                Subscribe: function (key, action, type, croosTab) {
                    if (croosTab === void 0) { croosTab = true; }
                    var localActions = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, System.Collections.Generic.List$1(Function), Core.Clients.LocalStorage.StorageEventMap, key);
                    localActions.add(action);
                    if (!croosTab || Core.Clients.LocalStorage._hasRegisteredCrossTab) {
                        return;
                    }
                    Core.Clients.LocalStorage._hasRegisteredCrossTab = true;
                    window.addEventListener("storage", function (e) {
                        var $t;
                        var eventKey = ($t = e.key) != null ? Bridge.toString($t) : null;
                        if (!Bridge.referenceEquals(eventKey, key)) {
                            return;
                        }
                        var actions = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, System.Collections.Generic.List$1(Function), Core.Clients.LocalStorage.StorageEventMap, key);
                        if (Core.Extensions.IEnumerableExtensions.Nothing(Function, actions)) {
                            return;
                        }
                        var newVal = Bridge.as(e.newValue, System.String);
                        var oldVal = Bridge.as(e.oldValue, System.String);
                        actions != null ? actions.ForEach(function (x) {
                                x(key, Newtonsoft.Json.JsonConvert.DeserializeObject(newVal, type), Newtonsoft.Json.JsonConvert.DeserializeObject(oldVal, type));
                            }) : null;
                    });
                },
                Ubsubscribe: function (key, action) {
                    var actions = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, System.Collections.Generic.List$1(Function), Core.Clients.LocalStorage.StorageEventMap, key);
                    actions.remove(action);
                },
                SetItem: function (T, key, val) {
                    if (val == null) {
                        Core.Clients.LocalStorage.Instance.setItem(key, null);
                    } else {
                        Core.Clients.LocalStorage.Instance.setItem(key, Bridge.referenceEquals(T, System.String) ? Bridge.toString(val) : Newtonsoft.Json.JsonConvert.SerializeObject(val));
                    }
                    var localActions = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, System.Collections.Generic.List$1(Function), Core.Clients.LocalStorage.StorageEventMap, key);
                    localActions != null ? localActions.ForEach(function (x) {
                            x(key, val, Core.Clients.LocalStorage.GetItem(T, key));
                        }) : null;
                },
                GetItem: function (T, key) {
                    if (Bridge.referenceEquals(T, System.String)) {
                        return Bridge.cast(Bridge.unbox(Core.Clients.LocalStorage.Instance.getItem(key), T), T);
                    }
                    var data = Bridge.as(Core.Clients.LocalStorage.Instance.getItem(key), System.String);
                    return data == null ? Bridge.getDefaultValue(T) : Newtonsoft.Json.JsonConvert.DeserializeObject(data, T);
                },
                RemoveItem: function (key) {
                    Core.Clients.LocalStorage.Instance.removeItem(key);
                }
            }
        }
    });

    Bridge.define("Core.Clients.TmpException", {
        props: {
            StatusCode: 0,
            Message: null,
            StackTrace: null,
            InnerException: null
        }
    });

    Bridge.define("Core.Clients.WebSocketClient", {
        fields: {
            _socket: null,
            deviceKey: null
        },
        ctors: {
            ctor: function (url) {
                this.$initialize();
                var wsUri = (System.String.format("wss://{0}/{1}?access_token=", Core.Clients.Client.Host, url) || "") + (Core.Clients.Client.Token.AccessToken || "");
                this._socket = new WebSocket(wsUri);
                this._socket.onopen = Bridge.fn.combine(this._socket.onopen, function (e) {
                    System.Console.WriteLine(System.String.format("Socket opened", e));
                });

                this._socket.onclose = Bridge.fn.combine(this._socket.onclose, function (e) {
                    System.Console.WriteLine(System.String.format("Socket closed", e));
                });

                this._socket.onerror = Bridge.fn.combine(this._socket.onerror, function (e) {
                    System.Console.WriteLine(e);
                });

                this._socket.onmessage = Bridge.fn.combine(this._socket.onmessage, Bridge.fn.bind(this, function (e) {
                    var $t;
                    var responseStr = Bridge.toString(e.data);
                    var objRs = Core.Extensions.Utils.Parse(Core.Models.MQEvent, responseStr);
                    if (objRs == null) {
                        this.deviceKey = responseStr;
                        return;
                    }
                    var queueName = objRs.QueueName;
                    window.dispatchEvent(new CustomEvent(objRs.QueueName, ($t = new Object(), $t.detail = objRs, $t)));
                }));
                this._socket.binaryType = "arraybuffer";
            }
        },
        methods: {
            Send: function (message) {
                this._socket.send(message);
            },
            Close: function () {
                this._socket.close();
            }
        }
    });

    Bridge.define("Core.Clients.XHRWrapper", {
        statics: {
            methods: {
                UnboxValue: function (val) {
                    if (val == null) {
                        return null;
                    }
                    var res = { };
                    for (let key in val) {
                        if (key == null || key[0] === '$') continue;
                        if (val[key] !== null && val[key] !== undefined
                            && Core.Extensions.ReflectionExt.IsSimple(Bridge.getType(val[key]))) {
                            res[key] = val[key];
                        }
                    }
                    return res;
                }
            }
        },
        props: {
            AllowNested: false,
            NoQueue: false,
            Retry: false,
            ShowError: false,
            AllowAnonymous: false,
            AddTenant: false,
            Method: 0,
            Url: null,
            NameSpace: null,
            Prefix: null,
            EntityName: null,
            FinalUrl: null,
            ResponseMimeType: null,
            Value: null,
            IsRawString: false,
            JsonData: {
                get: function () {
                    if (this.Value == null) {
                        return null;
                    }
                    var val;
                    if (this.IsRawString && ((val = Bridge.as(this.Value, System.String))) != null) {
                        return val;
                    }

                    return Newtonsoft.Json.JsonConvert.SerializeObject(this.AllowNested ? this.Value : Core.Clients.XHRWrapper.UnboxValue(this.Value));
                }
            },
            FormData: null,
            File: null,
            ProgressHandler: null,
            Headers: null,
            CustomParser: null,
            ErrorHandler: null
        },
        ctors: {
            init: function () {
                this.ShowError = true;
                this.Method = Core.Enums.HttpMethod.GET;
            }
        }
    });

    Bridge.define("Core.Components.EditableComponent", {
        statics: {
            fields: {
                IdField: null,
                SmallScreen: 0,
                ExSmallScreen: 0,
                MediumScreen: 0,
                LargeScreen: 0,
                ExLargeScreen: 0,
                RequiredRule: null
            },
            props: {
                IsSmallUp: {
                    get: function () {
                        return document.documentElement.clientWidth > Core.Components.EditableComponent.SmallScreen;
                    }
                },
                IsMediumUp: {
                    get: function () {
                        return document.documentElement.clientWidth > Core.Components.EditableComponent.MediumScreen;
                    }
                },
                IsLargeUp: {
                    get: function () {
                        return document.documentElement.clientWidth > Core.Components.EditableComponent.LargeScreen;
                    }
                }
            },
            ctors: {
                init: function () {
                    var $t;
                    this.IdField = "Id";
                    this.SmallScreen = 768;
                    this.ExSmallScreen = 567;
                    this.MediumScreen = 992;
                    this.LargeScreen = 1200;
                    this.ExLargeScreen = 1452;
                    this.RequiredRule = ($t = new Core.Extensions.ValidationRule(), $t.Rule = Core.Extensions.ValidationRule.Required, $t.Message = "{0} kh\u00f4ng \u0111\u01b0\u1ee3c \u0111\u1ec3 tr\u1ed1ng!", $t);
                }
            },
            methods: {
                FocusElement: function (nextElement) {
                    nextElement.ParentElement.focus();
                    nextElement.Focus();
                    var html;
                    if (((html = Bridge.as(nextElement.Element, HTMLInputElement))) != null) {
                        html.selectionStart = 0;
                        html.selectionEnd = nextElement.GetValueText().length;
                    } else {
                        var htmlArea;
                        if (((htmlArea = Bridge.as(nextElement.Element, HTMLTextAreaElement))) != null) {
                            htmlArea.selectionStart = 0;
                            htmlArea.selectionEnd = nextElement.GetValueText().length;
                        }
                    }
                }
            }
        },
        fields: {
            idGuid: null,
            _show: false,
            OnToggle: null,
            editForm: null,
            rootTab: null,
            emptyRow: null,
            _updateViewAwaiter: 0,
            _dirty: false,
            _disabled: false,
            _setDirty: false
        },
        events: {
            Disposed: null
        },
        props: {
            Id: null,
            FieldName: {
                get: function () {
                    var $t;
                    return ($t = this.GuiInfo) != null ? $t.FieldName : null;
                },
                set: function (value) {
                    if (this.GuiInfo != null) {
                        this.GuiInfo.FieldName = value;
                    }
                }
            },
            Label: {
                get: function () {
                    var $t;
                    return ($t = this.GuiInfo) != null ? $t.Label : null;
                },
                set: function (value) {
                    if (this.GuiInfo != null) {
                        this.GuiInfo.Label = value;
                    }
                }
            },
            ComponentType: null,
            Name: null,
            Parent: null,
            GuiInfo: null,
            Children: null,
            FirstChild: {
                get: function () {
                    return System.Linq.Enumerable.from(this.Children, Core.Components.EditableComponent).firstOrDefault(null, null);
                }
            },
            /**
             * The root element of tab or popup
             *
             * @instance
             * @public
             * @memberof Core.Components.EditableComponent
             * @function ParentElement
             * @type HTMLElement
             */
            ParentElement: null,
            Element: null,
            DOMContentLoaded: null,
            ConnKey: {
                get: function () {
                    return this.GuiInfo != null && Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.ConnKey) ? Core.Clients.Client.ConnKey : this.GuiInfo.ConnKey;
                }
            },
            EntityId: {
                get: function () {
                    var $t;
                    return ($t = this.Entity) != null && $t[Core.Components.EditableComponent.IdField] != null ? Bridge.toString($t[Core.Components.EditableComponent.IdField]) : null;
                },
                set: function (value) {
                    if (this.Entity != null) {
                        this.Entity[Core.Components.EditableComponent.IdField] = value;
                    }
                }
            },
            Entity: null,
            IsSingleton: false,
            EmptyRow: {
                get: function () {
                    var $t;
                    if (this.emptyRow == null) {
                        this.emptyRow = ($t = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem, this)) != null ? $t.EmptyRow : null;
                    }
                    return System.Nullable.getValue(this.emptyRow);
                },
                set: function (value) {
                    this.emptyRow = value;
                }
            },
            Show: {
                get: function () {
                    return this._show;
                },
                set: function (value) {
                    this.Toggle(value);
                }
            },
            /**
             * The root tab of all component
             *
             * @instance
             * @public
             * @memberof Core.Components.EditableComponent
             * @function TabEditor
             * @type Core.Components.Forms.TabEditor
             */
            TabEditor: {
                get: function () {
                    return this.rootTab || Core.Components.Extensions.ComponentExt.FindClosest$1(Core.Components.Forms.TabEditor, this, function (x) {
                        return !x.Popup;
                    });
                },
                set: function (value) {
                    this.rootTab = value;
                }
            },
            /**
             * Current form
             *
             * @instance
             * @public
             * @memberof Core.Components.EditableComponent
             * @function EditForm
             * @type Core.Components.Forms.EditForm
             */
            EditForm: {
                get: function () {
                    return this.editForm || Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, this);
                },
                set: function (value) {
                    this.editForm = value;
                }
            },
            UserInput: null,
            AlwaysLogHistory: false,
            OldValue: null,
            ValidationResult: null,
            ClassName: {
                get: function () {
                    return this.Element.className;
                },
                set: function (value) {
                    this.Element.className = value;
                }
            },
            StopChildrenHistory: false,
            ValidationRules: null,
            Disabled: {
                get: function () {
                    return this._disabled;
                },
                set: function (value) {
                    var $t;
                    this._disabled = value;
                    this.SetDisableUI(value);
                    ($t = this.Children) != null ? $t.ForEach(function (x) {
                            var editable;
                            if (((editable = x)) != null) {
                                editable.Disabled = value;
                            }
                        }) : null;
                }
            },
            /**
             * This flag is populated to all parent if it is dirty
             *
             * @instance
             * @public
             * @memberof Core.Components.EditableComponent
             * @function Dirty
             * @type boolean
             */
            Dirty: {
                get: function () {
                    return this._dirty && !this.AlwaysValid || System.Linq.Enumerable.from(this.FilterChildren(Core.Components.EditableComponent, function (x) {
                            return x._dirty;
                        }, function (x) {
                            return !x.PopulateDirty || x.AlwaysValid;
                        }), Core.Components.EditableComponent).any();
                },
                set: function (value) {
                    this.UpdateDirty(value);
                }
            },
            AlwaysValid: false,
            IsValid: {
                get: function () {
                    return this.ValidationResult.Count === 0;
                }
            },
            PopulateDirty: false,
            CacheName: {
                get: function () {
                    var $t;
                    var form;
                    var fn = ((form = Bridge.as(this, Core.Components.Forms.EditForm))) != null ? form.Feature.CacheName : ($t = this.GuiInfo) != null ? $t.CacheName : null;
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(fn)) {
                        return null;
                    }
                    var cacheNameFn = { };
                    if (Core.Extensions.Utils.IsFunction(fn, cacheNameFn)) {
                        return Bridge.as(cacheNameFn.v.call(null, this), System.String);
                    }
                    return null;
                }
            },
            QueueName: {
                get: function () {
                    var $t, $t1;
                    var form;
                    return ((form = Bridge.as(this, Core.Components.Forms.EditForm))) != null ? ($t = form.Feature) != null ? $t.QueueName : null : ($t1 = this.GuiInfo) != null ? $t1.QueueName : null;
                }
            }
        },
        ctors: {
            init: function () {
                this._show = true;
                this._setDirty = true;
                this.Children = new (System.Collections.Generic.List$1(Core.Components.EditableComponent)).ctor();
                this.PopulateDirty = true;
            },
            ctor: function (guiInfo) {
                var $t;
                this.$initialize();
                this.GuiInfo = guiInfo;
                if (this.GuiInfo != null && !Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.Validation)) {
                    var rules = Newtonsoft.Json.JsonConvert.DeserializeObject(this.GuiInfo.Validation, System.Collections.Generic.List$1(Core.Extensions.ValidationRule));
                    if (Core.Extensions.IEnumerableExtensions.HasElement(Core.Extensions.ValidationRule, rules)) {
                        this.ValidationRules = ($t = Core.Extensions.ValidationRule, System.Linq.Enumerable.from(rules, $t).toDictionary(function (x) {
                                return x.Rule;
                            }, null, System.String, $t));
                    }
                } else {
                    this.ValidationRules = new (System.Collections.Generic.Dictionary$2(System.String,Core.Extensions.ValidationRule)).ctor();
                }

                this.ValidationResult = new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor();
                this.Children = new (System.Collections.Generic.List$1(Core.Components.EditableComponent)).ctor();
                this.DOMContentLoaded = Bridge.fn.combine(this.DOMContentLoaded, Bridge.fn.bind(this, function () {
                    this.SetRequired();
                    this.SendQueueAction("Subscribe");
                    if (this.GuiInfo != null && Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.Events)) {
                        Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "DOMContentLoaded", [this.Entity]));
                    }
                }));
            }
        },
        methods: {
            ListViewItemTab: function (e) {
                var code = Core.Extensions.EventExt.KeyCodeEnum(e);
                var listViewItem = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem, this);
                if (listViewItem == null) {
                    return;
                }
                switch (code) {
                    case Core.Enums.KeyCodeEnum.Tab: 
                        if (listViewItem != null) {
                            var td = Core.Extensions.HtmlElementExtension.Closest((Bridge.as(e.target, HTMLElement)), "td");
                            if (td != null && td.nextElementSibling == null) {
                                e.preventDefault();
                                var nextElement = System.Linq.Enumerable.from(listViewItem.Children, Core.Components.EditableComponent).firstOrDefault(function (x) {
                                        return x.GuiInfo.Editable;
                                    }, null);
                                if (nextElement == null) {
                                    nextElement = System.Linq.Enumerable.from(listViewItem.Children, Core.Components.EditableComponent).firstOrDefault(function (x) {
                                            return Core.Extensions.StringExt.HasAnyChar(x.GuiInfo.Id);
                                        }, null);
                                }
                                Core.Components.EditableComponent.FocusElement(nextElement);
                                return;
                            }
                            if (Core.Extensions.EventExt.ShiftKey(e)) {
                                if (Bridge.is(this, Core.Components.Label) && this.GuiInfo.ComponentType != null && !this.GuiInfo.Editable && td != null && td.previousElementSibling != null) {
                                    e.preventDefault();
                                    var nextElement1 = System.Linq.Enumerable.from(listViewItem.Children, Core.Components.EditableComponent).firstOrDefault(function (x) {
                                            return Bridge.referenceEquals(Core.Extensions.HtmlElementExtension.Closest(x.Element, "td"), td.previousElementSibling);
                                        }, null);
                                    Core.Components.EditableComponent.FocusElement(nextElement1);
                                    return;
                                }
                            } else {
                                if (Bridge.is(this, Core.Components.Label) && this.GuiInfo.ComponentType != null && !this.GuiInfo.Editable && td != null && td.nextElementSibling != null) {
                                    e.preventDefault();
                                    var nextElement2 = System.Linq.Enumerable.from(listViewItem.Children, Core.Components.EditableComponent).firstOrDefault(function (x) {
                                            return Bridge.referenceEquals(Core.Extensions.HtmlElementExtension.Closest(x.Element, "td"), td.nextElementSibling);
                                        }, null);
                                    Core.Components.EditableComponent.FocusElement(nextElement2);
                                    return;
                                }
                            }
                        }
                        break;
                    case Core.Enums.KeyCodeEnum.Enter: 
                        if (listViewItem != null && this.EditForm.Feature.CustomNextCell) {
                            var search;
                            if (((search = Bridge.as(this, Core.Components.SearchEntry))) != null) {
                                if (search._gv != null && search._gv.Show) {
                                    return;
                                }
                            }
                            var td1 = Core.Extensions.HtmlElementExtension.Closest(this.Element, "td");
                            if (this.GuiInfo.ComponentType != null && td1 != null && td1.previousElementSibling != null) {
                                if (Core.Extensions.EventExt.ShiftKey(e)) {
                                    var nextElement3 = System.Linq.Enumerable.from(listViewItem.FilterChildren$1(function (x) {
                                            return Bridge.referenceEquals(Core.Extensions.HtmlElementExtension.Closest(x.Element, "td"), td1.previousElementSibling);
                                        }), Core.Components.EditableComponent).firstOrDefault(null, null);
                                    if (nextElement3 != null) {
                                        Core.Components.EditableComponent.FocusElement(nextElement3);
                                    }
                                } else {
                                    var nextElement4 = System.Linq.Enumerable.from(listViewItem.FilterChildren$1(function (x) {
                                            return Bridge.referenceEquals(Core.Extensions.HtmlElementExtension.Closest(x.Element, "td"), td1.nextElementSibling);
                                        }), Core.Components.EditableComponent).firstOrDefault(null, null);
                                    if (nextElement4 == null) {
                                        nextElement4 = System.Linq.Enumerable.from(listViewItem.Children, Core.Components.EditableComponent).firstOrDefault(null, null);
                                    }
                                    Core.Components.EditableComponent.FocusElement(nextElement4);
                                }
                            }
                        }
                        break;
                    default: 
                        break;
                }
            },
            Toggle: function (value) {
                if (this.Element == null) {
                    return;
                }

                this._show = value;
                if (!this._show) {
                    this.Element.style.display = "none";
                    if (this.GuiInfo != null && this.GuiInfo.ShowLabel && Bridge.is(this.Parent, Core.Components.Section) && this.FieldName != null) {
                        this.Element.parentElement.style.display = "none";
                        this.Element.parentElement.previousElementSibling.style.display = "none";
                    }
                } else {
                    this.Element.style.display = "";
                    if (this.GuiInfo != null && this.GuiInfo.ShowLabel && Bridge.is(this.Parent, Core.Components.Section) && this.FieldName != null) {
                        this.Element.parentElement.style.display = "";
                        this.Element.parentElement.previousElementSibling.style.display = "";
                    }
                }

                !Bridge.staticEquals(this.OnToggle, null) ? this.OnToggle(this._show) : null;
            },
            AddChild: function (child, index, showExp, disabledExp) {
                var $t, $t1;
                if (index === void 0) { index = null; }
                if (showExp === void 0) { showExp = null; }
                if (disabledExp === void 0) { disabledExp = null; }
                if (child.IsSingleton) {
                    child.Render();
                    return;
                }
                if (child.ParentElement == null) {
                    var tab;
                    if (((tab = Bridge.as(child, Core.Components.Forms.TabEditor))) != null) {
                        if (tab.Popup) {
                            child.ParentElement = this.Element || Core.Components.Forms.TabEditor.TabContainer;
                        } else {
                            tab.ParentElement = Core.Components.Forms.TabEditor.TabContainer;
                        }
                    } else {
                        child.ParentElement = Core.MVVM.Html.Context;
                    }
                }

                if (child.Entity == null) {
                    child.Entity = this.Entity;
                }

                if (this.Children == null) {
                    this.Children = new (System.Collections.Generic.List$1(Core.Components.EditableComponent)).ctor();
                }

                if (index == null || System.Nullable.gte(index, this.Children.Count) || System.Nullable.lt(index, 0)) {
                    this.Children.add(child);
                } else {
                    this.Children.insert(System.Nullable.getValue(index), child);
                }

                if (child.Parent == null) {
                    child.Parent = this;
                }

                Core.MVVM.Html.Take(child.ParentElement);
                child.Render();
                child.ToggleShow(($t = showExp, $t != null ? $t : (child.GuiInfo == null ? "" : child.GuiInfo.ShowExp)));
                child.ToggleDisabled(($t1 = disabledExp, $t1 != null ? $t1 : (child.GuiInfo == null ? "" : child.GuiInfo.DisabledExp)));
            },
            RemoveChild: function (child) {
                this.Children.remove(child);
            },
            Focus: function () {
                var $t;
                ($t = this.Element) != null ? $t.focus() : null;
            },
            UpdateViewAwait: function (force) {
                if (force === void 0) { force = false; }
                window.clearTimeout(this._updateViewAwaiter);
                this._updateViewAwaiter = window.setTimeout(Bridge.fn.bind(this, function () {
                    this.UpdateView$1(force);
                }), 100);
            },
            UpdateView$1: function (force, componentNames) {
                if (componentNames === void 0) { componentNames = []; }
                this.UpdateView(force, null, componentNames);
            },
            UpdateView: function (force, dirty, componentNames) {
                var $t, $t1;
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                this.PrepareUpdateView(force, dirty);
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, this.Children)) {
                    return;
                }

                if (Core.Extensions.IEnumerableExtensions.HasElement(System.String, componentNames)) {
                    var coms = System.Linq.Enumerable.from(this.FilterChildren(Core.Components.Section, function (x) {
                            return System.Array.contains(componentNames, x.Name, System.String) && Bridge.hasValue(x);
                        }), Core.Components.Section).selectMany(function (x) {
                            return x.FilterChildren(Core.Components.EditableComponent, function (com) {
                                return !(Bridge.is(com, Core.Components.Section));
                            });
                        });
                    var coms2 = System.Linq.Enumerable.from(this.FilterChildren(Core.Components.EditableComponent, function (x) {
                            return System.Array.contains(componentNames, x.Name, System.String);
                        }), Core.Components.EditableComponent).where(function (x) {
                            return !(Bridge.is(x, Core.Components.Section));
                        });
                    var shouldUpdate = coms.union(coms2).where(function (x) {
                        return !(Bridge.is(x, Core.Components.Section));
                    }).ToArray(Core.Components.EditableComponent);
                    $t = Bridge.getEnumerator(shouldUpdate);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            child.PrepareUpdateView(force, dirty);
                            child.UpdateView(force, dirty, componentNames);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                } else {
                    var shouldUpdate1 = System.Linq.Enumerable.from(this.FilterChildren(Core.Components.EditableComponent), Core.Components.EditableComponent).where(function (x) {
                            return !(Bridge.is(x, Core.Components.Section));
                        }).ToArray(Core.Components.EditableComponent);
                    $t1 = Bridge.getEnumerator(shouldUpdate1);
                    try {
                        while ($t1.moveNext()) {
                            var child1 = $t1.Current;
                            child1.PrepareUpdateView(force, dirty);
                            child1.UpdateView(force, dirty, componentNames);
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                }
            },
            PrepareUpdateView: function (force, dirty) {
                var $t, $t1;
                if (force) {
                    this.EmptyRow = false;
                }
                this.ToggleShow(($t = this.GuiInfo) != null ? $t.ShowExp : null);
                this.ToggleDisabled(($t1 = this.GuiInfo) != null ? $t1.DisabledExp : null);
                if (System.Nullable.hasValue(dirty)) {
                    this._setDirty = System.Nullable.getValue(dirty);
                }
            },
            Dispose: function () {
                this.SendQueueAction("Unsubscribe");
                this.DisposeChildren();
                this.RemoveDOM();
                this.Children = null;
                this.DOMContentLoaded = null;
                this.OnToggle = null;
                if (this.Parent != null && this.Parent.Children != null && Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent, this.Parent.Children) && this.Parent.Children.contains(this)) {
                    this.Parent.Children.remove(this);
                }
                !Bridge.staticEquals(this.Disposed, null) ? this.Disposed() : null;
            },
            DisposeChildren: function () {
                var $t, $t1;
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, this.Children)) {
                    return;
                }
                var leaves = ($t = Core.Extensions.IEnumerableExtensions.Flattern(Core.Components.EditableComponent, this.Children, function (x) {
                        return x.Children;
                    })) != null ? System.Linq.Enumerable.from($t, Core.Components.EditableComponent).where(function (x) {
                        return x.Element != null && x.Parent != null && Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, x.Children);
                    }).ToArray(Core.Components.EditableComponent) : null;
                while (Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent, leaves)) {
                    leaves.forEach(function (x) {
                            if (x == null) {
                                return;
                            }
                            x.Dispose();
                            if (x.Parent != null && x.Parent.Children != null) {
                                x.Parent.Children.remove(x);
                            }
                        });
                    leaves = ($t1 = Core.Extensions.IEnumerableExtensions.Flattern(Core.Components.EditableComponent, this.Children, function (x) {
                            return x.Children;
                        })) != null ? System.Linq.Enumerable.from($t1, Core.Components.EditableComponent).where(function (x) {
                            return x.Element != null && x.Parent != null && Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, x.Children);
                        }).ToArray(Core.Components.EditableComponent) : null;
                }
            },
            RemoveDOM: function () {
                if (this.Element != null) {
                    this.Element.remove();
                    this.Element = null;
                }
            },
            SetDefaultVal: function () {
                var $t;
                var id = ($t = this.Entity) != null ? Bridge.unbox($t[Core.Components.EditableComponent.IdField]) : null;
                if (this.Entity == null || (id != null && System.Nullable.gt(id, 0)) || Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.DefaultVal)) {
                    return;
                }
                var old = this.Entity[this.FieldName];
                var type = Bridge.Reflection.getMembers(Bridge.getType(this.Entity), 16, 284, this.FieldName);
                if (type == null) {
                    this.TrySetDFValue();
                    return;
                }
                var defaultVal = Bridge.createInstance(type.rt);
                if (!Bridge.equals(defaultVal, old) && (!Bridge.referenceEquals(type.rt, System.String) || !(old == null))) {
                    return;
                }
                this.TrySetDFValue();
            },
            TrySetDFValue: function () {
                try {
                    var obj = eval(this.GuiInfo.DefaultVal);
                    this.Entity[this.FieldName] = Bridge.is(obj, Function) ? (Bridge.as(obj, Function)).call(this, this) : obj;
                } catch ($e1) {
                    $e1 = System.Exception.create($e1);

                }
            },
            FilterChildren$1: function (predicate, stopWhere) {
                if (stopWhere === void 0) { stopWhere = null; }
                return this.FilterChildren(Core.Components.EditableComponent, predicate, stopWhere);
            },
            FilterChildren: function (T, predicate, ignorePredicate, visited) {
                return new (Bridge.GeneratorEnumerable$1(T))(Bridge.fn.bind(this, function (T, predicate, ignorePredicate, visited) {
                    var $step = 0,
                        $jumpFromFinally,
                        $returnValue,
                        $t,
                        child,
                        t,
                        $t1,
                        inner,
                        $async_e;

                    var $enumerator = new (Bridge.GeneratorEnumerator$1(T))(Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                switch ($step) {
                                    case 0: {
                                        if (predicate === void 0) { predicate = null; }
                                            if (ignorePredicate === void 0) { ignorePredicate = null; }
                                            if (visited === void 0) { visited = null; }
                                            if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, this.Children)) {
                                                $step = 1;
                                                continue;
                                            } 
                                            $step = 2;
                                            continue;
                                    }
                                    case 1: {
                                        return false;
                                    }
                                    case 2: {
                                        if (visited == null) {
                                                visited = new (System.Collections.Generic.HashSet$1(T)).ctor();
                                            }
                                            $t = Bridge.getEnumerator(this.Children);
                                            $step = 3;
                                            continue;
                                    }
                                    case 3: {
                                        if ($t.moveNext()) {
                                                child = $t.Current;
                                                $step = 4;
                                                continue;
                                            }
                                        $step = 12;
                                        continue;
                                    }
                                    case 4: {
                                        t = Bridge.as(child, T);
                                            if (t == null && Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, child.Children)) {
                                                $step = 3;
                                                continue;
                                            }
                                            if (!Bridge.staticEquals(ignorePredicate, null) && ignorePredicate(t)) {
                                                $step = 3;
                                                continue;
                                            }

                                            if (t != null && (Bridge.staticEquals(predicate, null) || predicate(t)) && !visited.contains(t)) {
                                                $step = 5;
                                                continue;
                                            } 
                                            $step = 7;
                                            continue;
                                    }
                                    case 5: {
                                        visited.add(t);
                                            $enumerator.current = t;
                                            $step = 6;
                                            return true;
                                    }
                                    case 6: {
                                        $step = 7;
                                        continue;
                                    }
                                    case 7: {
                                        $t1 = Bridge.getEnumerator(child.FilterChildren(T, predicate, ignorePredicate, visited), T);
                                            $step = 8;
                                            continue;
                                    }
                                    case 8: {
                                        if ($t1.moveNext()) {
                                                inner = $t1.Current;
                                                $step = 9;
                                                continue;
                                            }
                                        $step = 11;
                                        continue;
                                    }
                                    case 9: {
                                        $enumerator.current = inner;
                                            $step = 10;
                                            return true;
                                    }
                                    case 10: {
                                        $step = 8;
                                        continue;
                                    }
                                    case 11: {
                                        $step = 3;
                                        continue;
                                    }
                                    case 12: {

                                    }
                                    default: {
                                        return false;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            throw $async_e;
                        }
                    }));
                    return $enumerator;
                }, arguments));
            },
            ToggleShow: function (showExp) {
                var $t;
                var fn = { };
                if (Core.Extensions.StringExt.HasAnyChar(showExp) && Core.Extensions.Utils.IsFunction(showExp, fn)) {
                    var shown = Bridge.as(fn.v.call(null, this), System.Boolean, true);
                    this.Show = ($t = shown, $t != null ? $t : false);
                }
            },
            ToggleDisabled: function (disabled) {
                var $t;
                var fn = { };
                if (Core.Extensions.StringExt.HasAnyChar(disabled) && Core.Extensions.Utils.IsFunction(disabled, fn)) {
                    var shouldDisabled = Bridge.as(fn.v.call(null, this), System.Boolean, true);
                    this.Disabled = ($t = shouldDisabled, $t != null ? $t : false);
                }
            },
            SetDisableUI: function (disabled) {
                if (this.Element == null) {
                    return;
                }

                if (disabled) {
                    this.Element.setAttribute("disabled", "disabled");
                } else {
                    this.Element.removeAttribute("disabled");
                    this.Element.setAttribute("enable", "true");
                }
            },
            UpdateDirty: function (dirty) {
                if (dirty) {
                    this.SetDirtyInternal();
                } else {
                    this.ClearDirtyInternal();
                    Core.Extensions.IEnumerableExtensions.SelectForEach(Core.Components.EditableComponent, this.FilterChildren(Core.Components.EditableComponent, function (x) {
                        return x._dirty;
                    }), function (x) {
                        x.ClearDirtyInternal();
                    });
                }
            },
            SetDirtyInternal: function () {
                this._dirty = this._setDirty;
                if (!this._setDirty) {
                    this._setDirty = true;
                }
            },
            ClearDirtyInternal: function () {
                this._dirty = false;
            },
            GetValueText: function () {
                if (this.Element == null) {
                    return "";
                }
                var input;
                if (((input = Bridge.as(this.Element, HTMLInputElement))) != null) {
                    return input.value;
                }
                var text;
                if (((text = Bridge.as(this.Element, HTMLTextAreaElement))) != null) {
                    return text.value;
                }
                return "";
            },
            ValidateAsync: function () {
                return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
            },
            SetRequired: function () {
                var $t, $t1;
                if (Core.Extensions.IEnumerableExtensions.HasElement(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule), this.ValidationRules) && this.ValidationRules.containsKey(Core.Extensions.ValidationRule.Required)) {
                    ($t = this.Element) != null ? $t.setAttribute(Core.Extensions.ValidationRule.Required, System.Boolean.toString((true))) : null;
                } else {
                    ($t1 = this.Element) != null ? $t1.removeAttribute(Core.Extensions.ValidationRule.Required) : null;
                }
            },
            Validate: function (T, K, ruleType, value, validPredicate) {
                var $t, $t1;
                if (!this.ValidationRules.containsKey(ruleType)) {
                    return true;
                }

                var rule = this.ValidationRules.getItem(ruleType);
                if (rule == null || rule.Value1 == null) {
                    return true;
                }

                var field = Bridge.toString(rule.Value1);
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(field)) {
                    return true;
                }

                var ruleValue = Bridge.unbox(rule.Value1);
                var label = ruleValue;
                var hasField = { };
                var fieldVal = { };
                Bridge.Deconstruct(Core.Extensions.BridgeExt.GetComplexProp(this.Entity, field).$clone(), hasField, fieldVal);
                if (hasField.v) {
                    label = ($t = Core.Components.Extensions.ComponentExt.FirstOrDefault(this.Parent, function (x) {
                            return Bridge.referenceEquals(x.Name, field);
                        })) != null && ($t1 = $t.GuiInfo) != null ? $t1.Label : null;
                    ruleValue = Bridge.unbox(fieldVal.v);
                }
                if (!validPredicate(value, ruleValue)) {
                    System.Collections.Generic.CollectionExtensions.TryAdd(System.String, System.String, this.ValidationResult, ruleType, System.String.format(rule.Message, Core.Components.LangSelect.Get(this.GuiInfo.Label), label));
                    return true;
                } else {
                    this.ValidationResult.remove(ruleType);
                }

                return false;
            },
            ValidateRequired: function (T, Value) {
                if (this.Element == null || Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule), this.ValidationRules) || this.EmptyRow || this.AlwaysValid) {
                    return true;
                }

                if (!this.ValidationRules.containsKey(Core.Extensions.ValidationRule.Required)) {
                    this.Element.removeAttribute(Core.Extensions.ValidationRule.Required);
                    return true;
                }
                var requiredRule = this.ValidationRules.getItem(Core.Extensions.ValidationRule.Required);
                this.Element.setAttribute(Core.Extensions.ValidationRule.Required, System.Boolean.toString((true)));
                if (System.Collections.Generic.EqualityComparer$1(T).def.equals2(Value, Bridge.getDefaultValue(T)) || Core.Extensions.StringExt.IsNullOrWhiteSpace(Bridge.toString(Value))) {
                    this.Element.removeAttribute("readonly");
                    System.Collections.Generic.CollectionExtensions.TryAdd(System.String, System.String, this.ValidationResult, Core.Extensions.ValidationRule.Required, System.String.format(requiredRule.Message, Core.Components.LangSelect.Get(this.GuiInfo.Label), this.Entity));
                    return false;
                } else {
                    this.ValidationResult.remove(Core.Extensions.ValidationRule.Required);
                    return true;
                }
            },
            AddRule: function (rule) {
                System.Collections.Generic.CollectionExtensions.TryAdd(System.String, Core.Extensions.ValidationRule, this.ValidationRules, rule.Rule, rule);
                if (Bridge.referenceEquals(rule.Rule, Core.Extensions.ValidationRule.Required)) {
                    this.Element.setAttribute(Core.Extensions.ValidationRule.Required, System.Boolean.toString((true)));
                }
            },
            RemoveRule: function (ruleName) {
                this.ValidationRules.remove(ruleName);
                if (!this.ValidationRules.containsKey(Core.Extensions.ValidationRule.Required)) {
                    this.Element.removeAttribute(Core.Extensions.ValidationRule.Required);
                }
            },
            CascadeField: function () {
                if (Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.CascadeField)) {
                    return;
                }

                var gridRow = Bridge.as(Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem, this), Core.Components.EditableComponent);
                var root = gridRow || Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, this);
                var cascadeFields = System.Linq.Enumerable.from(this.GuiInfo.CascadeField.split(","), System.String).where(function (x) {
                        return Core.Extensions.StringExt.HasAnyChar(x);
                    }).select(function (x) {
                    return x.trim();
                });
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, cascadeFields)) {
                    return;
                }

                cascadeFields.forEach(function (field) {
                    Core.Extensions.IEnumerableExtensions.SelectForEach(Core.Components.EditableComponent, root.FilterChildren$1(function (x) {
                        return Bridge.referenceEquals(x.Name, field);
                    }), function (x) {
                        var $t, $t1;
                        var com;
                        if (((com = Bridge.as(x, Core.Components.SearchEntry))) != null && com != null) {
                            com.Value = null;
                            ($t = com.GuiInfo) != null && ($t1 = $t.LocalData) != null ? $t1.clear() : null;
                        } else {
                            x.UpdateView();
                        }
                    });
                });
            },
            GetInvalid: function () {
                return new (Bridge.GeneratorEnumerable$1(Core.Components.EditableComponent))(Bridge.fn.bind(this, function ()  {
                    var $step = 0,
                        $jumpFromFinally,
                        $returnValue,
                        $t,
                        child,
                        $t1,
                        invalid,
                        $async_e;

                    var $enumerator = new (Bridge.GeneratorEnumerator$1(Core.Components.EditableComponent))(Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                switch ($step) {
                                    case 0: {
                                        if (this.AlwaysValid) {
                                                $step = 1;
                                                continue;
                                            } 
                                            $step = 2;
                                            continue;
                                    }
                                    case 1: {
                                        return false;
                                    }
                                    case 2: {
                                        if (!this.IsValid) {
                                                $step = 3;
                                                continue;
                                            } 
                                            $step = 5;
                                            continue;
                                    }
                                    case 3: {
                                        $enumerator.current = this;
                                            $step = 4;
                                            return true;
                                    }
                                    case 4: {
                                        $step = 5;
                                        continue;
                                    }
                                    case 5: {
                                        if (Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent, this.Children)) {
                                                $step = 6;
                                                continue;
                                            } 
                                            $step = 14;
                                            continue;
                                    }
                                    case 6: {
                                        $t = Bridge.getEnumerator(System.Linq.Enumerable.from(this.Children, Core.Components.EditableComponent).where(function (x) {
                                                    var editable;
                                                    return ((editable = x)) != null;
                                                }).select(function (x) {{ return Bridge.cast(x, Core.Components.EditableComponent); }}));
                                            $step = 7;
                                            continue;
                                    }
                                    case 7: {
                                        if ($t.moveNext()) {
                                                child = $t.Current;
                                                $step = 8;
                                                continue;
                                            }
                                        $step = 13;
                                        continue;
                                    }
                                    case 8: {
                                        $t1 = Bridge.getEnumerator(child.GetInvalid(), Core.Components.EditableComponent);
                                            $step = 9;
                                            continue;
                                    }
                                    case 9: {
                                        if ($t1.moveNext()) {
                                                invalid = $t1.Current;
                                                $step = 10;
                                                continue;
                                            }
                                        $step = 12;
                                        continue;
                                    }
                                    case 10: {
                                        $enumerator.current = invalid;
                                            $step = 11;
                                            return true;
                                    }
                                    case 11: {
                                        $step = 9;
                                        continue;
                                    }
                                    case 12: {
                                        $step = 7;
                                        continue;
                                    }
                                    case 13: {
                                        $step = 14;
                                        continue;
                                    }
                                    case 14: {

                                    }
                                    default: {
                                        return false;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            throw $async_e;
                        }
                    }));
                    return $enumerator;
                }));
            },
            PopulateFields: function (entity) {
                if (entity === void 0) { entity = null; }
                if (this.Entity == null || Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.PopulateField)) {
                    return;
                }

                var gridRow = Bridge.as(Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem, this), Core.Components.EditableComponent);
                var root = gridRow || this.EditForm;
                var func = { };
                var isFunc = Core.Extensions.Utils.IsFunction(this.GuiInfo.PopulateField, func);
                if (isFunc) {
                    try {
                        func.v.call(null, this, Bridge.unbox(entity));
                    } catch ($e1) {
                        $e1 = System.Exception.create($e1);
                    }
                    root.UpdateViewAwait(true);
                    return;
                }

                var populatedFields = System.Linq.Enumerable.from(this.GuiInfo.PopulateField.split(","), System.String).where(function (x) {
                        return Core.Extensions.StringExt.HasAnyChar(x);
                    }).select(function (x) {
                    return x.trim();
                });
                if (entity == null || Core.Extensions.IEnumerableExtensions.Nothing(System.String, populatedFields)) {
                    return;
                }

                populatedFields.forEach(Bridge.fn.bind(this, function (field) {
                    var isEditing = Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField]) <= 0;
                    Core.Extensions.IEnumerableExtensions.SelectForEach(Core.Components.EditableComponent, root.FilterChildren(Core.Components.EditableComponent, function (x) {
                        return Bridge.referenceEquals(x.Name, field);
                    }), Bridge.fn.bind(this, function (target) {
                        var value = Core.Extensions.Utils.GetPropValue(entity, field);
                        var oldVal = Core.Extensions.Utils.GetPropValue(this.Entity, field);
                        var targetType = Core.Extensions.BridgeExt.GetComplexPropType(Bridge.getType(this.Entity), field);
                        if (Bridge.referenceEquals(value, oldVal) || targetType == null || !Bridge.referenceEquals(Bridge.createInstance(targetType), oldVal)) {
                            return;
                        }
                        Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, field, value);
                        target.UpdateView(true, false);
                    }));
                }));
            },
            GetValueTextAct: function () {
                return this.Element.textContent;
            },
            AddIdToPatch: function (details) {
                var $t;
                var idField = System.Linq.Enumerable.from(details, Core.ViewModels.PatchDetail).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.Field, Core.Components.EditableComponent.IdField);
                    }, null);
                if (idField != null) {
                    details.remove(idField);
                }
                if (this.EntityId == null) {
                    details.add(($t = new Core.ViewModels.PatchDetail(), $t.Field = Core.Extensions.Utils.IdField, $t.Value = Core.Structs.Uuid7.Id25(), $t));
                } else {
                    details.add(($t = new Core.ViewModels.PatchDetail(), $t.Field = Core.Extensions.Utils.IdField, $t.Value = this.EntityId, $t.OldVal = this.EntityId, $t));
                }
            },
            SendQueueAction: function (action) {
                var queueName = this.QueueName;
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(queueName)) {
                    return;
                }
                Core.Components.Forms.EditForm.NotificationClient.Send(System.String.format("{{\"QueueName\": \"{0}\", \"Action\": \"{1}\"}}", queueName, action));
                if (Bridge.referenceEquals(action, "Subscribe")) {
                    window.addEventListener(queueName, this.QueueHandler);
                } else {
                    window.removeEventListener(queueName, this.QueueHandler);
                }
            },
            QueueHandler: function (e) {
                System.Console.WriteLine(Core.Extensions.Utils.ToJson(System.Object, e.detail));
            }
        }
    });

    Bridge.define("Core.Components.Direction", {
        $kind: "enum",
        statics: {
            fields: {
                top: 0,
                right: 1,
                bottom: 2,
                left: 3
            }
        }
    });

    Bridge.define("Core.Components.Extensions.ComponentExt", {
        statics: {
            fields: {
                Auto: null,
                StepPx: 0
            },
            props: {
                FeatureMap: null
            },
            ctors: {
                init: function () {
                    this.Auto = "auto";
                    this.StepPx = 10;
                    this.FeatureMap = new (System.Collections.Generic.Dictionary$2(System.String,Core.Models.Feature)).ctor();
                }
            },
            methods: {
                /**
                 * This method is used to dispatch UI event to event handler, not from data change
                 *
                 * @static
                 * @public
                 * @this Core.Components.Extensions.ComponentExt
                 * @memberof Core.Components.Extensions.ComponentExt
                 * @param   {Core.Components.EditableComponent}    com           
                 * @param   {string}                               events        
                 * @param   {Bridge.Html5.EventType}               eventType     
                 * @param   {Array.<System.Object>}                parameters
                 * @return  {System.Threading.Tasks.Task$1}
                 */
                DispatchEvent: function (com, events, eventType, parameters) {
                    if (parameters === void 0) { parameters = []; }
                    if (Core.Extensions.StringExt.IsNullOrEmpty(events)) {
                        return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
                    }
                    var eventTypeName = System.Enum.toString(System.String, eventType);
                    return Core.Components.Extensions.ComponentExt.InvokeEvent(com, events, eventTypeName, parameters);
                },
                InvokeEvent: function (com, events, eventTypeName, parameters) {
                    var $t;
                    if (parameters === void 0) { parameters = []; }
                    var eventObj;
                    try {
                        eventObj = Newtonsoft.Json.JsonConvert.DeserializeObject(events, System.Object);
                    } catch ($e1) {
                        $e1 = System.Exception.create($e1);
                        return System.Threading.Tasks.Task.fromResult(false, System.Boolean);
                    }
                    var form = com.EditForm;
                    if (form == null) {
                        return System.Threading.Tasks.Task.fromResult(false, System.Boolean);
                    }
                    var eventName = ($t = eventObj[eventTypeName]) != null ? Bridge.toString($t) : null;
                    var func = { };
                    var isFn = Core.Extensions.Utils.IsFunction(eventName, func);
                    if (isFn) {
                        func.v.call(null, form, com);
                        return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
                    }
                    if (Core.Extensions.StringExt.IsNullOrEmpty(eventName)) {
                        return System.Threading.Tasks.Task.fromResult(false, System.Boolean);
                    }

                    var method = form[eventName];
                    if (method == null) {
                        form = Core.Components.Extensions.ComponentExt.FindComponentEvent(form, eventName);
                        if (form == null) {
                            return System.Threading.Tasks.Task.fromResult(false, System.Boolean);
                        }
                        method = form[eventName];
                    }
                    if (method == null) {
                        return System.Threading.Tasks.Task.fromResult(false, System.Boolean);
                    }
                    var tcs = new System.Threading.Tasks.TaskCompletionSource();
                    var task = null;
                    task = method.apply(form, parameters);
                    if (task === null || task === undefined || task.isCompleted == null) {
                        tcs.setResult(false);
                        return tcs.Task;
                    }
                    Core.Extensions.EventExt.Catch(Core.Extensions.EventExt.Done(task, function () {
                        tcs.trySetResult(true);
                    }), function (e) {
                        tcs.trySetException(e);
                    });
                    return tcs.task;
                },
                DispatchCustomEvent: function (com, events, eventType, parameters) {
                    if (parameters === void 0) { parameters = []; }
                    if (Core.Extensions.StringExt.IsNullOrEmpty(events)) {
                        return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
                    }

                    var eventTypeName = System.Enum.toString(Core.Enums.CustomEventType, eventType);
                    return Core.Components.Extensions.ComponentExt.InvokeEvent(com, events, eventTypeName, parameters);
                },
                MapToCom: function (raw) {
                    var com = Core.Extensions.BridgeExt.CastProp(Core.Models.Component, raw);
                    com.FieldText = Bridge.as(raw.FieldText, System.String);
                    return com;
                },
                MapToPatch: function (T, com, table) {
                    var $t, $t1;
                    if (table === void 0) { table = null; }
                    var patch = ($t = new Core.ViewModels.PatchVM(), $t.Table = ($t1 = table, $t1 != null ? $t1 : Bridge.Reflection.getTypeName(T)), $t.Changes = new (System.Collections.Generic.List$1(Core.ViewModels.PatchDetail)).ctor(), $t);
                    Core.Extensions.Utils.ForEachProp$1(com, function (prop, val) {
                        var $t2;
                        if (System.String.startsWith(prop, "$")) {
                            return;
                        }
                        patch.Changes.add(($t2 = new Core.ViewModels.PatchDetail(), $t2.Field = prop, $t2.Value = val != null ? Bridge.toString(val) : null, $t2));
                    });
                    return patch;
                },
                MapToFilterOperator: function (com, searchTerm) {
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(searchTerm) || !com.HasFilter || Core.Extensions.StringExt.IsNullOrEmpty(com.FieldName)) {
                        return "";
                    }

                    searchTerm = searchTerm.trim();
                    var fieldName = Bridge.referenceEquals(com.ComponentType, "SearchEntry") ? com.FieldText : com.FieldName;
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(fieldName)) {
                        return "";
                    }
                    if (Bridge.referenceEquals(com.ComponentType, "Datepicker")) {
                        var date = { v : new System.DateTimeOffset() };
                        var parsedDate = System.DateTimeOffset.TryParse(searchTerm, date);
                        if (parsedDate) {
                            var dateStr = date.v.ToString$1("yyyy/MM/dd");
                            return System.String.format("cast(ds.{0} as date) = cast('{1}' as date)", fieldName, dateStr);
                        }

                        return "";
                    } else if (Bridge.referenceEquals(com.ComponentType, "Checkbox")) {
                        var val = { };
                        var parseBool = System.Boolean.tryParse(searchTerm, val);
                        if (!parseBool) {
                            return "";
                        }

                        return System.String.format("ds.{0} = {1}", fieldName, Bridge.box(val.v, System.Boolean, System.Boolean.toString));
                    } else if (Bridge.referenceEquals(com.ComponentType, "Number")) {
                        var searchNumber = { };
                        var parsedNumber = System.Decimal.tryParse(searchTerm, null, searchNumber);
                        if (!parsedNumber) {
                            return "";
                        }

                        return System.String.format("ds.{0} = {1}", fieldName, searchNumber.v);
                    }
                    return Core.Extensions.StringExt.HasAnyChar(com.FilterTemplate) ? System.String.format(com.FilterTemplate, [searchTerm]) : System.String.format("charindex(N'{0}', ds.{1}) >= 1", searchTerm, fieldName);
                },
                OpenTab: function (com, id, factory) {
                    var tab;
                    if (((tab = Bridge.as(Core.Components.Forms.TabEditor.FindTab(id), Core.Components.Forms.TabEditor))) != null) {
                        tab.Focus();
                        return tab;
                    }
                    tab = factory();
                    Core.Components.Extensions.ComponentExt.OpenTabOrPopup(com, tab);
                    return tab;
                },
                OpenTab$1: function (com, id, featureName, factory, popup, anonymous) {
                    if (popup === void 0) { popup = false; }
                    if (anonymous === void 0) { anonymous = false; }
                    var tcs = new System.Threading.Tasks.TaskCompletionSource();
                    var exists;
                    if (!popup && ((exists = Bridge.as(Core.Components.Forms.TabEditor.FindTab(id), Core.Components.Forms.TabEditor))) != null) {
                        exists.Focus();
                        tcs.trySetResult(exists);
                        return tcs.task;
                    }
                    Core.Extensions.EventExt.Done$1(Core.Models.Feature, Core.Components.Extensions.ComponentExt.LoadFeature(Core.Clients.Client.ConnKey, featureName), function (feature) {
                        var tab = factory();
                        tab.Popup = popup;
                        tab.Name = featureName;
                        tab.Id = id;
                        tab.Feature = feature;
                        Core.Components.Extensions.ComponentExt.AssignMethods(feature, tab);
                        Core.Components.Extensions.ComponentExt.OpenTabOrPopup(com, tab);
                    });
                    ;
                    return tcs.task;
                },
                AssignMethods: function (f, instance) {
                    var fn = new Function(f.Script);
                    var obj = fn.call(null, f);
                    for (let prop in obj) instance[prop] = obj[prop];
                    if (instance.Init != null) instance.Init();
                },
                OpenTabOrPopup: function (com, tab) {
                    var $t;
                    var editForm;
                    var parentTab = ((editForm = Bridge.as(com, Core.Components.Forms.EditForm))) != null ? editForm : com.EditForm || Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, com);
                    if (tab.Popup) {
                        com.AddChild(tab);
                    } else {
                        tab.Render();
                    }
                    tab.ParentForm = parentTab;
                    tab.OpenFrom = parentTab != null && ($t = parentTab.FilterChildren(Core.Components.ListViewItem, function (x) {
                            return Bridge.referenceEquals(x.Entity, tab.Entity);
                        })) != null ? System.Linq.Enumerable.from($t, Core.Components.ListViewItem).firstOrDefault(null, null) : null;
                },
                OpenPopup: function (com, featureName, factory, anonymous, child) {
                    if (anonymous === void 0) { anonymous = false; }
                    if (child === void 0) { child = false; }
                    return Core.Components.Extensions.ComponentExt.OpenTab$1(com, Bridge.toString(Bridge.getHashCode(com)), featureName, factory, true, anonymous);
                },
                InitFeatureByName: function (connKey, hash, portal) {
                    if (portal === void 0) { portal = true; }
                    var tcs = new System.Threading.Tasks.TaskCompletionSource();
                    var featureName = System.String.replaceAll(System.String.replaceAll(hash, "-", " "), "#", "");
                    Core.Extensions.EventExt.Done$1(Core.Models.Feature, Core.Components.Extensions.ComponentExt.LoadFeature(connKey, featureName), function (feature) {
                        if (feature == null) {
                            return;
                        }

                        var type = Bridge.Reflection.getType(feature.ViewClass);
                        var instance = type == null ? new Core.Components.Forms.EditForm("") : Bridge.as(Bridge.createInstance(type), Core.Components.Forms.EditForm);
                        instance.Feature = feature;
                        instance.Id = feature.Name;
                        Core.Components.Forms.EditForm.Portal = portal;
                        instance.Render();
                        tcs.setResult(instance);
                    });
                    return tcs.task;
                },
                LoadFeature: function (connKey, name, id) {
                    var $t, $t1;
                    if (id === void 0) { id = null; }
                    var tcs = new System.Threading.Tasks.TaskCompletionSource();
                    var featureTask = Core.Clients.Client.Instance.SubmitAsync(System.Array.type(System.Array.type(System.Object)), ($t = new Core.Clients.XHRWrapper(), $t.Value = JSON.stringify(($t1 = new Core.ViewModels.SqlViewModel(), $t1.ComId = "Feature", $t1.Action = "GetFeature", $t1.ConnKey = Core.Clients.Client.ConnKey, $t1.Params = JSON.stringify(new $asm.$AnonymousType$2(name, id)), $t1)), $t.Url = Core.Extensions.Utils.UserSvc, $t.IsRawString = true, $t.Method = Core.Enums.HttpMethod.POST, $t));
                    Core.Clients.Client.ExecTask(System.Array.type(System.Array.type(System.Object)), featureTask, function (ds) {
                        var $t2, $t3;
                        if (Core.Extensions.IEnumerableExtensions.Nothing(System.Array.type(System.Object), ds) || Core.Extensions.IEnumerableExtensions.Nothing(System.Object, ds[System.Array.index(0, ds)])) {
                            tcs.trySetResult(null);
                        }
                        var feature = Core.Extensions.BridgeExt.CastProp(Core.Models.Feature, ($t2 = ds[System.Array.index(0, ds)])[System.Array.index(0, $t2)]);
                        if (feature == null) {
                            tcs.trySetResult(null);
                            return;
                        }
                        feature.FeaturePolicy = System.Linq.Enumerable.from(ds[System.Array.index(1, ds)], System.Object).select(function (x) {
                                return Core.Extensions.BridgeExt.CastProp(Core.Models.FeaturePolicy, x);
                            }).toList(Core.Models.FeaturePolicy);
                        var groups = ds.length > 2 ? System.Linq.Enumerable.from(ds[System.Array.index(2, ds)], System.Object).select(function (x) {
                                return Core.Extensions.BridgeExt.CastProp(Core.Models.ComponentGroup, x);
                            }).toList(Core.Models.ComponentGroup) : null;
                        feature.ComponentGroup = groups;
                        var components = ds.length > 3 ? System.Linq.Enumerable.from(ds[System.Array.index(3, ds)], System.Object).select(function (x) {
                                return Core.Extensions.BridgeExt.CastProp(Core.Models.Component, x);
                            }).toList(Core.Models.Component) : null;
                        feature.Component = components;
                        if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.ComponentGroup, groups) || Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.Component, components)) {
                            tcs.trySetResult(null);
                            return;
                        }
                        var groupMap = ($t3 = Core.Models.ComponentGroup, System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Models.ComponentGroup, System.String, groups, function (x) {
                                return x.Id;
                            }), $t3).toDictionary(function (x) {
                                return x.Id;
                            }, null, System.String, $t3));
                        components.ForEach(function (com) {
                            if (com.ComponentGroupId == null) {
                                return;
                            }
                            var g = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, Core.Models.ComponentGroup, groupMap, com.ComponentGroupId);
                            g != null ? System.Array.add(g.Component, com, Core.Models.Component) : null;
                        });
                        tcs.trySetResult(feature);
                    });

                    return tcs.task;
                },
                FirstOrDefault: function (component, predicate, ignorePredicate) {
                    var $t, $t1;
                    if (ignorePredicate === void 0) { ignorePredicate = null; }
                    if (component == null || Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, component.Children)) {
                        return null;
                    }

                    $t = Bridge.getEnumerator(component.Children);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            if (!Bridge.staticEquals(ignorePredicate, null) && ignorePredicate(child)) {
                                continue;
                            }

                            if (predicate(child)) {
                                return child;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    $t1 = Bridge.getEnumerator(component.Children);
                    try {
                        while ($t1.moveNext()) {
                            var child1 = $t1.Current;
                            if (Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent, child1.Children)) {
                                var res = Core.Components.Extensions.ComponentExt.FirstOrDefault(child1, predicate, ignorePredicate);
                                if (res != null) {
                                    return res;
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                    return null;
                },
                FindActiveComponent: function (T, component, predicate) {
                    var $t;
                    if (predicate === void 0) { predicate = null; }
                    var result = new (System.Collections.Generic.HashSet$1(T)).ctor();
                    var type = T;
                    if (component == null || component.Children == null || Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, component.Children)) {
                        return System.Linq.Enumerable.empty();
                    }

                    $t = Bridge.getEnumerator(component.Children);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            if (Bridge.Reflection.isAssignableFrom(type, Bridge.getType(child)) && child.ParentElement != null && !Core.Extensions.HtmlElementExtension.Hidden(child.ParentElement) && (Bridge.staticEquals(predicate, null) || predicate(Bridge.as(child, T)))) {
                                result.add(Bridge.as(child, T));
                            }

                            if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, child.Children)) {
                                continue;
                            }

                            var res = Core.Components.Extensions.ComponentExt.FindActiveComponent(T, child);
                            Core.Extensions.IEnumerableExtensions.SelectForEach(T, res, function (x) {
                                result.add(x);
                            });
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return System.Linq.Enumerable.from(result, T).distinct();
                },
                FindComponentByName: function (T, component, name) {
                    return Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(component, function (x) {
                        return Bridge.referenceEquals(x.Name, name) && Bridge.Reflection.isAssignableFrom(T, Bridge.getType(x));
                    }), T);
                },
                SetValue: function (component, name, value) {
                    var match = Core.Components.Extensions.ComponentExt.FirstOrDefault(component, function (x) {
                        return Bridge.referenceEquals(x.FieldName, name);
                    });
                    if (match == null) {
                        return;
                    }
                    var text;
                    if (((text = Bridge.as(match, Core.Components.Textbox))) != null) {
                        text.Value = value;
                    } else {
                        var search;
                        if (((search = Bridge.as(match, Core.Components.SearchEntry))) != null && (value == null || Core.Extensions.ReflectionExt.IsInt32(Bridge.getType(value)))) {
                            search.Value = value != null ? Bridge.toString(value) : null;
                        } else {
                            var number;
                            if (((number = Bridge.as(match, Core.Components.Number))) != null && (value == null || Core.Extensions.ReflectionExt.IsNumber(Bridge.getType(value)))) {
                                number.Value = System.Convert.toDecimal(value);
                            } else {
                                var checkbox;
                                if (((checkbox = Bridge.as(match, Core.Components.Checkbox))) != null && (value == null || Core.Extensions.ReflectionExt.IsBool(Bridge.getType(value)))) {
                                    checkbox.Value = Bridge.as(value, System.Boolean, true);
                                } else {
                                    var dpk;
                                    if (((dpk = Bridge.as(match, Core.Components.Datepicker))) != null && (value == null || Core.Extensions.ReflectionExt.IsDate(Bridge.getType(value)))) {
                                        dpk.Value = Bridge.as(value, System.DateTime, true);
                                    }
                                }
                            }
                        }
                    }
                },
                GetValue: function (com, simple) {
                    if (simple === void 0) { simple = false; }
                    var text;
                    if (((text = Bridge.as(com, Core.Components.Textbox))) != null) {
                        return text.Text;
                    } else {
                        var multiple;
                        if (((multiple = Bridge.as(com, Core.Components.MultipleSearchEntry))) != null) {
                            return simple ? Core.Extensions.IEnumerableExtensions.Combine(System.String, multiple.ListValues) : multiple.ListValues;
                        } else {
                            var search;
                            if (((search = Bridge.as(com, Core.Components.SearchEntry))) != null) {
                                return search.Value;
                            } else {
                                var number;
                                if (((number = Bridge.as(com, Core.Components.Number))) != null) {
                                    return number.Value;
                                } else {
                                    var chk;
                                    if (((chk = Bridge.as(com, Core.Components.Checkbox))) != null) {
                                        return Bridge.box(chk.Value, System.Boolean, System.Nullable.toStringFn(System.Boolean.toString), System.Nullable.getHashCode);
                                    } else {
                                        var dpk;
                                        if (((dpk = Bridge.as(com, Core.Components.Datepicker))) != null) {
                                            return Bridge.box(dpk.Value, System.DateTime, System.Nullable.toStringFn(System.DateTime.format), System.Nullable.getHashCode);
                                        } else {
                                            var uploader;
                                            if (((uploader = Bridge.as(com, Core.Components.Image))) != null) {
                                                return uploader.Path;
                                            } else {
                                                var cellText;
                                                if (((cellText = Bridge.as(com, Core.Components.Label))) != null) {
                                                    return cellText.Element.innerText;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    return null;
                },
                SetDisabled: function (component, disabled) {
                    var editable;
                    if (component != null && ((editable = component)) != null) {
                        editable.Disabled = disabled;
                    }
                },
                SetDisabled$2: function (T, component, name, disabled) {
                    component = Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(component, function (x) {
                        return Bridge.referenceEquals(x.Name, name) && Bridge.is(x, T);
                    }), T);
                    var editable;
                    if (component != null && ((editable = component)) != null) {
                        editable.Disabled = disabled;
                    }
                },
                SetDisabled$1: function (component, disabled, fieldNames) {
                    if (fieldNames === void 0) { fieldNames = []; }
                    if (component == null) {
                        return;
                    }
                    Core.Extensions.IEnumerableExtensions.SelectForEach(Core.Components.EditableComponent, component.FilterChildren(Core.Components.EditableComponent, function (x) {
                        return System.Array.contains(fieldNames, x.Name, System.String);
                    }), function (x) {
                        x.Disabled = disabled;
                    });
                },
                SetDataSourceSearchEntry: function (component, name, DataSourceFilter) {
                    var search = Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(component, function (x) {
                        return Bridge.referenceEquals(x.Name, name) && Bridge.is(x, Core.Components.SearchEntry);
                    }), Core.Components.SearchEntry);
                    if (search != null) {
                        search.GuiInfo.DataSourceFilter = DataSourceFilter;
                    }
                },
                SetDataSourceGridView: function (component, name, DataSourceFilter) {
                    var search = Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(component, function (x) {
                        return Bridge.referenceEquals(x.Name, name) && Bridge.is(x, Core.Components.GridView);
                    }), Core.Components.GridView);
                    if (search != null) {
                        search.DataSourceFilter = DataSourceFilter;
                    }
                },
                FindClosest: function (T, component) {
                    var type = T;
                    if (Bridge.Reflection.isAssignableFrom(type, Bridge.getType(component))) {
                        return Bridge.as(component, T);
                    }

                    while (component.Parent != null) {
                        component = component.Parent;
                        if (Bridge.Reflection.isAssignableFrom(type, Bridge.getType(component))) {
                            return Bridge.as(component, T);
                        }
                    }
                    return Bridge.as(component, T);
                },
                FindClosest$1: function (T, component, predicate) {
                    var type = T;
                    if (Bridge.Reflection.isAssignableFrom(type, Bridge.getType(component)) && predicate(Bridge.as(component, T))) {
                        return Bridge.as(component, T);
                    }

                    while (component.Parent != null) {
                        component = component.Parent;
                        if (Bridge.Reflection.isAssignableFrom(type, Bridge.getType(component)) && predicate(Bridge.as(component, T))) {
                            return Bridge.as(component, T);
                        }
                    }
                    return Bridge.as(component, T);
                },
                FindComponentEvent: function (component, eventName) {
                    if (component == null) {
                        return null;
                    }

                    var parent = component.ParentForm;
                    while (parent != null && parent[eventName] == null) {
                        parent = parent.ParentForm;
                    }
                    var parentForm;
                    if (parent == null && ((parentForm = Bridge.as(component.Parent, Core.Components.Forms.EditForm))) != null) {
                        parent = parentForm;
                        while (parent != null && parent[eventName] == null) {
                            parent = parent.ParentForm;
                        }
                    }

                    return parent;
                },
                SetShow: function (component, show, fieldNames) {
                    if (fieldNames === void 0) { fieldNames = []; }
                    if (component == null) {
                        return;
                    }
                    Core.Extensions.IEnumerableExtensions.SelectForEach(Core.Components.EditableComponent, component.FilterChildren$1(function (x) {
                        return System.Array.contains(fieldNames, x.Name, System.String);
                    }), function (x) {
                        x.Show = show;
                    });
                },
                AlterPosition: function (element, parentEle) {
                    if (element == null || element.parentElement == null || parentEle == null) {
                        return;
                    }
                    var containerRect = parentEle.getBoundingClientRect();
                    var containerBottom = containerRect.bottom;
                    element.style.top = Core.Components.Extensions.ComponentExt.Auto;
                    element.style.right = Core.Components.Extensions.ComponentExt.Auto;
                    element.style.bottom = Core.Components.Extensions.ComponentExt.Auto;
                    element.style.left = Core.Components.Extensions.ComponentExt.Auto;
                    Core.Components.Renderer.Floating(Core.MVVM.Html.Take(element), containerBottom, containerRect.left);
                    if (Core.Extensions.HtmlElementExtension.OutOfViewport(element).Right) {
                        if (!Core.Extensions.HtmlElementExtension.OutOfViewport(element).Bottom) {
                            Core.Components.Extensions.ComponentExt.BottomCenter(element, parentEle);
                        } else if (containerRect.top > element.clientHeight) {
                            Core.Components.Extensions.ComponentExt.TopCenter(element, parentEle);
                        } else if (containerRect.left > element.clientWidth) {
                            Core.Components.Extensions.ComponentExt.LeftMiddle(element, parentEle);
                        }
                    }
                    if (Core.Extensions.HtmlElementExtension.OutOfViewport(element).Bottom) {
                        Core.Components.Extensions.ComponentExt.RightMiddle(element, parentEle);
                        if (Core.Extensions.HtmlElementExtension.OutOfViewport(element).Right) {
                            Core.Components.Extensions.ComponentExt.LeftMiddle(element, parentEle);
                        }
                        if (Core.Extensions.HtmlElementExtension.OutOfViewport(element).Left) {
                            Core.Components.Extensions.ComponentExt.TopCenter(element, parentEle);
                        }
                    }
                },
                BottomCenter: function (element, parent) {
                    var containerRect = parent.getBoundingClientRect();
                    element.style.right = Core.Components.Extensions.ComponentExt.Auto;
                    element.style.top = System.Double.format(containerRect.bottom) + (Core.Extensions.Utils.Pixel || "");
                    Core.Components.Extensions.ComponentExt.MoveLeft(element);
                },
                GetComputedPx: function (element, prop) {
                    var $t, $t1;
                    var computedVal = prop(window.getComputedStyle(element));
                    return ($t = (computedVal != null && ($t1 = System.String.replaceAll(computedVal, Core.Extensions.Utils.Pixel, "")) != null ? Core.Extensions.Utils.TryParse(System.Decimal, $t1) : System.Decimal.lift(null)), $t != null ? $t : System.Decimal(0));
                },
                TopCenter: function (element, parent) {
                    element.style.right = Core.Components.Extensions.ComponentExt.Auto;
                    Core.Components.Extensions.ComponentExt.MoveLeft(element);
                    Core.Components.Extensions.ComponentExt.MoveTop(element, parent);
                },
                MoveLeft: function (element) {
                    while (Core.Extensions.HtmlElementExtension.OutOfViewport(element).Right) {
                        var left = Core.Components.Extensions.ComponentExt.GetComputedPx(element, function (x) {
                                return x.left;
                            }).sub(System.Decimal(Core.Components.Extensions.ComponentExt.StepPx));
                        element.style.left = left + (Core.Extensions.Utils.Pixel || "");
                    }
                },
                MoveTop: function (element, parent) {
                    var $t;
                    if (parent === void 0) { parent = null; }
                    var parentTop = parent != null && ($t = parent.getBoundingClientRect()) != null ? $t.top : null;
                    while (Core.Extensions.HtmlElementExtension.OutOfViewport(element).Bottom || parent != null && System.Nullable.gt(element.getBoundingClientRect().bottom, parentTop)) {
                        var top = Core.Components.Extensions.ComponentExt.GetComputedPx(element, function (x) {
                                return x.top;
                            }).sub(System.Decimal((parent == null ? Core.Components.Extensions.ComponentExt.StepPx : 1)));
                        element.style.top = top + (Core.Extensions.Utils.Pixel || "");
                    }
                },
                LeftMiddle: function (element, parent) {
                    var containerRect = parent.getBoundingClientRect();
                    element.style.left = Core.Components.Extensions.ComponentExt.Auto;
                    element.style.bottom = Core.Components.Extensions.ComponentExt.Auto;
                    element.style.right = System.Double.format(containerRect.left) + (Core.Extensions.Utils.Pixel || "");
                    Core.Components.Extensions.ComponentExt.MoveTop(element);
                },
                RightMiddle: function (element, parent) {
                    var containerRect = parent.getBoundingClientRect();
                    element.style.right = Core.Components.Extensions.ComponentExt.Auto;
                    element.style.bottom = Core.Components.Extensions.ComponentExt.Auto;
                    element.style.left = System.Double.format(containerRect.right) + (Core.Extensions.Utils.Pixel || "");
                    Core.Components.Extensions.ComponentExt.MoveTop(element);
                },
                BuildGroupTree: function (list, groupKeys) {
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, groupKeys)) {
                        return list;
                    }

                    var firstKey = System.Linq.Enumerable.from(groupKeys, System.String).first();
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(firstKey)) {
                        return list;
                    }

                    return System.Linq.Enumerable.from(list, System.Object).groupBy(function (x) {
                            return x[firstKey];
                        }).select(function (x) {
                        var $t, $t1;
                        return ($t = new Core.Components.GroupRowData(), $t.Key = x.key(), $t.Children = ($t1 = System.Object, System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.BuildGroupTree(x.toList(System.Object), System.Linq.Enumerable.from(groupKeys, System.String).skip(1).ToArray(System.String)), $t1).toList($t1)), $t);
                    }).select(function (x) {{ return Bridge.cast(x, System.Object); }});
                },
                DownloadFile: function (filename, blob) {
                    var a = Bridge.as(document.createElement("a"), HTMLAnchorElement);
                    a.style.display = "none";
                    a.href = window.URL.createObjectURL(blob);
                    a.download = filename;

                    // Append anchor to body.
                    document.body.appendChild(a);
                    a.click();

                    // Remove anchor from body
                    document.body.removeChild(a);
                }
            }
        }
    });

    Bridge.define("$AnonymousType$2", $asm, {
        $kind: "anonymous",
        ctors: {
            ctor: function (name, id) {
                this.Name = name;
                this.Id = id;
            }
        },
        methods: {
            equals: function (o) {
                if (!Bridge.is(o, $asm.$AnonymousType$2)) {
                    return false;
                }
                return Bridge.equals(this.Name, o.Name) && Bridge.equals(this.Id, o.Id);
            },
            getHashCode: function () {
                var h = Bridge.addHash([7550196187, this.Name, this.Id]);
                return h;
            },
            toJSON: function () {
                return {
                    Name : this.Name,
                    Id : this.Id
                };
            }
        },
        statics : {
            methods: {
                $metadata : function () { return {"m":[{"a":2,"n":"Id","t":16,"rt":System.String,"g":{"a":2,"n":"get_Id","t":8,"rt":System.String,"fg":"Id"},"fn":"Id"},{"a":2,"n":"Name","t":16,"rt":System.String,"g":{"a":2,"n":"get_Name","t":8,"rt":System.String,"fg":"Name"},"fn":"Name"}]}; }
            }
        }
    });

    Bridge.define("Core.Components.Extensions.ComponentFactory", {
        statics: {
            methods: {
                GetComponent: function (ui, form, ele) {
                    if (ele === void 0) { ele = null; }
                    if (ui == null) {
                        throw new System.ArgumentNullException.$ctor1("ui");
                    }

                    if (Core.Extensions.StringExt.IsNullOrEmpty(ui.ComponentType)) {
                        throw new System.InvalidOperationException.$ctor1(System.String.format("Component type of {0} is null.", [ui.Id]));
                    }

                    ui.ComponentType = ui.ComponentType.trim();
                    var childComponent;
                    switch (ui.ComponentType) {
                        case "GridView": 
                            if (Core.Extensions.StringExt.IsNullOrWhiteSpace(ui.GroupBy)) {
                                childComponent = new Core.Components.GridView(ui);
                            } else {
                                childComponent = new Core.Components.GroupGridView(ui);
                            }
                            break;
                        case "ListView": 
                            if (Core.Extensions.StringExt.IsNullOrWhiteSpace(ui.GroupBy)) {
                                childComponent = new Core.Components.ListView(ui);
                            } else {
                                childComponent = new Core.Components.GroupListView(ui);
                            }
                            break;
                        default: 
                            childComponent = null;
                            var current = Core.Components.EditableComponent;
                            var fullName = System.String.indexOf(ui.ComponentType, ".") >= 0 ? ui.ComponentType : (Bridge.Reflection.getTypeNamespace(current) || "") + "." + (ui.ComponentType || "");
                            var args = "a, b";
                            var body = System.String.format("return new {0}(a, b)", [fullName]);
                            var typeConstructor = new Function(args, body);
                            childComponent = Bridge.as(typeConstructor.call(null, ui, ele), Core.Components.EditableComponent);
                            break;
                    }
                    childComponent.Id = (ui.FieldName || "") + (Bridge.toString(ui.Id) || "");
                    childComponent.Name = ui.FieldName;
                    childComponent.ComponentType = ui.ComponentType;
                    childComponent.EditForm = form;
                    return childComponent;
                },
                CompositedComponents: function (gui, form) {
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(gui.FieldName) || Core.Extensions.StringExt.IsNullOrWhiteSpace(gui.ComponentType)) {
                        return null;
                    }

                    var fields = System.String.split(gui.FieldName, [44].map(function (i) {{ return String.fromCharCode(i); }}));
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, fields)) {
                        return null;
                    }

                    gui.ComponentType = gui.ComponentType.trim();
                    var nonChar = System.Linq.Enumerable.from(gui.ComponentType, System.Char).where(function (x) {
                            return !(x >= 97 && x <= 122 || x >= 65 && x <= 90);
                        }).ToArray(System.Char);
                    if (System.Linq.Enumerable.from(fields, System.String).count() !== ((nonChar.length + 1) | 0)) {
                        return null;
                    }

                    var section = new Core.Components.Section.$ctor1(Core.MVVM.ElementType.div);
                    section.DOMContentLoaded = Bridge.fn.combine(section.DOMContentLoaded, function () {
                        Core.Extensions.IEnumerableExtensions.SelectForEach$1(System.String, fields, function (field, index) {
                            var startIndex = index === 0 ? 0 : System.String.indexOf(gui.ComponentType, String.fromCharCode(nonChar[System.Array.index(((index - 1) | 0), nonChar)]));
                            var endIndex = index === ((fields.length - 1) | 0) ? ((gui.ComponentType.length - 1) | 0) : ((System.String.indexOf(gui.ComponentType, String.fromCharCode(nonChar[System.Array.index(index, nonChar)])) - 1) | 0);
                            var componentType = gui.ComponentType.substr(startIndex, ((endIndex - startIndex) | 0));
                            var childGui = new Core.Models.Component();
                            Core.Extensions.ReflectionExt.CopyPropFrom(childGui, gui);
                            childGui.ComponentType = componentType;
                            childGui.FieldName = field;
                            section.AddChild(Core.Components.Extensions.ComponentFactory.GetComponent(childGui, form));
                            if (nonChar.length > index) {
                                section.Element.appendChild(document.createTextNode(String.fromCharCode(nonChar[System.Array.index(index, nonChar)])));
                            }
                        });
                    });
                    return section;
                }
            }
        }
    });

    Bridge.define("Core.Components.Forms.ContextMenuItem", {
        props: {
            Ele: null,
            Icon: null,
            Style: null,
            Text: null,
            Click: null,
            Disabled: false,
            Parameter: null,
            MenuItems: null
        }
    });

    Bridge.define("Core.Components.GroupRowData", {
        props: {
            Key: null,
            Children: null
        }
    });

    Bridge.define("Core.Components.ListViewSearchVM", {
        props: {
            SearchTerm: null,
            FullTextSearch: null,
            ScanTerm: null,
            StartDate: null,
            DateTimeField: null,
            EndDate: null
        }
    });

    Bridge.define("Core.Components.PaginationOptions", {
        props: {
            Total: 0,
            PageSize: 0,
            Selected: 0,
            PageIndex: 0,
            PageNumber: 0,
            CurrentPageCount: 0,
            StartIndex: 0,
            EndIndex: 0,
            ClickHandler: null
        }
    });

    Bridge.define("Core.Components.Position", {
        $kind: "enum",
        statics: {
            fields: {
                absolute: 0,
                fixed: 1,
                inherit: 2,
                initial: 3,
                relative: 4,
                static: 5,
                sticky: 6,
                unset: 7
            }
        }
    });

    Bridge.define("Core.Components.Renderer", {
        statics: {
            methods: {
                ColSpan: function (html, colSpan) {
                    return html.Attr$1("colspan", Bridge.toString(colSpan));
                },
                RowSpan: function (html, colSpan) {
                    return html.Attr$1("rowspan", Bridge.toString(colSpan));
                },
                Panel: function (html, text) {
                    if (text === void 0) { text = ""; }
                    html.Div.Render();
                    if (!System.String.isNullOrEmpty(text)) {
                        Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(html.Label, "header"), text).End.Render();
                    }

                    return html;
                },
                Button: function (html, text, className, icon) {
                    if (text === void 0) { text = ""; }
                    if (className === void 0) { className = "button info small"; }
                    if (icon === void 0) { icon = ""; }
                    html.Button.Render();
                    if (!System.String.isNullOrEmpty(icon)) {
                        Core.Components.Renderer.ClassName(html.Span, icon).End.Text(" ").Render();
                    }
                    return Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(html, className), text);
                },
                SmallInput: function (html, value, align) {
                    if (value === void 0) { value = ""; }
                    if (align === void 0) { align = "left"; }
                    return Core.Components.Renderer.ClassName(html.Input, "input-small " + (align || "")).Attr$1("data-role", "input").Value(value);
                },
                PlaceHolder: function (html, langKey) {
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(langKey)) {
                        return html;
                    }
                    Core.Components.Renderer.MarkLangProp(html.GetContext(), langKey, "placeholder");

                    return html.Attr$1("placeholder", Core.Components.LangSelect.Get(langKey));
                },
                MarkLangProp: function (ctx, langKey, propName, parameters) {
                    if (parameters === void 0) { parameters = []; }
                    ctx[(Core.Components.LangSelect.LangKey || "") + (propName || "")] = langKey;
                    if (Core.Extensions.IEnumerableExtensions.HasElement(System.Object, parameters)) {
                        ctx[(Core.Components.LangSelect.LangParam || "") + (propName || "")] = parameters;
                    }

                    var prop = ctx[Core.Components.LangSelect.LangProp];
                    var newProp = prop == null ? propName : System.String.concat(prop, ",", propName);
                    ctx[Core.Components.LangSelect.LangProp] = Core.Extensions.IEnumerableExtensions.Combine(System.String, System.Linq.Enumerable.from(newProp.split(","), System.String).distinct());
                },
                Title: function (html, langKey) {
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(langKey)) {
                        return html;
                    }
                    Core.Components.Renderer.MarkLangProp(html.GetContext(), langKey, "title");
                    return html.Attr$1("title", Core.Components.LangSelect.Get(langKey));
                },
                SmallCheckbox: function (html, value) {
                    if (value === void 0) { value = false; }
                    Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(html.Label, "checkbox input-small transition-on style2").Input.Attr$1("type", "checkbox").Type$1("checkbox").End.Span, "check myCheckbox");
                    var chk = Bridge.as(Core.MVVM.Html.Context.previousElementSibling, HTMLInputElement);
                    chk.checked = value;
                    return html;
                },
                Disabled: function (html, disabled) {
                    if (disabled === false) {
                        Core.MVVM.Html.Context.removeAttribute("disabled");
                        return html;
                    }
                    return html.Attr$1("disabled", "disabled");
                },
                Margin: function (html, direction, margin, unit) {
                    if (unit === void 0) { unit = "px"; }
                    return html.Style$1(System.String.format("margin-{0} : {1}{2}", Bridge.box(direction, Core.Components.Direction, System.Enum.toStringFn(Core.Components.Direction)), Bridge.box(margin, System.Double, System.Double.format, System.Double.getHashCode), unit));
                },
                MarginRem: function (html, direction, margin) {
                    return html.Style$1(System.String.format("margin-{0} : {1}rem", Bridge.box(direction, Core.Components.Direction, System.Enum.toStringFn(Core.Components.Direction)), Bridge.box(margin, System.Double, System.Double.format, System.Double.getHashCode)));
                },
                Padding: function (html, direction, padding, unit) {
                    if (unit === void 0) { unit = "px"; }
                    return html.Style$1(System.String.format("padding-{0} : {1}{2}", Bridge.box(direction, Core.Components.Direction, System.Enum.toStringFn(Core.Components.Direction)), Bridge.box(padding, System.Double, System.Double.format, System.Double.getHashCode), unit));
                },
                Width: function (html, width) {
                    return html.Style$1(System.String.format("width: {0}", [width]));
                },
                /**
                 * Set sticky position to the Html Context
                 *
                 * @static
                 * @public
                 * @this Core.Components.Renderer
                 * @memberof Core.Components.Renderer
                 * @param   {Core.MVVM.Html}    html    
                 * @param   {string}            top     Set top to 0 if it's aligned top with previous element
                 * @param   {string}            left    Set top to 0 if it's aligned left with previous element
                 * @return  {Core.MVVM.Html}
                 */
                Sticky: function (html, top, left) {
                    if (top === void 0) { top = null; }
                    if (left === void 0) { left = null; }
                    var context = Core.MVVM.Html.Context;
                    if (context == null) {
                        return html;
                    }
                    if (context.previousElementSibling != null && Bridge.referenceEquals(Bridge.getType(context), Bridge.getType(context.previousElementSibling))) {
                        if (Bridge.referenceEquals(left, Bridge.toString((0)))) {
                            left = context.offsetLeft + (Core.Extensions.Utils.Pixel || "");
                        } else if (Bridge.referenceEquals(top, Bridge.toString((0)))) {
                            top = context.offsetTop + (Core.Extensions.Utils.Pixel || "");
                        }
                    }
                    if (top != null) {
                        html.Style$1(System.String.format("top: {0};", [top]));
                    }
                    if (left != null) {
                        html.Style$1(System.String.format("left: {0};", [left]));
                    }
                    return html.Style$1("position: sticky; z-index: 1;");
                },
                TextAlign: function (html, alignment) {
                    if (alignment === void 0) { alignment = 8; }
                    return html.Style$1("text-align: " + (System.Nullable.toString(alignment, System.Enum.toStringFn(Core.Enums.TextAlign)) || ""));
                },
                Position: function (html, direction, value) {
                    return html.Style$1(System.String.format("{0}: {1}px", Core.Extensions.ReflectionExt.GetEnumDescription(Bridge.box(direction, Core.Components.Direction, System.Enum.toStringFn(Core.Components.Direction))), Bridge.box(value, System.Double, System.Double.format, System.Double.getHashCode)));
                },
                Position$1: function (html, position) {
                    return html.Style$1(System.String.format("position: {0}", [Core.Extensions.ReflectionExt.GetEnumDescription(Bridge.box(position, Core.Components.Position, System.Enum.toStringFn(Core.Components.Position)))]));
                },
                /**
                 * Render icon inside span, non auto-closing
                 *
                 * @static
                 * @public
                 * @this Core.Components.Renderer
                 * @memberof Core.Components.Renderer
                 * @param   {Core.MVVM.Html}    html    
                 * @param   {string}            icon
                 * @return  {Core.MVVM.Html}
                 */
                Icon: function (html, icon) {
                    var isIconClass = System.String.contains(icon,"mif") || System.String.contains(icon,"fa") || System.String.contains(icon,"fa-");
                    Core.Components.Renderer.ClassName(html.Span, "icon");
                    if (isIconClass) {
                        Core.Components.Renderer.ClassName(html, icon).Render();
                    } else {
                        Core.Components.Renderer.ClassName(html.Style$1(System.String.format("background-image: url({0});", [(Core.Clients.Client.Origin || "") + (icon || "")])), "iconBg").Render();
                    }

                    return html;
                },
                Escape: function (html, action) {
                    var div = Core.MVVM.Html.Context;
                    div.tabIndex = -1;
                    div.focus();
                    div.addEventListener("keydown", function (e) {
                        if (System.Nullable.eq(Bridge.unbox(e.keyCode), 27)) {
                            var parent = div.parentElement;
                            e.stopPropagation();
                            action(e);
                            parent.focus();
                        }
                    });
                    return html;
                },
                IconForSpan: function (html, iconClass) {
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(iconClass)) {
                        return html;
                    }

                    iconClass = iconClass.trim();
                    var span = Core.MVVM.Html.Context;
                    Core.Components.Renderer.ClassName(html, "icon");
                    var isIconClass = System.String.contains(iconClass,"mif") || System.String.contains(iconClass,"fa") || System.String.contains(iconClass,"fa-");
                    if (isIconClass) {
                        Core.Extensions.HtmlElementExtension.AddClass(span, iconClass);
                    } else {
                        Core.Extensions.HtmlElementExtension.AddClass(span, "iconBg");
                        span.style["background-image"] = "url(" + (iconClass || "") + ")";
                    }
                    return html;
                },
                Floating: function (html, top, left) {
                    return Core.Components.Renderer.Position(Core.Components.Renderer.Position(Core.Components.Renderer.Position$1(html, Core.Components.Position.fixed), Core.Components.Direction.top, top), Core.Components.Direction.left, left);
                },
                TabIndex: function (html, tabIndex) {
                    return html.Attr$1("tabindex", Bridge.toString(tabIndex));
                },
                ClassName: function (html, className) {
                    if (System.String.isNullOrEmpty(className)) {
                        return html;
                    }
                    var ctx = Core.MVVM.Html.Context;
                    var translated = Core.Components.LangSelect.Get(className);
                    Core.Components.Renderer.MarkLangProp(ctx, className, "ClassName");
                    var res = (ctx.className || "") + " " + (translated || "");
                    ctx.className = res.trim();
                    return html;
                },
                IHtml: function (html, langKey, parameters) {
                    if (parameters === void 0) { parameters = []; }
                    if (System.String.isNullOrEmpty(langKey)) {
                        return html;
                    }
                    var ctx = Core.MVVM.Html.Context;
                    var translated = Core.Components.LangSelect.Get(langKey);
                    Core.Components.Renderer.MarkLangProp(ctx, langKey, "InnerHTML", parameters);
                    ctx.innerHTML = translated;
                    return html;
                },
                IText: function (html, langKey, parameters) {
                    if (parameters === void 0) { parameters = []; }
                    if (System.String.isNullOrEmpty(langKey)) {
                        return html;
                    }
                    var translated = Core.Components.LangSelect.Get(langKey);
                    var textNode = document.createTextNode(Core.Extensions.IEnumerableExtensions.HasElement(System.Object, parameters) ? System.String.format.apply(System.String, [translated].concat(parameters)) : translated);
                    Core.Components.Renderer.MarkLangProp(textNode, langKey, "TextContent", parameters);
                    html.GetContext().appendChild(textNode);
                    return html;
                }
            }
        }
    });

    Bridge.define("Core.Components.Spinner", {
        statics: {
            fields: {
                _instance: null,
                _span: null,
                _backdrop: null,
                _hiddenAwaiter: 0
            },
            methods: {
                Init: function () {
                    if (Core.Components.Spinner._instance != null) {
                        return;
                    }

                    Core.Components.Spinner._instance = new Core.Components.Spinner();
                    var existing = document.getElementById("spinner");
                    if (existing == null) {
                        Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div, "backdrop").Style$1("background: transparent !important;").End.Span, "spinner");
                        Core.Components.Spinner._span = Core.MVVM.Html.Context;
                    } else {
                        Core.Components.Spinner._span = existing;
                    }
                    Core.Components.Spinner._backdrop = Core.Components.Spinner._span.previousElementSibling;
                    Core.Components.Spinner._span.style.display = System.Enum.toString(System.String, "none");
                    Core.Components.Spinner._backdrop.style.display = System.Enum.toString(System.String, "none");
                },
                AppendTo: function (node, lockScreen, autoHide, timeout) {
                    if (lockScreen === void 0) { lockScreen = true; }
                    if (autoHide === void 0) { autoHide = true; }
                    if (timeout === void 0) { timeout = 7000; }
                    if (Core.Components.Spinner._span == null) {
                        return;
                    }
                    if (Bridge.referenceEquals(Core.Components.Spinner._span.parentElement, node) && Bridge.referenceEquals(Bridge.toString(Core.Components.Spinner._span.style.display), "")) {
                        return;
                    }
                    if (node != null) {
                        node.appendChild(Core.Components.Spinner._span);
                    } else {
                        document.body.appendChild(Core.Components.Spinner._span);
                    }

                    Core.Components.Spinner._span.style.display = "";
                    if (lockScreen) {
                        Core.Components.Spinner._backdrop.style.display = "";
                    }
                    if (!autoHide) {
                        return;
                    }
                    window.clearTimeout(Core.Components.Spinner._hiddenAwaiter);
                    Core.Components.Spinner._hiddenAwaiter = window.setTimeout(Core.Components.Spinner.Hide, timeout);
                },
                Hide: function () {
                    if (Core.Components.Spinner._span != null) {
                        Core.Components.Spinner._span.style.display = System.Enum.toString(System.String, "none");
                        Core.Components.Spinner._backdrop.style.display = System.Enum.toString(System.String, "none");
                    }
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
            }
        }
    });

    Bridge.define("Core.Enums.ActiveStateEnum", {
        $kind: "enum",
        statics: {
            fields: {
                All: 2,
                Yes: 1,
                No: 0
            }
        }
    });

    Bridge.define("Core.Enums.AdvSearchOperation", {
        $kind: "enum",
        statics: {
            fields: {
                Equal: 1,
                NotEqual: 2,
                GreaterThan: 3,
                GreaterThanOrEqual: 4,
                LessThan: 5,
                LessThanOrEqual: 6,
                Contains: 7,
                NotContains: 8,
                StartWith: 9,
                NotStartWith: 10,
                EndWidth: 11,
                NotEndWidth: 12,
                In: 13,
                NotIn: 14,
                EqualDatime: 15,
                GreaterThanDatime: 21,
                LessThanDatime: 22,
                NotEqualDatime: 16,
                EqualNull: 17,
                NotEqualNull: 18,
                Like: 19,
                NotLike: 20,
                GreaterEqualDatime: 23,
                LessEqualDatime: 24
            }
        }
    });

    Bridge.define("Core.Enums.ComponentTypeTypeEnum", {
        $kind: "enum",
        statics: {
            fields: {
                Dropdown: 1,
                SearchEntry: 1,
                MultipleSearchEntry: 1,
                Datepicker: 2,
                Number: 3,
                Textbox: 4,
                Checkbox: 5
            }
        }
    });

    Bridge.define("Core.Enums.CustomEventType", {
        $kind: "enum",
        statics: {
            fields: {
                BeforeCopied: 0,
                AfterWebsocket: 1,
                AfterCopied: 2,
                BeforeDeleted: 3,
                AfterDeleted: 4,
                Deactivated: 5,
                BeforePasted: 6,
                AfterPasted: 7,
                BeforeCreated: 8,
                AfterCreated: 9,
                BeforeEmptyRowCreated: 10,
                AfterEmptyRowCreated: 11,
                BeforeCreatedList: 12,
                AfterCreatedList: 13,
                Selected: 14,
                RowFocusIn: 15,
                RowFocusOut: 16,
                RowMouseEnter: 17,
                RowMouseLeave: 18,
                OpenRef: 19,
                BeforePatchUpdate: 20,
                ValidatePatchUpdate: 21,
                BeforePatchCreate: 22,
                AfterPatchUpdate: 23
            }
        }
    });

    Bridge.define("Core.Enums.HttpMethod", {
        $kind: "enum",
        statics: {
            fields: {
                GET: 0,
                POST: 1,
                PUT: 2,
                PATCH: 3,
                DELETE: 4
            }
        }
    });

    /** @namespace Core.Enums */

    /**
     * @public
     * @class Core.Enums.HttpStatusCode
     */
    Bridge.define("Core.Enums.HttpStatusCode", {
        $kind: "enum",
        statics: {
            fields: {
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 100
                 * @type Core.Enums.HttpStatusCode
                 */
                Continue: 100,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 101
                 * @type Core.Enums.HttpStatusCode
                 */
                SwitchingProtocols: 101,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 200
                 * @type Core.Enums.HttpStatusCode
                 */
                OK: 200,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 201
                 * @type Core.Enums.HttpStatusCode
                 */
                Created: 201,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 202
                 * @type Core.Enums.HttpStatusCode
                 */
                Accepted: 202,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 203
                 * @type Core.Enums.HttpStatusCode
                 */
                NonAuthoritativeInformation: 203,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 204
                 * @type Core.Enums.HttpStatusCode
                 */
                NoContent: 204,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 205
                 * @type Core.Enums.HttpStatusCode
                 */
                ResetContent: 205,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 206
                 * @type Core.Enums.HttpStatusCode
                 */
                PartialContent: 206,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 300
                 * @type Core.Enums.HttpStatusCode
                 */
                MultipleChoices: 300,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 300
                 * @type Core.Enums.HttpStatusCode
                 */
                Ambiguous: 300,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 301
                 * @type Core.Enums.HttpStatusCode
                 */
                MovedPermanently: 301,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 301
                 * @type Core.Enums.HttpStatusCode
                 */
                Moved: 301,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 302
                 * @type Core.Enums.HttpStatusCode
                 */
                Found: 302,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 302
                 * @type Core.Enums.HttpStatusCode
                 */
                Redirect: 302,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 303
                 * @type Core.Enums.HttpStatusCode
                 */
                SeeOther: 303,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 303
                 * @type Core.Enums.HttpStatusCode
                 */
                RedirectMethod: 303,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 304
                 * @type Core.Enums.HttpStatusCode
                 */
                NotModified: 304,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 305
                 * @type Core.Enums.HttpStatusCode
                 */
                UseProxy: 305,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 306
                 * @type Core.Enums.HttpStatusCode
                 */
                Unused: 306,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 307
                 * @type Core.Enums.HttpStatusCode
                 */
                TemporaryRedirect: 307,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 307
                 * @type Core.Enums.HttpStatusCode
                 */
                RedirectKeepVerb: 307,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 400
                 * @type Core.Enums.HttpStatusCode
                 */
                BadRequest: 400,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 401
                 * @type Core.Enums.HttpStatusCode
                 */
                Unauthorized: 401,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 402
                 * @type Core.Enums.HttpStatusCode
                 */
                PaymentRequired: 402,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 403
                 * @type Core.Enums.HttpStatusCode
                 */
                Forbidden: 403,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 404
                 * @type Core.Enums.HttpStatusCode
                 */
                NotFound: 404,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 405
                 * @type Core.Enums.HttpStatusCode
                 */
                MethodNotAllowed: 405,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 406
                 * @type Core.Enums.HttpStatusCode
                 */
                NotAcceptable: 406,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 407
                 * @type Core.Enums.HttpStatusCode
                 */
                ProxyAuthenticationRequired: 407,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 408
                 * @type Core.Enums.HttpStatusCode
                 */
                RequestTimeout: 408,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 409
                 * @type Core.Enums.HttpStatusCode
                 */
                Conflict: 409,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 410
                 * @type Core.Enums.HttpStatusCode
                 */
                Gone: 410,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 411
                 * @type Core.Enums.HttpStatusCode
                 */
                LengthRequired: 411,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 412
                 * @type Core.Enums.HttpStatusCode
                 */
                PreconditionFailed: 412,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 413
                 * @type Core.Enums.HttpStatusCode
                 */
                RequestEntityTooLarge: 413,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 414
                 * @type Core.Enums.HttpStatusCode
                 */
                RequestUriTooLong: 414,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 415
                 * @type Core.Enums.HttpStatusCode
                 */
                UnsupportedMediaType: 415,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 416
                 * @type Core.Enums.HttpStatusCode
                 */
                RequestedRangeNotSatisfiable: 416,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 417
                 * @type Core.Enums.HttpStatusCode
                 */
                ExpectationFailed: 417,
                UpgradeRequired: 426,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 500
                 * @type Core.Enums.HttpStatusCode
                 */
                InternalServerError: 500,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 501
                 * @type Core.Enums.HttpStatusCode
                 */
                NotImplemented: 501,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 502
                 * @type Core.Enums.HttpStatusCode
                 */
                BadGateway: 502,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 503
                 * @type Core.Enums.HttpStatusCode
                 */
                ServiceUnavailable: 503,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 504
                 * @type Core.Enums.HttpStatusCode
                 */
                GatewayTimeout: 504,
                /**
                 * @static
                 * @public
                 * @memberof Core.Enums.HttpStatusCode
                 * @constant
                 * @default 505
                 * @type Core.Enums.HttpStatusCode
                 */
                HttpVersionNotSupported: 505
            }
        }
    });

    Bridge.define("Core.Enums.KeyCodeEnum", {
        $kind: "enum",
        statics: {
            fields: {
                Backspace: 8,
                Tab: 9,
                Enter: 13,
                Shift: 16,
                Ctrl: 17,
                Alt: 18,
                PauseBreak: 19,
                CapsLock: 20,
                Escape: 27,
                PageUp: 33,
                PageDown: 34,
                End: 35,
                Home: 36,
                LeftArrow: 37,
                UpArrow: 38,
                RightArrow: 39,
                DownArrow: 40,
                Insert: 45,
                Delete: 46,
                Zero: 48,
                One: 49,
                Two: 50,
                Three: 51,
                Four: 52,
                Five: 53,
                Six: 54,
                Seven: 55,
                Eight: 56,
                Nine: 57,
                A: 65,
                B: 66,
                C: 67,
                D: 68,
                E: 69,
                F: 70,
                G: 71,
                H: 72,
                I: 73,
                J: 74,
                K: 75,
                L: 76,
                M: 77,
                N: 78,
                O: 79,
                P: 80,
                Q: 81,
                R: 82,
                S: 83,
                T: 84,
                U: 85,
                V: 86,
                W: 87,
                X: 88,
                Y: 89,
                Z: 90,
                LeftWindowKey: 91,
                RightWindowKey: 92,
                SelectKey: 93,
                Numpad0: 96,
                Numpad1: 97,
                Numpad2: 98,
                Numpad3: 99,
                Numpad4: 100,
                Numpad5: 101,
                Numpad6: 102,
                Numpad7: 103,
                Numpad8: 104,
                Numpad9: 105,
                Multiply: 106,
                Add: 107,
                Subtract: 109,
                DecimalPoint: 110,
                Divide: 111,
                F1: 112,
                F2: 113,
                F3: 114,
                F4: 115,
                F5: 116,
                F6: 117,
                F7: 118,
                F8: 119,
                F9: 120,
                F10: 121,
                F11: 122,
                F12: 123,
                NumLock: 144,
                ScrollLock: 145,
                SemiColon: 186,
                EqualSign: 187,
                Comma: 188,
                Dash: 189,
                Period: 190,
                ForwardSlash: 191,
                GraveAccent: 192,
                OpenBracket: 219,
                BackSlash: 220,
                CloseBraket: 221,
                SingleQuote: 222
            }
        }
    });

    Bridge.define("Core.Enums.LogicOperation", {
        $kind: "enum",
        statics: {
            fields: {
                And: 0,
                Or: 1
            }
        }
    });

    Bridge.define("Core.Enums.OperatorEnum", {
        $kind: "enum",
        statics: {
            fields: {
                In: 1,
                NotIn: 2,
                Gt: 3,
                Ge: 4,
                Lt: 5,
                Le: 6,
                Lr: 7,
                Rl: 8
            }
        }
    });

    Bridge.define("Core.Enums.OrderbyDirection", {
        $kind: "enum",
        statics: {
            fields: {
                ASC: 1,
                DESC: 2
            }
        }
    });

    Bridge.define("Core.Enums.RoleEnum", {
        $kind: "enum",
        statics: {
            fields: {
                System: 8
            }
        }
    });

    Bridge.define("Core.Enums.RoleSelection", {
        $kind: "enum",
        statics: {
            fields: {
                TopFirst: 1,
                BottomFirst: 2
            }
        }
    });

    Bridge.define("Core.Enums.TaskStateEnum", {
        $kind: "enum",
        statics: {
            fields: {
                UnreadStatus: 339,
                Read: 340,
                Processing: 341,
                Proceeded: 342
            }
        }
    });

    Bridge.define("Core.Enums.TextAlign", {
        $kind: "enum",
        statics: {
            fields: {
                center: 0,
                end: 1,
                inherit: 2,
                initial: 3,
                justify: 4,
                left: 5,
                right: 6,
                start: 7,
                unset: 8
            }
        }
    });

    Bridge.define("Core.Enums.TypeEntityAction", {
        $kind: "enum",
        statics: {
            fields: {
                UpdateEntity: 1,
                UpdateCountBadge: 2,
                Message: 3,
                MessageCountBadge: 4
            }
        }
    });

    Bridge.define("Core.Extensions.AdvOptionExt", {
        statics: {
            fields: {
                OperationToSql: null
            },
            ctors: {
                init: function () {
                    this.OperationToSql = function (_o1) {
                            _o1.add(Core.Enums.AdvSearchOperation.Equal, "{0} = N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.NotEqual, "{0} != N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.GreaterThan, "{0} > N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.GreaterThanOrEqual, "{0} >= N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.LessThan, "{0} < N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.LessThanOrEqual, "{0} <= N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.Contains, "charindex(N'{1}', {0}) >= 1");
                            _o1.add(Core.Enums.AdvSearchOperation.NotContains, "contains({0}, N'{1}') eq false");
                            _o1.add(Core.Enums.AdvSearchOperation.StartWith, "charindex(N'{1}', {0}) = 1");
                            _o1.add(Core.Enums.AdvSearchOperation.NotStartWith, "charindex(N'{1}', {0}) > 1");
                            _o1.add(Core.Enums.AdvSearchOperation.EndWidth, "{0} like N'%{1}')");
                            _o1.add(Core.Enums.AdvSearchOperation.NotEndWidth, "{0} not like N'%{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.In, "{0} in ({1})");
                            _o1.add(Core.Enums.AdvSearchOperation.Like, "{0} like N'%{1}%'");
                            _o1.add(Core.Enums.AdvSearchOperation.NotLike, "{0} not like N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.NotIn, "{0} not in ({1})");
                            _o1.add(Core.Enums.AdvSearchOperation.EqualDatime, "cast(date, {0}) = N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.NotEqualDatime, "cast(date, {0}) != N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.EqualNull, "{0} is null");
                            _o1.add(Core.Enums.AdvSearchOperation.NotEqualNull, "{0} is not null");
                            _o1.add(Core.Enums.AdvSearchOperation.GreaterThanDatime, "cast(date, {0}) > N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.GreaterEqualDatime, "cast(date, {0}) >= N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.LessThanDatime, "cast(date, {0}) < N'{1}'");
                            _o1.add(Core.Enums.AdvSearchOperation.LessEqualDatime, "cast(date, {0}) <= N'{1}'");
                            return _o1;
                        }(new (System.Collections.Generic.Dictionary$2(Core.Enums.AdvSearchOperation,System.String)).ctor());
                }
            }
        }
    });

    Bridge.define("Core.Extensions.BridgeExt", {
        statics: {
            methods: {
                SetComplexPropValue: function (obj, propName, value) {
                    if (obj == null || System.String.isNullOrWhiteSpace(propName)) {
                        return;
                    }

                    var hierarchy = System.String.split(propName, [46].map(function (i) {{ return String.fromCharCode(i); }}));
                    if (hierarchy.length === 0) {
                        return;
                    }

                    if (hierarchy.length === 1) {
                        Core.Extensions.BridgeExt.SetPropValue(obj, propName, value);
                        return;
                    }
                    var leaf = obj;
                    for (var i = 0; i < ((hierarchy.length - 1) | 0); i = (i + 1) | 0) {
                        if (leaf == null) {
                            return;
                        }

                        var key = hierarchy[System.Array.index(i, hierarchy)];
                        leaf = Core.Extensions.Utils.GetPropValue(leaf, key);
                    }
                    if (leaf == null) {
                        return;
                    }

                    Core.Extensions.BridgeExt.SetPropValue(leaf, Bridge.toString(hierarchy[System.Array.index(((hierarchy.length - 1) | 0), hierarchy)]), value);
                },
                CustomFormat: function (date, format) {
                    if (format === void 0) { format = "dd/MM/yyyy"; }
                    if (Bridge.equals(date, null)) {
                        return "";
                    }

                    var dateTime = System.DateTime.parse(date);
                    return System.DateTime.format(dateTime, format);
                },
                CastProp: function (T, obj) {
                    if (obj == null) {
                        return Bridge.getDefaultValue(T);
                    }

                    var res;
                    res = Bridge.cast(Bridge.unbox(Bridge.createInstance(T), T), T);
                    Core.Extensions.ReflectionExt.CopyPropFrom(res, obj);
                    return res;
                },
                SetPropValue: function (instance, propertyName, value) {
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(propertyName)) {
                        return;
                    }
                    var type = Bridge.getType(instance);
                    var prop = Bridge.Reflection.getMembers(type, 16, 284, propertyName);
                    if (prop != null && type != null && (!!prop.s)) {
                        Bridge.Reflection.midel(prop.s, instance).apply(null, (null || []).concat(value));
                    } else if (prop == null && instance != null) {
                        instance[propertyName] = value;
                    }
                },
                /**
                 * @static
                 * @public
                 * @this Core.Extensions.BridgeExt
                 * @memberof Core.Extensions.BridgeExt
                 * @param   {System.Object}          obj         
                 * @param   {string}                 propName
                 * @return  {System.ValueTuple$2}                T1: The object has the complex key <br /> T2: The complex propperty value
                 */
                GetComplexProp: function (obj, propName) {
                    var $t;
                    if (obj == null || System.String.isNullOrWhiteSpace(propName)) {
                        return new (System.ValueTuple$2(System.Boolean,System.Object)).$ctor1(false, null);
                    }

                    var hierarchy = System.String.split(propName, [46].map(function (i) {{ return String.fromCharCode(i); }}));
                    if (hierarchy.length === 0) {
                        return new (System.ValueTuple$2(System.Boolean,System.Object)).$ctor1(false, null);
                    }

                    if (hierarchy.length === 1) {
                        return new (System.ValueTuple$2(System.Boolean,System.Object)).$ctor1(obj.hasOwnProperty(propName) || Bridge.Reflection.getMembers(Bridge.getType(obj), 16, 284, propName) != null, obj[propName]);
                    }

                    var lastField = System.Linq.Enumerable.from(hierarchy, System.String).lastOrDefault(null, null);
                    hierarchy = System.Linq.Enumerable.from(hierarchy, System.String).take(((hierarchy.length - 1) | 0)).ToArray(System.String);
                    var res = obj;
                    $t = Bridge.getEnumerator(hierarchy);
                    try {
                        while ($t.moveNext()) {
                            var key = $t.Current;
                            if (res == null) {
                                return new (System.ValueTuple$2(System.Boolean,System.Object)).$ctor1(false, null);
                            }

                            res = res[key];
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    if (res == null) {
                        return new (System.ValueTuple$2(System.Boolean,System.Object)).$ctor1(false, null);
                    }

                    return new (System.ValueTuple$2(System.Boolean,System.Object)).$ctor1(res.hasOwnProperty(lastField) || Bridge.Reflection.getMembers(Bridge.getType(res), 16, 284, lastField) != null, res[lastField]);
                },
                /**
                 * Get complex property value and type
                 *
                 * @static
                 * @public
                 * @this Core.Extensions.BridgeExt
                 * @memberof Core.Extensions.BridgeExt
                 * @param   {System.Type}      type        
                 * @param   {string}           propName    
                 * @param   {System.Object}    obj
                 * @return  {System.Type}                  T1: The type of the complex property<br /> T2: The complex propperty value
                 */
                GetComplexPropType: function (type, propName, obj) {
                    var $t, $t1;
                    if (obj === void 0) { obj = null; }
                    if (type == null || System.String.isNullOrWhiteSpace(propName)) {
                        return null;
                    }

                    obj = ($t = obj, $t != null ? $t : Bridge.createInstance(type));
                    var hierarchy = System.String.split(propName, [46].map(function (i) {{ return String.fromCharCode(i); }}));
                    if (hierarchy.length === 0) {
                        return null;
                    }

                    if (hierarchy.length === 1) {
                        return Core.Extensions.BridgeExt.GetObjType(propName, obj);
                    }
                    var lastField = System.Linq.Enumerable.from(hierarchy, System.String).lastOrDefault(null, null);
                    hierarchy = System.Linq.Enumerable.from(hierarchy, System.String).take(((hierarchy.length - 1) | 0)).ToArray(System.String);
                    $t1 = Bridge.getEnumerator(hierarchy);
                    try {
                        while ($t1.moveNext()) {
                            var key = $t1.Current;
                            if (obj == null) {
                                return null;
                            }

                            obj = obj[key];
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                    if (obj == null) {
                        return null;
                    }

                    return Core.Extensions.BridgeExt.GetObjType(lastField, obj);
                },
                GetObjType: function (propName, obj) {
                    var $t;
                    if (obj.hasOwnProperty(propName)) {
                        var value = Core.Extensions.Utils.GetPropValue(obj, propName);
                        return value != null ? Bridge.getType(value) : null;
                    } else if (Bridge.Reflection.getMembers(Bridge.getType(obj), 16, 284, propName) != null) {
                        return ($t = Bridge.Reflection.getMembers(Bridge.getType(obj), 16, 284, propName)) != null ? $t.rt : null;
                    }

                    return null;
                },
                DistinctBy: function (T, Key, source, keySelector) {
                    if (source == null) {
                        return null;
                    }

                    return System.Linq.Enumerable.from(source, T).groupBy(keySelector).select(function (g) {
                        return g.first();
                    });
                },
                TextWidth: function (text, font) {
                    var $t;
                    var div = document.createElement("div");
                    div.textContent = text;
                    div.style.cssText = System.String.format("position: absolute; float: left; white-space: nowrap; visibility: hidden, font: {0}", [font]);
                    document.body.appendChild(div);
                    var css = window.getComputedStyle(div, "width");
                    return ($t = Core.Extensions.Utils.TryParse(System.Decimal, System.String.replaceAll(css.width, "px", "")), $t != null ? $t : System.Decimal(0));
                },
                Swap: function (T, list, indexA, indexB) {
                    var tmp = list.getItem(indexA);
                    list.setItem(indexA, list.getItem(indexB));
                    list.setItem(indexB, tmp);
                }
            }
        }
    });

    Bridge.define("Core.Extensions.DateTimeExt", {
        statics: {
            fields: {
                DateFormat: null,
                SimpleDateFormat: null
            },
            ctors: {
                init: function () {
                    this.DateFormat = "yyyy-MM-ddTHH:mm:ss.FFFFFFFzzz";
                    this.SimpleDateFormat = "yyyy/MM/dd";
                }
            },
            methods: {
                ToSimpleFormat: function (date) {
                    return System.DateTime.format(date, Core.Extensions.DateTimeExt.SimpleDateFormat);
                },
                ToISOFormat: function (date) {
                    var isRaw = date.toISOString != null;
                    if (isRaw) return date.toISOString();
                    return System.DateTime.format(date, Core.Extensions.DateTimeExt.DateFormat);
                },
                ToISOFormat$1: function (date) {
                    return date.ToString$1(Core.Extensions.DateTimeExt.DateFormat);
                },
                DateConverter: function (str) {
                    var datestr = "";
                    var date = new Date(str);
                    var mnth = ("0" + (date.getMonth()+1)).slice(-2);
                    var day  = ("0" + date.getDate()).slice(-2);
                    var hours1  = ("0" + date.getHours()).slice(-2);
                    var minutes = ("0" + date.getMinutes()).slice(-2);
                    var seconds  = ("0" + date.getSeconds()).slice(-2);
                    var year = date.getFullYear();
                    datestr= `${year}/${mnth}/${day} ${hours1}:${minutes}:${seconds}`
                    return datestr;
                },
                ToDayHourMinute: function (span) {
                    var days = Bridge.Int.clip32(span.getTotalDays());
                    var minute = (Bridge.Int.clip32(span.getTotalMinutes()) - Bridge.Int.mul(Bridge.Int.mul(days, 24), 60)) | 0;
                    var leftMinute = minute % 60;
                    var hour = (Bridge.Int.div(minute, 60)) | 0;
                    return new (System.ValueTuple$3(System.Int32,System.Int32,System.Int32)).$ctor1(days, hour, leftMinute);
                },
                DateString: function (yourDate, compareDate) {
                    if (compareDate === void 0) { compareDate = null; }
                    if (Bridge.equals(compareDate, null)) {
                        compareDate = System.DateTime.getNow();
                    }
                    var SECOND = 1;
                    var MINUTE = 60;
                    var HOUR = 3600;
                    var DAY = 86400;
                    var MONTH = 2592000;

                    var ts = new System.TimeSpan(System.DateTime.getTicks(System.Nullable.getValue(compareDate)).sub(yourDate.Ticks));
                    var delta = Math.abs(ts.getTotalSeconds());

                    if (delta < 60) {
                        return ts.getSeconds() === 1 ? "one second ago" : ts.getSeconds() + " seconds ago";
                    }

                    if (delta < 120) {
                        return "a minute ago";
                    }

                    if (delta < 2700) {
                        return ts.getMinutes() + " minutes ago";
                    }

                    if (delta < 5400) {
                        return "an hour ago";
                    }

                    if (delta < 86400) {
                        return ts.getHours() + " hours ago";
                    }

                    if (delta < 172800) {
                        return "yesterday";
                    }

                    if (delta < 2592000) {
                        return ts.getDays() + " days ago";
                    }

                    if (delta < 31104000) {
                        var months = System.Convert.toInt32(Bridge.box(Math.floor(ts.getDays() / 30), System.Double, System.Double.format, System.Double.getHashCode));
                        return months <= 1 ? "one month ago" : months + " months ago";
                    } else {
                        var years = System.Convert.toInt32(Bridge.box(Math.floor(ts.getDays() / 365), System.Double, System.Double.format, System.Double.getHashCode));
                        return years <= 1 ? "one year ago" : years + " years ago";
                    }
                },
                ToUserFormat: function (date) {
                    return System.DateTime.format(date, "yyyy/MM/dd HH:mm");
                },
                TryParseDateTime: function (date) {
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(date)) {
                        return null;
                    }
                    var res = { };

                    var parsed = System.DateTime.tryParse(date, null, res);
                    if (!parsed) {
                        return null;
                    }

                    return res.v;
                },
                GetBusinessDays: function (start) {
                    var end = System.DateTime.getDate(System.DateTime.getNow());
                    if (System.DateTime.getDayOfWeek(start) === System.DayOfWeek.Saturday) {
                        start = System.DateTime.addDays(start, 2);
                    } else if (System.DateTime.getDayOfWeek(start) === System.DayOfWeek.Sunday) {
                        start = System.DateTime.addDays(start, 1);
                    }

                    if (System.DateTime.getDayOfWeek(end) === System.DayOfWeek.Saturday) {
                        end = System.DateTime.addDays(end, -1);
                    } else if (System.DateTime.getDayOfWeek(end) === System.DayOfWeek.Sunday) {
                        end = System.DateTime.addDays(end, -2);
                    }

                    var diff = Bridge.Int.clip32(System.DateTime.subdd(end, System.DateTime.getDate(start)).getTotalDays());

                    var result = (Bridge.Int.mul(((Bridge.Int.div(diff, 7)) | 0), 5) + diff % 7) | 0;

                    if (System.DateTime.getDayOfWeek(end) < System.DateTime.getDayOfWeek(start)) {
                        return ((result - 2) | 0);
                    } else {
                        return result;
                    }
                },
                GetDays: function (start, end) {
                    var result = Bridge.Int.clip32(System.DateTime.subdd(end, start).getTotalDays());
                    return result;
                },
                TotalMonth: function (start, end) {
                    return ((((((Bridge.Int.mul(System.DateTime.getYear(end), 12) + System.DateTime.getMonth(end)) | 0) - Bridge.Int.mul(System.DateTime.getYear(start), 12)) | 0) - System.DateTime.getMonth(start)) | 0);
                },
                FirstDayOfMonth: function (dt) {
                    return System.DateTime.create(System.DateTime.getYear(dt), System.DateTime.getMonth(dt), 1);
                },
                LastDayOfMonth: function (dt) {
                    return System.DateTime.addDays(System.DateTime.addMonths(Core.Extensions.DateTimeExt.FirstDayOfMonth(dt), 1), -1);
                },
                FirstDayOfNextMonth: function (dt) {
                    return System.DateTime.addMonths(Core.Extensions.DateTimeExt.FirstDayOfMonth(dt), 1);
                }
            }
        }
    });

    Bridge.define("Core.Extensions.EventExt", {
        statics: {
            methods: {
                Top: function (e) {
                    return System.Nullable.getValue(Bridge.cast(Bridge.unbox(e.clientY, System.Single), System.Single));
                },
                Left: function (e) {
                    return System.Nullable.getValue(Bridge.cast(Bridge.unbox(e.clientX, System.Single), System.Single));
                },
                KeyCode: function (e) {
                    var $t;
                    return ($t = Bridge.cast(Bridge.unbox(e.keyCode, System.Int32), System.Int32, true), $t != null ? $t : -1);
                },
                KeyCodeEnum: function (e) {
                    if (e.keyCode == null) {
                        return null;
                    }
                    var res = { v : new Core.Enums.KeyCodeEnum() };
                    var parsed = System.Enum.tryParse(Core.Enums.KeyCodeEnum, Bridge.toString(e.keyCode).toUpperCase(), res);
                    return parsed ? Bridge.cast(res.v, System.Int32, true) : null;
                },
                ShiftKey: function (e) {
                    return System.Nullable.getValue(Bridge.cast(Bridge.unbox(e.shiftKey, System.Boolean), System.Boolean));
                },
                /**
                 * Detect if the user press Ctrl or Command key while the event occurs
                 *
                 * @static
                 * @public
                 * @this Core.Extensions.EventExt
                 * @memberof Core.Extensions.EventExt
                 * @param   {Event}      e
                 * @return  {boolean}
                 */
                CtrlOrMetaKey: function (e) {
                    return System.Nullable.getValue(Bridge.cast(Bridge.unbox(e.ctrlKey, System.Boolean), System.Boolean)) || System.Nullable.getValue(Bridge.cast(Bridge.unbox(e.metaKey, System.Boolean), System.Boolean));
                },
                AltKey: function (e) {
                    return System.Nullable.getValue(Bridge.cast(Bridge.unbox(e.altKey, System.Boolean), System.Boolean));
                },
                GetChecked: function (e) {
                    return Bridge.cast(e.target, HTMLInputElement).checked;
                },
                GetInputText: function (e) {
                    return Bridge.cast(e.target, HTMLInputElement).value;
                },
                ToPromise: function (T, task) {
                    if (task == null) {
                        return null;
                    }
                    return new Promise((resolve, reject) => {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $returnValue, 
                        t, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            if (task == null) {
                                                resolve(null);
                                                return;
                                            }
                                            $task1 = task;
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            t = $taskResult1;
                                            resolve(t);
                                            return;
                                        }
                                        default: {
                                            resolve(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                reject($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    });
                    return null;
                },
                ToPromiseNoResult: function (task) {
                    if (task == null) {
                        return null;
                    }
                    return new Promise((resolve, reject) => {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $returnValue, 
                        t, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            if (task == null) {
                                                resolve(null);
                                                return;
                                            }
                                            $task1 = task;
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            t = $taskResult1;
                                            resolve(t);
                                            return;
                                        }
                                        default: {
                                            resolve(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                reject($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    });
                    return null;
                },
                Done$1: function (T, task, handler) {
                    if (handler === void 0) { handler = null; }
                    if (task == null) {
                        return null;
                    }
                    var promise = Core.Extensions.EventExt.ToPromise(T, task);
                    if (promise == null) {
                        return null;
                    }
                    promise.then(handler);
                    return promise;
                },
                Done: function (task, handler, errorHandler) {
                    if (handler === void 0) { handler = null; }
                    if (errorHandler === void 0) { errorHandler = null; }
                    if (task == null) {
                        return null;
                    }
                    var promise = Core.Extensions.EventExt.ToPromiseNoResult(task);
                    if (promise == null) {
                        return null;
                    }
                    promise.then(handler);
                    if (errorHandler != null) promise.catch(errorHandler);
                    return promise;
                },
                Catch: function (task, handler) {
                    if (handler === void 0) { handler = null; }
                    if (task == null) {
                        return null;
                    }
                    task.catch(handler);
                    return task;
                },
                Finally: function (task, handler) {
                    if (handler === void 0) { handler = null; }
                    if (task == null) {
                        return null;
                    }
                    task.finally(handler);
                    return task;
                }
            }
        }
    });

    Bridge.define("Core.Extensions.ExcelExt", {
        statics: {
            methods: {
                ExportTableToExcel: function (tableId, filename, table, border) {
                    if (table === void 0) { table = null; }
                    if (border === void 0) { border = false; }
                    if (border) {
                        Core.Extensions.IEnumerableExtensions.SelectForEach(Node, table.querySelectorAll("td"), function (x) {
                            x.style="border:1px solid;white-space: nowrap;font-family: 'times new roman', times, serif;";
                        });
                        Core.Extensions.IEnumerableExtensions.SelectForEach(Node, table.querySelectorAll("th"), function (x) {
                            x.style="border:1px solid;white-space: nowrap;font-family: 'times new roman', times, serif;";
                        });
                    }
                    var dataType = "application/vnd.ms-excel";
                    var extension = ".xls";
                    let base64 = function(s) {
                        return window.btoa(unescape(encodeURIComponent(s)))
                    };
                    let template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>';
                    let render = function(template, content) {
                        return template.replace(/{(\w+)}/g, function(m, p) { return content[p]; });
                    };

                    let tableElement = table || document.getElementById(tableId);

                    let tableExcel = render(template, {
                        worksheet: filename,
                        table: tableElement.innerHTML
                    });

                    filename = filename + extension;

                    if (navigator.msSaveOrOpenBlob)
                    {
                        let blob = new Blob(
                            [ '\ufeff', tableExcel ],
                            { type: dataType }
                        );

                        navigator.msSaveOrOpenBlob(blob, filename);
                    } else {
                        let downloadLink = document.createElement("a");

                        document.body.appendChild(downloadLink);

                        downloadLink.href = 'data:' + dataType + ';base64,' + base64(tableExcel);

                        downloadLink.download = filename;

                        downloadLink.click();
                    }
                    if (border) {
                        Core.Extensions.IEnumerableExtensions.SelectForEach(Node, table.querySelectorAll("td"), function (x) {
                            x.style="";
                        });
                        Core.Extensions.IEnumerableExtensions.SelectForEach(Node, table.querySelectorAll("th"), function (x) {
                            x.style="";
                        });
                    }
                }
            }
        }
    });

    Bridge.define("Core.Extensions.HtmlElementExtension", {
        statics: {
            methods: {
                HasClass: function (node, className) {
                    if (node == null) {
                        throw new System.InvalidOperationException.$ctor1(System.String.format("{0} is null", ["node"]));
                    }

                    if (!Core.Extensions.StringExt.HasAnyChar(className)) {
                        return false;
                    }

                    var ele = Bridge.as(node, Element);
                    return System.String.contains(ele.className,className);
                },
                ReplaceClass: function (node, oldClass, newClass) {
                    if (System.String.isNullOrEmpty(oldClass)) {
                        return;
                    }

                    var element = Bridge.as(node, Element);
                    element.className = System.String.replaceAll(element.className, oldClass, newClass).trim().replace(new RegExp("\\s+"), " ");
                },
                AddClass: function (node, className) {
                    if (node == null || System.String.isNullOrEmpty(className) || Core.Extensions.HtmlElementExtension.HasClass(node, className)) {
                        return;
                    }

                    var element = Bridge.as(node, Element);
                    element.className = ((element.className || "") + " " + (className || "")).trim();
                },
                Closest: function (node, selector) {
                    if (node == null || System.String.isNullOrEmpty(selector)) {
                        return null;
                    }
                    var func = node.closest;
                    return Bridge.cast(func.call(node, selector), HTMLElement);
                },
                Prepend: function (node, child) {
                    if (node == null) {
                        return;
                    }
                    var func = node.prepend;
                    func.call(node, child);
                },
                GetFullHeight: function (node) {
                    if (node == null) {
                        return 0;
                    }

                    var style = window.getComputedStyle(node);
                    var topPx = Core.Extensions.StringExt.HasAnyChar(style.marginTop) ? System.String.replaceAll(style.marginTop, Core.Extensions.Utils.Pixel, "") : Bridge.toString((0));
                    var bottomPx = Core.Extensions.StringExt.HasAnyChar(style.marginTop) ? System.String.replaceAll(style.marginBottom, Core.Extensions.Utils.Pixel, "") : Bridge.toString((0));
                    var marginHeight = System.Convert.toDouble(topPx) + System.Convert.toDouble(bottomPx);
                    return node.scrollHeight + marginHeight;
                },
                RemoveClass: function (node, className) {
                    if (node == null || System.String.isNullOrEmpty(className)) {
                        return;
                    }
                    Core.Extensions.HtmlElementExtension.ReplaceClass(node, className, "");
                },
                ToggleClass: function (node, className) {
                    if (node == null || System.String.isNullOrEmpty(className)) {
                        return;
                    }

                    var hasClass = System.String.contains((Bridge.as(node, HTMLElement)).className,className);
                    if (hasClass) {
                        Core.Extensions.HtmlElementExtension.RemoveClass(node, className);
                    } else {
                        Core.Extensions.HtmlElementExtension.AddClass(node, className);
                    }
                },
                Show: function (ele) {
                    ele.style.display = "";
                },
                GetComputedStyle: function (ele) {
                    return window.getComputedStyle(ele);
                },
                Hide: function (ele) {
                    ele.style.display = "none";
                },
                Hidden: function (ele) {
                    if (ele == null) {
                        return true;
                    }

                    var x = ele.getBoundingClientRect();
                    var style = window.getComputedStyle(ele);
                    return Bridge.referenceEquals(Bridge.toString(style.display), "none") || x.bottom === 0 && x.top === 0 && x.width === 0 && x.height === 0;
                },
                OutOfViewport: function (elem) {
                    var $t;
                    // Get element's bounding
                    var bounding = elem.getBoundingClientRect();

                    // Check if it's out of the viewport on each side
                    var res = ($t = new Core.Extensions.OutOfViewPort(), $t.Top = bounding.top < 0, $t.Left = bounding.left < 0, $t.Bottom = bounding.bottom > window.innerHeight, $t.Right = bounding.right > window.innerWidth, $t);
                    res.Any = res.Top || res.Left || res.Bottom || res.Right;
                    res.All = res.Top && res.Left && res.Bottom && res.Right;

                    return res;
                },
                FilterElement: function (ele, predicate, visited) {
                    return new (Bridge.GeneratorEnumerable$1(HTMLElement))(Bridge.fn.bind(this, function (ele, predicate, visited) {
                        var $step = 0,
                            $jumpFromFinally,
                            $returnValue,
                            $t,
                            child,
                            $t1,
                            match,
                            $async_e;

                        var $enumerator = new (Bridge.GeneratorEnumerator$1(HTMLElement))(Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    switch ($step) {
                                        case 0: {
                                            if (visited === void 0) { visited = null; }
                                                if (ele == null) {
                                                    $step = 1;
                                                    continue;
                                                } 
                                                $step = 2;
                                                continue;
                                        }
                                        case 1: {
                                            return false;
                                        }
                                        case 2: {
                                            if (visited == null) {
                                                    visited = new (System.Collections.Generic.HashSet$1(HTMLElement)).ctor();
                                                }
                                                if (visited.contains(ele)) {
                                                    $step = 3;
                                                    continue;
                                                } 
                                                $step = 4;
                                                continue;
                                        }
                                        case 3: {
                                            return false;
                                        }
                                        case 4: {
                                            visited.add(ele);
                                                if (Bridge.staticEquals(predicate, null) || predicate(ele)) {
                                                    $step = 5;
                                                    continue;
                                                } 
                                                $step = 7;
                                                continue;
                                        }
                                        case 5: {
                                            $enumerator.current = ele;
                                                $step = 6;
                                                return true;
                                        }
                                        case 6: {
                                            $step = 7;
                                            continue;
                                        }
                                        case 7: {
                                            $t = Bridge.getEnumerator(ele.children, "getEnumerator");
                                                $step = 8;
                                                continue;
                                        }
                                        case 8: {
                                            if ($t.moveNext()) {
                                                    child = $t.Current;
                                                    $step = 9;
                                                    continue;
                                                }
                                            $step = 14;
                                            continue;
                                        }
                                        case 9: {
                                            $t1 = Bridge.getEnumerator(Core.Extensions.HtmlElementExtension.FilterElement(child, predicate, visited), HTMLElement);
                                                $step = 10;
                                                continue;
                                        }
                                        case 10: {
                                            if ($t1.moveNext()) {
                                                    match = $t1.Current;
                                                    $step = 11;
                                                    continue;
                                                }
                                            $step = 13;
                                            continue;
                                        }
                                        case 11: {
                                            $enumerator.current = match;
                                                $step = 12;
                                                return true;
                                        }
                                        case 12: {
                                            $step = 10;
                                            continue;
                                        }
                                        case 13: {
                                            $step = 8;
                                            continue;
                                        }
                                        case 14: {

                                        }
                                        default: {
                                            return false;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                throw $async_e;
                            }
                        }));
                        return $enumerator;
                    }, arguments));
                }
            }
        }
    });

    Bridge.define("Core.Extensions.IEnumerableExtensions", {
        statics: {
            methods: {
                SelectForEach: function (T, source, action) {
                    var $t;
                    if (Core.Extensions.IEnumerableExtensions.Nothing(T, source) || Bridge.staticEquals(action, null)) {
                        return source;
                    }

                    $t = Bridge.getEnumerator(source, T);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            action(item);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return source;
                },
                SelectForEach$1: function (T, source, action) {
                    var $t;
                    if (Core.Extensions.IEnumerableExtensions.Nothing(T, source) || Bridge.staticEquals(action, null)) {
                        return source;
                    }

                    var index = 0;
                    $t = Bridge.getEnumerator(source, T);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            action(item, index);
                            index = (index + 1) | 0;
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return source;
                },
                SelectForEach$2: function (T, K, source, mapper) {
                    return new (Bridge.GeneratorEnumerable$1(K))(Bridge.fn.bind(this, function (T, K, source, mapper) {
                        var $step = 0,
                            $jumpFromFinally,
                            $returnValue,
                            index,
                            $t,
                            item,
                            $async_e;

                        var $enumerator = new (Bridge.GeneratorEnumerator$1(K))(Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    switch ($step) {
                                        case 0: {
                                            if (source == null || Bridge.staticEquals(mapper, null)) {
                                                    throw new System.ArgumentNullException.$ctor1("source or mapper is null");
                                                }

                                                index = 0;
                                                $t = Bridge.getEnumerator(source, T);
                                                $step = 1;
                                                continue;
                                        }
                                        case 1: {
                                            if ($t.moveNext()) {
                                                    item = $t.Current;
                                                    $step = 2;
                                                    continue;
                                                }
                                            $step = 4;
                                            continue;
                                        }
                                        case 2: {
                                            $enumerator.current = mapper(item, index);
                                                $step = 3;
                                                return true;
                                        }
                                        case 3: {
                                            index = (index + 1) | 0;
                                            $step = 1;
                                            continue;
                                        }
                                        case 4: {

                                        }
                                        default: {
                                            return false;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                throw $async_e;
                            }
                        }));
                        return $enumerator;
                    }, arguments));
                },
                ForEachAsync: function (T, source, action) {
                    var $step = 0,
                        $task1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        tasks, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            if (Core.Extensions.IEnumerableExtensions.Nothing(T, source) || Bridge.staticEquals(action, null)) {
                                                $tcs.setResult(source);
                                                return;
                                            }

                                            tasks = System.Linq.Enumerable.from(source, T).select(action);
                                            $task1 = System.Threading.Tasks.Task.whenAll(tasks);
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $task1.getAwaitedResult();
                                            $tcs.setResult(source);
                                            return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                },
                Nothing: function (T, source) {
                    return source == null || !System.Linq.Enumerable.from(source, T).any();
                },
                HasElementAndAll: function (T, source, predicate) {
                    if (source == null || !System.Linq.Enumerable.from(source, T).any()) {
                        return false;
                    }

                    return System.Linq.Enumerable.from(source, T).all(predicate);
                },
                FindItemAndIndex: function (T, source, predicate) {
                    var $t;
                    var index = -1;
                    $t = Bridge.getEnumerator(source, T);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            index = (index + 1) | 0;
                            if (predicate(item)) {
                                return new (System.ValueTuple$2(T,System.Int32)).$ctor1(item, index);
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return new (System.ValueTuple$2(T,System.Int32)).$ctor1(Bridge.getDefaultValue(T), -1);
                },
                IndexOf: function (T, source, predicate) {
                    var $t;
                    var index = -1;
                    $t = Bridge.getEnumerator(source, T);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            index = (index + 1) | 0;
                            if (predicate(item)) {
                                return index;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return -1;
                },
                HasElement: function (T, source) {
                    return source != null && System.Linq.Enumerable.from(source, T).any();
                },
                ToEntity: function (T) {
                    var $t, $t1;
                    var enumType = T;
                    var values = System.Enum.getValues(enumType);
                    var res = new (System.Collections.Generic.List$1(System.Object)).ctor();
                    $t = Bridge.getEnumerator(values);
                    try {
                        while ($t.moveNext()) {
                            var value = $t.Current;
                            var val = System.Enum.parse(enumType, Bridge.toString(value));
                            var desc = Bridge.toString(val);
                            var fi = Bridge.Reflection.getMembers(enumType, 4, 284, desc);
                            var attributes = Bridge.as((fi != null ? System.Attribute.getCustomAttributes(fi, System.ComponentModel.DescriptionAttribute, false) : null), System.Array.type(System.ComponentModel.DescriptionAttribute));
                            if (Core.Extensions.IEnumerableExtensions.HasElement(System.ComponentModel.DescriptionAttribute, attributes)) {
                                desc = System.Linq.Enumerable.from(attributes, System.ComponentModel.DescriptionAttribute).first().Description;
                            }
                            res.add(($t1 = new Core.Models.Entity(), $t1.Id = Bridge.toString(System.Nullable.getValue(Bridge.cast(Bridge.unbox(value, System.Int32), System.Int32))), $t1.Name = Bridge.toString(val), $t1.Description = desc, $t1.Active = true, $t1));
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return res;
                },
                CombineStrings: function (source, combinator) {
                    if (combinator === void 0) { combinator = ","; }
                    if (combinator == null || source == null) {
                        return "";
                    }
                    return Core.Extensions.IEnumerableExtensions.Combine(System.String, System.Linq.Enumerable.from(source, System.String).select(function (x) {
                            return System.String.format("'{0}'", [x]);
                        }), combinator);
                },
                Combine: function (T, source, combinator) {
                    if (combinator === void 0) { combinator = ","; }
                    if (combinator == null || source == null) {
                        return "";
                    }
                    return Bridge.toArray(source).join(combinator);
                },
                Combine$1: function (T, K, source, mapper, combinator) {
                    if (combinator === void 0) { combinator = ","; }
                    if (Bridge.staticEquals(mapper, null) || source == null) {
                        return "";
                    }
                    return Core.Extensions.IEnumerableExtensions.Combine(K, System.Linq.Enumerable.from(source, T).select(mapper), combinator);
                },
                Flattern: function (T, source, getChildren) {
                    if (Core.Extensions.IEnumerableExtensions.Nothing(T, source)) {
                        return source;
                    }

                    var firstLevel = System.Linq.Enumerable.from(source, T).select(function (x) {
                            return getChildren(x);
                        }).where(function (x) {
                        return x != null;
                    }).selectMany(function (x) {
                        return x;
                    });
                    if (Core.Extensions.IEnumerableExtensions.Nothing(T, firstLevel)) {
                        return source;
                    }
                    return System.Linq.Enumerable.from(source, T).concat(Core.Extensions.IEnumerableExtensions.Flattern(T, firstLevel, getChildren));
                }
            }
        }
    });

    Bridge.define("Core.Extensions.NumberExtensions", {
        statics: {
            methods: {
                RoundUp: function (value, decimals) {
                    return System.Decimal.toDecimalPlaces(value, decimals, 4);
                },
                ToRealDecimal: function (value) {
                    return System.Nullable.getValue(Bridge.cast(Bridge.unbox(System.Convert.changeType(value, System.Decimal), System.Decimal), System.Decimal));
                },
                NumberToText: function (inputNumber) {
                    var suffix = true;
                    var unitNumbers = System.Array.init(["kh\u00f4ng", "m\u1ed9t", "hai", "ba", "b\u1ed1n", "n\u0103m", "s\u00e1u", "b\u1ea3y", "t\u00e1m", "ch\u00edn"], System.String);
                    var placeValues = System.Array.init(["", "ngh\u00ecn", "tri\u1ec7u", "t\u1ef7"], System.String);
                    var isNegative = false;
                    var sNumber = Bridge.Int.format(inputNumber, "#");
                    var number = System.Convert.toDouble(sNumber);

                    if (number < 0) {
                        number = -number;
                        sNumber = System.Double.format(number);
                        isNegative = true;
                    }

                    var ones, tens, hundreds;
                    var positionDigit = sNumber.length;
                    var result = " ";

                    if (positionDigit === 0) {
                        result = (unitNumbers[System.Array.index(0, unitNumbers)] || "") + (result || "");
                    } else {
                        var placeValue = 0;

                        while (positionDigit > 0) {
                            tens = (hundreds = -1);
                            ones = System.Convert.toInt32(sNumber.substr(((positionDigit - 1) | 0), 1));
                            positionDigit = (positionDigit - 1) | 0;
                            if (positionDigit > 0) {
                                tens = System.Convert.toInt32(sNumber.substr(((positionDigit - 1) | 0), 1));
                                positionDigit = (positionDigit - 1) | 0;
                                if (positionDigit > 0) {
                                    hundreds = System.Convert.toInt32(sNumber.substr(((positionDigit - 1) | 0), 1));
                                    positionDigit = (positionDigit - 1) | 0;
                                }
                            }

                            if ((ones > 0) || (tens > 0) || (hundreds > 0) || (placeValue === 3)) {
                                result = (placeValues[System.Array.index(placeValue, placeValues)] || "") + (result || "");
                            }

                            placeValue = (placeValue + 1) | 0;
                            if (placeValue > 3) {
                                placeValue = 1;
                            }

                            if ((ones === 1) && (tens > 1)) {
                                result = "m\u1ed9t " + (result || "");
                            } else {
                                if ((ones === 5) && (tens > 0)) {
                                    result = "l\u0103m " + (result || "");
                                } else if (ones > 0) {
                                    result = (unitNumbers[System.Array.index(ones, unitNumbers)] || "") + " " + (result || "");
                                }
                            }
                            if (tens < 0) {
                                break;
                            } else {
                                if ((tens === 0) && (ones > 0)) {
                                    result = "l\u1ebb " + (result || "");
                                }

                                if (tens === 1) {
                                    result = "m\u01b0\u1eddi " + (result || "");
                                }

                                if (tens > 1) {
                                    result = (unitNumbers[System.Array.index(tens, unitNumbers)] || "") + " m\u01b0\u01a1i " + (result || "");
                                }
                            }
                            if (hundreds < 0) {
                                break;
                            } else {
                                if ((hundreds > 0) || (tens > 0) || (ones > 0)) {
                                    result = (unitNumbers[System.Array.index(hundreds, unitNumbers)] || "") + " tr\u0103m " + (result || "");
                                }
                            }
                            result = " " + (result || "");
                        }
                    }
                    result = result.trim();
                    if (isNegative) {
                        result = "\u00c2m " + (result || "");
                    }

                    return (result || "") + ((suffix ? " \u0111\u1ed3ng ch\u1eb5n" : "") || "");
                }
            }
        }
    });

    Bridge.define("Core.Extensions.OdataExt", {
        statics: {
            fields: {
                TopKeyword: null,
                FilterKeyword: null,
                OrderByKeyword: null,
                QuestionMark: null
            },
            ctors: {
                init: function () {
                    this.TopKeyword = "$top=";
                    this.FilterKeyword = "$filter=";
                    this.OrderByKeyword = "$orderby=";
                    this.QuestionMark = "?";
                }
            },
            methods: {
                RemoveClause: function (DataSourceFilter, clauseType, removeKeyword) {
                    if (clauseType === void 0) { clauseType = "$filter="; }
                    if (removeKeyword === void 0) { removeKeyword = false; }
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(DataSourceFilter)) {
                        return "";
                    }

                    var noClauseQuery = DataSourceFilter;
                    var clauseIndex = DataSourceFilter.lastIndexOf(clauseType);

                    if (clauseIndex >= 0) {
                        var fromFilter = DataSourceFilter.substr(clauseIndex);
                        var endClauseIndex = System.String.indexOf(fromFilter, "&");
                        endClauseIndex = endClauseIndex === -1 ? fromFilter.length : endClauseIndex;
                        noClauseQuery = (DataSourceFilter.substr(0, clauseIndex) || "") + (fromFilter.substr(endClauseIndex, fromFilter.length) || "");
                    }
                    var endChar = noClauseQuery.charCodeAt(((noClauseQuery.length - 1) | 0));
                    if (noClauseQuery.length > 0 && endChar === 38 || endChar === 63) {
                        noClauseQuery = noClauseQuery.substr(0, ((noClauseQuery.length - 1) | 0));
                    }
                    return removeKeyword ? System.String.replaceAll(noClauseQuery, clauseType, "") : noClauseQuery;
                },
                GetClausePart: function (DataSourceFilter, clauseKeyword) {
                    if (clauseKeyword === void 0) { clauseKeyword = "$filter="; }
                    var clauseIndex = DataSourceFilter.lastIndexOf(clauseKeyword);
                    if (clauseIndex >= 0) {
                        var clause = DataSourceFilter.substr(clauseIndex);
                        var endClauseIndex = System.String.indexOf(clause, "&");
                        endClauseIndex = endClauseIndex === -1 ? clause.length : endClauseIndex;
                        return clause.substr(clauseKeyword.length, ((endClauseIndex - clauseKeyword.length) | 0)).trim();
                    }
                    return "";
                },
                GetOrderByPart: function (dataSourceFilter) {
                    var filterIndex = dataSourceFilter.lastIndexOf(Core.Extensions.OdataExt.OrderByKeyword);
                    if (filterIndex >= 0) {
                        var filter = dataSourceFilter.substr(filterIndex);
                        var endFilterIndex = System.String.indexOf(filter, "&");
                        endFilterIndex = endFilterIndex === -1 ? filter.length : endFilterIndex;
                        return filter.substr(Core.Extensions.OdataExt.OrderByKeyword.length, ((endFilterIndex - Core.Extensions.OdataExt.OrderByKeyword.length) | 0)).trim();
                    }
                    return "";
                },
                AppendClause: function (DataSourceFilter, clauseValue, clauseKeyword) {
                    if (clauseKeyword === void 0) { clauseKeyword = "$filter="; }
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(clauseValue)) {
                        return DataSourceFilter;
                    }

                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(DataSourceFilter)) {
                        DataSourceFilter = "";
                    }

                    if (!System.String.contains(DataSourceFilter,Core.Extensions.OdataExt.QuestionMark)) {
                        DataSourceFilter = (DataSourceFilter || "") + (Core.Extensions.OdataExt.QuestionMark || "");
                    }

                    var originalFilter = Core.Extensions.OdataExt.GetClausePart(DataSourceFilter, clauseKeyword);
                    var index;
                    if (Core.Extensions.StringExt.IsNullOrEmpty(originalFilter)) {
                        DataSourceFilter = (DataSourceFilter || "") + ((System.String.indexOf(DataSourceFilter, "?") < 0 ? clauseKeyword : "&" + (clauseKeyword || "")) || "");
                        index = DataSourceFilter.length;
                    } else {
                        index = (System.String.indexOf(DataSourceFilter, originalFilter) + originalFilter.length) | 0;
                    }
                    var finalStatement = (DataSourceFilter.substr(0, index) || "") + (clauseValue || "") + (DataSourceFilter.substr(index) || "");
                    return finalStatement;
                },
                ApplyClause: function (DataSourceFilter, clauseValue, clauseKeyword) {
                    if (clauseKeyword === void 0) { clauseKeyword = "$filter="; }
                    var statement = Core.Extensions.OdataExt.RemoveClause(DataSourceFilter, clauseKeyword, true);
                    return Core.Extensions.OdataExt.AppendClause(statement, clauseValue, clauseKeyword);
                }
            }
        }
    });

    Bridge.define("Core.Extensions.OutOfViewPort", {
        props: {
            Top: false,
            Left: false,
            Right: false,
            Bottom: false,
            Any: false,
            All: false
        }
    });

    Bridge.define("Core.Extensions.ReflectionExt", {
        statics: {
            fields: {
                IdField: null,
                StatusIdField: null,
                FreightStateId: null
            },
            ctors: {
                init: function () {
                    this.IdField = "Id";
                    this.StatusIdField = "StatusId";
                    this.FreightStateId = "FreightStateId";
                }
            },
            methods: {
                IsSimple: function (type) {
                    var $t;
                    if (type == null) {
                        throw new System.ArgumentNullException.$ctor1(System.String.format("{0} is null", ["type"]));
                    }

                    if (Bridge.Reflection.isGenericType(type) && Bridge.referenceEquals(Bridge.Reflection.getGenericTypeDefinition(type), System.Nullable$1)) {
                        return Core.Extensions.ReflectionExt.IsSimple(($t = Bridge.Reflection.getGenericArguments(type))[System.Array.index(0, $t)]);
                    }
                    return Bridge.Reflection.isPrimitive(type) || Bridge.Reflection.isEnum(type) || Bridge.equals(type, System.String) || Bridge.equals(type, System.DateTime) || Bridge.equals(type, System.DateTimeOffset) || Bridge.equals(type, System.TimeSpan) || Bridge.equals(type, System.Decimal);
                },
                IsDate: function (type) {
                    return Bridge.equals(type, System.DateTime) || Bridge.equals(type, System.Nullable$1(System.DateTime)) || Bridge.equals(type, System.DateTimeOffset) || Bridge.equals(type, System.Nullable$1(System.DateTimeOffset));
                },
                IsNumber: function (type) {
                    var $t;
                    if (Bridge.Reflection.isGenericType(type) && Bridge.referenceEquals(Bridge.Reflection.getGenericTypeDefinition(type), System.Nullable$1)) {
                        return Core.Extensions.ReflectionExt.IsNumber(($t = Bridge.Reflection.getGenericArguments(type))[System.Array.index(0, $t)]);
                    }
                    return Bridge.referenceEquals(type, System.SByte) || Bridge.referenceEquals(type, System.Byte) || Bridge.referenceEquals(type, System.Int16) || Bridge.referenceEquals(type, System.UInt16) || Bridge.referenceEquals(type, System.Int32) || Bridge.referenceEquals(type, System.UInt32) || Bridge.referenceEquals(type, System.Int32) || Bridge.referenceEquals(type, System.UInt64) || Bridge.referenceEquals(type, System.Single) || Bridge.referenceEquals(type, System.Double) || Bridge.referenceEquals(type, System.Decimal);
                },
                IsDecimal: function (type) {
                    return Bridge.referenceEquals(type, System.Decimal) || Bridge.referenceEquals(type, System.Nullable$1(System.Decimal));
                },
                IsInt32: function (type) {
                    return Bridge.referenceEquals(type, System.Int32) || Bridge.referenceEquals(type, System.Nullable$1(System.Int32));
                },
                IsBool: function (type) {
                    return Bridge.referenceEquals(type, System.Boolean) || Bridge.referenceEquals(type, System.Nullable$1(System.Boolean));
                },
                CopyPropFrom: function (target, source, ignoreFields) {
                    if (ignoreFields === void 0) { ignoreFields = []; }
                    Core.Extensions.ReflectionExt.CopyPropFromInternal(target, source, new (System.Collections.Generic.HashSet$1(System.Int32)).ctor(), 0, 0, ignoreFields);
                },
                CopyPropFromInternal: function (target, source, visited, currentLevel, maxLevel, ignoreFields) {
                    var $t;
                    if (currentLevel === void 0) { currentLevel = 0; }
                    if (maxLevel === void 0) { maxLevel = 0; }
                    if (ignoreFields === void 0) { ignoreFields = []; }
                    var shouldProcessNested = maxLevel === 0 || currentLevel < maxLevel;
                    if (source == null || target == null || !shouldProcessNested) {
                        return;
                    }

                    var targetType = Bridge.getType(target);
                    if (Core.Extensions.ReflectionExt.IsSimple(targetType)) {
                        return;
                    }

                    var hash = Bridge.getHashCode(source);
                    if (visited.contains(hash)) {
                        return;
                    }

                    visited.add(hash);
                    if (Bridge.Reflection.isAssignableFrom(System.Collections.IEnumerable, targetType)) {
                        var sourceEnumerator = Bridge.getEnumerator((Bridge.as(source, System.Collections.IEnumerable)));
                        var targetEnumerator = Bridge.getEnumerator((Bridge.as(target, System.Collections.IEnumerable)));
                        while (sourceEnumerator.System$Collections$IEnumerator$moveNext() && targetEnumerator.System$Collections$IEnumerator$moveNext()) {
                            Core.Extensions.ReflectionExt.CopyPropFromInternal(targetEnumerator.System$Collections$IEnumerator$Current, sourceEnumerator.System$Collections$IEnumerator$Current, visited, ((currentLevel + 1) | 0), maxLevel, ignoreFields);
                        }
                        return;
                    }
                    var targetProps = System.Linq.Enumerable.from(Bridge.Reflection.getMembers(targetType, 16, 28), System.Reflection.PropertyInfo).where(function (x) {
                            return (!!x.g) && (!!x.s);
                        });
                    $t = Bridge.getEnumerator(targetProps);
                    try {
                        while ($t.moveNext()) {
                            var targetProp = $t.Current;
                            if (ignoreFields != null && System.Array.contains(ignoreFields, targetProp.n, System.String)) {
                                continue;
                            }

                            var value = Core.Extensions.Utils.GetPropValue(source, targetProp.n);
                            if (Core.Extensions.ReflectionExt.IsDecimal(targetProp.rt) && value != null && !Core.Extensions.ReflectionExt.IsDecimal(Bridge.getType(value))) {
                                Core.Extensions.BridgeExt.SetPropValue(target, targetProp.n, System.Convert.toDecimal(value));
                            } else if (Core.Extensions.ReflectionExt.IsDate(targetProp.rt) && value != null && !Core.Extensions.ReflectionExt.IsDate(Bridge.getType(value))) {
                                Core.Extensions.BridgeExt.SetPropValue(target, targetProp.n, System.DateTimeOffset.op_Implicit(System.Convert.toDateTime(value)).$clone());
                            } else if (Core.Extensions.ReflectionExt.IsSimple(targetProp.rt)) {
                                Core.Extensions.BridgeExt.SetPropValue(target, targetProp.n, value);
                            } else {
                                Core.Extensions.ReflectionExt.CopyPropFromInternal(Core.Extensions.Utils.GetPropValue(target, targetProp.n), value, visited, ((currentLevel + 1) | 0), maxLevel, ignoreFields);
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                },
                GetEnumDescription: function (value, enumType) {
                    if (enumType === void 0) { enumType = null; }
                    enumType = enumType || Bridge.getType(value);
                    var fi = Bridge.Reflection.getMembers(enumType, 4, 284, System.Enum.toString(Bridge.getType(value), value));
                    if (fi == null) {
                        return "";
                    }

                    var attributes = Bridge.as(System.Attribute.getCustomAttributes(fi, System.ComponentModel.DescriptionAttribute, false), System.Array.type(System.ComponentModel.DescriptionAttribute));
                    if (attributes != null && System.Linq.Enumerable.from(attributes, System.ComponentModel.DescriptionAttribute).any()) {
                        return System.Linq.Enumerable.from(attributes, System.ComponentModel.DescriptionAttribute).first().Description;
                    }
                    return System.Enum.toString(Bridge.getType(value), value);
                },
                DeepCopy: function (obj, path) {
                    var $t, $t1, $t2;
                    if (path === void 0) { path = null; }
                    if (obj == null) {
                        return null;
                    }

                    var type = Bridge.getType(obj);
                    var modelName = Core.Extensions.Utils.GetPropValue(obj, "ModelName");
                    if (modelName != null) {
                        type = Bridge.Reflection.getType(System.String.concat(path, modelName));
                    }
                    if (Core.Extensions.ReflectionExt.IsSimple(type)) {
                        return obj;
                    } else if (Bridge.Reflection.isAssignableFrom(System.Collections.IEnumerable, type)) {
                        var copied = Bridge.createInstance(type);
                        var childrenType = ($t = Bridge.Reflection.getGenericArguments(type))[System.Array.index(0, $t)];
                        var enumerator = Bridge.getEnumerator((Bridge.as(obj, System.Collections.IEnumerable)));
                        var addMethod = Bridge.Reflection.getMembers(Bridge.getType(copied), 8, 16 | 256, "Add");
                        while (enumerator.System$Collections$IEnumerator$moveNext()) {
                            ($t1 = Bridge.Reflection.makeGenericMethod(addMethod, [childrenType])) != null ? Bridge.Reflection.midel($t1, Bridge.unbox(copied)).apply(null, Bridge.unbox(System.Array.init([Core.Extensions.ReflectionExt.DeepCopy(enumerator.System$Collections$IEnumerator$Current)], System.Object))) : null;
                        }
                        return copied;
                    } else if (Bridge.Reflection.isClass(type)) {
                        var toret;
                        if (modelName != null) {
                            toret = Bridge.createInstance(Bridge.Reflection.getType(System.String.concat(path, modelName)));
                        } else {
                            toret = Bridge.createInstance(Bridge.getType(obj));
                        }
                        var fields = Bridge.Reflection.getMembers(type, 4, 52);
                        $t2 = Bridge.getEnumerator(fields);
                        try {
                            while ($t2.moveNext()) {
                                var field = $t2.Current;
                                var fieldValue = Bridge.Reflection.fieldAccess(field, Bridge.unbox(obj));
                                if (fieldValue == null) {
                                    continue;
                                }

                                Bridge.Reflection.fieldAccess(field, Bridge.unbox(toret), Bridge.unbox(Core.Extensions.ReflectionExt.DeepCopy(fieldValue)));
                            }
                        } finally {
                            if (Bridge.is($t2, System.IDisposable)) {
                                $t2.System$IDisposable$Dispose();
                            }
                        }
                        return toret;
                    }
                    return null;
                },
                CloneRows: function (selectedRows, path) {
                    if (path === void 0) { path = null; }
                    return System.Linq.Enumerable.from(selectedRows, System.Object).select(function (x) {
                            var res = Core.Clients.XHRWrapper.UnboxValue(x);
                            res[Core.Extensions.ReflectionExt.IdField] = null;
                            return res;
                        });
                },
                ProcessObjectRecursive: function (obj, action, visited) {
                    var $t;
                    if (visited === void 0) { visited = null; }
                    if (obj == null || Core.Extensions.ReflectionExt.IsSimple(Bridge.getType(obj))) {
                        return;
                    }

                    if (visited == null) {
                        visited = new (System.Collections.Generic.HashSet$1(System.Object)).ctor();
                    }

                    if (visited.contains(obj)) {
                        return;
                    }

                    visited.add(obj);
                    var list;
                    if (((list = Bridge.as(obj, System.Collections.IEnumerable))) != null) {
                        try {
                            var enumerator = Bridge.getEnumerator(list);
                            while (enumerator.System$Collections$IEnumerator$moveNext()) {
                                Core.Extensions.ReflectionExt.ProcessObjectRecursive(enumerator.System$Collections$IEnumerator$Current, action, visited);
                            }
                        } catch ($e1) {
                            $e1 = System.Exception.create($e1);
                        }
                        return;
                    }
                    action(obj);
                    var childrenList = System.Linq.Enumerable.from(Bridge.Reflection.getMembers(Bridge.getType(obj), 16, 28), System.Reflection.PropertyInfo).where(function (x) {
                            return !Core.Extensions.ReflectionExt.IsSimple(x.rt) && Bridge.Reflection.isAssignableFrom(System.Collections.IEnumerable, x.rt);
                        });
                    $t = Bridge.getEnumerator(childrenList);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            Core.Extensions.ReflectionExt.ProcessObjectRecursive(Bridge.Reflection.midel(child.g, Bridge.unbox(obj))(), action, visited);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                },
                ToDictionaryDistinct: function (T, Key, source, keySelector) {
                    if (source == null) {
                        return null;
                    }

                    return System.Linq.Enumerable.from(source, T).groupBy(keySelector).select(function (g) {
                        return g.first();
                    }).toDictionary(keySelector, null, Key, T);
                }
            }
        }
    });

    Bridge.define("Core.Extensions.StringExt", {
        statics: {
            fields: {
                trimmer: null
            },
            ctors: {
                init: function () {
                    this.trimmer = new System.Text.RegularExpressions.Regex.ctor("\\s\\s+");
                }
            },
            methods: {
                IsNullOrEmpty: function (value) {
                    return System.String.isNullOrEmpty(value);
                },
                IsNullOrWhiteSpace: function (value) {
                    return System.String.isNullOrWhiteSpace(value);
                },
                HasAnyChar: function (value) {
                    return value != null && !System.String.isNullOrEmpty(value);
                },
                HasNonSpaceChar: function (value) {
                    return value != null && !System.String.isNullOrWhiteSpace(value);
                },
                CountChar: function (word, countableLetter) {
                    var $t;
                    var count = 0;
                    $t = Bridge.getEnumerator(word);
                    try {
                        while ($t.moveNext()) {
                            var c = $t.Current;
                            if (countableLetter === c) {
                                count = (count + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return count;
                },
                IsMatch: function (text, regText) {
                    var regEx = new System.Text.RegularExpressions.Regex.ctor(regText);
                    return regEx.isMatch(text);
                },
                TrimAndRemoveWhiteSpace: function (text) {
                    if (text == null) {
                        return null;
                    }

                    return Core.Extensions.StringExt.trimmer.replace(text.trim(), " ");
                },
                ToLower: function (val) {
                    return System.Boolean.toString(val).toLowerCase();
                },
                SubStrIndex: function (value, startIndex) {
                    if (value == null) {
                        return value;
                    }
                    if (startIndex < 0 || startIndex > ((value.length - 1) | 0)) {
                        startIndex = 0;
                    }
                    return value.substr(startIndex, ((value.length - startIndex) | 0));
                },
                SubStrIndex$1: function (value, startIndex, endIndex) {
                    if (value == null) {
                        return value;
                    }
                    if (startIndex < 0 || startIndex > ((value.length - 1) | 0)) {
                        startIndex = 0;
                    }
                    if (endIndex < 0 || endIndex > ((value.length - 1) | 0)) {
                        endIndex = (value.length - 1) | 0;
                    }
                    return value.substr(startIndex, ((endIndex - startIndex) | 0));
                }
            }
        }
    });

    Bridge.define("Core.Extensions.Toast", {
        statics: {
            methods: {
                Create: function (options) {
                    if (typeof(PNotify) !== 'undefined') {
                            new PNotify({
                                    title: options.Message,
                                    delay: options.Timeout,
                                    type: options.ClassName,
                                });
                        return;
                    }
                    Core.Components.Renderer.IHtml(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div, "toast"), options.ClassName), options.Message, options.Params);
                    var toast = Core.MVVM.Html.Context;

                    window.setTimeout(function () {
                        toast.remove();
                    }, options.Timeout);
                },
                Success: function (message, timeout, parameters) {
                    var $t;
                    if (timeout === void 0) { timeout = 2500; }
                    if (parameters === void 0) { parameters = []; }
                    Core.Extensions.Toast.Create(($t = new Core.Extensions.ToastOptions(), $t.ClassName = "success", $t.Timeout = timeout, $t.Message = message, $t.Params = parameters, $t));
                },
                Warning: function (message) {
                    var $t;
                    Core.Extensions.Toast.Create(($t = new Core.Extensions.ToastOptions(), $t.ClassName = "warning", $t.Timeout = 2500, $t.Message = message, $t));
                },
                Small: function (message, timeout) {
                    var $t;
                    if (timeout === void 0) { timeout = 2500; }
                    Core.Extensions.Toast.Create(($t = new Core.Extensions.ToastOptions(), $t.ClassName = "sm-tran", $t.Timeout = timeout, $t.Message = message, $t));
                }
            }
        }
    });

    Bridge.define("Core.Extensions.ToastOptions", {
        props: {
            Timeout: 0,
            ClassName: null,
            Message: null,
            Params: null
        }
    });

    Bridge.define("Core.Extensions.Utils", {
        statics: {
            fields: {
                SystemId: null,
                TenantField: null,
                Pixel: null,
                FeatureField: null,
                QuestionMark: null,
                Amp: null,
                ApplicationJson: null,
                Authorization: null,
                SelfVendorId: null,
                AutoSaveReason: null,
                IdField: null,
                NewLine: null,
                Indent: null,
                Dot: null,
                Slash: null,
                Hash: null,
                Comma: null,
                Semicolon: null,
                Space: null,
                ComponentId: null,
                ComponentGroupId: null,
                HistoryId: null,
                InsertedBy: null,
                OwnerUserIds: null,
                OwnerRoleIds: null,
                ComQuery: null,
                PatchSvc: null,
                UserSvc: null,
                DeactivateSvc: null,
                ExportExcel: null,
                FileSvc: null,
                GOOGLE_MAP: null,
                GOOGLE_MAP_PLACES: null,
                GOOGLE_MAP_GEOMETRY: null,
                GOOGLE_MAP_WEEKLY: null,
                GOOGLE_MAP_GEO_REQUEST: null,
                HeadChildren: null,
                SpecialChar: null,
                ReverseSpecialChar: null,
                NullFormatHandler: null,
                NotFoundHandler: null,
                EmptyFormat: null
            },
            ctors: {
                init: function () {
                    this.SystemId = "1";
                    this.TenantField = "t";
                    this.Pixel = "px";
                    this.FeatureField = "f";
                    this.QuestionMark = "?";
                    this.Amp = "&";
                    this.ApplicationJson = "application/json";
                    this.Authorization = "Authorization";
                    this.SelfVendorId = "65";
                    this.AutoSaveReason = "T\u1ef1 \u0111\u1ed9ng c\u1eadp nh\u1eadt";
                    this.IdField = "Id";
                    this.NewLine = "\r\n";
                    this.Indent = "\t";
                    this.Dot = ".";
                    this.Slash = "/";
                    this.Hash = "#";
                    this.Comma = ",";
                    this.Semicolon = ";";
                    this.Space = " ";
                    this.ComponentId = "20";
                    this.ComponentGroupId = "30";
                    this.HistoryId = "4199";
                    this.InsertedBy = "InsertedBy";
                    this.OwnerUserIds = "OwnerUserIds";
                    this.OwnerRoleIds = "OwnerRoleIds";
                    this.ComQuery = "/user/comQuery";
                    this.PatchSvc = "/v2/user";
                    this.UserSvc = "/user/svc";
                    this.DeactivateSvc = "/user/Deactivate";
                    this.ExportExcel = "/user/excel";
                    this.FileSvc = "/user/file";
                    this.GOOGLE_MAP = "https://maps.googleapis.com/maps/api/js?key=AIzaSyCr_2PaKJplCyvwN4q78lBkX3UBpfZ_HsY";
                    this.GOOGLE_MAP_PLACES = "https://maps.googleapis.com/maps/api/js?key=AIzaSyBfVrTUFatsZTyqaCKwRzbj09DD72VxSwc&libraries=places";
                    this.GOOGLE_MAP_GEOMETRY = "https://maps.googleapis.com/maps/api/js?key=AIzaSyBfVrTUFatsZTyqaCKwRzbj09DD72VxSwc&libraries=geometry";
                    this.GOOGLE_MAP_WEEKLY = "https://maps.googleapis.com/maps/api/js?key=AIzaSyBfVrTUFatsZTyqaCKwRzbj09DD72VxSwc&libraries=&v=weekly";
                    this.GOOGLE_MAP_GEO_REQUEST = "https://maps.googleapis.com/maps/api/geocode/json?key=AIzaSyBfVrTUFatsZTyqaCKwRzbj09DD72VxSwc";
                    this.HeadChildren = (document).head.children;
                    this.SpecialChar = function (_o1) {
                            _o1.add(43, "%2B");
                            _o1.add(47, "%2F");
                            _o1.add(63, "%3F");
                            _o1.add(35, "%23");
                            _o1.add(38, "%26");
                            return _o1;
                        }(new (System.Collections.Generic.Dictionary$2(System.Char,System.String)).ctor());
                    this.ReverseSpecialChar = System.Linq.Enumerable.from(Core.Extensions.Utils.SpecialChar, System.Collections.Generic.KeyValuePair$2(System.Char,System.String)).toDictionary(function (x) {
                            return x.value;
                        }, function (x) {
                            return x.key;
                        }, System.String, System.Char);
                    this.NullFormatHandler = function (x) {
                        return "null";
                    };
                    this.NotFoundHandler = function (x) {
                        return "{" + (x || "") + "}";
                    };
                    this.EmptyFormat = function (x) {
                        return "";
                    };
                }
            },
            methods: {
                EncodeSpecialChar: function (str) {
                    if (str == null) {
                        return null;
                    }

                    var arr = System.String.toCharArray(str, 0, str.length);
                    var res = new System.Text.StringBuilder();
                    for (var i = 0; i < arr.length; i = (i + 1) | 0) {
                        if (Core.Extensions.Utils.SpecialChar.containsKey(arr[System.Array.index(i, arr)])) {
                            res.append(Core.Extensions.Utils.SpecialChar.getItem(arr[System.Array.index(i, arr)]));
                        } else {
                            res.append(String.fromCharCode(arr[System.Array.index(i, arr)]));
                        }
                    }
                    return res.toString();
                },
                ParseJwt: function (token) {
                    var res = null;
                    var base64Url = token.split('.')[1];
                    var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));

                    res = JSON.parse(jsonPayload);
                    return res;
                },
                GenerateRandomToken: function (maxLength) {
                    if (maxLength === void 0) { maxLength = 32; }
                    var builder = new System.Text.StringBuilder();
                    var random = new System.Random.ctor();
                    var ch;
                    for (var i = 0; System.Nullable.lt(i, maxLength); i = (i + 1) | 0) {
                        ch = System.Convert.toChar(System.Convert.toInt32(Bridge.box(Math.floor(26 * random.NextDouble() + 65), System.Double, System.Double.format, System.Double.getHashCode)), null, 9);
                        builder.append(String.fromCharCode(ch));
                    }
                    return builder.toString();
                },
                AddDebugger: function () {
                    debugger;
                },
                ToJson: function (T, value) {
                    return Newtonsoft.Json.JsonConvert.SerializeObject(value);
                },
                EncodeProperties: function (value) {
                    var $t, $t1;
                    var props = value != null ? Bridge.Reflection.getMembers(Bridge.getType(value), 16, 28) : null;
                    $t = Bridge.getEnumerator(props);
                    try {
                        while ($t.moveNext()) {
                            var pi = $t.Current;
                            if (Bridge.referenceEquals(pi.rt, System.String) && (!!pi.s)) {
                                var oldValue = ($t1 = Bridge.Reflection.midel(pi.g, Bridge.unbox(value)).apply(null, null)) != null ? Bridge.toString($t1) : null;
                                Bridge.Reflection.midel(pi.s, value).apply(null, (null || []).concat(Core.Extensions.Utils.EncodeSpecialChar(oldValue)));
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return value;
                },
                DecodeProperties: function (value) {
                    var $t, $t1;
                    var props = value != null ? Bridge.Reflection.getMembers(Bridge.getType(value), 16, 28) : null;
                    $t = Bridge.getEnumerator(props);
                    try {
                        while ($t.moveNext()) {
                            var pi = $t.Current;
                            if (Bridge.referenceEquals(pi.rt, System.String) && (!!pi.s)) {
                                var oldValue = ($t1 = Bridge.Reflection.midel(pi.g, Bridge.unbox(value)).apply(null, null)) != null ? Bridge.toString($t1) : null;
                                Bridge.Reflection.midel(pi.s, value).apply(null, (null || []).concat(Core.Extensions.Utils.DecodeSpecialChar(oldValue)));
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return value;
                },
                GetUrlParam: function (key, origin) {
                    var $t;
                    if (key === void 0) { key = "f"; }
                    if (origin === void 0) { origin = null; }
                    var search = new URLSearchParams(($t = origin, $t != null ? $t : window.location.search));
                    var val = search.get(key);
                    return val;
                },
                IsOwner: function (entity, defaultOwnership) {
                    var $t, $t1, $t2;
                    if (defaultOwnership === void 0) { defaultOwnership = true; }
                    if (entity == null || entity[Core.Extensions.Utils.IdField] != null) {
                        return defaultOwnership;
                    }
                    var ownerUserIds = ($t = Core.Extensions.Utils.GetPropValue(entity, Core.Extensions.Utils.OwnerUserIds)) != null ? Bridge.toString($t) : null;
                    var isOwnerUser = Core.Extensions.StringExt.HasNonSpaceChar(ownerUserIds) && System.Array.contains(ownerUserIds.split(Core.Extensions.Utils.Comma), Core.Clients.Client.Token.UserId, System.String);
                    var ownerRoleIds = ($t1 = Core.Extensions.Utils.GetPropValue(entity, Core.Extensions.Utils.OwnerRoleIds)) != null ? Bridge.toString($t1) : null;
                    var isOwnerRole = Core.Extensions.StringExt.HasNonSpaceChar(ownerRoleIds) && (System.Linq.Enumerable.from(ownerRoleIds.split(Core.Extensions.Utils.Comma), System.String).join(Core.Clients.Client.Token.RoleIds, function (entityRole) {
                            return entityRole;
                        }, function (tokenRole) {
                            return tokenRole;
                        }, function (entityRole, tokenRole) {
                            return entityRole;
                        })).any();
                    var createdId = ($t2 = Core.Extensions.Utils.GetPropValue(entity, Core.Extensions.Utils.InsertedBy)) != null ? Bridge.toString($t2) : null;
                    var isOwner = ownerUserIds == null && Bridge.referenceEquals(createdId, Core.Clients.Client.Token.UserId) || isOwnerRole || isOwnerUser;
                    return isOwner;
                },
                GetEntityById: function (id) {
                    return System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, Core.Models.Entity, Core.Clients.Client.Entities, id);
                },
                GetEntity: function (name) {
                    return System.Linq.Enumerable.from(Core.Clients.Client.Entities.Values, Core.Models.Entity).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.Name, name);
                        }, null);
                },
                IsNullable: function (T, entityType, fieldName, obj) {
                    var type = Core.Extensions.BridgeExt.GetComplexPropType(entityType, fieldName, obj);
                    return type == null || Bridge.referenceEquals(type, System.Nullable$1(T));
                },
                DecodeSpecialChar: function (str) {
                    if (str == null) {
                        return null;
                    }

                    var arr = System.String.toCharArray(str, 0, str.length);
                    var res = new System.Text.StringBuilder();
                    for (var i = 0; i < arr.length; i = (i + 1) | 0) {
                        if (arr[System.Array.index(i, arr)] === 37 && ((i + 3) | 0) <= arr.length && Core.Extensions.Utils.ReverseSpecialChar.containsKey(str.substr(i, 3))) {
                            res.append(String.fromCharCode(Core.Extensions.Utils.ReverseSpecialChar.getItem(str.substr(i, 3))));
                            i = (i + 2) | 0;
                        } else {
                            res.append(String.fromCharCode(arr[System.Array.index(i, arr)]));
                        }
                    }
                    return res.toString();
                },
                GetPropValue: function (obj, propName) {
                    var $t;
                    if (obj == null || System.String.isNullOrWhiteSpace(propName)) {
                        return null;
                    }
                    if (System.String.indexOf(propName, Core.Extensions.Utils.Dot) < 0) {
                        return obj[propName];
                    }
                    var hierarchy = propName.split(Core.Extensions.Utils.Dot);
                    var res = obj;
                    $t = Bridge.getEnumerator(hierarchy);
                    try {
                        while ($t.moveNext()) {
                            var key = $t.Current;
                            if (res == null) {
                                return null;
                            }

                            res = Core.Extensions.Utils.GetPropValue(res, key);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return res;
                },
                FormatEntity$1: function (format, source) {
                    if (!Core.Extensions.StringExt.HasAnyChar(format)) {
                        return "";
                    }

                    if (source == null) {
                        return format;
                    }

                    return Core.Extensions.Utils.FormatEntity(format, null, source);
                },
                FormatEntity: function (format, provider, source, nullHandler, notFoundHandler) {
                    if (nullHandler === void 0) { nullHandler = null; }
                    if (notFoundHandler === void 0) { notFoundHandler = null; }
                    if (format == null) {
                        return null;
                    }

                    if (source == null) {
                        return format;
                    }

                    if (Bridge.staticEquals(nullHandler, null)) {
                        nullHandler = Core.Extensions.Utils.NullFormatHandler;
                    }

                    if (Bridge.staticEquals(notFoundHandler, null)) {
                        notFoundHandler = Core.Extensions.Utils.NotFoundHandler;
                    }

                    var formatted = new System.Text.StringBuilder();
                    var index = 0;
                    var isInGroup = false;
                    var beforeColon = false;
                    var field = new System.Text.StringBuilder();
                    var objList = new (System.Collections.Generic.List$1(System.Object)).ctor();
                    for (var i = 0; i < format.length; i = (i + 1) | 0) {
                        var ch = format.charCodeAt(i);
                        switch (ch) {
                            case 123: 
                                isInGroup = true;
                                beforeColon = true;
                                formatted.append(String.fromCharCode(ch) + (Bridge.toString(index) || ""));
                                break;
                            case 58: 
                                if (isInGroup && !beforeColon) {
                                    formatted.append(String.fromCharCode(ch));
                                } else if (isInGroup) {
                                    beforeColon = false;
                                    formatted.append(String.fromCharCode(ch));
                                    Core.Extensions.Utils.GetValues(source, nullHandler, notFoundHandler, field.toString(), objList);
                                    field.clear();
                                } else {
                                    formatted.append(String.fromCharCode(ch));
                                }
                                break;
                            case 125: 
                                if (isInGroup) {
                                    isInGroup = false;
                                    formatted.append(String.fromCharCode(ch));
                                    index = (index + 1) | 0;
                                    Core.Extensions.Utils.GetValues(source, nullHandler, notFoundHandler, field.toString(), objList);
                                    field.clear();
                                }
                                break;
                            default: 
                                if (isInGroup && beforeColon) {
                                    field.append(String.fromCharCode(ch));
                                } else {
                                    formatted.append(String.fromCharCode(ch));
                                }
                                break;
                        }
                    }
                    return System.String.formatProvider.apply(System.String, [provider, formatted.toString()].concat(objList.ToArray()));
                },
                GetValues: function (source, nullHandler, notFoundHandler, field, objList) {
                    if (Core.Extensions.StringExt.IsNullOrEmpty(field)) {
                        return;
                    }
                    var hasKey = { };
                    var value = { };
                    Bridge.Deconstruct(Core.Extensions.BridgeExt.GetComplexProp(source, field).$clone(), hasKey, value);
                    if (value.v == null && hasKey.v) {
                        value.v = nullHandler(field);
                    } else if (value.v == null && !hasKey.v) {
                        value.v = notFoundHandler(field);
                    }

                    objList.add(Bridge.referenceEquals(field, "0") ? source : value.v);
                },
                GetCellText: function (header, cellData, row, emptyRow) {
                    if (emptyRow === void 0) { emptyRow = false; }
                    return Core.Extensions.Utils.DecodeSpecialChar(Core.Extensions.Utils.GetCellTextInternal(header, cellData, row, emptyRow));
                },
                GetCellTextInternal: function (header, cellData, row, emptyRow) {
                    var $t, $t1;
                    if (emptyRow === void 0) { emptyRow = false; }
                    var dt = { v : System.DateTime.getNow() };
                    var isDate = cellData != null && Bridge.referenceEquals(header.ComponentType, "Datepicker") && System.DateTime.tryParse(Bridge.toString(cellData), null, dt);
                    var isRef = Core.Extensions.StringExt.HasNonSpaceChar(header.FieldText) || Core.Extensions.IEnumerableExtensions.HasElement(System.Object, header.LocalData) || Core.Extensions.StringExt.HasAnyChar(header.ReferenceId);
                    if (emptyRow) {
                        return "";
                    }
                    var cellInt;
                    if (Bridge.referenceEquals(header.FieldName, Core.Extensions.Utils.IdField) && cellData != null && ((cellInt = Bridge.is(cellData, System.Int32) ? System.Nullable.getValue(Bridge.cast(Bridge.unbox(cellData, System.Int32), System.Int32)) : null)) != null && cellInt <= 0) {
                        return "";
                    }
                    if (!isRef && Core.Extensions.StringExt.HasAnyChar(header.FormatEntity)) {
                        var fn = { };
                        if (Core.Extensions.Utils.IsFunction(header.FormatEntity, fn)) {
                            return Bridge.toString(fn.v.call(Bridge.unbox(row), Bridge.unbox(row)));
                        }
                        return Core.Extensions.Utils.GetFormattedRow(header.FormatEntity, row);
                    } else if (cellData == null) {
                        return ($t = header.PlainText, $t != null ? $t : "");
                    } else if (Bridge.is(cellData, System.DateTime) || isDate) {
                        return System.String.format(($t1 = header.FormatData, $t1 != null ? $t1 : "{0:dd/MM/yyyy}"), [Bridge.box(isDate ? dt.v : Bridge.as(cellData, System.DateTime, true), System.DateTime, System.Nullable.toStringFn(System.DateTime.format), System.Nullable.getHashCode)]);
                    } else if (isRef) {
                        return Bridge.as(row[header.FieldText], System.String);
                    } else if (Core.Extensions.StringExt.HasAnyChar(header.FormatData)) {
                        return System.String.format(header.FormatData, [cellData]);
                    } else {
                        return Bridge.toString(cellData);
                    }
                },
                CompareIdField: function (entity, cellData) {
                    var idVal = Core.Extensions.Utils.GetPropValue(entity, Core.Extensions.Utils.IdField);
                    var idLong;
                    var idInt;
                    return System.Nullable.liftne("ne", ((idLong = Bridge.is(idVal, System.Int64) ? System.Nullable.getValue(Bridge.cast(Bridge.unbox(idVal, System.Int64), System.Int64)) : null)), System.Int64.lift(null)) && idLong.equals(System.Nullable.getValue(Bridge.cast(Bridge.unbox(cellData, System.Int64), System.Int64))) || ((idInt = Bridge.is(idVal, System.Int32) ? System.Nullable.getValue(Bridge.cast(Bridge.unbox(idVal, System.Int32), System.Int32)) : null)) != null && idInt === System.Nullable.getValue(Bridge.cast(Bridge.unbox(cellData, System.Int32), System.Int32));
                },
                GetFormattedRow: function (exp, row) {
                    var $t;
                    var func = { };
                    var isFunc = Core.Extensions.Utils.IsFunction(exp, func);
                    if (!isFunc) {
                        return Core.Extensions.Utils.FormatEntity(exp, null, row, Core.Extensions.Utils.EmptyFormat, Core.Extensions.Utils.EmptyFormat);
                    }
                    return ($t = func.v.call(null, Bridge.unbox(row))) != null ? Bridge.toString($t) : null;
                },
                IsFunction: function (exp, obj) {
                    obj.v = null;
                    if (Core.Extensions.StringExt.IsNullOrEmpty(exp) || !System.String.contains(exp,"=>")) {
                        return false;
                    }
                    try {
                        obj.v = eval(exp);
                        if (obj.v != null && Bridge.hasValue(obj.v)) {
                            return true;
                        }
                    } catch ($e1) {
                        $e1 = System.Exception.create($e1);
                        return false;
                    }
                    return obj.v != null;
                },
                ForEachProp$1: function (obj, action) {
                    if (obj == null || Bridge.staticEquals(action, null)) {
                        return;
                    }
                    Object.keys(obj).forEach(x => action(x, obj[x]));
                },
                ForEachProp: function (obj, action) {
                    if (obj == null || Bridge.staticEquals(action, null)) {
                        return;
                    }
                    Object.keys(obj).forEach(x => action(key));
                },
                LastDayOfMonth: function (time) {
                    var $t;
                    if (time === void 0) { time = null; }

                    var current = ($t = time, $t != null ? $t : System.DateTime.getNow());
                    return System.DateTime.create(System.DateTime.getYear(current), System.DateTime.getMonth(current), System.DateTime.getDaysInMonth(System.DateTime.getYear(current), System.DateTime.getMonth(current)));
                },
                TryParseInt: function (value) {
                    var res = { };
                    var parsed = System.Int32.tryParse(value, res);
                    if (parsed) {
                        return res.v;
                    }

                    return null;
                },
                TryParseDecimal: function (value) {
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(value)) {
                        return System.Decimal.lift(null);
                    }
                    var res = { };

                    var parsed = System.Decimal.tryParse(value, null, res);
                    if (parsed) {
                        return res.v;
                    }

                    return System.Decimal.lift(null);
                },
                Parse: function (T, value) {
                    try {
                        return Newtonsoft.Json.JsonConvert.DeserializeObject(value, T);
                    } catch ($e1) {
                        $e1 = System.Exception.create($e1);
                        return null;
                    }
                },
                TryParse: function (T, value) {
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(value)) {
                        return null;
                    }

                    var type = T;
                    if (Bridge.Reflection.isEnum(type)) {
                        var t = { };
                        var parsed = System.Enum.tryParse(T, value, t);
                        return parsed ? t.v : null;
                    } else if (Bridge.referenceEquals(type, System.Int32) || Bridge.referenceEquals(type, System.Nullable$1(System.Int32))) {
                        return Bridge.as(System.Convert.toInt32(value), T, true);
                    } else if (Bridge.referenceEquals(type, System.Int64) || Bridge.referenceEquals(type, System.Nullable$1(System.Int64))) {
                        return Bridge.as(System.Convert.toInt64(value), T, true);
                    } else if (Bridge.referenceEquals(type, System.Int16) || Bridge.referenceEquals(type, System.Nullable$1(System.Int16))) {
                        return Bridge.as(System.Convert.toInt16(value), T, true);
                    } else if (Bridge.referenceEquals(type, System.Boolean) || Bridge.referenceEquals(type, System.Nullable$1(System.Boolean))) {
                        return Bridge.as(System.Convert.toBoolean(value), T, true);
                    } else if (Bridge.referenceEquals(type, System.TimeSpan) || Bridge.referenceEquals(type, System.Nullable$1(System.TimeSpan))) {
                        var res = { };
                        var parsed1 = System.TimeSpan.tryParse(value, null, res);
                        return parsed1 ? Bridge.as(res.v, T, true) : null;
                    } else if (Bridge.referenceEquals(type, System.DateTime) || Bridge.referenceEquals(type, System.Nullable$1(System.DateTime))) {
                        var res1 = { };
                        var parsed2 = System.DateTime.tryParse(value, null, res1);
                        return parsed2 ? Bridge.as(res1.v, T, true) : null;
                    } else if (Bridge.referenceEquals(type, System.DateTimeOffset) || Bridge.referenceEquals(type, System.Nullable$1(System.DateTimeOffset))) {
                        var res2 = { v : new System.DateTimeOffset() };
                        var parsed3 = System.DateTimeOffset.TryParse(value, res2);
                        return parsed3 ? Bridge.as(res2.v, T, true) : null;
                    } else if (Bridge.referenceEquals(type, System.Byte) || Bridge.referenceEquals(type, System.Nullable$1(System.Byte))) {
                        return Bridge.as(System.Convert.toByte(value), T, true);
                    } else if (Bridge.referenceEquals(type, System.Char) || Bridge.referenceEquals(type, System.Nullable$1(System.Char))) {
                        return Bridge.as(System.Convert.toChar(value, null, 18), T, true);
                    } else if (Bridge.referenceEquals(type, System.Decimal) || Bridge.referenceEquals(type, System.Nullable$1(System.Decimal))) {
                        return Bridge.as(System.Convert.toDecimal(value), T, true);
                    } else if (Bridge.referenceEquals(type, System.Double) || Bridge.referenceEquals(type, System.Nullable$1(System.Double))) {
                        return Bridge.as(System.Convert.toDouble(value), T, true);
                    } else if (Bridge.referenceEquals(type, System.Single) || Bridge.referenceEquals(type, System.Nullable$1(System.Single))) {
                        var res3 = { };
                        var parsed4 = System.Single.tryParse(value, null, res3);
                        return parsed4 ? Bridge.as(res3.v, T, true) : null;
                    }
                    return null;
                },
                ChangeType: function (value, type) {
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(value)) {
                        return null;
                    }

                    if (Bridge.referenceEquals(type, System.Int32) || Bridge.referenceEquals(type, System.Nullable$1(System.Int32))) {
                        var res = { };
                        var parsed = System.Int32.tryParse(value, res);
                        return Bridge.box(parsed ? res.v : (Bridge.referenceEquals(type, System.Int32) ? 0 : null), System.Int32, System.Nullable.toString, System.Nullable.getHashCode);
                    } else if (Bridge.referenceEquals(type, System.Int64) || Bridge.referenceEquals(type, System.Nullable$1(System.Int64))) {
                        var res1 = { };
                        var parsed1 = System.Int64.tryParse(value, res1);
                        return parsed1 ? res1.v : (Bridge.referenceEquals(type, System.Int64) ? System.Int64(0) : System.Int64.lift(null));
                    } else if (Bridge.referenceEquals(type, System.Int16) || Bridge.referenceEquals(type, System.Nullable$1(System.Int16))) {
                        var res2 = { };
                        var parsed2 = System.Int16.tryParse(value, res2);
                        return Bridge.box(parsed2 ? res2.v : (Bridge.referenceEquals(type, System.Int16) ? 0 : null), System.Int16, System.Nullable.toString, System.Nullable.getHashCode);
                    } else if (Bridge.referenceEquals(type, System.Boolean) || Bridge.referenceEquals(type, System.Nullable$1(System.Boolean))) {
                        return Bridge.box(System.Convert.toBoolean(value), System.Boolean, System.Boolean.toString);
                    } else if (Bridge.referenceEquals(type, System.TimeSpan) || Bridge.referenceEquals(type, System.Nullable$1(System.TimeSpan))) {
                        var res3 = { };
                        var parsed3 = System.TimeSpan.tryParse(value, null, res3);
                        return parsed3 ? res3.v : null;
                    } else if (Bridge.referenceEquals(type, System.DateTime) || Bridge.referenceEquals(type, System.Nullable$1(System.DateTime))) {
                        var res4 = { };
                        var parsed4 = System.DateTime.tryParse(value, null, res4);
                        return Bridge.box(parsed4 ? res4.v : null, System.DateTime, System.Nullable.toStringFn(System.DateTime.format), System.Nullable.getHashCode);
                    } else if (Bridge.referenceEquals(type, System.DateTimeOffset) || Bridge.referenceEquals(type, System.Nullable$1(System.DateTimeOffset))) {
                        var res5 = { v : new System.DateTimeOffset() };
                        var parsed5 = System.DateTimeOffset.TryParse(value, res5);
                        return System.Nullable.lift1("$clone", parsed5 ? res5.v : null);
                    } else if (Bridge.referenceEquals(type, System.Byte) || Bridge.referenceEquals(type, System.Nullable$1(System.Byte))) {
                        return Bridge.box(System.Convert.toByte(value), System.Byte);
                    } else if (Bridge.referenceEquals(type, System.Char) || Bridge.referenceEquals(type, System.Nullable$1(System.Char))) {
                        return Bridge.box(System.Convert.toChar(value, null, 18), System.Char, String.fromCharCode, System.Char.getHashCode);
                    } else if (Bridge.referenceEquals(type, System.Decimal) || Bridge.referenceEquals(type, System.Nullable$1(System.Decimal))) {
                        var res6 = { };
                        var parsed6 = System.Decimal.tryParse(value, null, res6);
                        return parsed6 ? res6.v : (Bridge.referenceEquals(type, System.Decimal) ? System.Decimal(0) : System.Decimal.lift(null));
                    } else if (Bridge.referenceEquals(type, System.Double) || Bridge.referenceEquals(type, System.Nullable$1(System.Double))) {
                        var res7 = { };
                        var parsed7 = System.Single.tryParse(value, null, res7);
                        return Bridge.box(parsed7 ? res7.v : (Bridge.referenceEquals(type, System.Double) ? 0 : null), System.Double, System.Nullable.toStringFn(System.Double.format), System.Nullable.getHashCodeFn(System.Double.getHashCode));
                    } else if (Bridge.referenceEquals(type, System.Single) || Bridge.referenceEquals(type, System.Nullable$1(System.Single))) {
                        var res8 = { };
                        var parsed8 = System.Single.tryParse(value, null, res8);
                        return Bridge.box(parsed8 ? res8.v : (Bridge.referenceEquals(type, System.Single) ? 0 : null), System.Single, System.Nullable.toStringFn(System.Single.format), System.Nullable.getHashCodeFn(System.Single.getHashCode));
                    }
                    return null;
                },
                GetMimeType: function (extension) {
                    if (extension == null) {
                        throw new System.ArgumentNullException.$ctor1("extension");
                    }

                    if (System.String.startsWith(extension, ".")) {
                        extension = extension.substr(1);
                    }

                    extension = extension.toLowerCase();
                    switch (extension) {
                        case "323": 
                            return "text/h323";
                        case "3g2": 
                            return "video/3gpp2";
                        case "3gp": 
                            return "video/3gpp";
                        case "3gp2": 
                            return "video/3gpp2";
                        case "3gpp": 
                            return "video/3gpp";
                        case "7z": 
                            return "application/x-7z-compressed";
                        case "aa": 
                            return "audio/audible";
                        case "aac": 
                            return "audio/aac";
                        case "aaf": 
                            return "application/octet-stream";
                        case "aax": 
                            return "audio/vnd.audible.aax";
                        case "ac3": 
                            return "audio/ac3";
                        case "aca": 
                            return "application/octet-stream";
                        case "accda": 
                            return "application/msaccess.addin";
                        case "accdb": 
                            return "application/msaccess";
                        case "accdc": 
                            return "application/msaccess.cab";
                        case "accde": 
                            return "application/msaccess";
                        case "accdr": 
                            return "application/msaccess.runtime";
                        case "accdt": 
                            return "application/msaccess";
                        case "accdw": 
                            return "application/msaccess.webapplication";
                        case "accft": 
                            return "application/msaccess.ftemplate";
                        case "acx": 
                            return "application/internet-property-stream";
                        case "addin": 
                            return "text/xml";
                        case "ade": 
                            return "application/msaccess";
                        case "adobebridge": 
                            return "application/x-bridge-url";
                        case "adp": 
                            return "application/msaccess";
                        case "adt": 
                            return "audio/vnd.dlna.adts";
                        case "adts": 
                            return "audio/aac";
                        case "afm": 
                            return "application/octet-stream";
                        case "ai": 
                            return "application/postscript";
                        case "aif": 
                            return "audio/x-aiff";
                        case "aifc": 
                            return "audio/aiff";
                        case "aiff": 
                            return "audio/aiff";
                        case "air": 
                            return "application/vnd.adobe.air-application-installer-package+zip";
                        case "amc": 
                            return "application/x-mpeg";
                        case "application": 
                            return "application/x-ms-application";
                        case "art": 
                            return "image/x-jg";
                        case "asa": 
                            return "application/xml";
                        case "asax": 
                            return "application/xml";
                        case "ascx": 
                            return "application/xml";
                        case "asd": 
                            return "application/octet-stream";
                        case "asf": 
                            return "video/x-ms-asf";
                        case "ashx": 
                            return "application/xml";
                        case "asi": 
                            return "application/octet-stream";
                        case "asm": 
                            return "text/plain";
                        case "asmx": 
                            return "application/xml";
                        case "aspx": 
                            return "application/xml";
                        case "asr": 
                            return "video/x-ms-asf";
                        case "asx": 
                            return "video/x-ms-asf";
                        case "atom": 
                            return "application/atom+xml";
                        case "au": 
                            return "audio/basic";
                        case "avi": 
                            return "video/x-msvideo";
                        case "axs": 
                            return "application/olescript";
                        case "bas": 
                            return "text/plain";
                        case "bcpio": 
                            return "application/x-bcpio";
                        case "bin": 
                            return "application/octet-stream";
                        case "bmp": 
                            return "image/bmp";
                        case "c": 
                            return "text/plain";
                        case "cab": 
                            return "application/octet-stream";
                        case "caf": 
                            return "audio/x-caf";
                        case "calx": 
                            return "application/vnd.ms-office.calx";
                        case "cat": 
                            return "application/vnd.ms-pki.seccat";
                        case "cc": 
                            return "text/plain";
                        case "cd": 
                            return "text/plain";
                        case "cdda": 
                            return "audio/aiff";
                        case "cdf": 
                            return "application/x-cdf";
                        case "cer": 
                            return "application/x-x509-ca-cert";
                        case "chm": 
                            return "application/octet-stream";
                        case "class": 
                            return "application/x-java-applet";
                        case "clp": 
                            return "application/x-msclip";
                        case "cmx": 
                            return "image/x-cmx";
                        case "cnf": 
                            return "text/plain";
                        case "cod": 
                            return "image/cis-cod";
                        case "config": 
                            return "application/xml";
                        case "contact": 
                            return "text/x-ms-contact";
                        case "coverage": 
                            return "application/xml";
                        case "cpio": 
                            return "application/x-cpio";
                        case "cpp": 
                            return "text/plain";
                        case "crd": 
                            return "application/x-mscardfile";
                        case "crl": 
                            return "application/pkix-crl";
                        case "crt": 
                            return "application/x-x509-ca-cert";
                        case "cs": 
                            return "text/plain";
                        case "csdproj": 
                            return "text/plain";
                        case "csh": 
                            return "application/x-csh";
                        case "csproj": 
                            return "text/plain";
                        case "css": 
                            return "text/css";
                        case "csv": 
                            return "text/csv";
                        case "cur": 
                            return "application/octet-stream";
                        case "cxx": 
                            return "text/plain";
                        case "dat": 
                            return "application/octet-stream";
                        case "DataSourceFilter": 
                            return "application/xml";
                        case "dbproj": 
                            return "text/plain";
                        case "dcr": 
                            return "application/x-director";
                        case "def": 
                            return "text/plain";
                        case "deploy": 
                            return "application/octet-stream";
                        case "der": 
                            return "application/x-x509-ca-cert";
                        case "dgml": 
                            return "application/xml";
                        case "dib": 
                            return "image/bmp";
                        case "dif": 
                            return "video/x-dv";
                        case "dir": 
                            return "application/x-director";
                        case "disco": 
                            return "text/xml";
                        case "dll": 
                            return "application/x-msdownload";
                        case "dll.config": 
                            return "text/xml";
                        case "dlm": 
                            return "text/dlm";
                        case "doc": 
                            return "application/msword";
                        case "docm": 
                            return "application/vnd.ms-word.document.macroenabled.12";
                        case "docx": 
                            return "application/vnd.openxmlformats-officedocument.wordprocessingml.document";
                        case "dot": 
                            return "application/msword";
                        case "dotm": 
                            return "application/vnd.ms-word.template.macroenabled.12";
                        case "dotx": 
                            return "application/vnd.openxmlformats-officedocument.wordprocessingml.template";
                        case "dsp": 
                            return "application/octet-stream";
                        case "dsw": 
                            return "text/plain";
                        case "dtd": 
                            return "text/xml";
                        case "dtsconfig": 
                            return "text/xml";
                        case "dv": 
                            return "video/x-dv";
                        case "dvi": 
                            return "application/x-dvi";
                        case "dwf": 
                            return "drawing/x-dwf";
                        case "dwp": 
                            return "application/octet-stream";
                        case "dxr": 
                            return "application/x-director";
                        case "eml": 
                            return "message/rfc822";
                        case "emz": 
                            return "application/octet-stream";
                        case "eot": 
                            return "application/octet-stream";
                        case "eps": 
                            return "application/postscript";
                        case "etl": 
                            return "application/etl";
                        case "etx": 
                            return "text/x-setext";
                        case "evy": 
                            return "application/envoy";
                        case "exe": 
                            return "application/octet-stream";
                        case "exe.config": 
                            return "text/xml";
                        case "fdf": 
                            return "application/vnd.fdf";
                        case "fif": 
                            return "application/fractals";
                        case "filters": 
                            return "application/xml";
                        case "fla": 
                            return "application/octet-stream";
                        case "flr": 
                            return "x-world/x-vrml";
                        case "flv": 
                            return "video/x-flv";
                        case "fsscript": 
                            return "application/fsharp-script";
                        case "fsx": 
                            return "application/fsharp-script";
                        case "generictest": 
                            return "application/xml";
                        case "gif": 
                            return "image/gif";
                        case "group": 
                            return "text/x-ms-group";
                        case "gsm": 
                            return "audio/x-gsm";
                        case "gtar": 
                            return "application/x-gtar";
                        case "gz": 
                            return "application/x-gzip";
                        case "h": 
                            return "text/plain";
                        case "hdf": 
                            return "application/x-hdf";
                        case "hdml": 
                            return "text/x-hdml";
                        case "hhc": 
                            return "application/x-oleobject";
                        case "hhk": 
                            return "application/octet-stream";
                        case "hhp": 
                            return "application/octet-stream";
                        case "hlp": 
                            return "application/winhlp";
                        case "hpp": 
                            return "text/plain";
                        case "hqx": 
                            return "application/mac-binhex40";
                        case "hta": 
                            return "application/hta";
                        case "htc": 
                            return "text/x-component";
                        case "htm": 
                            return "text/html";
                        case "html": 
                            return "text/html";
                        case "htt": 
                            return "text/webviewhtml";
                        case "hxa": 
                            return "application/xml";
                        case "hxc": 
                            return "application/xml";
                        case "hxd": 
                            return "application/octet-stream";
                        case "hxe": 
                            return "application/xml";
                        case "hxf": 
                            return "application/xml";
                        case "hxh": 
                            return "application/octet-stream";
                        case "hxi": 
                            return "application/octet-stream";
                        case "hxk": 
                            return "application/xml";
                        case "hxq": 
                            return "application/octet-stream";
                        case "hxr": 
                            return "application/octet-stream";
                        case "hxs": 
                            return "application/octet-stream";
                        case "hxt": 
                            return "text/html";
                        case "hxv": 
                            return "application/xml";
                        case "hxw": 
                            return "application/octet-stream";
                        case "hxx": 
                            return "text/plain";
                        case "i": 
                            return "text/plain";
                        case "ico": 
                            return "image/x-icon";
                        case "ics": 
                            return "application/octet-stream";
                        case "idl": 
                            return "text/plain";
                        case "ief": 
                            return "image/ief";
                        case "iii": 
                            return "application/x-iphone";
                        case "inc": 
                            return "text/plain";
                        case "inf": 
                            return "application/octet-stream";
                        case "inl": 
                            return "text/plain";
                        case "ins": 
                            return "application/x-internet-signup";
                        case "ipa": 
                            return "application/x-itunes-ipa";
                        case "ipg": 
                            return "application/x-itunes-ipg";
                        case "ipproj": 
                            return "text/plain";
                        case "ipsw": 
                            return "application/x-itunes-ipsw";
                        case "iqy": 
                            return "text/x-ms-iqy";
                        case "isp": 
                            return "application/x-internet-signup";
                        case "ite": 
                            return "application/x-itunes-ite";
                        case "itlp": 
                            return "application/x-itunes-itlp";
                        case "itms": 
                            return "application/x-itunes-itms";
                        case "itpc": 
                            return "application/x-itunes-itpc";
                        case "ivf": 
                            return "video/x-ivf";
                        case "jar": 
                            return "application/java-archive";
                        case "java": 
                            return "application/octet-stream";
                        case "jck": 
                            return "application/liquidmotion";
                        case "jcz": 
                            return "application/liquidmotion";
                        case "jfif": 
                            return "image/pjpeg";
                        case "jnlp": 
                            return "application/x-java-jnlp-file";
                        case "jpb": 
                            return "application/octet-stream";
                        case "jpe": 
                            return "image/jpeg";
                        case "jpeg": 
                            return "image/jpeg";
                        case "jpg": 
                            return "image/jpeg";
                        case "js": 
                            return "application/x-javascript";
                        case "jsx": 
                            return "text/jscript";
                        case "jsxbin": 
                            return "text/plain";
                        case "latex": 
                            return "application/x-latex";
                        case "library-ms": 
                            return "application/windows-library+xml";
                        case "lit": 
                            return "application/x-ms-reader";
                        case "loadtest": 
                            return "application/xml";
                        case "lpk": 
                            return "application/octet-stream";
                        case "lsf": 
                            return "video/x-la-asf";
                        case "lst": 
                            return "text/plain";
                        case "lsx": 
                            return "video/x-la-asf";
                        case "lzh": 
                            return "application/octet-stream";
                        case "m13": 
                            return "application/x-msmediaview";
                        case "m14": 
                            return "application/x-msmediaview";
                        case "m1v": 
                            return "video/mpeg";
                        case "m2t": 
                            return "video/vnd.dlna.mpeg-tts";
                        case "m2ts": 
                            return "video/vnd.dlna.mpeg-tts";
                        case "m2v": 
                            return "video/mpeg";
                        case "m3u": 
                            return "audio/x-mpegurl";
                        case "m3u8": 
                            return "audio/x-mpegurl";
                        case "m4a": 
                            return "audio/m4a";
                        case "m4b": 
                            return "audio/m4b";
                        case "m4p": 
                            return "audio/m4p";
                        case "m4r": 
                            return "audio/x-m4r";
                        case "m4v": 
                            return "video/x-m4v";
                        case "mac": 
                            return "image/x-macpaint";
                        case "mak": 
                            return "text/plain";
                        case "man": 
                            return "application/x-troff-man";
                        case "manifest": 
                            return "application/x-ms-manifest";
                        case "map": 
                            return "text/plain";
                        case "master": 
                            return "application/xml";
                        case "mda": 
                            return "application/msaccess";
                        case "mdb": 
                            return "application/x-msaccess";
                        case "mde": 
                            return "application/msaccess";
                        case "mdp": 
                            return "application/octet-stream";
                        case "me": 
                            return "application/x-troff-me";
                        case "mfp": 
                            return "application/x-shockwave-flash";
                        case "mht": 
                            return "message/rfc822";
                        case "mhtml": 
                            return "message/rfc822";
                        case "mid": 
                            return "audio/mid";
                        case "midi": 
                            return "audio/mid";
                        case "mix": 
                            return "application/octet-stream";
                        case "mk": 
                            return "text/plain";
                        case "mmf": 
                            return "application/x-smaf";
                        case "mno": 
                            return "text/xml";
                        case "mny": 
                            return "application/x-msmoney";
                        case "mod": 
                            return "video/mpeg";
                        case "mov": 
                            return "video/quicktime";
                        case "movie": 
                            return "video/x-sgi-movie";
                        case "mp2": 
                            return "video/mpeg";
                        case "mp2v": 
                            return "video/mpeg";
                        case "mp3": 
                            return "audio/mpeg";
                        case "mp4": 
                            return "video/mp4";
                        case "mp4v": 
                            return "video/mp4";
                        case "mpa": 
                            return "video/mpeg";
                        case "mpe": 
                            return "video/mpeg";
                        case "mpeg": 
                            return "video/mpeg";
                        case "mpf": 
                            return "application/vnd.ms-mediapackage";
                        case "mpg": 
                            return "video/mpeg";
                        case "mpp": 
                            return "application/vnd.ms-project";
                        case "mpv2": 
                            return "video/mpeg";
                        case "mqv": 
                            return "video/quicktime";
                        case "ms": 
                            return "application/x-troff-ms";
                        case "msi": 
                            return "application/octet-stream";
                        case "mso": 
                            return "application/octet-stream";
                        case "mts": 
                            return "video/vnd.dlna.mpeg-tts";
                        case "mtx": 
                            return "application/xml";
                        case "mvb": 
                            return "application/x-msmediaview";
                        case "mvc": 
                            return "application/x-miva-compiled";
                        case "mxp": 
                            return "application/x-mmxp";
                        case "nc": 
                            return "application/x-netcdf";
                        case "nsc": 
                            return "video/x-ms-asf";
                        case "nws": 
                            return "message/rfc822";
                        case "ocx": 
                            return "application/octet-stream";
                        case "oda": 
                            return "application/oda";
                        case "odc": 
                            return "text/x-ms-odc";
                        case "odh": 
                            return "text/plain";
                        case "odl": 
                            return "text/plain";
                        case "odp": 
                            return "application/vnd.oasis.opendocument.presentation";
                        case "ods": 
                            return "application/oleobject";
                        case "odt": 
                            return "application/vnd.oasis.opendocument.text";
                        case "one": 
                            return "application/onenote";
                        case "onea": 
                            return "application/onenote";
                        case "onepkg": 
                            return "application/onenote";
                        case "onetmp": 
                            return "application/onenote";
                        case "onetoc": 
                            return "application/onenote";
                        case "onetoc2": 
                            return "application/onenote";
                        case "orderedtest": 
                            return "application/xml";
                        case "osdx": 
                            return "application/opensearchdescription+xml";
                        case "p10": 
                            return "application/pkcs10";
                        case "p12": 
                            return "application/x-pkcs12";
                        case "p7b": 
                            return "application/x-pkcs7-certificates";
                        case "p7c": 
                            return "application/pkcs7-mime";
                        case "p7m": 
                            return "application/pkcs7-mime";
                        case "p7r": 
                            return "application/x-pkcs7-certreqresp";
                        case "p7s": 
                            return "application/pkcs7-signature";
                        case "pbm": 
                            return "image/x-portable-bitmap";
                        case "pcast": 
                            return "application/x-podcast";
                        case "pct": 
                            return "image/pict";
                        case "pcx": 
                            return "application/octet-stream";
                        case "pcz": 
                            return "application/octet-stream";
                        case "pdf": 
                            return "application/pdf";
                        case "pfb": 
                            return "application/octet-stream";
                        case "pfm": 
                            return "application/octet-stream";
                        case "pfx": 
                            return "application/x-pkcs12";
                        case "pgm": 
                            return "image/x-portable-graymap";
                        case "pic": 
                            return "image/pict";
                        case "pict": 
                            return "image/pict";
                        case "pkgdef": 
                            return "text/plain";
                        case "pkgundef": 
                            return "text/plain";
                        case "pko": 
                            return "application/vnd.ms-pki.pko";
                        case "pls": 
                            return "audio/scpls";
                        case "pma": 
                            return "application/x-perfmon";
                        case "pmc": 
                            return "application/x-perfmon";
                        case "pml": 
                            return "application/x-perfmon";
                        case "pmr": 
                            return "application/x-perfmon";
                        case "pmw": 
                            return "application/x-perfmon";
                        case "png": 
                            return "image/png";
                        case "pnm": 
                            return "image/x-portable-anymap";
                        case "pnt": 
                            return "image/x-macpaint";
                        case "pntg": 
                            return "image/x-macpaint";
                        case "pnz": 
                            return "image/png";
                        case "pot": 
                            return "application/vnd.ms-powerpoint";
                        case "potm": 
                            return "application/vnd.ms-powerpoint.template.macroenabled.12";
                        case "potx": 
                            return "application/vnd.openxmlformats-officedocument.presentationml.template";
                        case "ppa": 
                            return "application/vnd.ms-powerpoint";
                        case "ppam": 
                            return "application/vnd.ms-powerpoint.addin.macroenabled.12";
                        case "ppm": 
                            return "image/x-portable-pixmap";
                        case "pps": 
                            return "application/vnd.ms-powerpoint";
                        case "ppsm": 
                            return "application/vnd.ms-powerpoint.slideshow.macroenabled.12";
                        case "ppsx": 
                            return "application/vnd.openxmlformats-officedocument.presentationml.slideshow";
                        case "ppt": 
                            return "application/vnd.ms-powerpoint";
                        case "pptm": 
                            return "application/vnd.ms-powerpoint.presentation.macroenabled.12";
                        case "pptx": 
                            return "application/vnd.openxmlformats-officedocument.presentationml.presentation";
                        case "prf": 
                            return "application/pics-rules";
                        case "prm": 
                            return "application/octet-stream";
                        case "prx": 
                            return "application/octet-stream";
                        case "ps": 
                            return "application/postscript";
                        case "psc1": 
                            return "application/powershell";
                        case "psd": 
                            return "application/octet-stream";
                        case "psess": 
                            return "application/xml";
                        case "psm": 
                            return "application/octet-stream";
                        case "psp": 
                            return "application/octet-stream";
                        case "pub": 
                            return "application/x-mspublisher";
                        case "pwz": 
                            return "application/vnd.ms-powerpoint";
                        case "qht": 
                            return "text/x-html-insertion";
                        case "qhtm": 
                            return "text/x-html-insertion";
                        case "qt": 
                            return "video/quicktime";
                        case "qti": 
                            return "image/x-quicktime";
                        case "qtif": 
                            return "image/x-quicktime";
                        case "qtl": 
                            return "application/x-quicktimeplayer";
                        case "qxd": 
                            return "application/octet-stream";
                        case "ra": 
                            return "audio/x-pn-realaudio";
                        case "ram": 
                            return "audio/x-pn-realaudio";
                        case "rar": 
                            return "application/octet-stream";
                        case "ras": 
                            return "image/x-cmu-raster";
                        case "rat": 
                            return "application/rat-file";
                        case "rc": 
                            return "text/plain";
                        case "rc2": 
                            return "text/plain";
                        case "rct": 
                            return "text/plain";
                        case "rdlc": 
                            return "application/xml";
                        case "resx": 
                            return "application/xml";
                        case "rf": 
                            return "image/vnd.rn-realflash";
                        case "rgb": 
                            return "image/x-rgb";
                        case "rgs": 
                            return "text/plain";
                        case "rm": 
                            return "application/vnd.rn-realmedia";
                        case "rmi": 
                            return "audio/mid";
                        case "rmp": 
                            return "application/vnd.rn-rn_music_package";
                        case "roff": 
                            return "application/x-troff";
                        case "rpm": 
                            return "audio/x-pn-realaudio-plugin";
                        case "rqy": 
                            return "text/x-ms-rqy";
                        case "rtf": 
                            return "application/rtf";
                        case "rtx": 
                            return "text/richtext";
                        case "ruleset": 
                            return "application/xml";
                        case "s": 
                            return "text/plain";
                        case "safariextz": 
                            return "application/x-safari-safariextz";
                        case "scd": 
                            return "application/x-msschedule";
                        case "sct": 
                            return "text/scriptlet";
                        case "sd2": 
                            return "audio/x-sd2";
                        case "sdp": 
                            return "application/sdp";
                        case "sea": 
                            return "application/octet-stream";
                        case "searchconnector-ms": 
                            return "application/windows-search-connector+xml";
                        case "setpay": 
                            return "application/set-payment-initiation";
                        case "setreg": 
                            return "application/set-registration-initiation";
                        case "settings": 
                            return "application/xml";
                        case "sgimb": 
                            return "application/x-sgimb";
                        case "sgml": 
                            return "text/sgml";
                        case "sh": 
                            return "application/x-sh";
                        case "shar": 
                            return "application/x-shar";
                        case "shtml": 
                            return "text/html";
                        case "sit": 
                            return "application/x-stuffit";
                        case "sitemap": 
                            return "application/xml";
                        case "skin": 
                            return "application/xml";
                        case "sldm": 
                            return "application/vnd.ms-powerpoint.slide.macroenabled.12";
                        case "sldx": 
                            return "application/vnd.openxmlformats-officedocument.presentationml.slide";
                        case "slk": 
                            return "application/vnd.ms-excel";
                        case "sln": 
                            return "text/plain";
                        case "slupkg-ms": 
                            return "application/x-ms-license";
                        case "smd": 
                            return "audio/x-smd";
                        case "smi": 
                            return "application/octet-stream";
                        case "smx": 
                            return "audio/x-smd";
                        case "smz": 
                            return "audio/x-smd";
                        case "snd": 
                            return "audio/basic";
                        case "snippet": 
                            return "application/xml";
                        case "snp": 
                            return "application/octet-stream";
                        case "sol": 
                            return "text/plain";
                        case "sor": 
                            return "text/plain";
                        case "spc": 
                            return "application/x-pkcs7-certificates";
                        case "spl": 
                            return "application/futuresplash";
                        case "src": 
                            return "application/x-wais-source";
                        case "srf": 
                            return "text/plain";
                        case "ssisdeploymentmanifest": 
                            return "text/xml";
                        case "ssm": 
                            return "application/streamingmedia";
                        case "sst": 
                            return "application/vnd.ms-pki.certstore";
                        case "stl": 
                            return "application/vnd.ms-pki.stl";
                        case "sv4cpio": 
                            return "application/x-sv4cpio";
                        case "sv4crc": 
                            return "application/x-sv4crc";
                        case "svc": 
                            return "application/xml";
                        case "swf": 
                            return "application/x-shockwave-flash";
                        case "t": 
                            return "application/x-troff";
                        case "tar": 
                            return "application/x-tar";
                        case "tcl": 
                            return "application/x-tcl";
                        case "testrunconfig": 
                            return "application/xml";
                        case "testsettings": 
                            return "application/xml";
                        case "tex": 
                            return "application/x-tex";
                        case "texi": 
                            return "application/x-texinfo";
                        case "texinfo": 
                            return "application/x-texinfo";
                        case "tgz": 
                            return "application/x-compressed";
                        case "thmx": 
                            return "application/vnd.ms-officetheme";
                        case "thn": 
                            return "application/octet-stream";
                        case "tif": 
                            return "image/tiff";
                        case "tiff": 
                            return "image/tiff";
                        case "tlh": 
                            return "text/plain";
                        case "tli": 
                            return "text/plain";
                        case "toc": 
                            return "application/octet-stream";
                        case "tr": 
                            return "application/x-troff";
                        case "trm": 
                            return "application/x-msterminal";
                        case "trx": 
                            return "application/xml";
                        case "ts": 
                            return "video/vnd.dlna.mpeg-tts";
                        case "tsv": 
                            return "text/tab-separated-values";
                        case "ttf": 
                            return "application/octet-stream";
                        case "tts": 
                            return "video/vnd.dlna.mpeg-tts";
                        case "txt": 
                            return "text/plain";
                        case "u32": 
                            return "application/octet-stream";
                        case "uls": 
                            return "text/iuls";
                        case "user": 
                            return "text/plain";
                        case "ustar": 
                            return "application/x-ustar";
                        case "vb": 
                            return "text/plain";
                        case "vbdproj": 
                            return "text/plain";
                        case "vbk": 
                            return "video/mpeg";
                        case "vbproj": 
                            return "text/plain";
                        case "vbs": 
                            return "text/vbscript";
                        case "vcf": 
                            return "text/x-vcard";
                        case "vcproj": 
                            return "application/xml";
                        case "vcs": 
                            return "text/plain";
                        case "vcxproj": 
                            return "application/xml";
                        case "vddproj": 
                            return "text/plain";
                        case "vdp": 
                            return "text/plain";
                        case "vdproj": 
                            return "text/plain";
                        case "vdx": 
                            return "application/vnd.ms-visio.viewer";
                        case "vml": 
                            return "text/xml";
                        case "vscontent": 
                            return "application/xml";
                        case "vsct": 
                            return "text/xml";
                        case "vsd": 
                            return "application/vnd.visio";
                        case "vsi": 
                            return "application/ms-vsi";
                        case "vsix": 
                            return "application/vsix";
                        case "vsixlangpack": 
                            return "text/xml";
                        case "vsixmanifest": 
                            return "text/xml";
                        case "vsmdi": 
                            return "application/xml";
                        case "vspscc": 
                            return "text/plain";
                        case "vss": 
                            return "application/vnd.visio";
                        case "vsscc": 
                            return "text/plain";
                        case "vssettings": 
                            return "text/xml";
                        case "vssscc": 
                            return "text/plain";
                        case "vst": 
                            return "application/vnd.visio";
                        case "vstemplate": 
                            return "text/xml";
                        case "vsto": 
                            return "application/x-ms-vsto";
                        case "vsw": 
                            return "application/vnd.visio";
                        case "vsx": 
                            return "application/vnd.visio";
                        case "vtx": 
                            return "application/vnd.visio";
                        case "wav": 
                            return "audio/wav";
                        case "wave": 
                            return "audio/wav";
                        case "wax": 
                            return "audio/x-ms-wax";
                        case "wbk": 
                            return "application/msword";
                        case "wbmp": 
                            return "image/vnd.wap.wbmp";
                        case "wcm": 
                            return "application/vnd.ms-works";
                        case "wdb": 
                            return "application/vnd.ms-works";
                        case "wdp": 
                            return "image/vnd.ms-photo";
                        case "webarchive": 
                            return "application/x-safari-webarchive";
                        case "webtest": 
                            return "application/xml";
                        case "wiq": 
                            return "application/xml";
                        case "wiz": 
                            return "application/msword";
                        case "wks": 
                            return "application/vnd.ms-works";
                        case "wlmp": 
                            return "application/wlmoviemaker";
                        case "wlpginstall": 
                            return "application/x-wlpg-detect";
                        case "wlpginstall3": 
                            return "application/x-wlpg3-detect";
                        case "wm": 
                            return "video/x-ms-wm";
                        case "wma": 
                            return "audio/x-ms-wma";
                        case "wmd": 
                            return "application/x-ms-wmd";
                        case "wmf": 
                            return "application/x-msmetafile";
                        case "wml": 
                            return "text/vnd.wap.wml";
                        case "wmlc": 
                            return "application/vnd.wap.wmlc";
                        case "wmls": 
                            return "text/vnd.wap.wmlscript";
                        case "wmlsc": 
                            return "application/vnd.wap.wmlscriptc";
                        case "wmp": 
                            return "video/x-ms-wmp";
                        case "wmv": 
                            return "video/x-ms-wmv";
                        case "wmx": 
                            return "video/x-ms-wmx";
                        case "wmz": 
                            return "application/x-ms-wmz";
                        case "wpl": 
                            return "application/vnd.ms-wpl";
                        case "wps": 
                            return "application/vnd.ms-works";
                        case "wri": 
                            return "application/x-mswrite";
                        case "wrl": 
                            return "x-world/x-vrml";
                        case "wrz": 
                            return "x-world/x-vrml";
                        case "wsc": 
                            return "text/scriptlet";
                        case "wsdl": 
                            return "text/xml";
                        case "wvx": 
                            return "video/x-ms-wvx";
                        case "x": 
                            return "application/directx";
                        case "xaf": 
                            return "x-world/x-vrml";
                        case "xaml": 
                            return "application/xaml+xml";
                        case "xap": 
                            return "application/x-silverlight-app";
                        case "xbap": 
                            return "application/x-ms-xbap";
                        case "xbm": 
                            return "image/x-xbitmap";
                        case "xdr": 
                            return "text/plain";
                        case "xht": 
                            return "application/xhtml+xml";
                        case "xhtml": 
                            return "application/xhtml+xml";
                        case "xla": 
                            return "application/vnd.ms-excel";
                        case "xlam": 
                            return "application/vnd.ms-excel.addin.macroenabled.12";
                        case "xlc": 
                            return "application/vnd.ms-excel";
                        case "xld": 
                            return "application/vnd.ms-excel";
                        case "xlk": 
                            return "application/vnd.ms-excel";
                        case "xll": 
                            return "application/vnd.ms-excel";
                        case "xlm": 
                            return "application/vnd.ms-excel";
                        case "xls": 
                            return "application/vnd.ms-excel";
                        case "xlsb": 
                            return "application/vnd.ms-excel.sheet.binary.macroenabled.12";
                        case "xlsm": 
                            return "application/vnd.ms-excel.sheet.macroenabled.12";
                        case "xlsx": 
                            return "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";
                        case "xlt": 
                            return "application/vnd.ms-excel";
                        case "xltm": 
                            return "application/vnd.ms-excel.template.macroenabled.12";
                        case "xltx": 
                            return "application/vnd.openxmlformats-officedocument.spreadsheetml.template";
                        case "xlw": 
                            return "application/vnd.ms-excel";
                        case "xml": 
                            return "text/xml";
                        case "xmta": 
                            return "application/xml";
                        case "xof": 
                            return "x-world/x-vrml";
                        case "xoml": 
                            return "text/plain";
                        case "xpm": 
                            return "image/x-xpixmap";
                        case "xps": 
                            return "application/vnd.ms-xpsdocument";
                        case "xrm-ms": 
                            return "text/xml";
                        case "xsc": 
                            return "application/xml";
                        case "xsd": 
                            return "text/xml";
                        case "xsf": 
                            return "text/xml";
                        case "xsl": 
                            return "text/xml";
                        case "xslt": 
                            return "text/xml";
                        case "xsn": 
                            return "application/octet-stream";
                        case "xss": 
                            return "application/xml";
                        case "xtp": 
                            return "application/octet-stream";
                        case "xwd": 
                            return "image/x-xwindowdump";
                        case "z": 
                            return "application/x-compress";
                        case "zip": 
                            return "application/x-zip-compressed";
                        default: 
                            return "application/octet-stream";
                    }
                }
            }
        }
    });

    Bridge.define("Core.Extensions.ValidationRule", {
        statics: {
            fields: {
                Required: null,
                MinLength: null,
                CheckLength: null,
                MaxLength: null,
                GreaterThanOrEqual: null,
                LessThanOrEqual: null,
                GreaterThan: null,
                LessThan: null,
                Equal: null,
                NotEqual: null,
                RegEx: null,
                Unique: null
            },
            ctors: {
                init: function () {
                    this.Required = "required";
                    this.MinLength = "minLength";
                    this.CheckLength = "checkLength";
                    this.MaxLength = "maxLength";
                    this.GreaterThanOrEqual = "min";
                    this.LessThanOrEqual = "max";
                    this.GreaterThan = "gt";
                    this.LessThan = "lt";
                    this.Equal = "eq";
                    this.NotEqual = "ne";
                    this.RegEx = "regEx";
                    this.Unique = "unique";
                }
            }
        },
        props: {
            Rule: null,
            Message: null,
            Value1: null,
            Value2: null,
            Condition: null,
            RejectInvalid: false
        }
    });

    Bridge.define("Core.Models.AdvSearchVM", {
        props: {
            ActiveState: 0,
            Conditions: null,
            OrderBy: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this.Conditions = new (System.Collections.Generic.List$1(Core.Models.FieldCondition)).ctor();
                this.OrderBy = new (System.Collections.Generic.List$1(Core.Models.OrderBy)).ctor();
            }
        }
    });

    Bridge.define("Core.Models.CellSelected", {
        props: {
            FieldName: null,
            FieldText: null,
            ComponentType: null,
            Value: null,
            ValueText: null,
            Operator: null,
            OperatorText: null,
            Logic: null,
            IsSearch: false,
            Group: false,
            Shift: false
        }
    });

    Bridge.define("Core.Models.Component", {
        props: {
            Id: null,
            TenantCode: null,
            FieldName: null,
            Order: null,
            ComponentType: null,
            ComponentGroupId: null,
            DataSourceFilter: null,
            ReferenceId: null,
            FormatData: null,
            FormatEntity: null,
            PlainText: null,
            Column: null,
            Offset: null,
            Row: null,
            CanSearch: false,
            CanCache: false,
            Precision: null,
            GroupBy: null,
            GroupFormat: null,
            Label: null,
            ShowLabel: false,
            Icon: null,
            ClassName: null,
            Style: null,
            ChildStyle: null,
            HotKey: null,
            RefClass: null,
            Events: null,
            Disabled: false,
            Visibility: false,
            Hidden: false,
            Validation: null,
            Focus: false,
            Width: null,
            PopulateField: null,
            CascadeField: null,
            GroupEvent: null,
            XsCol: null,
            SmCol: null,
            LgCol: null,
            XlCol: null,
            XxlCol: null,
            DefaultVal: null,
            DateTimeField: null,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null,
            RoleId: null,
            IgnoreSync: false,
            CanAdd: false,
            ShowAudit: false,
            IsPrivate: false,
            IdField: null,
            DescFieldName: null,
            MonthCount: null,
            IsDoubleLine: null,
            Query: null,
            LocalQuery: null,
            IsRealtime: false,
            RefName: null,
            TopEmpty: false,
            IsCollapsible: false,
            Template: null,
            PreQuery: null,
            DisabledExp: null,
            FocusSearch: false,
            IsSumary: false,
            FormatSumaryField: null,
            OrderBySumary: null,
            ShowHotKey: false,
            DefaultAddStart: null,
            DefaultAddEnd: null,
            UpperCase: false,
            VirtualScroll: false,
            Migration: null,
            ListClass: null,
            ExcelFieldName: null,
            LiteGrid: false,
            ShowDatetimeField: false,
            ShowNull: false,
            AddDate: false,
            FilterEq: false,
            HeaderHeight: null,
            BodyItemHeight: null,
            FooterHeight: null,
            ScrollHeight: null,
            ScriptValidation: null,
            FilterLocal: false,
            HideGrid: false,
            GroupReferenceId: null,
            GroupReferenceName: null,
            JoinTable: null,
            GroupName: null,
            ShortDesc: null,
            Description: null,
            FeatureId: null,
            EntityId: null,
            EntityName: null,
            ComponentId: null,
            TextAlign: null,
            HasFilter: false,
            Frozen: false,
            FilterTemplate: null,
            Editable: false,
            FormatExcell: null,
            DatabaseName: null,
            Summary: null,
            SummaryColSpan: null,
            BasicSearch: false,
            IsExport: false,
            OrderExport: null,
            ShowExp: null,
            MinWidth: null,
            MaxWidth: null,
            AdvancedSearch: false,
            AutoFit: false,
            DisplayNone: false,
            Signed: null,
            FieldText: null,
            OrderBy: null,
            TextAlignEnum: null,
            IsPivot: false,
            PostOrder: 0,
            LocalData: null,
            LocalHeader: null,
            StatusBar: false,
            SimpleText: false,
            DataSourceOptimized: null,
            LocalRender: false,
            IgnoreConfirmHardDelete: false,
            ActId: null,
            QueueName: null,
            ConnKey: null,
            ShouldSaveText: false,
            CacheName: null,
            ComponentGroup: null,
            Reference: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            },
            ctor: function () {
                this.$initialize();
            }
        }
    });

    Bridge.define("Core.Models.ComponentGroup", {
        props: {
            Id: null,
            FeatureId: null,
            Name: null,
            Label: null,
            Description: null,
            ClassName: null,
            IsTab: false,
            TabGroup: null,
            IsVertialTab: false,
            Responsive: false,
            Events: null,
            Width: null,
            Style: null,
            Column: null,
            Row: null,
            PolicyId: null,
            Hidden: false,
            ParentId: null,
            Order: null,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null,
            Disabled: false,
            XsCol: null,
            SmCol: null,
            LgCol: null,
            XlCol: null,
            XxlCol: null,
            OuterColumn: null,
            XsOuterColumn: null,
            SmOuterColumn: null,
            LgOuterColumn: null,
            XlOuterColumn: null,
            XxlOuterColumn: null,
            RoleId: null,
            Icon: null,
            IgnoreSync: false,
            IsPrivate: false,
            BadgeMonth: null,
            IsCollapsible: null,
            ShowExp: null,
            DisabledExp: null,
            IsDropDown: false,
            ItemInRow: 0,
            Feature: null,
            Parent: null,
            Component: null,
            InverseParent: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            },
            ctor: function () {
                this.$initialize();
                this.Component = new (System.Collections.Generic.HashSet$1(Core.Models.Component)).ctor();
                this.InverseParent = new (System.Collections.Generic.HashSet$1(Core.Models.ComponentGroup)).ctor();
            }
        }
    });

    Bridge.define("Core.Models.Dictionary", {
        props: {
            Id: null,
            LangCode: null,
            Key: null,
            Value: null,
            Active: false,
            InsertedBy: null,
            InsertedDate: null,
            UpdatedBy: null,
            UpdatedDate: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            }
        }
    });

    Bridge.define("Core.Models.Entity", {
        props: {
            Id: null,
            Name: null,
            Description: null,
            AliasFor: null,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null,
            RefDetailClass: null,
            RefListClass: null,
            Namespace: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            }
        }
    });

    Bridge.define("Core.Models.EntityRef", {
        props: {
            Id: null,
            ComId: null,
            HeaderId: null,
            SectionId: null,
            TargetComId: null,
            TargetFieldName: null,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null,
            MenuText: null,
            ViewClass: null,
            FieldName: null,
            FeatureId: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            }
        }
    });

    Bridge.define("Core.Models.Feature", {
        props: {
            Id: null,
            Name: null,
            Label: null,
            ParentId: null,
            Order: null,
            ClassName: null,
            Style: null,
            StyleSheet: null,
            Script: null,
            Events: null,
            Icon: null,
            IsDevider: false,
            IsGroup: false,
            IsMenu: false,
            IsPublic: false,
            StartUp: false,
            ViewClass: null,
            EntityId: null,
            EntityName: null,
            Description: null,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null,
            IsSystem: false,
            IgnoreEncode: false,
            RequireJS: null,
            GuiInfo: null,
            RoleId: null,
            IsPermissionInherited: false,
            FeatureGroup: null,
            InheritParentFeature: false,
            Properties: null,
            Template: null,
            LayoutId: null,
            DataSourceFilter: null,
            Gallery: null,
            DeleteTemp: false,
            CustomNextCell: false,
            Signed: false,
            IsPortal: false,
            QueueName: null,
            CacheName: null,
            Entity: null,
            Parent: null,
            ConnKey: null,
            Component: null,
            ComponentGroup: null,
            FeaturePolicy: null,
            InverseParent: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            },
            ctor: function () {
                this.$initialize();
                this.ComponentGroup = new (System.Collections.Generic.HashSet$1(Core.Models.ComponentGroup)).ctor();
                this.FeaturePolicy = new (System.Collections.Generic.HashSet$1(Core.Models.FeaturePolicy)).ctor();
                this.InverseParent = new (System.Collections.Generic.HashSet$1(Core.Models.Feature)).ctor();
            }
        }
    });

    Bridge.define("Core.Models.FeaturePolicy", {
        props: {
            Id: null,
            FeatureId: null,
            RoleId: null,
            CanRead: false,
            CanWrite: false,
            CanDelete: false,
            CanDeleteAll: false,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null,
            CanDeactivate: false,
            LockDeleteAfterCreated: null,
            LockUpdateAfterCreated: null,
            EntityId: null,
            RecordId: null,
            UserId: null,
            CanShare: false,
            Desc: null,
            CanWriteAll: false
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            }
        }
    });

    Bridge.define("Core.Models.FieldCondition", {
        props: {
            Id: null,
            OriginFieldName: null,
            FieldId: null,
            Field: null,
            CompareOperatorId: null,
            Value: null,
            LogicOperatorId: null,
            LogicOperator: null,
            Level: null,
            Group: false
        }
    });

    Bridge.define("Core.Models.History", {
        props: {
            Id: null,
            TanentCode: null,
            EntityId: null,
            RecordId: null,
            ReasonOfChange: null,
            JsonHistory: null,
            TextHistory: null,
            ValueText: null,
            OldValueText: null,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
                this.InsertedDate = System.DateTimeOffset.Now.$clone();
            }
        }
    });

    Bridge.define("Core.Models.Images", {
        props: {
            Id: null,
            Name: null,
            Size: null,
            Url: null,
            IsAvatar: false,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            }
        }
    });

    Bridge.define("Core.Models.MQEvent", {
        props: {
            DeviceKey: null,
            QueueName: null,
            Action: null,
            Id: null,
            PrevId: null,
            Time: null,
            Message: null
        },
        ctors: {
            init: function () {
                this.Time = new System.DateTimeOffset();
            }
        }
    });

    Bridge.define("Core.Models.Odata", {
        props: {
            Count: null
        }
    });

    Bridge.define("Core.Models.OdataResult$1", function (T) { return {
        props: {
            Odata: null,
            Value: null,
            Query: null,
            Sql: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this.Odata = new Core.Models.Odata();
                this.Value = new (System.Collections.Generic.List$1(T)).ctor();
            }
        }
    }; });

    Bridge.define("Core.Models.OrderBy", {
        props: {
            Id: null,
            ComId: null,
            FieldName: null,
            OrderbyDirectionId: null
        }
    });

    Bridge.define("Core.Models.TaskNotification", {
        props: {
            Id: null,
            Title: null,
            Description: null,
            EntityId: null,
            RecordId: null,
            Deadline: null,
            StatusId: null,
            Attachment: null,
            AssignedId: null,
            RoleId: null,
            TimeConsumed: System.Decimal(0.0),
            TimeRemained: System.Decimal(0.0),
            Progress: System.Decimal(0.0),
            RemindBefore: null,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null,
            Badge: null,
            Entity: null
        },
        ctors: {
            init: function () {
                this.Deadline = new System.DateTimeOffset();
                this.InsertedDate = new System.DateTimeOffset();
            }
        }
    });

    Bridge.define("Core.Models.User", {
        props: {
            Id: null,
            VendorId: null,
            FirstName: null,
            LastName: null,
            MiddleName: null,
            FullName: null,
            IsInternal: false,
            DoB: null,
            Ssn: null,
            Passport: null,
            Address: null,
            Address2: null,
            PhoneNumber: null,
            PhoneNumber2: null,
            NationalityId: null,
            ContractId: null,
            BankId: null,
            BankBranchId: null,
            BankAccountNo: null,
            BankAccountName: null,
            DepartmentId: null,
            Avatar: null,
            SupervisorId: null,
            Password: null,
            UserName: null,
            Salt: null,
            LoginFailedCount: null,
            LastLogin: null,
            LastFailedLogin: null,
            Email: null,
            GenderId: null,
            Recover: null,
            Reported: false,
            HasVerifiedEmail: false,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null,
            CreatedRoleId: null,
            CostCenterId: null,
            TeamId: null,
            ContactId: null,
            StateId: null,
            OwnerUserIds: null,
            OwnerRoleIds: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            }
        }
    });

    Bridge.define("Core.Models.UserSetting", {
        props: {
            Id: null,
            TenantCode: null,
            RoleId: null,
            UserId: null,
            Name: null,
            Value: null,
            ParentId: null,
            Path: null,
            Description: null,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            }
        }
    });

    Bridge.define("Core.Models.Vendor", {
        props: {
            Id: null,
            VendorTypeId: null,
            Description: null,
            Avatar: null,
            CustomerGroupId: null,
            SaleId: null,
            UserId: null,
            CustomerStateId: null,
            LastContactDate: null,
            IsSelf: false,
            IsInternal: false,
            PhoneNumber: null,
            PhoneNumber2: null,
            Address: null,
            Address2: null,
            Note: null,
            Email: null,
            Fax: null,
            Skype: null,
            Zalo: null,
            Viber: null,
            OtherContact: null,
            TaxCode: null,
            CompanyLocalShortName: null,
            CompanyInterShortName: null,
            CompanyLocalFullName: null,
            CompanyInterFullName: null,
            CompanyLocalAddress: null,
            CompanyInterAddress: null,
            Active: false,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null,
            RoleId: null,
            IsTenant: false,
            ParentId: null,
            TenantId: null,
            ConStr: null,
            NationalityId: null,
            SeqKey: null,
            DebtCountFinished: false,
            DebtDate: null,
            DebtDateTypeId: null,
            DebtExportDate: null,
            OwnerId: null,
            CollectOnBehalfDay: null,
            GlobalId: null,
            PartnerId: null,
            StateId: null,
            LastOrderState: null,
            IsSeft: false,
            Parent: null,
            Tenant: null,
            InverseParent: null,
            InverseTenant: null,
            User: null,
            VendorBranch: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            },
            ctor: function () {
                this.$initialize();
                this.InverseParent = new (System.Collections.Generic.HashSet$1(Core.Models.Vendor)).ctor();
                this.InverseTenant = new (System.Collections.Generic.HashSet$1(Core.Models.Vendor)).ctor();
                this.User = new (System.Collections.Generic.HashSet$1(Core.Models.User)).ctor();
                this.VendorBranch = new (System.Collections.Generic.HashSet$1(Core.Models.VendorBranch)).ctor();
            }
        }
    });

    Bridge.define("Core.Models.VendorBranch", {
        props: {
            Id: null,
            CustomerId: null,
            VendorId: null,
            RegionId: null,
            Address: null,
            PhoneNumber: null,
            InsertedDate: null,
            InsertedBy: null,
            UpdatedDate: null,
            UpdatedBy: null,
            Active: false,
            Name: null,
            Description: null,
            TaxCode: null,
            ParentId: null,
            Path: null,
            Level: null,
            Parent: null,
            Vendor: null,
            InverseParent: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            },
            ctor: function () {
                this.$initialize();
                this.InverseParent = new (System.Collections.Generic.HashSet$1(Core.Models.VendorBranch)).ctor();
            }
        }
    });

    Bridge.define("Core.Models.WebSocketResponse$1", function (T) { return {
        props: {
            QueueName: null,
            Data: Bridge.getDefaultValue(T),
            DataList: null
        }
    }; });

    Bridge.define("Core.Models.Where", {
        props: {
            Condition: null,
            Group: false
        }
    });

    Bridge.define("Core.MVVM.ElementType", {
        $kind: "enum",
        statics: {
            fields: {
                a: 0,
                abbr: 1,
                address: 2,
                area: 3,
                article: 4,
                aside: 5,
                audio: 6,
                b: 7,
                base: 8,
                bdi: 9,
                bdo: 10,
                blockquote: 11,
                button: 12,
                canvas: 13,
                caption: 14,
                cite: 15,
                code: 16,
                col: 17,
                colgroup: 18,
                datalist: 19,
                dd: 20,
                del: 21,
                details: 22,
                dfn: 23,
                div: 24,
                dl: 25,
                dt: 26,
                em: 27,
                embed: 28,
                fieldset: 29,
                figcaption: 30,
                figure: 31,
                footer: 32,
                form: 33,
                h1: 34,
                h2: 35,
                h3: 36,
                h4: 37,
                h5: 38,
                h6: 39,
                head: 40,
                header: 41,
                i: 42,
                iframe: 43,
                img: 44,
                input: 45,
                ins: 46,
                kbd: 47,
                keygen: 48,
                label: 49,
                legend: 50,
                li: 51,
                link: 52,
                main: 53,
                map: 54,
                mark: 55,
                menu: 56,
                menuitem: 57,
                meta: 58,
                meter: 59,
                nav: 60,
                object: 61,
                ol: 62,
                ptgroup: 63,
                option: 64,
                output: 65,
                p: 66,
                param: 67,
                pre: 68,
                progress: 69,
                q: 70,
                rp: 71,
                rt: 72,
                ruby: 73,
                s: 74,
                samp: 75,
                script: 76,
                section: 77,
                select: 78,
                small: 79,
                source: 80,
                span: 81,
                strong: 82,
                style: 83,
                sub: 84,
                summary: 85,
                sup: 86,
                table: 87,
                tbody: 88,
                td: 89,
                textarea: 90,
                tfoot: 91,
                th: 92,
                thead: 93,
                time: 94,
                title: 95,
                tr: 96,
                track: 97,
                u: 98,
                ul: 99,
                var: 100,
                video: 101
            }
        }
    });

    Bridge.define("Core.MVVM.Html", {
        statics: {
            fields: {
                _instance: null
            },
            props: {
                Context: null,
                Instance: {
                    get: function () {
                        if (Core.MVVM.Html._instance == null) {
                            Core.MVVM.Html._instance = new Core.MVVM.Html.ctor();
                        }

                        return Core.MVVM.Html._instance;
                    }
                }
            },
            methods: {
                Take$1: function (selector) {
                    Core.MVVM.Html.Context = Bridge.as(document.querySelector(selector), HTMLElement);
                    return Core.MVVM.Html.Instance;
                },
                Take: function (ele) {
                    Core.MVVM.Html.Context = ele;
                    return Core.MVVM.Html.Instance;
                },
                SetObservableValue: function (T, val, value) {
                    val.Data = System.String.isNullOrEmpty(value) ? Bridge.getDefaultValue(T) : Bridge.cast(Bridge.unbox(System.Convert.changeType(value, T), T), T);
                },
                SwapElement: function (T, observableArray, newIndex, oldIndex) {
                    var tmpData = observableArray.getItem(newIndex);
                    observableArray.setItem(newIndex, observableArray.getItem(oldIndex));
                    observableArray.setItem(oldIndex, tmpData);
                }
            }
        },
        props: {
            Div: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.div);
                }
            },
            Link: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.link);
                }
            },
            Script: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.script);
                }
            },
            Header: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.header);
                }
            },
            Section: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.section);
                }
            },
            Canvas: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.canvas);
                }
            },
            Video: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.video);
                }
            },
            Audio: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.audio);
                }
            },
            H1: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.h1);
                }
            },
            H2: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.h2);
                }
            },
            H3: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.h3);
                }
            },
            H4: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.h4);
                }
            },
            H5: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.h5);
                }
            },
            H6: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.h6);
                }
            },
            Nav: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.nav);
                }
            },
            Input: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.input);
                }
            },
            Select: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.select);
                }
            },
            Option: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.option);
                }
            },
            Span: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.span);
                }
            },
            Small: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.small);
                }
            },
            I: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.i);
                }
            },
            Img: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.img);
                }
            },
            Button: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.button);
                }
            },
            Table: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.table);
                }
            },
            Thead: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.thead);
                }
            },
            Th: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.th);
                }
            },
            TBody: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.tbody);
                }
            },
            TFooter: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.tfoot);
                }
            },
            TRow: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.tr);
                }
            },
            TData: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.td);
                }
            },
            P: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.p);
                }
            },
            TextArea: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.textarea);
                }
            },
            Br: {
                get: function () {
                    var br = document.createElement("br");
                    Core.MVVM.Html.Context.appendChild(br);
                    return this;
                }
            },
            Hr: {
                get: function () {
                    var hr = document.createElement("hr");
                    Core.MVVM.Html.Context.appendChild(hr);
                    return this;
                }
            },
            Ul: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.ul);
                }
            },
            Li: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.li);
                }
            },
            Aside: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.aside);
                }
            },
            A: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.a);
                }
            },
            Form: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.form);
                }
            },
            Label: {
                get: function () {
                    return this.Add(Core.MVVM.ElementType.label);
                }
            },
            End: {
                get: function () {
                    Core.MVVM.Html.Context = Core.MVVM.Html.Context.parentElement;
                    return this;
                }
            }
        },
        ctors: {
            $ctor2: function (selector) {
                this.$initialize();
                Core.MVVM.Html.Context = Bridge.as(document.querySelector(selector), HTMLElement);
            },
            ctor: function () {
                this.$initialize();

            },
            $ctor1: function (ele) {
                this.$initialize();
                Core.MVVM.Html.Context = ele;
            }
        },
        methods: {
            GetContext: function () {
                return Core.MVVM.Html.Context;
            },
            EndOf: function (type) {
                return this.EndOf$1(System.Enum.toString(Core.MVVM.ElementType, type));
            },
            EndOf$1: function (selector) {
                var result = Core.MVVM.Html.Context;
                while (result != null) {
                    if (result.querySelector(selector) != null) {
                        break;
                    } else {
                        result = result.parentElement;
                    }
                }

                Core.MVVM.Html.Context = result || (function () {
                    throw new System.InvalidOperationException.$ctor1("Cannot find the element of selector " + (selector || ""));
                })();
                return this;
            },
            Closest: function (type) {
                var func = Core.MVVM.Html.Context.closest;
                Core.MVVM.Html.Context = Bridge.cast(func.call(Core.MVVM.Html.Context, System.Enum.toString(Core.MVVM.ElementType, type)), HTMLElement);
                return this;
            },
            Render$1: function (html) {
                Core.MVVM.Html.Context.innerHTML = html;
            },
            Render: function () {
                // Method intentionally left empty.
            },
            Add: function (type) {
                var ele = document.createElement(System.Enum.toString(Core.MVVM.ElementType, type));
                Core.MVVM.Html.Context.appendChild(ele);
                Core.MVVM.Html.Context = ele;
                return this;
            },
            Id: function (id) {
                Core.MVVM.Html.Context.id = id;
                return this;
            },
            Style$1: function (style) {
                var $t;
                if (System.String.isNullOrWhiteSpace(style)) {
                    return this;
                }
                ($t = Core.MVVM.Html.Context.style).cssText = ($t.cssText || "") + (style || "");
                return this;
            },
            Style: function (style) {
                var $t;
                $t = Bridge.getEnumerator(Object.getOwnPropertyNames(Bridge.unbox(style)));
                try {
                    while ($t.moveNext()) {
                        var key = $t.Current;
                        Core.MVVM.Html.Context.style[key] = style[key];
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return this;
            },
            Clear: function () {
                if (Core.MVVM.Html.Context != null) {
                    Core.MVVM.Html.Context.textContent = "";
                    Core.MVVM.Html.Context.innerHTML = "";
                }
                return this;
            },
            If: function (condition, doif, doelse) {
                if (doelse === void 0) { doelse = null; }
                if (condition) {
                    doif();
                } else {
                    doelse();
                }

                return this;
            },
            Checkbox: function (value) {
                var $t;
                this.Add(Core.MVVM.ElementType.input);
                var checkbox = Bridge.as(Core.MVVM.Html.Context, HTMLInputElement);
                checkbox.setAttribute("type", "checkbox");
                checkbox.checked = ($t = value, $t != null ? $t : false);
                this.Event$1("change", function (e) {
                    value = (Bridge.as(e.target, HTMLInputElement)).checked;
                });
                this.Event$1("click", function (e) {
                    value = (Bridge.as(e.target, HTMLInputElement)).checked;
                });
                return this;
            },
            Value: function (val) {
                var input = Core.MVVM.Html.Context;
                input.value = val;
                return this;
            },
            Value$1: function (T, val) {
                var $t;
                var input = Core.MVVM.Html.Context;
                if (input != null) {
                    input.value = ($t = val.Data) != null ? Bridge.toString($t) : null;
                    this.Event$1("input", function (e) {
                        var $t1;
                        Core.MVVM.Html.SetObservableValue(T, val, ($t1 = input.value) != null ? Bridge.toString($t1) : null);
                    });
                    val.addChanged(function (arg) {
                        input.value = arg.NewData != null ? Bridge.toString(arg.NewData) : "";
                    });
                }
                return this;
            },
            Attr$1: function (attr, val) {
                Core.MVVM.Html.Context.setAttribute(attr, val);
                return this;
            },
            Attr: function (attr, val) {
                Core.MVVM.Html.Context.setAttribute(attr, Bridge.toString(val));
                return this;
            },
            DataAttr$1: function (attr, val) {
                Core.MVVM.Html.Context.setAttribute("data-" + (attr || ""), val);
                return this;
            },
            DataAttr: function (attr, obj) {
                Core.MVVM.Html.Context.setAttribute("data-" + (attr || ""), Bridge.toString(obj));
                return this;
            },
            Type$1: function (val) {
                Core.MVVM.Html.Context.setAttribute("type", val);
                return this;
            },
            Type: function (type) {
                Core.MVVM.Html.Context.setAttribute("type", System.Enum.toString(System.String, type));
                return this;
            },
            Href: function (val) {
                Core.MVVM.Html.Context.setAttribute("href", val);
                return this;
            },
            Src: function (val) {
                Core.MVVM.Html.Context.setAttribute("src", val);
                return this;
            },
            /**
             * Append text node, auto enclosing
             *
             * @instance
             * @public
             * @this Core.MVVM.Html
             * @memberof Core.MVVM.Html
             * @param   {string}            val
             * @return  {Core.MVVM.Html}
             */
            Text: function (val) {
                if (System.String.isNullOrEmpty(val)) {
                    return this;
                }
                var text = document.createTextNode(val);
                Core.MVVM.Html.Context.appendChild(text);
                return this;
            },
            Text$1: function (T, val) {
                var text = document.createTextNode(Bridge.toString(val.Data));
                val.addChanged(function (arg) {
                    var $t;
                    text.textContent = ($t = arg.NewData) != null ? Bridge.toString($t) : null;
                });
                Core.MVVM.Html.Context.appendChild(text);
                return this;
            },
            InnerHTML: function (val) {
                Core.MVVM.Html.Context.innerHTML = val;
                return this;
            },
            Number: function (val) {
                var text = document.createTextNode(System.String.format("{0:n0}", [Bridge.box(val.Data, System.Int32)]));
                val.addChanged(function (arg) {
                    text.textContent = System.String.format("{0:n0}", [Bridge.box(arg.NewData, System.Int32)]);
                });
                Core.MVVM.Html.Context.appendChild(text);
                return this;
            },
            Event: function (type, action) {
                Core.MVVM.Html.Context.addEventListener(type, action);
                return this;
            },
            Event$1: function (type, action) {
                Core.MVVM.Html.Context.addEventListener(type, action);
                return this;
            },
            Event$4: function (T, type, action, model) {
                Core.MVVM.Html.Context.addEventListener(type, function (e) {
                    action(e, model);
                });
                return this;
            },
            Event$2: function (T, type, action, model) {
                Core.MVVM.Html.Context.addEventListener(type, function (e) {
                    action(model);
                });
                return this;
            },
            Event$3: function (T, type, action, model) {
                Core.MVVM.Html.Context.addEventListener(type, function (e) {
                    action(model, e);
                });
                return this;
            },
            AsyncEvent: function (type, action) {
                Core.MVVM.Html.Context.addEventListener(type, function (e) {
                    Core.Clients.Client.ExecTaskNoResult(action(e));
                });
                return this;
            },
            Trigger: function (type) {
                var e = new Event(System.Enum.toString(System.String, type), new Object());
                Core.MVVM.Html.Context.dispatchEvent(e);
                return this;
            },
            ClearContextContent: function () {
                Core.MVVM.Html.Context.innerHTML = "";
            },
            ForEach$2: function (T, list, renderer) {
                if (list == null) {
                    throw new System.ArgumentNullException.$ctor1("list");
                }

                var element = Core.MVVM.Html.Context;

                var length = System.Linq.Enumerable.from(list, T).count();
                var index = -1;
                var enumerator = Bridge.getEnumerator(list, T);

                while (((index = (index + 1) | 0)) < length) {
                    Core.MVVM.Html.Context = element;
                    enumerator.System$Collections$IEnumerator$moveNext();
                    renderer.call(element, enumerator[Bridge.geti(enumerator, "System$Collections$Generic$IEnumerator$1$" + Bridge.getTypeAlias(T) + "$Current$1", "System$Collections$Generic$IEnumerator$1$Current$1")], Bridge.box(index, System.Int32));
                }
                Core.MVVM.Html.Context = element;
                return this;
            },
            ForEach$1: function (T, list, renderer) {
                if (list == null) {
                    throw new System.ArgumentNullException.$ctor1("list");
                }

                var element = Core.MVVM.Html.Context;

                var length = System.Linq.Enumerable.from(list, T).count();
                var index = -1;
                var enumerator = Bridge.getEnumerator(list, T);

                while (((index = (index + 1) | 0)) < length) {
                    Core.MVVM.Html.Context = element;
                    enumerator.System$Collections$IEnumerator$moveNext();
                    renderer.call(element, enumerator[Bridge.geti(enumerator, "System$Collections$Generic$IEnumerator$1$" + Bridge.getTypeAlias(T) + "$Current$1", "System$Collections$Generic$IEnumerator$1$Current$1")], Bridge.box(index, System.Int32));
                }
                Core.MVVM.Html.Context = element;
                return this;
            },
            ForEach: function (T, observableArray, renderer) {
                if (observableArray == null) {
                    throw new System.ArgumentNullException.$ctor1("observableArray");
                }

                var element = Core.MVVM.Html.Context;

                var list = observableArray.Data;
                var length = list.Count;
                var index = -1;

                while (((index = (index + 1) | 0)) < length) {
                    Core.MVVM.Html.Context = element;
                    renderer(list.getItem(index), index);
                }
                observableArray.ListChanged = Bridge.fn.combine(observableArray.ListChanged, Bridge.fn.bind(this, function (e) {
                    var $t;
                    e.Element = element;
                    e.Renderer = renderer;
                    e.Action = ($t = e.Action, $t != null ? $t : Core.MVVM.ObservableAction.Render);
                    this.Update(T, e, observableArray);
                }));
                return this;
            },
            Update: function (T, arg, observableArray) {
                Core.MVVM.Html.Context = arg.Element;
                var numOfElement;
                switch (arg.Action) {
                    case Core.MVVM.ObservableAction.Add: 
                        observableArray.Data.insert(arg.Index, arg.Item);
                        if (arg.Index === ((arg.ListData.Count - 1) | 0)) {
                            arg.Renderer.call(arg.Element, arg.Item, Bridge.box(arg.Index, System.Int32));
                            return;
                        }
                        var div = document.createElement("div");
                        Core.MVVM.Html.Context = div;
                        arg.Renderer.call(div, arg.Item, Bridge.box(arg.Index, System.Int32));
                        this.AppendChildList(arg.Element, div, arg.Index);
                        break;
                    case Core.MVVM.ObservableAction.Remove: 
                        observableArray.Data.remove(arg.Item);
                        numOfElement = (Bridge.Int.div(arg.Element.children.length, (((arg.ListData.Count + 1) | 0)))) | 0;
                        this.RemoveChildList(arg.Element, arg.Index, numOfElement);
                        break;
                    case Core.MVVM.ObservableAction.Move: 
                        numOfElement = (Bridge.Int.div(arg.Element.children.length, arg.ListData.Count)) | 0;
                        var newIndex = arg.Index;
                        var oldIndex = arg.ListData.indexOf(arg.Item);
                        if (newIndex === oldIndex) {
                            return;
                        }
                        Core.MVVM.Html.SwapElement(T, observableArray.Data, newIndex, oldIndex);
                        var firstOldElementIndex = Bridge.Int.mul(oldIndex, numOfElement);
                        var nodeToInsert = oldIndex < newIndex ? arg.Element.children[Bridge.Int.mul((((newIndex + 1) | 0)), numOfElement)] : arg.Element.children[Bridge.Int.mul(newIndex, numOfElement)];
                        for (var j = 0; j < numOfElement; j = (j + 1) | 0) {
                            arg.Element.insertBefore(arg.Element.children[firstOldElementIndex], nodeToInsert);
                            if (oldIndex > newIndex) {
                                firstOldElementIndex = (firstOldElementIndex + 1) | 0;
                            }
                        }
                        break;
                    case Core.MVVM.ObservableAction.Render: 
                        this.ClearContextContent();
                        var length = arg.ListData.Count;
                        var i = -1;
                        while (((i = (i + 1) | 0)) < length) {
                            Core.MVVM.Html.Context = arg.Element;
                            arg.Renderer.call(arg.Element, arg.ListData.getItem(i), Bridge.box(i, System.Int32));
                        }
                        break;
                }
            },
            AppendChildList: function (parent, tmpNode, index) {
                index = Bridge.Int.mul(index, tmpNode.children.length);
                var previousNode = parent.children[index];
                while (tmpNode.children.length > 0) {
                    parent.insertBefore(tmpNode.children[0], previousNode);
                }
            },
            RemoveChildList: function (parent, index, numOfElement) {
                var startIndex = Bridge.Int.mul(index, numOfElement);
                for (var i = 0; i < numOfElement && parent.children.length > 0; i = (i + 1) | 0) {
                    parent.removeChild(parent.children[startIndex]);
                }
            },
            Dropdown$1: function (T, list, selectedItem, displayField, valueField) {
                if (displayField === void 0) { displayField = null; }
                if (valueField === void 0) { valueField = null; }
                if (!Bridge.referenceEquals(Core.MVVM.Html.Context.nodeName.toLowerCase(), "select")) {
                    this.Select.Render();
                }
                var select = Bridge.as(Core.MVVM.Html.Context, HTMLSelectElement);
                list.ForEach(Bridge.fn.bind(this, function (model) {
                    var $t, $t1;
                    var text = displayField == null ? Bridge.toString(model) : ($t = model[displayField]) != null ? Bridge.toString($t) : null;
                    var value = valueField == null ? Bridge.toString(model) : ($t1 = model[valueField]) != null ? Bridge.toString($t1) : null;
                    this.Option.Text(text).Value(value).End.Render();
                }));
                select.selectedIndex = this.GetSelectedIndex(T, list, selectedItem, valueField);
                return this;
            },
            Dropdown: function (T, list, selectedItem, displayField, valueField) {
                var $t;
                if (!Bridge.referenceEquals(Core.MVVM.Html.Context.nodeName.toLowerCase(), "select")) {
                    this.Select.Render();
                }
                var select = Bridge.as(Core.MVVM.Html.Context, HTMLSelectElement);
                this.ForEach(T, list, Bridge.fn.bind(this, function (model, index) {
                    var $t, $t1;
                    var text = ($t = model[displayField]) != null ? Bridge.toString($t) : null;
                    var value = ($t1 = model[valueField]) != null ? Bridge.toString($t1) : null;
                    this.Option.Text(text).Value(value).End.Render();
                }));
                select.selectedIndex = this.GetSelectedIndex(T, ($t = T, System.Linq.Enumerable.from(list.Data, $t).toList($t)), selectedItem.Data, valueField);
                list.ListChanged = Bridge.fn.combine(list.ListChanged, Bridge.fn.bind(this, function (realList) {
                    var $t1;
                    select.selectedIndex = this.GetSelectedIndex(T, ($t1 = T, System.Linq.Enumerable.from(realList.ListData, $t1).toList($t1)), selectedItem.Data, valueField);
                }));
                this.Event("change", function () {
                    var selectedObj = list.Data.getItem(select.selectedIndex);
                    selectedItem.Data = selectedObj;
                });
                selectedItem.addChanged(Bridge.fn.bind(this, function (val) {
                    var $t1;
                    select.selectedIndex = this.GetSelectedIndex(T, ($t1 = T, System.Linq.Enumerable.from(list.Data, $t1).toList($t1)), val.NewData, valueField);
                }));

                return this;
            },
            GetSelectedIndex: function (T, list, item, valueField) {
                if (item == null) {
                    return -1;
                }

                var arr = list.ToArray();
                var index = System.Array.indexOfT(arr, item);
                if (!Bridge.referenceEquals(valueField, "")) {
                    var selectedItem = System.Array.find(T, arr, function (x) {
                            return Bridge.referenceEquals(x[valueField], item[valueField]);
                        });
                    index = System.Array.indexOfT(arr, selectedItem);
                }
                return index;
            },
            Visibility$1: function (visible) {
                var ele = Core.MVVM.Html.Context;
                ele.style.visibility = visible ? "" : System.Enum.toString(System.String, "hidden");
                return this;
            },
            Visibility: function (visible) {
                var ele = Core.MVVM.Html.Context;
                ele.style.visibility = visible.Data ? "" : System.Enum.toString(System.String, "hidden");
                visible.addChanged(function (arg) {
                    ele.style.visibility = arg.NewData ? "" : System.Enum.toString(System.String, "hidden");
                });
                return this;
            },
            Display$1: function (shouldShow) {
                var ele = Core.MVVM.Html.Context;
                ele.style.display = shouldShow ? "" : System.Enum.toString(System.String, "none");
                return this;
            },
            Display: function (shouldShow) {
                var ele = Core.MVVM.Html.Context;
                ele.style.display = shouldShow.Data ? "" : System.Enum.toString(System.String, "none");
                shouldShow.addChanged(function (arg) {
                    ele.style.display = arg.NewData ? "" : System.Enum.toString(System.String, "none");
                });
                return this;
            }
        }
    });

    Bridge.define("Core.MVVM.Observable$1", function (T) { return {
        fields: {
            Getter: null,
            Setter: null,
            _data: Bridge.getDefaultValue(T)
        },
        events: {
            Changed: null
        },
        props: {
            Data: {
                get: function () {
                    return !Bridge.staticEquals(this.Getter, null) ? this.Getter() : this._data;
                },
                set: function (value) {
                    var $t;
                    if (Bridge.equals(this._data, value)) {
                        return;
                    }

                    var oldValue = this._data;
                    this._data = value;
                    !Bridge.staticEquals(this.Changed, null) ? this.Changed(($t = new (Core.MVVM.ObservableArgs$1(T))(), $t.NewData = this._data, $t.OldData = oldValue, $t)) : null;
                    if (!Bridge.staticEquals(this.Setter, null)) {
                        this.Setter(this._data);
                    }
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this._data = Bridge.getDefaultValue(T);
            },
            $ctor1: function (data) {
                this.$initialize();
                this._data = data;
            }
        }
    }; });

    Bridge.define("Core.MVVM.ObservableAction", {
        $kind: "enum",
        statics: {
            fields: {
                Render: 0,
                Add: 1,
                AddRange: 2,
                Update: 3,
                Remove: 4,
                Move: 5
            }
        }
    });

    Bridge.define("Core.MVVM.ObservableArgs", {
        props: {
            EvType: "abort",
            NewData: null,
            OldData: null,
            NewMatch: null,
            OldMatch: null,
            NewEntity: null,
            OldEntity: null,
            FieldName: null
        }
    });

    Bridge.define("Core.MVVM.ObservableArgs$1", function (T) { return {
        props: {
            NewData: Bridge.getDefaultValue(T),
            OldData: Bridge.getDefaultValue(T)
        }
    }; });

    Bridge.define("Core.MVVM.ObservableList$1", function (T) { return {
        fields: {
            /**
             * Use this to get and set List object without notifying change
             *
             * @instance
             * @public
             * @memberof Core.MVVM.ObservableList$1
             * @type System.Collections.Generic.List$1
             */
            _data: null,
            ListChanged: null
        },
        props: {
            /**
             * Use this to set List object and notify change
             *
             * @instance
             * @public
             * @memberof Core.MVVM.ObservableList$1
             * @function Data
             * @type System.Collections.Generic.List$1
             */
            Data: {
                get: function () {
                    return this._data;
                },
                set: function (value) {
                    var $t;
                    this._data = value;
                    !Bridge.staticEquals(this.ListChanged, null) ? this.ListChanged(($t = new (Core.MVVM.ObservableListArgs$1(T))(), $t.ListData = this._data, $t.Action = Core.MVVM.ObservableAction.Render, $t)) : null;
                }
            }
        },
        ctors: {
            /**
             * Init Observable list instance <br />
             Note that the data can be ICollection, don't use incompatible methods
             *
             * @instance
             * @public
             * @this Core.MVVM.ObservableList$1
             * @memberof Core.MVVM.ObservableList$1
             * @return  {void}
             */
            ctor: function () {
                this.$initialize();
                this._data = new (System.Collections.Generic.List$1(T)).ctor();
            },
            $ctor1: function (data) {
                this.$initialize();
                this._data = data;
            }
        },
        methods: {
            NotifyArrayChanged: function (arg) {
                !Bridge.staticEquals(this.ListChanged, null) ? this.ListChanged(arg) : null;
            },
            Add: function (item, index) {
                var $t, $t1;
                if (index === void 0) { index = null; }
                !Bridge.staticEquals(this.ListChanged, null) ? this.ListChanged(($t = new (Core.MVVM.ObservableListArgs$1(T))(), $t.ListData = this._data, $t.Item = item, $t.Index = ($t1 = index, $t1 != null ? $t1 : this._data.Count), $t.Action = Core.MVVM.ObservableAction.Add, $t)) : null;
            },
            Remove: function (item) {
                var $t;
                !Bridge.staticEquals(this.ListChanged, null) ? this.ListChanged(($t = new (Core.MVVM.ObservableListArgs$1(T))(), $t.ListData = this.Data, $t.Item = item, $t.Action = Core.MVVM.ObservableAction.Remove, $t)) : null;
            },
            RemoveAt: function (index) {
                var $t;
                if (index < 0) {
                    return;
                }

                var item = System.Linq.Enumerable.from(this._data, T).elementAt(index);
                !Bridge.staticEquals(this.ListChanged, null) ? this.ListChanged(($t = new (Core.MVVM.ObservableListArgs$1(T))(), $t.ListData = this._data, $t.Item = item, $t.Index = index, $t.Action = Core.MVVM.ObservableAction.Remove, $t)) : null;
            },
            Update: function (item, index) {
                var $t;
                !Bridge.staticEquals(this.ListChanged, null) ? this.ListChanged(($t = new (Core.MVVM.ObservableListArgs$1(T))(), $t.ListData = this._data, $t.Item = item, $t.Index = index, $t.Action = Core.MVVM.ObservableAction.Update, $t)) : null;
            }
        }
    }; });

    Bridge.define("Core.MVVM.ObservableListArgs$1", function (T) { return {
        props: {
            ListData: null,
            Item: Bridge.getDefaultValue(T),
            Index: 0,
            Action: null,
            Element: null,
            Renderer: null
        }
    }; });

    Bridge.define("Core.MVVM.SelectListItem", {
        props: {
            Value: null,
            Display: null
        }
    });

    /** @namespace Core.Structs */

    /**
     * Generate a UUIDv7 following the Peabody and Davis RFC draft.
     Aim is to get get 100ns resolution if possible, 
     working on both Windows and Linux.
     *
     * @public
     * @class Core.Structs.Uuid7
     */
    Bridge.define("Core.Structs.Uuid7", {
        statics: {
            fields: {
                /**
                 * A UUIDv7 Guid transformed into a 25-character lower-case string which 
                 preserves the time-ordered property. Using this distinct representation can
                 reduce the chance that some v4 UUIDs end up in a collection of v7 UUIDs.
                 As for the Uuid7.Guid(), the current time is used, unless overridden.
                 The special value of 0 gives an all zero uuid.
                 *
                 * @static
                 * @private
                 * @memberof Core.Structs.Uuid7
                 * @constant
                 * @default "0123456789abcdefghijkmnopqrstuvwxyz"
                 * @type string
                 * @return  {[type]}        25-character string like "0q974fmmvghw8qfathid7qekc" that is time-sortable.
                 */
                alphabet: null,
                _x: System.Int64(0),
                _y: System.Int64(0),
                _z: System.Int64(0),
                _seq: 0,
                _x_asOf: System.Int64(0),
                _y_asOf: System.Int64(0),
                _z_asOf: System.Int64(0),
                _seq_asOf: 0
            },
            ctors: {
                init: function () {
                    this.alphabet = "0123456789abcdefghijkmnopqrstuvwxyz";
                    this._x = System.Int64(0);
                    this._y = System.Int64(0);
                    this._z = System.Int64(0);
                    this._seq = 0;
                    this._x_asOf = System.Int64(0);
                    this._y_asOf = System.Int64(0);
                    this._z_asOf = System.Int64(0);
                    this._seq_asOf = 0;
                }
            },
            methods: {
                /**
                 * The current time in integer nanoseconds, 
                 measured from the Unix epoch (midnight on 1 January 1970).
                 *
                 * @static
                 * @public
                 * @this Core.Structs.Uuid7
                 * @memberof Core.Structs.Uuid7
                 * @return  {System.Int64}        Integer number of nanoseconds.
                 */
                TimeNs: function () {
                    return System.Int64(100).mul(System.DateTime.subdd(System.DateTime.getUtcNow(), System.DateTime.create(1970, 1, 1)).getTicks());
                },
                /**
                 * A new UUIDv7 Guid, which is time-ordered, with a nominal
                 time resolution of 100ns and 32 bits of randomness.
                 The current time is used, unless overridden.
                 Consecutive calls using the same Uuid7 instance employ a 14-bit sequence
                 counter so their uuids/Id25s stay time-ordered. The lowest 48 bits are random.
                 The special value of 0 gives an all zero uuid.
                 *
                 * @static
                 * @public
                 * @this Core.Structs.Uuid7
                 * @memberof Core.Structs.Uuid7
                 * @param   {?System.Int64}    asOfNs    Optional time to use, in integer nanoseconds since the Unix epoch.
                 * @return  {System.Guid}                Guid that follows UUID v7 format whose string and integer representations are time-sortable.
                 */
                Guid: function (asOfNs) {
                    if (asOfNs === void 0) { asOfNs = null; }
                    /* The time resolution stored here is 24 fractional bits,
                      corresponding to 50ns. This is sufficient for the underlying
                      100ns tick size. The actual clock precision may be several
                      times less than this.

                     0                   1                   2                   3
                     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
                    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                    |                            unixts                             |
                    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                    |unixts |   msec (12 bits)      |  ver  |     usec (12 bits)    |
                    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                    |var|       seq (14 bits)       |          rand (16 bits)       |
                    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                    |                          rand (32 bits)                       |
                    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
                    */
                    var uuidVersion = 7;
                    // The UUID variant is the top-most bits of byte #9.
                    // The number of bits increases because as new variants were added, 
                    // the previous maximum variant value with "all 1 bits" got
                    // extended with a new 0/1 bit to the right.
                    // Thus variant 1 for RFC4122 UUIDs is represented by bits 10.
                    // (Variant 2 for Microsoft Guids is represented by three bits 110).
                    var uuidVariant = 2;
                    var maxSeqValue = 16383;

                    var ns;
                    if (System.Nullable.lifteq("equals", asOfNs, System.Int64.lift(null))) {
                        ns = Core.Structs.Uuid7.TimeNs();
                    } else {
                        if (System.Nullable.lifteq("equals", asOfNs, System.Int64(0))) {
                            return new System.Guid.$ctor4("00000000-0000-0000-0000-000000000000");
                        } else {
                            ns = System.Nullable.getValue(asOfNs);
                        }
                    }
                    var rest1 = { };

                    // Get timestamp components of length 32, 16, 12 bits,
                    // with the first 36 bits being whole seconds and
                    // the remaining 24 bits being fractional seconds.
                    var x = System.Int64.divRem(ns, System.Int64([-1179869184,3]), rest1);
                    var rest2 = { };
                    var y = System.Int64.divRem(rest1.v.shl(16), System.Int64([-1179869184,3]), rest2);
                    var _discard1 = { };
                    var z = System.Int64.divRem(rest2.v.shl(12), System.Int64([-1179869184,3]), _discard1);

                    var seq;
                    if (System.Nullable.liftne("ne", asOfNs, System.Int64.lift(null))) {
                        if (x.equals(Core.Structs.Uuid7._x) && y.equals(Core.Structs.Uuid7._y) && z.equals(Core.Structs.Uuid7._z)) {
                            // Shouldn't be possible to call often enough that seq overflows
                            // before the next time tick. If that does happen
                            // subsequent uuids with that time tick will be unique
                            // (because of the random bytes) but no longer ordered.
                            if (Core.Structs.Uuid7._seq < maxSeqValue) {
                                Core.Structs.Uuid7._seq = (Core.Structs.Uuid7._seq + 1) | 0;
                            }
                        } else {
                            Core.Structs.Uuid7._seq = 0;
                            Core.Structs.Uuid7._x = x;
                            Core.Structs.Uuid7._y = y;
                            Core.Structs.Uuid7._z = z;
                        }
                        seq = Core.Structs.Uuid7._seq;
                    } else {
                        // Check other counters if using asOfNs
                        if (x.equals(Core.Structs.Uuid7._x_asOf) && y.equals(Core.Structs.Uuid7._y_asOf) && z.equals(Core.Structs.Uuid7._z_asOf)) {
                            if (Core.Structs.Uuid7._seq_asOf < maxSeqValue) {
                                Core.Structs.Uuid7._seq_asOf = (Core.Structs.Uuid7._seq_asOf + 1) | 0;
                            }
                        } else {
                            Core.Structs.Uuid7._seq_asOf = 0;
                            Core.Structs.Uuid7._x_asOf = x;
                            Core.Structs.Uuid7._y_asOf = y;
                            Core.Structs.Uuid7._z_asOf = z;
                        }
                        seq = Core.Structs.Uuid7._seq_asOf;
                    }

                    // Last 8 bytes of uuid have variant and sequence in first two bytes,
                    // then six bytes of randomness.
                    var last8Bytes = System.Array.init(8, 0, System.Byte);
                    var random = new System.Random.ctor();
                    random.NextBytes(last8Bytes);
                    last8Bytes[System.Array.index(0, last8Bytes)] = (uuidVariant << 6 | seq >> 8) & 255;
                    last8Bytes[System.Array.index(1, last8Bytes)] = (seq & 255) & 255;

                    // Don't use Guid(bytes[]), which internally uses a mix of
                    // big and little endian byte orderings for historical reasons
                    // (see https://en.wikipedia.org/wiki/Universally_unique_identifier#Variants).
                    // Instead use Guid(int, short, short, bytes[]), which doesn't mix endianness.
                    return new System.Guid.$ctor3(System.Int64.clip32(x), System.Int64.clip16(y), System.Int64.clip16(System.Int64((uuidVersion << 12)).add(z).and(System.Int64(65535))), last8Bytes);
                },
                String: function (asOfNs) {
                    if (asOfNs === void 0) { asOfNs = null; }
                    return Core.Structs.Uuid7.Guid(asOfNs).toString();
                },
                /**
                 * A UUIDv7 Guid transformed into a 25-character lower-case string which 
                 preserves the time-ordered property. This representation, called Id25,
                 is distinctive and reduces the chance that some v4 UUIDs end up 
                 in a collection meant to contain only v7 UUIDs.
                 As for the Uuid7.Guid(), the current time is used, unless overridden.
                 Consecutive calls using the same Uuid7 instance employ a 14-bit sequence
                 counter so their uuids/Id25s stay time-ordered. The lowest 48 bits are random.
                 The special value of 0 gives an all zero uuid.
                 *
                 * @static
                 * @public
                 * @this Core.Structs.Uuid7
                 * @memberof Core.Structs.Uuid7
                 * @param   {?System.Int64}    asOfNs    Optional time to use, in integer nanoseconds since the Unix epoch.
                 * @return  {string}                     25-character string like "0q974fmmvghw8qfathid7qekc" that is time-sortable.
                 */
                Id25: function (asOfNs) {
                    if (asOfNs === void 0) { asOfNs = null; }
                    var guid = Core.Structs.Uuid7.Guid(asOfNs);
                    return Core.Structs.Uuid7.Id25Internal(guid);
                },
                Id25Internal: function (guid) {
                    var id25_chars = System.Array.init(25, 0, System.Char);

                    var arr = guid.ToByteArray();
                    // C# GUIDs use a mix of big endian and little ending ordering.
                    // e.g. Guid  00010203-0405-0607-0809-0A0B0C0D0E0F becomes
                    // byte array 030201000504070608090A0B0C0D0E0F.
                    // So do endian conversion for first 8 bytes as long-short-short.
                    var b;
                    b = arr[System.Array.index(3, arr)];
                    arr[System.Array.index(3, arr)] = arr[System.Array.index(0, arr)];
                    arr[System.Array.index(0, arr)] = b;
                    b = arr[System.Array.index(2, arr)];
                    arr[System.Array.index(2, arr)] = arr[System.Array.index(1, arr)];
                    arr[System.Array.index(1, arr)] = b;
                    b = arr[System.Array.index(4, arr)];
                    arr[System.Array.index(4, arr)] = arr[System.Array.index(5, arr)];
                    arr[System.Array.index(5, arr)] = b;
                    b = arr[System.Array.index(6, arr)];
                    arr[System.Array.index(6, arr)] = arr[System.Array.index(7, arr)];
                    arr[System.Array.index(7, arr)] = b;

                    var isZero = System.Linq.Enumerable.from(arr, System.Byte).all(function (i) {
                            return i === 0;
                        });
                    var uuidVersion = arr[System.Array.index(6, arr)] >> 4;
                    var uuidVariant = arr[System.Array.index(8, arr)] >> 6;
                    if ((!isZero) && (uuidVersion !== 7 || uuidVariant !== 2)) {
                        throw new System.ArgumentException.$ctor1("Not v7 UUID");
                    }
                    var rest = Core.Structs.Uuid7.ArrToBigInt(arr);
                    var rem = rest;
                    var divisor = Core.Structs.Uuid7.ArrToBigInt(System.Text.Encoding.ASCII.GetBytes$2("#")); // # is 35

                    for (var pos = 24; pos >= 0; pos = (pos - 1) | 0) {
                        rem = rest % divisor;
                        rest /= divisor;
                        var c = Core.Structs.Uuid7.alphabet[rem];
                        id25_chars[System.Array.index(pos, id25_chars)] = c;
                    }
                    return id25_chars.join("");
                },
                ArrToBigInt: function (arr) {
                    return arr.reduce((acc, val) => (acc << 8n) | BigInt(val), 0n);
                    return null;
                },
                /**
                 * Check whether the tick values on this system are being returned
                 with ~100ns precision. We should not see 15ms!
                 Typical values on Win11 seem to be 132ns.
                 *
                 * @static
                 * @public
                 * @this Core.Structs.Uuid7
                 * @memberof Core.Structs.Uuid7
                 * @return  {string}        String with description of timing analysis.
                 */
                CheckTimingPrecision: function () {
                    var distinctValues = new (System.Collections.Generic.HashSet$1(System.Int64)).ctor();
                    var sw = System.Diagnostics.Stopwatch.startNew();
                    var numLoops = System.Int64(0);
                    while (sw.timeSpan().getTotalSeconds() < 0.5 && numLoops.lt(System.Int64(1000))) {
                        distinctValues.add(Core.Structs.Uuid7.TimeNs());
                        numLoops = numLoops.add(System.Int64(1));
                    }
                    sw.stop();

                    var numSamples = distinctValues.Count;
                    var actualPrecisionNs = 1000000 * sw.timeSpan().getTotalMilliseconds() / numSamples;
                    var maxPrecisionNs = 1000000 * sw.timeSpan().getTotalMilliseconds() / System.Int64.toNumber(numLoops);

                    if (System.Int64(numSamples).equals(numLoops)) {
                        return System.String.format("Precision is {0:0}ns with no repeats in {1:N0} loops taking {2}ms", Bridge.box(actualPrecisionNs, System.Double, System.Double.format, System.Double.getHashCode), numLoops, Bridge.box(sw.timeSpan().getTotalMilliseconds(), System.Double, System.Double.format, System.Double.getHashCode));
                    } else {
                        return System.String.format("Precision is {0:0}ns rather than {1:0}ns ({2:N0} unique timestamps from {3:N0} loops taking {4}ms)", Bridge.box(actualPrecisionNs, System.Double, System.Double.format, System.Double.getHashCode), Bridge.box(maxPrecisionNs, System.Double, System.Double.format, System.Double.getHashCode), Bridge.box(numSamples, System.Int32), numLoops, Bridge.box(sw.timeSpan().getTotalMilliseconds(), System.Double, System.Double.format, System.Double.getHashCode));
                    }
                }
            }
        }
    });

    Bridge.define("Core.ViewModels.ConfigEmailVM", {
        props: {
            Server: null,
            FromAddress: null,
            Password: null
        }
    });

    Bridge.define("Core.ViewModels.EmailVM", {
        props: {
            ConnKey: null,
            FromAddress: null,
            ToAddresses: null,
            CC: null,
            BCC: null,
            Subject: null,
            Body: null,
            PdfText: null,
            FileName: null,
            Attachements: null
        },
        ctors: {
            init: function () {
                this.ConnKey = Core.Clients.Client.ConnKey;
                this.PdfText = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.FileName = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.Attachements = new (System.Collections.Generic.HashSet$1(System.String)).ctor();
            }
        }
    });

    Bridge.define("Core.ViewModels.FileUpload", {
        props: {
            Id: null,
            EntityName: null,
            RecordId: null,
            FieldName: null,
            SectionId: null,
            FileName: null,
            FilePath: null,
            InsertedBy: null,
            InsertedDate: null,
            UpdatedBy: null,
            UpdatedDate: null
        },
        ctors: {
            init: function () {
                this.InsertedDate = new System.DateTimeOffset();
            }
        }
    });

    Bridge.define("Core.ViewModels.GPS", {
        props: {
            latitude: 0,
            longitude: 0
        }
    });

    Bridge.define("Core.ViewModels.HotKeyModel", {
        props: {
            Operator: null,
            OperatorText: null,
            Value: null,
            FieldName: null,
            ValueText: null,
            Shift: false,
            ActValue: false
        }
    });

    Bridge.define("Core.ViewModels.LoginVM", {
        props: {
            CompanyName: null,
            ConnKey: null,
            UserName: null,
            Password: null,
            AutoSignIn: false,
            RecoveryToken: null,
            Env: null
        },
        ctors: {
            init: function () {
                this.CompanyName = Core.Clients.Client.Tenant;
                this.ConnKey = Core.Clients.Client.ConnKey;
                this.Env = Core.Clients.Client.Env;
            }
        }
    });

    Bridge.define("Core.ViewModels.OwnershipRequest", {
        props: {
            EntityType: null,
            RecordIds: null
        }
    });

    Bridge.define("Core.ViewModels.PatchDetail", {
        props: {
            Field: null,
            Label: null,
            OldVal: null,
            Value: null,
            JustHistory: false
        }
    });

    Bridge.define("Core.ViewModels.PatchVM", {
        props: {
            FeatureId: null,
            ComId: null,
            Table: null,
            QueueName: null,
            CacheName: null,
            ConnKey: null,
            Changes: null,
            EntityId: {
                get: function () {
                    var $t;
                    return ($t = System.Linq.Enumerable.from(this.Changes, Core.ViewModels.PatchDetail).firstOrDefault(function (x) {
                                return Bridge.referenceEquals(x.Field, Core.Extensions.Utils.IdField);
                            }, null)) != null ? $t.Value : null;
                }
            }
        }
    });

    Bridge.define("Core.ViewModels.RefreshVM", {
        props: {
            AccessToken: null,
            RefreshToken: null
        }
    });

    Bridge.define("Core.ViewModels.RegistrationVM", {
        props: {
            Email: null,
            Password: null,
            ConfirmPassword: null,
            FullName: null,
            Address: null,
            IsVendor: false,
            TaxCode: null,
            LocalShortName: null,
            LocalFullName: null,
            InterShortName: null,
            InterFullName: null
        }
    });

    Bridge.define("Core.ViewModels.SignedCom", {
        props: {
            CmdId: null,
            Query: null,
            Signed: null
        }
    });

    Bridge.define("Core.ViewModels.SqlViewModel", {
        props: {
            SvcId: null,
            ComId: null,
            Action: null,
            Params: null,
            Ids: null,
            AnnonymousTenant: null,
            AnnonymousEnv: null,
            Paging: null,
            Select: null,
            Where: null,
            OrderBy: null,
            GroupBy: null,
            Having: null,
            Count: false,
            FieldName: null,
            SkipXQuery: false,
            ConnKey: null,
            Table: null
        },
        ctors: {
            init: function () {
                this.AnnonymousTenant = Core.Clients.Client.Tenant;
                this.AnnonymousEnv = Core.Clients.Client.Env;
                this.ConnKey = Core.Clients.Client.ConnKey;
            }
        }
    });

    Bridge.define("Core.ViewModels.Token", {
        props: {
            UserId: null,
            CostCenterId: null,
            UserName: null,
            Email: null,
            FirstName: null,
            LastName: null,
            FullName: null,
            Address: null,
            Avatar: null,
            AccessToken: null,
            RefreshToken: null,
            AccessTokenExp: null,
            RefreshTokenExp: null,
            HashPassword: null,
            Recovery: null,
            Vendor: null,
            RoleIds: null,
            RoleNames: null,
            CenterIds: null,
            Ssn: null,
            PhoneNumber: null,
            TeamId: null,
            PartnerId: null,
            RegionId: null,
            Additional: null,
            SigninDate: null,
            TenantCode: null,
            Env: null,
            ConnKey: null
        },
        ctors: {
            init: function () {
                this.AccessTokenExp = new System.DateTimeOffset();
                this.RefreshTokenExp = new System.DateTimeOffset();
                this.SigninDate = new System.DateTimeOffset();
                this.TenantCode = Core.Clients.Client.Tenant;
                this.Env = Core.Clients.Client.Env;
                this.ConnKey = Core.Clients.Client.ConnKey;
            }
        }
    });

    Bridge.define("System.ComponentModel.DescriptionAttribute", {
        inherits: [System.Attribute],
        props: {
            Description: null
        },
        ctors: {
            ctor: function (description) {
                this.$initialize();
                System.Attribute.ctor.call(this);
                this.Description = description;
            }
        }
    });

    Bridge.define("System.IO.Path", {
        statics: {
            fields: {
                ImgExt: null
            },
            ctors: {
                init: function () {
                    this.ImgExt = System.Array.init(["tif", "pjp", "xbm", "jxl", "svgz", "jpeg", "ico", "tiff", "gif", "svg", "jfif", "webp", "png", "bmp", "pjpeg", "avif", "jpg"], System.String);
                }
            },
            methods: {
                IsImage: function (path) {
                    var isImage = System.Array.contains(System.IO.Path.ImgExt, Core.Extensions.StringExt.SubStrIndex(System.IO.Path.GetExtension(path).toLowerCase(), 1), System.String);
                    return isImage;
                },
                CombineHostAndPath: function (host, path) {
                    var containHost = System.IO.Path.ContainHost(path);
                    return containHost ? path : System.IO.Path.Combine([host, path]);
                },
                ContainHost: function (path) {
                    return System.String.contains(path,"http://") || System.String.contains(path,"https://");
                },
                /**
                 * Get file's extension including "."
                 *
                 * @static
                 * @public
                 * @this System.IO.Path
                 * @memberof System.IO.Path
                 * @param   {string}    path
                 * @return  {string}
                 */
                GetExtension: function (path) {
                    if (System.String.isNullOrEmpty(path)) {
                        return "";
                    }
                    return path.substr(path.lastIndexOf("."));
                },
                GetFileName: function (path) {
                    if (System.String.isNullOrEmpty(path)) {
                        return "";
                    }
                    var lastSlash = path.lastIndexOf("/");
                    return lastSlash >= 0 ? path.substr(((lastSlash + 1) | 0)) : path;
                },
                GetFileNameWithoutExtension: function (path) {
                    if (System.String.isNullOrEmpty(path)) {
                        return "";
                    }
                    var lastSlashIndex = path.lastIndexOf("/");
                    if (lastSlashIndex < 0) {
                        lastSlashIndex = 0;
                    }
                    var lastDotIndex = path.lastIndexOf(".");
                    return path.substr(((lastSlashIndex + 1) | 0), ((((lastDotIndex - 1) | 0) - (lastSlashIndex >= 0 ? lastSlashIndex : 0)) | 0));
                },
                Combine: function (path) {
                    if (path === void 0) { path = []; }
                    if (path == null || path.length === 0) {
                        return "";
                    }
                    var nonEmptyPath = System.Linq.Enumerable.from(path, System.String).where(function (x) {
                            return !System.String.isNullOrEmpty(x);
                        }).select(function (x) {
                        var heading = x.charCodeAt(0) === 47 ? 1 : 0;
                        var traling = x.charCodeAt(((x.length - 1) | 0)) === 47 ? ((x.length - 1) | 0) : x.length;
                        return x.substr(heading, ((traling - heading) | 0));
                    }).ToArray(System.String);
                    return (nonEmptyPath).join("/");
                }
            }
        }
    });

    Bridge.define("Core.Components.Forms.EditForm", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                NotDirtyMessage: null,
                ExpiredDate: null,
                BtnExpired: null,
                BtnSave: null,
                BtnSend: null,
                BtnApprove: null,
                BtnReject: null,
                StatusIdField: null,
                BtnCancel: null,
                BtnPrint: null,
                BtnPreview: null,
                SpecialEntryPoint: null,
                LastForm: null,
                NotificationClient: null
            },
            props: {
                LayoutForm: null,
                Portal: false
            },
            ctors: {
                init: function () {
                    this.NotDirtyMessage = "Data was not changed!";
                    this.ExpiredDate = "ExpiredDate";
                    this.BtnExpired = "btnExpired";
                    this.BtnSave = "btnSave";
                    this.BtnSend = "btnSend";
                    this.BtnApprove = "btnApprove";
                    this.BtnReject = "btnReject";
                    this.StatusIdField = "StatusId";
                    this.BtnCancel = "btnCancel";
                    this.BtnPrint = "btnPrint";
                    this.BtnPreview = "btnPreview";
                    this.SpecialEntryPoint = "entry";
                }
            },
            methods: {
                RenderCellText: function (ele, entity, isLayout) {
                    var $t, $t1;
                    var text = ele.textContent != null ? ele.textContent.trim() : null;
                    if (Core.Extensions.StringExt.HasAnyChar(text) && System.String.startsWith(text, "{") && System.String.endsWith(text, "}")) {
                        var cellText = ($t = new Core.Components.Label(($t1 = new Core.Models.Component(), $t1.FieldName = Core.Extensions.StringExt.SubStrIndex$1(text, 1, ((text.length - 1) | 0)), $t1), ele), $t.Entity = entity, $t);
                        if (isLayout && Core.Components.Forms.EditForm.LayoutForm != null) {
                            Core.Components.Forms.EditForm.LayoutForm.AddChild(cellText);
                        } else {
                            cellText.Render();
                        }
                        return cellText;
                    }
                    return null;
                }
            }
        },
        fields: {
            _entity: null,
            UrlSearch: null,
            _entityEnum: null,
            TabGroup: null,
            _confirm: null,
            _title: null,
            _icon: null,
            TitleElement: null,
            IconElement: null,
            AfterSaved: null,
            BeforeSaved: null,
            _currentListView: null,
            _componentCoppy: null
        },
        props: {
            CurrentUserId: null,
            RegionId: null,
            CenterIds: null,
            RoleIds: null,
            CostCenterId: null,
            RoleNames: null,
            ShouldUpdateParentForm: false,
            Now: {
                get: function () {
                    return System.DateTime.getNow();
                }
            },
            FeatureConnKey: {
                get: function () {
                    var $t, $t1;
                    return ($t = (($t1 = this.Feature) != null ? $t1.ConnKey : null), $t != null ? $t : Core.Clients.Client.ConnKey);
                }
            },
            IsEditMode: {
                get: function () {
                    return this.Entity != null && Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField]) > 0;
                }
            },
            InnerEntry: {
                get: function () {
                    return document.getElementById("entry");
                }
            },
            EntityName: {
                get: function () {
                    var $t;
                    return ($t = this.Feature) != null ? $t.EntityName : null;
                }
            },
            IsLock: false,
            ListViews: null,
            UserVendor: {
                get: function () {
                    var $t;
                    return ($t = Core.Clients.Client.Token) != null ? $t.Vendor : null;
                }
            },
            ShouldLoadEntity: false,
            Feature: null,
            Icon: {
                get: function () {
                    return this._icon;
                },
                set: function (value) {
                    this._icon = value;
                    if (this.IconElement != null) {
                        Core.Components.Renderer.IconForSpan(Core.MVVM.Html.Take(this.IconElement), value);
                    }
                }
            },
            Title: {
                get: function () {
                    return this._title;
                },
                set: function (value) {
                    this._title = value;
                    if (this.TitleElement != null) {
                        this.TitleElement.innerHTML = null;
                        Core.Components.Renderer.IText(Core.MVVM.Html.Take(this.TitleElement), value);
                    }
                }
            },
            Public: false,
            OpenFrom: null,
            ParentForm: null,
            ReasonOfChange: null,
            Config: false
        },
        ctors: {
            init: function () {
                this.ListViews = new (System.Collections.Generic.HashSet$1(Core.Components.ListView)).ctor();
            },
            ctor: function (entity) {
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, null);
                this.UrlSearch = new URLSearchParams(window.location.search);
                if (entity == null) {
                    return;
                }
                this.ListViews = new (System.Collections.Generic.HashSet$1(Core.Components.ListView)).ctor();
                this._entity = entity;
                var entityType = Bridge.Reflection.getType((Core.Clients.Client.ModelNamespace || "") + (entity || ""));
                if (entityType != null) {
                    this.Entity = Bridge.createInstance(entityType);
                }
                window.addEventListener("resize", Bridge.fn.cacheBind(this, this.ResizeHandler));
                Core.Components.Forms.EditForm.LayoutForm = Core.Components.Forms.EditForm.LayoutForm || new Core.Components.Forms.EditForm(null);
            }
        },
        methods: {
            GetPatchEntity: function () {
                var $t;
                var shouldGetAll = this.EntityId == null;
                var details = System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Components.EditableComponent, System.String, this.FilterChildren$1(function (child) {
                        var editable;
                        return ((editable = child)) != null && !(Bridge.is(child, Core.Components.Button)) && (shouldGetAll || editable.Dirty) && child.GuiInfo != null && Core.Extensions.StringExt.HasNonSpaceChar(child.GuiInfo.FieldName);
                    }, function (x) {
                        return Bridge.is(x, Core.Components.ListView) || x.AlwaysValid || !x.PopulateDirty;
                    }), function (x) {
                        return x.GuiInfo.Id;
                    }), Core.Components.EditableComponent).selectMany(Bridge.fn.bind(this, function (child) {
                        var $t, $t1;
                        var fn;
                        if (!Bridge.staticEquals(((fn = child.PatchDetail)), null)) {
                            return Bridge.as(fn.call(child), System.Array.type(Core.ViewModels.PatchDetail));
                        }
                        var value = Core.Extensions.Utils.GetPropValue(child.Entity, child.FieldName);
                        var propType = Core.Extensions.BridgeExt.GetComplexPropType(Bridge.getType(child.Entity), child.FieldName, child.Entity);
                        var patch = ($t = new Core.ViewModels.PatchDetail(), $t.Label = child.Label, $t.Field = child.FieldName, $t.OldVal = (child.OldValue != null && Core.Extensions.ReflectionExt.IsDate(propType)) ? Core.Extensions.DateTimeExt.DateConverter(Bridge.toString(child.OldValue)) : ($t1 = child.OldValue) != null ? Bridge.toString($t1) : null, $t.Value = (value != null && Core.Extensions.ReflectionExt.IsDate(propType)) ? Core.Extensions.DateTimeExt.DateConverter(Bridge.toString(value)) : !this.EditForm.Feature.IgnoreEncode ? value != null ? Core.Extensions.Utils.EncodeSpecialChar(Bridge.toString(value).trim()) : null : value != null ? Bridge.toString(value).trim() : null, $t);
                        return System.Array.init([patch], Core.ViewModels.PatchDetail);
                    })).toList(Core.ViewModels.PatchDetail);
                this.AddIdToPatch(details);
                return ($t = new Core.ViewModels.PatchVM(), $t.Changes = details, $t.Table = this.Feature.EntityName, $t.QueueName = this.QueueName, $t.CacheName = this.CacheName, $t);
            },
            SavePatch: function (entity) {
                if (entity === void 0) { entity = null; }
                if (!this.Dirty) {
                    Core.Extensions.Toast.Warning(Core.Components.Forms.EditForm.NotDirtyMessage);
                    return System.Threading.Tasks.Task.fromResult(false, System.Boolean);
                }
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done$1(System.Boolean, this.IsFormValid(), Bridge.fn.bind(this, function (valid) {
                    if (valid) {
                        Core.Extensions.EventExt.Done$1(System.Boolean, this.ValidSavePatch(), function (sucess) {
                            tcs.trySetResult(sucess);
                        });
                    } else {
                        tcs.trySetResult(false);
                    }
                }));
                return tcs.task;
            },
            ValidSavePatch: function () {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                var pathModel = this.GetPatchEntity();
                !Bridge.staticEquals(this.BeforeSaved, null) ? this.BeforeSaved() : null;
                Core.Extensions.EventExt.Catch(Core.Extensions.EventExt.Done$1(System.Int32, Core.Clients.Client.Instance.PatchAsync(pathModel), Bridge.fn.bind(this, function (rs) {
                    if (rs === 0) {
                        Core.Extensions.Toast.Warning("D\u1eef li\u1ec7u c\u1ee7a b\u1ea1n ch\u01b0a \u0111\u01b0\u1ee3c l\u01b0u vui l\u00f2ng nh\u1eadp l\u1ea1i!");
                        tcs.trySetResult(false);
                        return;
                    }
                    this.EntityId = pathModel.EntityId;
                    this.UpdateIndependantGridView();
                    if (this.Feature.DeleteTemp) {
                        this.DeleteGridView();
                    }
                    Core.Extensions.Toast.Success(System.String.format("The data was saved", null));
                    this.Dirty = false;
                    !Bridge.staticEquals(this.AfterSaved, null) ? this.AfterSaved(true) : null;
                    tcs.trySetResult(true);
                    return;
                })), function (e) {
                    tcs.trySetResult(false);
                    Core.Extensions.Toast.Warning(e.Message);
                });
                return tcs.task;
            },
            GetDirtyGrid: function () {
                return System.Linq.Enumerable.from(this.ListViews, Core.Components.ListView).where(function (x) {
                        return Core.Extensions.StringExt.HasAnyChar(x.GuiInfo.IdField) && x.GuiInfo.CanAdd;
                    }).where(function (x) {
                    return System.Linq.Enumerable.from(x.FilterChildren(Core.Components.EditableComponent, function (com) {
                            return com._dirty;
                        }, function (com) {
                            return !com.PopulateDirty;
                        }), Core.Components.EditableComponent).any();
                }).ToArray(Core.Components.ListView);
            },
            GetDeleteGrid: function () {
                return System.Linq.Enumerable.from(this.ListViews, Core.Components.ListView).where(function (x) {
                        return Core.Extensions.StringExt.HasAnyChar(x.GuiInfo.Id);
                    }).where(function (x) {
                    return System.Linq.Enumerable.from(x.DeleteTempIds, System.String).any();
                }).ToArray(Core.Components.ListView);
            },
            UpdateIndependantGridView: function () {
                var dirtyGrid = this.GetDirtyGrid();
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.ListView, dirtyGrid)) {
                    return;
                }
                var id = this.EntityId;
                dirtyGrid.forEach(function (x) {
                        x.UpdatedRows.ForEach(function (row) {
                            Core.Extensions.BridgeExt.SetPropValue(row, x.GuiInfo.IdField, id);
                        });
                        x.BatchUpdate();
                    });
            },
            DeleteGridView: function () {
                var $t;
                var dirtyGrid = this.GetDeleteGrid();
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.ListView, dirtyGrid)) {
                    return;
                }
                $t = Bridge.getEnumerator(dirtyGrid);
                try {
                    while ($t.moveNext()) {
                        var item = { v : $t.Current };
                        Core.Extensions.EventExt.Done$1(System.Array.type(System.String), Core.Clients.Client.Instance.HardDeleteAsync(item.v.DeleteTempIds.ToArray(), item.v.GuiInfo.RefName, item.v.ConnKey), (function ($me, item) {
                            return function (ids) {
                                if (Core.Extensions.IEnumerableExtensions.HasElement(System.String, ids)) {
                                    System.Linq.Enumerable.from(item.v.DeleteTempIds, System.String).intersect(ids).ToArray(System.String).forEach(function (x) {
                                            item.v.DeleteTempIds.remove(x);
                                        });
                                } else {
                                    Core.Extensions.Toast.Warning("L\u1ed7i x\u00f3a chi ti\u1ebft vui l\u00f2ng ki\u1ec3m tra l\u1ea1i");
                                }
                            };
                        })(this, item));
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            IsFormValid: function (showMessage, predicate, ignorePredicate) {
                if (showMessage === void 0) { showMessage = true; }
                if (predicate === void 0) { predicate = null; }
                if (ignorePredicate === void 0) { ignorePredicate = null; }
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                if (Bridge.staticEquals(predicate, null)) {
                    predicate = function (x) {
                        return true;
                    };
                }
                if (Bridge.staticEquals(ignorePredicate, null)) {
                    ignorePredicate = function (x) {
                        return x.AlwaysValid || x.EmptyRow;
                    };
                }
                var allValid = Core.Extensions.IEnumerableExtensions.ForEachAsync(Core.Components.EditableComponent, this.FilterChildren(Core.Components.EditableComponent, predicate, ignorePredicate, void 0), function (x) {
                    return x.ValidateAsync();
                });
                Core.Extensions.EventExt.Done$1(System.Collections.Generic.IEnumerable$1(Core.Components.EditableComponent), allValid, function (validities) {
                    var $t;
                    var res = ($t = Core.Components.EditableComponent, System.Linq.Enumerable.from(validities, $t).ToArray($t));
                    var invalid = System.Linq.Enumerable.from(res, Core.Components.EditableComponent).any(function (x) {
                            return !x.IsValid;
                        });
                    if (!invalid) {
                        tcs.trySetResult(true);
                        return;
                    }
                    if (showMessage) {
                        var invalidCom = System.Linq.Enumerable.from(res, Core.Components.EditableComponent).where(function (x) {
                                return !x.IsValid;
                            }).ToArray(Core.Components.EditableComponent);
                        invalidCom.forEach(function (x) {
                                x.Disabled = false;
                            });
                        System.Linq.Enumerable.from(invalidCom, Core.Components.EditableComponent).firstOrDefault(null, null).Focus();
                        var message = Bridge.toArray(System.Linq.Enumerable.from(invalidCom, Core.Components.EditableComponent).selectMany(function (x) {
                                    return x.ValidationResult.Values;
                                })).join("<br />");
                        Core.Extensions.Toast.Warning(message);
                    }
                    tcs.trySetResult(false);
                });
                return tcs.task;
            },
            BuildTree: function (componentGroup) {
                var $t, $t1, $t2, $t3;
                var componentGroupMap = ($t = Core.Models.ComponentGroup, System.Linq.Enumerable.from(componentGroup, $t).toDictionary(function (x) {
                        return x.Id;
                    }, null, System.String, $t));
                var parent;
                $t1 = Bridge.getEnumerator(componentGroup);
                try {
                    while ($t1.moveNext()) {
                        var item = $t1.Current;
                        if (item.IsVertialTab && this.Element.clientWidth < Core.Components.EditableComponent.SmallScreen) {
                            item.IsVertialTab = false;
                        }

                        if (item.ParentId == null) {
                            continue;
                        }

                        if (!componentGroupMap.containsKey(item.ParentId)) {
                            System.Console.WriteLine(System.String.format("The parent key {0} of {1} doesn't exist", item.ParentId, item.Name));
                            continue;
                        }
                        parent = componentGroupMap.getItem(item.ParentId);
                        if (parent.InverseParent == null) {
                            parent.InverseParent = new (System.Collections.Generic.List$1(Core.Models.ComponentGroup)).ctor();
                        }

                        if (!System.Array.contains(parent.InverseParent, item, Core.Models.ComponentGroup)) {
                            System.Array.add(parent.InverseParent, item, Core.Models.ComponentGroup);
                        }

                        item.Parent = parent;
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }
                $t2 = Bridge.getEnumerator(componentGroup);
                try {
                    while ($t2.moveNext()) {
                        var item1 = $t2.Current;
                        if (item1.Component == null || !System.Linq.Enumerable.from(item1.Component, Core.Models.Component).any()) {
                            continue;
                        }

                        $t3 = Bridge.getEnumerator(item1.Component, Core.Models.Component);
                        try {
                            while ($t3.moveNext()) {
                                var ui = $t3.Current;
                                ui.ComponentGroup = item1;
                            }
                        } finally {
                            if (Bridge.is($t3, System.IDisposable)) {
                                $t3.System$IDisposable$Dispose();
                            }
                        }
                        if (item1.InverseParent != null) {
                            item1.InverseParent = System.Linq.Enumerable.from(item1.InverseParent, Core.Models.ComponentGroup).orderBy(function (x) {
                                    return x.Order;
                                }).toList(Core.Models.ComponentGroup);
                        }
                    }
                } finally {
                    if (Bridge.is($t2, System.IDisposable)) {
                        $t2.System$IDisposable$Dispose();
                    }
                }
                componentGroup.ForEach(Bridge.fn.bind(this, function (x) {
                    var $t4;
                    this.CalcItemInRow(($t4 = Core.Models.ComponentGroup, System.Linq.Enumerable.from(x.InverseParent, $t4).toList($t4)));
                }));
                var res = System.Linq.Enumerable.from(componentGroup, Core.Models.ComponentGroup).where(function (x) {
                        return x.ParentId == null;
                    });
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.ComponentGroup, res)) {
                    System.Console.WriteLine("No component group is root component. Wrong feature name or the configuration is wrong");
                }
                return res.toList(Core.Models.ComponentGroup);
            },
            CalcItemInRow: function (componentGroup) {
                var cumulativeColumn = 0;
                var itemInRow = 0;
                var startRowIndex = 0;
                for (var i = 0; i < componentGroup.Count; i = (i + 1) | 0) {
                    var group = componentGroup.getItem(i);
                    var parentInnerCol = this.GetInnerColumn(group.Parent);
                    var outerCol = this.GetOuterColumn(group);
                    if (parentInnerCol <= 0) {
                        continue;
                    }

                    itemInRow = (itemInRow + 1) | 0;
                    cumulativeColumn = (cumulativeColumn + outerCol) | 0;
                    if (cumulativeColumn % parentInnerCol === 0) {
                        var sameRow = i;
                        while (sameRow >= startRowIndex) {
                            componentGroup.getItem(sameRow).ItemInRow = itemInRow;
                            sameRow = (sameRow - 1) | 0;
                        }
                        itemInRow = 0;
                        startRowIndex = i;
                    }
                }
            },
            Render: function () {
                if (Core.Components.Forms.EditForm.Portal) {
                    this.ParentForm = this.ParentForm || Core.Components.Forms.EditForm.LastForm;
                }
                this.LoadFeatureAndRender();
                Core.Components.Forms.EditForm.LastForm = this;
            },
            LoadFeatureAndRender: function (callback) {
                if (callback === void 0) { callback = null; }
                var featureTask = this.Feature != null ? System.Threading.Tasks.Task.fromResult(this.Feature, Core.Models.Feature) : Core.Components.Extensions.ComponentExt.LoadFeature(this.FeatureConnKey, this.Name);
                var entityTask = this.LoadEntity();
                Core.Extensions.EventExt.Done(System.Threading.Tasks.Task.whenAll(featureTask, entityTask), Bridge.fn.bind(this, function () {
                    this.FeatureLoaded(featureTask.getResult(), entityTask.getResult(), callback);
                }));
            },
            FeatureLoaded: function (feature, entity, loadedCallback) {
                if (loadedCallback === void 0) { loadedCallback = null; }
                if (feature.LayoutId == null || this.InnerEntry != null) {
                    this.LayoutLoaded(feature, entity, void 0, loadedCallback);
                    return;
                }
                Core.Extensions.EventExt.Done$1(Core.Models.Feature, Core.Components.Extensions.ComponentExt.LoadFeature(null, feature.LayoutId), Bridge.fn.bind(this, function (layout) {
                    this.LayoutLoaded(feature, entity, layout, loadedCallback);
                }));
            },
            LayoutLoaded: function (feature, entity, layout, loadedCallback) {
                var $t, $t1;
                if (layout === void 0) { layout = null; }
                if (loadedCallback === void 0) { loadedCallback = null; }
                var token = Core.Clients.Client.Token;
                Core.Extensions.ReflectionExt.CopyPropFrom(this.Entity, entity);
                this.SetFeatureProperties(feature);
                this.CurrentUserId = token != null ? token.UserId : null;
                this.RegionId = token != null ? token.RegionId : null;
                this.CenterIds = (token != null ? token.CenterIds : null) != null ? Bridge.toArray(token.CenterIds).join(",") : "";
                this.RoleIds = (token != null ? token.RoleIds : null) != null ? Bridge.toArray(token.RoleIds).join(",") : "";
                this.CostCenterId = token != null ? token.CostCenterId : null;
                this.RoleNames = (token != null ? token.RoleNames : null) != null ? Bridge.toArray(token.RoleNames).join(",") : "";
                var groupTree = this.BuildTree(System.Linq.Enumerable.from(($t = Core.Models.ComponentGroup, System.Linq.Enumerable.from(feature.ComponentGroup, $t).toList($t)), Core.Models.ComponentGroup).orderBy(function (x) {
                        return x.Order;
                    }).toList(Core.Models.ComponentGroup));
                this.Element = this.RenderTemplate(layout, feature);
                this.SetFeatureStyleSheet(feature.StyleSheet);
                this.RenderTabOrSection(groupTree);
                this.ResizeHandler();
                this.LockUpdate();
                Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(this.Element), -1).Trigger("focus").Event("focusin", Bridge.fn.bind(this, function () {
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.Feature.Events, "focusin", [this.Entity]));
                })).Event$1("keydown", Bridge.fn.bind(this, function (e) {
                    Core.Extensions.EventExt.Done(this.KeyDownIntro(e));
                })).Event("focusout", Bridge.fn.bind(this, function () {
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.Feature.Events, "focusout", [this.Entity]));
                }));
                !Bridge.staticEquals(($t1 = this.DOMContentLoaded), null) ? $t1() : null;
                !Bridge.staticEquals(loadedCallback, null) ? loadedCallback() : null;
                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.Feature.Events, "DOMContentLoaded", [this.Entity]));
            },
            KeyDownIntro: function (evt) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $task2, 
                    $taskResult2, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    sql, 
                    $t, 
                    xhr, 
                    intro, 
                    script, 
                    item, 
                    fn, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3,4], $step);
                                switch ($step) {
                                    case 0: {
                                        if (Core.Extensions.EventExt.KeyCode(evt) === Core.Enums.KeyCodeEnum.H && Core.Extensions.EventExt.CtrlOrMetaKey(evt)) {
                                            $step = 1;
                                            continue;
                                        } 
                                        $step = 4;
                                        continue;
                                    }
                                    case 1: {
                                        evt.preventDefault();
                                        $task1 = Core.Clients.Client.LoadScript("https://unpkg.com/intro.js/intro.js");
                                        $step = 2;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 2: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        sql = ($t = new Core.ViewModels.SqlViewModel(), $t.ComId = "Intro", $t.Action = "GetByFeatureId", $t.Params = JSON.stringify(new $asm.$AnonymousType$3(this.Feature.Id)), $t);
                                        xhr = ($t = new Core.Clients.XHRWrapper(), $t.Url = Core.Extensions.Utils.UserSvc, $t.Method = Core.Enums.HttpMethod.POST, $t.IsRawString = true, $t.Value = JSON.stringify(sql), $t);
                                        $task2 = Core.Clients.Client.Instance.SubmitAsync(System.Array.type(System.Object), xhr);
                                        $step = 3;
                                        if ($task2.isCompleted()) {
                                            continue;
                                        }
                                        $task2.continue($asyncBody);
                                        return;
                                    }
                                    case 3: {
                                        $taskResult2 = $task2.getAwaitedResult();
                                        intro = $taskResult2;
                                        script = "(x) => {\r\n                                introJs().setOptions({\r\n                                  steps: [\r\n                                  {\r\n                                    intro: \"H\u01b0\u1edbng d\u1eabn s\u1eed d\u1ee5ng ch\u1ee9c n\u0103ng!\"\r\n                                  }";
                                        $t = Bridge.getEnumerator(intro);
                                        try {
                                            while ($t.moveNext()) {
                                                item = $t.Current;
                                                script = System.String.concat(script, (",{\r\n                                    intro: '" + item.Label + "',\r\n                                    element: Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.EditableComponent, x, '" + item.FieldName + "').Element\r\n                                  }"));
                                            }
                                        } finally {
                                            if (Bridge.is($t, System.IDisposable)) {
                                                $t.System$IDisposable$Dispose();
                                            }
                                        }
                                        script = (script || "") + "]}).start();}";
                                        fn = { };
                                        if (Core.Extensions.Utils.IsFunction(script, fn)) {
                                            fn.v.call(this, this);
                                        }
                                        $step = 4;
                                        continue;
                                    }
                                    case 4: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            RenderTemplate: function (layout, feature) {
                var entryPoint = document.getElementById(Core.Components.Forms.EditForm.SpecialEntryPoint) || document.getElementById("template") || this.Element;
                if (this.ParentForm != null && Core.Components.Forms.EditForm.Portal) {
                    this.ParentForm.Element = null;
                    this.ParentForm.Dispose();
                    this.ParentForm = null;
                }
                if (layout != null) {
                    var root = document.getElementById("template");
                    Core.MVVM.Html.Take(root).InnerHTML(layout.Template);
                    var style = document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.style));
                    style.appendChild(document.createTextNode(layout.StyleSheet));
                    root.appendChild(style);
                    this.BindingTemplate(root, this, true, void 0, void 0, void 0);
                    entryPoint = System.Linq.Enumerable.from(Core.Extensions.HtmlElementExtension.FilterElement(root, function (x) {
                            return Bridge.referenceEquals(x.id, Core.Components.Forms.EditForm.SpecialEntryPoint);
                        }), HTMLElement).firstOrDefault(null, null);
                    this.ResetEntryPoint(entryPoint);
                } else {
                    entryPoint.innerHTML = null;
                }
                if (!Core.Extensions.StringExt.HasAnyChar(feature.Template)) {
                    return entryPoint;
                }
                Core.MVVM.Html.Take(entryPoint).InnerHTML(feature.Template);
                this.BindingTemplate(entryPoint, this);
                var innerEntry = System.Linq.Enumerable.from(Core.Extensions.HtmlElementExtension.FilterElement(entryPoint, function (x) {
                        return Bridge.referenceEquals(x.id, "inner-entry");
                    }), HTMLElement).firstOrDefault(null, null);
                this.ResetEntryPoint(innerEntry);
                var res = innerEntry || entryPoint;
                if (Bridge.referenceEquals(Bridge.toString(res.style.display), System.Enum.toString(System.String, "none"))) {
                    res.style.display = "";
                }
                return res;
            },
            ResetEntryPoint: function (entryPoint) {
                if (entryPoint != null) {
                    entryPoint.innerHTML = "";
                }
            },
            BindingTemplate: function (ele, parent, isLayout, entity, factory, visited) {
                if (isLayout === void 0) { isLayout = false; }
                if (entity === void 0) { entity = null; }
                if (factory === void 0) { factory = null; }
                if (visited === void 0) { visited = null; }
                if (visited == null) {
                    visited = new (System.Collections.Generic.HashSet$1(HTMLElement)).ctor();
                }
                if (ele == null || visited.contains(ele)) {
                    return;
                }
                visited.add(ele);
                if (ele.children.length === 0 && Core.Components.Forms.EditForm.RenderCellText(ele, entity, isLayout) != null) {
                    return;
                }
                var component = null;
                var id = ele.dataset[Core.Components.EditableComponent.IdField.toLowerCase()];
                if (id != null) {
                    component = System.Linq.Enumerable.from(this.Feature.Component, Core.Models.Component).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.Id, id);
                        }, null);
                }
                var newCom = (!Bridge.staticEquals(factory, null) ? factory(ele, component, parent, isLayout, entity) : null) || this.BindingCom(ele, component, parent, isLayout, entity);
                parent = Bridge.is(newCom, Core.Components.Section) ? newCom : parent;
                Core.Extensions.IEnumerableExtensions.SelectForEach(HTMLElement, ele.children, Bridge.fn.bind(this, function (child) {
                    this.BindingTemplate(child, parent, isLayout, entity, factory, visited);
                }));
            },
            BindingCom: function (ele, com, parent, isLayout, entity) {
                var $t, $t1, $t2;
                var child = null;
                if (ele == null) {
                    return null;
                }
                if (com == null || Core.Extensions.StringExt.IsNullOrEmpty(com.ComponentType)) {
                    return null;
                }
                if (Bridge.referenceEquals(com.ComponentType, "Section")) {
                    child = ($t = new Core.Components.Section.ctor(ele), $t.GuiInfo = com, $t);
                } else if (child == null) {
                    child = Core.Components.Extensions.ComponentFactory.GetComponent(com, this, ele);
                }
                child.ParentElement = child.ParentElement || ele;
                child.Entity = ($t = entity, $t != null ? $t : ($t1 = (($t2 = child.EditForm) != null ? $t2.Entity : null), $t1 != null ? $t1 : Core.Components.Forms.EditForm.LayoutForm.Entity));
                if (isLayout) {
                    child.EditForm = Bridge.as(parent, Core.Components.Forms.EditForm);
                    child.Render();
                    Core.Components.Forms.EditForm.LayoutForm.Children.add(child);
                    child.ToggleShow(com.ShowExp);
                    child.ToggleDisabled(com.DisabledExp);
                } else {
                    parent.AddChild(child);
                }
                return child;
            },
            LoadEntity: function () {
                var $t;
                if (!this.ShouldLoadEntity || Core.Extensions.StringExt.IsNullOrWhiteSpace(this.EntityId)) {
                    return System.Threading.Tasks.Task.fromResult(null, System.Object);
                }
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Object), Core.Clients.Client.Instance.GetByIdAsync(this.EntityName, ($t = this.Feature.ConnKey, $t != null ? $t : Core.Clients.Client.ConnKey), [this.EntityId]), function (ds) {
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, ds)) {
                        tcs.trySetResult(null);
                    } else {
                        tcs.trySetResult(ds[System.Array.index(0, ds)]);
                    }
                });
                return tcs.task;
            },
            LockUpdate: function () {
                var generalRule = System.Linq.Enumerable.from(this.Feature.FeaturePolicy, Core.Models.FeaturePolicy).where(function (x) {
                        return Core.Extensions.StringExt.IsNullOrEmpty(x.RecordId);
                    }).ToArray(Core.Models.FeaturePolicy);
                if (!this.Feature.IsPublic && (System.Linq.Enumerable.from(generalRule, Core.Models.FeaturePolicy).all(function (x) {
                        return !x.CanWrite;
                    }) || !Core.Extensions.Utils.IsOwner(this.Entity) && System.Linq.Enumerable.from(generalRule, Core.Models.FeaturePolicy).all(function (x) {
                        return !x.CanWriteAll;
                    }))) {
                    this.LockUpdateButCancel();
                }
            },
            LockUpdateButCancel: function () {
                this.Disabled = true;
                Core.Components.Extensions.ComponentExt.SetDisabled$1(this, false, [Core.Components.Forms.EditForm.BtnCancel, Core.Components.Forms.EditForm.BtnPrint]);
            },
            SetFeatureProperties: function (feature) {
                if (feature == null) {
                    return;
                }

                this.Feature = feature;
                Core.Extensions.HtmlElementExtension.AddClass(this.Element, feature.ClassName);
                Core.MVVM.Html.Take(this.Element).Style$1(feature.Style);
                if (Core.Extensions.StringExt.IsNullOrEmpty(this.Icon)) {
                    this.Icon = feature.Icon;
                }
                if (Core.Extensions.StringExt.IsNullOrEmpty(this.Title)) {
                    this.Title = feature.Label;
                }
            },
            SetFeatureStyleSheet: function (styleSheet) {
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(styleSheet)) {
                    return;
                }
                var style = Bridge.as(document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.style)), HTMLStyleElement);
                style.appendChild(document.createTextNode(styleSheet));
                style.setAttribute("source", "feature");
                this.Element.appendChild(style);
            },
            RenderTabOrSection: function (componentGroup) {
                var $t;
                $t = Bridge.getEnumerator(System.Linq.Enumerable.from(componentGroup, Core.Models.ComponentGroup).orderBy(function (x) {
                        return x.Order;
                    }));
                try {
                    while ($t.moveNext()) {
                        var group = $t.Current;
                        group.Disabled = this.Disabled || group.Disabled;
                        if (group.IsTab) {
                            Core.Components.Section.RenderTabGroup(this, group);
                        } else {
                            Core.Components.Section.RenderSection(this, group);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            GetInnerColumn: function (group) {
                var $t, $t1;
                if (group == null) {
                    return 0;
                }

                var screenWidth = this.Element.clientWidth;
                var res;
                if (screenWidth < Core.Components.EditableComponent.ExSmallScreen && System.Nullable.gt(group.XsCol, 0)) {
                    res = group.XsCol;
                } else if (screenWidth < Core.Components.EditableComponent.SmallScreen && System.Nullable.gt(group.SmCol, 0)) {
                    res = group.SmCol;
                } else if (screenWidth < Core.Components.EditableComponent.MediumScreen && System.Nullable.gt(group.Column, 0)) {
                    res = group.Column;
                } else if (screenWidth < Core.Components.EditableComponent.LargeScreen && System.Nullable.gt(group.LgCol, 0)) {
                    res = group.LgCol;
                } else if (screenWidth < Core.Components.EditableComponent.ExLargeScreen && System.Nullable.gt(group.XlCol, 0)) {
                    res = group.XlCol;
                } else {
                    res = ($t = group.XxlCol, $t != null ? $t : group.Column);
                }

                return ($t1 = res, $t1 != null ? $t1 : 0);
            },
            GetOuterColumn: function (group) {
                var $t, $t1;
                var screenWidth = this.Element.clientWidth;
                var res;
                if (screenWidth < Core.Components.EditableComponent.ExSmallScreen && System.Nullable.gt(group.XsOuterColumn, 0)) {
                    res = group.XsOuterColumn;
                } else if (screenWidth < Core.Components.EditableComponent.SmallScreen && System.Nullable.gt(group.SmOuterColumn, 0)) {
                    res = group.SmOuterColumn;
                } else if (screenWidth < Core.Components.EditableComponent.MediumScreen && System.Nullable.gt(group.OuterColumn, 0)) {
                    res = group.OuterColumn;
                } else if (screenWidth < Core.Components.EditableComponent.LargeScreen && System.Nullable.gt(group.LgOuterColumn, 0)) {
                    res = group.LgOuterColumn;
                } else if (screenWidth < Core.Components.EditableComponent.ExLargeScreen && System.Nullable.gt(group.XlOuterColumn, 0)) {
                    res = group.XlOuterColumn;
                } else {
                    res = ($t = group.XxlOuterColumn, $t != null ? $t : group.OuterColumn);
                }

                return ($t1 = res, $t1 != null ? $t1 : 0);
            },
            SysConfigMenu: function (e, component, group) {
                if (!Core.Clients.Client.SystemRole) {
                    return;
                }
                var menuItems = Bridge.fn.bind(this, function (_o1) {
                        var $t;
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fas fa-link mt-2", $t.Text = "Add Link", $t.Click = Bridge.fn.cacheBind(this, this.AddComponent), $t.Parameter = new $asm.$AnonymousType$4(group, "AddLink"), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fas fa-plus-circle mt-2", $t.Text = "Add Input", $t.Click = Bridge.fn.cacheBind(this, this.AddComponent), $t.Parameter = new $asm.$AnonymousType$4(group, "AddInput"), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fas fa-plus-circle mt-2", $t.Text = "Add Timepicker", $t.Click = Bridge.fn.cacheBind(this, this.AddComponent), $t.Parameter = new $asm.$AnonymousType$4(group, "AddTimepicker"), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fas fa-lock mt-2", $t.Text = "Add Password", $t.Click = Bridge.fn.cacheBind(this, this.AddComponent), $t.Parameter = new $asm.$AnonymousType$4(group, "AddPassword"), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fas fa-plus-circle mt-2", $t.Text = "Add Label", $t.Click = Bridge.fn.cacheBind(this, this.AddComponent), $t.Parameter = new $asm.$AnonymousType$4(group, "AddLabel"), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fas fa-plus-circle mt-2", $t.Text = "Add Textarea", $t.Click = Bridge.fn.cacheBind(this, this.AddComponent), $t.Parameter = new $asm.$AnonymousType$4(group, "AddTextarea"), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fas fa-plus-circle mt-2", $t.Text = "Add Dropdown", $t.Click = Bridge.fn.cacheBind(this, this.AddComponent), $t.Parameter = new $asm.$AnonymousType$4(group, "AddDropdown"), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fas fa-images mt-2", $t.Text = "Add Image", $t.Click = Bridge.fn.cacheBind(this, this.AddComponent), $t.Parameter = new $asm.$AnonymousType$4(group, "AddImage"), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fas fa-plus-circle mt-2", $t.Text = "Add GridView", $t.Click = Bridge.fn.cacheBind(this, this.AddComponent), $t.Parameter = new $asm.$AnonymousType$4(group, "AddGridView"), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fas fa-plus-circle mt-2", $t.Text = "Add ListView", $t.Click = Bridge.fn.cacheBind(this, this.AddComponent), $t.Parameter = new $asm.$AnonymousType$4(group, "AddListView"), $t));
                        return _o1;
                    })(new (System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem)).ctor());
                e.preventDefault();
                e.stopPropagation();
                var ctxMenu = Core.Components.Forms.ContextMenu.Instance;
                ctxMenu.Top = Core.Extensions.EventExt.Top(e);
                ctxMenu.Left = Core.Extensions.EventExt.Left(e);
                ctxMenu.MenuItems = Bridge.fn.bind(this, function (_o2) {
                        var $t;
                        _o2.add(component == null ? null : ($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-cog", $t.Text = "T\u00f9y ch\u1ecdn d\u1eef li\u1ec7u", $t.Click = Bridge.fn.cacheBind(this, this.ComponentProperties), $t.Parameter = component, $t));
                        _o2.add(component == null ? null : ($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-clone", $t.Text = "Sao ch\u00e9p", $t.Click = Bridge.fn.cacheBind(this, this.CopyComponent), $t.Parameter = component, $t));
                        _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-cogs", $t.Text = "Th\u00eam Component", $t.MenuItems = menuItems, $t));
                        _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-cogs", $t.Text = "T\u00f9y ch\u1ecdn v\u00f9ng d\u1eef li\u1ec7u", $t.Click = Bridge.fn.cacheBind(this, this.SectionProperties), $t.Parameter = group, $t));
                        _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-folder-open", $t.Text = "Thi\u1ebft l\u1eadp chung", $t.Click = Bridge.fn.cacheBind(this, this.FeatureProperties), $t));
                        _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-clone", $t.Text = "Clone feature", $t.Click = Bridge.fn.cacheBind(this, this.CloneFeature), $t.Parameter = this.Feature, $t));
                        return _o2;
                    })(new (System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem)).ctor());
                ctxMenu.Render();
            },
            CloneFeature: function (ev) {
                var $t;
                var feature = Bridge.as(ev, Core.Models.Feature);
                var confirmDialog = ($t = new Core.Components.Forms.ConfirmDialog(), $t.Content = "B\u1ea1n c\u00f3 mu\u1ed1n clone feature n\u00e0y?", $t.Title = "X\u00e1c nh\u1eadn", $t);
                confirmDialog.YesConfirmed = Bridge.fn.combine(confirmDialog.YesConfirmed, function () {
                    var $t1;
                    var sql = ($t1 = new Core.ViewModels.SqlViewModel(), $t1.ComId = "Feature", $t1.Action = "Clone", $t1.Ids = System.Array.init([feature.Id], System.String), $t1);
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Clients.Client.Instance.SubmitAsync(System.Boolean, ($t1 = new Core.Clients.XHRWrapper(), $t1.IsRawString = true, $t1.Url = Core.Extensions.Utils.UserSvc, $t1.Method = Core.Enums.HttpMethod.POST, $t1.Value = JSON.stringify(sql), $t1)));
                });
                this.AddChild(confirmDialog);
            },
            GetElementPolicies$1: function (recordIds, entityId) {
                if (entityId === void 0) { entityId = "30"; }
                var hasHidden = System.Linq.Enumerable.from(this.Feature.FeaturePolicy, Core.Models.FeaturePolicy).where(function (x) {
                        return Core.Extensions.StringExt.HasAnyChar(x.RoleId) || (Core.Extensions.StringExt.HasAnyChar(x.UserId) && Bridge.referenceEquals(Core.Clients.Client.Token.UserId, x.UserId));
                    }).where(function (x) {
                    return Bridge.referenceEquals(x.EntityId, entityId) && System.Array.contains(recordIds, x.RecordId, System.String);
                }).ToArray(Core.Models.FeaturePolicy);
                return hasHidden;
            },
            GetElementPolicies: function (recordId, entityId) {
                if (entityId === void 0) { entityId = "20"; }
                var hasHidden = System.Linq.Enumerable.from(this.Feature.FeaturePolicy, Core.Models.FeaturePolicy).where(function (x) {
                        return Core.Extensions.StringExt.HasAnyChar(x.RoleId) || (Core.Extensions.StringExt.HasAnyChar(x.UserId) && Bridge.referenceEquals(Core.Clients.Client.Token.UserId, x.UserId));
                    }).where(function (x) {
                    return Bridge.referenceEquals(x.EntityId, entityId) && Bridge.referenceEquals(recordId, x.RecordId);
                }).ToArray(Core.Models.FeaturePolicy);
                return hasHidden;
            },
            GetGridPolicies$1: function (recordIds, entityId) {
                if (entityId === void 0) { entityId = "30"; }
                var hasHidden = System.Linq.Enumerable.from(this.Feature.FeaturePolicy, Core.Models.FeaturePolicy).where(function (x) {
                        return Core.Extensions.StringExt.HasAnyChar(x.RoleId) || (Core.Extensions.StringExt.HasAnyChar(x.UserId) && Bridge.referenceEquals(Core.Clients.Client.Token.UserId, x.UserId));
                    }).where(function (x) {
                    return Bridge.referenceEquals(x.EntityId, entityId) && System.Array.contains(recordIds, x.RecordId, System.String);
                }).ToArray(Core.Models.FeaturePolicy);
                return hasHidden;
            },
            GetGridPolicies: function (recordId, entityId) {
                if (entityId === void 0) { entityId = "20"; }
                var hasHidden = System.Linq.Enumerable.from(this.Feature.FeaturePolicy, Core.Models.FeaturePolicy).where(function (x) {
                        return Core.Extensions.StringExt.HasAnyChar(x.RoleId) || (Core.Extensions.StringExt.HasAnyChar(x.UserId) && Bridge.referenceEquals(Core.Clients.Client.Token.UserId, x.UserId));
                    }).where(function (x) {
                    return Bridge.referenceEquals(x.EntityId, entityId) && Bridge.referenceEquals(recordId, x.RecordId);
                }).ToArray(Core.Models.FeaturePolicy);
                return hasHidden;
            },
            ComponentProperties: function (arg) {
                var $t;
                var editor = ($t = new Core.Components.Framework.ComponentBL(), $t.Entity = arg, $t.ParentElement = this.Element, $t.OpenFrom = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, this), $t);
                this.AddChild(editor);
            },
            CopyComponent: function (arg) {
                var component = Core.Extensions.BridgeExt.CastProp(Core.Models.Component, arg);
                this._componentCoppy = component;
            },
            AddComponent: function (arg) {
                var $t;
                var action = Bridge.as(arg.action, System.String);
                var componentGroup = Core.Extensions.BridgeExt.CastProp(Core.Models.ComponentGroup, arg.group);
                var com = new Core.Models.Component();
                var childComponent = System.Linq.Enumerable.from(this.Feature.ComponentGroup, Core.Models.ComponentGroup).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.Id, componentGroup.Id);
                    }, null);
                var lastOrder = System.Linq.Enumerable.from(childComponent.Component, Core.Models.Component).nullableMax(function (x) {
                        return x.Order;
                    });

                switch (action) {
                    case "AddLink": 
                        com.ComponentType = "Link";
                        break;
                    case "AddInput": 
                        com.ComponentType = "Input";
                        break;
                    case "AddTimepicker": 
                        com.ComponentType = "Timepicker";
                        break;
                    case "AddPassword": 
                        com.ComponentType = "Password";
                        break;
                    case "AddTextarea": 
                        com.ComponentType = "Textarea";
                        break;
                    case "AddDropdown": 
                        com.ComponentType = "SearchEntry";
                        break;
                    case "AddImage": 
                        com.ComponentType = "Image";
                        break;
                    case "AddGridView": 
                        com.ComponentType = "GridView";
                        break;
                    case "AddListView": 
                        com.ComponentType = "ListView";
                        break;
                    case "AddLabel": 
                        com.ComponentType = "Label";
                        com.Visibility = true;
                        com.Order = lastOrder;
                        com.ComponentGroupId = componentGroup.Id;
                        com.FieldName = "";
                        com.ShowLabel = true;
                        var confirm = ($t = new Core.Components.Forms.ConfirmDialog(), $t.NeedAnswer = true, $t.ComType = "Textbox", $t.Content = "H\u00e3y nh\u1eadp label?", $t);
                        confirm.Render();
                        confirm.YesConfirmed = Bridge.fn.combine(confirm.YesConfirmed, Bridge.fn.bind(this, function () {
                            var $t1;
                            com.Label = ($t1 = confirm.Textbox) != null ? $t1.Text : null;
                            this.SaveNewComponent(componentGroup, com);
                        }));
                        return;
                }
                com.Id = Core.Structs.Uuid7.Id25();
                com.Visibility = true;
                com.Label = "";
                com.ComponentGroupId = componentGroup.Id;
                com.Order = lastOrder;
                com.FieldName = "";
                this.SaveNewComponent(componentGroup, com);
            },
            SaveNewComponent: function (componentGroup, com) {
                Core.Extensions.EventExt.Done$1(System.Int32, Core.Clients.Client.Instance.PatchAsync(Core.Components.Extensions.ComponentExt.MapToPatch(Core.Models.Component, com)), Bridge.fn.bind(this, function (x) {
                    this.UpdateRender(com, componentGroup);
                    Core.Extensions.Toast.Success("T\u1ea1o th\u00e0nh c\u00f4ng!");
                }));
            },
            UpdateRender: function (component, componentGroup) {
                var section = Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section, this, componentGroup.Name);
                var childComponent = Core.Components.Extensions.ComponentFactory.GetComponent(component, this.EditForm);
                childComponent.ParentElement = section.Element;
                section.AddChild(childComponent);
            },
            SectionProperties: function (arg) {
                var $t;
                var group = Core.Extensions.BridgeExt.CastProp(Core.Models.ComponentGroup, arg);
                group.InverseParent = null;
                var editor = ($t = new Core.Components.Framework.ComponentGroupBL(), $t.Entity = group, $t.ParentElement = this.Element, $t.OpenFrom = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, this), $t);
                this.AddChild(editor);
            },
            FeatureProperties: function (arg) {
                var $t;
                var editor = ($t = new Core.Components.Framework.FeatureDetailBL(), $t.Entity = this.Feature, $t.ParentElement = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, this).Element, $t.OpenFrom = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, this), $t);
                this.AddChild(editor);
            },
            SecurityRecord: function (arg) {
                var $t;
                var security = ($t = new Core.Components.SecurityBL(), $t.Entity = arg, $t.ParentElement = this.Element, $t);
                this.TabEditor.AddChild(security);
            },
            Cancel: function () {
                this.DirtyCheckAndCancel();
            },
            CancelWithoutAsk: function () {
                this.Dispose();
            },
            Dispose: function () {
                window.removeEventListener("resize", Bridge.fn.cacheBind(this, this.ResizeHandler));
                Core.Components.EditableComponent.prototype.Dispose.call(this);
            },
            DirtyCheckAndCancel: function () {
                this.DirtyCheckAndCancel$1(null);
            },
            DirtyCheckAndCancel$1: function (closeCallback) {
                var $t;
                if (!this.Dirty) {
                    this.Dispose();
                    return;
                }
                this._confirm = ($t = new Core.Components.Forms.ConfirmDialog(), $t.Content = "B\u1ea1n c\u00f3 mu\u1ed1n l\u01b0u d\u1eef li\u1ec7u tr\u01b0\u1edbc khi \u0111\u00f3ng?", $t.OpenEditForm = this, $t);
                this._confirm.YesConfirmed = Bridge.fn.combine(this._confirm.YesConfirmed, Bridge.fn.bind(this, function () {
                    Core.Extensions.EventExt.Done$1(System.Boolean, this._confirm.OpenEditForm.SavePatch(), Bridge.fn.bind(this, function (success) {
                        if (!success) {
                            Core.Extensions.Toast.Warning("Update data failed");
                            return;
                        }
                        this._confirm.OpenEditForm.Dispose();
                        this._confirm.Dispose();
                    }));
                }));
                this._confirm.NoConfirmed = Bridge.fn.combine(this._confirm.NoConfirmed, Bridge.fn.bind(this, function () {
                    this._confirm.OpenEditForm.Dispose();
                    this._confirm.Dispose();
                }));
                this._confirm.IgnoreCancelButton = true;
                this._confirm.Render();
            },
            EmailPdf: function (email, pdfSelector) {
                if (pdfSelector === void 0) { pdfSelector = []; }
                if (email == null) {
                    throw new System.ArgumentNullException.$ctor1("email");
                }
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                if (Core.Extensions.IEnumerableExtensions.HasElement(System.String, pdfSelector)) {
                    var pdfText = System.Linq.Enumerable.from(pdfSelector, System.String).select(Bridge.fn.bind(this, function (x) {
                            var ele = Bridge.as(this.Element.querySelector(x), HTMLElement);
                            return this.PrintSection(ele, false);
                        }));
                    email.PdfText.AddRange(pdfText);
                }
                Core.Extensions.EventExt.Catch(Core.Extensions.EventExt.Done$1(System.Boolean, Core.Clients.Client.Instance.PostAsync(System.Boolean, email, "/user/EmailAttached", false, true), function (sucess) {
                    Core.Extensions.Toast.Success("Send email success!");
                    tcs.trySetResult(sucess);
                }), function (e) {
                    Core.Extensions.Toast.Success("Error occurs while sending email!");
                    tcs.trySetException(e);
                });
                return tcs.task;
            },
            Print: function (selector) {
                if (selector === void 0) { selector = ".printable"; }
                var printable = Bridge.as(this.Element.querySelector(selector), HTMLElement);
                this.PrintSection(printable);
            },
            PrintSection: function (ele, openWindow, styles, printPreview, component) {
                if (openWindow === void 0) { openWindow = true; }
                if (styles === void 0) { styles = null; }
                if (printPreview === void 0) { printPreview = false; }
                if (component === void 0) { component = null; }
                if (ele == null) {
                    return null;
                }
                if (!openWindow) {
                    return ele.innerHTML;
                }
                var printWindow = window.open("", "_blank");
                printWindow.document.body.innerHTML = ele.innerHTML;
                printWindow.document.close();
                if (printPreview) {
                    window.setTimeout(Bridge.fn.bind(this, function () {
                        printWindow.addEventListener("beforeprint", function (e) {
                            var pageStyle = printWindow.document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.style));
                            pageStyle.innerHTML = component.Style;
                            printWindow.document.head.appendChild(pageStyle);
                        });
                        printWindow.print();
                        printWindow.addEventListener("afterprint", Bridge.fn.bind(this, function (e) {
                            var $step = 0,
                                $task1, 
                                $taskResult1, 
                                $jumpFromFinally, 
                                $asyncBody = Bridge.fn.bind(this, function () {
                                    for (;;) {
                                        $step = System.Array.min([0,1], $step);
                                        switch ($step) {
                                            case 0: {
                                                $task1 = Core.Components.Extensions.ComponentExt.DispatchEvent(this, component.Events, "afterprint", [this]);
                                                $step = 1;
                                                if ($task1.isCompleted()) {
                                                    continue;
                                                }
                                                $task1.continue($asyncBody);
                                                return;
                                            }
                                            case 1: {
                                                $taskResult1 = $task1.getAwaitedResult();
                                                return;
                                            }
                                            default: {
                                                return;
                                            }
                                        }
                                    }
                                }, arguments);

                            $asyncBody();
                        }));
                        printWindow.addEventListener("mousemove", function (e) {
                            printWindow.close();
                        });
                        printWindow.addEventListener("click", function (e) {
                            printWindow.close();
                        });
                        printWindow.addEventListener("keyup", function (e) {
                            printWindow.close();
                        });
                    }), 250);
                }
                return ele.innerHTML;
            },
            Focus: function () {
                var ele = Core.Components.Extensions.ComponentExt.FirstOrDefault(this, function (x) {
                    return x.GuiInfo != null && x.GuiInfo.Focus;
                });
                if (ele == null) {
                    this.Element.focus();
                } else {
                    ele.Focus();
                }
                this.ResizeHandler();
            },
            UpdateViewByName: function (fieldNames) {
                if (fieldNames === void 0) { fieldNames = []; }
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, fieldNames)) {
                    return;
                }

                this.FilterChildren$1(function (x) {
                    if (System.Array.contains(fieldNames, x.Name, System.String)) {
                        x.UpdateView();
                    }

                    return false;
                });
            },
            ResizeHandler: function () {
                this.ResizeTabGroup();
                this.ResizeListView();
            },
            ResizeListView: function () {
                var visibleListView = System.Linq.Enumerable.from(this.ListViews, Core.Components.ListView).firstOrDefault(function (x) {
                        return !Core.Extensions.HtmlElementExtension.Hidden(x.Element);
                    }, null);
                if (visibleListView == null) {
                    return;
                }

                var allListView = System.Linq.Enumerable.from(visibleListView.Parent.Children, Core.Components.EditableComponent).where(function (x) {
                        return Bridge.Reflection.isAssignableFrom(Core.Components.ListView, Bridge.getType(x));
                    });
                var responsive = allListView.any(function (x) {
                    return System.String.contains(x.Name,"Mobile");
                });
                allListView.forEach(Bridge.fn.bind(this, function (x) {
                    if (responsive) {
                        x.Show = Core.Components.EditableComponent.IsSmallUp ? !System.String.contains(x.Name,"Mobile") : System.String.contains(x.Name,"Mobile");
                        if (x.Show) {
                            this._currentListView = Bridge.as(x, Core.Components.ListView);
                        }
                    } else {
                        this._currentListView = Bridge.as(x, Core.Components.ListView);
                    }
                }));
            },
            ResizeTabGroup: function () {
                if (this.Element != null && Core.Extensions.HtmlElementExtension.HasClass(this.Element, "mobile") || Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.Forms.TabGroup, this.TabGroup)) {
                    return;
                }

                this.TabGroup.ForEach(function (tg) {
                    if (tg == null || tg.Element == null) {
                        return;
                    }

                    if (Core.Components.EditableComponent.IsLargeUp && tg.ComponentGroup.Responsive && Core.Extensions.HtmlElementExtension.HasClass(tg.Element.parentElement, "tab-horizontal")) {
                        Core.Extensions.HtmlElementExtension.ReplaceClass(tg.Element.parentElement, "tab-horizontal", "tab-vertical");
                    } else if (!Core.Components.EditableComponent.IsLargeUp && tg.ComponentGroup.Responsive && Core.Extensions.HtmlElementExtension.HasClass(tg.Element.parentElement, "tab-vertical")) {
                        Core.Extensions.HtmlElementExtension.ReplaceClass(tg.Element.parentElement, "tab-vertical", "tab-horizontal");
                    }
                });
            },
            Delete: function () {
                var $t;
                var confirm = ($t = new Core.Components.Forms.ConfirmDialog(), $t.Content = "B\u1ea1n c\u00f3 ch\u1eafc ch\u1eafn x\u00f3a kh\u00f4ng?", $t);
                confirm.Render();
                confirm.YesConfirmed = Bridge.fn.combine(confirm.YesConfirmed, Bridge.fn.bind(this, function () {
                    Core.Extensions.EventExt.Done$1(System.Array.type(System.String), Core.Clients.Client.Instance.HardDeleteAsync(System.Array.init([this.EntityId], System.String), this.Feature.EntityName, this.Feature.ConnKey), Bridge.fn.bind(this, function (ids) {
                        if (Core.Extensions.IEnumerableExtensions.HasElement(System.String, ids)) {
                            Core.Extensions.Toast.Success("Delete data succeeded");
                            this.ParentForm.UpdateView$1(true);
                            this.Dispose();
                        } else {
                            Core.Extensions.Toast.Warning("An error occurs while deleting data");
                        }
                    }));
                }));
            },
            SignIn: function () {
                !Bridge.staticEquals(Core.Clients.Client.UnAuthorizedEventHandler, null) ? Core.Clients.Client.UnAuthorizedEventHandler(null) : null;
            },
            SignOut: function () {
                var e = Bridge.as(window.event, Event);
                e.preventDefault();
                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Clients.Client.Instance.PostAsync(System.Boolean, Core.Clients.Client.Token, "user/SignOut"), function (success) {
                    Core.Extensions.Toast.Success("B\u1ea1n \u0111\u00e3 \u0111\u0103ng xu\u1ea5t!", 3000);
                    !Bridge.staticEquals(Core.Clients.Client.SignOutEventHandler, null) ? Core.Clients.Client.SignOutEventHandler() : null;
                    Core.Clients.Client.Token = null;
                    Core.Components.Forms.EditForm.NotificationClient != null ? Core.Components.Forms.EditForm.NotificationClient.Close() : null;
                    window.location.reload();
                });
            }
        }
    });

    Bridge.define("$AnonymousType$3", $asm, {
    $kind: "anonymous",
    ctors: {
        ctor: function (id) {
            this.id = id;
        }
    },
    methods: {
        equals: function (o) {
            if (!Bridge.is(o, $asm.$AnonymousType$3)) {
                return false;
            }
            return Bridge.equals(this.id, o.id);
        },
        getHashCode: function () {
            var h = Bridge.addHash([7550196188, this.id]);
            return h;
        },
        toJSON: function () {
            return {
                id : this.id
            };
        }
    },
    statics : {
        methods: {
            $metadata : function () { return {"m":[{"a":2,"n":"id","t":16,"rt":System.String,"g":{"a":2,"n":"get_id","t":8,"rt":System.String,"fg":"id"},"fn":"id"}]}; }
        }
    }
});

    Bridge.define("$AnonymousType$4", $asm, {
        $kind: "anonymous",
        ctors: {
            ctor: function (group, action) {
                this.group = group;
                this.action = action;
            }
        },
        methods: {
            equals: function (o) {
                if (!Bridge.is(o, $asm.$AnonymousType$4)) {
                    return false;
                }
                return Bridge.equals(this.group, o.group) && Bridge.equals(this.action, o.action);
            },
            getHashCode: function () {
                var h = Bridge.addHash([7550196189, this.group, this.action]);
                return h;
            },
            toJSON: function () {
                return {
                    group : this.group,
                    action : this.action
                };
            }
        },
        statics : {
            methods: {
                $metadata : function () { return {"m":[{"a":2,"n":"action","t":16,"rt":System.String,"g":{"a":2,"n":"get_action","t":8,"rt":System.String,"fg":"action"},"fn":"action"},{"a":2,"n":"group","t":16,"rt":Core.Models.ComponentGroup,"g":{"a":2,"n":"get_group","t":8,"rt":Core.Models.ComponentGroup,"fg":"group"},"fn":"group"}]}; }
            }
        }
    });

    Bridge.define("Core.Components.BarCode", {
        inherits: [Core.Components.EditableComponent],
        props: {
            Value: null
        },
        ctors: {
            ctor: function (ui, ele) {
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.ParentElement = ele;
                this.GuiInfo = ui || (function () {
                    throw new System.ArgumentNullException.$ctor1("ui");
                })();
            }
        },
        methods: {
            Render: function () {
                var $t;
                Core.MVVM.Html.Take(this.ParentElement).Clear().Div.Style$1(System.String.format("width:{0}px;margin:auto", [this.GuiInfo.Width])).Id("barcode" + (this.GuiInfo.Id || ""));
                this.Element = Core.MVVM.Html.Context;
                this.Value = ($t = Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName)) != null ? Bridge.toString($t) : null;
                System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Clients.Client.LoadScript("/js/qrcode.min.js");
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            new QRCode("barcode"+this.GuiInfo.Id, {
                                                text: value,
                                                width: this.GuiInfo.Width,
                                                height: this.GuiInfo.Width,
                                                colorDark : "#000000",
                                                colorLight : "#ffffff",
                                            });
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                }));
            },
            UpdateView: function (force, dirty, componentNames) {
                var $t;
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                var value = ($t = Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName)) != null ? Bridge.toString($t) : null;
                if (Bridge.referenceEquals(value, this.Value)) {
                    return;
                }
                this.Render();
            }
        }
    });

    Bridge.define("Core.Components.Button", {
        inherits: [Core.Components.EditableComponent],
        fields: {
            _textEle: null
        },
        props: {
            ButtonEle: null
        },
        ctors: {
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.GuiInfo = ui || (function () {
                    throw new System.ArgumentNullException.$ctor1("ui");
                })();
                this.ButtonEle = ele;
            }
        },
        methods: {
            Render: function () {
                var $t, $t1, $t2, $t3;
                var html = Core.MVVM.Html.Instance;
                if (this.ButtonEle == null) {
                    Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Button, "btn" + (this.GuiInfo.Id || "")).Render();
                    this.Element = ($t = Core.MVVM.Html.Context, this.ButtonEle = $t, $t);
                } else {
                    this.Element = this.ButtonEle;
                }
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element), this.GuiInfo.ClassName).Event("click", Bridge.fn.cacheBind(this, this.DispatchClick)).Style$1(this.GuiInfo.Style);
                if (!System.String.isNullOrEmpty(this.GuiInfo.Icon)) {
                    Core.Components.Renderer.Icon(html, this.GuiInfo.Icon).End.Text(" ").Render();
                }
                Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(html.Span, "caption"), ($t1 = this.GuiInfo.Label, $t1 != null ? $t1 : ""));
                this._textEle = Bridge.as(Core.MVVM.Html.Context, HTMLSpanElement);
                ($t2 = Core.Extensions.HtmlElementExtension.Closest(this.Element, "td")) != null ? $t2.addEventListener("keydown", Bridge.fn.cacheBind(this, this.ListViewItemTab)) : null;
                !Bridge.staticEquals(($t3 = this.DOMContentLoaded), null) ? $t3() : null;
            },
            DispatchClick: function () {
                if (this.Disabled || Core.Extensions.HtmlElementExtension.Hidden(this.Element)) {
                    return;
                }
                this.Disabled = true;
                try {
                    Core.Components.Spinner.AppendTo(this.Element);
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "click", [this.Entity, this]));
                } finally {
                    Core.Components.Spinner.Hide();
                    this.Disabled = false;
                }
            },
            GetValueText: function () {
                var $t;
                if (this.Entity == null || this.GuiInfo == null) {
                    return this._textEle.textContent;
                }
                return ($t = this.Entity[this.FieldName]) != null ? Bridge.toString($t) : null;
            }
        }
    });

    Bridge.define("Core.Components.Chart", {
        inherits: [Core.Components.EditableComponent],
        props: {
            Data: null
        },
        ctors: {
            ctor: function (ui) {
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.GuiInfo = ui || (function () {
                    throw new System.ArgumentNullException.$ctor1("ui");
                })();
            }
        },
        methods: {
            Render: function () {
                this.AddElement();
                System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $task2, 
                        $task3, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1,2,3], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Clients.Client.LoadScript("/js/canvasjs.min.js");
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            $task2 = System.Threading.Tasks.Task.delay(1000);
                                            $step = 2;
                                            if ($task2.isCompleted()) {
                                                continue;
                                            }
                                            $task2.continue($asyncBody);
                                            return;
                                        }
                                        case 2: {
                                            $task2.getAwaitedResult();
                                            $task3 = this.RenderAsync();
                                            $step = 3;
                                            if ($task3.isCompleted()) {
                                                continue;
                                            }
                                            $task3.continue($asyncBody);
                                            return;
                                        }
                                        case 3: {
                                            $task3.getAwaitedResult();
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                }));
            },
            AddElement: function () {
                if (this.Element != null) {
                    return;
                }
                this.Element = Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Div, "chart-wrapper").GetContext();
            },
            RenderAsync: function () {
                var $step = 0,
                    $task1, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    $t, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        $task1 = this.RenderChart();
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $task1.getAwaitedResult();
                                        !Bridge.staticEquals(($t = this.DOMContentLoaded), null) ? $t() : null;
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            RenderChart: function () {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    fn, 
                    isFn, 
                    dataSourceFilter, 
                    _preQuery, 
                    isPreQueryFn, 
                    submitEntity, 
                    entity, 
                    $t, 
                    type, 
                    text, 
                    options, 
                    $function, 
                    isFotmatDataFn, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3], $step);
                                switch ($step) {
                                    case 0: {
                                        this.AddElement();
                                        fn = { };
                                        isFn = Core.Extensions.Utils.IsFunction(this.GuiInfo.Query, fn);
                                        dataSourceFilter = isFn ? Bridge.toString(fn.v.call(this, Bridge.unbox(this.Entity), this)) : Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.Query, this.Entity);
                                        if (this.Data == null) {
                                            $step = 1;
                                            continue;
                                        } 
                                        $step = 3;
                                        continue;
                                    }
                                    case 1: {
                                        _preQuery = { };
                                        isPreQueryFn = Core.Extensions.Utils.IsFunction(this.GuiInfo.PreQuery, _preQuery);
                                        submitEntity = isPreQueryFn ? _preQuery.v.call(null, this) : null;
                                        entity = JSON.stringify(($t = new Core.ViewModels.SqlViewModel(), $t.Params = isPreQueryFn ? JSON.stringify(Bridge.unbox(submitEntity)) : null, $t.ComId = this.GuiInfo.Id, $t));
                                        $task1 = Core.Clients.Client.Instance.SubmitAsync(System.Array.type(System.Object), ($t = new Core.Clients.XHRWrapper(), $t.Url = Core.Extensions.Utils.ComQuery, $t.IsRawString = true, $t.Value = entity, $t.Method = Core.Enums.HttpMethod.POST, $t));
                                        $step = 2;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 2: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        this.Data = $taskResult1;
                                        $step = 3;
                                        continue;
                                    }
                                    case 3: {
                                        type = ($t = this.GuiInfo.ClassName, $t != null ? $t : "pie");
                                        text = this.GuiInfo.PlainText;
                                        options = null;
                                        if (Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.FormatData)) {
                                            options = {
                                                theme: "light2",
                                                animationEnabled: true,
                                                showInLegend: "true",
                                            		            legendText: "{name}",
                                                title: {
                                                    text: text,
                                                    fontFamily: "roboto",
                                                    fontSize: 15
                                                },
                                                data: [{
                                                    type: type,
                                                    toolTipContent: "{label} {y}",
                                                    dataPoints: this.Data
                                                }],
                                                legend: {
                                                    cursor:"pointer",
                                                    fontSize: 9,
                                                    fontFamily: "roboto",
                                                }
                                            };
                                        } else {
                                            options = JSON.parse(this.GuiInfo.FormatData);
                                        }
                                        $function = { };
                                        isFotmatDataFn = Core.Extensions.Utils.IsFunction(this.GuiInfo.FormatEntity, $function);
                                        if (!isFotmatDataFn && !Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.GroupBy)) {
                                            options.data = System.Linq.Enumerable.from(this.Data, System.Object).select(function (data) {
                                                var $t1;
                                                data.type = ($t1 = data.type, $t1 != null ? $t1 : type);
                                                return data;
                                            }).groupBy(function (x) {
                                                var $t1, $t2;
                                                return new $asm.$AnonymousType$5(Bridge.toString(x.type), ($t1 = x.name) != null ? Bridge.toString($t1) : null, ($t2 = x.axisYType) != null ? Bridge.toString($t2) : null);
                                            }).select(function (x) {
                                                return new $asm.$AnonymousType$6(x.key().type, x.firstOrDefault(null, null).toolTipContent, x.key().axisYType, x.ToArray(System.Object));
                                            }).ToArray(System.Object);
                                        } else if (isFotmatDataFn) {
                                            options.data = $function.v.call.apply($function.v, [this].concat(Bridge.unbox(this.Data)));
                                        } else {
                                            options.data = System.Array.init([new $asm.$AnonymousType$7(type, "{label} {y}", this.Data)], System.Object);
                                        }
                                        var chart = new CanvasJS.Chart(this.Element, options);
                                        chart.render();
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            UpdateView: function (force, dirty, componentNames) {
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                if (force) {
                    this.Data = null;
                }
                if (this.Element != null) {
                    this.Element.innerHTML = null;
                }
                System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this, this.RenderChart));
            }
        }
    });

    Bridge.define("$AnonymousType$5", $asm, {
    $kind: "anonymous",
    ctors: {
        ctor: function (type, name, axisYType) {
            this.type = type;
            this.name = name;
            this.axisYType = axisYType;
        }
    },
    methods: {
        equals: function (o) {
            if (!Bridge.is(o, $asm.$AnonymousType$5)) {
                return false;
            }
            return Bridge.equals(this.type, o.type) && Bridge.equals(this.name, o.name) && Bridge.equals(this.axisYType, o.axisYType);
        },
        getHashCode: function () {
            var h = Bridge.addHash([7550196190, this.type, this.name, this.axisYType]);
            return h;
        },
        toJSON: function () {
            return {
                type : this.type,
                name : this.name,
                axisYType : this.axisYType
            };
        }
    },
    statics : {
        methods: {
            $metadata : function () { return {"m":[{"a":2,"n":"axisYType","t":16,"rt":System.String,"g":{"a":2,"n":"get_axisYType","t":8,"rt":System.String,"fg":"axisYType"},"fn":"axisYType"},{"a":2,"n":"name","t":16,"rt":System.String,"g":{"a":2,"n":"get_name","t":8,"rt":System.String,"fg":"name"},"fn":"name"},{"a":2,"n":"type","t":16,"rt":System.String,"g":{"a":2,"n":"get_type","t":8,"rt":System.String,"fg":"type"},"fn":"type"}]}; }
        }
    }
});

    Bridge.define("$AnonymousType$6", $asm, {
    $kind: "anonymous",
    ctors: {
        ctor: function (type, toolTipContent, axisYType, dataPoints) {
            this.type = type;
            this.toolTipContent = toolTipContent;
            this.axisYType = axisYType;
            this.dataPoints = dataPoints;
        }
    },
    methods: {
        equals: function (o) {
            if (!Bridge.is(o, $asm.$AnonymousType$6)) {
                return false;
            }
            return Bridge.equals(this.type, o.type) && Bridge.equals(this.toolTipContent, o.toolTipContent) && Bridge.equals(this.axisYType, o.axisYType) && Bridge.equals(this.dataPoints, o.dataPoints);
        },
        getHashCode: function () {
            var h = Bridge.addHash([7550196191, this.type, this.toolTipContent, this.axisYType, this.dataPoints]);
            return h;
        },
        toJSON: function () {
            return {
                type : this.type,
                toolTipContent : this.toolTipContent,
                axisYType : this.axisYType,
                dataPoints : this.dataPoints
            };
        }
    },
    statics : {
        methods: {
            $metadata : function () { return {"m":[{"a":2,"n":"axisYType","t":16,"rt":System.String,"g":{"a":2,"n":"get_axisYType","t":8,"rt":System.String,"fg":"axisYType"},"fn":"axisYType"},{"a":2,"n":"dataPoints","t":16,"rt":System.Array.type(System.Object),"g":{"a":2,"n":"get_dataPoints","t":8,"rt":System.Array.type(System.Object),"fg":"dataPoints"},"fn":"dataPoints"},{"a":2,"n":"toolTipContent","t":16,"rt":System.Object,"g":{"a":2,"n":"get_toolTipContent","t":8,"rt":System.Object,"fg":"toolTipContent"},"fn":"toolTipContent"},{"a":2,"n":"type","t":16,"rt":System.String,"g":{"a":2,"n":"get_type","t":8,"rt":System.String,"fg":"type"},"fn":"type"}]}; }
        }
    }
});

    Bridge.define("$AnonymousType$7", $asm, {
    $kind: "anonymous",
    ctors: {
        ctor: function (type, toolTipContent, dataPoints) {
            this.type = type;
            this.toolTipContent = toolTipContent;
            this.dataPoints = dataPoints;
        }
    },
    methods: {
        equals: function (o) {
            if (!Bridge.is(o, $asm.$AnonymousType$7)) {
                return false;
            }
            return Bridge.equals(this.type, o.type) && Bridge.equals(this.toolTipContent, o.toolTipContent) && Bridge.equals(this.dataPoints, o.dataPoints);
        },
        getHashCode: function () {
            var h = Bridge.addHash([7550196192, this.type, this.toolTipContent, this.dataPoints]);
            return h;
        },
        toJSON: function () {
            return {
                type : this.type,
                toolTipContent : this.toolTipContent,
                dataPoints : this.dataPoints
            };
        }
    },
    statics : {
        methods: {
            $metadata : function () { return {"m":[{"a":2,"n":"dataPoints","t":16,"rt":System.Array.type(System.Object),"g":{"a":2,"n":"get_dataPoints","t":8,"rt":System.Array.type(System.Object),"fg":"dataPoints"},"fn":"dataPoints"},{"a":2,"n":"toolTipContent","t":16,"rt":System.String,"g":{"a":2,"n":"get_toolTipContent","t":8,"rt":System.String,"fg":"toolTipContent"},"fn":"toolTipContent"},{"a":2,"n":"type","t":16,"rt":System.String,"g":{"a":2,"n":"get_type","t":8,"rt":System.String,"fg":"type"},"fn":"type"}]}; }
        }
    }
});

    Bridge.define("Core.Components.Checkbox", {
        inherits: [Core.Components.EditableComponent],
        fields: {
            _value: null,
            _input: null
        },
        props: {
            Value: {
                get: function () {
                    return this._value;
                },
                set: function (value) {
                    var $t;
                    this._value = value;
                    this._input.checked = ($t = value, $t != null ? $t : false);
                }
            }
        },
        ctors: {
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.GuiInfo = ui || (function () {
                    throw new System.ArgumentNullException.$ctor1("ui");
                })();
                this.ParentElement = ele;
            }
        },
        methods: {
            Render: function () {
                var $t, $t1, $t2;
                Core.Components.Renderer.SmallCheckbox(Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(this.ParentElement), -1), ($t = this._value, $t != null ? $t : false));
                this._input = Bridge.as(Core.MVVM.Html.Context.previousElementSibling, HTMLInputElement);
                this.Element = this._input.parentElement;
                Core.MVVM.Html.Take(this._input).Event$1("input", Bridge.fn.cacheBind(this, this.UserChange));
                this.SetDisableUI(!this.GuiInfo.Editable);
                this.SetDefaultVal();
                this.Value = Bridge.cast(Bridge.unbox(Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName), System.Boolean), System.Boolean, true);
                Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, Bridge.box(this._value, System.Boolean, System.Nullable.toStringFn(System.Boolean.toString), System.Nullable.getHashCode));
                ($t1 = Core.Extensions.HtmlElementExtension.Closest(this.Element, "td")) != null ? $t1.addEventListener("keydown", Bridge.fn.cacheBind(this, this.ListViewItemTab)) : null;
                !Bridge.staticEquals(($t2 = this.DOMContentLoaded), null) ? $t2() : null;
            },
            GetValueText: function () {
                return this._value == null ? "N/A" : (System.Nullable.eq(this._value, true) ? "Check" : "Kh\u00f4ng check");
            },
            UserChange: function (e) {
                if (this.Disabled) {
                    e.preventDefault();
                    return;
                }
                var check = this._input.checked;
                this.DataChanged(check);
            },
            DataChanged: function (check) {
                var $t;
                var oldVal = this._value;
                this._value = check;
                if (this.Entity != null) {
                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, Bridge.box(check, System.Boolean, System.Boolean.toString));
                }
                this.Dirty = true;
                if (!Bridge.staticEquals(this.UserInput, null)) {
                    this.UserInput(($t = new Core.MVVM.ObservableArgs(), $t.NewData = Bridge.box(this._value, System.Boolean, System.Nullable.toStringFn(System.Boolean.toString), System.Nullable.getHashCode), $t.OldData = Bridge.box(oldVal, System.Boolean, System.Nullable.toStringFn(System.Boolean.toString), System.Nullable.getHashCode), $t.EvType = "change", $t));
                }
                this.PopulateFields();
                this.CascadeField();
                Core.Clients.Client.ExecTaskNoResult(Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity]));
            },
            UpdateView: function (force, dirty, componentNames) {
                var $t, $t1;
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                var val = Bridge.cast(Bridge.unbox((($t = this.Entity) != null ? Core.Extensions.Utils.GetPropValue($t, this.FieldName) : null), System.Boolean), System.Boolean, true);
                this.Value = val;
                if (!this.Dirty) {
                    !Bridge.staticEquals(($t1 = this.DOMContentLoaded), null) ? $t1() : null;
                    this.OldValue = this._input.value;
                }
            },
            SetDisableUI: function (value) {
                if (value) {
                    this.Element.setAttribute("disabled", "disabled");
                } else {
                    this.Element.removeAttribute("disabled");
                }
                this._input.disabled = value;
            }
        }
    });

    Bridge.define("Core.Components.ListView", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                PermissionLoaded: null,
                IsOwner: null,
                _copiedRows: null,
                _originRows: null
            },
            ctors: {
                init: function () {
                    this.PermissionLoaded = "PermissionLoaded";
                    this.IsOwner = "__IsOwner__";
                }
            },
            methods: {
                GetFormattedDataSource: function (com, dataSourceFilter) {
                    var fn = { };
                    if (Core.Extensions.Utils.IsFunction(dataSourceFilter, fn)) {
                        return Bridge.toString(fn.v.call(com, com, com.EditForm));
                    }
                    var editForm = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, com);
                    if (editForm == null) {
                        return Core.Extensions.Utils.FormatEntity$1(dataSourceFilter, com.Entity);
                    }

                    var pre = Core.Extensions.Utils.FormatEntity$1(dataSourceFilter, editForm.Entity);
                    var checkContain = System.String.contains(pre,"EditForm.") || System.String.contains(pre,"TabEditor.") || System.String.contains(pre,"Entity.");
                    return Core.Extensions.Utils.FormatEntity(pre, null, checkContain ? com : com.Entity, void 0, function (x) {
                        return "null";
                    });
                },
                OrderHeaderGroup: function (headers) {
                    var tmp;
                    for (var i = 0; i < ((headers.Count - 1) | 0); i = (i + 1) | 0) {
                        for (var j = (i + 2) | 0; j < headers.Count; j = (j + 1) | 0) {
                            if (Core.Extensions.StringExt.HasAnyChar(headers.getItem(i).GroupName) && Bridge.referenceEquals(headers.getItem(i).GroupName, headers.getItem(j).GroupName) && !Bridge.referenceEquals(headers.getItem(((i + 1) | 0)).GroupName, headers.getItem(j).GroupName)) {
                                tmp = headers.getItem(((i + 1) | 0));
                                headers.setItem(((i + 1) | 0), headers.getItem(j));
                                headers.setItem(j, tmp);
                            }
                        }
                    }
                },
                LoadRecordPolicy: function (connKey, entity, ids) {
                    var $t;
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, ids) || System.Linq.Enumerable.from(ids, System.String).all(function (x) {
                            return x == null;
                        })) {
                        return System.Threading.Tasks.Task.fromResult(System.Array.init([], Core.Models.FeaturePolicy), System.Array.type(Core.Models.FeaturePolicy));
                    }
                    var sql = ($t = new Core.ViewModels.SqlViewModel(), $t.ComId = "Policy", $t.Action = "GetById", $t.Table = "FeaturePolicy", $t.ConnKey = connKey, $t.Params = JSON.stringify(new $asm.$AnonymousType$8(ids, entity)), $t);
                    var xhr = ($t = new Core.Clients.XHRWrapper(), $t.Method = Core.Enums.HttpMethod.POST, $t.Url = Core.Extensions.Utils.UserSvc, $t.IsRawString = true, $t.Value = JSON.stringify(sql), $t);
                    return Core.Clients.Client.Instance.SubmitAsync(System.Array.type(Core.Models.FeaturePolicy), xhr);
                }
            }
        },
        fields: {
            _rowHeight: 0,
            _theadTable: 0,
            _tfooterTable: 0,
            _scrollTable: 0,
            RowClick: null,
            DblClick: null,
            CanWrite: false,
            _noRecord: null,
            BodyContextMenuShow: null,
            _history: null,
            LastComponentFocus: null,
            DeleteTempIds: null,
            CellSelected: null,
            Wheres: null,
            RecordPolicy: null,
            _preQueryFn: null,
            FeatureId: null,
            _hasLoadUserSetting: false
        },
        events: {
            DataLoaded: null
        },
        props: {
            AdvSearchVM: null,
            Editable: false,
            LastListViewItem: null,
            LastShiftViewItem: null,
            LastIndex: 0,
            LastElementFocus: null,
            ListViewSearch: null,
            Paginator: null,
            Header: null,
            RowData: null,
            FormattedRowData: null,
            VirtualScroll: false,
            CacheData: null,
            FormattedDataSource: {
                get: function () {
                    var $t;
                    return Core.Components.ListView.GetFormattedDataSource(this, ($t = this.DataSourceFilter, $t != null ? $t : this.GuiInfo.DataSourceFilter));
                }
            },
            SelectedIndex: 0,
            HeaderSection: null,
            MainSection: null,
            FooterSection: null,
            RefData: null,
            DataSourceFilter: null,
            OnDeleteConfirmed: null,
            AllListViewItem: {
                get: function () {
                    return System.Linq.Enumerable.from(this.MainSection.Children).select(function (x) { return Bridge.cast(x, Core.Components.ListViewItem); });
                }
            },
            UpdatedRows: {
                get: function () {
                    return System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).orderBy(function (x) {
                            return x.RowNo;
                        }).where(function (x) {
                        return x.Dirty;
                    }).select(function (x) {
                        return x.Entity;
                    }).distinct().toList(System.Object);
                }
            },
            UpdatedListItems: {
                get: function () {
                    return System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).orderBy(function (x) {
                            return x.RowNo;
                        }).where(function (x) {
                        return x.Dirty;
                    }).toList(Core.Components.ListViewItem);
                }
            },
            SelectedIds: null,
            FocusId: null,
            EntityFocusId: null,
            ShouldSetEntity: false,
            Settings: null,
            _hasLoadRef: false
        },
        ctors: {
            init: function () {
                this._rowHeight = 26;
                this._theadTable = 40;
                this._tfooterTable = 35;
                this._scrollTable = 10;
                this.CellSelected = new (System.Collections.Generic.List$1(Core.Models.CellSelected)).ctor();
                this.Wheres = new (System.Collections.Generic.List$1(Core.Models.Where)).ctor();
                this.RecordPolicy = new (System.Collections.Generic.List$1(Core.Models.FeaturePolicy)).ctor();
                this.CacheData = new (System.Collections.Generic.List$1(System.Object)).ctor();
                this.SelectedIndex = -1;
                this.SelectedIds = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.ShouldSetEntity = true;
            },
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }
                var $t, $t1, $t2, $t3, $t4;

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.DeleteTempIds = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.GuiInfo = ui || (function () {
                    throw new System.ArgumentNullException.$ctor1("ui");
                })();
                this.Id = ($t = ui.Id) != null ? Bridge.toString($t) : null;
                this.Name = ui.FieldName;
                this.Header = new (System.Collections.Generic.List$1(Core.Models.Component)).ctor();
                this.RowData = new (Core.MVVM.ObservableList$1(System.Object)).ctor();
                this.RefData = new (System.Collections.Generic.Dictionary$2(System.String,System.Collections.Generic.List$1(System.Object))).ctor();
                this.AdvSearchVM = ($t1 = new Core.Models.AdvSearchVM(), $t1.ActiveState = Core.Enums.ActiveStateEnum.Yes, $t1.OrderBy = Core.Clients.LocalStorage.GetItem(System.Collections.Generic.List$1(Core.Models.OrderBy), "OrderBy" + (this.GuiInfo.Id || "")) || new (System.Collections.Generic.List$1(Core.Models.OrderBy)).ctor(), $t1);
                this.DataSourceFilter = ui.DataSourceFilter;
                this.StopChildrenHistory = true;
                this._hasLoadRef = false;
                if (ele != null) {
                    this.Resolve(ui, ele);
                }

                this._rowHeight = ($t1 = this.GuiInfo.BodyItemHeight, $t1 != null ? $t1 : 26);
                this._theadTable = ($t2 = this.GuiInfo.HeaderHeight, $t2 != null ? $t2 : 40);
                this._tfooterTable = ($t3 = this.GuiInfo.FooterHeight, $t3 != null ? $t3 : 35);
                this._scrollTable = ($t4 = this.GuiInfo.ScrollHeight, $t4 != null ? $t4 : 10);
                window.addEventListener(this.GuiInfo.QueueName, Bridge.fn.cacheBind(this, this.RealtimeUpdateListViewItem));
                Core.Extensions.Utils.IsFunction(this.GuiInfo.PreQuery, Bridge.ref(this, "_preQueryFn"));
            }
        },
        methods: {
            RealtimeUpdateListViewItem: function (mqEvent) {
                var updatedData = mqEvent.detail.Message;
                var listViewItem = System.Linq.Enumerable.from(this.MainSection.FilterChildren(Core.Components.ListViewItem, function (x) {
                        return Bridge.referenceEquals(x.Entity[Core.Components.EditableComponent.IdField], updatedData[Core.Components.EditableComponent.IdField]);
                    }), Core.Components.ListViewItem).firstOrDefault(null, null);
                if (listViewItem == null) {
                    return;
                }
                Core.Extensions.ReflectionExt.CopyPropFrom(System.Linq.Enumerable.from(this.CacheData, System.Object).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x[Core.Components.EditableComponent.IdField], updatedData[Core.Components.EditableComponent.IdField]);
                    }, null), updatedData);
                Core.Extensions.ReflectionExt.CopyPropFrom(listViewItem.Entity, updatedData);
                var arr = System.Linq.Enumerable.from(listViewItem.FilterChildren(Core.Components.EditableComponent, function (x) {
                        return !x.Dirty || Core.Extensions.StringExt.IsNullOrWhiteSpace(x.GetValueText());
                    }), Core.Components.EditableComponent).select(function (x) {
                        return x.FieldName;
                    }).ToArray(System.String);
                listViewItem.UpdateView$1(false, arr);
                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterWebsocket, [updatedData, listViewItem]));
            },
            Resolve: function (com, ele) {
                if (ele === void 0) { ele = null; }
                var txtArea = Bridge.as(document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.textarea)), HTMLTextAreaElement);
                txtArea.innerHTML = ele.innerHTML;
                com.FormatEntity = txtArea.value;
                ele.innerHTML = null;
            },
            ReloadData: function (cacheHeader, skip, pageSize) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7, $t8, $t9;
                if (cacheHeader === void 0) { cacheHeader = false; }
                if (skip === void 0) { skip = null; }
                if (pageSize === void 0) { pageSize = null; }
                if (this.GuiInfo.LocalRender && this.GuiInfo.LocalData != null) {
                    this.SetRowData(this.GuiInfo.LocalData);
                    return System.Threading.Tasks.Task.fromResult(this.GuiInfo.LocalData, System.Collections.Generic.List$1(System.Object));
                }
                if (this.Paginator != null) {
                    this.Paginator.Options.PageSize = this.Paginator.Options.PageSize === 0 ? (($t = this.GuiInfo.Row, $t != null ? $t : 12)) : this.Paginator.Options.PageSize;
                }
                pageSize = ($t1 = pageSize, $t1 != null ? $t1 : ($t2 = (($t3 = this.Paginator) != null && ($t4 = $t3.Options) != null ? $t4.PageSize : null), $t2 != null ? $t2 : ($t5 = this.GuiInfo.Row, $t5 != null ? $t5 : 12)));
                skip = ($t6 = skip, $t6 != null ? $t6 : ($t7 = Bridge.Int.mul((($t8 = this.Paginator) != null && ($t9 = $t8.Options) != null ? $t9.PageIndex : null), pageSize), $t7 != null ? $t7 : 0));
                return this.SqlReader(skip, pageSize, cacheHeader);
            },
            SqlReader: function (skip, pageSize, cacheHeader) {
                if (cacheHeader === void 0) { cacheHeader = false; }
                var sql = this.GetSql(skip, pageSize, cacheHeader);
                return this.CustomQuery(sql);
            },
            GetSql: function (skip, pageSize, cacheMeta, count) {
                var $t, $t1;
                if (skip === void 0) { skip = null; }
                if (pageSize === void 0) { pageSize = null; }
                if (cacheMeta === void 0) { cacheMeta = false; }
                if (count === void 0) { count = true; }
                var submitEntity = this._preQueryFn != null ? this._preQueryFn.call(null, this) : null;
                var orderBy = Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.OrderBy, this.AdvSearchVM.OrderBy) ? Core.Extensions.IEnumerableExtensions.Combine$1(Core.Models.OrderBy, System.String, this.AdvSearchVM.OrderBy, function (x) {
                    var sortDirection = System.Nullable.eq(x.OrderbyDirectionId, Core.Enums.OrderbyDirection.ASC) ? "asc" : "desc";
                    return System.String.format("ds.{0} {1}", x.FieldName, sortDirection);




                }) : null;
                var basicCondition = this.CalcFilterQuery();
                var fnBtnCondition = Core.Extensions.IEnumerableExtensions.Combine$1(Core.Models.Where, System.String, this.Wheres, function (x) {
                    return System.String.format("({0})", [x.Condition]);
                }, " and ");
                var finalCon = Core.Extensions.IEnumerableExtensions.Combine(System.String, System.Linq.Enumerable.from(System.Array.init([basicCondition, fnBtnCondition], System.String), System.String).where(function (x) {
                        return !Core.Extensions.StringExt.IsNullOrWhiteSpace(x);
                    }), " and ");
                var data = ($t = new Core.ViewModels.SqlViewModel(), $t.ComId = this.GuiInfo.Id, $t.Params = submitEntity != null ? JSON.stringify(Bridge.unbox(submitEntity)) : null, $t.OrderBy = ($t1 = orderBy, $t1 != null ? $t1 : (Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.OrderBy) ? "ds.Id asc\n" : this.GuiInfo.OrderBy)), $t.Where = finalCon, $t.Count = count, $t.SkipXQuery = cacheMeta, $t.ConnKey = this.ConnKey, $t);
                if (System.Nullable.hasValue(skip) && System.Nullable.hasValue(pageSize)) {
                    data.Paging = System.String.format("offset {0} rows\nfetch next {1} rows only", Bridge.box(skip, System.Int32, System.Nullable.toString, System.Nullable.getHashCode), Bridge.box(pageSize, System.Int32, System.Nullable.toString, System.Nullable.getHashCode));
                }
                return data;
            },
            CustomQuery: function (vm) {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                var dsTask = Core.Clients.Client.Instance.ComQuery(vm);
                Core.Clients.Client.ExecTask(System.Array.type(System.Array.type(System.Object)), dsTask, Bridge.fn.bind(this, function (ds) {
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.Array.type(System.Object), ds)) {
                        this.SetRowData(null);
                        tcs.trySetResult(null);
                    }
                    var total = ds.length > 1 ? ds[System.Array.index(1, ds)][0].total : ds[System.Array.index(0, ds)].length;
                    var rows = new (System.Collections.Generic.List$1(System.Object)).$ctor1(ds[System.Array.index(0, ds)]);
                    Core.Components.Spinner.Hide();
                    this.SetRowData(rows);
                    this.UpdatePagination(total, rows.Count);
                    tcs.trySetResult(rows);
                    !Bridge.staticEquals(this.DataLoaded, null) ? this.DataLoaded(ds) : null;
                }), function (err) {
                    tcs.trySetException(err);
                });
                return tcs.task;
            },
            Render: function () {
                var feature = this.EditForm.Feature;
                var gridPolicies = this.EditForm.GetElementPolicies(this.GuiInfo.Id, Core.Extensions.Utils.ComponentId);
                this.CanWrite = this.CanDo(gridPolicies, function (x) {
                    return x.CanWrite;
                });
                Core.MVVM.Html.Take(this.ParentElement).DataAttr$1("name", this.FieldName);
                this.AddSections();
                this.SetRowDataIfExists();
                this.EditForm.ResizeListView();
                if (this.GuiInfo.LocalRender) {
                    this.LocalRender();
                } else {
                    this.LoadAllData();
                }
            },
            LocalRender: function () {
                this.Header = this.GuiInfo.LocalHeader;
                if (this.GuiInfo.LocalRender) {
                    this.Rerender();
                } else {
                    this.RowData.Data = this.GuiInfo.LocalData;
                }
            },
            AddSections: function () {
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Div, "grid-wrapper"), this.Editable ? "editable" : "");
                this.Element = Core.MVVM.Html.Context;
                if (this.GuiInfo.CanSearch) {
                    Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "grid-toolbar search").End.Render();
                }
                this.ListViewSearch = new Core.Components.ListViewSearch(this.GuiInfo);
                this.AddChild(this.ListViewSearch);
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div, "list-content");
                this.MainSection = new Core.Components.ListViewSection.ctor(Core.MVVM.Html.Context);
                this.AddChild(this.MainSection);
                Core.MVVM.Html.Instance.EndOf$1(".list-content");
                this.RenderPaginator();
            },
            ApplyFilter: function () {
                this.ClearRowData();
                return this.ReloadData(true, 0, void 0);
            },
            ActionFilter: function () {
                this.ClearRowData();
                Core.Clients.Client.ExecTaskNoResult(this.ReloadData());
            },
            CalcFilterQuery: function () {
                return this.ListViewSearch.CalcFilterQuery();
            },
            LoadAllData: function () {
                Core.Clients.Client.ExecTask(System.Collections.Generic.List$1(System.Object), this.ReloadData(this.GuiInfo.CanCache, void 0, void 0));
            },
            ResetOrder: function () {
                var order = 0;
                this.Header.ForEach(function (x) {
                    x.Order = order;
                    order = (order + 1) | 0;
                });
            },
            FilterColumns: function (Component) {
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.Component, Component)) {
                    return Component;
                }
                var specificComponent = System.Linq.Enumerable.from(Component, Core.Models.Component).any(Bridge.fn.bind(this, function (x) {
                        return Bridge.referenceEquals(x.ComponentId, this.GuiInfo.Id);
                    }));
                if (specificComponent) {
                    Component = System.Linq.Enumerable.from(Component, Core.Models.Component).where(Bridge.fn.bind(this, function (x) {
                            return Bridge.referenceEquals(x.ComponentId, this.GuiInfo.Id);
                        })).toList(Core.Models.Component);
                } else {
                    Component = System.Linq.Enumerable.from(Component, Core.Models.Component).where(function (x) {
                            return x.ComponentId == null;
                        }).toList(Core.Models.Component);
                }

                var permission = this.EditForm.GetGridPolicies$1(System.Linq.Enumerable.from(Component, Core.Models.Component).select(function (x) {
                        return x.Id;
                    }).ToArray(System.String), Core.Extensions.Utils.ComponentId);
                var headers = System.Linq.Enumerable.from(Component, Core.Models.Component).where(function (header) {
                        return !header.IsPrivate || Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy, System.Linq.Enumerable.from(permission, Core.Models.FeaturePolicy).where(function (x) {
                                return Bridge.referenceEquals(x.RecordId, header.Id);
                            }), function (policy) {
                            return policy.CanRead;
                        });
                    }).select(Bridge.fn.cacheBind(this, this.CalcTextAlign)).orderByDescending(function (x) {
                    return x.Frozen;
                }).thenBy(function (x) {
                    return x.Order;
                }).toList(Core.Models.Component);
                Core.Components.ListView.OrderHeaderGroup(headers);
                this.Header.clear();
                this.Header.AddRange(headers);
                this.Header = System.Linq.Enumerable.from(this.Header, Core.Models.Component).where(function (x) {
                        return x != null;
                    }).toList(Core.Models.Component);
                return this.Header;
            },
            CalcTextAlign: function (header) {
                if (Core.Extensions.StringExt.HasAnyChar(header.TextAlign)) {
                    var textAlign = { v : new Core.Enums.TextAlign() };
                    var parsed = System.Enum.tryParse(Core.Enums.TextAlign, header.TextAlign, textAlign);
                    if (parsed) {
                        header.TextAlignEnum = textAlign.v;
                    }
                }
                return header;
            },
            RenderPaginator: function () {
                var $t, $t1;
                if (this.GuiInfo.LocalRender) {
                    if (this.Paginator != null) {
                        this.Paginator.Show = false;
                    }
                    return;
                }
                if (this.GuiInfo.Row == null || System.Nullable.eq(this.GuiInfo.Row, 0)) {
                    this.GuiInfo.Row = 20;
                }

                if (this.Paginator == null) {
                    this.Paginator = new Core.Components.Paginator(($t = new Core.Components.PaginationOptions(), $t.Total = 0, $t.PageSize = ($t1 = this.GuiInfo.Row, $t1 != null ? $t1 : 20), $t.CurrentPageCount = System.Linq.Enumerable.from(this.RowData.Data, System.Object).count(), $t));
                    this.AddChild(this.Paginator);
                }
            },
            RenderRowData: function (headers, row, section, index, emptyRow) {
                var $t;
                if (index === void 0) { index = null; }
                if (emptyRow === void 0) { emptyRow = false; }
                var rowSection = ($t = new Core.Components.ListViewItem(Core.MVVM.ElementType.div), $t.EmptyRow = emptyRow, $t.Entity = row, $t.ParentElement = section.Element, $t.PreQueryFn = this._preQueryFn, $t.ListView = this, $t.ListViewSection = Bridge.as(section, Core.Components.ListViewSection), $t.GuiInfo = this.GuiInfo, $t);
                var parent;
                if (((parent = Bridge.as(section, Core.Components.ListViewSection))) != null) {
                    rowSection.ListViewSection = parent;
                } else {
                    var group;
                    if (((group = Bridge.as(section, Core.Components.GroupViewItem))) != null) {
                        rowSection.ListViewSection = group.ListViewSection;
                    }
                }
                section.AddChild(rowSection, index);
                rowSection.RenderRowData(headers, row, index, emptyRow);
                return rowSection;
            },
            RenderContent: function () {
                this.FormattedRowData = Core.Extensions.IEnumerableExtensions.Nothing(System.Object, this.FormattedRowData) ? this.RowData.Data : this.FormattedRowData;
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, this.FormattedRowData)) {
                    return;
                }
                Core.Extensions.IEnumerableExtensions.SelectForEach$1(System.Object, this.FormattedRowData, Bridge.fn.bind(this, function (rowData, index) {
                    var rowSection = this.RenderRowData(this.Header, rowData, this.MainSection);
                }));
                this.ContentRendered();
            },
            Rerender: function () {
                this.DisposeNoRecord();
                this.Editable = this.GuiInfo.CanAdd && System.Linq.Enumerable.from(this.Header, Core.Models.Component).any(function (x) {
                        return x.Active && !x.Hidden && x.Editable;
                    });
                this.MainSection.DisposeChildren();
                Core.MVVM.Html.Take(this.MainSection.Element).Clear();
                this.RenderContent();
            },
            ContentRendered: function () {
                this.RenderIndex();
                this.DomLoaded();
                if (this.Editable) {
                    this.AddNewEmptyRow();
                }
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, this.RowData.Data) && !this.Editable) {
                    this.NoRecordFound();
                } else {
                    this.DisposeNoRecord();
                    this.MainSection.Element.addEventListener("contextmenu", Bridge.fn.cacheBind(this, this.BodyContextMenuHandler));
                }
                Core.Components.Spinner.Hide();
            },
            DomLoaded: function () {
                var $t;
                if (!this.GuiInfo.LocalRender) {
                    this.Header.ForEach(function (x) {
                        x.LocalData = null;
                    });
                }
                !Bridge.staticEquals(($t = this.DOMContentLoaded), null) ? $t() : null;
            },
            SetRowData: function (listData) {
                this.RowData._data.clear();
                var hasElement = Core.Extensions.IEnumerableExtensions.HasElement(System.Object, listData);
                if (hasElement) {
                    listData.ForEach(Bridge.fn.cacheBind(this.RowData._data, this.RowData._data.add)); // Not to use AddRange because the _data is not always List
                }
                this.RenderContent();
                if (this.Entity != null && this.ShouldSetEntity) {
                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this.RowData.Data);
                }
            },
            SetRowDataIfExists: function () {
                var value;
                if (this.Entity != null && ((value = Bridge.as(Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName), System.Collections.IEnumerable))) != null && Bridge.getEnumerator(value).System$Collections$IEnumerator$moveNext() && (Bridge.is(value, System.String))) {
                    this.RowData._data = value;
                }
            },
            MergeComponent: function (sysSetting, userSetting) {
                var $t;
                if (userSetting == null) {
                    return sysSetting;
                }
                var column = Newtonsoft.Json.JsonConvert.DeserializeObject(userSetting.Value, System.Collections.Generic.List$1(Core.Models.Component));
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.Component, column)) {
                    return sysSetting;
                }
                var Components = new (System.Collections.Generic.List$1(Core.Models.Component)).ctor();
                var userSettings = ($t = Core.Models.Component, System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Models.Component, System.String, column, function (x) {
                        return x.Id;
                    }), $t).toDictionary(function (x) {
                        return x.Id;
                    }, null, System.String, $t));
                sysSetting.ForEach(function (x) {
                    var current = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, Core.Models.Component, userSettings, x.Id);
                    if (current != null) {
                        x.Width = current.Width;
                        x.MaxWidth = current.MaxWidth;
                        x.MinWidth = current.MinWidth;
                        x.Order = current.Order;
                        x.Frozen = current.Frozen;
                    }
                });
                return sysSetting;
            },
            UpdatePagination: function (total, currentPageCount) {
                if (this.Paginator == null) {
                    return;
                }
                var options = this.Paginator.Options;
                options.Total = total;
                options.CurrentPageCount = currentPageCount;
                options.PageNumber = (options.PageIndex + 1) | 0;
                options.StartIndex = (Bridge.Int.mul(options.PageIndex, options.PageSize) + 1) | 0;
                options.EndIndex = (((options.StartIndex + options.CurrentPageCount) | 0) - 1) | 0;
                this.Paginator.UpdateView();
            },
            RealtimeUpdate: function (rowData, arg) {
                if (this.EmptyRow) {
                    this.EmptyRow = false;
                    return;
                }
                if (!this.GuiInfo.IsRealtime || arg == null) {
                    return;
                }
                rowData.PatchUpdateOrCreate();
            },
            RowChangeHandler: function (rowData, rowSection, observableArgs, component) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $task2, 
                    $taskResult2, 
                    $task3, 
                    $taskResult3, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3,4,5], $step);
                                switch ($step) {
                                    case 0: {
                                        if (component === void 0) { component = null; }
                                        if (rowSection.EmptyRow && this.Editable) {
                                            $step = 1;
                                            continue;
                                        } 
                                        $step = 4;
                                        continue;
                                    }
                                    case 1: {
                                        $task1 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforeCreated, [rowData]);
                                        $step = 2;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 2: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        this.RowData.Data.add(rowData);
                                        $task2 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterCreated, [rowData]);
                                        $step = 3;
                                        if ($task2.isCompleted()) {
                                            continue;
                                        }
                                        $task2.continue($asyncBody);
                                        return;
                                    }
                                    case 3: {
                                        $taskResult2 = $task2.getAwaitedResult();
                                        Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this.RowData.Data);
                                        this.RowAction$2(function (x) {
                                            return Bridge.referenceEquals(x.Entity, rowSection.Entity);
                                        }, function (x) {
                                            x.EmptyRow = false;
                                            Core.Extensions.IEnumerableExtensions.SelectForEach(Core.Components.EditableComponent, x.FilterChildren$1(function (child) {
                                                return true;
                                            }), function (child) {
                                                child.EmptyRow = false;
                                                child.UpdateView$1(true);
                                            });
                                        });
                                        this.AddNewEmptyRow();
                                        $step = 4;
                                        continue;
                                    }
                                    case 4: {
                                        $task3 = Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [rowData]);
                                        $step = 5;
                                        if ($task3.isCompleted()) {
                                            continue;
                                        }
                                        $task3.continue($asyncBody);
                                        return;
                                    }
                                    case 5: {
                                        $taskResult3 = $task3.getAwaitedResult();
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            AddNewEmptyRow: function () {
                // not to add empty row into list view
            },
            NoRecordFound: function () {
                var $t;
                if (Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent, this.MainSection.Children)) {
                    System.Linq.Enumerable.from(this.MainSection.Children, Core.Components.EditableComponent).where(function (x) {
                            return Bridge.is(x, Core.Components.ListViewSection);
                        }).forEach(function (x) {
                        x.DisposeChildren();
                    });
                }
                this.DisposeNoRecord();
                this._noRecord = ($t = new Core.Components.Section.$ctor1(Core.MVVM.ElementType.div), $t.ParentElement = this.Element, $t);
                this.AddChild(this._noRecord);
                Core.Extensions.HtmlElementExtension.AddClass(this._noRecord.Element, "no-records");
                Core.Components.Renderer.IHtml(Core.MVVM.Html.Take(this._noRecord.Element), "Kh\u00f4ng t\u00ecm th\u1ea5y d\u1eef li\u1ec7u");
                this.DomLoaded();
            },
            BodyContextMenuHandler: function (e) {
                e.preventDefault();
                e.stopPropagation();
                this.TbodyContextMenu(e);
            },
            SetRemoteSource: function (remoteData, typeName, header) {
                var localSource = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, System.Collections.Generic.List$1(System.Object), this.RefData, typeName);
                if (localSource == null) {
                    this.RefData.add(typeName, remoteData);
                } else {
                    remoteData.AddRange(localSource);
                    localSource.clear();
                    localSource.AddRange(Core.Extensions.BridgeExt.DistinctBy(System.Object, System.Int32, remoteData, function (x) {
                        return Bridge.unbox(x[Core.Components.EditableComponent.IdField]);
                    }));
                }
                if (header != null) {
                    header.LocalData = remoteData;
                }
            },
            SyncMasterData: function (rows, headers) {
                var $t, $t1, $t2, $t3;
                if (rows === void 0) { rows = null; }
                if (headers === void 0) { headers = null; }
                rows = rows || this.RowData.Data;
                headers = headers || this.Header;
                $t = Bridge.getEnumerator(System.Linq.Enumerable.from(headers, Core.Models.Component).where(function (x) {
                        return Core.Extensions.StringExt.HasAnyChar(x.ReferenceId);
                    }));
                try {
                    while ($t.moveNext()) {
                        var header = { v : $t.Current };
                        if (Core.Extensions.StringExt.IsNullOrWhiteSpace(header.v.FieldName) || header.v.FieldName.length <= 2) {
                            continue;
                        }

                        var containId = Bridge.referenceEquals(header.v.FieldName.substr(((header.v.FieldName.length - 2) | 0)), Core.Components.EditableComponent.IdField);
                        if (!containId) {
                            continue;
                        }

                        $t1 = Bridge.getEnumerator(rows, System.Object);
                        try {
                            while ($t1.moveNext()) {
                                var row = { v : $t1.Current };
                                var objField = header.v.FieldName.substr(0, ((header.v.FieldName.length - 2) | 0));
                                var propType = ($t2 = Core.Extensions.Utils.GetEntity(header.v.ReferenceId)) != null ? $t2.Name : null;
                                if (propType == null) {
                                    continue;
                                }

                                var propVal = { v : Core.Extensions.Utils.GetPropValue(row.v, objField) };
                                var found = ($t3 = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, System.Collections.Generic.List$1(System.Object), this.RefData, propType)) != null ? System.Linq.Enumerable.from($t3, System.Object).firstOrDefault((function ($me, row, header) {
                                        return function (source) {
                                            return System.Nullable.eq(Bridge.unbox(source[Core.Components.EditableComponent.IdField]), Bridge.unbox(Core.Extensions.Utils.GetPropValue(row.v, header.v.FieldName)));



                                        };
                                    })(this, row, header), null) : null;
                                if (found != null) {
                                    Core.Extensions.BridgeExt.SetComplexPropValue(row.v, objField, found);
                                } else if (propVal.v != null && found == null) {
                                    var source = { v : System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, System.Collections.Generic.List$1(System.Object), this.RefData, propType) };
                                    source.v != null ? source.v.add(propVal.v) : null;
                                }
                            }
                        } finally {
                            if (Bridge.is($t1, System.IDisposable)) {
                                $t1.System$IDisposable$Dispose();
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            FormatDataSourceByEntity: function (currentHeader, allHeaders, entities) {
                var entityIds = System.Linq.Enumerable.from(allHeaders, Core.Models.Component).where(function (x) {
                        return Bridge.referenceEquals(x.RefName, currentHeader.RefName);
                    }).selectMany(Bridge.fn.bind(this, function (x) {
                    return this.GetEntityIds(x, entities);
                })).distinct();
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, entityIds)) {
                    return null;
                }

                currentHeader.DataSourceOptimized = Core.Extensions.IEnumerableExtensions.Combine(System.String, entityIds.where(function (x) {
                    return Core.Extensions.StringExt.HasAnyChar(x);
                }).orderBy(function (x) {
                    return x;
                }).select(function (x) {
                    return System.String.format("'{0}'", [x]);
                }));
                return currentHeader;
            },
            GetEntityIds: function (header, entities) {
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, entities)) {
                    return System.Linq.Enumerable.empty();
                }

                return System.Linq.Enumerable.from(entities, System.Object).select(function (x) {
                        var $t;
                        var id = ($t = Core.Extensions.Utils.GetPropValue(x, header.FieldName)) != null ? Bridge.toString($t) : null;
                        if (Core.Extensions.StringExt.IsNullOrEmpty(id)) {
                            return null;
                        }

                        return id;
                    }).where(function (id) {
                    return id != null;
                });
            },
            DeactivateSelected: function (ev) {
                var $t;
                if (ev === void 0) { ev = null; }
                var confirm = ($t = new Core.Components.Forms.ConfirmDialog(), $t.Content = "Are you sure to deactivate?", $t);
                confirm.Render();
                confirm.YesConfirmed = Bridge.fn.combine(confirm.YesConfirmed, Bridge.fn.bind(this, function () {
                    confirm.Dispose();
                    Core.Extensions.EventExt.Done(this.Deactivate(), Bridge.fn.bind(this, function () {
                        Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.Deactivated, [this.Entity]));
                    }));
                }));
            },
            SetSelect: function (row, selected) {
                this.RowAction$2(function (x) {
                    return Bridge.referenceEquals(x.Entity, row);
                }, function (x) {
                    x.Selected = selected;
                });
            },
            SetSelectAll: function (selected) {
                this.RowAction(function (x) {
                    x.Selected = selected;
                });
            },
            HardDeleteSelected: function (e) {
                var $t;
                if (e === void 0) { e = null; }
                if (this.GuiInfo.IgnoreConfirmHardDelete && !Bridge.staticEquals(this.OnDeleteConfirmed, null)) {
                    this.OnDeleteConfirmed();
                    return;
                }
                var deletedItems = ($t = System.Object, System.Linq.Enumerable.from(this.GetSelectedRows(), $t).toList($t));
                var confirm = new Core.Components.Forms.ConfirmDialog();
                confirm.Title = System.String.format("B\u1ea1n c\u00f3 ch\u1eafc x\u00f3a {0} d\u00f2ng d\u1eef li\u00eau kh\u00f4ng!", [Bridge.box(deletedItems.Count, System.Int32)]);
                confirm.Render();
                confirm.YesConfirmed = Bridge.fn.combine(confirm.YesConfirmed, Bridge.fn.bind(this, function () {
                    var $t1;
                    if (!Bridge.staticEquals(this.OnDeleteConfirmed, null)) {
                        this.OnDeleteConfirmed();
                        !Bridge.staticEquals(($t1 = this.DOMContentLoaded), null) ? $t1() : null;
                        return;
                    }
                    confirm.Dispose();
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, deletedItems)) {
                        deletedItems = this.GetFocusedRows();
                    }
                    Core.Extensions.EventExt.Done(Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforeDeleted, [deletedItems]), Bridge.fn.bind(this, function () {
                        Core.Extensions.EventExt.Done$1(System.Collections.Generic.List$1(System.Object), this.HardDeleteConfirmed(deletedItems), Bridge.fn.bind(this, function (res) {
                            var $t2;
                            !Bridge.staticEquals(($t2 = this.DOMContentLoaded), null) ? $t2() : null;
                            Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterDeleted, [deletedItems]));
                        }));
                    }));
                }));
            },
            Deactivate: function () {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                var entity = this.GuiInfo.RefName;
                var selected = this.GetSelectedRows();
                var ids = System.Linq.Enumerable.from(selected, System.Object).select(function (x) {
                        return Bridge.as(x[Core.Components.EditableComponent.IdField], System.String);
                    }).ToArray(System.String);
                Core.Extensions.EventExt.Done$1(System.Array.type(System.String), Core.Clients.Client.Instance.DeactivateAsync(ids, this.GuiInfo.RefName, this.ConnKey), Bridge.fn.bind(this, function (deacvitedIds) {
                    if (Core.Extensions.IEnumerableExtensions.HasElement(System.String, deacvitedIds)) {
                        Core.Extensions.Toast.Success("H\u1ee7y d\u1eef li\u1ec7u th\u00e0nh c\u00f4ng");
                        if (this.AdvSearchVM.ActiveState === Core.Enums.ActiveStateEnum.Yes) {
                            this.RemoveRange(selected);
                        }
                    } else {
                        Core.Extensions.Toast.Warning("\u0110\u00e3 c\u00f3 l\u1ed7i x\u1ea3y ra khi h\u1ee7y d\u1eef li\u1ec7u, vui l\u00f2ng th\u1eed l\u1ea1i ho\u1eb7c li\u00ean h\u1ec7 h\u1ed7 tr\u1ee3!");
                    }
                    tcs.trySetResult(deacvitedIds);
                }));
                return tcs.task;
            },
            HardDeleteConfirmed: function (deleted) {
                var entity = this.GuiInfo.RefName;
                var ids = System.Linq.Enumerable.from(deleted, System.Object).select(function (x) {
                        var $t;
                        return ($t = x[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null;
                    }).where(function (x) {
                    return x != null;
                }).toList(System.String);
                var deletes = System.Linq.Enumerable.from(deleted, System.Object).where(function (x) {
                        return x[Core.Components.EditableComponent.IdField] != null;
                    }).toList(System.Object);
                var removeRow = System.Linq.Enumerable.from(deleted, System.Object).where(function (x) {
                        return x[Core.Components.EditableComponent.IdField] == null;
                    }).toList(System.Object);
                if (System.Linq.Enumerable.from(removeRow, System.Object).any()) {
                    this.RemoveRange(removeRow);
                }
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, deleted)) {
                    Core.Extensions.Toast.Success("Select at least 1 row to delete");
                    return System.Threading.Tasks.Task.fromResult(null, System.Collections.Generic.List$1(System.Object));
                }
                if (this.EditForm.Feature.DeleteTemp) {
                    var deleteIds = System.Linq.Enumerable.from(deleted, System.Object).where(function (x) {
                            return x[Core.Components.EditableComponent.IdField] != null;
                        }).toList(System.Object);
                    if (System.Linq.Enumerable.from(deleteIds, System.Object).any()) {
                        this.RemoveRange(deleteIds);
                    }
                    this.DeleteTempIds.AddRange(ids);
                    System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).where(function (x) {
                                return x.Selected;
                            }).ToArray(Core.Components.ListViewItem).forEach(function (x) {
                            x.Dispose();
                        });
                    this.ClearSelected();
                    this.Dirty = true;
                    Core.Extensions.Toast.Success("Delete data success");
                    return System.Threading.Tasks.Task.fromResult(deleted, System.Collections.Generic.List$1(System.Object));
                }
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done$1(System.Array.type(System.String), Core.Clients.Client.Instance.HardDeleteAsync(ids.ToArray(), this.GuiInfo.RefName, this.ConnKey), Bridge.fn.bind(this, function (delSuccessIds) {
                    if (Core.Extensions.IEnumerableExtensions.HasElement(System.String, delSuccessIds)) {
                        var allDeleted = delSuccessIds.length === ids.Count ? "" : " partially";
                        Core.Extensions.Toast.Success(System.String.format("Delete data{0} success", [allDeleted]));
                        System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).where(function (x) {
                                    return x.Selected && System.Array.contains(delSuccessIds, x.EntityId, System.String);
                                }).ToArray(Core.Components.ListViewItem).forEach(function (x) {
                                x.Dispose();
                            });
                        tcs.trySetResult(deleted);
                        return;
                    } else {
                        Core.Extensions.Toast.Warning("No row was deleted");
                    }
                    tcs.trySetResult(null);
                }));
                return tcs.task;
            },
            RemoveRange: function (deleted) {
                Core.Extensions.IEnumerableExtensions.SelectForEach(System.Object, deleted, Bridge.fn.bind(this, function (x) {
                    this.RemoveRowById(Bridge.unbox(x[Core.Components.EditableComponent.IdField]));
                }));
            },
            GetFocusedRows: function () {
                return System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).where(function (x) {
                        return x.Focused;
                    }).select(function (x) {
                    return x.Entity;
                }).toList(System.Object);
            },
            GetItemFocus: function () {
                return System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).where(function (x) {
                        return x.Focused;
                    }).firstOrDefault(null, null);
            },
            GetSelectedRows: function () {
                var $t;
                if (System.Nullable.eq((($t = this.LastListViewItem) != null ? $t.GroupRow : null), true)) {
                    return Bridge.fn.bind(this, function (_o1) {
                            _o1.add(this.LastListViewItem.Entity);
                            return _o1;
                        })(new (System.Collections.Generic.List$1(System.Object)).ctor());
                } else {
                    return System.Linq.Enumerable.from(this.MainSection.Children, Core.Components.EditableComponent).where(function (x) {
                            var item;
                            return ((item = Bridge.as(x, Core.Components.ListViewItem))) != null && item.Selected;
                        }).select(function (x) {
                        return x.Entity;
                    }).toList(System.Object);
                }
            },
            GetRealTimeSelectedRows: function () {
                var $t;
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Object), Core.Clients.Client.Instance.GetByIdAsync(this.GuiInfo.RefName, ($t = this.ConnKey, $t != null ? $t : Core.Clients.Client.ConnKey), this.SelectedIds.ToArray()), function (res) {
                    var $t1;
                    tcs.trySetResult(res != null ? ($t1 = System.Object, System.Linq.Enumerable.from(res, $t1).toList($t1)) : null);
                });
                return tcs.task;
            },
            PasteSelected: function (ev) {
                var clipBoard = Bridge.as((window).navigator.clipboard.readText(), System.String);
                if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(clipBoard) && Core.Extensions.IEnumerableExtensions.Nothing(System.Object, Core.Components.ListView._copiedRows)) {
                    Core.Components.ListView._copiedRows = Bridge.as(JSON.parse(clipBoard), System.Array.type(System.Object));
                }
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, Core.Components.ListView._copiedRows)) {
                    return;
                }

                Core.Extensions.Toast.Success("\u0110ang Sao ch\u00e9p li\u1ec7u !");
                Core.Extensions.EventExt.Done(Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforePasted, [Core.Components.ListView._originRows, Core.Components.ListView._copiedRows]), Bridge.fn.bind(this, function () {
                    var index = Core.Extensions.IEnumerableExtensions.IndexOf(Core.Components.ListViewItem, this.AllListViewItem, function (x) {
                        return x.Selected;
                    });
                    Core.Extensions.EventExt.Done$1(System.Array.type(Core.Components.ListViewItem), this.AddRowsNo(Core.Components.ListView._copiedRows, index), Bridge.fn.bind(this, function (list) {
                        var $t;
                        Core.Components.EditableComponent.prototype.Focus.call(this);
                        if (this.GuiInfo.IsRealtime) {
                            $t = Bridge.getEnumerator(list);
                            try {
                                while ($t.moveNext()) {
                                    var item = $t.Current;
                                    item.PatchUpdateOrCreate();
                                }
                            } finally {
                                if (Bridge.is($t, System.IDisposable)) {
                                    $t.System$IDisposable$Dispose();
                                }
                            }
                            Core.Extensions.Toast.Success("Sao ch\u00e9p d\u1eef li\u1ec7u th\u00e0nh c\u00f4ng !");
                            Bridge.ensureBaseProperty(this, "Dirty").$Core$Components$EditableComponent$Dirty = false;
                            this.ClearSelected();
                        } else {
                            Core.Extensions.Toast.Success("Sao ch\u00e9p d\u1eef li\u1ec7u th\u00e0nh c\u00f4ng !");
                        }
                        Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterPasted, [Core.Components.ListView._originRows, Core.Components.ListView._copiedRows]));
                    }));
                }));
            },
            RenderIndex: function (skip) {
                var $t, $t1, $t2;
                if (skip === void 0) { skip = null; }
                if (skip == null) {
                    skip = ($t = (($t1 = this.Paginator) != null && ($t2 = $t1.Options) != null ? $t2.StartIndex : null), $t != null ? $t : 0);
                }
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, this.MainSection.Children)) {
                    return;
                }
                System.Linq.Enumerable.from(this.MainSection.Children).select(function (x) { return Bridge.cast(x, Core.Components.ListViewItem); }).forEach(Bridge.fn.bind(this, function (row, rowIndex) {
                    if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, row.Children) || row.FirstChild == null || row.FirstChild.Element == null) {
                        return;
                    }
                    var previous = Core.Extensions.HtmlElementExtension.Closest(row.FirstChild.Element, "td").previousElementSibling;
                    if (previous == null) {
                        return;
                    }
                    var index = Bridge.Int.clip32(System.Nullable.add(skip, rowIndex));
                    previous.innerHTML = System.Nullable.toString(index, null);
                    row.Selected = System.Linq.Enumerable.from(this.SelectedIds, System.Object).contains(row.Entity[Core.Components.EditableComponent.IdField]);
                    row.RowNo = System.Nullable.getValue(index);
                }));
            },
            DuplicateSelected: function (ev, addRow) {
                if (addRow === void 0) { addRow = false; }
                var originalRows = this.GetSelectedRows();
                var copiedRows = Core.Extensions.ReflectionExt.CloneRows(originalRows);
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, copiedRows) || !this.CanWrite) {
                    return;
                }

                Core.Extensions.Toast.Success("\u0110ang Sao ch\u00e9p li\u1ec7u !");
                Core.Extensions.EventExt.Done(Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforePasted, [originalRows, copiedRows]), Bridge.fn.bind(this, function () {
                    var index = Core.Extensions.IEnumerableExtensions.IndexOf(Core.Components.ListViewItem, this.AllListViewItem, function (x) {
                        return x.Selected;
                    });
                    if (addRow) {
                        if (this.GuiInfo.TopEmpty) {
                            index = 0;
                        } else {
                            index = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).lastOrDefault(null, null).RowNo;
                        }
                    }
                    Core.Extensions.EventExt.Done$1(System.Array.type(Core.Components.ListViewItem), this.AddRowsNo(copiedRows, index), Bridge.fn.bind(this, function (list) {
                        this.DuplicateRowSuccess(list, originalRows, copiedRows);
                    }));
                }));
            },
            DuplicateRowSuccess: function (list, originalRows, copiedRows) {
                list.forEach(function (x) {
                        x.Dirty = true;
                    });
                Core.Components.EditableComponent.prototype.Focus.call(this);
                Core.Extensions.EventExt.Done(Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterPasted, [originalRows, copiedRows]), Bridge.fn.bind(this, function () {
                    var $t;
                    this.RenderIndex();
                    this.ClearSelected();
                    if (this.GuiInfo.IsRealtime) {
                        $t = Bridge.getEnumerator(list);
                        try {
                            while ($t.moveNext()) {
                                var item = $t.Current;
                                item.PatchUpdateOrCreate();
                                item.Dirty = false;
                            }
                        } finally {
                            if (Bridge.is($t, System.IDisposable)) {
                                $t.System$IDisposable$Dispose();
                            }
                        }
                    }
                    Core.Extensions.Toast.Success("Sao ch\u00e9p d\u1eef li\u1ec7u th\u00e0nh c\u00f4ng !");
                }));
            },
            AddOrUpdateRow: function (rowData, singleAdd, force, fields) {
                if (singleAdd === void 0) { singleAdd = true; }
                if (force === void 0) { force = false; }
                if (fields === void 0) { fields = []; }
                var existRowData = System.Linq.Enumerable.from(this.MainSection.FilterChildren$1(function (x) {
                    return Bridge.is(x, Core.Components.ListViewItem) && Bridge.referenceEquals(x.Entity, rowData);
                })).select(function (x) { return Bridge.cast(x, Core.Components.ListViewItem); }).firstOrDefault(null, null);
                if (existRowData == null) {
                    if (!singleAdd) {
                        this.RowData.Data.add(rowData);
                    }
                    return this.AddRow(rowData, ((this.RowData.Data.Count - 1) | 0), singleAdd);
                }
                if (existRowData.EmptyRow) {
                    this.RowData.Data.add(rowData);
                }
                this.RowAction$2(function (x) {
                    return Bridge.referenceEquals(x.Entity, rowData);
                }, function (x) {
                    Core.Extensions.ReflectionExt.CopyPropFrom(existRowData.Entity, rowData);
                    x.EmptyRow = false;
                    x.UpdateView$1(force, fields);
                    x.Dirty = true;
                });
                if (singleAdd) {
                    this.AddNewEmptyRow();
                }
                return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
            },
            AddRow: function (rowData, index, singleAdd) {
                if (index === void 0) { index = 0; }
                if (singleAdd === void 0) { singleAdd = true; }
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                this.DisposeNoRecord();
                // if (MainSection.FirstOrDefault(x => x.Entity == rowData) is ListViewItem exists)
                // {
                //     return exists;
                // }

                if (singleAdd) {
                    this.RowData.Data.add(rowData);
                }
                Core.Extensions.EventExt.Done(Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforeCreated, [rowData]), Bridge.fn.bind(this, function () {
                    var row = this.RenderRowData(this.Header, rowData, this.MainSection, index);
                    tcs.trySetResult(row);
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterCreated, [rowData]));
                }));
                return tcs.task;
            },
            DisposeNoRecord: function () {
                this._noRecord != null ? this._noRecord.Dispose() : null;
                this._noRecord = null;
            },
            AddRows: function (rows, index) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $task2, 
                    $taskResult2, 
                    $task3, 
                    $taskResult3, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    indextemp, 
                    listItem, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3], $step);
                                switch ($step) {
                                    case 0: {
                                        if (index === void 0) { index = 0; }
                                        if (index < 0) {
                                            index = 0;
                                        }
                                        indextemp = index;
                                        Core.Extensions.IEnumerableExtensions.SelectForEach(System.Object, rows, Bridge.fn.bind(this, function (row) {
                                            if (Bridge.is(this.RowData.Data, System.Collections.IList)) {
                                                this.RowData.Data.insert(indextemp, row);
                                            } else {
                                                this.RowData.Data.add(row);
                                            }
                                            indextemp = (indextemp + 1) | 0;
                                        }));
                                        $task1 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforeCreatedList, [rows]);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        listItem = new (System.Collections.Generic.List$1(Core.Components.ListViewItem)).ctor();
                                        indextemp = index;
                                        $task2 = Core.Extensions.IEnumerableExtensions.ForEachAsync(System.Object, System.Linq.Enumerable.from(rows, System.Object).reverse(), Bridge.fn.bind(this, function (data) {
                                            var $step = 0,
                                                $task1, 
                                                $taskResult1, 
                                                $jumpFromFinally, 
                                                $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                                                $returnValue, 
                                                $async_e, 
                                                $asyncBody = Bridge.fn.bind(this, function () {
                                                    try {
                                                        for (;;) {
                                                            $step = System.Array.min([0,1], $step);
                                                            switch ($step) {
                                                                case 0: {
                                                                    $task1 = this.AddRow(data, indextemp, false);
                                                                    $step = 1;
                                                                    if ($task1.isCompleted()) {
                                                                        continue;
                                                                    }
                                                                    $task1.continue($asyncBody);
                                                                    return;
                                                                }
                                                                case 1: {
                                                                    $taskResult1 = $task1.getAwaitedResult();
                                                                    listItem.add($taskResult1);
                                                                    indextemp = (indextemp + 1) | 0;
                                                                    $tcs.setResult(null);
                                                                    return;
                                                                }
                                                                default: {
                                                                    $tcs.setResult(null);
                                                                    return;
                                                                }
                                                            }
                                                        }
                                                    } catch($async_e1) {
                                                        $async_e = System.Exception.create($async_e1);
                                                        $tcs.setException($async_e);
                                                    }
                                                }, arguments);

                                            $asyncBody();
                                            return $tcs.task;
                                        }));
                                        $step = 2;
                                        if ($task2.isCompleted()) {
                                            continue;
                                        }
                                        $task2.continue($asyncBody);
                                        return;
                                    }
                                    case 2: {
                                        $taskResult2 = $task2.getAwaitedResult();
                                        $task3 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterCreatedList, [rows]);
                                        $step = 3;
                                        if ($task3.isCompleted()) {
                                            continue;
                                        }
                                        $task3.continue($asyncBody);
                                        return;
                                    }
                                    case 3: {
                                        $taskResult3 = $task3.getAwaitedResult();
                                        this.AddNewEmptyRow();
                                        $tcs.setResult(listItem);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            AddRowsNo: function (rows, index) {
                if (index === void 0) { index = 0; }
                if (index < 0) {
                    index = 0;
                }
                var indextemp = index;
                Core.Extensions.IEnumerableExtensions.SelectForEach(System.Object, rows, Bridge.fn.bind(this, function (row) {
                    if (Bridge.is(this.RowData.Data, System.Collections.IList)) {
                        this.RowData.Data.insert(indextemp, row);
                    } else {
                        this.RowData.Data.add(row);
                    }
                    indextemp = (indextemp + 1) | 0;
                }));
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done(Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforeCreatedList, [rows]), Bridge.fn.bind(this, function () {
                    var tasks = Core.Extensions.IEnumerableExtensions.SelectForEach$2(System.Object, System.Threading.Tasks.Task$1(Core.Components.ListViewItem), rows, Bridge.fn.bind(this, function (data, innerIndex) {
                        return this.AddRow(data, ((innerIndex + index) | 0), false);
                    }));
                    Core.Extensions.EventExt.Done$1(System.Array.type(Core.Components.ListViewItem), System.Threading.Tasks.Task.whenAll(tasks), Bridge.fn.bind(this, function (result) {
                        this.AddNewEmptyRow();
                        Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterCreatedList, [rows]));
                        tcs.trySetResult(result);
                    }));
                }));
                return tcs.task;
            },
            RemoveRowById: function (id) {
                var $t;
                var row = System.Linq.Enumerable.from(this.RowData.Data, System.Object).firstOrDefault(function (x) {
                        var $t;
                        return Bridge.referenceEquals((($t = x[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null), id);
                    }, null);
                if (row != null) {
                    this.RowData.Data.remove(row);
                }
                ($t = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.EntityId, id);
                        }, null)) != null ? $t.Dispose() : null;
            },
            RemoveRow: function (row) {
                var $t;
                if (row == null) {
                    return;
                }

                this.RowData.Data.remove(row);
                ($t = Core.Components.Extensions.ComponentExt.FirstOrDefault(this.MainSection, function (x) {
                        return Bridge.referenceEquals(x.Entity, row);
                    })) != null ? $t.Dispose() : null;
            },
            /**
             * Updating row data
             *
             * @instance
             * @public
             * @this Core.Components.ListView
             * @memberof Core.Components.ListView
             * @param   {System.Object}     rowData      The row object to update
             * @param   {boolean}           force        
             * @param   {Array.<string>}    fieldName    Left this default to update all cells
             * @return  {void}
             */
            UpdateRow: function (rowData, force, fieldName) {
                if (force === void 0) { force = false; }
                if (fieldName === void 0) { fieldName = []; }
                this.RowAction$2(function (row) {
                    return Bridge.referenceEquals(row.Entity, rowData);
                }, function (row) {
                    System.Linq.Enumerable.from(row.Children, Core.Components.EditableComponent).where(function (x) {
                            return Core.Extensions.IEnumerableExtensions.Nothing(System.String, fieldName) || System.Array.contains(fieldName, x.FieldName, System.String);
                        }).forEach(function (x) {
                        x.UpdateView$1(force);
                    });
                });
            },
            ClearRowData: function () {
                var $t, $t1, $t2;
                ($t = this.RowData) != null && ($t1 = $t.Data) != null ? $t1.clear() : null;
                this.RowAction$2(function (x) {
                    return !x.EmptyRow;
                }, function (x) {
                    x.Dispose();
                });
                this.MainSection.Element.innerHTML = null;
                if (this.Entity == null || Bridge.is(this.Parent, Core.Components.SearchEntry)) {
                    return;
                }
                if (this.ShouldSetEntity) {
                    ($t2 = this.Entity) != null ? Core.Extensions.BridgeExt.SetComplexPropValue($t2, this.FieldName, this.RowData.Data) : null;
                }
            },
            UpdateView: function (force, dirty, componentNames) {
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                if (!this.Editable) {
                    if (force) {
                        this.ListViewSearch.RefershListView();
                    }
                } else {
                    this.RowAction$2(function (row) {
                        return !row.EmptyRow;
                    }, function (row) {
                        row.UpdateView(force, dirty, componentNames);
                    });
                }
            },
            ValidateAsync: function () {
                this.ValidationResult.clear();
                this.ValidateRequired$1();
                return System.Threading.Tasks.Task.fromResult(this.IsValid, System.Boolean);
            },
            ValidateRequired$1: function () {
                if (this.Element == null || Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule), this.ValidationRules)) {
                    return true;
                }

                if (!this.ValidationRules.containsKey(Core.Extensions.ValidationRule.Required)) {
                    this.Element.removeAttribute(Core.Extensions.ValidationRule.Required);
                    return true;
                }
                var requiredRule = this.ValidationRules.getItem(Core.Extensions.ValidationRule.Required);
                this.Element.setAttribute(Core.Extensions.ValidationRule.Required, System.Boolean.toString((true)));
                if (Core.Extensions.IEnumerableExtensions.HasElement(System.Object, this.RowData.Data)) {
                    this.ValidationResult.remove(Core.Extensions.ValidationRule.Required);
                    return true;
                } else {
                    System.Collections.Generic.CollectionExtensions.TryAdd(System.String, System.String, this.ValidationResult, Core.Extensions.ValidationRule.Required, System.String.format(requiredRule.Message, Core.Components.LangSelect.Get(this.GuiInfo.Label), this.Entity));
                    return false;
                }
            },
            CopySelected: function (ev) {
                Core.Components.ListView._originRows = this.GetSelectedRows();
                Core.Components.ListView._copiedRows = Core.Extensions.ReflectionExt.CloneRows(Core.Components.ListView._originRows);
                (window).navigator.clipboard.writeText(JSON.stringify(Bridge.unbox(Core.Components.ListView._copiedRows)));
                System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterCopied, [Core.Components.ListView._originRows, Core.Components.ListView._copiedRows]);
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                }));
            },
            DisposeHistory: function () {
                this._history.remove();
            },
            ViewHistory: function (ev) {
                var currentItem = System.Linq.Enumerable.from(this.GetSelectedRows(), System.Object).lastOrDefault(null, null);
                Core.Components.Renderer.Escape(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.EditForm.Element).Div, "backdrop").Style$1("align-items: center;"), Bridge.fn.bind(this, function (e) {
                    this.Dispose();
                }));
                this._history = Core.MVVM.Html.Context;
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "popup-content confirm-dialog").Style$1("top: 0;").Div, "popup-title").InnerHTML("Xem l\u1ecbch s\u1eed").Div, "icon-box").Span, "fa fa-times").Event("click", Bridge.fn.cacheBind(this, this.DisposeHistory)).EndOf$1(".popup-title").Div, "popup-body scroll-content");
                var body = Core.MVVM.Html.Context; /// Simplify object initialization


                var com = new Core.Models.Component();
                com.Id = Core.Structs.Uuid7.Id25();
                com.FieldName = "Conditions";
                com.Column = 4;
                com.ReferenceId = Core.Extensions.Utils.GetEntity("History").Id;
                com.RefName = "History";
                com.DataSourceFilter = System.String.format("?$orderby=Id desc&$filter=Active eq true and EntityId eq '{0}' and RecordId eq '{1}'", this.GuiInfo.ReferenceId, currentItem[Core.Components.EditableComponent.IdField]);
                var _filterGrid = new Core.Components.GridView(com);
                _filterGrid.GuiInfo.LocalHeader = function (_o1) {
                        var $t;
                        _o1.add(($t = new Core.Models.Component(), $t.Id = Bridge.toString((1)), $t.EntityId = Core.Extensions.Utils.GetEntity("History").Id, $t.FieldName = "InsertedBy", $t.ShortDesc = "Ng\u01b0\u1eddi thay \u0111\u1ed5i", $t.ReferenceId = Core.Extensions.Utils.GetEntity("User").Id, $t.RefName = "User", $t.FormatData = "{FullName}", $t.Active = true, $t.ComponentType = "SearchEntry", $t.MaxWidth = "100px", $t.MinWidth = "100px", $t));
                        _o1.add(($t = new Core.Models.Component(), $t.Id = Bridge.toString((2)), $t.EntityId = Core.Extensions.Utils.GetEntity("History").Id, $t.FieldName = "InsertedDate", $t.ShortDesc = "Ng\u00e0y thay \u0111\u1ed5i", $t.Active = true, $t.FormatData = "{0: dd/MM/yyyy HH:mm}", $t.ComponentType = "Datepicker", $t.TextAlign = "left", $t.MaxWidth = "150px", $t.MinWidth = "150px", $t));
                        _o1.add(($t = new Core.Models.Component(), $t.Id = Bridge.toString((4)), $t.EntityId = Core.Extensions.Utils.GetEntity("History").Id, $t.FieldName = "TextHistory", $t.ShortDesc = "D\u1eef li\u1ec7u thay \u0111\u1ed5i", $t.Active = true, $t.ComponentType = "Label", $t.MaxWidth = "700px", $t.MinWidth = "700px", $t));
                        return _o1;
                    }(new (System.Collections.Generic.List$1(Core.Models.Component)).ctor());
                _filterGrid.ParentElement = body;
                this.Parent.AddChild(_filterGrid);
            },
            SecurityRows: function (arg) {
                var $t, $t1;
                var selectedRowIds = System.Linq.Enumerable.from(this.GetSelectedRows(), System.Object).where(function (x) {
                        return System.Nullable.eq(Bridge.unbox(x[Core.Components.ListView.IsOwner]), true);
                    }).select(function (x) {
                    var $t;
                    return ($t = x[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null;
                }).ToArray(System.String);
                var security = ($t = new Core.Components.SecurityBL(), $t.Entity = ($t1 = new Core.ViewModels.SecurityVM(), $t1.RecordIds = selectedRowIds, $t1.EntityId = this.GuiInfo.ReferenceId, $t1), $t.ParentElement = this.TabEditor.Element, $t);
                this.TabEditor.AddChild(security);
            },
            CanDo: function (gridPolicies, permissionPredicate) {
                var featurePolicy = System.Linq.Enumerable.from(this.EditForm.Feature.FeaturePolicy, Core.Models.FeaturePolicy).where(function (x) {
                        return x.EntityId == null;
                    }).any(permissionPredicate);
                if (!featurePolicy) {
                    return false;
                }
                var Component = System.Linq.Enumerable.from(gridPolicies, Core.Models.FeaturePolicy).any();
                if (!Component) {
                    return true;
                }
                return System.Linq.Enumerable.from(gridPolicies, Core.Models.FeaturePolicy).any(permissionPredicate);
            },
            TbodyContextMenu: function (e) {
                Core.Components.Forms.ContextMenu.Instance.MenuItems.clear();
                !Bridge.staticEquals(this.BodyContextMenuShow, null) ? this.BodyContextMenuShow() : null;
                if (this.Disabled) {
                    return;
                }
                this.SetSelected(e);
                var selectedRows = this.GetSelectedRows();
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, selectedRows)) {
                    return;
                }
                var ctxMenu = Core.Components.Forms.ContextMenu.Instance;
                var gridPolicies = this.EditForm.GetElementPolicies(this.GuiInfo.Id, Core.Extensions.Utils.ComponentId);
                var canWrite = this.GuiInfo.CanAdd && this.CanWrite;
                Core.Extensions.EventExt.Done(this.RenderViewMenu(), Bridge.fn.bind(this, function () {
                    this.RenderCopyPasteMenu(canWrite);
                    this.RenderEditMenu(selectedRows, gridPolicies);
                    Core.Extensions.EventExt.Done(this.RenderShareMenu(selectedRows, gridPolicies), Bridge.fn.bind(this, function () {
                        ctxMenu.Top = Core.Extensions.EventExt.Top(e);
                        ctxMenu.Left = Core.Extensions.EventExt.Left(e);
                        ctxMenu.Render();
                        this.Element.appendChild(ctxMenu.Element);
                        ctxMenu.Element.style.position = System.Enum.toString(Core.Components.Position, Core.Components.Position.absolute);
                    }));
                }));
            },
            SetSelected: function (e) {
                var target = Bridge.as(e.target, HTMLElement);
                var rawRow = Core.Extensions.HtmlElementExtension.Closest(target, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.tr));
                var currentRow = Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(this, function (x) {
                    return Bridge.referenceEquals(x.Element, rawRow);
                }), Core.Components.ListViewItem);
                if (currentRow == null) {
                    return;
                }
                if (!(Bridge.is(currentRow, Core.Components.GroupViewItem)) || this.GuiInfo.GroupReferenceId != null) {
                    if (this.SelectedIds.Count === 1) {
                        this.ClearSelected();
                    }
                    currentRow.Selected = true;
                    this.LastListViewItem = currentRow;
                    this.SelectedIndex = currentRow.ListViewSection.Children.indexOf(currentRow);
                }
            },
            RenderViewMenu: function () {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Object), Core.Clients.Client.Instance.GetByIdAsync("EntityRef", this.GuiInfo.ConnKey, [this.GuiInfo.Id]), Bridge.fn.bind(this, function (targetRef) {
                    var $t;
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, targetRef)) {
                        tcs.trySetResult(null);
                        return;
                    }
                    var tRef = Bridge.unbox(targetRef);
                    var menuItems = System.Linq.Enumerable.from(tRef, Core.Models.EntityRef).select(Bridge.fn.bind(this, function (x) {
                            var $t;
                            return ($t = new Core.Components.Forms.ContextMenuItem(), $t.Text = x.MenuText, $t.Click = Bridge.fn.bind(this, function (arg) {
                                this.OpenFeature(x);
                            }), $t);
                        })).toList(Core.Components.Forms.ContextMenuItem);
                    Core.Components.Forms.ContextMenu.Instance.MenuItems.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fal fa-ellipsis-h", $t.Text = "D\u1eef li\u1ec7u li\u00ean quan", $t.MenuItems = menuItems, $t));
                    tcs.trySetResult(null);
                }));
                return tcs.task;
            },
            OpenFeature: function (e) {
                var instance = System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs, Core.Components.Forms.TabEditor).where(function (x) {
                        return Bridge.referenceEquals(x.Name, e.ViewClass);
                    }).firstOrDefault(null, null);
                if (instance != null) {
                    instance.Focus();
                    this.Filter(instance, e);
                    this._hasLoadRef = true;
                    return;
                }
                this._hasLoadRef = false;
                Core.Extensions.EventExt.Done$1(Core.Models.Feature, Core.Components.Extensions.ComponentExt.LoadFeature(this.ConnKey, e.ViewClass), Bridge.fn.bind(this, function (currentFeature) {
                    var id = (currentFeature.Name || "") + (currentFeature.Id || "");
                    var type;
                    if (currentFeature.ViewClass != null) {
                        type = Bridge.Reflection.getType(currentFeature.ViewClass);
                    } else {
                        type = Core.Components.Forms.TabEditor;
                    }
                    instance = Bridge.as(Bridge.createInstance(type), Core.Components.Forms.TabEditor);
                    instance.Name = currentFeature.Name;
                    instance.Id = id;
                    instance.Icon = currentFeature.Icon;
                    instance.Feature = currentFeature;
                    instance.Render();
                    instance.DOMContentLoaded = Bridge.fn.combine(instance.DOMContentLoaded, Bridge.fn.bind(this, function () {
                        var gridView1 = System.Linq.Enumerable.from(instance.FilterChildren(Core.Components.GridView), Core.Components.GridView).firstOrDefault(function (x) {
                                return Bridge.referenceEquals(x.GuiInfo.Id, e.TargetComId);
                            }, null);
                        gridView1.DOMContentLoaded = Bridge.fn.combine(gridView1.DOMContentLoaded, Bridge.fn.bind(this, function () {
                            if (this._hasLoadRef) {
                                return;
                            }
                            this.Filter(instance, e);
                            this._hasLoadRef = true;
                        }));
                    }));
                }));
            },
            Filter: function (fe, e) {
                var gridView1 = System.Linq.Enumerable.from(fe.FilterChildren(Core.Components.GridView), Core.Components.GridView).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.GuiInfo.Id, e.TargetComId);
                    }, null);
                if (gridView1 == null) {
                    return;
                }
                gridView1.CellSelected.clear();
                gridView1.AdvSearchVM.Conditions.clear();
                gridView1.ListViewSearch.EntityVM.StartDate = null;
                gridView1.ListViewSearch.EntityVM.EndDate = null;
                Core.Extensions.EventExt.Done$1(System.Collections.Generic.List$1(System.Object), this.GetRealTimeSelectedRows(), function (selecteds) {
                    var com = System.Linq.Enumerable.from(gridView1.Header, Core.Models.Component).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.FieldName, e.TargetFieldName);
                        }, null);
                    var cellSelecteds = System.Linq.Enumerable.from(selecteds, System.Object).select(function (selected) {
                            var $t;
                            return ($t = new Core.Models.CellSelected(), $t.FieldName = e.TargetFieldName, $t.FieldText = com.ShortDesc, $t.ComponentType = com.ComponentType, $t.Value = Bridge.toString(Core.Extensions.Utils.GetPropValue(selected, e.FieldName)), $t.ValueText = Bridge.toString(Core.Extensions.Utils.GetPropValue(selected, e.FieldName)), $t.Operator = Core.Enums.OperatorEnum.In, $t.OperatorText = "Ch\u1ee9a", $t.Logic = Core.Enums.LogicOperation.Or, $t.IsSearch = true, $t.Group = true, $t);
                        });
                    gridView1.CellSelected.AddRange(cellSelecteds);
                    gridView1.ActionFilter();
                });
            },
            RenderCopyPasteMenu: function (canWrite) {
                //
            },
            RenderEditMenu: function (selectedRows, gridPolicies) {
                var $t;
                Core.Components.Forms.ContextMenu.Instance.MenuItems.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-history", $t.Text = "Xem l\u1ecbch s\u1eed", $t.Click = Bridge.fn.cacheBind(this, this.ViewHistory), $t));
                Core.Components.Forms.ContextMenu.Instance.MenuItems.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "mif-unlink", $t.Text = "H\u1ee7y (kh\u00f4ng x\u00f3a)", $t.Click = Bridge.fn.cacheBind(this, this.DeactivateSelected), $t));
                Core.Components.Forms.ContextMenu.Instance.MenuItems.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-trash", $t.Text = "X\u00f3a d\u1eef li\u1ec7u", $t.Click = Bridge.fn.cacheBind(this, this.HardDeleteSelected), $t));
            },
            RenderShareMenu: function (selectedRows, gridPolicies) {
                var noPolicyRows = System.Linq.Enumerable.from(selectedRows, System.Object).where(Bridge.fn.bind(this, function (x) {
                        var hasPolicy = System.Linq.Enumerable.from(this.RecordPolicy, Core.Models.FeaturePolicy).any(Bridge.fn.bind(this, function (f) {
                                var $t;
                                return Bridge.referenceEquals(f.EntityId, this.GuiInfo.ReferenceId) && Bridge.referenceEquals(f.RecordId, (($t = x[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null));
                            }));
                        var loaded = Bridge.unbox(x[Core.Components.ListView.PermissionLoaded]);
                        return !(hasPolicy || System.Nullable.eq(loaded, true));
                    }));
                var noPolicyRowIds = noPolicyRows.select(function (x) {
                    return Bridge.unbox(x[Core.Components.EditableComponent.IdField]);
                }).ToArray(System.String);
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done$1(System.Array.type(Core.Models.FeaturePolicy), Core.Components.ListView.LoadRecordPolicy(this.ConnKey, this.GuiInfo.RefName, noPolicyRowIds), Bridge.fn.bind(this, function (rowPolicy) {
                    var $t;
                    rowPolicy.forEach(Bridge.fn.cacheBind(this.RecordPolicy, this.RecordPolicy.add));
                    noPolicyRows.forEach(function (x) {
                        x[Core.Components.ListView.PermissionLoaded] = Bridge.box(true, System.Boolean, System.Boolean.toString);
                    });
                    var ownedRecords = System.Linq.Enumerable.from(selectedRows, System.Object).where(function (x) {
                            var isOwner = Core.Extensions.Utils.IsOwner(x);
                            x[Core.Components.ListView.IsOwner] = Bridge.box(isOwner, System.Boolean, System.Boolean.toString);
                            return isOwner;
                        }).select(function (x) {
                        return Bridge.unbox(x[Core.Components.EditableComponent.IdField]);
                    }).toList(System.String);
                    var canShare = this.CanDo(gridPolicies, function (x) {
                        return x.CanShare;
                    }) && System.Linq.Enumerable.from(ownedRecords, System.String).any();
                    if (!canShare) {
                        tcs.trySetResult(null);
                        return;
                    }
                    Core.Components.Forms.ContextMenu.Instance.MenuItems.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "mif-security", $t.Text = "B\u1ea3o m\u1eadt & Ph\u00e2n quy\u1ec1n", $t.Click = Bridge.fn.cacheBind(this, this.SecurityRows), $t));
                    tcs.trySetResult(null);
                }));
                return tcs.task;
            },
            MoveDown: function () {
                this.ClearSelected();
                if (this.SelectedIndex === -1 || this.SelectedIndex === System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).count()) {
                    this.SelectedIndex = 0;
                }
                this.RowAction$1(function (x) {
                    x.Selected = true;
                }, false);
            },
            MoveUp: function () {
                this.ClearSelected();
                if (this.SelectedIndex <= 0 || this.SelectedIndex === System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).count()) {
                    this.SelectedIndex = (System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).count() - 1) | 0;
                }
                this.RowAction$1(function (x) {
                    x.Selected = true;
                }, true);
            },
            ClearSelected: function (ids) {
                if (ids === void 0) { ids = []; }
                var shouldClear = System.Linq.Enumerable.from(ids, System.String).any() ? System.Linq.Enumerable.from(this.SelectedIds, System.String).intersect(ids).ToArray(System.String) : this.SelectedIds.ToArray();
                shouldClear.forEach(Bridge.fn.bind(this, function (x) {
                        this.SelectedIds.remove(x);
                    }));
                System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).where(function (x) {
                        return System.Array.contains(shouldClear, x.EntityId, System.String);
                    }).forEach(function (x) {
                    return (x.Selected = false, false);
                });
                this.LastListViewItem = null;
            },
            RowAction$1: function (action, sub) {
                var row = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(Bridge.fn.bind(this, function (x) {
                        return x.RowNo === (sub ? (((this.SelectedIndex - 1) | 0)) : (((this.SelectedIndex + 1) | 0)));
                    }), null);
                if (row == null) {
                    return;
                }
                if (sub) {
                    this.SelectedIndex = (this.SelectedIndex - 1) | 0;
                } else {
                    this.SelectedIndex = (this.SelectedIndex + 1) | 0;
                }
                if (row.GroupRow) {
                    row = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(Bridge.fn.bind(this, function (x) {
                            return x.RowNo === (sub ? (((this.SelectedIndex - 1) | 0)) : (((this.SelectedIndex + 1) | 0)));
                        }), null);
                }
                action(row);
            },
            RowAction: function (action) {
                var $t;
                ($t = Core.Components.ListViewItem, System.Linq.Enumerable.from(this.AllListViewItem, $t).toList($t)).ForEach(action);
            },
            RowAction$2: function (predicate, action) {
                System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).where(function (x) {
                        return Bridge.staticEquals(predicate, null) || predicate(x);
                    }).toList(Core.Components.ListViewItem).ForEach(function (x) {
                    action(x);
                });
            },
            IsRowDirty: function (row) {
                return System.Linq.Enumerable.from(this.GetListViewItems(row), Core.Components.ListViewItem).any(function (x) {
                        return x.Dirty;
                    });
            },
            GetListViewItems: function (row) {
                return System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).where(function (x) {
                        return Bridge.referenceEquals(x.Entity[Core.Components.EditableComponent.IdField], row[Core.Components.EditableComponent.IdField]);
                    });
            },
            BatchUpdate: function (updateView) {
                if (updateView === void 0) { updateView = false; }
                if (!this.Dirty) {
                    return;
                }
                Core.Extensions.EventExt.Done(Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforePatchCreate, [this.Entity, null, this]), Bridge.fn.bind(this, function () {
                    var $t;
                    $t = Bridge.getEnumerator(this.UpdatedListItems);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            item.PatchUpdateOrCreate();
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                }));
            },
            GetRowCountByHeight: function (scrollTop) {
                return Bridge.Int.clip32(Bridge.Math.round(scrollTop / this._rowHeight, 0, 5));
            },
            SetRowHeight: function () {
                var $t;
                var existRow = ($t = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(null, null)) != null ? $t.Element : null;
                if (existRow != null) {
                    this._rowHeight = existRow.scrollHeight > 0 ? existRow.scrollHeight : this._rowHeight;
                }
            },
            GetUserSetting: function (prefix) {
                var $t, $t1;
                return Core.Clients.Client.Instance.SubmitAsync(System.Array.type(System.Array.type(System.Object)), ($t = new Core.Clients.XHRWrapper(), $t.Url = Core.Extensions.Utils.UserSvc, $t.Value = ($t1 = new Core.ViewModels.SqlViewModel(), $t1.ComId = "UserSetting", $t1.Action = "GetByComId", $t1.Params = JSON.stringify(new $asm.$AnonymousType$9(this.GuiInfo.Id, prefix)), $t1), $t.Method = Core.Enums.HttpMethod.POST, $t));
            },
            UpdateSetting: function (setting, prefix, value) {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                var patch;
                if (setting == null) {
                    patch = this.CreateSettingPatch(prefix, Core.Structs.Uuid7.Id25(), value);
                } else {
                    setting.Value = value;
                    patch = this.CreateSettingPatch(prefix, setting.Id, value, setting.Id);
                }
                Core.Extensions.EventExt.Done$1(System.Int32, Core.Clients.Client.Instance.PatchAsync(patch), function (r) {
                    tcs.trySetResult(r > 0);
                });
                return tcs.task;
            },
            CreateSettingPatch: function (prefix, newId, value, oldId) {
                var $t, $t1;
                if (oldId === void 0) { oldId = null; }
                var patch = ($t = new Core.ViewModels.PatchVM(), $t.Changes = Bridge.fn.bind(this, function (_o1) {
                        var $t1;
                        _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "Name", $t1.Value = System.String.format("{0}-{1}", prefix, this.GuiInfo.Id), $t1));
                        _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "UserId", $t1.Value = Core.Clients.Client.Token.UserId, $t1));
                        _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "Value", $t1.Value = value, $t1));
                        return _o1;
                    })(new (System.Collections.Generic.List$1(Core.ViewModels.PatchDetail)).ctor()), $t.Table = "UserSetting", $t.ConnKey = ($t1 = this.ConnKey, $t1 != null ? $t1 : Core.Clients.Client.ConnKey), $t);
                patch.Changes.add(($t = new Core.ViewModels.PatchDetail(), $t.Field = Core.Components.EditableComponent.IdField, $t.Value = newId, $t.OldVal = oldId, $t));
                return patch;
            },
            Dispose: function () {
                window.removeEventListener("", Bridge.fn.cacheBind(this, this.RealtimeUpdateListViewItem));
                Core.Components.EditableComponent.prototype.Dispose.call(this);
            }
        }
    });

    Bridge.define("$AnonymousType$8", $asm, {
        $kind: "anonymous",
        ctors: {
            ctor: function (ids, table) {
                this.ids = ids;
                this.table = table;
            }
        },
        methods: {
            equals: function (o) {
                if (!Bridge.is(o, $asm.$AnonymousType$8)) {
                    return false;
                }
                return Bridge.equals(this.ids, o.ids) && Bridge.equals(this.table, o.table);
            },
            getHashCode: function () {
                var h = Bridge.addHash([7550196193, this.ids, this.table]);
                return h;
            },
            toJSON: function () {
                return {
                    ids : this.ids,
                    table : this.table
                };
            }
        },
        statics : {
            methods: {
                $metadata : function () { return {"m":[{"a":2,"n":"ids","t":16,"rt":System.Array.type(System.String),"g":{"a":2,"n":"get_ids","t":8,"rt":System.Array.type(System.String),"fg":"ids"},"fn":"ids"},{"a":2,"n":"table","t":16,"rt":System.String,"g":{"a":2,"n":"get_table","t":8,"rt":System.String,"fg":"table"},"fn":"table"}]}; }
            }
        }
    });

    Bridge.define("$AnonymousType$9", $asm, {
        $kind: "anonymous",
        ctors: {
            ctor: function (comId, prefix) {
                this.ComId = comId;
                this.Prefix = prefix;
            }
        },
        methods: {
            equals: function (o) {
                if (!Bridge.is(o, $asm.$AnonymousType$9)) {
                    return false;
                }
                return Bridge.equals(this.ComId, o.ComId) && Bridge.equals(this.Prefix, o.Prefix);
            },
            getHashCode: function () {
                var h = Bridge.addHash([7550196194, this.ComId, this.Prefix]);
                return h;
            },
            toJSON: function () {
                return {
                    ComId : this.ComId,
                    Prefix : this.Prefix
                };
            }
        },
        statics : {
            methods: {
                $metadata : function () { return {"m":[{"a":2,"n":"ComId","t":16,"rt":System.String,"g":{"a":2,"n":"get_ComId","t":8,"rt":System.String,"fg":"ComId"},"fn":"ComId"},{"a":2,"n":"Prefix","t":16,"rt":System.String,"g":{"a":2,"n":"get_Prefix","t":8,"rt":System.String,"fg":"Prefix"},"fn":"Prefix"}]}; }
            }
        }
    });

    Bridge.define("Core.Components.Datepicker", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                HHmmFormat: null,
                _calendar: null,
                _renderAwaiter: 0,
                _closeAwaiter: 0,
                formats: null
            },
            ctors: {
                init: function () {
                    this.HHmmFormat = "00";
                    this.formats = System.Array.init([
                        "dd/MM/yyyy - HH:mm", 
                        "dd/MM/yyyy - HH:m", 
                        "dd/MM/yyyy - h:mm", 
                        "dd/MM/yyyy - HH:", 
                        "dd/MM/yyyy - h:", 
                        "dd/MM/yyyy - h:m", 
                        "dd/MM/yyyy - HH", 
                        "dd/MM/yyyy - h", 
                        "dd/MM/yyyy", 
                        "ddMMyyyy", 
                        "d/M/yyyy", 
                        "dMyyyy", 
                        "dd/MM/yy", 
                        "ddMMyy", 
                        "d/M", 
                        "dM", 
                        "dd/MM", 
                        "ddMM"
                    ], System.String);
                }
            },
            methods: {
                TryParseDateTime: function (value) {
                    var dateTime = { v : System.DateTime.getNow() };
                    var parsed = false;
                    var format = null;
                    for (var i = System.Int64(0); i.lt(System.Int64(Core.Components.Datepicker.formats.length)); i = i.inc()) {
                        parsed = System.DateTime.tryParseExact(value, Core.Components.Datepicker.formats[System.Array.index(System.Int64.toNumber(i), Core.Components.Datepicker.formats)], System.Globalization.CultureInfo.invariantCulture, dateTime);
                        if (parsed) {
                            format = Core.Components.Datepicker.formats[System.Array.index(System.Int64.toNumber(i), Core.Components.Datepicker.formats)];
                            break;
                        }
                    }

                    return new (System.ValueTuple$3(System.Boolean,System.DateTime,System.String)).$ctor1(parsed, dateTime.v, format);
                }
            }
        },
        fields: {
            _value: null,
            _nullable: false,
            _simpleNoEvent: false,
            InitFormat: null,
            _currentFormat: null,
            show: false,
            _someday: null,
            _hour: null,
            _minute: null
        },
        props: {
            Input: null,
            Value: {
                get: function () {
                    return this._value;
                },
                set: function (value) {
                    if (Bridge.equals(this._value, value)) {
                        return;
                    }

                    this._value = value;
                    if (System.Nullable.hasValue(this._value)) {
                        var selectionEnd = this.Input.selectionEnd;
                        this.Input.value = !Bridge.equals(this._value, System.DateTime.getMinValue()) ? System.DateTime.format(System.Nullable.getValue(this._value), this._currentFormat) : "";
                        this.Input.selectionStart = selectionEnd;
                        this.Input.selectionEnd = selectionEnd;
                    } else if (!this._nullable) {
                        this._value = System.DateTime.getNow();
                        this.Input.value = System.DateTime.format(System.Nullable.getValue(this._value), this._currentFormat);
                    } else {
                        this.Input.value = null;
                    }

                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, Bridge.box(this._value, System.DateTime, System.Nullable.toStringFn(System.DateTime.format), System.Nullable.getHashCode));
                    this.Dirty = true;
                }
            }
        },
        ctors: {
            init: function () {
                this._someday = System.DateTime.getDefaultValue();
                this.InitFormat = "";
            },
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.GuiInfo = ui || (function () {
                    throw new System.ArgumentNullException.$ctor1("ui");
                })();
                this.InitFormat = Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FormatData) ? System.String.replaceAll(System.String.replaceAll(this.GuiInfo.FormatData, "{0:", ""), "}", "") : (System.Nullable.eq(this.GuiInfo.Precision, 7) ? "dd/MM/yyyy - HH:mm" : "dd/MM/yyyy");
                this._currentFormat = this.InitFormat;
                if (ele != null) {
                    var input;
                    if (!(((input = Bridge.as(ele.firstElementChild, HTMLInputElement))) != null)) {
                        input = Bridge.as(Core.MVVM.Html.Take(ele).Input.GetContext(), HTMLInputElement);
                    }
                    this.Input = input;
                }
            }
        },
        methods: {
            Render: function () {
                var $t, $t1, $t2;
                this.SetDefaultVal();
                var fieldValue = Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName);
                Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, Bridge.box(this._value, System.DateTime, System.Nullable.toStringFn(System.DateTime.format), System.Nullable.getHashCode));
                var parsedVal = { v : System.DateTime.getMinValue() };
                var strVal;
                var parsed = ((strVal = Bridge.as(fieldValue, System.String))) != null && Core.Extensions.StringExt.HasAnyChar(strVal) && System.DateTime.tryParse(strVal, null, parsedVal);
                this._value = parsed ? parsedVal.v : fieldValue == null ? null : (Core.Extensions.ReflectionExt.IsDate(Bridge.getType(fieldValue)) ? Bridge.cast(Bridge.unbox(fieldValue, System.DateTime), System.DateTime, true) : null);
                this._nullable = this.IsNullable(System.DateTimeOffset) || this.IsNullable(System.DateTime);
                Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, Bridge.box(this._value, System.DateTime, System.Nullable.toStringFn(System.DateTime.format), System.Nullable.getHashCode));
                var str = System.Nullable.hasValue(this._value) && !Bridge.equals(this._value, System.DateTime.getMinValue()) ? System.DateTime.format(System.Nullable.getValue(this._value), this.InitFormat) : "";
                this.OldValue = !Bridge.equals(this._value, System.DateTime.getMinValue()) ? !Bridge.equals(this._value, null) ? Core.Extensions.DateTimeExt.DateConverter(System.DateTime.format(System.Nullable.getValue(this._value))) : null : "";
                Core.MVVM.Html.Take(this.ParentElement);
                if (this.Input == null) {
                    Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "datetime-picker"), -1).Input.Render();
                    this.Element = ($t = Bridge.as(Core.MVVM.Html.Context, HTMLInputElement), this.Input = $t, $t);
                } else {
                    Core.MVVM.Html.Take(this.Input);
                    this.Element = this.Input;
                }
                Core.MVVM.Html.Instance.Event$1("keydown", Bridge.fn.bind(this, function (e) {
                    if (this.Disabled || e == null) {
                        return;
                    }
                    var code = Core.Extensions.EventExt.KeyCode(e);
                    if (code === Core.Enums.KeyCodeEnum.Enter) {
                        this.ParseDate();
                    }
                }));
                Core.Components.Renderer.PlaceHolder(Core.MVVM.Html.Instance.Value(str).Event("focus", Bridge.fn.bind(this, function () {
                    if (this._simpleNoEvent) {
                        this._simpleNoEvent = false;
                        return;
                    }
                    if (!this.GuiInfo.FocusSearch) {
                        this.RenderCalendar();
                    }
                })).Event("change", Bridge.fn.bind(this, function () {
                    this.ParseDate();
                })), this.GuiInfo.PlainText);
                this.Input.autocomplete = "off";
                this.Input.name = this.FieldName;
                this.Input.parentElement.addEventListener("focusout", Bridge.fn.cacheBind(this, this.CloseCalendar));
                this.Input.addEventListener("keydown", Bridge.fn.bind(this, function (e) {
                    var $step = 0,
                        $task1, 
                        $jumpFromFinally, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        $task1 = this.KeyDownDateTime(e);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $task1.getAwaitedResult();
                                        return;
                                    }
                                    default: {
                                        return;
                                    }
                                }
                            }
                        }, arguments);

                    $asyncBody();
                }));
                Core.Components.Renderer.ClassName(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div, "btn-group").Button, -1).Span, "icon mif-calendar").Event("click", Bridge.fn.bind(this, function () {
                    if (this.Input.disabled) {
                        return;
                    }

                    if (this.show) {
                        this.CloseCalendar();
                    } else {
                        this.RenderCalendar();
                    }
                }));
                ($t1 = Core.Extensions.HtmlElementExtension.Closest(this.Element, "td")) != null ? $t1.addEventListener("keydown", Bridge.fn.cacheBind(this, this.ListViewItemTab)) : null;
                !Bridge.staticEquals(($t2 = this.DOMContentLoaded), null) ? $t2() : null;
            },
            KeyDownDateTime: function (evt) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $task2, 
                    $task3, 
                    $taskResult3, 
                    $task4, 
                    $taskResult4, 
                    $task5, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    check, 
                    tcs, 
                    te, 
                    checkMulti, 
                    values, 
                    $t, 
                    current, 
                    startNo, 
                    varCount, 
                    gridView, 
                    $t1, 
                    item, 
                    upItem, 
                    updated, 
                    parsed, 
                    datetime, 
                    format, 
                    $t2, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3,4,5,6,7,8,10,11,12,13,14,16], $step);
                                switch ($step) {
                                    case 0: {
                                        if (System.Nullable.eq(Core.Extensions.EventExt.KeyCodeEnum(evt), Core.Enums.KeyCodeEnum.Enter) && Bridge.equals(this._value, null) && !this.EditForm.Feature.CustomNextCell) {
                                            if (this.Input.disabled) {
                                                $tcs.setResult(null);
                                                return;
                                            }

                                            if (this.show) {
                                                this.CloseCalendar();
                                            } else {
                                                this.RenderCalendar();
                                            }
                                        }
                                        if (!(Bridge.is(this.Parent, Core.Components.ListViewItem))) {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        check = System.Nullable.eq(Core.Extensions.EventExt.KeyCodeEnum(evt), Core.Enums.KeyCodeEnum.V) && Core.Extensions.EventExt.CtrlOrMetaKey(evt) && Core.Extensions.EventExt.ShiftKey(evt);
                                        tcs = new System.Threading.Tasks.TaskCompletionSource();
                                        if (check) {
                                            $step = 1;
                                            continue;
                                        } 
                                        $step = 16;
                                        continue;
                                    }
                                    case 1: {
                                        navigator.clipboard.readText().then(clipText => tcs.setResult(clipText));
                                        $task1 = tcs.task;
                                        $step = 2;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 2: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        te = $taskResult1;
                                        checkMulti = System.String.contains(te,"\r\n");
                                        if (checkMulti) {
                                            $step = 3;
                                            continue;
                                        } 
                                        $step = 15;
                                        continue;
                                    }
                                    case 3: {
                                        values = ($t = System.String, System.Linq.Enumerable.from(te.split("\r\n"), $t).toList($t));
                                        this.Input.value = values.getItem(0);
                                        this.ParseDate();
                                        current = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem, this);
                                        startNo = current.RowNo;
                                        varCount = (values.Count + startNo) | 0;
                                        gridView = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.VirtualGrid, this);
                                        gridView.AutoFocus = true;
                                        $t1 = Bridge.getEnumerator(System.Linq.Enumerable.from(values, System.String).take(((values.Count - 1) | 0)));
                                        $step = 4;
                                        continue;
                                    }
                                    case 4: {
                                        if ($t1.moveNext()) {
                                            item = $t1.Current;
                                            $step = 5;
                                            continue;
                                        }
                                        $step = 14;
                                        continue;
                                    }
                                    case 5: {
                                        upItem = System.Linq.Enumerable.from(gridView.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(function (x) {
                                            return x.RowNo === startNo;
                                        }, null);
                                        if (upItem == null) {
                                            $step = 6;
                                            continue;
                                        } 
                                        $step = 10;
                                        continue;
                                    }
                                    case 6: {
                                        if (startNo <= varCount) {
                                            $step = 7;
                                            continue;
                                        } 
                                        $step = 9;
                                        continue;
                                    }
                                    case 7: {
                                        $task2 = System.Threading.Tasks.Task.delay(1000);
                                        $step = 8;
                                        if ($task2.isCompleted()) {
                                            continue;
                                        }
                                        $task2.continue($asyncBody);
                                        return;
                                    }
                                    case 8: {
                                        $task2.getAwaitedResult();
                                        upItem = System.Linq.Enumerable.from(gridView.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(function (x) {
                                            return x.RowNo === startNo;
                                        }, null);
                                        $step = 9;
                                        continue;
                                    }

                                    case 10: {
                                        updated = System.Linq.Enumerable.from(upItem.FilterChildren(Core.Components.Datepicker, Bridge.fn.bind(this, function (x) {
                                            return Bridge.referenceEquals(x.FieldName, this.FieldName) && x.GuiInfo.Editable;
                                        })), Core.Components.Datepicker).firstOrDefault(null, null);
                                        updated.Dirty = true;
                                        parsed = { };
                                        datetime = { };
                                        format = { };
                                        Bridge.Deconstruct(Core.Components.Datepicker.TryParseDateTime(item).$clone(), parsed, datetime, format);
                                        updated.Value = datetime.v;
                                        updated.UpdateView();
                                        updated.PopulateFields();
                                        $task3 = Core.Components.Extensions.ComponentExt.DispatchEvent(updated, updated.GuiInfo.Events, "change", [upItem.Entity]);
                                        $step = 11;
                                        if ($task3.isCompleted()) {
                                            continue;
                                        }
                                        $task3.continue($asyncBody);
                                        return;
                                    }
                                    case 11: {
                                        $taskResult3 = $task3.getAwaitedResult();
                                        $task4 = Core.Components.Extensions.ComponentExt.DispatchEvent(upItem.ListViewSection.ListView, upItem.ListViewSection.ListView.GuiInfo.Events, "change", [upItem.Entity]);
                                        $step = 12;
                                        if ($task4.isCompleted()) {
                                            continue;
                                        }
                                        $task4.continue($asyncBody);
                                        return;
                                    }
                                    case 12: {
                                        $taskResult4 = $task4.getAwaitedResult();
                                        if (gridView.GuiInfo.IsRealtime) {
                                            upItem.PatchUpdateOrCreate();
                                        }
                                        ($t2 = gridView.DataTable.parentElement).scrollTop = ($t2.scrollTop + 26) | 0;
                                        startNo = (startNo + 1) | 0;
                                        $task5 = System.Threading.Tasks.Task.delay(300);
                                        $step = 13;
                                        if ($task5.isCompleted()) {
                                            continue;
                                        }
                                        $task5.continue($asyncBody);
                                        return;
                                    }
                                    case 13: {
                                        $task5.getAwaitedResult();
                                        $step = 4;
                                        continue;
                                    }
                                    case 14: {
                                        gridView.AutoFocus = false;
                                        $step = 15;
                                        continue;
                                    }

                                    case 16: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            IsNullable: function (T) {
                return this.Entity == null || Core.Extensions.Utils.IsNullable(T, Bridge.getType(this.Entity), this.FieldName, this.Entity);
            },
            ParseDate: function () {
                var parsed = { };
                var datetime = { };
                var format = { };
                Bridge.Deconstruct(Core.Components.Datepicker.TryParseDateTime(this.Input.value).$clone(), parsed, datetime, format);
                if (!parsed.v || Core.Extensions.StringExt.IsNullOrWhiteSpace(this.Input.value)) {
                    if (this.EditForm.Feature.CustomNextCell) {
                        return;
                    }
                    this.Input.value = "";
                    this.TriggerUserChange(null);
                } else {
                    this.Value = datetime.v;
                    this.TriggerUserChange(datetime.v);
                }
            },
            CloseCalendar: function () {
                Core.Components.Datepicker._closeAwaiter = window.setTimeout(Bridge.fn.bind(this, function () {
                    this.show = false;
                    if (Core.Components.Datepicker._calendar != null) {
                        Core.Components.Datepicker._calendar.style.display = "none";
                    }
                    this.Input.value = !Bridge.equals(this._value, null) ? System.DateTime.format(System.Nullable.getValue(this._value), this.InitFormat) : null;
                    this._hour = null;
                    this._minute = null;
                }), 250);
            },
            RenderCalendar: function (someday) {
                if (someday === void 0) { someday = null; }
                if (this.Disabled) {
                    return;
                }
                window.clearTimeout(Core.Components.Datepicker._renderAwaiter);
                window.clearTimeout(Core.Components.Datepicker._closeAwaiter);
                Core.Components.Datepicker._renderAwaiter = window.setTimeout(Bridge.fn.bind(this, function () {
                    this.RenderCalendarTask(someday);
                }), 100);
            },
            RenderCalendarTask: function (someday) {
                var $t, $t1, $t2;
                if (someday === void 0) { someday = null; }
                if (this.Disabled) {
                    return;
                }

                var _someday = ($t = someday, $t != null ? $t : ($t1 = this._value, $t1 != null ? $t1 : System.DateTime.getNow()));
                if (Bridge.equals(this._value, null)) {
                    _someday = System.DateTime.addHours(System.DateTime.getDate(_someday), 12);
                }

                this.show = true;
                window.clearTimeout(Core.Components.Datepicker._closeAwaiter);
                if (Core.Components.Datepicker._calendar != null) {
                    Core.Components.Datepicker._calendar.innerHTML = null;
                    Core.Components.Datepicker._calendar.style.display = "";
                } else {
                    Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div, "calendar compact open open-up"), -1).Trigger("focus");
                    Core.Components.Datepicker._calendar = Core.MVVM.Html.Context;
                }
                Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(Core.Components.Datepicker._calendar).Div, "calendar-header").Div, "header-year").Text(Bridge.toString(System.DateTime.getYear(_someday))).End.Div, "header-day").Text(System.String.format("{0}, {1:00} {2:00}", Bridge.box(System.DateTime.getDayOfWeek(_someday), System.DayOfWeek, System.Enum.toStringFn(System.DayOfWeek)), Bridge.box(System.DateTime.getMonth(_someday), System.Int32), Bridge.box(System.DateTime.getDay(_someday), System.Int32))).End.End.Div, "calendar-content").Div, "calendar-toolbar").Span, "prev-month").Event("click", Bridge.fn.bind(this, function () {
                    _someday = System.DateTime.addMonths(_someday, -1);
                    this.RenderCalendar(_someday);
                })).Span, "fa fa-chevron-left").End.End.Span, "curr-month").Text(System.String.format("{0:00}", [Bridge.box(System.DateTime.getMonth(_someday), System.Int32)])).End.Span, "next-month").Event("click", Bridge.fn.bind(this, function () {
                    _someday = System.DateTime.addMonths(_someday, 1);
                    this.RenderCalendar(_someday);
                })).Span, "fa fa-chevron-right").End.End.Span, "prev-year").Event("click", Bridge.fn.bind(this, function () {
                    _someday = System.DateTime.addYears(_someday, -1);
                    this.RenderCalendar(_someday);
                })).Span, "fa fa-chevron-left").End.End.Span, "curr-year").Text(Bridge.toString(System.DateTime.getYear(_someday))).End.Span, "next-year").Event("click", Bridge.fn.bind(this, function () {
                    _someday = System.DateTime.addYears(_someday, 1);
                    this.RenderCalendar(_someday);
                })).Span, "fa fa-chevron-right").End.End.End.Div, "week-days").Span, "day"), "Mo").End.Span, "day"), "Tu").End.Span, "day"), "We").End.Span, "day"), "Th").End.Span, "day"), "Fr").End.Span, "day"), "Sa").End.Span, "day"), "Su").End.End.Div, "days");

                var now = System.DateTime.getNow();
                var firstDayOfMonth = System.DateTime.create(System.DateTime.getYear(_someday), System.DateTime.getMonth(_someday), 1);
                var lastDayOfMonth = System.DateTime.addDays(System.DateTime.addMonths(firstDayOfMonth, 1), -1);
                var firstOutsideDayOfMonth = System.DateTime.addDays(firstDayOfMonth, ((((-System.DateTime.getDayOfWeek(firstDayOfMonth)) | 0) + 1) | 0));
                var lastOutsideDayOfMonth = System.DateTime.addDays(lastDayOfMonth, ((((6 - System.DateTime.getDayOfWeek(lastDayOfMonth)) | 0) + 1) | 0));
                if (((Bridge.Int.div((System.DateTime.subdd(lastOutsideDayOfMonth, firstOutsideDayOfMonth)).getDays(), 7)) | 0) < 5) {
                    lastOutsideDayOfMonth = System.DateTime.addDays(lastOutsideDayOfMonth, 7);
                }
                var runner = firstOutsideDayOfMonth;
                while (System.DateTime.lte(runner, lastOutsideDayOfMonth)) {
                    $t2 = Bridge.getEnumerator(System.Enum.getValues(System.DayOfWeek));
                    try {
                        while ($t2.moveNext()) {
                            var day = $t2.Current;
                            if (System.DateTime.getDayOfWeek(runner) === System.DayOfWeek.Monday) {
                                Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "days-row");
                            }
                            Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "day").Text(Bridge.toString(System.DateTime.getDay(runner))).Event$2(System.DateTime, "click", Bridge.fn.cacheBind(this, this.SetSelectedDay), runner);
                            if (System.DateTime.getDay(runner) === System.DateTime.getDay(now) && System.DateTime.getMonth(runner) === System.DateTime.getMonth(now) && System.DateTime.getYear(now) === System.DateTime.getYear(_someday)) {
                                Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance, "showed today");
                            }

                            if (System.Nullable.hasValue(this._value) && System.DateTime.getDay(runner) === System.DateTime.getDay(System.Nullable.getValue(this._value)) && System.DateTime.getMonth(runner) === System.DateTime.getMonth(System.Nullable.getValue(this._value)) && System.DateTime.getYear(runner) === System.DateTime.getYear(System.Nullable.getValue(this._value))) {
                                Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance, "selected");
                            }

                            if (System.DateTime.lt(runner, firstDayOfMonth) || System.DateTime.gt(runner, lastDayOfMonth)) {
                                Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance, "outside");
                            }

                            Core.MVVM.Html.Instance.End.Render();
                            if (System.DateTime.getDayOfWeek(runner) === System.DayOfWeek.Sunday) {
                                Core.MVVM.Html.Instance.End.Render();
                            }
                            runner = System.DateTime.addDays(runner, 1);
                        }
                    } finally {
                        if (Bridge.is($t2, System.IDisposable)) {
                            $t2.System$IDisposable$Dispose();
                        }
                    }
                }
                if (System.Nullable.eq(this.GuiInfo.Precision, 7)) {
                    Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.EndOf$1(".calendar-content").Div, "time-picker").Div, "hour"), "fa fa-chevron-up").Event("click", Bridge.fn.bind(this, function () {
                        this.IncreaseTime(System.Int64(1));
                    })).End.Input.Value(System.Int32.format(System.DateTime.getHour(_someday), Core.Components.Datepicker.HHmmFormat)).Event("focus", function () {
                        window.clearTimeout(Core.Components.Datepicker._closeAwaiter);
                    }).Event$1("change", Bridge.fn.cacheBind(this, this.ChangeHour)).Event$1("keydown", Bridge.fn.cacheBind(this, this.ChangeHourHotKey));
                    this._hour = Bridge.as(Core.MVVM.Html.Context, HTMLInputElement);
                    Core.MVVM.Html.Instance.End.Render();
                    Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.Icon(Core.MVVM.Html.Instance, "fa fa-chevron-down").Event("mousedown", Bridge.fn.bind(this, function () {
                        this.IncreaseTime(System.Int64(-1));
                    })).EndOf$1(".hour").Div, "minute"), "fa fa-chevron-up").Event("click", Bridge.fn.bind(this, function () {
                        this.IncreaseTime(System.Int64(10), true);
                    })).End.Input.Value(System.Int32.format(System.DateTime.getMinute(_someday), Core.Components.Datepicker.HHmmFormat)).Event("focus", function () {
                        window.clearTimeout(Core.Components.Datepicker._closeAwaiter);
                    }).Event$1("change", Bridge.fn.cacheBind(this, this.ChangeMinute)).Event$1("keydown", Bridge.fn.cacheBind(this, this.ChangeMinuteHotKey));
                    this._minute = Bridge.as(Core.MVVM.Html.Context, HTMLInputElement);
                    Core.Components.Renderer.Icon(Core.MVVM.Html.Instance.End, "fa fa-chevron-down").Event("mousedown", Bridge.fn.bind(this, function () {
                        this.IncreaseTime(System.Int64(-10), true);
                    })).EndOf$1(".minute");
                }
                Core.Components.Extensions.ComponentExt.AlterPosition(Core.Components.Datepicker._calendar, this.Element);
            },
            ChangeMinuteHotKey: function (e) {
                var keyCode = Core.Extensions.EventExt.KeyCode(e);
                if (keyCode === 38 || keyCode === 40) {
                    this.IncreaseTime(System.Int64(keyCode === 38 ? 1 : -1));
                }
            },
            ChangeHourHotKey: function (e) {
                var keyCode = Core.Extensions.EventExt.KeyCode(e);
                if (keyCode === 38 || keyCode === 40) {
                    this.IncreaseTime(System.Int64(keyCode === 38 ? 1 : -1));
                }
            },
            ChangeMinute: function (e) {
                if (Bridge.equals(this._value, null) || Bridge.equals(this._someday, System.DateTime.getMinValue())) {
                    this._value = this._someday;
                }
                var newMinute = { };

                var parsed = System.Int64.tryParse(this._minute.value, newMinute);
                if (!parsed || newMinute.v.lt(System.Int64(0)) || newMinute.v.gt(System.Int64(59))) {
                    return;
                }
                if (Bridge.equals(this._someday, System.DateTime.getMinValue()) && this.OldValue != null) {
                    var dateTime = System.DateTime.parse(this.OldValue);
                    this._someday = System.Nullable.eq(this.GuiInfo.Precision, 7) ? dateTime : System.DateTime.getNow();
                }
                this._someday = System.DateTime.addMinutes(System.DateTime.addMinutes(this._someday, ((-System.DateTime.getMinute(this._someday)) | 0)), System.Int64.toNumber(newMinute.v));
                var innerTime = this._someday;
                this.TriggerUserChange(innerTime);
            },
            ChangeHour: function (e) {
                var newHour = { };
                var parsed = System.Int64.tryParse(this._hour.value, newHour);
                if (!parsed || newHour.v.lt(System.Int64(0)) || newHour.v.gt(System.Int64(23))) {
                    return;
                }

                if (this.OldValue == null) {
                    this._someday = System.DateTime.getDate(System.DateTime.getNow());
                }
                if (Bridge.equals(this._someday, System.DateTime.getMinValue()) && this.OldValue != null) {
                    var dateTime = System.DateTime.parse(this.OldValue);
                    this._someday = System.Nullable.eq(this.GuiInfo.Precision, 7) ? dateTime : System.DateTime.getNow();
                }

                this._someday = System.DateTime.addHours(System.DateTime.addHours(this._someday, ((-System.DateTime.getHour(this._someday)) | 0)), System.Int64.toNumber(newHour.v));
                var innerTime = this._someday;
                this.TriggerUserChange(innerTime);
            },
            IncreaseTime: function (value, minute) {
                var $t;
                if (minute === void 0) { minute = false; }
                window.clearTimeout(Core.Components.Datepicker._closeAwaiter);
                var innerTime = ($t = this._value, $t != null ? $t : this._someday);
                if (!minute) {
                    innerTime = System.DateTime.addHours(innerTime, System.Int64.toNumber(value));
                    this._hour.value = System.Int32.format(System.DateTime.getHour(innerTime), Core.Components.Datepicker.HHmmFormat);
                } else {
                    innerTime = System.DateTime.addMinutes(innerTime, System.Int64.toNumber(value));
                    this._minute.value = System.Int32.format(System.DateTime.getMinute(innerTime), Core.Components.Datepicker.HHmmFormat);
                }
                this.TriggerUserChange(innerTime);
            },
            SetSelectedDay: function (selected) {
                if (!Bridge.equals(this._value, null)) {
                    selected = System.DateTime.addMinutes(System.DateTime.addHours(System.DateTime.getDate(selected), System.DateTime.getHour(System.Nullable.getValue(this._value))), System.DateTime.getMinute(System.Nullable.getValue(this._value)));
                } else {
                    selected = System.DateTime.addMinutes(System.DateTime.addHours(System.DateTime.getDate(selected), System.DateTime.getHour(this._someday)), System.DateTime.getMinute(this._someday));
                }
                this.TriggerUserChange(selected);
            },
            TriggerUserChange: function (selected, date) {
                var $t;
                if (date === void 0) { date = false; }
                if (this.Disabled) {
                    return;
                }
                var oldVal = this._value;
                this.Value = selected;
                if (!Bridge.staticEquals(this.UserInput, null)) {
                    this.UserInput(($t = new Core.MVVM.ObservableArgs(), $t.NewData = Bridge.box(this._value, System.DateTime, System.Nullable.toStringFn(System.DateTime.format), System.Nullable.getHashCode), $t.OldData = Bridge.box(oldVal, System.DateTime, System.Nullable.toStringFn(System.DateTime.format), System.Nullable.getHashCode), $t.EvType = "change", $t));
                }
                this.PopulateFields();
                this.CascadeField();
                this._simpleNoEvent = true;
                if (!date) {
                    this.Input.focus();
                }
                System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity]);
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                }));
            },
            UpdateView: function (force, setDirty, componentNames) {
                var $t, $t1;
                if (force === void 0) { force = false; }
                if (setDirty === void 0) { setDirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                var value = ($t = this.Entity) != null ? Core.Extensions.Utils.GetPropValue($t, this.FieldName) : null;
                var strVal;
                if (((strVal = Bridge.as(value, System.String))) != null) {
                    var dateVal = { };
                    var parsed = System.DateTime.tryParse(strVal, null, dateVal);
                    if (parsed) {
                        this.Value = dateVal.v;
                    }
                } else {
                    this.Value = Bridge.cast(Bridge.unbox((($t1 = this.Entity) != null ? Core.Extensions.Utils.GetPropValue($t1, this.FieldName) : null), System.DateTime), System.DateTime, true);
                }
            },
            ValidateAsync: function () {
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule), this.ValidationRules)) {
                    return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
                }
                this.ValidationResult.clear();
                this.Validate(System.Nullable$1(System.DateTime), System.Nullable$1(System.DateTime), Core.Extensions.ValidationRule.GreaterThan, this._value, function (value, ruleValue) {
                    return Bridge.equals(ruleValue, null) || !Bridge.equals(value, null) && System.DateTime.gt(value, ruleValue);
                });
                this.Validate(System.Nullable$1(System.DateTime), System.Nullable$1(System.DateTime), Core.Extensions.ValidationRule.LessThan, this._value, function (value, ruleValue) {
                    return Bridge.equals(ruleValue, null) || !Bridge.equals(value, null) && System.DateTime.lt(value, ruleValue);
                });
                this.Validate(System.Nullable$1(System.DateTime), System.Nullable$1(System.DateTime), Core.Extensions.ValidationRule.GreaterThanOrEqual, this._value, function (value, ruleValue) {
                    return Bridge.equals(ruleValue, null) || !Bridge.equals(value, null) && System.DateTime.gte(value, ruleValue);
                });
                this.Validate(System.Nullable$1(System.DateTime), System.Nullable$1(System.DateTime), Core.Extensions.ValidationRule.LessThanOrEqual, this._value, function (value, ruleValue) {
                    return Bridge.equals(ruleValue, null) || !Bridge.equals(value, null) && System.DateTime.lte(value, ruleValue);
                });
                this.Validate(System.Nullable$1(System.DateTime), System.Nullable$1(System.DateTime), Core.Extensions.ValidationRule.Equal, this._value, function (value, ruleValue) {
                    return Bridge.equals(value, ruleValue);
                });
                this.Validate(System.Nullable$1(System.DateTime), System.Nullable$1(System.DateTime), Core.Extensions.ValidationRule.NotEqual, this._value, function (value, ruleValue) {
                    return !Bridge.equals(value, ruleValue);
                });
                this.ValidateRequired(System.Nullable$1(System.DateTime), this._value);
                return System.Threading.Tasks.Task.fromResult(this.IsValid, System.Boolean);
            },
            RemoveDOM: function () {
                if (this.Element != null && this.Element.parentElement != null) {
                    this.Element.parentElement.remove();
                }
            },
            SetDisableUI: function (value) {
                this.Input.readOnly = value;
            }
        }
    });

    Bridge.define("Core.Components.Forms.ContextMenu", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                _active: null,
                _root: null,
                _instance: null
            },
            props: {
                Instance: {
                    get: function () {
                        if (Core.Components.Forms.ContextMenu._instance == null) {
                            Core.Components.Forms.ContextMenu._instance = new Core.Components.Forms.ContextMenu();
                            Core.Components.Forms.ContextMenu._instance.MenuItems.clear();
                        }
                        Core.Components.Forms.ContextMenu._instance.PElement = null;
                        return Core.Components.Forms.ContextMenu._instance;
                    }
                }
            },
            ctors: {
                init: function () {
                    this._active = "active";
                }
            }
        },
        fields: {
            PElement: null,
            _selectedContextMenuItem: null,
            _selectedItem: null,
            _selectedIndex: 0,
            MenuItems: null
        },
        props: {
            Top: 0,
            Left: 0,
            IsRoot: {
                get: function () {
                    return Bridge.referenceEquals((this._selectedItem != null ? this._selectedItem.parentElement : null), this.Element);
                }
            }
        },
        ctors: {
            init: function () {
                this._selectedIndex = -1;
                this.MenuItems = new (System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem)).ctor();
            },
            ctor: function () {
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, null);
                this.IsSingleton = true;
            }
        },
        methods: {
            Render: function () {
                if (Core.Components.Forms.ContextMenu._root == null) {
                    Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.PElement || document.body).Ul, "context-menu").Event("focusout", Bridge.fn.cacheBind(this, this.Dispose)).Event$1("keydown", Bridge.fn.cacheBind(this, this.HotKeyHandler));
                    Core.Components.Forms.ContextMenu._root = Core.MVVM.Html.Context;
                }
                if (this.PElement == null && Core.Components.Forms.ContextMenu._root != null) {
                    document.body.appendChild(Core.Components.Forms.ContextMenu._root);
                }
                if (this.PElement != null && Core.Components.Forms.ContextMenu._root != null) {
                    this.PElement.appendChild(Core.Components.Forms.ContextMenu._root);
                }
                this.Element = Core.Components.Forms.ContextMenu._root;
                Core.Components.Renderer.Floating(Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(Core.Components.Forms.ContextMenu._root).Clear(), -1), this.Top, this.Left);
                this.ParentElement = this.Element.parentElement;
                this.RenderMenuItems(this.MenuItems);
                window.setTimeout(Bridge.fn.bind(this, function () {
                    Core.Extensions.HtmlElementExtension.Show(this.Element);
                    this.Element.focus();
                    this.AlterPosition();
                }));
            },
            RenderMenuItems: function (items, level) {
                if (level === void 0) { level = 0; }
                for (var i = 0; i < items.Count; i = (i + 1) | 0) {
                    var item = System.Linq.Enumerable.from(items, Core.Components.Forms.ContextMenuItem).elementAt(i);
                    if (item == null) {
                        continue;
                    }

                    Core.MVVM.Html.Instance.Li.Style$1(item.Style).Render();
                    item.Ele = Core.MVVM.Html.Context;
                    if (i === 0 && level === 0 && (items.getItem(i).MenuItems == null || Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.Forms.ContextMenuItem, items.getItem(i).MenuItems))) {
                        this._selectedIndex = i;
                        this.SetSelectedItem(Core.MVVM.Html.Context);
                    }
                    if (item.Disabled) {
                        Core.Components.Renderer.Disabled(Core.MVVM.Html.Instance, true);
                    } else {
                        Core.MVVM.Html.Instance.Event$4(Core.Components.Forms.ContextMenuItem, "click", Bridge.fn.cacheBind(this, this.MenuItemClickHandler), item);
                    }

                    Core.Components.Renderer.IText(Core.Components.Renderer.Icon(Core.MVVM.Html.Instance, item.Icon).End.Span, item.Text).End.Render();
                    if (Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.Forms.ContextMenuItem, item.MenuItems)) {
                        Core.MVVM.Html.Instance.Ul.Render();
                        this.RenderMenuItems(item.MenuItems, ((level + 1) | 0));
                        Core.MVVM.Html.Instance.End.Render();
                    }
                    Core.MVVM.Html.Instance.End.Render();
                }
            },
            SetSelectedItem: function (ele) {
                this._selectedItem = ele;
                this._selectedItem != null ? Core.Extensions.HtmlElementExtension.AddClass(this._selectedItem, Core.Components.Forms.ContextMenu._active) : null;
            },
            MenuItemClickHandler: function (e, item) {
                var $t;
                e.stopPropagation();
                if (item == null || Bridge.staticEquals(item.Click, null)) {
                    return;
                }

                item.Click(item.Parameter);
                ($t = this.Element) != null ? $t.dispatchEvent(new Event(System.Enum.toString(System.String, "focusout"))) : null;
            },
            HotKeyHandler: function (e) {
                e.preventDefault();
                if (this.Element == null || Core.Extensions.IEnumerableExtensions.Nothing(HTMLElement, this.Element.children)) {
                    return;
                }

                var children = (this._selectedItem != null && this._selectedItem.parentElement != null ? this._selectedItem.parentElement.children : null) || this.Element.children;
                var code = Core.Extensions.EventExt.KeyCode(e);
                switch (code) {
                    case 27: 
                        this.Dispose();
                        break;
                    case Core.Enums.KeyCodeEnum.LeftArrow: 
                        if (this.IsRoot || this._selectedItem == null || this._selectedItem.parentElement == null) {
                            return;
                        }
                        Core.Extensions.IEnumerableExtensions.SelectForEach(HTMLElement, this._selectedItem.parentElement.children, function (x) {
                            Core.Extensions.HtmlElementExtension.RemoveClass(x, Core.Components.Forms.ContextMenu._active);
                        });
                        this._selectedItem = this._selectedItem.parentElement;
                        break;
                    case Core.Enums.KeyCodeEnum.UpArrow: 
                        e.preventDefault();
                        e.stopPropagation();
                        Core.Extensions.IEnumerableExtensions.SelectForEach(HTMLElement, children, function (x) {
                            Core.Extensions.HtmlElementExtension.RemoveClass(x, Core.Components.Forms.ContextMenu._active);
                        });
                        this._selectedIndex = this._selectedIndex > 0 ? ((this._selectedIndex - 1) | 0) : ((children.length - 1) | 0);
                        this.SetSelectedItem(System.Linq.Enumerable.from(children, HTMLElement).elementAt(this._selectedIndex));
                        break;
                    case Core.Enums.KeyCodeEnum.RightArrow: 
                        var ul = this._selectedItem != null ? this._selectedItem.lastElementChild : null;
                        if (ul == null || Core.Extensions.IEnumerableExtensions.Nothing(HTMLElement, ul.children)) {
                            return;
                        }
                        Core.Extensions.IEnumerableExtensions.SelectForEach(HTMLElement, ul.children, function (x) {
                            Core.Extensions.HtmlElementExtension.RemoveClass(x, Core.Components.Forms.ContextMenu._active);
                        });
                        this.SetSelectedItem(ul.firstElementChild);
                        break;
                    case Core.Enums.KeyCodeEnum.DownArrow: 
                        e.preventDefault();
                        e.stopPropagation();
                        Core.Extensions.IEnumerableExtensions.SelectForEach(HTMLElement, children, function (x) {
                            Core.Extensions.HtmlElementExtension.RemoveClass(x, Core.Components.Forms.ContextMenu._active);
                        });
                        this._selectedIndex = this._selectedIndex < ((children.length - 1) | 0) ? ((this._selectedIndex + 1) | 0) : 0;
                        this.SetSelectedItem(System.Linq.Enumerable.from(children, HTMLElement).elementAt(this._selectedIndex));
                        break;
                    case Core.Enums.KeyCodeEnum.Enter: 
                        if (this._selectedItem == null) {
                            this.SetSelectedItem(this.Element.firstElementChild);
                        }
                        this.MenuItemClickHandler(e, System.Linq.Enumerable.from(Core.Extensions.IEnumerableExtensions.Flattern(Core.Components.Forms.ContextMenuItem, this.MenuItems, function (x) {
                                return x.MenuItems;
                            }), Core.Components.Forms.ContextMenuItem).firstOrDefault(Bridge.fn.bind(this, function (x) {
                                return Bridge.referenceEquals(x.Ele, this._selectedItem);
                            }), null));
                        break;
                }
            },
            AlterPosition: function () {
                Core.Components.Renderer.Floating(Core.MVVM.Html.Take(this.Element), this.Top, this.Left);
                var clientRect = this.Element.getBoundingClientRect();
                var outOfViewPort = Core.Extensions.HtmlElementExtension.OutOfViewport(this.Element);
                if (outOfViewPort.Bottom) {
                    Core.Components.Renderer.Position(Core.MVVM.Html.Take(this.Element), Core.Components.Direction.top, this.Top - clientRect.height);
                }
                if (outOfViewPort.Right) {
                    Core.Components.Renderer.Position(Core.MVVM.Html.Take(this.Element), Core.Components.Direction.left, this.Left - clientRect.width);
                    Core.Components.Renderer.Position(Core.MVVM.Html.Take(this.Element), Core.Components.Direction.top, this.Top);
                }
                outOfViewPort = Core.Extensions.HtmlElementExtension.OutOfViewport(this.Element);
                if (outOfViewPort.Bottom) {
                    Core.Components.Renderer.Position(Core.MVVM.Html.Take(this.Element), Core.Components.Direction.top, this.Top - clientRect.height);
                    Core.Components.Renderer.Position(Core.MVVM.Html.Take(this.Element), Core.Components.Direction.top, this.Top - clientRect.height - this.Element.clientHeight);
                }
            },
            RemoveDOM: function () {
                Core.Extensions.HtmlElementExtension.Hide(Core.Components.Forms.ContextMenu._root);
            }
        }
    });

    Bridge.define("Core.Components.Section", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                _imeout1: 0
            },
            methods: {
                RenderTabGroup: function (parent, group) {
                    var $t;
                    var disabled = parent.Disabled || group.Disabled;
                    if (parent.EditForm.TabGroup == null) {
                        parent.EditForm.TabGroup = new (System.Collections.Generic.List$1(Core.Components.Forms.TabGroup)).ctor();
                    }

                    var tabG = System.Linq.Enumerable.from(parent.EditForm.TabGroup, Core.Components.Forms.TabGroup).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.Name, group.TabGroup);
                        }, null);
                    if (tabG == null) { /// Simplify object initialization


                        tabG = ($t = new Core.Components.Forms.TabGroup(), $t.Name = group.TabGroup, $t.Parent = parent, $t.ParentElement = parent.Element, $t.Entity = parent.Entity, $t.ComponentGroup = group, $t.EditForm = parent.EditForm, $t); /// Simplify object initialization


                        tabG.Disabled = disabled; /// Simplify object initialization


                        var subTab = ($t = new Core.Components.Forms.TabComponent(group), $t.Parent = tabG, $t.Entity = parent.Entity, $t.ComponentGroup = group, $t.Name = group.Name, $t.EditForm = parent.EditForm, $t); /// Simplify object initialization


                        subTab.Disabled = disabled;
                        tabG.Children.add(subTab);
                        parent.EditForm.TabGroup.add(tabG);
                        parent.Children.add(tabG);
                        tabG.Render();
                        subTab.Render();
                        subTab.RenderTabContent();
                        subTab.Focus();
                        subTab.ToggleShow(group.ShowExp);
                        subTab.ToggleDisabled(group.DisabledExp);
                    } else { /// Simplify object initialization


                        var subTab1 = ($t = new Core.Components.Forms.TabComponent(group), $t.Parent = tabG, $t.ParentElement = tabG.Element, $t.Entity = parent.Entity, $t.ComponentGroup = group, $t.Name = group.Name, $t);
                        subTab1.Disabled = disabled;
                        tabG.Children.add(subTab1);
                        subTab1.Render();
                        subTab1.RenderTabContent();
                        subTab1.ToggleDisabled(group.DisabledExp);
                        tabG.FirstChild.Focus();
                    }
                },
                RenderSection: function (parent, groupInfo) {
                    var $t, $t1, $t2;
                    var uiPolicy = parent.EditForm.GetElementPolicies$1(System.Array.init([groupInfo.Id], System.String), Core.Extensions.Utils.ComponentGroupId);
                    var readPermission = !groupInfo.IsPrivate || Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy, uiPolicy, function (x) {
                        return x.CanRead;
                    });
                    var writePermission = !groupInfo.IsPrivate || Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy, uiPolicy, function (x) {
                        return x.CanWrite;
                    });
                    if (!readPermission) {
                        return null;
                    }

                    var width = groupInfo.Width;
                    var outerColumn = parent.EditForm.GetOuterColumn(groupInfo);
                    var parentColumn = parent.EditForm.GetInnerColumn(groupInfo.Parent);
                    var hasOuterColumn = outerColumn > 0 && parentColumn > 0;
                    if (hasOuterColumn) {
                        var per = System.Decimal(outerColumn).div(System.Decimal(parentColumn)).mul(System.Decimal(100));
                        per = System.Decimal.toDecimalPlaces(per, 2, 4);
                        var padding = System.Decimal.toDecimalPlaces((System.Decimal(groupInfo.ItemInRow).sub(System.Decimal(1.0))).div(System.Decimal(groupInfo.ItemInRow)), 2, 4);
                        width = outerColumn === parentColumn ? "100%" : System.String.format("calc({0}% - {1}rem)", per, padding);
                    }

                    Core.MVVM.Html.Take(parent.Element).Div.Render();
                    if (!System.String.isNullOrEmpty(groupInfo.Label)) {
                        Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Label, "header"), groupInfo.Label);
                        if (Core.Clients.Client.CheckHasRole(Core.Enums.RoleEnum.System)) {
                            Core.MVVM.Html.Instance.Attr$1("contenteditable", "true");
                            Core.MVVM.Html.Instance.Event$1("input", function (e) {
                                Core.Components.Section.ChangeComponentGroupLabel(e, groupInfo);
                            });
                            Core.MVVM.Html.Instance.Event$1("dblclick", function (e) {
                                parent.EditForm.SectionProperties(groupInfo);
                            });
                        }
                        Core.MVVM.Html.Instance.End.Render();
                    }
                    Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance, groupInfo.ClassName).Event$1("contextmenu", function (e) {
                        parent.EditForm.SysConfigMenu(e, null, groupInfo);
                    });
                    if (!System.String.contains(groupInfo.ClassName,"ribbon")) {
                        Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance, "panel"), "group");
                    }
                    Core.Components.Renderer.Width(Core.MVVM.Html.Instance.Display$1(!groupInfo.Hidden).Style$1(($t = groupInfo.Style, $t != null ? $t : "")), width);
                    var section = ($t1 = new Core.Components.Section.ctor(Core.MVVM.Html.Context), $t1.Id = (groupInfo.Name || "") + ((($t2 = groupInfo.Id) != null ? Bridge.toString($t2) : null) || ""), $t1.Name = groupInfo.Name, $t1.ComponentGroup = groupInfo, $t1);
                    section.Disabled = parent.Disabled || groupInfo.Disabled || !writePermission || parent.EditForm.IsLock || section.Disabled;
                    parent.AddChild(section, null, groupInfo.ShowExp);
                    Core.MVVM.Html.Take(parent.Element);
                    !Bridge.staticEquals(($t1 = section.DOMContentLoaded), null) ? $t1() : null;
                    return section;
                },
                SubmitLabelChanged: function (table, id, label) {
                    var $t;
                    var patch = ($t = new Core.ViewModels.PatchVM(), $t.Table = table, $t.Changes = function (_o1) {
                            var $t1;
                            _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = Core.Components.EditableComponent.IdField, $t1.Value = id, $t1));
                            _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "Label", $t1.Value = label, $t1));
                            return _o1;
                        }(new (System.Collections.Generic.List$1(Core.ViewModels.PatchDetail)).ctor()), $t);
                    Core.Extensions.EventExt.Done$1(System.Int32, Core.Clients.Client.Instance.PatchAsync(patch));
                },
                ChangeComponentGroupLabel: function (e, com) {
                    window.clearTimeout(Core.Components.Section._imeout1);
                    Core.Components.Section._imeout1 = window.setTimeout(function () {
                        Core.Components.Section.SubmitLabelChanged("ComponentGroup", com.Id, Core.Extensions.Utils.DecodeSpecialChar((Bridge.as(e.target, HTMLElement)).textContent));
                    }, 1000);
                }
            }
        },
        fields: {
            elementType: null,
            InnerEle: null,
            _chevron: null,
            _waitFocusOut: 0,
            _isAllBtn: null,
            _imeout: 0
        },
        props: {
            ComponentGroup: null
        },
        ctors: {
            $ctor1: function (elementType) {
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, null);
                this.elementType = elementType;
            },
            ctor: function (interactiveEle) {
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, null);
                this.Element = Bridge.as(interactiveEle, HTMLElement);
            }
        },
        methods: {
            Render: function () {
                if (this.elementType == null) {
                    var tag = this.Element.tagName.toLowerCase();
                    var type = { v : new Core.MVVM.ElementType() };
                    var parsed = System.Enum.tryParse(Core.MVVM.ElementType, tag, type);
                    if (parsed) {
                        this.elementType = type.v;
                    }
                } else {
                    Core.MVVM.Html.Take(this.ParentElement).Add(System.Nullable.getValue(this.elementType));
                    this.Element = Core.MVVM.Html.Context;
                }
                this.Element.id = this.Id;
                if (this.ComponentGroup == null) {
                    return;
                }
                if (this.ComponentGroup.IsDropDown) {
                    Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element), "dd-wrap").Style$1("position: relative;"), -1).Event("focusout", Bridge.fn.cacheBind(this, this.HideDetailIfButtonOnly)).Button, "btn ribbon"), this.ComponentGroup.Label).Event$1("click", Bridge.fn.cacheBind(this, this.DropdownBtnClick)).Span.Text("\u25bc").EndOf(Core.MVVM.ElementType.button).Div, "dropdown"), -1).Render();
                    if (System.Nullable.eq(this.ComponentGroup.IsCollapsible, true)) {
                        Core.MVVM.Html.Instance.Style$1("display: none;");
                    }
                    this.InnerEle = Core.MVVM.Html.Context;
                    this._chevron = this.InnerEle.previousElementSibling.firstElementChild;

                    this.Element = Core.MVVM.Html.Context;
                }
                if (this.ComponentGroup.Responsive && !this.ComponentGroup.IsTab || this.ComponentGroup.IsDropDown) {
                    this.RenderComponentResponsive(this.ComponentGroup);
                } else {
                    this.RenderComponent(this.ComponentGroup);
                }
                this.RenderChildrenSection(this.ComponentGroup);
            },
            HideDetailIfButtonOnly: function () {
                var $t;
                if (this._isAllBtn == null) {
                    var allChildren = ($t = Core.Components.EditableComponent, System.Linq.Enumerable.from(this.FilterChildren(Core.Components.EditableComponent, function (x) {
                            return Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, x.Children);
                        }), $t).ToArray($t));
                    this._isAllBtn = System.Linq.Enumerable.from(allChildren, Core.Components.EditableComponent).all(function (x) {
                            return Bridge.Reflection.isAssignableFrom(Core.Components.Button, Bridge.getType(x));
                        });
                }
                window.clearTimeout(this._waitFocusOut);
                this._waitFocusOut = window.setTimeout(Bridge.fn.bind(this, function () {
                    if (System.Nullable.eq(this._isAllBtn, true)) {
                        this.InnerEle.style.display = "none";
                    }
                }), 150);
            },
            DropdownBtnClick: function (e) {
                e.stopPropagation();
                if (Bridge.referenceEquals(Bridge.toString(this.InnerEle.style.display), System.Enum.toString(System.String, "none"))) {
                    this.InnerEle.style.display = "";
                    this._chevron.innerHTML = "\u25bc";
                } else {
                    this.InnerEle.style.display = "none";
                    this._chevron.innerHTML = "\u25bc";
                }
            },
            RenderChildrenSection: function (group) {
                var $t;
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.ComponentGroup, group.InverseParent)) {
                    return;
                }
                $t = Bridge.getEnumerator(System.Linq.Enumerable.from(group.InverseParent, Core.Models.ComponentGroup).orderBy(function (x) {
                        return x.Order;
                    }));
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        child.Disabled = group.Disabled;
                        if (child.IsTab) {
                            Core.Components.Section.RenderTabGroup(this, child);
                        } else {
                            Core.Components.Section.RenderSection(this, child);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            PrepareUpdateView: function (force, dirty) {
                var $t, $t1;
                Core.Components.EditableComponent.prototype.PrepareUpdateView.call(this, force, dirty);
                this.ToggleShow(($t = this.ComponentGroup) != null ? $t.ShowExp : null);
                this.ToggleDisabled(($t1 = this.ComponentGroup) != null ? $t1.DisabledExp : null);
            },
            ComponentProperties: function (component) {
                var $t;
                var editor = ($t = new Core.Components.Framework.ComponentBL(), $t.Entity = component, $t.ParentElement = this.Element, $t.OpenFrom = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, this), $t);
                this.AddChild(editor);
            },
            RenderComponent: function (group) {
                var $t, $t1, $t2, $t3;
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.Component, group.Component)) {
                    return;
                }
                var html = Core.MVVM.Html.Instance;
                Core.Components.Renderer.ClassName(html.Table, "ui-layout").TBody.TRow.Render();
                var column = 0;
                var allComPolicies = this.EditForm.GetElementPolicies$1(System.Linq.Enumerable.from(group.Component, Core.Models.Component).select(function (x) {
                        return x.Id;
                    }).ToArray(System.String), Core.Extensions.Utils.ComponentId);
                $t = Bridge.getEnumerator(System.Linq.Enumerable.from(group.Component, Core.Models.Component).orderBy(function (x) {
                        return x.Order;
                    }));
                try {
                    while ($t.moveNext()) {
                        var ui = { v : $t.Current };
                        if (ui.v.Hidden) {
                            continue;
                        }

                        var comPolicies = System.Linq.Enumerable.from(allComPolicies, Core.Models.FeaturePolicy).where((function ($me, ui) {
                                return function (x) {
                                    return Bridge.referenceEquals(x.RecordId, ui.v.Id);
                                };
                            })(this, ui)).ToArray(Core.Models.FeaturePolicy);
                        var readPermission = !ui.v.IsPrivate || Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy, comPolicies, function (x) {
                            return x.CanRead;
                        });
                        var writePermission = !ui.v.IsPrivate || Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy, comPolicies, function (x) {
                            return x.CanWrite;
                        });
                        if (!readPermission) {
                            continue;
                        }

                        var colSpan = ($t1 = ui.v.Column, $t1 != null ? $t1 : 2);
                        ui.v.Label = ($t2 = ui.v.Label, $t2 != null ? $t2 : "");
                        if (ui.v.ShowLabel) {
                            Core.Components.Renderer.TextAlign(Core.Components.Renderer.IText(html.TData.Visibility$1(ui.v.Visibility).Label, ui.v.Label), column === 0 ? Core.Enums.TextAlign.left : Core.Enums.TextAlign.right);
                            if (Core.Clients.Client.CheckHasRole(Core.Enums.RoleEnum.System)) {
                                Core.MVVM.Html.Instance.Attr$1("contenteditable", "true");
                                Core.MVVM.Html.Instance.Event$1("input", (function ($me, ui) {
                                    return Bridge.fn.bind($me, function (e) {
                                        this.ChangeLabel(e, ui.v);
                                    });
                                })(this, ui));
                                Core.MVVM.Html.Instance.Event$1("dblclick", (function ($me, ui) {
                                    return Bridge.fn.bind($me, function (e) {
                                        this.ComponentProperties(ui.v);
                                    });
                                })(this, ui));
                            }
                            Core.Components.Renderer.ColSpan(html.EndOf(Core.MVVM.ElementType.td).TData.Visibility$1(ui.v.Visibility), ((colSpan - 1) | 0)).Render();
                        } else {
                            Core.Components.Renderer.ClassName(Core.Components.Renderer.ColSpan(html.TData.Visibility$1(ui.v.Visibility), colSpan), "text-left").Style$1("padding-left: 0;").Render();
                        }

                        if (Core.Extensions.StringExt.HasAnyChar(ui.v.Style)) {
                            html.Style$1(ui.v.Style);
                        }

                        if (Core.Extensions.StringExt.HasAnyChar(ui.v.Width)) {
                            Core.Components.Renderer.Width(html, ui.v.Width);
                        }

                        var childComponent = Core.Components.Extensions.ComponentFactory.GetComponent(ui.v, this.EditForm);
                        if (Bridge.Reflection.isAssignableFrom(Core.Components.ListView, Bridge.getType(childComponent))) {
                            this.EditForm.ListViews.add(Bridge.as(childComponent, Core.Components.ListView));
                        }
                        this.AddChild(childComponent);
                        var editable;
                        if (((editable = childComponent)) != null) {
                            editable.Disabled = ui.v.Disabled || this.Disabled || !writePermission || editable.Disabled;
                        }
                        if (childComponent.Element != null) {
                            if (Core.Extensions.StringExt.HasAnyChar(ui.v.ChildStyle)) {
                                var current = Core.MVVM.Html.Context;
                                Core.MVVM.Html.Take(childComponent.Element).Style$1(ui.v.ChildStyle);
                                Core.MVVM.Html.Take(current);
                            }
                            if (Core.Extensions.StringExt.HasAnyChar(ui.v.ClassName)) {
                                ($t3 = childComponent.Element) != null ? Core.Extensions.HtmlElementExtension.AddClass($t3, ui.v.ClassName) : null;
                            }

                            if (System.Nullable.eq(ui.v.Row, 1)) {
                                Core.Extensions.HtmlElementExtension.AddClass(childComponent.ParentElement.parentElement, "inline-label");
                            }

                            if (Core.Clients.Client.SystemRole) {
                                childComponent.Element.addEventListener(System.Enum.toString(System.String, "contextmenu"), (function ($me, ui) {
                                    return Bridge.fn.bind($me, function (e) {
                                        this.EditForm.SysConfigMenu(e, ui.v, group);
                                    });
                                })(this, ui));
                            }
                        }
                        if (ui.v.Focus) {
                            childComponent.Focus();
                        }

                        html.EndOf(Core.MVVM.ElementType.td);
                        if (ui.v.Offset != null && System.Nullable.gt(ui.v.Offset, 0)) {
                            Core.Components.Renderer.ColSpan(html.TData, System.Nullable.getValue(ui.v.Offset)).End.Render();
                            column = (column + System.Nullable.getValue(ui.v.Offset)) | 0;
                        }
                        column = (column + colSpan) | 0;
                        if (column === this.EditForm.GetInnerColumn(group)) {
                            column = 0;
                            html.EndOf(Core.MVVM.ElementType.tr).TRow.Render();
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            ChangeLabel: function (e, com) {
                window.clearTimeout(this._imeout);
                this._imeout = window.setTimeout(function () {
                    Core.Components.Section.SubmitLabelChanged("Component", com.Id, Core.Extensions.Utils.DecodeSpecialChar((Bridge.as(e.target, HTMLElement)).textContent));
                }, 1000);
            },
            RenderComponentResponsive: function (group) {
                var $t, $t1, $t2, $t3;
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.Component, group.Component)) {
                    return;
                }
                var html = Core.MVVM.Html.Instance;
                var allComPolicies = this.EditForm.GetElementPolicies$1(System.Linq.Enumerable.from(group.Component, Core.Models.Component).select(function (x) {
                        return x.Id;
                    }).ToArray(System.String), Core.Extensions.Utils.ComponentId);
                var innerCol = this.EditForm.GetInnerColumn(group);
                if (innerCol > 0) {
                    Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element), "grid").Style$1(System.String.format("grid-template-columns: repeat({0}, 1fr)", [Bridge.box(innerCol, System.Int32)]));
                }
                var column = 0;
                $t = Bridge.getEnumerator(System.Linq.Enumerable.from(group.Component, Core.Models.Component).orderBy(function (x) {
                        return x.Order;
                    }));
                try {
                    while ($t.moveNext()) {
                        var ui = { v : $t.Current };
                        if (ui.v.Hidden) {
                            continue;
                        }

                        var comPolicies = System.Linq.Enumerable.from(allComPolicies, Core.Models.FeaturePolicy).where((function ($me, ui) {
                                return function (x) {
                                    return Bridge.referenceEquals(x.RecordId, ui.v.Id);
                                };
                            })(this, ui)).ToArray(Core.Models.FeaturePolicy);
                        var readPermission = !ui.v.IsPrivate || Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy, comPolicies, function (x) {
                            return x.CanRead;
                        });
                        var writePermission = !ui.v.IsPrivate || Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy, comPolicies, function (x) {
                            return x.CanWrite;
                        });
                        if (!readPermission) {
                            continue;
                        }

                        Core.MVVM.Html.Take(this.Element);
                        var colSpan = ($t1 = ui.v.Column, $t1 != null ? $t1 : 2);
                        ui.v.Label = ($t2 = ui.v.Label, $t2 != null ? $t2 : "");
                        var label = null;
                        if (ui.v.ShowLabel) {
                            Core.Components.Renderer.TextAlign(Core.Components.Renderer.IText(html.Label, ui.v.Label), column === 0 ? Core.Enums.TextAlign.left : Core.Enums.TextAlign.right).Render();
                            label = Core.MVVM.Html.Context;
                            html.End.Render();
                        }

                        var childComponent = Core.Components.Extensions.ComponentFactory.GetComponent(ui.v, this.EditForm);
                        if (Bridge.Reflection.isAssignableFrom(Core.Components.ListView, Bridge.getType(childComponent))) {
                            this.EditForm.ListViews.add(Bridge.as(childComponent, Core.Components.ListView));
                        }
                        this.AddChild(childComponent);
                        var editable;
                        if (((editable = childComponent)) != null) {
                            editable.Disabled = ui.v.Disabled || this.Disabled || !writePermission || this.EditForm.IsLock || editable.Disabled;
                        }

                        if (childComponent.Element != null) {
                            if (Core.Extensions.StringExt.HasAnyChar(ui.v.ChildStyle)) {
                                var current = Core.MVVM.Html.Context;
                                Core.MVVM.Html.Take(childComponent.Element).Style$1(ui.v.ChildStyle);
                                Core.MVVM.Html.Take(current);
                            }
                            if (Core.Extensions.StringExt.HasAnyChar(ui.v.ClassName)) {
                                ($t3 = childComponent.Element) != null ? Core.Extensions.HtmlElementExtension.AddClass($t3, ui.v.ClassName) : null;
                            }

                            if (System.Nullable.eq(ui.v.Row, 1)) {
                                Core.Extensions.HtmlElementExtension.AddClass(childComponent.ParentElement.parentElement, "inline-label");
                            }

                            if (Core.Clients.Client.SystemRole) {
                                childComponent.Element.addEventListener(System.Enum.toString(System.String, "contextmenu"), (function ($me, ui) {
                                    return Bridge.fn.bind($me, function (e) {
                                        this.EditForm.SysConfigMenu(e, ui.v, group);
                                    });
                                })(this, ui));
                            }
                        }
                        if (ui.v.Focus) {
                            childComponent.Focus();
                        }

                        if (colSpan <= innerCol) {
                            if (label != null && label.nextElementSibling != null && colSpan !== 2) {
                                label.nextElementSibling.style.gridColumn = System.String.format("{0}/{1}", Bridge.box(((column + 2) | 0), System.Int32), Bridge.box(((((column + colSpan) | 0) + 1) | 0), System.Int32));
                            } else if (childComponent.Element != null) {
                                childComponent.Element.style.gridColumn = System.String.format("{0}/{1}", Bridge.box(((column + 2) | 0), System.Int32), Bridge.box(((((column + colSpan) | 0) + 1) | 0), System.Int32));
                            }
                            column = (column + colSpan) | 0;
                        } else {
                            column = 0;
                        }
                        if (column === innerCol) {
                            column = 0;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            }
        }
    });

    Bridge.define("Core.Components.Forms.TabGroup", {
        inherits: [Core.Components.EditableComponent],
        fields: {
            ListViewType: null
        },
        props: {
            ComponentGroup: null,
            Ul: null,
            TabContent: null,
            ShouldCountBage: false
        },
        ctors: {
            init: function () {
                this.ListViewType = function (_o1) {
                        _o1.add("ListView");
                        _o1.add("GroupListView");
                        _o1.add("GridView");
                        _o1.add("GroupGridView");
                        return _o1;
                    }(new (System.Collections.Generic.List$1(System.String)).ctor());
            },
            ctor: function () {
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, null);
            }
        },
        methods: {
            Render: function () {
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Div, "tab-group"), this.ComponentGroup.IsVertialTab ? "tab-vertical" : "tab-horizontal").Div, "headers-wrapper").Ul, "nav-config  nav nav-tabs nav-tabs-bottom mb-0");
                this.Ul = Bridge.as(Core.MVVM.Html.Context, HTMLUListElement);
                this.Element = this.Ul.parentElement;
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.End.Div, "tabs-content");
                this.TabContent = Bridge.as(Core.MVVM.Html.Context, HTMLDivElement);
                this.ShouldCountBage = System.Linq.Enumerable.from(this.ComponentGroup.InverseParent, Core.Models.ComponentGroup).all(Bridge.fn.bind(this, function (x) {
                        return Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.Component, x.Component) && this.ListViewType.contains(System.Linq.Enumerable.from(x.Component, Core.Models.Component).first().ComponentType);
                    }));
            }
        }
    });

    Bridge.define("Core.Components.Framework.MenuComponent", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                ActiveClass: null,
                ASIDE_WIDTH: null,
                _timeperiodToExit: 0,
                TranslateY50: null,
                _instance: null,
                _lastTimeBackPress: null
            },
            props: {
                Instance: {
                    get: function () {
                        if (Core.Components.Framework.MenuComponent._instance == null) {
                            Core.Components.Framework.MenuComponent._instance = new Core.Components.Framework.MenuComponent();
                        }

                        return Core.Components.Framework.MenuComponent._instance;
                    }
                }
            },
            ctors: {
                init: function () {
                    this._lastTimeBackPress = System.DateTime.getDefaultValue();
                    this.ActiveClass = "active";
                    this.ASIDE_WIDTH = "44px";
                    this._timeperiodToExit = 2000;
                    this.TranslateY50 = "translateY(-50%)";
                }
            },
            methods: {
                BoostrapTask: function () {
                    var $t;
                    var doc = document;
                    var meta = doc.head.children.startupSvc;
                    var submitEntity = ($t = new Core.ViewModels.SqlViewModel(), $t.SvcId = meta.content, $t.OrderBy = "ds.[Order] asc", $t);
                    var startup = Core.Clients.Client.Instance.SubmitAsync(System.Array.type(System.Array.type(System.Object)), ($t = new Core.Clients.XHRWrapper(), $t.Value = JSON.stringify(submitEntity), $t.Url = Core.Extensions.Utils.UserSvc, $t.IsRawString = true, $t.Method = Core.Enums.HttpMethod.POST, $t));
                    return startup;
                },
                PressToExit: function () {
                    if (typeof(navigator.app) === 'undefined') return;
                    var time = System.DateTime.subdd(System.DateTime.getNow(), Core.Components.Framework.MenuComponent._lastTimeBackPress);
                    if (time.getTotalMilliseconds() < 2000) {
                        navigator.app.exitApp();
                        return;
                    }
                    Core.Components.Framework.MenuComponent._lastTimeBackPress = System.DateTime.getNow();
                    Core.Extensions.Toast.Small("B\u1ea5m quay l\u1ea1i 2 l\u1ea7n \u0111\u1ec3 tho\u00e1t", 1000);
                },
                AlterPositionSubMenu: function (top, li) {
                    if (li == null) {
                        return;
                    }
                    var ul = Bridge.as(li.querySelector(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.ul)), HTMLElement);
                    if (ul == null) {
                        return;
                    }
                    ul.style.top = System.Single.format(top - 20) + (Core.Extensions.Utils.Pixel || "");
                    ul.style.bottom = null;
                    ul.style.transform = null;
                    var outOfVp = Core.Extensions.HtmlElementExtension.OutOfViewport(ul);
                    if (outOfVp.Bottom) {
                        ul.style.top = null;
                        ul.style.bottom = System.Single.format(document.body.clientHeight - top) + (Core.Extensions.Utils.Pixel || "");
                        outOfVp = Core.Extensions.HtmlElementExtension.OutOfViewport(ul);
                        if (outOfVp.Top) {
                            ul.style.top = "50%";
                            ul.style.bottom = null;
                            ul.style.transform = Core.Components.Framework.MenuComponent.TranslateY50;
                        }
                    }
                },
                OpenFeature: function (feature) {
                    if (feature == null) {
                        return;
                    }
                    var id = (feature.Name || "") + (feature.Id || "");
                    var exists = System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs, Core.Components.Forms.TabEditor).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.Id, id);
                        }, null);
                    if (exists != null) {
                        exists.Focus();
                        return;
                    }
                    Core.Extensions.EventExt.Done$1(Core.Models.Feature, Core.Components.Extensions.ComponentExt.LoadFeature(Core.Clients.Client.ConnKey, feature.Name), function (f) {
                        if (f == null) {
                            return;
                        }
                        var instance = null;
                        instance = new Core.Components.Forms.TabEditor(f.EntityName);
                        if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(f.Script)) {
                            Core.Components.Extensions.ComponentExt.AssignMethods(f, instance);
                        }

                        instance.Name = f.Name;
                        instance.Id = id;
                        instance.Icon = f.Icon;
                        instance.Feature = f;
                        instance.Render();
                    });
                }
            }
        },
        fields: {
            _feature: null,
            _hasRender: false,
            _btnBack: null,
            _btnToggle: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, null);

            }
        },
        methods: {
            BuildFeatureTree: function () {
                var $t;
                var dic = System.Linq.Enumerable.from(this._feature, Core.Models.Feature).where(function (f) {
                        return f.IsMenu;
                    }).toDictionary(function (f) {
                        return f.Id;
                    }, null, System.String, Core.Models.Feature);
                $t = Bridge.getEnumerator(dic.Values);
                try {
                    while ($t.moveNext()) {
                        var menu = $t.Current;
                        if (menu.ParentId != null && dic.containsKey(menu.ParentId)) {
                            var parent = dic.getItem(menu.ParentId);
                            if (parent.InverseParent == null) {
                                parent.InverseParent = new (System.Collections.Generic.List$1(Core.Models.Feature)).ctor();
                            } else {
                                System.Array.add(parent.InverseParent, menu, Core.Models.Feature);
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                this._feature = System.Linq.Enumerable.from(this._feature, Core.Models.Feature).where(function (f) {
                        return f.ParentId == null && f.IsMenu;
                    }).toList(Core.Models.Feature);
            },
            ReloadMenu: function (focusedParentFeatureId) {
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), Core.Components.Framework.MenuComponent.BoostrapTask(), Bridge.fn.bind(this, function (ds) {
                    var $t;
                    this._feature = System.Linq.Enumerable.from(ds[System.Array.index(0, ds)], System.Object).select(function (x) {
                            return Core.Extensions.BridgeExt.CastProp(Core.Models.Feature, x);
                        }).toList(Core.Models.Feature);
                    this.BuildFeatureTree();
                    Core.MVVM.Html.Take$1(".sidebar-items").Clear();
                    this.RenderMenuItems(this._feature);
                    !Bridge.staticEquals(($t = this.DOMContentLoaded), null) ? $t() : null;
                    if (focusedParentFeatureId != null) {
                        this.FocusFeature(focusedParentFeatureId);
                    }
                }));
            },
            Render: function () {
                if (this._hasRender) {
                    return;
                }

                this._hasRender = true;
                var startup = Core.Components.Framework.MenuComponent.BoostrapTask();
                var roles = Bridge.toArray(Core.Clients.Client.Token.RoleIds).join("\\");
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), startup, Bridge.fn.bind(this, function (res) {
                    var features = res.length > 0 ? System.Linq.Enumerable.from(res[System.Array.index(0, res)], System.Object).select(function (x) {
                            return Core.Extensions.BridgeExt.CastProp(Core.Models.Feature, x);
                        }).ToArray(Core.Models.Feature) : null;
                    var startApps = res.length > 1 ? System.Linq.Enumerable.from(res[System.Array.index(1, res)], System.Object).select(function (x) {
                            return Core.Extensions.BridgeExt.CastProp(Core.Models.UserSetting, x);
                        }).ToArray(Core.Models.UserSetting) : null;
                    var entities = res.length > 2 ? System.Linq.Enumerable.from(res[System.Array.index(2, res)], System.Object).select(function (x) {
                            return Core.Extensions.BridgeExt.CastProp(Core.Models.Entity, x);
                        }).ToArray(Core.Models.Entity) : null;
                    var tasks = res.length > 3 ? System.Linq.Enumerable.from(res[System.Array.index(3, res)], System.Object).select(function (x) {
                            return Core.Extensions.BridgeExt.CastProp(Core.Models.TaskNotification, x);
                        }).toList(Core.Models.TaskNotification) : null;
                    this.SetTask(tasks);
                    this.GetFeatureCb(features, startApps, entities);
                }));
            },
            SetTask: function (tasks) {
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.TaskNotification, tasks)) {
                    return;
                }
                Core.Components.Framework.NotificationBL.Notifications.Data = tasks;
            },
            GetFeatureCb: function (feature, startApp, entities) {
                var $t, $t1, $t2;
                Core.Clients.Client.Entities = ($t = Core.Models.Entity, System.Linq.Enumerable.from(entities, $t).toDictionary(function (x) {
                        return x.Id;
                    }, null, System.String, $t));
                var startApps = System.Linq.Enumerable.from(Core.Extensions.IEnumerableExtensions.Combine$1(Core.Models.UserSetting, System.String, startApp, function (x) {
                        return x.Value;
                    }).split(","), System.String).select(function (x) {
                        return x;
                    }).distinct();
                this._feature = feature;
                this.BuildFeatureTree();
                Core.MVVM.Html.Take$1("#menu");
                this.RenderKeyMenuItems(this._feature);
                var featureParam = Core.Extensions.StringExt.SubStrIndex(window.location.pathname, ((window.location.pathname.lastIndexOf("/") + 1) | 0));
                if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(featureParam)) {
                    var currentFeature = System.Linq.Enumerable.from(feature, Core.Models.Feature).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.Name, featureParam);
                        }, null);
                    Core.Components.Framework.MenuComponent.OpenFeature(currentFeature);
                } else {
                    System.Linq.Enumerable.from(feature, Core.Models.Feature).where(function (x) {
                            return startApps.contains(x.Id) || x.StartUp;
                        }).forEach(Core.Components.Framework.MenuComponent.OpenFeature);
                }
                !Bridge.staticEquals(($t1 = this.DOMContentLoaded), null) ? $t1() : null;
                this._btnBack = document.getElementById("btnBack");
                this._btnToggle = ($t2 = HTMLElement, System.Linq.Enumerable.from(document.getElementsByClassName("sidebar-toggle"), $t2).ToArray($t2));
                if (this._btnBack == null) {
                    return;
                }

                this._btnBack.addEventListener("click", Bridge.fn.cacheBind(this, this.RoutingHandler));
                this._btnToggle.forEach(Bridge.fn.bind(this, function (btn) {
                        btn.addEventListener("click", Bridge.fn.bind(this, function () {
                            this.Show = !this.Show;
                        }));
                    }));
            },
            RoutingHandler: function () {
                Core.Components.Framework.MenuComponent.PressToExit();
                var currentTab;
                if (((currentTab = Core.Components.Forms.TabEditor.ActiveTab)) != null) {
                    currentTab.DirtyCheckAndCancel();
                }
            },
            HideAll: function (current) {
                var $t, $t1;
                if (current === void 0) { current = null; }
                if (current == null) {
                    current = document.body;
                }
                var activea = current.querySelectorAll("a.active");
                var activeLi = current.querySelectorAll("li.menu-open");
                $t = Bridge.getEnumerator(activea, "getEnumerator");
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        Core.Extensions.HtmlElementExtension.RemoveClass(item, Core.Components.Framework.MenuComponent.ActiveClass);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                $t1 = Bridge.getEnumerator(activeLi, "getEnumerator");
                try {
                    while ($t1.moveNext()) {
                        var item1 = $t1.Current;
                        Core.Extensions.HtmlElementExtension.RemoveClass(item1, "menu-open");
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }
            },
            AlterMainSectionWidth: function () {
                this.Element.tabIndex = -1;
                this.Element.focus();
                this.Element.addEventListener("focusout", Bridge.fn.bind(this, function () {
                    this.Show = Core.Components.EditableComponent.IsSmallUp;
                }));
                this.Show = Core.Components.EditableComponent.IsSmallUp;
            },
            HideAside: function () {
                this.Element.style.left = System.String.format("-{0}", [Core.Components.Framework.MenuComponent.ASIDE_WIDTH]);
            },
            RenderKeyMenuItems: function (menuItems, nested) {
                if (nested === void 0) { nested = false; }
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Ul, "nav nav-pills nav-sidebar flex-column").DataAttr$1("widget", "treeview").Attr$1("role", "menu").DataAttr$1("accordion", "false").ForEach$2(Core.Models.Feature, menuItems, Bridge.fn.bind(this, function (item, index) {
                    var $t;
                    if (item.IsGroup) {
                        Core.Components.Renderer.Title(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Li, "nav-header"), item.Label).End.Render();
                    } else {
                        var check = item.InverseParent != null && System.Array.getCount(item.InverseParent, Core.Models.Feature) > 0;
                        Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Li, "nav-item").A, "nav-link").Event$3(Core.Models.Feature, "click", Bridge.fn.cacheBind(this, this.MenuItemClick), item).Event$4(Core.Models.Feature, "contextmenu", Bridge.fn.cacheBind(this, this.FeatureContextMenu), item), item.Icon), "nav-icon").End.P, item.Label);
                        if (check) {
                            Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.I, "right fas fa-angle-left").End.Render();
                        }
                        Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.a).Render();
                        if (check) {
                            this.RenderMenuItems(($t = Core.Models.Feature, System.Linq.Enumerable.from(item.InverseParent, $t).toList($t)), true);
                        }
                    }
                }));
            },
            RenderMenuItems: function (menuItems, nested) {
                if (nested === void 0) { nested = false; }
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Ul, "nav nav-treeview").ForEach$2(Core.Models.Feature, menuItems, Bridge.fn.bind(this, function (item, index) {
                    var $t;
                    var check = item.InverseParent != null && System.Array.getCount(item.InverseParent, Core.Models.Feature) > 0;
                    Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Li, "nav-item").A, "nav-link").Event$3(Core.Models.Feature, "click", Bridge.fn.cacheBind(this, this.MenuItemClick), item).Event$4(Core.Models.Feature, "contextmenu", Bridge.fn.cacheBind(this, this.FeatureContextMenu), item).I, "fal fa-circle nav-icon").End.P, item.Label);
                    if (check) {
                        Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.I, "right fas fa-angle-left").End.Render();
                    }
                    Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.a).Render();
                    if (check) {
                        this.RenderMenuItems(($t = Core.Models.Feature, System.Linq.Enumerable.from(item.InverseParent, $t).toList($t)), true);
                    }
                }));
            },
            FindMenuItemByID: function (id) {
                var $t;
                var activeLi = document.querySelectorAll(".sidebar-items li");
                $t = Bridge.getEnumerator(activeLi, "getEnumerator");
                try {
                    while ($t.moveNext()) {
                        var active = Bridge.cast($t.Current, HTMLElement);
                        if (System.String.equals(active.getAttribute("data-feature"), id)) {
                            return active;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return null;
            },
            FeatureContextMenu: function (e, feature) {
                if (!Core.Clients.Client.SystemRole) {
                    return;
                }

                e.preventDefault();
                var ctxMenu = Core.Components.Forms.ContextMenu.Instance;
                {
                    ctxMenu.Top = Core.Extensions.EventExt.Top(e);
                    ctxMenu.Left = Core.Extensions.EventExt.Left(e);
                    ctxMenu.MenuItems = Bridge.fn.bind(this, function (_o1) {
                            var $t;
                            _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-plus", $t.Text = "New feature", $t.Click = Bridge.fn.cacheBind(this, this.EditFeature), $t.Parameter = new Core.Models.Feature(), $t));
                            _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "mif-unlink", $t.Text = "Deactivate this feature", $t.Click = Bridge.fn.cacheBind(this, this.Deactivate), $t.Parameter = feature, $t));
                            _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-clone", $t.Text = "Clone this feature", $t.Click = Bridge.fn.cacheBind(this, this.CloneFeature), $t.Parameter = feature, $t));
                            _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-list", $t.Text = "Manage features", $t.Click = Bridge.fn.cacheBind(this, this.FeatureManagement), $t));
                            _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-wrench", $t.Text = "Properties", $t.Click = Bridge.fn.cacheBind(this, this.EditFeature), $t.Parameter = feature, $t));
                            return _o1;
                        })(new (System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem)).ctor());
                }
                ;
                ctxMenu.Render();
            },
            EditFeature: function (ev) {
                var $t;
                var feature = Bridge.as(ev, Core.Models.Feature);
                var editor = ($t = new Core.Components.Framework.FeatureBL(), $t.Entity = feature, $t.ParentElement = document.body, $t.OpenFrom = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, this), $t);
                this.AddChild(editor);
            },
            CloneFeature: function (ev) {
                var $t;
                var feature = Bridge.as(ev, Core.Models.Feature);
                var confirmDialog = ($t = new Core.Components.Forms.ConfirmDialog(), $t.Content = "B\u1ea1n c\u00f3 mu\u1ed1n clone feature n\u00e0y?", $t);
                confirmDialog.YesConfirmed = Bridge.fn.combine(confirmDialog.YesConfirmed, Bridge.fn.bind(this, function () {
                    var $t1;
                    var sql = ($t1 = new Core.ViewModels.SqlViewModel(), $t1.ComId = "Feature", $t1.Action = "Clone", $t1.Ids = System.Array.init([feature.Id], System.String), $t1);
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Clients.Client.Instance.SubmitAsync(System.Boolean, ($t1 = new Core.Clients.XHRWrapper(), $t1.IsRawString = true, $t1.Url = Core.Extensions.Utils.UserSvc, $t1.Method = Core.Enums.HttpMethod.POST, $t1.Value = JSON.stringify(sql), $t1)), Bridge.fn.bind(this, function (x) {
                        this.ReloadMenu(feature.ParentId);
                    }));
                }));
                this.AddChild(confirmDialog);
            },
            FeatureManagement: function (ev) {
                var $t;
                var editor = ($t = new Core.Components.Framework.FeatureBL(), $t.ParentElement = document.body, $t.OpenFrom = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, this), $t);
                this.AddChild(editor);
            },
            Deactivate: function (ev) {
                var feature = Bridge.as(ev, Core.Models.Feature);
                var confirmDialog = new Core.Components.Forms.ConfirmDialog();
                confirmDialog.Content = "DO you want to deactivate this feature?";
                confirmDialog.YesConfirmed = Bridge.fn.combine(confirmDialog.YesConfirmed, function () {
                    Core.Extensions.EventExt.Done$1(System.Array.type(System.String), Core.Clients.Client.Instance.DeactivateAsync(System.Array.init([feature.Id], System.String), "Feature", Core.Clients.Client.ConnKey));
                });
                this.AddChild(confirmDialog);
            },
            MenuItemClick: function (feature, e) {
                var a = Bridge.as(e.target, HTMLElement);
                if (!(Bridge.is(a, HTMLAnchorElement))) {
                    a = Bridge.as(Core.Extensions.HtmlElementExtension.Closest(a, "a"), HTMLAnchorElement);
                }
                var li = Core.Extensions.HtmlElementExtension.Closest(a, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.li));
                if (Core.Extensions.HtmlElementExtension.HasClass(li, "menu-open")) {
                    Core.Extensions.HtmlElementExtension.RemoveClass(li, "menu-open");
                    return;
                }
                this.HideAll(Core.Extensions.HtmlElementExtension.Closest(a, "ul"));
                a.focus();
                if (Core.Extensions.HtmlElementExtension.HasClass(a, Core.Components.Framework.MenuComponent.ActiveClass)) {
                    Core.Extensions.HtmlElementExtension.RemoveClass(a, Core.Components.Framework.MenuComponent.ActiveClass);
                } else {
                    Core.Extensions.HtmlElementExtension.AddClass(a, Core.Components.Framework.MenuComponent.ActiveClass);
                }
                if (Core.Extensions.HtmlElementExtension.HasClass(li, "menu-open")) {
                    Core.Extensions.HtmlElementExtension.RemoveClass(li, "menu-open");
                } else {
                    Core.Extensions.HtmlElementExtension.AddClass(li, "menu-open");
                }
                Core.Components.Framework.MenuComponent.OpenFeature(feature);
            },
            FocusFeature: function (parentFeatureID) {
                var $t;
                var li = this.FindMenuItemByID(parentFeatureID);
                if (li != null) {
                    var activeLi = document.querySelectorAll(".sidebar-items li.active");
                    $t = Bridge.getEnumerator(activeLi, "getEnumerator");
                    try {
                        while ($t.moveNext()) {
                            var active = Bridge.cast($t.Current, HTMLElement);
                            if (active.contains(li)) {
                                continue;
                            }
                            Core.Extensions.HtmlElementExtension.RemoveClass(active, "active");
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    Core.Extensions.HtmlElementExtension.AddClass(li, Core.Components.Framework.MenuComponent.ActiveClass);
                    Core.Extensions.HtmlElementExtension.AddClass(li.parentElement, Core.Components.Framework.MenuComponent.ActiveClass);
                }
            },
            RemoveDOM: function () {
                Core.MVVM.Html.Take$1(".sidebar-wrapper").Clear();
            },
            UpdateView: function (force, dirty, componentNames) {
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                // Not to do anything here
            }
        }
    });

    Bridge.define("Core.Components.Framework.NotificationBL", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                NoMoreTask: null,
                _instance: null,
                _countNtf: null,
                _countUser: null
            },
            props: {
                Notifications: null,
                UserActive: null,
                Instance: {
                    get: function () {
                        if (Core.Components.Framework.NotificationBL._instance == null) {
                            Core.Components.Framework.NotificationBL._instance = new Core.Components.Framework.NotificationBL();
                        }
                        return Core.Components.Framework.NotificationBL._instance;
                    }
                }
            },
            ctors: {
                init: function () {
                    this.NoMoreTask = "No more task";
                }
            }
        },
        fields: {
            _task: null,
            _countBadge: null
        },
        props: {
            CurrentUser: null
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, null);
                Core.Components.Framework.NotificationBL.Notifications = new (Core.MVVM.ObservableList$1(Core.Models.TaskNotification)).ctor();
                Core.Components.Framework.NotificationBL.UserActive = new (Core.MVVM.ObservableList$1(Core.Models.User)).ctor();
                Core.Components.Framework.NotificationBL._countNtf = new (Core.MVVM.Observable$1(System.String)).ctor();
                Core.Components.Framework.NotificationBL._countUser = new (Core.MVVM.Observable$1(System.String)).ctor();
                window.addEventListener("task", Bridge.fn.cacheBind(this, this.ProcessIncomMessage));
            }
        },
        methods: {
            ProcessIncomMessage: function (obj) {
                var $t;
                if (obj == null) {
                    return;
                }

                var task = Bridge.cast(obj, Core.Models.TaskNotification);
                if (task == null) {
                    return;
                }

                var existTask = System.Linq.Enumerable.from(Core.Components.Framework.NotificationBL.Notifications.Data, Core.Models.TaskNotification).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.Id, task.Id);
                    }, null);
                if (existTask == null) {
                    Core.Components.Framework.NotificationBL.Notifications.Add(task, 0);
                    this.ToggleBageCount(Core.Components.Framework.NotificationBL.Notifications.Data.Count);
                }
                this.SetBadgeNumber();
                var entity = Core.Extensions.Utils.GetEntityById(task.EntityId);
                task.Entity = ($t = new Core.Models.Entity(), $t.Name = entity.Name, $t);
                if (typeof(Notification) !== 'undefined' && Notification.permission === "granted") {
                    this.ShowNativeNtf(task);
                } else if (typeof(Notification) !== 'undefined' && Notification.permission !== "denied") {
                    Notification.requestPermission().then((permission) => {
                        if (permission !== 'granted') {
                            this.ShowToast(task);
                        }
                        else this.ShowNativeNtf(task);
                    });
                } else this.ShowToast(task);
            },
            SetBadgeNumber: function () {
                var unreadCount = System.Linq.Enumerable.from(Core.Components.Framework.NotificationBL.Notifications.Data, Core.Models.TaskNotification).count(function (x) {
                        return Bridge.referenceEquals(x.StatusId, Bridge.toString((Core.Enums.TaskStateEnum.UnreadStatus)));
                    });
                Core.Components.Framework.NotificationBL._countNtf.Data = unreadCount > 9 ? "9+" : Bridge.toString(unreadCount);
                var badge = unreadCount > 9 ? 9 : unreadCount;
                if (typeof(cordova) !== 'undefined' &&
                    typeof(cordova.plugins) !== 'undefined' &&
                    typeof(cordova.plugins.notification) !== 'undefined') {
                    cordova.plugins.notification.badge.requestPermission(function (granted) {
                        cordova.plugins.notification.badge.set(unreadCount);
                    });
                }
                return badge;
            },
            ShowNativeNtf: function (task) {
                if (task == null) {
                    return;
                }

                var nativeNtf = new Notification(task.Title,
                {
                    body: task.Description,
                    icon: task.Attachment,
                    vibrate: [200, 100, 200],
                    badge: "./favicon.ico"
                });
                nativeNtf.addEventListener('click', () => this.OpenNotification(task));
                setTimeout(() =>
                {
                    nativeNtf.close();
                }, 7000);
            },
            Render: function () {
                var $t;
                Core.MVVM.Html.Take$1("#notification-list").Clear();
                Core.MVVM.Html.Take$1("#user-active").Clear();
                this.SetBadgeNumber();
                this.CurrentUser = Core.Clients.Client.Token;
                this.CurrentUser.Avatar = ((System.String.contains(this.CurrentUser.Avatar,"://") ? "" : Core.Clients.Client.Origin) || "") + ((Core.Extensions.StringExt.IsNullOrWhiteSpace(this.CurrentUser.Avatar) ? "./image/chinese.jfif" : this.CurrentUser.Avatar) || "");
                this.RenderNotification();
                this.RenderProfile(".profile-info1");
                var xhr = ($t = new Core.Clients.XHRWrapper(), $t.Url = System.String.format("/GetUserActive", null), $t.Method = Core.Enums.HttpMethod.POST, $t.ShowError = false, $t);
                Core.Extensions.EventExt.Catch(Core.Extensions.EventExt.Done$1(System.Collections.Generic.List$1(Core.Models.User), Core.Clients.Client.Instance.SubmitAsync(System.Collections.Generic.List$1(Core.Models.User), xhr), function (x) {
                    Core.Components.Framework.NotificationBL.UserActive.Data = x;
                }), System.Console.WriteLine);
            },
            RenderProfile: function (classname) {
                var isSave = window.localStorage.getItem("isSave");
                Core.MVVM.Html.Take$1(classname).Clear();
                var html = Core.MVVM.Html.Take$1(classname);
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(html.A, "navbar-nav-link d-flex align-items-center dropdown-toggle").DataAttr$1("toggle", "dropdown").Span, "text-truncate").Text((this.CurrentUser.TenantCode || "") + ": " + (this.CurrentUser.FullName || "")).EndOf(Core.MVVM.ElementType.a).Div, "dropdown-menu dropdown-menu-right notClose mt-0 border-0").Style$1("border-top-left-radius: 0;border-top-right-radius: 0").A, "dropdown-item").Event$1("click", Bridge.fn.cacheBind(this, this.ViewProfile)).I, "far fa-user").End.Text("Account (" + (this.CurrentUser.TenantCode || "") + ": " + (this.CurrentUser.FullName || "") + ")").EndOf(Core.MVVM.ElementType.a);
                Core.Components.Renderer.ClassName(html.Div, "dropdown-divider").EndOf(Core.MVVM.ElementType.div);
                var langSelect = new Core.Components.LangSelect(new Core.Models.Component(), html.GetContext());
                langSelect.Render();
                Core.Components.Renderer.ClassName(html.Div, "dropdown-divider").EndOf(Core.MVVM.ElementType.div);
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(html.A.Event$1("click", Bridge.fn.cacheBind(this, this.SignOut)), "dropdown-item").I, "far fa-power-off").End.Text("Logout").EndOf(Core.MVVM.ElementType.a);
            },
            SignOut: function (e) {
                e.preventDefault();
                var task = Core.Clients.Client.Instance.PostAsync(System.Boolean, Core.Clients.Client.Token, "/user/signOut");
                Core.Clients.Client.ExecTask(System.Boolean, task, function (res) {
                    !Bridge.staticEquals(Core.Clients.Client.SignOutEventHandler, null) ? Core.Clients.Client.SignOutEventHandler() : null;
                    Core.Clients.Client.Token = null;
                    Core.Components.Forms.EditForm.NotificationClient != null ? Core.Components.Forms.EditForm.NotificationClient.Close() : null;
                    window.setTimeout(function () {
                        window.location.reload();
                    }, 1000);
                });
            },
            ViewProfile: function (e) {
                e.preventDefault();
                var task = Core.Components.Extensions.ComponentExt.OpenTab$1(this, "User" + (Core.Clients.Client.Token.UserId || ""), "UserProfile", function () {
                    var type = Bridge.Reflection.getType("Core.Fw.User.UserProfileBL");
                    var instance = Bridge.as(Bridge.createInstance(type), Core.Components.Forms.TabEditor);
                    return instance;
                }, false, false);
                Core.Clients.Client.ExecTask(Core.Components.Forms.TabEditor, task);
                this.Dispose();
            },
            RenderNotification: function () {
                var html = Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take$1("#notification-list").A, "navbar-nav-link").DataAttr$1("toggle", "dropdown").I, "far fa-bell fa-lg").EndOf(Core.MVVM.ElementType.i);
                if (!Bridge.referenceEquals(Core.Components.Framework.NotificationBL._countNtf.Data, "")) {
                    Core.Components.Renderer.ClassName(html.Span, "badge badge-pill bg-warning-400 ml-auto ml-md-0").Text$1(System.String, Core.Components.Framework.NotificationBL._countNtf);
                    this._countBadge = Core.MVVM.Html.Context;
                }
                ;
                html.EndOf(Core.MVVM.ElementType.a);
                Core.Components.Renderer.ClassName(html.Div.Style$1("border-top-left-radius: 0;border-top-right-radius: 0"), "dropdown-menu dropdown-menu-right dropdown-content wmin-md-300 mt-0").Style$1("border-top-left-radius: 0; border-top-right-radius: 0");
                html.Div.ForEach(Core.Models.TaskNotification, Core.Components.Framework.NotificationBL.Notifications, Bridge.fn.bind(this, function (task, index) {
                    this.RenderTask(task);
                })).End.Render();
                Core.Components.Renderer.ClassName(html.A, "dropdown-item dropdown-footer").Event$1("click", Bridge.fn.cacheBind(this, this.SeeMore)).Text("See more").EndOf(Core.MVVM.ElementType.a);
            },
            RenderTask: function (task) {
                if (task == null) {
                    return;
                }

                var className = Bridge.referenceEquals(task.StatusId, Bridge.toString((Core.Enums.TaskStateEnum.UnreadStatus))) ? "text-danger" : "text-muted";
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.A, "dropdown-item").Div, "media").Event$1("click", Bridge.fn.bind(this, function (e) {
                    this.OpenNotification(task);
                })).Div, "media-body").H3, "dropdown-item-title").Text(task.Title).Span, "float-right text-sm " + (className || "")).I, "fas fa-star").End.End.End.P, "text-sm").Text(task.Description).End.P, "text-sm text-muted").I, "far fa-clock mr-1").End.Text(task.Deadline.ToString$1("dd/MM/yyyy HH:mm")).EndOf(Core.MVVM.ElementType.a);
            },
            ToggleBageCount: function (count) {
                this._countBadge.style.display = count === 0 ? "none" : "inline-block";
            },
            SeeMore: function (e) {
                var $t;
                e.preventDefault();
                var lastSeenTask = System.Linq.Enumerable.from(Core.Components.Framework.NotificationBL.Notifications.Data, Core.Models.TaskNotification).orderByDescending(function (x) {
                        return x.InsertedDate;
                    }).firstOrDefault(null, null);
                if (lastSeenTask == null) {
                    Core.Extensions.Toast.Warning(Core.Components.Framework.NotificationBL.NoMoreTask);
                    return;
                }
                Core.Components.Spinner.AppendTo(this.Element, true, true, 250);
                var lastSeenDateStr = Core.Extensions.DateTimeExt.ToISOFormat$1(lastSeenTask.InsertedDate);
                var sql = ($t = new Core.ViewModels.SqlViewModel(), $t.ComId = "Task", $t.Action = "SeeMore", $t.ConnKey = Core.Clients.Client.ConnKey, $t.Params = JSON.stringify(new $asm.$AnonymousType$10(lastSeenDateStr)), $t);
                var xhr = ($t = new Core.Clients.XHRWrapper(), $t.Method = Core.Enums.HttpMethod.POST, $t.IsRawString = true, $t.Url = Core.Extensions.Utils.UserSvc, $t.Value = JSON.stringify(sql), $t);
                Core.Extensions.EventExt.Catch(Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), Core.Clients.Client.Instance.SubmitAsync(System.Array.type(System.Array.type(System.Object)), xhr), function (ds) {
                    var olderItems = ds.length > 0 ? System.Linq.Enumerable.from(ds[System.Array.index(0, ds)], System.Object).select(function (x) {
                            return Core.Extensions.BridgeExt.CastProp(Core.Models.TaskNotification, x);
                        }).ToArray(Core.Models.TaskNotification) : null;
                    if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.TaskNotification, olderItems)) {
                        Core.Extensions.Toast.Warning(Core.Components.Framework.NotificationBL.NoMoreTask);
                        return;
                    }
                    var taskList = System.Linq.Enumerable.from(Core.Components.Framework.NotificationBL.Notifications.Data, Core.Models.TaskNotification).union(olderItems).toList(Core.Models.TaskNotification);
                    Core.Components.Framework.NotificationBL.Notifications.Data = taskList;
                }), function (err) {
                    var $t1;
                    Core.Extensions.Toast.Warning(($t1 = (err != null ? err.Message : null), $t1 != null ? $t1 : Core.Components.Framework.NotificationBL.NoMoreTask));
                });
            },
            MarkAllAsRead: function (e) {
                e.preventDefault();
                var allReadTask = Core.Clients.Client.Instance.PostAsync(System.Boolean, null, "TaskNotification/MarkAllAsRead");
                Core.Clients.Client.ExecTask(System.Boolean, allReadTask, Bridge.fn.bind(this, function (res) {
                    var $t;
                    this.ToggleBageCount(System.Linq.Enumerable.from(Core.Components.Framework.NotificationBL.Notifications.Data, Core.Models.TaskNotification).count(function (x) {
                            return Bridge.referenceEquals(x.StatusId, Bridge.toString((Core.Enums.TaskStateEnum.UnreadStatus)));
                        }));
                    $t = Bridge.getEnumerator(this._task.querySelectorAll(".task-unread"), "getEnumerator");
                    try {
                        while ($t.moveNext()) {
                            var task = $t.Current;
                            Core.Extensions.HtmlElementExtension.ReplaceClass(task, "task-unread", "task-read");
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                }));
            },
            OpenNotification: function (notification) {
                this.MarkAsRead(notification);
            },
            RemoveDOM: function () {
                Core.MVVM.Html.Take$1("#notification").Clear();
            },
            MarkAsRead: function (task) {
                task.StatusId = Bridge.toString((Core.Enums.TaskStateEnum.Read));
                Core.Extensions.EventExt.Done$1(System.Int32, Core.Clients.Client.Instance.PatchAsync(Core.Components.Extensions.ComponentExt.MapToPatch(Core.Models.TaskNotification, task)), Bridge.fn.bind(this, function (x) {
                    this.SetBadgeNumber();
                }));
            },
            Dispose: function () {
                Core.Extensions.HtmlElementExtension.AddClass(this._task, "hide");
            }
        }
    });

    Bridge.define("$AnonymousType$10", $asm, {
        $kind: "anonymous",
        ctors: {
            ctor: function (date) {
                this.Date = date;
            }
        },
        methods: {
            equals: function (o) {
                if (!Bridge.is(o, $asm.$AnonymousType$10)) {
                    return false;
                }
                return Bridge.equals(this.Date, o.Date);
            },
            getHashCode: function () {
                var h = Bridge.addHash([7550208474, this.Date]);
                return h;
            },
            toJSON: function () {
                return {
                    Date : this.Date
                };
            }
        },
        statics : {
            methods: {
                $metadata : function () { return {"m":[{"a":2,"n":"Date","t":16,"rt":System.String,"g":{"a":2,"n":"get_Date","t":8,"rt":System.String,"fg":"Date"},"fn":"Date"}]}; }
            }
        }
    });

    Bridge.define("Core.Components.Image", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                PathSeparator: null,
                PNGUrlPrefix: null,
                JpegUrlPrefix: null,
                GuidLength: 0,
                _preview: null
            },
            ctors: {
                init: function () {
                    this.PathSeparator = "    ";
                    this.PNGUrlPrefix = "data:image/png;base64,";
                    this.JpegUrlPrefix = "data:image/jpeg;base64,";
                    this.GuidLength = 36;
                }
            },
            methods: {
                RemoveGuid: function (path) {
                    var thumbText = path;
                    if (path.length > Core.Components.Image.GuidLength) {
                        var fileName = System.IO.Path.GetFileNameWithoutExtension(path);
                        thumbText = (Core.Extensions.StringExt.SubStrIndex$1(fileName, 0, ((fileName.length - Core.Components.Image.GuidLength) | 0)) || "") + (System.IO.Path.GetExtension(path) || "");
                    }

                    return thumbText;
                }
            }
        },
        fields: {
            _path: null,
            _input: null,
            _disabledDelete: false,
            _gallerys: null,
            zoomLevel: 0,
            flagZoomIn: 0,
            zoomMaxLevel: 0
        },
        events: {
            FileUploaded: null
        },
        props: {
            Path: {
                get: function () {
                    return this._path;
                },
                set: function (value) {
                    var $t;
                    System.Linq.Enumerable.from(this.ParentElement.querySelectorAll(".gallery")).select(function (x) { return Bridge.cast(x, HTMLElement); }).forEach(function (x) {
                        x.remove();
                    });
                    this._path = value;
                    if (this.Entity != null) {
                        Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this._path);
                    }

                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(this._path)) {
                        return;
                    }

                    var updatedImages = ($t = System.String, System.Linq.Enumerable.from(this._path.split(Core.Components.Image.PathSeparator), $t).toList($t));
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, updatedImages)) {
                        return;
                    }

                    updatedImages.ForEach(Bridge.fn.bind(this, function (x) {
                        this.RenderFileThumb(x);
                    }));
                }
            },
            DataSourceFilter: null,
            _imageSources: {
                get: function () {
                    return this._path != null ? this._path.split(Core.Components.Image.PathSeparator) : null;
                }
            },
            Disabled: {
                get: function () {
                    return Bridge.ensureBaseProperty(this, "Disabled").$Core$Components$EditableComponent$Disabled;
                },
                set: function (value) {
                    if (this._input != null) {
                        this._input.disabled = value;
                    }

                    Bridge.ensureBaseProperty(this, "Disabled").$Core$Components$EditableComponent$Disabled = value;
                    if (value) {
                        this.ParentElement.setAttribute("disabled", "");
                    } else {
                        this.ParentElement.removeAttribute("disabled");
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.flagZoomIn = 1;
                this.zoomMaxLevel = 3;
            },
            ctor: function (ui) {
                var $t;
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.GuiInfo = ui;
                this.DataSourceFilter = ($t = this.GuiInfo.DataSourceFilter, $t != null ? $t : "image/*");
            }
        },
        methods: {
            Render: function () {
                var $t, $t1, $t2, $t3, $t4;
                this._path = ($t = this.Entity) != null && ($t1 = Core.Extensions.Utils.GetPropValue($t, this.FieldName)) != null ? Bridge.toString($t1) : null;
                var paths = this._path != null ? ($t2 = System.String, System.Linq.Enumerable.from(this._path.split(Core.Components.Image.PathSeparator), $t2).toList($t2)) : null;
                this.RenderUploadForm();
                this.Path = this._path;
                !Bridge.staticEquals(($t3 = this.DOMContentLoaded), null) ? $t3() : null;
                ($t4 = Core.Extensions.HtmlElementExtension.Closest(this.Element, "td")) != null ? $t4.addEventListener("keydown", Bridge.fn.cacheBind(this, this.ListViewItemTab)) : null;
            },
            RenderFileThumb: function (path) {
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this._gallerys).Div, "gallery");
                var thumbText = Core.Components.Image.RemoveGuid(path);
                var isImage = System.IO.Path.IsImage(path);
                if (isImage) {
                    Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "file-upload").Img, "image").Style$1(this.GuiInfo.ChildStyle).Src(((System.String.contains(path,"http") ? "" : Core.Clients.Client.Origin) || "") + (Core.Extensions.Utils.DecodeSpecialChar(path) || "")).Render();
                } else {
                    Core.Components.Renderer.Title(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Span, System.String.contains(thumbText,"pdf") ? "fal fa-file-pdf" : "fal fa-file"), Core.Extensions.Utils.DecodeSpecialChar(thumbText)).Style$1(this.GuiInfo.ChildStyle).Href(((System.String.contains(path,"http") ? "" : Core.Clients.Client.Origin) || "") + (Core.Extensions.Utils.DecodeSpecialChar(path) || "")).Render();
                }
                Core.MVVM.Html.Instance.End.Render();
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "middle d-flex").Div, "preview").Event$2(System.String, "click", Bridge.fn.cacheBind(this, this.Preview), Core.Extensions.Utils.DecodeSpecialChar(path)).I, "fas fa-eye").EndOf(Core.MVVM.ElementType.div);
                if (!this.Disabled) {
                    Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "delete").Event$4(System.String, "click", Bridge.fn.cacheBind(this, this.RemoveFile), path).I, "fas fa-trash-alt").EndOf(Core.MVVM.ElementType.div);
                }
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div, "middle-secondery").Style$1("font-size:8px").Text(Core.Extensions.Utils.DecodeSpecialChar(thumbText)).Render();
                return this._gallerys;
            },
            SetCanDeleteImage: function (canDelete) {
                this._disabledDelete = !canDelete;
                if (canDelete) {
                    this.UpdateView();
                }
            },
            Preview: function (path) {
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(path)) {
                    return;
                }

                if (!System.IO.Path.IsImage(path)) {
                    Core.Clients.Client.Download(path);
                    return;
                }

                var img = null;
                var rotate = 0;
                Core.Components.Renderer.Escape(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(Bridge.ensureBaseProperty(this, "EditForm").$Core$Components$EditableComponent$EditForm.Element).Div, "dark-overlay zoom"), function (e) {
                    Core.Components.Image._preview.remove();
                }).Event$1("keydown", Bridge.fn.bind(this, function (e) {
                    var keyCode = Core.Extensions.EventExt.KeyCodeEnum(e);
                    if (System.Nullable.neq(keyCode, Core.Enums.KeyCodeEnum.LeftArrow) && System.Nullable.neq(keyCode, Core.Enums.KeyCodeEnum.RightArrow)) {
                        return;
                    }

                    if (System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.LeftArrow)) {
                        path = this.MoveLeft(path, img);
                    } else {
                        path = this.MoveRight(path, img);
                    }
                }));
                Core.Components.Image._preview = Core.MVVM.Html.Context;
                Core.MVVM.Html.Instance.Img.Src(((System.String.contains(path,"http") ? "" : Core.Clients.Client.Origin) || "") + (path || ""));
                img = Bridge.as(Core.MVVM.Html.Context, HTMLImageElement);
                Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.Title(Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Span, "close").Event("click", function () {
                    Core.Components.Image._preview.remove();
                }).End.Div, "toolbar"), "fa fa-undo ro-left").Event("click", function () {
                    rotate = (rotate - 90) | 0;
                    img.style.transform = System.String.format("rotate({0}deg)", [Bridge.box(rotate, System.Int32)]);
                }).End, "fa fa-cloud-download-alt"), "T\u1ea3i xu\u1ed1ng").Event("click", function () {
                    var link = Bridge.as(document.createElement("a"), HTMLAnchorElement);
                    link.href = img.src;
                    link.download = img.src.substr(img.src.lastIndexOf("/"));
                    document.body.appendChild(link);
                    link.click();
                    link.remove();
                }).End, "fa fa-redo ro-right").Event("click", function () {
                    rotate = (rotate + 90) | 0;
                    img.style.transform = System.String.format("rotate({0}deg)", [Bridge.box(rotate, System.Int32)]);
                }).End.End, "fa fa-chevron-left").Event("click", Bridge.fn.bind(this, function () {
                    path = this.MoveLeft(path, img);
                })).End, "fa fa-chevron-right").Event("click", Bridge.fn.bind(this, function () {
                    path = this.MoveRight(path, img);
                })).End.Render();
                zoom();
            },
            ZoomImage: function (img) {
                if (this.flagZoomIn < this.zoomMaxLevel) {
                    if (this.zoomLevel === 0 || this.zoomLevel < this.zoomMaxLevel) {
                        img.style.cursor = "zoom-in";
                        img.height = (img.height + 450) | 0;
                        img.width = (img.width + 400) | 0;
                        this.zoomLevel = (this.zoomLevel + 1) | 0;
                        this.flagZoomIn = (this.flagZoomIn + 1) | 0;
                    }
                } else if (this.flagZoomIn === this.zoomMaxLevel) {
                    if (this.zoomLevel === 1) {
                        this.flagZoomIn = 1;
                    }
                    img.style.cursor = "zoom-out";
                    img.height = (img.height - 450) | 0;
                    img.width = (img.width - 400) | 0;
                    this.zoomLevel = (this.zoomLevel - 1) | 0;
                }
                //img.Style.Transform = $"scale({zoomLevel})";
            },
            MoveAround: function (e, path) {
                var keyCode = Core.Extensions.EventExt.KeyCodeEnum(e);
                if (System.Nullable.neq(keyCode, Core.Enums.KeyCodeEnum.LeftArrow) && System.Nullable.neq(keyCode, Core.Enums.KeyCodeEnum.RightArrow)) {
                    return;
                }
                var img;
                if (!(((img = Bridge.as(e.target.firstElementChild, HTMLImageElement))) != null)) {
                    return;
                }

                if (System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.LeftArrow)) {
                    this.MoveLeft(path, img);
                } else {
                    this.MoveRight(path, img);
                }
            },
            MoveLeft: function (path, img) {
                var $t, $t1;
                var index = System.Array.indexOfT(this._imageSources, path);
                if (index === 0) {
                    index = (this._imageSources.length - 1) | 0;
                } else {
                    index = (index - 1) | 0;
                }

                img.src = ((System.String.contains(path,"http") ? "" : Core.Clients.Client.Origin) || "") + (($t = this._imageSources)[System.Array.index(index, $t)] || "");
                return ($t1 = this._imageSources)[System.Array.index(index, $t1)];
            },
            MoveRight: function (path, img) {
                var $t, $t1;
                var index = System.Array.indexOfT(this._imageSources, path);
                if (index === 0) {
                    index = (this._imageSources.length - 1) | 0;
                } else {
                    index = (index - 1) | 0;
                }

                img.src = ((System.String.contains(path,"http") ? "" : Core.Clients.Client.Origin) || "") + (($t = this._imageSources)[System.Array.index(index, $t)] || "");
                return ($t1 = this._imageSources)[System.Array.index(index, $t1)];
            },
            OpenFileDialog: function (e) {
                if (this.Disabled) {
                    return;
                }

                this.OpenNativeFileDialog(e);
                return;
                if (typeof(navigator.camera) === 'undefined')
                {
                    this._input.click();
                }
                else
                {
                    this.RenderImageSourceChooser();
                }
            },
            RenderUploadForm: function () {
                var isMultiple = System.Nullable.eq(this.GuiInfo.Precision, 0);
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement), "choose-files").Input.Type$1("file").Attr$1("name", "files"), "d-none").Attr$1("accept", this.DataSourceFilter).Event$1("change", Bridge.fn.cacheBind(this, this.UploadSelectedImages)).Render();
                this.Element = (this._input = Bridge.as(Core.MVVM.Html.Context, HTMLInputElement));
                if (isMultiple) {
                    Core.MVVM.Html.Instance.Attr$1("multiple", "multiple");
                }
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Div, "file-upload").I, "fal fa-file-alt").Event$1("click", Bridge.fn.cacheBind(this, this.OpenFileDialog)).End.Div, "gallerys").Render();
                this._gallerys = Bridge.as(Core.MVVM.Html.Context, HTMLDivElement);
            },
            RemoveFile: function (e, removedPath) {
                if (this.Disabled) {
                    return;
                }

                e.stopPropagation();
                if (Core.Extensions.StringExt.IsNullOrEmpty(removedPath)) {
                    return;
                }
                var message = System.String.format("B\u1ea1n ch\u1eafc ch\u1eafn mu\u1ed1n x\u00f3a {0}", [(System.IO.Path.GetFileNameWithoutExtension(Core.Components.Image.RemoveGuid(Core.Extensions.Utils.DecodeSpecialChar(removedPath))) || "") + (System.IO.Path.GetExtension(Core.Components.Image.RemoveGuid(Core.Extensions.Utils.DecodeSpecialChar(removedPath))) || "")]);
                Core.Components.Forms.ConfirmDialog.RenderConfirm(message, Bridge.fn.bind(this, function () {
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Clients.Client.Instance.PostAsync(System.Boolean, removedPath, (Core.Clients.Client.FileFTP || "") + "/DeleteFile"), Bridge.fn.bind(this, function (success) {
                        var $t, $t1;
                        var oldVal = this._path;
                        var newPath = System.Linq.Enumerable.from(System.String.replaceAll(System.String.replaceAll(this._path, removedPath, ""), "        ", "").split(Core.Components.Image.PathSeparator), System.String).where(function (x) {
                                return Core.Extensions.StringExt.HasAnyChar(x);
                            }).distinct().toList(System.String);
                        this.Path = Bridge.toArray(newPath).join(Core.Components.Image.PathSeparator);
                        this.Dirty = true;
                        !Bridge.staticEquals(($t = this.UserInput), null) ? $t(($t1 = new Core.MVVM.ObservableArgs(), $t1.NewData = this._path, $t1.OldData = oldVal, $t1.FieldName = this.FieldName, $t1.EvType = "change", $t1)) : null;
                        Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity]));
                    }));
                }));
            },
            UploadSelectedImages: function (e) {
                e.preventDefault();
                if (this.EditForm.IsLock) {
                    return;
                }
                var files = Bridge.as(e.target.files, FileList);
                if (Core.Extensions.IEnumerableExtensions.Nothing(File, files)) {
                    return;
                }
                var oldVal = this._path;
                var task = this.UploadAllFiles(files);
                Core.Clients.Client.ExecTaskNoResult(task, Bridge.fn.bind(this, function () {
                    var $t, $t1;
                    this.Dirty = true;
                    this._input.value = "";
                    !Bridge.staticEquals(($t = this.UserInput), null) ? $t(($t1 = new Core.MVVM.ObservableArgs(), $t1.NewData = this._path, $t1.OldData = oldVal, $t1.FieldName = this.FieldName, $t1.EvType = "change", $t1)) : null;
                    var dispatch = Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity]);
                    Core.Clients.Client.ExecTaskNoResult(dispatch);
                }));
            },
            UploadBase64Image: function (base64Image, fileName) {
                var $t;
                return Core.Clients.Client.Instance.SubmitAsync(System.String, ($t = new Core.Clients.XHRWrapper(), $t.Value = base64Image, $t.Url = System.String.format("/user/image/?name={0}", [fileName]), $t.IsRawString = true, $t.Method = Core.Enums.HttpMethod.POST, $t));
            },
            UpdateView: function (force, dirty, componentNames) {
                var $t;
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                this.Path = ($t = Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName)) != null ? Bridge.toString($t) : null;
                Core.Components.EditableComponent.prototype.UpdateView.call(this, force, dirty, componentNames);
            },
            UploadFile: function (file) {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                if (this.GuiInfo.IsRealtime || !Core.Extensions.IEnumerableExtensions.HasElement(System.String, file.type.match("image.*"))) {
                    Core.Extensions.EventExt.Done$1(System.String, Core.Clients.Client.Instance.PostFilesAsync(System.String, file, Core.Extensions.Utils.FileSvc), function (path) {
                        tcs.setResult(path);
                    });
                    return tcs.task;
                } /// Simplify object initialization


                var reader = new FileReader();
                reader.onload = Bridge.fn.bind(this, function (e) {
                    Core.Extensions.EventExt.Done$1(System.String, this.UploadBase64Image(Bridge.toString(e.target.result), file.name), Bridge.fn.bind(this, function (path) {
                        var $t;
                        tcs.setResult(path);
                        Core.Extensions.EventExt.Done$1(System.Int32, Core.Clients.Client.Instance.PatchAsync(($t = new Core.ViewModels.PatchVM(), $t.Table = "FileUpload", $t.Changes = Bridge.fn.bind(this, function (_o1) {
                                var $t1;
                                _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = this.Id, $t1.Value = Core.Structs.Uuid7.Id25(), $t1));
                                _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "EntityName", $t1.Value = this.GuiInfo.RefName, $t1));
                                _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "RecordId", $t1.Value = this.EntityId, $t1));
                                _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "SectionId", $t1.Value = this.GuiInfo.ComponentGroupId, $t1));
                                _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "FieldName", $t1.Value = this.FieldName, $t1));
                                _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "FileName", $t1.Value = file.name, $t1));
                                _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "FilePath", $t1.Value = path, $t1));
                                return _o1;
                            })(new (System.Collections.Generic.List$1(Core.ViewModels.PatchDetail)).ctor()), $t)));
                    }));
                });
                reader.readAsDataURL(file);
                return tcs.task;
            },
            UploadAllFiles: function (filesSelected) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    files, 
                    allPath, 
                    paths, 
                    oldVal, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        Core.Components.Spinner.AppendTo(this.EditForm.Element);
                                        files = System.Linq.Enumerable.from(filesSelected, File).select(Bridge.fn.cacheBind(this, this.UploadFile));
                                        $task1 = System.Threading.Tasks.Task.whenAll(files);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        allPath = $taskResult1;
                                        if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, allPath)) {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        if (System.Nullable.eq(this.GuiInfo.Precision, 0)) {
                                            paths = (this.Path || "") + (Core.Components.Image.PathSeparator || "") + ((allPath).join(Core.Components.Image.PathSeparator) || "");
                                            allPath = System.Linq.Enumerable.from(paths.trim().split(Core.Components.Image.PathSeparator), System.String).distinct().ToArray(System.String);
                                        }
                                        oldVal = this._path;
                                        this.Path = (allPath).join(Core.Components.Image.PathSeparator);
                                        Core.Components.Spinner.Hide();
                                        !Bridge.staticEquals(this.FileUploaded, null) ? this.FileUploaded() : null;
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            OpenNativeFileDialog: function (e) {
                e != null ? e.preventDefault() : null;
                this._input.click();
            },
            GetValueText: function () {
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, this._imageSources)) {
                    return null;
                }
                return Core.Extensions.IEnumerableExtensions.Combine(System.String, System.Linq.Enumerable.from(this._imageSources, System.String).select(function (path) {
                        var label = Core.Components.Image.RemoveGuid(path);
                        return System.String.format("<a target=\"_blank\" href=\"{0}\">{1}</a>", path, label);
                    }), ",");
            }
        }
    });

    Bridge.define("Core.Components.Label", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            methods: {
                CalcTextAlign: function (header, cellData) {
                    var textAlign = header.TextAlignEnum;
                    if (textAlign != null) {
                        return System.Nullable.getValue(textAlign);
                    }

                    if (header.ReferenceId != null || cellData == null || Bridge.is(cellData, System.String)) {
                        return Core.Enums.TextAlign.left;
                    }

                    if (Core.Extensions.ReflectionExt.IsNumber(Bridge.getType(cellData))) {
                        return Core.Enums.TextAlign.right;
                    }

                    if (Bridge.is(cellData, System.Boolean) || Bridge.is(cellData, System.Boolean)) {
                        return Core.Enums.TextAlign.center;
                    }

                    return Core.Enums.TextAlign.center;
                }
            }
        },
        props: {
            RefData: null
        },
        ctors: {
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.GuiInfo = ui;
                this.Element = ele;
            }
        },
        methods: {
            Render: function () {
                var $t;
                this.SetDefaultVal();
                var cellData = Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName);
                var isBool = cellData != null && Core.Extensions.ReflectionExt.IsBool(Bridge.getType(cellData));
                var cellText = "";
                if (this.Element == null) {
                    this.RenderNewEle(cellText, cellData, isBool);
                }
                var formatter = { };
                if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.Query) && Core.Extensions.Utils.IsFunction(this.GuiInfo.FormatEntity, formatter)) {
                    this.RenderCellText(formatter.v);
                    return;
                } else {
                    cellText = this.CalcCellText(cellData);
                    this.UpdateEle(cellText, cellData, isBool);
                }
                ($t = Core.Extensions.HtmlElementExtension.Closest(this.Element, "td")) != null ? $t.addEventListener("keydown", Bridge.fn.cacheBind(this, this.ListViewItemTab)) : null;
                this.Element.parentElement.tabIndex = -1;
            },
            UpdateEle: function (cellText, cellData, isBool) {
                if (isBool) {
                    if (this.GuiInfo.SimpleText) {
                        this.Element.innerHTML = System.Nullable.eq(Bridge.cast(Bridge.unbox(cellData, System.Boolean), System.Boolean, true), true) ? "\u2611" : "\u2610";
                    } else {
                        this.Element.previousElementSibling.checked = System.Nullable.getValue(Bridge.cast(Bridge.unbox(cellData, System.Boolean), System.Boolean));
                    }
                    return;
                }
                this.Element.innerHTML = cellText;
                this.Element.setAttribute("title", cellText);
            },
            RenderNewEle: function (cellText, cellData, isBool) {
                Core.Components.Renderer.TextAlign(Core.MVVM.Html.Take(this.ParentElement), Core.Components.Label.CalcTextAlign(this.GuiInfo, cellData));
                if (isBool) {
                    if (this.GuiInfo.SimpleText) {
                        Core.MVVM.Html.Instance.Text(System.Nullable.eq(Bridge.cast(Bridge.unbox(cellData, System.Boolean), System.Boolean, true), true) ? "\u2611" : "\u2610");
                        Core.MVVM.Html.Context.style.fontSize = "1.2rem";
                    } else {
                        Core.Components.Renderer.SmallCheckbox(Core.Components.Renderer.Padding(Core.MVVM.Html.Instance, Core.Components.Direction.bottom, 0), System.Nullable.getValue(Bridge.cast(Bridge.unbox(Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName), System.Boolean), System.Boolean)));
                        Core.MVVM.Html.Context.previousElementSibling.disabled = true;
                    }

                } else {
                    var containDiv = Bridge.referenceEquals(cellText.substr(0, 4), "<div>");
                    if (containDiv) {
                        Core.MVVM.Html.Instance.Div.Render();
                    } else {
                        Core.MVVM.Html.Instance.Span.Render();
                    }

                    Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Event$1("click", Bridge.fn.cacheBind(this, this.LabelClickHandler)), "cell-text").InnerHTML(cellText);
                }
                this.Element = Core.MVVM.Html.Context;
                Core.MVVM.Html.Instance.End.Render();
            },
            CalcCellText: function (cellData) {
                var cellText = null;
                if (this.GuiInfo.IsPivot) {
                    var fields = this.FieldName.split(".");
                    if (fields.length < 3) {
                        return cellText;
                    }
                    var listData;
                    if (!(((listData = Bridge.as(Core.Extensions.Utils.GetPropValue(this.Entity, fields[System.Array.index(0, fields)]), System.Collections.Generic.IEnumerable$1(System.Object)))) != null)) {
                        return cellText;
                    }

                    var restPivotField = Bridge.toArray(System.Linq.Enumerable.from(fields, System.String).skip(1).take(((fields.length - 2) | 0))).join(".");
                    var row = System.Linq.Enumerable.from(listData, System.Object).firstOrDefault(function (x) {
                            var $t;
                            return Bridge.referenceEquals((($t = Core.Extensions.Utils.GetPropValue(x, restPivotField)) != null ? Bridge.toString($t) : null), Bridge.toString(System.Linq.Enumerable.from(fields, System.String).last()));
                        }, null);
                    cellText = row == null ? "" : Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.FormatEntity, row);
                } else {
                    cellText = Core.Extensions.Utils.GetCellText(this.GuiInfo, cellData, this.Entity, this.EmptyRow);
                }
                if (cellText == null || Bridge.referenceEquals(cellText, "null")) {
                    cellText = "N/A";
                }
                return cellText;
            },
            RenderCellText: function (formatter) {
                var $t;
                if (Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.Query) || formatter == null) {
                    return;
                }
                var fn = { };
                var isFn = Core.Extensions.Utils.IsFunction(this.GuiInfo.PreQuery, fn);
                var entity = isFn ? Bridge.toString(fn.v.call(this, this)) : "";
                var submit = ($t = new Core.ViewModels.SqlViewModel(), $t.Params = JSON.stringify(entity), $t.ComId = this.GuiInfo.Id, $t);
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Object), Core.Clients.Client.Instance.SubmitAsync(System.Array.type(System.Object), ($t = new Core.Clients.XHRWrapper(), $t.Url = Core.Extensions.Utils.ComQuery, $t.IsRawString = true, $t.Value = JSON.stringify(submit), $t.Method = Core.Enums.HttpMethod.POST, $t)), Bridge.fn.bind(this, function (data) {
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, data)) {
                        return;
                    }
                    var text = Bridge.toString(formatter.apply.apply(formatter, [this].concat([Bridge.unbox(System.Array.init([data], System.Object))])));
                    this.UpdateEle(text, null, false);
                }));
            },
            LabelClickHandler: function (e) {
                Core.Clients.Client.ExecTaskNoResult(Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "click", [this.Entity]));
            },
            UpdateView: function (force, dirty, componentNames) {
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                this.PrepareUpdateView(force, dirty);
                this.Render();
            },
            GetValueTextAct: function () {
                return this.Element.textContent;
            }
        }
    });

    Bridge.define("Core.Components.LangSelect", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                LangProp: null,
                LangKey: null,
                LangParam: null,
                LangCode: null,
                Active: null,
                culture: null,
                _dictionaries: null
            },
            props: {
                Culture: {
                    get: function () {
                        if (Core.Components.LangSelect.culture != null) {
                            return Core.Components.LangSelect.culture != null ? System.String.replaceAll(Core.Components.LangSelect.culture, "\"", "") : null;
                        }
                        var res = Core.Clients.LocalStorage.GetItem(System.String, "Culture");
                        if (res != null) {
                            Core.Components.LangSelect.culture = res != null ? System.String.replaceAll(res, "\"", "") : null;
                        }
                        return res != null ? System.String.replaceAll(res, "\"", "") : null;
                    },
                    set: function (value) {
                        if (Bridge.referenceEquals(Core.Components.LangSelect.culture, value)) {
                            return;
                        }
                        Core.Components.LangSelect.culture = value != null ? System.String.replaceAll(value, "\"", "") : null;
                        Core.Clients.LocalStorage.SetItem(System.String, "Culture", value != null ? System.String.replaceAll(value, "\"", "") : null);
                    }
                }
            },
            ctors: {
                init: function () {
                    this.LangProp = "langprop";
                    this.LangKey = "langkey";
                    this.LangParam = "Para";
                    this.LangCode = "langcode";
                    this.Active = "Active";
                    this._dictionaries = new (System.Collections.Generic.Dictionary$2(System.String,System.Collections.Generic.Dictionary$2(System.String,System.String))).ctor();
                }
            },
            methods: {
                SetCultureAndTranslate: function (code) {
                    Core.Components.LangSelect.Culture = code;
                    Core.Components.LangSelect.Translate();
                },
                Get: function (key) {
                    if (Core.Extensions.StringExt.IsNullOrEmpty(key)) {
                        return "";
                    }
                    if (Core.Components.LangSelect.Culture == null) {
                        return key;
                    }
                    var dictionary = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, System.Collections.Generic.Dictionary$2(System.String,System.String), Core.Components.LangSelect._dictionaries, Core.Components.LangSelect.Culture);
                    if (dictionary == null) {
                        dictionary = Core.Clients.LocalStorage.GetItem(System.Collections.Generic.Dictionary$2(System.String,System.String), Core.Components.LangSelect.Culture);
                        if (Core.Components.LangSelect._dictionaries.containsKey(Core.Components.LangSelect.Culture)) {
                            Core.Components.LangSelect._dictionaries.remove(Core.Components.LangSelect.Culture);
                        }
                        System.Collections.Generic.CollectionExtensions.TryAdd(System.String, System.Collections.Generic.Dictionary$2(System.String,System.String), Core.Components.LangSelect._dictionaries, Core.Components.LangSelect.Culture, dictionary);
                    }
                    return dictionary != null && dictionary.containsKey(key) ? dictionary.getItem(key) : key;
                },
                Translate: function (annonymous) {
                    var $t;
                    if (annonymous === void 0) { annonymous = true; }
                    var tcs = new System.Threading.Tasks.TaskCompletionSource();
                    var vm = ($t = new Core.ViewModels.SqlViewModel(), $t.ComId = "Dictionary", $t.Action = "GetAll", $t.AnnonymousTenant = Core.Clients.Client.Tenant, $t);
                    var dictionaryTask = Core.Clients.Client.Instance.SubmitAsync(System.Array.type(System.Array.type(System.Object)), ($t = new Core.Clients.XHRWrapper(), $t.Value = JSON.stringify(vm), $t.IsRawString = true, $t.Url = Core.Extensions.Utils.UserSvc, $t.Method = Core.Enums.HttpMethod.POST, $t.AllowAnonymous = annonymous, $t));
                    Core.Clients.Client.ExecTask(System.Array.type(System.Array.type(System.Object)), dictionaryTask, function (items) {
                        Core.Components.LangSelect.DictionaryLoaded(System.Linq.Enumerable.from(items[System.Array.index(0, items)], System.Object).select(function (x) {
                                return Bridge.unbox(x);
                            }).ToArray(Core.Models.Dictionary));
                        tcs.trySetResult(true);
                    });
                    return tcs.task;
                },
                DictionaryLoaded: function (dictionaryItems) {
                    var map = System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Models.Dictionary, System.String, dictionaryItems, function (x) {
                            return x.Key;
                        }), Core.Models.Dictionary).toDictionary(function (x) {
                            return x.Key;
                        }, function (x) {
                            return x.Value;
                        }, System.String, System.String);
                    if (Core.Components.LangSelect._dictionaries.containsKey(Core.Components.LangSelect.Culture)) {
                        Core.Components.LangSelect._dictionaries.remove(Core.Components.LangSelect.Culture);
                        Core.Components.LangSelect._dictionaries.add(Core.Components.LangSelect.Culture, map);
                    }
                    Core.Clients.LocalStorage.SetItem(System.Collections.Generic.Dictionary$2(System.String,System.String), Core.Components.LangSelect.Culture, map);
                    Core.Extensions.IEnumerableExtensions.SelectForEach(Node, Core.Components.LangSelect.Travel(document), function (x) {
                        var $t;
                        var props = ($t = x[Core.Components.LangSelect.LangProp]) != null ? Bridge.toString($t) : null;
                        if (props == null) {
                            return;
                        }
                        props.split(",").forEach(function (propName) {
                                var $t1;
                                var template = ($t1 = x[(Core.Components.LangSelect.LangKey || "") + (propName || "")]) != null ? Bridge.toString($t1) : null;
                                var parameters = Bridge.as(x[(Core.Components.LangSelect.LangParam || "") + (propName || "")], System.Array.type(System.Object));

                                var translated = map.containsKey(template) ? map.getItem(template) : template;
                                translated = Core.Extensions.IEnumerableExtensions.HasElement(System.Object, parameters) ? System.String.format.apply(System.String, [translated].concat(parameters)) : translated;
                                var text;
                                if (((text = Bridge.as(x, Text))) != null && Bridge.referenceEquals(propName, "TextContent")) {
                                    text.textContent = translated;
                                    return;
                                }
                                var ele = Bridge.as(x, HTMLElement);
                                if (Bridge.referenceEquals(propName, "ClassName")) {
                                    ele.className = System.String.replaceAll(ele.className, template, translated);
                                } else {
                                    ele.setAttribute(propName, translated);
                                }
                            });
                    });
                },
                Travel: function (node) {
                    return new (Bridge.GeneratorEnumerable$1(Node))(Bridge.fn.bind(this, function (node) {
                        var $step = 0,
                            $jumpFromFinally,
                            $returnValue,
                            $t,
                            element,
                            $t1,
                            inner,
                            $async_e;

                        var $enumerator = new (Bridge.GeneratorEnumerator$1(Node))(Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    switch ($step) {
                                        case 0: {
                                            $t = Bridge.getEnumerator(node.childNodes, "getEnumerator");
                                                $step = 1;
                                                continue;
                                        }
                                        case 1: {
                                            if ($t.moveNext()) {
                                                    element = $t.Current;
                                                    $step = 2;
                                                    continue;
                                                }
                                            $step = 8;
                                            continue;
                                        }
                                        case 2: {
                                            $enumerator.current = element;
                                                $step = 3;
                                                return true;
                                        }
                                        case 3: {
                                            $t1 = Bridge.getEnumerator(Core.Components.LangSelect.Travel(element), Node);
                                                $step = 4;
                                                continue;
                                        }
                                        case 4: {
                                            if ($t1.moveNext()) {
                                                    inner = $t1.Current;
                                                    $step = 5;
                                                    continue;
                                                }
                                            $step = 7;
                                            continue;
                                        }
                                        case 5: {
                                            $enumerator.current = inner;
                                                $step = 6;
                                                return true;
                                        }
                                        case 6: {
                                            $step = 4;
                                            continue;
                                        }
                                        case 7: {
                                            $step = 1;
                                            continue;
                                        }
                                        case 8: {

                                        }
                                        default: {
                                            return false;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                throw $async_e;
                            }
                        }));
                        return $enumerator;
                    }, arguments));
                }
            }
        },
        ctors: {
            ctor: function (com, ele) {
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, com);
                this.ParentElement = ele;
            }
        },
        methods: {
            Render: function () {
                var fn = { };
                if (this.GuiInfo != null && !Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.FormatData) && Core.Extensions.Utils.IsFunction(this.GuiInfo.FormatData, fn)) {
                    Core.MVVM.Html.Take(this.ParentElement);
                    fn.v.call(null, this);
                    this.Element = this.ParentElement.firstElementChild;
                }
                if (this.Element == null) {
                    Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Ul, "lang-select").Li.DataAttr$1(Core.Components.LangSelect.LangCode, "vi").Attr$1(Core.Components.LangSelect.Active, System.Boolean.toString((true)).toLowerCase()).Img.Src("./icons/vn.png").EndOf(Core.MVVM.ElementType.li).Li.DataAttr$1(Core.Components.LangSelect.LangCode, "en").Img.Src("./icons/eg.png").EndOf(Core.MVVM.ElementType.li);
                    this.Element = Core.MVVM.Html.Context;
                }
                System.Linq.Enumerable.from(Core.Components.LangSelect.Travel(this.Element), Node).where(function (x) {
                        return Bridge.is(x, HTMLElement);
                    }).select(function (x) {{ return Bridge.cast(x, HTMLElement); }}).forEach(Bridge.fn.bind(this, function (x) {
                    var code = x.dataset[Core.Components.LangSelect.LangCode];
                    if (Core.Extensions.StringExt.IsNullOrEmpty(code)) {
                        return;
                    }
                    x.addEventListener("click", Bridge.fn.bind(this, function (e) {
                        if (Bridge.referenceEquals(x.getAttribute(Core.Components.LangSelect.Active), System.Boolean.toString((true)).toLowerCase())) {
                            return;
                        }
                        System.Linq.Enumerable.from(this.Element.querySelectorAll("[Active=true]")).select(function (x) { return Bridge.cast(x, HTMLElement); }).forEach(function (li) {
                            li.removeAttribute(Core.Components.LangSelect.Active);
                        });
                        x.setAttribute(Core.Components.LangSelect.Active, System.Boolean.toString((true)).toLowerCase());
                        Core.Components.LangSelect.SetCultureAndTranslate(code);
                    }));
                    if (Core.Components.LangSelect.Culture == null && Bridge.referenceEquals(x.getAttribute(Core.Components.LangSelect.Active), System.Boolean.toString((true)).toLowerCase())) {
                        Core.Components.LangSelect.SetCultureAndTranslate(code);
                    }
                }));
                Core.MVVM.Html.Take(this.ParentElement);
            }
        }
    });

    Bridge.define("Core.Components.Link", {
        inherits: [Core.Components.EditableComponent],
        ctors: {
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.GuiInfo = ui || (function () {
                    throw new System.ArgumentNullException.$ctor1("ui");
                })();
                this.Element = ele;
            }
        },
        methods: {
            Render: function () {
                var $t, $t1;
                if (this.Element == null) {
                    this.Element = Core.Components.Renderer.IText(Core.MVVM.Html.Take(this.ParentElement).A, ($t = this.GuiInfo.PlainText, $t != null ? $t : this.GuiInfo.Label)).GetContext();
                }
                this.Element.addEventListener("click", Bridge.fn.bind(this, function (e) {
                    this.DispatchClick(e);
                }));
                !Bridge.staticEquals(($t1 = this.DOMContentLoaded), null) ? $t1() : null;
            },
            UpdateView: function (force, dirty, componentNames) {
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                // not to do anything here
            },
            DispatchClick: function (e) {
                var $t;
                e.preventDefault();
                if (Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.Events) && System.String.contains(this.GuiInfo.Events.toLowerCase(),"click")) {
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "click", [this.Entity]));
                    return;
                }
                var a = Bridge.as(this.Element, HTMLAnchorElement);
                var f = System.Linq.Enumerable.from(a.href.split(Core.Extensions.Utils.Slash), System.String).where(function (x) {
                        return Core.Extensions.StringExt.HasNonSpaceChar(x);
                    }).where(function (x) {
                    return !System.String.contains(x,Core.Extensions.Utils.QuestionMark) && !System.String.contains(x,Core.Extensions.Utils.Hash);
                }).lastOrDefault(null, null);
                Core.Components.Spinner.AppendTo(document.body, true, true, 1000);
                Core.Extensions.EventExt.Done$1(Core.Components.Forms.EditForm, Core.Components.Extensions.ComponentExt.InitFeatureByName(this.ConnKey, ($t = f, $t != null ? $t : "")), function (x) {
                    window.history.pushState(null, a.title, a.href);
                });
            }
        }
    });

    Bridge.define("Core.Components.ListViewSearch", {
        inherits: [Core.Components.EditableComponent],
        fields: {
            _uploader: null,
            _fullTextSearch: null,
            BasicSearch: null,
            parentListView: null,
            parentGridView: null,
            _hasRender: false,
            _export: null
        },
        props: {
            EntityVM: {
                get: function () {
                    return Bridge.as(this.Entity, Core.Components.ListViewSearchVM);
                }
            },
            DateTimeField: null,
            ParentListView: {
                get: function () {
                    if (this.parentListView != null) {
                        return this.parentListView;
                    }

                    return Bridge.as(this.Parent, Core.Components.ListView);
                },
                set: function (value) {
                    this.parentListView = value;
                }
            },
            TabEditor: {
                get: function () {
                    return this.Parent.TabEditor || Bridge.as(this.Parent.EditForm, Core.Components.Forms.TabEditor);
                },
                set: function (value) {
                    this.Parent.TabEditor = value;
                }
            },
            ParentGridView: {
                get: function () {
                    if (this.parentGridView != null) {
                        return this.parentGridView;
                    }

                    return Bridge.as(this.Parent, Core.Components.GridView);
                },
                set: function (value) {
                    this.parentGridView = value;
                }
            },
            Exporter: {
                get: function () {
                    var $t;
                    if (this._export == null) {
                        this._export = ($t = new Core.Components.ExportCustomData(this.ParentListView), $t.ParentElement = this.TabEditor.Element, $t);
                        this._export.addDisposed(Bridge.fn.bind(this, function () {
                            this._export = null;
                        }));
                    }
                    return this._export;
                }
            },
            Disabled: {
                get: function () {
                    return false;
                },
                set: function (value) {
                    this._disabled = false;
                }
            }
        },
        ctors: {
            ctor: function (ui) {
                var $t;
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.PopulateDirty = false;
                this.AlwaysValid = true;
                this.GuiInfo = ui || (function () {
                    throw new System.ArgumentNullException.$ctor1("ui");
                })();
                this.DateTimeField = ($t = ui.DateTimeField, $t != null ? $t : "InsertedDate");
                this.Entity = new Core.Components.ListViewSearchVM();
            }
        },
        methods: {
            ListView_DataLoaded: function (basicSearchHeader) {
                var $t;
                if (this._hasRender) {
                    return;
                }
                this._hasRender = true;
                this.BasicSearch = System.Linq.Enumerable.from(this.ParentListView.Header, Core.Models.Component).where(function (x) {
                        return x.BasicSearch;
                    }).orderByDescending(function (x) {
                    return x.Order;
                }).ToArray(Core.Models.Component);
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.Component, this.BasicSearch)) {
                    return;
                }
                Core.MVVM.Html.Take(this.Element);
                var components = System.Linq.Enumerable.from(this.BasicSearch, Core.Models.Component).select(Bridge.fn.bind(this, function (header) {
                        var $t, $t1;
                        var com = header;
                        var componentType = Core.Extensions.Utils.TryParse(Core.Enums.ComponentTypeTypeEnum, com.ComponentType);
                        com.ShowLabel = false;
                        com.PlainText = header.ShortDesc;
                        com.Visibility = true;
                        com.Column = 1;
                        var compareOpId = System.Nullable.getValue(Core.Extensions.Utils.TryParseInt(System.Linq.Enumerable.from(Core.Components.AdvancedSearch.OperatorFactory(($t = componentType, $t != null ? $t : Core.Enums.ComponentTypeTypeEnum.Textbox)), Core.Models.Entity).firstOrDefault(null, null).Id));
                        this.ParentListView.AdvSearchVM.Conditions.add(($t1 = new Core.Models.FieldCondition(), $t1.FieldId = com.Id, $t1.CompareOperatorId = compareOpId, $t1.LogicOperatorId = Core.Enums.LogicOperation.And, $t1.Field = header, $t1));
                        return com;
                    })).ToArray(Core.Models.Component);
                var sectionInfo = ($t = new Core.Models.ComponentGroup(), $t.Component = components, $t.Responsive = true, $t.Column = components.length, $t.ClassName = "wrapper", $t);
                var _basicSearchGroup = Core.Components.Section.RenderSection(this, sectionInfo);
                _basicSearchGroup.Children.ForEach(Bridge.fn.bind(this, function (child) {
                    child.UserInput = Bridge.fn.combine(child.UserInput, Bridge.fn.bind(this, function (changes) {
                        var $t1;
                        var condition = System.Linq.Enumerable.from(this.ParentListView.AdvSearchVM.Conditions, Core.Models.FieldCondition).firstOrDefault(function (x) {
                                return Bridge.referenceEquals(x.FieldId, child.GuiInfo.Id);
                            }, null);
                        condition.Value = ($t1 = Core.Components.Extensions.ComponentExt.GetValue(child, true)) != null ? Bridge.toString($t1) : null;
                    }));
                }));
                while (_basicSearchGroup.Element.children.length > 0) {
                    this.Element.insertBefore(_basicSearchGroup.Element.firstChild, this.Element.firstChild);
                }
            },
            Render: function () {
                var $t, $t1;
                this.ParentListView = Bridge.as(this.Parent, Core.Components.ListView);
                this.ParentListView.addDataLoaded(Bridge.fn.cacheBind(this, this.ListView_DataLoaded));
                if (!this.GuiInfo.CanSearch) {
                    return;
                }
                Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(this.Parent.Element.firstElementChild), -1).Event$1("keypress", Bridge.fn.cacheBind(this, this.EnterSearch));
                this.Element = Core.MVVM.Html.Context;
                this.RenderImportBtn();
                if (Bridge.referenceEquals(this.GuiInfo.ComponentType, "GridView") || Bridge.referenceEquals(this.GuiInfo.ComponentType, "TreeView") || !this.GuiInfo.IsRealtime) {
                    var txtSearch = ($t = new Core.Components.Textbox(($t1 = new Core.Models.Component(), $t1.FieldName = "SearchTerm", $t1.Visibility = true, $t1.Label = "T\u00ecm ki\u1ebfm", $t1.PlainText = "T\u00ecm ki\u1ebfm", $t1.ShowLabel = false, $t1)), $t.ParentElement = this.Element, $t.UserInput = null, $t);
                    this.AddChild(txtSearch);
                }
                if (!Bridge.referenceEquals(this.GuiInfo.ComponentType, "ListView") && !Bridge.referenceEquals(this.GuiInfo.ComponentType, "TreeView")) {
                    var txtFullTextSearch = ($t = new Core.Components.Textbox(($t1 = new Core.Models.Component(), $t1.FieldName = "FullTextSearch", $t1.Visibility = true, $t1.Label = "L\u1ecdc hi\u1ec3n th\u1ecb", $t1.PlainText = "L\u1ecdc hi\u1ec3n th\u1ecb", $t1.ShowLabel = false, $t1)), $t.ParentElement = this.Element, $t.UserInput = null, $t);
                    this.AddChild(txtFullTextSearch);
                    this._fullTextSearch = txtFullTextSearch.Input;
                    this._fullTextSearch.addEventListener("input", Bridge.fn.cacheBind(this.ParentGridView, this.ParentGridView.SearchDisplayRows));
                }

                if (this.GuiInfo.UpperCase) {
                    var txtScan = ($t = new Core.Components.Textbox(($t1 = new Core.Models.Component(), $t1.FieldName = "ScanTerm", $t1.Visibility = true, $t1.Label = "Scan", $t1.PlainText = "Scan", $t1.ShowLabel = false, $t1.Focus = true, $t1.Events = "{'input':'ScanGridView'}", $t1)), $t.ParentElement = this.Element, $t);
                    txtScan.UserInput = null;
                    this.AddChild(txtScan);
                }
                var startDate = ($t = new Core.Components.Datepicker(($t1 = new Core.Models.Component(), $t1.FieldName = "StartDate", $t1.Visibility = true, $t1.Label = "T\u1eeb ng\u00e0y", $t1.PlainText = "T\u1eeb ng\u00e0y", $t1.ShowLabel = false, $t1)), $t.ParentElement = this.Element, $t);
                startDate.UserInput = null;
                this.AddChild(startDate);
                var endDate = ($t = new Core.Components.Datepicker(($t1 = new Core.Models.Component(), $t1.FieldName = "EndDate", $t1.Visibility = true, $t1.Label = "\u0110\u1ebfn ng\u00e0y", $t1.PlainText = "\u0110\u1ebfn ng\u00e0y", $t1.ShowLabel = false, $t1)), $t.ParentElement = this.Element, $t);
                endDate.UserInput = null;
                this.AddChild(endDate);
                if (this.ParentListView.GuiInfo.ShowDatetimeField) {
                    var dateType = ($t = new Core.Components.SearchEntry(($t1 = new Core.Models.Component(), $t1.FieldName = "DateTimeField", $t1.PlainText = "Lo\u1ea1i ng\u00e0y", $t1.FormatData = "{ShortDesc}", $t1.DataSourceFilter = System.String.format("?$filter=Active eq true and ComponentType eq '{0}' and FeatureId eq {1}", "Datepicker", this.EditForm.Feature.Id), $t1.ShowLabel = false, $t1.ReferenceId = Core.Extensions.Utils.GetEntity("Component").Id, $t1.RefName = "Component", $t1)), $t.ParentElement = this.Element, $t.UserInput = null, $t);
                    this.AddChild(dateType);
                }
                Core.Components.Renderer.Title(Core.Components.Renderer.Button(Core.Components.Renderer.Title(Core.Components.Renderer.Button(Core.Components.Renderer.Icon(Core.Components.Renderer.Title(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div, "searching-block"), "T\u00ecm ki\u1ebfm", "button secondary small btn-toolbar", "fa fa-search").Event("click", Bridge.fn.bind(this, function () {
                    this.ParentListView.ClearSelected();
                    Core.Extensions.EventExt.Done$1(System.Collections.Generic.List$1(System.Object), this.ParentListView.ReloadData());
                })).End, "", "button secondary small btn-toolbar right", "fa fa-cog"), "N\u00e2ng cao"), "fa fa-chevron-down").End.Event$1("click", Bridge.fn.cacheBind(this, this.AdvancedOptions)).End, "", "btnSearch button secondary small btn-toolbar right", "fa fa-undo"), "L\u00e0m m\u1edbi").Event("click", Bridge.fn.cacheBind(this, this.RefershListView)).End, "", "btn btn-secondary btn-sm", "fal fa-compress-wide"), "Ph\u00f3ng to").Event("click", Bridge.fn.cacheBind(this, this.FullScreen)).End.Render();
                if (this.GuiInfo.ShowHotKey && this.ParentGridView != null) {
                    Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.Button(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div, "hotkey-block"), "F1", "btn btn-light btn-sm", "").Event("click", Bridge.fn.cacheBind(this.ParentGridView, this.ParentGridView.ToggleAll)).Attr$1("title", "B\u1ecf ch\u1ecdn t\u1ea5t c\u1ea3").End, "F2", "btn btn-light btn-sm", "").Event$1("click", Bridge.fn.bind(this, function (e) {
                        var com = System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children, Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this, function (x) {
                                return Bridge.referenceEquals(x.GuiInfo.Id, this.ParentGridView.LastComponentFocus.Id);
                            }), null);
                        this.ParentGridView.ActionKeyHandler(e, this.ParentGridView.LastComponentFocus, this.ParentGridView.LastListViewItem, com, Core.Extensions.HtmlElementExtension.Closest(com.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), Core.Enums.KeyCodeEnum.F2);
                    })).Attr$1("title", "L\u1ecdc lo\u1ea1i tr\u1eeb").End, "F3", "btn btn-light btn-sm", "").Event$1("click", Bridge.fn.bind(this, function (e) {
                        var com = System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children, Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this, function (x) {
                                return Bridge.referenceEquals(x.GuiInfo.Id, this.ParentGridView.LastComponentFocus.Id);
                            }), null);
                        this.ParentGridView.ActionKeyHandler(e, this.ParentGridView.LastComponentFocus, this.ParentGridView.LastListViewItem, com, Core.Extensions.HtmlElementExtension.Closest(com.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), Core.Enums.KeyCodeEnum.F3);
                    })).Attr$1("title", "C\u1ed9ng t\u1ed5ng d\u00f2ng \u0111\u01b0\u1ee3c ch\u1ecdn").End, "F4", "btn btn-light btn-sm", "").Event$1("click", Bridge.fn.bind(this, function (e) {
                        var com = System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children, Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this, function (x) {
                                return Bridge.referenceEquals(x.GuiInfo.Id, this.ParentGridView.LastComponentFocus.Id);
                            }), null);
                        this.ParentGridView.ActionKeyHandler(e, this.ParentGridView.LastComponentFocus, this.ParentGridView.LastListViewItem, com, Core.Extensions.HtmlElementExtension.Closest(com.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), Core.Enums.KeyCodeEnum.F4);
                    })).Attr$1("title", "L\u1ecdc ti\u1ebfp theo c\u00e1c ph\u00e9p t\u00ednh (Ch\u1ee9a: B\u1eb1ng; L\u1edbn h\u01a1n; Nh\u1ecf h\u01a1n; L\u1edbn h\u01a1n ho\u1eb7c b\u1eb1ng;...)").End, "F6", "btn btn-light btn-sm", "").Event$1("click", Bridge.fn.bind(this, function (e) {
                        this.ParentGridView.HotKeyF6Handler(e, Core.Enums.KeyCodeEnum.F6);
                    })).Attr$1("title", "Quay l\u1ea1i l\u1ea7n l\u1ecdc tr\u01b0\u1edbc").End, "F8", "btn btn-light btn-sm", "").Event$1("click", Bridge.fn.bind(this, function (e) {
                        var com = System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children, Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this, function (x) {
                                return Bridge.referenceEquals(x.GuiInfo.Id, this.ParentGridView.LastComponentFocus.Id);
                            }), null);
                        this.ParentGridView.ActionKeyHandler(e, this.ParentGridView.LastComponentFocus, this.ParentGridView.LastListViewItem, com, Core.Extensions.HtmlElementExtension.Closest(com.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), Core.Enums.KeyCodeEnum.F8);
                    })).Attr$1("title", "X\u00f3a/ V\u00f4 hi\u1ec7u h\u00f3a d\u00f2ng hi\u1ec7n th\u1eddi ho\u1eb7c c\u00e1c d\u00f2ng \u0111\u00e1nh d\u1ea5u").End, "F9", "btn btn-light btn-sm", "").Event$1("click", Bridge.fn.bind(this, function (e) {
                        var com = System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children, Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this, function (x) {
                                return Bridge.referenceEquals(x.GuiInfo.Id, this.ParentGridView.LastComponentFocus.Id);
                            }), null);
                        this.ParentGridView.ActionKeyHandler(e, this.ParentGridView.LastComponentFocus, this.ParentGridView.LastListViewItem, com, Core.Extensions.HtmlElementExtension.Closest(com.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), Core.Enums.KeyCodeEnum.F9);
                    })).Attr$1("title", "L\u1ecdc t\u1ea1i ch\u1ed7 theo gi\u00e1 tr\u1ecb \u00f4 hi\u1ec7n th\u1eddi").End, "F10", "btn btn-light btn-sm", "").Event$1("click", Bridge.fn.bind(this, function (e) {
                        var com = System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children, Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this, function (x) {
                                return Bridge.referenceEquals(x.GuiInfo.Id, this.ParentGridView.LastComponentFocus.Id);
                            }), null);
                        this.ParentGridView.ActionKeyHandler(e, this.ParentGridView.LastComponentFocus, this.ParentGridView.LastListViewItem, com, Core.Extensions.HtmlElementExtension.Closest(com.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), Core.Enums.KeyCodeEnum.F10);
                    })).Attr$1("title", "G\u1ed9p theo c\u1ed9t hi\u1ec7n th\u1eddi(th\u1ed1ng k\u00ea l\u1ea1i s\u1ed1 n\u1ed9i dung trong c\u1ed9t)").End, "F11", "btn btn-light btn-sm", "").Event$1("click", Bridge.fn.bind(this, function (e) {
                        var com = System.Linq.Enumerable.from(this.ParentListView.LastListViewItem.Children, Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this, function (x) {
                                return Bridge.referenceEquals(x.GuiInfo.Id, this.ParentGridView.LastComponentFocus.Id);
                            }), null);
                        this.ParentGridView.ActionKeyHandler(e, this.ParentGridView.LastComponentFocus, this.ParentGridView.LastListViewItem, com, Core.Extensions.HtmlElementExtension.Closest(com.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), Core.Enums.KeyCodeEnum.F11);
                    })).Attr$1("title", "S\u1eafp x\u1ebfp th\u1ee9 t\u1ef1 t\u0103ng d\u1ea7n, gi\u1ea3m d\u1ea7n. (Shift+F11 \u0111\u1ec3 sort nhi\u1ec1u c\u1ea5p)").End.Render();
                }
            },
            FullScreen: function () {
                var elem = this.ParentListView.Element;
                if (elem.requestFullscreen) {
                        elem.requestFullscreen();
                        } else if (elem.webkitRequestFullscreen) { 
                                elem.webkitRequestFullscreen();
                            } else if (elem.msRequestFullscreen) {
                        elem.msRequestFullscreen();
                        }
            },
            EnterSearch: function (e) {
                if (Core.Extensions.EventExt.KeyCode(e) !== 13) {
                    return;
                }

                Core.Extensions.EventExt.Done(this.ParentListView.ApplyFilter());
            },
            UploadCsv: function (e) {
                var $t;
                var files = Bridge.as(e.target.files, FileList);
                if (Core.Extensions.IEnumerableExtensions.Nothing(File, files)) {
                    return;
                }

                var fileName = System.Linq.Enumerable.from(files, File).firstOrDefault(null, null).name;
                var uploadForm = Bridge.as(this._uploader.parentElement, HTMLFormElement);
                var formData = new FormData(uploadForm);
                var meta = this.ParentListView.GuiInfo;
                Core.Extensions.EventExt.Catch(Core.Extensions.EventExt.Done$1(System.Boolean, Core.Clients.Client.Instance.SubmitAsync(System.Boolean, ($t = new Core.Clients.XHRWrapper(), $t.FormData = formData, $t.Url = System.String.format("/user/importCsv?table={0}&comId={1}&connKey={2}", meta.RefName, meta.Id, meta.ConnKey), $t.Method = Core.Enums.HttpMethod.POST, $t.ResponseMimeType = Core.Extensions.Utils.GetMimeType("csv"), $t)), Bridge.fn.bind(this, function (success) {
                    Core.Extensions.Toast.Success("Import excel success");
                    this._uploader.value = "";
                })), Bridge.fn.bind(this, function (error) {
                    Core.Extensions.Toast.Warning(error.Message);
                    this._uploader.value = "";
                }));
            },
            AdvancedOptions: function (e) {
                var buttonRect = e.target.getBoundingClientRect();
                var show = Core.Clients.LocalStorage.GetItem(System.Nullable$1(System.Boolean), "Show" + (this.GuiInfo.Id || "")) == null ? false : Core.Clients.LocalStorage.GetItem(System.Nullable$1(System.Boolean), "Show" + (this.GuiInfo.Id || ""));
                var ctxMenu = Core.Components.Forms.ContextMenu.Instance;
                ctxMenu.Top = buttonRect.bottom;
                ctxMenu.Left = buttonRect.left;
                ctxMenu.MenuItems = Bridge.fn.bind(this, function (_o1) {
                        var $t;
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-search-plus mr-1", $t.Text = "Advanced search", $t.Click = Bridge.fn.cacheBind(this, this.AdvancedSearch), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-search mr-1", $t.Text = "Show selected only", $t.Click = Bridge.fn.cacheBind(this, this.FilterSelected), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-download mr-1", $t.Text = "Import csv", $t.Click = Bridge.fn.bind(this, function (obj) {
                            this._uploader.click();
                        }), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-download mr-1", $t.Text = "Export all", $t.Click = Bridge.fn.cacheBind(this, this.ExportAllData), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fal fa-ballot-check mr-1", $t.Text = "Export selected", $t.Click = Bridge.fn.cacheBind(this, this.ExportSelectedData), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-download mr-1", $t.Text = "Customize export", $t.Click = Bridge.fn.cacheBind(this, this.ExportCustomData), $t));
                        return _o1;
                    })(new (System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem)).ctor());
                ctxMenu.Render();
            },
            RenderImportBtn: function () {
                Core.MVVM.Html.Take(this.Element).Form.Attr$1("method", "POST").Attr$1("enctype", "multipart/form-data").Display$1(false).Input.Type$1("file").Id(System.String.format("id_{0}", [Bridge.box(Bridge.getHashCode(this), System.Int32)])).Attr$1("name", "files").Attr$1("accept", ".csv");
                this._uploader = Bridge.as(Core.MVVM.Html.Context, HTMLInputElement);
                this._uploader.addEventListener(System.Enum.toString(System.String, "change"), Bridge.fn.bind(this, function (ev) {
                    this.UploadCsv(ev);
                }));
                Core.MVVM.Html.Instance.End.End.Render();
            },
            FilterSelected: function (arg) {
                var $t;
                var selectedIds = this.ParentListView.SelectedIds;
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, selectedIds)) {
                    Core.Extensions.Toast.Warning("Select rows to filter");
                    return;
                }
                if (System.Linq.Enumerable.from(this.ParentListView.CellSelected, Core.Models.CellSelected).any(function (x) {
                        return Bridge.referenceEquals(x.FieldName, Core.Components.EditableComponent.IdField);
                    })) {
                    System.Linq.Enumerable.from(this.ParentListView.CellSelected, Core.Models.CellSelected).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.FieldName, Core.Components.EditableComponent.IdField);
                        }, null).Value = Core.Extensions.IEnumerableExtensions.Combine(System.String, selectedIds);
                    System.Linq.Enumerable.from(this.ParentListView.CellSelected, Core.Models.CellSelected).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.FieldName, Core.Components.EditableComponent.IdField);
                        }, null).ValueText = Core.Extensions.IEnumerableExtensions.Combine(System.String, selectedIds);
                } else {
                    this.ParentListView.CellSelected.add(($t = new Core.Models.CellSelected(), $t.FieldName = Core.Components.EditableComponent.IdField, $t.FieldText = "M\u00e3", $t.ComponentType = "Input", $t.Value = Core.Extensions.IEnumerableExtensions.Combine(System.String, selectedIds), $t.ValueText = Core.Extensions.IEnumerableExtensions.Combine(System.String, selectedIds), $t.Operator = Core.Enums.OperatorEnum.In, $t.OperatorText = "Ch\u1ee9a", $t.Logic = Core.Enums.LogicOperation.And, $t));
                    this.ParentGridView._summarys.add(document.createElement("div"));
                }
                this.ParentListView.ActionFilter();
            },
            ExportCustomData: function (arg) {
                Core.Extensions.EventExt.Done$1(Core.Components.Forms.TabEditor, Core.Components.Extensions.ComponentExt.OpenPopup(this.TabEditor, "Export CustomData", Bridge.fn.bind(this, function () {
                    return this.Exporter;
                })));
            },
            AdvancedSearch: function (arg) {
                Core.Extensions.EventExt.Done$1(Core.Components.Forms.TabEditor, Core.Components.Extensions.ComponentExt.OpenPopup(this.TabEditor, "AdvancedSearch", Bridge.fn.bind(this, function () {
                    var $t;
                    var editor = ($t = new Core.Components.AdvancedSearch(this.ParentListView), $t.ParentListView = Bridge.as(this.Parent, Core.Components.ListView), $t.ParentElement = this.TabEditor.Element, $t);
                    return editor;
                })));
            },
            ExportAllData: function (arg) {
                this.Exporter.Export();
            },
            ExportSelectedData: function (arg) {
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, this.ParentListView.SelectedIds)) {
                    Core.Extensions.Toast.Warning("Select at least 1 one to export excel");
                    return;
                }
                this.Exporter.Export(void 0, void 0, this.ParentListView.SelectedIds.ToArray());
            },
            OpenExcelFileDialog: function (arg) {
                this._uploader.click();
            },
            CalcFilterQuery: function () {
                var $t, $t1, $t2, $t3, $t4, $t5;
                if (this.EntityVM.DateTimeField != null) {
                    this.DateTimeField = System.Linq.Enumerable.from(this.ParentListView.Header, Core.Models.Component).firstOrDefault(Bridge.fn.bind(this, function (x) {
                            return Bridge.referenceEquals(x.Id, this.EntityVM.DateTimeField);
                        }), null).FieldName;
                }
                var headers = System.Linq.Enumerable.from(this.ParentListView.Header, Core.Models.Component).where(function (x) {
                        return x != null;
                    }).toList(Core.Models.Component);
                var searchTerm = ($t = (($t1 = this.EntityVM.SearchTerm) != null ? Core.Extensions.Utils.EncodeSpecialChar($t1.trim()) : null), $t != null ? $t : "");
                var finalFilter = "";
                if (Core.Extensions.StringExt.IsNullOrEmpty(finalFilter)) {
                    var operators = System.Linq.Enumerable.from(headers, Core.Models.Component).where(function (x) {
                            return Core.Extensions.StringExt.HasNonSpaceChar(x.FieldName);
                        }).select(function (x) {
                        return Core.Components.Extensions.ComponentExt.MapToFilterOperator(x, searchTerm);
                    }).where(function (x) {
                        return Core.Extensions.StringExt.HasAnyChar(x);
                    });
                    finalFilter = Bridge.toArray(operators).join(" or ");
                }
                var basicsAddDate = ($t2 = this.ParentListView.Header) != null && ($t3 = System.Linq.Enumerable.from($t2, Core.Models.Component).where(function (x) {
                            return x.AddDate;
                        })) != null && ($t4 = $t3.select(function (x) {
                        return x.Id;
                    })) != null ? $t4.ToArray(System.String) : null;
                var parentGrid = basicsAddDate != null && System.Linq.Enumerable.from(basicsAddDate, System.String).any() && System.Linq.Enumerable.from(this.ParentGridView.AdvSearchVM.Conditions, Core.Models.FieldCondition).any(function (x) {
                        return System.Array.contains(basicsAddDate, x.FieldId, System.String) && !Core.Extensions.StringExt.IsNullOrWhiteSpace(x.Value);
                    });
                if (!parentGrid && !Bridge.equals(this.EntityVM.StartDate, null)) {
                    var oldStartDate = System.Linq.Enumerable.from(this.ParentListView.Wheres, Core.Models.Where).firstOrDefault(Bridge.fn.bind(this, function (x) {
                            return System.String.contains(x.Condition,System.String.format("ds.[{0}] >=", [this.DateTimeField]));
                        }), null);
                    if (oldStartDate == null) {
                        this.ParentListView.Wheres.add(($t5 = new Core.Models.Where(), $t5.Condition = System.String.format("ds.[{0}] >= '{1:yyyy-MM-dd}'", this.DateTimeField, Bridge.box(System.Nullable.getValue(this.EntityVM.StartDate), System.DateTime, System.DateTime.format)), $t5.Group = false, $t5));
                    } else {
                        oldStartDate.Condition = System.String.format("ds.[{0}] >= '{1:yyyy-MM-dd}'", this.DateTimeField, Bridge.box(System.Nullable.getValue(this.EntityVM.StartDate), System.DateTime, System.DateTime.format));
                    }
                    this.EntityVM.StartDate = System.DateTime.getDate(System.Nullable.getValue(this.EntityVM.StartDate));
                    Core.Clients.LocalStorage.SetItem(System.String, "FromDate" + (this.ParentListView.GuiInfo.Id || ""), System.DateTime.format(System.Nullable.getValue(this.EntityVM.StartDate), "yyyy/MM/dd"));
                } else if (Bridge.equals(this.EntityVM.StartDate, null)) {
                    var check = System.Linq.Enumerable.from(this.ParentListView.Wheres, Core.Models.Where).firstOrDefault(Bridge.fn.bind(this, function (x) {
                            return System.String.contains(x.Condition,System.String.format("ds.[{0}] >=", [this.DateTimeField]));
                        }), null);
                    if (System.Linq.Enumerable.from(this.ParentListView.Wheres, Core.Models.Where).any() && check != null) {
                        this.ParentListView.Wheres.remove(check);
                    }
                    Core.Clients.LocalStorage.RemoveItem("FromDate" + (this.ParentListView.GuiInfo.Id || ""));
                }
                if (!parentGrid && !Bridge.equals(this.EntityVM.EndDate, null)) {
                    if (Core.Extensions.StringExt.HasAnyChar(finalFilter)) {
                        finalFilter = (finalFilter || "") + " and ";
                    }
                    var endDate = System.DateTime.addDays(System.DateTime.getDate(System.Nullable.getValue(this.EntityVM.EndDate)), 1);
                    var oldEndDate = System.Linq.Enumerable.from(this.ParentListView.Wheres, Core.Models.Where).firstOrDefault(Bridge.fn.bind(this, function (x) {
                            return System.String.contains(x.Condition,System.String.format("ds.[{0}] <", [this.DateTimeField]));
                        }), null);
                    if (oldEndDate == null) {
                        this.ParentListView.Wheres.add(($t5 = new Core.Models.Where(), $t5.Condition = System.String.format("ds.[{0}] < '{1:yyyy-MM-dd}'", this.DateTimeField, Bridge.box(endDate, System.DateTime, System.DateTime.format)), $t5.Group = false, $t5));
                    } else {
                        oldEndDate.Condition = System.String.format("ds.[{0}] < '{1:yyyy-MM-dd}'", this.DateTimeField, Bridge.box(endDate, System.DateTime, System.DateTime.format));
                    }
                    Core.Clients.LocalStorage.SetItem(System.String, "ToDate" + (this.ParentListView.GuiInfo.Id || ""), System.DateTime.format(System.Nullable.getValue(this.EntityVM.EndDate), "MM/dd/yyyy"));
                } else if (Bridge.equals(this.EntityVM.EndDate, null)) {
                    var check1 = System.Linq.Enumerable.from(this.ParentListView.Wheres, Core.Models.Where).firstOrDefault(Bridge.fn.bind(this, function (x) {
                            return System.String.contains(x.Condition,System.String.format("ds.[{0}] <", [this.DateTimeField]));
                        }), null);
                    if (System.Linq.Enumerable.from(this.ParentListView.Wheres, Core.Models.Where).any() && check1 != null) {
                        this.ParentListView.Wheres.remove(check1);
                    }
                    Core.Clients.LocalStorage.RemoveItem("ToDate" + (this.ParentListView.GuiInfo.Id || ""));
                }
                if ((!Bridge.equals(this.EntityVM.EndDate, null) || !Bridge.equals(this.EntityVM.StartDate, null)) && this.ParentListView.GuiInfo.ShowNull) {
                    finalFilter = (finalFilter || "") + ((System.String.format(" or ds.{0} = null", [this.DateTimeField])) || "");
                }
                return finalFilter;
            },
            RefershListView: function () {
                this.EntityVM.SearchTerm = "";
                this.EntityVM.StartDate = null;
                this.EntityVM.EndDate = null;
                this.UpdateView();
                var listView;
                if (!(((listView = Bridge.as(this.Parent, Core.Components.ListView))) != null)) {
                    return;
                }
                listView.DataSourceFilter = listView.GuiInfo.DataSourceFilter;
                listView.ClearSelected();
                listView.CellSelected.clear();
                listView.AdvSearchVM.Conditions.clear();
                listView.Wheres.clear();
                Core.Extensions.EventExt.Done(listView.ApplyFilter());
            }
        }
    });

    Bridge.define("Core.Components.SearchEntry", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                SEntryClass: null
            },
            ctors: {
                init: function () {
                    this.SEntryClass = "search-entry";
                }
            }
        },
        fields: {
            _value: null,
            _input: null,
            _gv: null,
            _waitForInput: 0,
            _waitForDispose: 0,
            _contextMenu: false,
            RowData: null,
            dataSourceFilter: null,
            _rootResult: null,
            _parentInput: null,
            _backdrop: null,
            _isRendering: false,
            OriginalText: null
        },
        props: {
            FieldText: {
                get: function () {
                    return this.GuiInfo.FieldText;
                }
            },
            Value: {
                get: function () {
                    return this._value;
                },
                set: function (value) {
                    var $t;
                    if (!Bridge.referenceEquals(this._value, value)) {
                        this.Dirty = true;
                    }

                    this._value = value;
                    ($t = this.Entity) != null ? Core.Extensions.BridgeExt.SetComplexPropValue($t, this.FieldName, value) : null;
                    this.FindMatchText();
                }
            },
            SearchResultEle: null,
            DataSource: {
                get: function () {
                    return this.dataSourceFilter;
                },
                set: function (value) {
                    this.dataSourceFilter = Core.Extensions.Utils.DecodeSpecialChar(value);
                }
            },
            Matched: null,
            FormattedDataSource: {
                get: function () {
                    var fn = { };
                    if (Core.Extensions.Utils.IsFunction(this.DataSource, fn)) {
                        return Bridge.toString(fn.v.call(this, this, this.EditForm));
                    }
                    var dataSourceFilter = Core.Extensions.StringExt.HasAnyChar(this.DataSource) ? this.DataSource : "";
                    var checkContain = System.String.contains(dataSourceFilter,"EditForm.") || System.String.contains(dataSourceFilter,"TabEditor.") || System.String.contains(dataSourceFilter,"Entity.");
                    var DataSourceFilter = Core.Extensions.Utils.FormatEntity(dataSourceFilter, null, checkContain ? this : this.Entity, void 0, function (x) {
                        return "null";
                    });
                    return DataSourceFilter;
                }
            }
        },
        ctors: {
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }
                var $t;

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.DataSource = ui.DataSourceFilter;
                this.DeserializeLocalData(ui);
                this.GuiInfo.ComponentGroup = null;
                this.GuiInfo.Row = ($t = this.GuiInfo.Row, $t != null ? $t : 20);
                this.RowData = new (Core.MVVM.ObservableList$1(System.Object)).ctor();
                this.Element = ele;
            }
        },
        methods: {
            DeserializeLocalData: function (ui) {
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(ui.LocalQuery)) {
                    return;
                }
                this.GuiInfo.LocalData = Newtonsoft.Json.JsonConvert.DeserializeObject(ui.LocalQuery, System.Collections.Generic.List$1(System.Object));
                this.GuiInfo.LocalRender = true;
            },
            Render: function () {
                var $t, $t1;
                this.SetDefaultVal();
                var entityVal = Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName);
                var str_value;
                if (((str_value = Bridge.as(entityVal, System.String))) != null) {
                    this._value = str_value;
                }
                this.RenderInputAndEvents();
                this.RenderIcons();
                this.FindMatchText();
                this.SearchResultEle = (($t = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListView, this)) != null ? $t.Element : null) || document.body;
                ($t1 = Core.Extensions.HtmlElementExtension.Closest(this.Element, "td")) != null ? $t1.addEventListener("keydown", Bridge.fn.cacheBind(this, this.ListViewItemTab)) : null;
            },
            RenderInputAndEvents: function () {
                if (this.Element == null) {
                    this.Element = (this._input = Bridge.as(Core.Components.Renderer.ClassName(Core.Components.Renderer.Position$1(Core.MVVM.Html.Take(this.ParentElement).Div, Core.Components.Position.relative), Core.Components.SearchEntry.SEntryClass).Input.GetContext(), HTMLInputElement));
                    this._parentInput = this._input.parentElement;
                } else {
                    this._input = Bridge.as(this.Element, HTMLInputElement);
                    if (!Core.Extensions.HtmlElementExtension.HasClass(this._input.parentElement, Core.Components.SearchEntry.SEntryClass)) {
                        var parent = document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.div));
                        Core.Extensions.HtmlElementExtension.AddClass(parent, Core.Components.SearchEntry.SEntryClass);
                        this._input.parentElement.appendChild(parent);
                        this._input.parentElement.insertBefore(parent, this._input);
                    }
                }
                this._input.autocomplete = "off";
                Core.Components.Renderer.PlaceHolder(Core.MVVM.Html.Take(this._input), this.GuiInfo.PlainText).Attr$1("name", this.FieldName).Event("contextmenu", Bridge.fn.bind(this, function () {
                    this._contextMenu = true;
                })).Event("focus", Bridge.fn.cacheBind(this, this.FocusIn)).Event$1("blur", Bridge.fn.cacheBind(this, this.DiposeGvWrapper)).Event("click", Bridge.fn.cacheBind(this, this.SEClickOpenRef)).Event("change", Bridge.fn.cacheBind(this, this.SEChangeHandler)).Event$1("keydown", Bridge.fn.cacheBind(this, this.SEKeydownHanlder)).Event("input", Bridge.fn.bind(this, function () {
                    this.Search(this._input.value, true, 500, true, false);
                }));
            },
            SEClickOpenRef: function () {
                if (this.Disabled && !this.GuiInfo.FocusSearch) {
                    this.OpenRefDetail();
                }
            },
            SEChangeHandler: function () {
                if (this._value == null) {
                    this._input.value = "";
                }
            },
            SEKeydownHanlder: function (e) {
                if (this.Disabled || e == null) {
                    return;
                }
                var code = Core.Extensions.EventExt.KeyCodeEnum(e);
                do {
                    if (System.Nullable.eq(code, Core.Enums.KeyCodeEnum.Escape)) {
                        if (this._gv != null) {
                            e.stopPropagation();
                            this._gv.Show = false;
                            break;
                        }
                    }

                    if (System.Nullable.eq(code, Core.Enums.KeyCodeEnum.UpArrow)) {
                        if ((this._gv != null ? this._gv.Element : null) != null) {
                            if (this._gv.Show) {
                                e.stopPropagation();
                                this._gv.MoveUp();
                            }

                            break;
                        }
                    }

                    if (System.Nullable.eq(code, Core.Enums.KeyCodeEnum.DownArrow)) {
                        if ((this._gv != null ? this._gv.Element : null) != null) {
                            if (this._gv.Show) {
                                e.stopPropagation();
                                this._gv.MoveDown();
                            }

                            break;
                        }
                    }

                    if (System.Nullable.eq(code, Core.Enums.KeyCodeEnum.Enter)) {
                        this.EnterKeydownHandler(code);
                        break;
                    }

                    if (System.Nullable.eq(code, Core.Enums.KeyCodeEnum.F6)) {
                        if (this._gv != null && this._gv.Show) {
                            e.preventDefault();
                            this._gv.HotKeyF6Handler(e, Core.Enums.KeyCodeEnum.F6);
                        }

                        break;
                    }

                    {
                        if (Core.Extensions.EventExt.ShiftKey(e) && System.Nullable.eq(code, Core.Enums.KeyCodeEnum.Delete)) {
                            this._input.value = null;
                            this.Search();
                        }

                        break;
                    }
                } while (false);
            },
            EnterKeydownHandler: function (code) {
                if (this.GuiInfo.HideGrid) {
                    this.Search(this._input.value, true, 0, false, true);
                    return;
                }
                if (this.EditForm.Feature.CustomNextCell && (this._gv == null || !this._gv.Show)) {
                    return;
                }
                if (this._gv != null && this._gv.Show) {
                    this.EnterKeydownTableStillShow(code);
                } else {
                    this.Search(void 0, true, 0, false, false);
                }
            },
            EnterKeydownTableStillShow: function (code) {
                if (this._gv.SelectedIndex >= 0) {
                    var row = this._gv != null ? System.Linq.Enumerable.from(this._gv.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(Bridge.fn.bind(this, function (x) {
                            return x.RowNo === this._gv.SelectedIndex;
                        }), null).Entity : null;
                    this.EntrySelected(row);
                } else {
                    if ((this._gv != null ? this._gv.RowData : null) != null && this._gv.RowData.Data.Count === 1 && System.Nullable.eq(code, Core.Enums.KeyCodeEnum.Enter)) {
                        this.EntrySelected(this._gv != null ? this._gv.RowData.Data.getItem(0) : null);
                    }
                }
            },
            FocusIn: function () {
                Core.Extensions.HtmlElementExtension.AddClass(this.ParentElement, "cell-selected");
                if (this._contextMenu) {
                    this._contextMenu = false;
                    return;
                }
                if (this.Disabled || this.GuiInfo.FocusSearch) {
                    return;
                }

                this.Search(void 0, false, 0, false, false);
            },
            FocusOut: function () {
                Core.Extensions.HtmlElementExtension.RemoveClass(this.ParentElement, "cell-selected");
            },
            Dispose: function () {
                this.DisposeGv();
                Core.Components.EditableComponent.prototype.Dispose.call(this);
            },
            DiposeGvWrapper: function (e) {
                if (e === void 0) { e = null; }
                if (e != null && e.shiftKey != null && Core.Extensions.EventExt.ShiftKey(e)) {
                    return;
                }
                window.clearTimeout(this._waitForDispose);
                this._waitForDispose = window.setTimeout(Bridge.fn.cacheBind(this, this.DisposeGv), 300);
            },
            DisposeGv: function () {
                this.DisposeMobileSearchResult();
                if (this._gv != null) {
                    this._gv.Show = false;
                }
                this._parentInput.appendChild(this._input);
            },
            RenderIcons: function () {
                var title = Core.Components.LangSelect.Get("T\u1ea1o m\u1edbi d\u1eef li\u1ec7u ");
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element.parentElement).Div, "search-icons");
                var div = Core.Components.Renderer.Title(Core.Components.Renderer.Icon(Core.Components.Renderer.Title(Core.Components.Renderer.Icon(Core.MVVM.Html.Instance, "fa fa-info-circle"), (Core.Components.LangSelect.Get("Th\u00f4ng tin chi ti\u1ebft ") || "") + (Core.Components.LangSelect.Get(this.GuiInfo.Label).toLowerCase() || "")).Event("click", Bridge.fn.cacheBind(this, this.OpenRefDetail)).End, "fa fa-plus"), System.String.format("{0} {1}", title, Core.Components.LangSelect.Get(this.GuiInfo.Label).toLowerCase())).Event("click", Bridge.fn.cacheBind(this, this.OpenRefDetail)).End.GetContext();
                if (this.Element.nextElementSibling != null) {
                    this.Element.parentElement.insertBefore(div, this.Element.nextElementSibling);
                } else {
                    this.Element.parentElement.appendChild(div);
                }
            },
            OpenRefDetail: function () {
                if (Core.Extensions.StringExt.IsNullOrEmpty(this.GuiInfo.RefClass) || this.Matched == null) {
                    return;
                }
                Core.Extensions.EventExt.Done$1(Core.Models.Feature, Core.Components.Extensions.ComponentExt.LoadFeature(this.ConnKey, this.GuiInfo.RefClass), Bridge.fn.cacheBind(this, this.FeatureLoaded));
            },
            FeatureLoaded: function (feature) {
                var instance = Bridge.as(Bridge.createInstance(Bridge.Reflection.getType(this.GuiInfo.RefClass)), Core.Components.Forms.TabEditor);
                instance.Id = feature.Name;
                instance.ParentForm = this.TabEditor;
                instance.ParentElement = this.TabEditor.Element;
                this.TabEditor.AddChild(instance);
                var res;
                if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.Template)) {
                    var fn = { };
                    if (Core.Extensions.Utils.IsFunction(this.GuiInfo.Template, fn)) {
                        res = Bridge.toString(fn.v.call(this, Bridge.unbox(this.Matched), Bridge.unbox(this.Entity)));
                    } else {
                        res = Core.Extensions.Utils.FormatEntity(this.GuiInfo.Template, null, this.Matched, Core.Extensions.Utils.EmptyFormat, Core.Extensions.Utils.EmptyFormat);
                    }
                    var entity = Newtonsoft.Json.JsonConvert.DeserializeObject(res, System.Object);
                    instance.Entity = entity;
                }
                instance.DOMContentLoaded = Bridge.fn.combine(instance.DOMContentLoaded, Bridge.fn.bind(this, function () {
                    var groupButton = Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section, instance, "Button");
                    var htmlTd = document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td));
                    var htmlTr = Bridge.as(groupButton.Element.querySelector(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.tr)), HTMLElement);
                    Core.Extensions.HtmlElementExtension.Prepend(htmlTr, htmlTd);
                    Core.Components.Renderer.IText(Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(htmlTd).Button, "btn btn-secondary"), "fal fa-file-check").End, "Apply").Event("click", Bridge.fn.bind(this, function () {
                        Core.Extensions.EventExt.Done$1(System.Boolean, instance.IsFormValid(), Bridge.fn.bind(this, function (valid) {
                            if (!valid) {
                                return;
                            }
                            Core.Extensions.EventExt.Done$1(System.Boolean, instance.SavePatch(), Bridge.fn.bind(this, function (success) {
                                if (success) {
                                    this.SaveAndApply(instance.Entity);
                                    instance.Dispose();
                                }
                            }));
                        }));
                    })).End.Render();
                }));
            },
            SaveAndApply: function (entity) {
                var $t, $t1;
                var oldValue = this.Value;
                this.Dirty = true;
                this.Matched = entity;
                var currentItem;
                if (!(((currentItem = Bridge.as(this.Parent, Core.Components.ListViewItem))) != null)) {
                    this.Value = ($t = entity[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null;
                    this.Dirty = true;
                    if (!Bridge.staticEquals(this.UserInput, null)) {
                        this.CascadeAndPopulate();
                        this.UserInput(($t1 = new Core.MVVM.ObservableArgs(), $t1.NewData = this._value, $t1.OldData = oldValue, $t1.EvType = "change", $t1));
                    }
                    return;
                }
                if (!Bridge.staticEquals(this.UserInput, null)) {
                    this.CascadeAndPopulate();
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity, currentItem.Entity, this.Matched]));
                    this.UserInput(($t1 = new Core.MVVM.ObservableArgs(), $t1.NewData = this._value, $t1.OldData = oldValue, $t1.EvType = "change", $t1));
                }
            },
            Search: function (term, changeEvent, timeout, $delete, search) {
                if (term === void 0) { term = null; }
                if (changeEvent === void 0) { changeEvent = true; }
                if (timeout === void 0) { timeout = 500; }
                if ($delete === void 0) { $delete = false; }
                if (search === void 0) { search = false; }
                if (this.GuiInfo.HideGrid && !search) {
                    return;
                }
                window.clearTimeout(this._waitForInput);
                this._waitForInput = window.setTimeout(Bridge.fn.bind(this, function () {
                    if (this._gv != null) {
                        this._gv.Wheres.clear();
                        this._gv.AdvSearchVM.Conditions.clear();
                        this._gv.CellSelected.clear();
                    }
                    if (changeEvent && Core.Extensions.StringExt.IsNullOrEmpty(this._input.value)) {
                        this.InputEmptyHandler($delete);
                        return;
                    }
                    this.TriggerSearch(term);
                }), timeout);
            },
            TriggerSearch: function (term) {
                if (term === void 0) { term = null; }
                this.RenderGridView(Core.Extensions.Utils.DecodeSpecialChar(term));
            },
            RenderGridView: function (term) {
                var $t, $t1, $t2;
                if (term === void 0) { term = null; }
                if (this._isRendering) {
                    return;
                }
                this._isRendering = true;
                if (this._gv != null) {
                    this.RenderRootResult();
                    this._gv.ParentElement = this._rootResult;
                    this._gv.Entity = this.Entity;
                    this._gv.ListViewSearch.EntityVM.SearchTerm = term;
                    this._gv.RowData.Data = new (System.Collections.Generic.List$1(System.Object)).ctor();
                    this._gv.ActionFilter();
                    this.GridResultDomLoaded();
                    this._isRendering = false;
                    return;
                }
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.GroupBy)) {
                    this._gv = new Core.Components.GridView(this.GuiInfo);
                } else {
                    this._gv = new Core.Components.GroupGridView(this.GuiInfo);
                }
                this._gv.FeatureId = "null";
                this.RenderRootResult();
                this.ParentElement = this._rootResult;
                if (Bridge.is(this, Core.Components.MultipleSearchEntry)) {
                    this._gv.RowData.Data = new (System.Collections.Generic.List$1(System.Object)).ctor();
                }
                this._gv.EditForm = this.EditForm;
                this._gv.GuiInfo = this.GuiInfo;
                this._gv.ParentElement = this._rootResult;
                this._gv.Entity = this.Entity;
                this._gv.Parent = this;
                this._gv.AlwaysValid = true;
                this._gv.PopulateDirty = false;
                this._gv.ShouldSetEntity = false;
                this._gv.DOMContentLoaded = Bridge.fn.cacheBind(this, this.GridResultDomLoaded);
                this._gv.AddSections();
                this._gv.Show = false;
                this._gv.ListViewSearch.EntityVM.SearchTerm = term;
                this._gv.Render();
                Core.Extensions.HtmlElementExtension.AddClass(this._gv.Element, "floating");
                this._gv.RowClick = Bridge.fn.cacheBind(this, this.EntrySelected);
                this._isRendering = false;
                if ((($t = this._gv.Paginator) != null ? $t.Element : null) != null) {
                    this._gv.Paginator.Element.tabIndex = -1;
                    this._gv.Paginator.Element.addEventListener("focusin", Bridge.fn.bind(this, function () {
                        window.clearTimeout(this._waitForDispose);
                    }));
                    this._gv.Paginator.Element.addEventListener("focusout", Bridge.fn.cacheBind(this, this.DiposeGvWrapper));
                }
                if ((($t1 = this._gv.MainSection) != null ? $t1.Element : null) != null) {
                    this._gv.MainSection.Element.tabIndex = -1;
                    this._gv.MainSection.Element.addEventListener("focusin", Bridge.fn.bind(this, function () {
                        window.clearTimeout(this._waitForDispose);
                    }));
                    this._gv.MainSection.Element.addEventListener("focusout", Bridge.fn.cacheBind(this, this.DiposeGvWrapper));
                }
                if ((($t2 = this._gv.HeaderSection) != null ? $t2.Element : null) != null) {
                    this._gv.HeaderSection.Element.tabIndex = -1;
                    this._gv.HeaderSection.Element.addEventListener("focusin", Bridge.fn.bind(this, function () {
                        window.clearTimeout(this._waitForDispose);
                    }));
                    this._gv.HeaderSection.Element.addEventListener("focusout", Bridge.fn.cacheBind(this, this.DiposeGvWrapper));
                }
                if (this.GuiInfo.LocalHeader == null) {
                    this.GuiInfo.LocalHeader = new (System.Collections.Generic.List$1(Core.Models.Component)).$ctor1(System.Linq.Enumerable.from(this._gv.Header, Core.Models.Component).where(function (x) {
                            return x.Id != null;
                        }));
                }
            },
            RenderRootResult: function () {
                if (this._rootResult != null) {
                    return;
                }
                if (!Core.Components.EditableComponent.IsSmallUp && this._backdrop == null) {
                    Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(Core.Components.Forms.TabEditor.TabContainer).Div, "backdrop");
                    this._backdrop = Core.MVVM.Html.Context;
                    Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.IconForSpan(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "popup-content").Style$1("top: 0;width: 100%;").Div, "popup-title").Span, "fa fal fa-search").End.Span, "Search").End.Div, "icon-box").Span, "fa fa-times").Event("click", Bridge.fn.cacheBind(this, this.DisposeMobileSearchResult)).End.End.End.Div, "popup-body scroll-content");
                    this._rootResult = Core.MVVM.Html.Context;
                    this._rootResult.appendChild(this._input);
                } else if (Core.Components.EditableComponent.IsSmallUp) {
                    this._rootResult = document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.div));
                    Core.Extensions.HtmlElementExtension.AddClass(this._rootResult, "result-wrapper");
                    this.SearchResultEle.appendChild(this._rootResult);
                }
            },
            DisposeMobileSearchResult: function () {
                this._parentInput.appendChild(this._input);
                this._backdrop != null ? this._backdrop.remove() : null;
                this._backdrop = null;
                this._rootResult != null ? this._rootResult.remove() : null;
                this._rootResult = null;
            },
            GridResultDomLoaded: function () {
                this.FocusBackWithoutEvent();
                this._gv.SelectedIndex = -1;
                this._gv.RowAction(function (x) {
                    x.Selected = false;
                });
                this._gv.Element.style.inset = null;
                this.RenderRootResult();
                this._rootResult.appendChild(this._gv.Element);
                if (!this.GuiInfo.HideGrid) {
                    this._gv.Show = true;
                }
                if (Core.Components.EditableComponent.IsSmallUp) {
                    Core.Components.Extensions.ComponentExt.AlterPosition(this._gv.Element, this._input);
                } else {
                    this._gv.Element.style.maxWidth = "100%";
                    this._gv.Element.style.minWidth = "calc(100% - 2rem)";
                }
                if (this.GuiInfo.HideGrid) {
                    this.EntrySelected(this._gv != null ? this._gv.RowData.Data.getItem(0) : null);
                }
                this.FocusBackWithoutEvent();
            },
            FocusBackWithoutEvent: function () {
                window.clearTimeout(this._waitForDispose);
                window.clearTimeout(this._waitForInput);
                if (!this.GuiInfo.IsPivot) {
                    this._input.focus();
                }
            },
            InputEmptyHandler: function ($delete) {
                var $t, $t1, $t2;
                var oldValue = this._value;
                var oldMatch = this.Matched;
                this.Matched = null;
                this._value = null;
                this._input.value = "";
                if (!Bridge.referenceEquals(oldMatch, this.Matched)) {
                    ($t = this.Entity) != null ? Core.Extensions.BridgeExt.SetComplexPropValue($t, this.FieldName, null) : null;
                    this.Dirty = true;
                    this.CascadeAndPopulate();
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity, this.Matched, oldMatch]));
                    !Bridge.staticEquals(($t1 = this.UserInput), null) ? $t1(($t2 = new Core.MVVM.ObservableArgs(), $t2.NewData = null, $t2.OldData = oldValue, $t2.EvType = "change", $t2)) : null;
                }
                if ($delete && Core.Extensions.StringExt.IsNullOrEmpty(this._input.value)) {
                    return;
                }
                if (Bridge.is(this, Core.Components.MultipleSearchEntry)) {
                    this._isRendering = false;
                }
                this.TriggerSearch(null);
            },
            FindMatchText: function () {
                this.ProcessLocalMatch();
            },
            ProcessLocalMatch: function () {
                if (this.EmptyRow || this.Value == null) {
                    this.Matched = null;
                    this._input.value = null;
                    return true;
                }
                this.Matched = Core.Extensions.IEnumerableExtensions.HasElement(System.Object, this.GuiInfo.LocalData) ? System.Linq.Enumerable.from(this.GuiInfo.LocalData, System.Object).firstOrDefault(Bridge.fn.bind(this, function (x) {
                        return Bridge.referenceEquals(Bridge.as(x[Core.Components.EditableComponent.IdField], System.String), this._value);
                    }), null) : System.Linq.Enumerable.from(this.RowData.Data, System.Object).firstOrDefault(Bridge.fn.bind(this, function (x) {
                        return Bridge.referenceEquals(Bridge.as(x[Core.Components.EditableComponent.IdField], System.String), this.Value);
                    }), null);

                this.SetMatchedValue();
                return true;
            },
            CascadeAndPopulate: function () {
                this.CascadeField();
                this.PopulateFields(this.Matched);
            },
            SetMatchedValue: function () {
                this.OriginalText = Bridge.as(Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldText), System.String);
                this._input.value = this.EmptyRow ? "" : this.GetMatchedText(this.Matched);
                Core.Extensions.BridgeExt.SetPropValue(this.Entity, this.GuiInfo.FieldText, this._input.value);
                this.UpdateValue();
            },
            GetEntityField: function (field) {
                return Core.Extensions.Utils.GetPropValue(this.Entity, field);
            },
            UpdateValue: function () {
                var $t;
                if (!this.Dirty) {
                    this.OriginalText = this._input.value;
                    !Bridge.staticEquals(($t = this.DOMContentLoaded), null) ? $t() : null;
                    this.OldValue = this._value != null ? Bridge.toString(this._value) : null;
                }
            },
            PatchUpdateDetail: function () {
                var $t;
                var res = Bridge.fn.bind(this, function (_o1) {
                        var $t;
                        _o1.add(($t = new Core.ViewModels.PatchDetail(), $t.Label = (this.Label || "") + "(value)", $t.Field = this.FieldName, $t.Value = this._value, $t.OldVal = this.OldValue, $t));
                        return _o1;
                    })(new (System.Collections.Generic.List$1(Core.ViewModels.PatchDetail)).ctor());
                if (this.GuiInfo.ShouldSaveText) {
                    res.add(($t = new Core.ViewModels.PatchDetail(), $t.Label = (this.Label || "") + "(text)", $t.Field = this.GuiInfo.FieldText, $t.Value = this._input.value, $t.OldVal = this.OriginalText, $t.JustHistory = !this.GuiInfo.ShouldSaveText, $t));
                }
                return res.ToArray();
            },
            GetMatchedText: function (matched) {
                var $t;
                if (matched == null && this.Entity == null) {
                    return "";
                }
                var res = ($t = Core.Extensions.Utils.GetPropValue(matched, this.GuiInfo.FormatData), $t != null ? $t : Core.Extensions.Utils.GetPropValue(this.Entity, this.GuiInfo.FieldText));
                return Core.Extensions.Utils.DecodeSpecialChar((Bridge.as(res, System.String)));
            },
            EntrySelected: function (rowData) {
                var $t;
                window.clearTimeout(this._waitForDispose);
                this.EmptyRow = false;
                if (rowData == null || this.Disabled) {
                    return;
                }

                var oldMatch = this.Matched;
                this.Matched = rowData;
                var oldValue = this._value;
                this._value = ($t = rowData[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null;
                if (this.Entity != null && Core.Extensions.StringExt.HasAnyChar(this.FieldName)) {
                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this._value);
                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName.substr(0, ((this.FieldName.length - 2) | 0)), rowData);
                }
                this.Dirty = true;
                this.Matched = rowData;
                this.SetMatchedValue();
                if (this._gv != null) {
                    this._gv.Show = false;
                }
                this.CascadeAndPopulate();
                Core.Extensions.EventExt.Done(Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity, rowData, oldMatch]), Bridge.fn.bind(this, function () {
                    var $t1, $t2;
                    !Bridge.staticEquals(($t1 = this.UserInput), null) ? $t1(($t2 = new Core.MVVM.ObservableArgs(), $t2.NewData = this._value, $t2.OldData = oldValue, $t2.EvType = "change", $t2)) : null;
                    this.DiposeGvWrapper();
                }));
            },
            UpdateView: function (force, dirty, componentNames) {
                var $t;
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                this._value = Bridge.as((($t = this.Entity) != null ? Core.Extensions.Utils.GetPropValue($t, this.FieldName) : null), System.String);
                if (this._value == null) {
                    this.Matched = null;
                    this._input.value = null;
                    this.UpdateValue();
                    return;
                }
                var txt = Bridge.as(this.Entity[this.GuiInfo.FieldText], System.String);
                this._input.value = txt;
                this.ProcessLocalMatch();
            },
            ValidateAsync: function () {
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule), this.ValidationRules)) {
                    return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
                }
                this.ValidationResult.clear();
                this.ValidateRequired(System.String, this._value);
                this.Validate(System.String, System.String, Core.Extensions.ValidationRule.Equal, this._value, function (value, ruleValue) {
                    return Bridge.referenceEquals(value, ruleValue);
                });
                this.Validate(System.String, System.String, Core.Extensions.ValidationRule.NotEqual, this._value, function (value, ruleValue) {
                    return !Bridge.referenceEquals(value, ruleValue);
                });
                return System.Threading.Tasks.Task.fromResult(this.IsValid, System.Boolean);
            },
            SetDisableUI: function (value) {
                if (this._input != null) {
                    this._input.readOnly = value;
                }
            },
            RemoveDOM: function () {
                if (this._input != null && this._input.parentElement != null) {
                    this._input.parentElement.remove();
                }
            }
        }
    });

    Bridge.define("Core.Components.Number", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                _decimalSeparator: 0
            },
            ctors: {
                init: function () {
                    this._decimalSeparator = 46;
                }
            }
        },
        fields: {
            _input: null,
            _value: null,
            _nullable: false,
            _isString: false
        },
        props: {
            SetSeclection: false,
            Value: {
                get: function () {
                    return this._value;
                },
                set: function (value) {
                    var $t;
                    var oldValue = this._value;
                    this._value = value;
                    if (System.Nullable.liftne("ne", this._value, System.Decimal.lift(null))) {
                        this._value = System.Convert.toDecimal(this._value);
                        var precision = System.Convert.toInt32(Bridge.box(($t = this.GuiInfo.Precision, $t != null ? $t : 0), System.Int32));
                        this._value = System.Decimal.toDecimalPlaces(System.Nullable.getValue(this._value), precision, 7);
                        var dotCount = System.Linq.Enumerable.from(this._input.value, System.Char).where(function (x) {
                                return x === 44;
                            }).count();
                        var selectionEnd = this._input.selectionEnd;
                        this._input.value = this.EmptyRow ? "" : System.String.format("{0:n" + precision + "}", [this._value]);
                        var addedDot = (System.Linq.Enumerable.from(this._input.value, System.Char).where(function (x) {
                                return x === 44;
                            }).count() - dotCount) | 0;
                        if (this.SetSeclection) {
                            this._input.selectionStart = (selectionEnd + addedDot) | 0;
                            this._input.selectionEnd = (selectionEnd + addedDot) | 0;
                        }
                    } else if (!this._nullable) {
                        this._value = System.Decimal(0);
                        this._input.value = this._value.toString();
                    } else {
                        this._input.value = null;
                    }

                    if (System.Nullable.liftne("ne", oldValue, this._value)) {
                        this.Dirty = true;
                    }

                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this._value);
                    this.PopulateFields();
                    if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.ChildStyle)) {
                        var fn = { };
                        if (Core.Extensions.Utils.IsFunction(this.GuiInfo.ChildStyle, fn)) {
                            Bridge.toString(fn.v.call(this, Bridge.unbox(this.Entity), this._input));
                        }
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.SetSeclection = true;
            },
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this._input = Bridge.as(ele, HTMLInputElement);
            }
        },
        methods: {
            Render: function () {
                var $t, $t1;
                this.SetDefaultVal();
                if (this.Entity != null) {
                    var fieldVal = Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName);
                    this._isString = Bridge.is(fieldVal, System.String);
                    this._nullable = this.IsNullable(System.Int32) || this.IsNullable(System.Int64) || this.IsNullable(System.Decimal);
                    this._value = this.GetDecimalValue();
                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this._value);
                }
                if (this._input == null) {
                    Core.MVVM.Html.Take(this.ParentElement).Input.Render();
                    this.Element = (this._input = Bridge.as(Core.MVVM.Html.Context, HTMLInputElement));
                } else {
                    this.Element = this._input;
                }
                this._input.type = "tel";
                this._input.setAttribute("autocorrect", "off");
                this._input.setAttribute("spellcheck", "false");
                this._input.addEventListener("input", Bridge.fn.cacheBind(this, this.SetValue));
                this._input.addEventListener("keydown", Bridge.fn.bind(this, function (e) {
                    var $step = 0,
                        $task1, 
                        $jumpFromFinally, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        $task1 = this.KeyDownNumber(e);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $task1.getAwaitedResult();
                                        return;
                                    }
                                    default: {
                                        return;
                                    }
                                }
                            }
                        }, arguments);

                    $asyncBody();
                }));
                this._input.addEventListener("change", Bridge.fn.cacheBind(this, this.ChangeSetValue));
                this._input.autocomplete = "off";
                this.Value = this._value; // set again to render in correct format
                var fn = { };
                if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.ChildStyle) && Core.Extensions.Utils.IsFunction(this.GuiInfo.ChildStyle, fn)) {
                    window.setTimeout(Bridge.fn.bind(this, function () {
                        Bridge.toString(fn.v.call(this, Bridge.unbox(this.Entity), this._input));
                    }), 100);
                }
                ($t = Core.Extensions.HtmlElementExtension.Closest(this.Element, "td")) != null ? $t.addEventListener("keydown", Bridge.fn.cacheBind(this, this.ListViewItemTab)) : null;
                !Bridge.staticEquals(($t1 = this.DOMContentLoaded), null) ? $t1() : null;
            },
            KeyDownNumber: function (evt) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $task2, 
                    $task3, 
                    $taskResult3, 
                    $task4, 
                    $taskResult4, 
                    $task5, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    fnKey, 
                    tcs, 
                    te, 
                    checkMulti, 
                    values, 
                    $t, 
                    current, 
                    startNo, 
                    varCount, 
                    gridView, 
                    $t1, 
                    item, 
                    upItem, 
                    updated, 
                    $t2, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3,4,5,6,7,8,10,11,12,13,14,16], $step);
                                switch ($step) {
                                    case 0: {
                                        if (!(Bridge.is(this.Parent, Core.Components.ListViewItem))) {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        fnKey = System.Nullable.eq(Core.Extensions.EventExt.KeyCodeEnum(evt), Core.Enums.KeyCodeEnum.V) && Core.Extensions.EventExt.CtrlOrMetaKey(evt) && Core.Extensions.EventExt.ShiftKey(evt);
                                        tcs = new System.Threading.Tasks.TaskCompletionSource();
                                        if (fnKey) {
                                            $step = 1;
                                            continue;
                                        } 
                                        $step = 16;
                                        continue;
                                    }
                                    case 1: {
                                        navigator.clipboard.readText().then(clipText => tcs.setResult(clipText));
                                        $task1 = tcs.task;
                                        $step = 2;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 2: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        te = $taskResult1;
                                        checkMulti = System.String.contains(te,"\r\n");
                                        if (checkMulti) {
                                            $step = 3;
                                            continue;
                                        } 
                                        $step = 15;
                                        continue;
                                    }
                                    case 3: {
                                        values = ($t = System.String, System.Linq.Enumerable.from(te.split("\r\n"), $t).toList($t));
                                        this._input.value = values.getItem(0);
                                        this.SetValue();
                                        current = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem, this);
                                        startNo = current.RowNo;
                                        varCount = (values.Count + startNo) | 0;
                                        gridView = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.VirtualGrid, this);
                                        gridView.AutoFocus = true;
                                        $t1 = Bridge.getEnumerator(System.Linq.Enumerable.from(values, System.String).take(((values.Count - 1) | 0)));
                                        $step = 4;
                                        continue;
                                    }
                                    case 4: {
                                        if ($t1.moveNext()) {
                                            item = $t1.Current;
                                            $step = 5;
                                            continue;
                                        }
                                        $step = 14;
                                        continue;
                                    }
                                    case 5: {
                                        upItem = System.Linq.Enumerable.from(gridView.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(function (x) {
                                            return x.RowNo === startNo;
                                        }, null);
                                        if (upItem == null) {
                                            $step = 6;
                                            continue;
                                        } 
                                        $step = 10;
                                        continue;
                                    }
                                    case 6: {
                                        if (startNo <= varCount) {
                                            $step = 7;
                                            continue;
                                        } 
                                        $step = 9;
                                        continue;
                                    }
                                    case 7: {
                                        $task2 = System.Threading.Tasks.Task.delay(1000);
                                        $step = 8;
                                        if ($task2.isCompleted()) {
                                            continue;
                                        }
                                        $task2.continue($asyncBody);
                                        return;
                                    }
                                    case 8: {
                                        $task2.getAwaitedResult();
                                        upItem = System.Linq.Enumerable.from(gridView.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(function (x) {
                                            return x.RowNo === startNo;
                                        }, null);
                                        $step = 9;
                                        continue;
                                    }

                                    case 10: {
                                        updated = System.Linq.Enumerable.from(upItem.FilterChildren(Core.Components.Number, Bridge.fn.bind(this, function (x) {
                                            return Bridge.referenceEquals(x.FieldName, this.FieldName);
                                        })), Core.Components.Number).firstOrDefault(null, null);
                                        updated.Dirty = true;
                                        updated.Value = Core.Extensions.StringExt.IsNullOrWhiteSpace(System.String.replaceAll(System.String.replaceAll(item, ",", ""), ".", "")) ? Bridge.getDefaultValue(System.Decimal) : System.Decimal(System.String.replaceAll(System.String.replaceAll(item, ",", ""), ".", ""));
                                        updated.UpdateView();
                                        updated.PopulateFields();
                                        $task3 = Core.Components.Extensions.ComponentExt.DispatchEvent(updated, updated.GuiInfo.Events, "change", [upItem.Entity]);
                                        $step = 11;
                                        if ($task3.isCompleted()) {
                                            continue;
                                        }
                                        $task3.continue($asyncBody);
                                        return;
                                    }
                                    case 11: {
                                        $taskResult3 = $task3.getAwaitedResult();
                                        $task4 = Core.Components.Extensions.ComponentExt.DispatchEvent(upItem.ListViewSection.ListView, upItem.ListViewSection.ListView.GuiInfo.Events, "change", [upItem.Entity]);
                                        $step = 12;
                                        if ($task4.isCompleted()) {
                                            continue;
                                        }
                                        $task4.continue($asyncBody);
                                        return;
                                    }
                                    case 12: {
                                        $taskResult4 = $task4.getAwaitedResult();
                                        if (gridView.GuiInfo.IsRealtime) {
                                            upItem.PatchUpdateOrCreate();
                                        }
                                        ($t2 = gridView.DataTable.parentElement).scrollTop = ($t2.scrollTop + 26) | 0;
                                        startNo = (startNo + 1) | 0;
                                        $task5 = System.Threading.Tasks.Task.delay(300);
                                        $step = 13;
                                        if ($task5.isCompleted()) {
                                            continue;
                                        }
                                        $task5.continue($asyncBody);
                                        return;
                                    }
                                    case 13: {
                                        $task5.getAwaitedResult();
                                        $step = 4;
                                        continue;
                                    }
                                    case 14: {
                                        gridView.AutoFocus = false;
                                        $step = 15;
                                        continue;
                                    }

                                    case 16: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            IsNullable: function (T) {
                return Core.Extensions.Utils.IsNullable(T, Bridge.getType(this.Entity), this.FieldName, this.Entity);
            },
            ChangeSetValue: function () {
                var $t, $t1, $t2;
                var oldVal = this._value;
                this.EmptyRow = false;
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(this._input.value)) {
                    this.Value = System.Decimal.lift(null);
                    !Bridge.staticEquals(($t = this.UserInput), null) ? $t(($t1 = new Core.MVVM.ObservableArgs(), $t1.NewData = null, $t1.OldData = oldVal, $t1.EvType = "change", $t1)) : null;
                    return;
                }
                this._input.value = this._input.value.trim();
                if (System.Linq.Enumerable.from(this._input.value, System.Char).last() === Core.Components.Number._decimalSeparator) {
                    this._input.value = this._input.value.substr(0, ((this._input.value.length - 1) | 0));
                }

                var text = System.String.replaceAll(this._input.value, ",", "");
                var value = { };
                var parsedResult = System.Decimal.tryParse(text, System.Globalization.CultureInfo.invariantCulture.numberFormat, value);
                if (!parsedResult) {
                    this.Value = this._value; // Set old value to avoid accept invalid value
                    return;
                }
                this.Value = value.v;
                !Bridge.staticEquals(($t1 = this.UserInput), null) ? $t1(($t2 = new Core.MVVM.ObservableArgs(), $t2.NewData = value.v, $t2.OldData = oldVal, $t2.EvType = "change", $t2)) : null;
                this.PopulateFields();
                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity, value.v, oldVal]));
            },
            SetValue: function () {
                var $t, $t1;
                this.EmptyRow = false;
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(this._input.value)) {
                    this.Value = System.Decimal.lift(null);
                    return;
                }
                this._input.value = this._input.value.trim();
                if (System.Linq.Enumerable.from(this._input.value, System.Char).last() === Core.Components.Number._decimalSeparator) {
                    this._input.value = this._input.value.substr(0, ((this._input.value.length - 1) | 0));
                }

                var text = System.String.replaceAll(this._input.value, ",", "");
                var value = { };
                var parsedResult = System.Decimal.tryParse(text, System.Globalization.CultureInfo.invariantCulture.numberFormat, value);
                if (!parsedResult) {
                    this.Value = this._value; // Set old value to avoid accept invalid value
                    return;
                }
                var oldVal = this._value;
                this.Value = value.v;
                !Bridge.staticEquals(($t = this.UserInput), null) ? $t(($t1 = new Core.MVVM.ObservableArgs(), $t1.NewData = value.v, $t1.OldData = oldVal, $t1.EvType = "input", $t1)) : null;
                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "input", [this.Entity, value.v, oldVal]));
            },
            GetDecimalValue: function () {
                if (this.Entity == null) {
                    return System.Decimal.lift(null);
                }

                var value = Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName);
                if (value == null) {
                    return System.Decimal.lift(null);
                }

                if (this._isString && Core.Extensions.StringExt.IsNullOrWhiteSpace(Bridge.toString(value))) {
                    return System.Decimal.lift(null);
                }

                try {
                    var result = System.Convert.toDecimal(value);
                    return result;
                } catch ($e1) {
                    $e1 = System.Exception.create($e1);
                }
                return System.Decimal.lift(null);
            },
            UpdateView: function (force, dirty, componentNames) {
                var $t;
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                this.Value = this.GetDecimalValue();
                if (!this.Dirty) {
                    !Bridge.staticEquals(($t = this.DOMContentLoaded), null) ? $t() : null;
                    this.OldValue = this._input.value;
                }
            },
            ValidateAsync: function () {
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule), this.ValidationRules)) {
                    return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
                }
                this.ValidationResult.clear();
                this.ValidateRequired(System.Nullable$1(System.Decimal), this._value);
                this.Validate(System.Nullable$1(System.Decimal), System.Nullable$1(System.Decimal), Core.Extensions.ValidationRule.GreaterThan, this._value, function (value, ruleValue) {
                    return System.Nullable.lifteq("equals", ruleValue, System.Decimal.lift(null)) || System.Nullable.liftne("ne", value, System.Decimal.lift(null)) && System.Nullable.liftcmp("gt", value, ruleValue);
                });
                this.Validate(System.Nullable$1(System.Decimal), System.Nullable$1(System.Decimal), Core.Extensions.ValidationRule.LessThan, this._value, function (value, ruleValue) {
                    return System.Nullable.lifteq("equals", ruleValue, System.Decimal.lift(null)) || System.Nullable.liftne("ne", value, System.Decimal.lift(null)) && System.Nullable.liftcmp("lt", value, ruleValue);
                });
                this.Validate(System.Nullable$1(System.Decimal), System.Nullable$1(System.Decimal), Core.Extensions.ValidationRule.GreaterThanOrEqual, this._value, function (value, ruleValue) {
                    return System.Nullable.lifteq("equals", ruleValue, System.Decimal.lift(null)) || System.Nullable.liftne("ne", value, System.Decimal.lift(null)) && System.Nullable.liftcmp("gte", value, ruleValue);
                });
                this.Validate(System.Nullable$1(System.Decimal), System.Nullable$1(System.Decimal), Core.Extensions.ValidationRule.LessThanOrEqual, this._value, function (value, ruleValue) {
                    return System.Nullable.lifteq("equals", ruleValue, System.Decimal.lift(null)) || System.Nullable.liftne("ne", value, System.Decimal.lift(null)) && System.Nullable.liftcmp("lte", value, ruleValue);
                });
                this.Validate(System.Nullable$1(System.Decimal), System.Nullable$1(System.Decimal), Core.Extensions.ValidationRule.Equal, this._value, function (value, ruleValue) {
                    return System.Nullable.lifteq("equals", value, ruleValue);
                });
                this.Validate(System.Nullable$1(System.Decimal), System.Nullable$1(System.Decimal), Core.Extensions.ValidationRule.NotEqual, this._value, function (value, ruleValue) {
                    return System.Nullable.liftne("ne", value, ruleValue);
                });
                return System.Threading.Tasks.Task.fromResult(this.IsValid, System.Boolean);
            },
            SetDisableUI: function (value) {
                this._input.readOnly = value;
            }
        }
    });

    Bridge.define("Core.Components.Paginator", {
        inherits: [Core.Components.EditableComponent],
        props: {
            Options: {
                get: function () {
                    return Bridge.as(this.Entity, Core.Components.PaginationOptions);
                }
            },
            Disabled: {
                get: function () {
                    return false;
                },
                set: function (value) {
                    this._disabled = false;
                }
            }
        },
        ctors: {
            ctor: function (paginator) {
                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, null);
                this.Entity = paginator || (function () {
                    throw new System.ArgumentNullException.$ctor1("paginator");
                })();
                this.PopulateDirty = false;
                this.AlwaysValid = true;
                this.StopChildrenHistory = true;
            }
        },
        methods: {
            Render: function () {
                var $t, $t1;
                Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Parent.Element).Div, "grid-toolbar paging").Label, "Ph\u00e2n trang").End.Render();
                this.Element = Core.MVVM.Html.Context;
                var pageSize = ($t = new Core.Components.Number(($t1 = new Core.Models.Component(), $t1.FieldName = "PageSize", $t1), null), $t.SetSeclection = false, $t);
                var startIndex = new Core.Components.Label(($t = new Core.Models.Component(), $t.FieldName = "StartIndex", $t));
                var endIndex = new Core.Components.Label(($t = new Core.Models.Component(), $t.FieldName = "EndIndex", $t));
                var total = new Core.Components.Label(($t = new Core.Models.Component(), $t.FieldName = "Total", $t.FormatData = "{0:n0}", $t));
                var selected = new Core.Components.Label(($t = new Core.Models.Component(), $t.FieldName = "Selected", $t.FormatData = "{0:n0}", $t));
                var pageNum = ($t = new Core.Components.Number(($t1 = new Core.Models.Component(), $t1.FieldName = "PageNumber", $t1), null), $t.AlwaysValid = true, $t.SetSeclection = false, $t);
                this.AddChild(pageSize);
                pageSize.Element.addEventListener(System.Enum.toString(System.String, "change"), Bridge.fn.cacheBind(this, this.ReloadListView));
                Core.MVVM.Html.Instance.End.Span.Render();
                this.AddChild(startIndex);
                Core.MVVM.Html.Instance.Text("-");
                this.AddChild(endIndex);
                Core.Components.Renderer.IText(Core.MVVM.Html.Instance, " trong s\u1ed1 ");
                this.AddChild(total);
                Core.Components.Renderer.IText(Core.MVVM.Html.Instance, System.String.format(" \u0111ang ch\u1ecdn ", null));
                this.AddChild(selected);
                Core.Components.Renderer.IText(Core.MVVM.Html.Instance, System.String.format(" d\u00f2ng ", null));
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Ul, "pagination").Li.Text("\u276e").Event("click", Bridge.fn.cacheBind(this, this.PrevPage)).End.Render();
                this.AddChild(pageNum);
                pageNum.Element.addEventListener(System.Enum.toString(System.String, "change"), Bridge.fn.bind(this, function () {
                    this.Options.PageIndex = (this.Options.PageNumber - 1) | 0;
                    this.ReloadListView();
                }));
                Core.MVVM.Html.Instance.End.Li.Text("\u276f").Event("click", Bridge.fn.cacheBind(this, this.NextPage)).End.Render();
            },
            NextPage: function () {
                var $t, $t1;
                var pages = System.Decimal.toDecimalPlaces(System.Decimal(this.Options.Total).div(System.Decimal(this.Options.PageSize)), 0, 0);
                if (System.Decimal(this.Options.PageNumber).gte(pages)) {
                    return;
                }

                ($t = this.Options).PageIndex = ($t.PageIndex + 1) | 0;
                !Bridge.staticEquals(($t1 = this.Options.ClickHandler), null) ? $t1(this.Options.PageIndex, null) : null;
                this.ReloadListView();
            },
            PrevPage: function () {
                var $t, $t1;
                if (this.Options.PageIndex <= 0) {
                    return;
                }

                ($t = this.Options).PageIndex = ($t.PageIndex - 1) | 0;
                !Bridge.staticEquals(($t1 = this.Options.ClickHandler), null) ? $t1(this.Options.PageIndex, null) : null;
                this.ReloadListView();
            },
            ReloadListView: function () {
                (Bridge.as(this.Parent, Core.Components.ListView)).ActionFilter();
            },
            UpdateView: function (force, dirty, componentNames) {
                var $t;
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                this.Show = this.Options.Total >= this.Options.PageSize;
                ($t = this.Children) != null ? $t.ForEach(function (child) {
                        child.UpdateView();
                    }) : null;
            }
        }
    });

    Bridge.define("Core.Components.Textbox", {
        inherits: [Core.Components.EditableComponent],
        fields: {
            _value: null,
            _oldText: null,
            _text: null
        },
        props: {
            Input: null,
            TextArea: null,
            MultipleLine: false,
            Password: false,
            Value: {
                get: function () {
                    return this._value;
                },
                set: function (value) {
                    var $t, $t1;
                    this._value = value;
                    var str_val;
                    if (this._value != null && ((str_val = Bridge.as(this._value, System.String))) != null && ((this.EditForm.Feature != null && !this.EditForm.Feature.IgnoreEncode) || this.EditForm.Feature == null)) {
                        ($t = this.Entity) != null ? Core.Extensions.BridgeExt.SetComplexPropValue($t, this.FieldName, Core.Extensions.Utils.EncodeSpecialChar(Core.Extensions.Utils.DecodeSpecialChar(str_val))) : null;
                    }

                    if (this.Entity != null) {
                        Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this._value);
                    }

                    var text = (this.EditForm.Feature != null && this.EditForm.Feature.IgnoreEncode) ? this._value != null ? Bridge.toString(this._value) : null : this._value != null ? Core.Extensions.Utils.DecodeSpecialChar(Bridge.toString(this._value)) : null;
                    if (Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FormatData)) {
                        text = Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.FormatData, ($t1 = this.Entity) != null ? Core.Extensions.Utils.GetPropValue($t1, this.FieldName) : null);
                    }

                    if (Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FormatEntity)) {
                        text = Core.Extensions.Utils.FormatEntity(this.GuiInfo.FormatEntity, null, this.Entity, Core.Extensions.Utils.EmptyFormat, Core.Extensions.Utils.EmptyFormat);
                    }

                    if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.ChildStyle)) {
                        var fn = { };
                        if (Core.Extensions.Utils.IsFunction(this.GuiInfo.ChildStyle, fn)) {
                            Bridge.toString(fn.v.call(this, Bridge.unbox(this.Entity), this.Element));
                        }
                    }

                    this.Text = text;
                    this.PopulateFields();
                }
            },
            Text: {
                get: function () {
                    return this._text;
                },
                set: function (value) {
                    this._text = value;
                    if (this.Input != null) {
                        this.Input.value = this._text;
                    }

                    if (this.TextArea != null) {
                        this.TextArea.value = this._text;
                    }
                }
            }
        },
        ctors: {
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                if (Bridge.is(ele, HTMLInputElement)) {
                    this.Input = Bridge.as(ele, HTMLInputElement);
                } else if (Bridge.is(ele, HTMLTextAreaElement)) {
                    this.TextArea = Bridge.as(ele, HTMLTextAreaElement);
                }
                document.addEventListener("visibilitychange", Bridge.fn.bind(this, function (e) {
                    if (this.Dirty) {
                        this.PopulateUIChange("visibilitychange");
                    }
                }));
            }
        },
        methods: {
            KeyDownNumber: function (evt) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $task2, 
                    $task3, 
                    $taskResult3, 
                    $task4, 
                    $taskResult4, 
                    $task5, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    check, 
                    tcs, 
                    te, 
                    checkMulti, 
                    values, 
                    $t, 
                    current, 
                    startNo, 
                    varCount, 
                    gridView, 
                    $t1, 
                    item, 
                    upItem, 
                    updated, 
                    $t2, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3,4,5,6,7,8,10,11,12,13,14,16], $step);
                                switch ($step) {
                                    case 0: {
                                        if (!(Bridge.is(this.Parent, Core.Components.ListViewItem))) {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        check = System.Nullable.eq(Core.Extensions.EventExt.KeyCodeEnum(evt), Core.Enums.KeyCodeEnum.V) && Core.Extensions.EventExt.CtrlOrMetaKey(evt) && Core.Extensions.EventExt.ShiftKey(evt);
                                        tcs = new System.Threading.Tasks.TaskCompletionSource();
                                        if (check) {
                                            $step = 1;
                                            continue;
                                        } 
                                        $step = 16;
                                        continue;
                                    }
                                    case 1: {
                                        navigator.clipboard.readText().then(clipText => tcs.setResult(clipText));
                                        $task1 = tcs.task;
                                        $step = 2;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 2: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        te = $taskResult1;
                                        checkMulti = System.String.contains(te,"\r\n");
                                        if (checkMulti) {
                                            $step = 3;
                                            continue;
                                        } 
                                        $step = 15;
                                        continue;
                                    }
                                    case 3: {
                                        values = ($t = System.String, System.Linq.Enumerable.from(te.split("\r\n"), $t).toList($t));
                                        this.Input.value = values.getItem(0);
                                        current = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewItem, this);
                                        startNo = current.RowNo;
                                        varCount = (values.Count + startNo) | 0;
                                        gridView = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.VirtualGrid, this);
                                        gridView.AutoFocus = true;
                                        $t1 = Bridge.getEnumerator(System.Linq.Enumerable.from(values, System.String).take(((values.Count - 1) | 0)));
                                        $step = 4;
                                        continue;
                                    }
                                    case 4: {
                                        if ($t1.moveNext()) {
                                            item = $t1.Current;
                                            $step = 5;
                                            continue;
                                        }
                                        $step = 14;
                                        continue;
                                    }
                                    case 5: {
                                        upItem = System.Linq.Enumerable.from(gridView.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(function (x) {
                                            return x.RowNo === startNo;
                                        }, null);
                                        if (upItem == null) {
                                            $step = 6;
                                            continue;
                                        } 
                                        $step = 10;
                                        continue;
                                    }
                                    case 6: {
                                        if (startNo <= varCount) {
                                            $step = 7;
                                            continue;
                                        } 
                                        $step = 9;
                                        continue;
                                    }
                                    case 7: {
                                        $task2 = System.Threading.Tasks.Task.delay(1000);
                                        $step = 8;
                                        if ($task2.isCompleted()) {
                                            continue;
                                        }
                                        $task2.continue($asyncBody);
                                        return;
                                    }
                                    case 8: {
                                        $task2.getAwaitedResult();
                                        upItem = System.Linq.Enumerable.from(gridView.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(function (x) {
                                            return x.RowNo === startNo;
                                        }, null);
                                        $step = 9;
                                        continue;
                                    }

                                    case 10: {
                                        updated = System.Linq.Enumerable.from(upItem.FilterChildren(Core.Components.Textbox, Bridge.fn.bind(this, function (x) {
                                            return Bridge.referenceEquals(x.FieldName, this.FieldName);
                                        })), Core.Components.Textbox).firstOrDefault(null, null);
                                        updated.Dirty = true;
                                        updated.Value = item;
                                        updated.UpdateView();
                                        updated.PopulateFields();
                                        $task3 = Core.Components.Extensions.ComponentExt.DispatchEvent(updated, updated.GuiInfo.Events, "change", [upItem.Entity]);
                                        $step = 11;
                                        if ($task3.isCompleted()) {
                                            continue;
                                        }
                                        $task3.continue($asyncBody);
                                        return;
                                    }
                                    case 11: {
                                        $taskResult3 = $task3.getAwaitedResult();
                                        $task4 = Core.Components.Extensions.ComponentExt.DispatchEvent(upItem.ListViewSection.ListView, upItem.ListViewSection.ListView.GuiInfo.Events, "change", [upItem.Entity]);
                                        $step = 12;
                                        if ($task4.isCompleted()) {
                                            continue;
                                        }
                                        $task4.continue($asyncBody);
                                        return;
                                    }
                                    case 12: {
                                        $taskResult4 = $task4.getAwaitedResult();
                                        if (gridView.GuiInfo.IsRealtime) {
                                            upItem.PatchUpdateOrCreate();
                                        }
                                        ($t2 = gridView.DataTable.parentElement).scrollTop = ($t2.scrollTop + 26) | 0;
                                        startNo = (startNo + 1) | 0;
                                        $task5 = System.Threading.Tasks.Task.delay(500);
                                        $step = 13;
                                        if ($task5.isCompleted()) {
                                            continue;
                                        }
                                        $task5.continue($asyncBody);
                                        return;
                                    }
                                    case 13: {
                                        $task5.getAwaitedResult();
                                        $step = 4;
                                        continue;
                                    }
                                    case 14: {
                                        gridView.AutoFocus = false;
                                        $step = 15;
                                        continue;
                                    }

                                    case 16: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            Render: function () {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7;
                this.SetDefaultVal();
                var val = ($t = this.Entity) != null ? Core.Extensions.Utils.GetPropValue($t, this.FieldName) : null;
                var str_val;
                if (val != null && ((str_val = Bridge.as(val, System.String))) != null && this.EditForm != null && this.EditForm.Feature != null && !this.EditForm.Feature.IgnoreEncode) {
                    ($t1 = this.Entity) != null ? Core.Extensions.BridgeExt.SetComplexPropValue($t1, this.FieldName, Core.Extensions.Utils.EncodeSpecialChar(Core.Extensions.Utils.DecodeSpecialChar(str_val))) : null;
                }
                var text = val != null ? Bridge.toString(val) : null;
                if (Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FormatData)) {
                    text = Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.FormatData, val);
                }

                if (Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.FormatEntity)) {
                    text = Core.Extensions.Utils.FormatEntity$1(this.GuiInfo.FormatEntity, this.Entity);
                }
                this._text = this.EditForm != null && this.EditForm.Feature != null && this.EditForm.Feature.IgnoreEncode ? text : Core.Extensions.Utils.DecodeSpecialChar(text);
                if (this.MultipleLine || this.TextArea != null) {
                    if (this.TextArea == null) {
                        Core.Components.Renderer.PlaceHolder(Core.MVVM.Html.Take(this.ParentElement).TextArea.Value(this._text), this.GuiInfo.PlainText);
                        this.Element = ($t2 = Bridge.as(Core.MVVM.Html.Context, HTMLTextAreaElement), this.TextArea = $t2, $t2);
                    } else {
                        this.Element = this.TextArea;
                        this.TextArea.value = this._text;
                    }
                    if (System.Nullable.gt(this.GuiInfo.Row, 0)) {
                        Core.MVVM.Html.Instance.Attr("rows", ($t3 = this.GuiInfo.Row, $t3 != null ? $t3 : 1));
                    }

                    this.TextArea.oninput = Bridge.fn.combine(this.TextArea.oninput, Bridge.fn.bind(this, function (e) {
                        this.PopulateUIChange("input");
                    }));
                    this.TextArea.onchange = Bridge.fn.combine(this.TextArea.onchange, Bridge.fn.bind(this, function (e) {
                        this.PopulateUIChange("change");
                    }));
                    this.TextArea.addEventListener("keydown", Bridge.fn.bind(this, function (e) {
                        var $step = 0,
                            $task1, 
                            $jumpFromFinally, 
                            $asyncBody = Bridge.fn.bind(this, function () {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = this.KeyDownNumber(e);
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $task1.getAwaitedResult();
                                            return;
                                        }
                                        default: {
                                            return;
                                        }
                                    }
                                }
                            }, arguments);

                        $asyncBody();
                    }));
                } else {
                    if (this.Input == null) {
                        Core.Components.Renderer.PlaceHolder(Core.MVVM.Html.Take(this.ParentElement).Input.Value(this._text), this.GuiInfo.PlainText);
                        this.Element = ($t4 = Bridge.as(Core.MVVM.Html.Context, HTMLInputElement), this.Input = $t4, $t4);
                    } else {
                        this.Element = this.Input;
                        this.Input.value = this._text;
                    }
                    this.Input.autocomplete = "off";
                    this.Input.name = ($t5 = this.GuiInfo.DataSourceFilter, $t5 != null ? $t5 : this.FieldName);
                    this.Input.oninput = Bridge.fn.combine(this.Input.oninput, Bridge.fn.bind(this, function (e) {
                        this.PopulateUIChange("input");
                    }));
                    this.Input.onchange = Bridge.fn.combine(this.Input.onchange, Bridge.fn.bind(this, function (e) {
                        this.PopulateUIChange("change");
                    }));
                    this.Input.addEventListener("keydown", Bridge.fn.bind(this, function (e) {
                        var $step = 0,
                            $task1, 
                            $jumpFromFinally, 
                            $asyncBody = Bridge.fn.bind(this, function () {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = this.KeyDownNumber(e);
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $task1.getAwaitedResult();
                                            return;
                                        }
                                        default: {
                                            return;
                                        }
                                    }
                                }
                            }, arguments);

                        $asyncBody();
                    }));
                }
                if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.ChildStyle)) {
                    var fn = { };
                    if (Core.Extensions.Utils.IsFunction(this.GuiInfo.ChildStyle, fn)) {
                        Bridge.toString(fn.v.call(this, Bridge.unbox(this.Entity), this.Element));
                    }
                }
                if (this.Password) {
                    Core.MVVM.Html.Instance.Style$1("text-security: disc;-webkit-text-security: disc;-moz-text-security: disc;");
                }
                if (!this.GuiInfo.ShowLabel) {
                    Core.Components.Renderer.PlaceHolder(Core.MVVM.Html.Instance, this.GuiInfo.PlainText);
                }
                ($t6 = Core.Extensions.HtmlElementExtension.Closest(this.Element, "td")) != null ? $t6.addEventListener("keydown", Bridge.fn.cacheBind(this, this.ListViewItemTab)) : null;
                !Bridge.staticEquals(($t7 = this.DOMContentLoaded), null) ? $t7() : null;
            },
            PopulateUIChange: function (type, shouldTrim) {
                var $t, $t1, $t2;
                if (shouldTrim === void 0) { shouldTrim = false; }
                if (this.Disabled) {
                    return;
                }
                this._oldText = this._text;
                this._text = ($t = (($t1 = this.Input) != null ? $t1.value : null), $t != null ? $t : this.TextArea.value);
                this._text = this.Password ? this._text : shouldTrim ? this._text != null ? this._text.trim() : null : this._text;
                if (this.GuiInfo.UpperCase && this._text != null) {
                    this.Text = this._text.toLocaleUpperCase();
                }
                this._value = (this.EditForm != null && this.EditForm.Feature != null && this.EditForm.Feature.IgnoreEncode) ? this._text : Core.Extensions.Utils.EncodeSpecialChar(this._text);
                if (this.Entity != null) {
                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this._value);
                }
                this.Dirty = true;
                if (!Bridge.staticEquals(this.UserInput, null)) {
                    this.UserInput(($t2 = new Core.MVVM.ObservableArgs(), $t2.NewData = this._text, $t2.OldData = this._oldText, $t2.EvType = type, $t2));
                }
                this.PopulateFields();
                System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, type, [this.Entity]);
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                }));
            },
            UpdateView: function (force, dirty, componentNames) {
                var $t, $t1;
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                this.Value = ($t = this.Entity) != null ? Core.Extensions.Utils.GetPropValue($t, this.FieldName) : null;
                if (!this.Dirty) {
                    !Bridge.staticEquals(($t1 = this.DOMContentLoaded), null) ? $t1() : null;
                    this.OldValue = this._text;
                }
            },
            ValidateAsync: function () {
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,Core.Extensions.ValidationRule), this.ValidationRules)) {
                    return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
                }
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                this.ValidationResult.clear();
                this.Validate(System.String, System.Int64, Core.Extensions.ValidationRule.MinLength, this._text, Bridge.fn.bind(this, function (value, minLength) {
                    return this._text != null && System.Int64(this._text.length).gte(minLength);
                }));
                this.Validate(System.String, System.Int64, Core.Extensions.ValidationRule.CheckLength, this._text, Bridge.fn.bind(this, function (text, checkLength) {
                    return this._text == null || Bridge.referenceEquals(this._text, "") || System.Int64(this._text.length).equals(checkLength);
                }));
                this.Validate(System.String, System.Int64, Core.Extensions.ValidationRule.MaxLength, this._text, Bridge.fn.bind(this, function (text, maxLength) {
                    return this._text == null || System.Int64(this._text.length).lte(maxLength);
                }));
                this.Validate(System.String, System.String, Core.Extensions.ValidationRule.RegEx, this._text, Bridge.fn.cacheBind(this, this.ValidateRegEx));
                this.ValidateRequired(System.String, this.Text);
                Core.Extensions.EventExt.Done(this.ValidateUnique(), Bridge.fn.bind(this, function () {
                    tcs.trySetResult(this.IsValid);
                }));
                return tcs.task;
            },
            ValidateUnique: function () {
                var $t;
                if (!this.ValidationRules.containsKey(Core.Extensions.ValidationRule.Unique)) {
                    return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
                }
                var rule = this.ValidationRules.getItem(Core.Extensions.ValidationRule.Unique);
                if (rule == null || Core.Extensions.StringExt.IsNullOrWhiteSpace(this._text)) {
                    return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
                }
                var fn = { };
                var isFn = Core.Extensions.Utils.IsFunction(this.GuiInfo.PreQuery, fn);
                var table = Core.Extensions.StringExt.HasNonSpaceChar(this.GuiInfo.RefName) ? this.GuiInfo.RefName : this.EditForm.Feature.EntityName;
                var sql = ($t = new Core.ViewModels.SqlViewModel(), $t.ComId = this.GuiInfo.Id, $t.Params = isFn ? JSON.stringify(Bridge.unbox(fn.v.call(null, this))) : null, $t.ConnKey = this.ConnKey, $t);
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), Core.Clients.Client.Instance.ComQuery(sql), Bridge.fn.bind(this, function (ds) {
                    var exists = ds.length > 0 && ds[System.Array.index(0, ds)].length > 0;
                    if (exists) {
                        System.Collections.Generic.CollectionExtensions.TryAdd(System.String, System.String, this.ValidationResult, Core.Extensions.ValidationRule.Unique, System.String.format(rule.Message, Core.Components.LangSelect.Get(this.GuiInfo.Label), this._text));
                    } else {
                        this.ValidationResult.remove(Core.Extensions.ValidationRule.Unique);
                    }
                    tcs.trySetResult(Bridge.box(true, System.Boolean, System.Boolean.toString));
                }));
                return tcs.task;
            },
            ValidateRegEx: function (value, regText) {
                if (value == null) {
                    return true;
                }

                var regEx = new RegExp(regText);
                var res = regEx.test(value);
                var rule = this.ValidationRules.getItem(Core.Extensions.ValidationRule.RegEx);
                if (!res && rule.RejectInvalid) {
                    var end = this.Input.selectionEnd;
                    this.Text = this._oldText;
                    this._value = this._oldText;
                    this.Input.selectionStart = end;
                    this.Input.selectionEnd = end;
                    return regEx.test(this._oldText);
                }
                return res;
            },
            SetDisableUI: function (value) {
                if (this.Input != null) {
                    this.Input.readOnly = value;
                }

                if (this.TextArea != null) {
                    this.TextArea.readOnly = value;
                }
            }
        }
    });

    Bridge.define("Core.Components.PdfReport", {
        inherits: [Core.Components.EditableComponent],
        statics: {
            fields: {
                ErrorMessage: null,
                DataNotFound: null,
                TemplateNotFound: null
            },
            ctors: {
                init: function () {
                    this.ErrorMessage = "ErrorMessage";
                    this.DataNotFound = "Kh\u00f4ng t\u00ecm th\u1ea5y d\u1eef li\u1ec7u";
                    this.TemplateNotFound = "Template is null or empty";
                }
            }
        },
        fields: {
            _rptContent: null,
            _updateViewAwaiter$1: 0
        },
        props: {
            Selected: null,
            Data: null,
            HiddenButton: false
        },
        ctors: {
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.GuiInfo = ui || (function () {
                    throw new System.ArgumentNullException.$ctor1("ui");
                })();
                this.Element = ele;
            }
        },
        methods: {
            Render: function () {
                if (this.Element == null) {
                    this.Element = Core.MVVM.Html.Take(this.ParentElement).Div.GetContext();
                }
                this.Element.innerHTML = null;
                this.AddSections();
                this.RenderInternal();
            },
            AddSections: function () {
                if (this._rptContent != null || !this.Show) {
                    return;
                }
                this.Element.style.display = "none";
                var html = Core.MVVM.Html.Take(this.Element);
                if (System.Nullable.eq(this.GuiInfo.Precision, 2)) {
                    Core.Components.Renderer.ClassName(html.Div, "printable").Style$1("page-break-before: always;");
                    this._rptContent = html.GetContext();
                } else {
                    Core.Components.Renderer.ClassName(html.Div, "container-rpt");
                    Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(html.Div, "menuBar").Div, "printBtn").Button, "btn btn-success mr-1 fa fa-print").Event("click", Bridge.fn.bind(this, function () {
                        this.EditForm.PrintSection(Bridge.as(this.Element.querySelector(".printable"), HTMLElement), true, void 0, true, this.GuiInfo);
                    })).End.Button, "btn btn-success mr-1").Text("a4").Event("click", Bridge.fn.bind(this, function () {
                        var $step = 0,
                            $task1, 
                            $jumpFromFinally, 
                            $asyncBody = Bridge.fn.bind(this, function () {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = this.GeneratePdf("a4");
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $task1.getAwaitedResult();
                                            return;
                                        }
                                        default: {
                                            return;
                                        }
                                    }
                                }
                            }, arguments);

                        $asyncBody();
                    })).End.Button, "btn btn-success mr-1").Text("a5").Event("click", Bridge.fn.bind(this, function () {
                        var $step = 0,
                            $task1, 
                            $jumpFromFinally, 
                            $asyncBody = Bridge.fn.bind(this, function () {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = this.GeneratePdf("a5");
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $task1.getAwaitedResult();
                                            return;
                                        }
                                        default: {
                                            return;
                                        }
                                    }
                                }
                            }, arguments);

                        $asyncBody();
                    })).End.Button, "btn btn-success mr-1 fa fa-file-excel").Event("click", Bridge.fn.bind(this, function () {
                        var $t;
                        var table;
                        if (!(((table = Bridge.as(this._rptContent.querySelector("table"), HTMLTableElement))) != null)) {
                            Core.Components.Forms.ConfirmDialog.RenderConfirm$1("Excel data not found in the report");
                            return;
                        }
                        Core.Extensions.ExcelExt.ExportTableToExcel(null, ($t = this.GuiInfo.Label, $t != null ? $t : this.FieldName), table);
                    })).End.Render();
                    if (Core.Clients.Client.SystemRole) {
                        Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(html.Button, "btn btn-success mr-1"), "far fa-eye").Event("click", Bridge.fn.bind(this, function () {
                            this.EditForm.PrintSection(Bridge.as(this.Element.querySelector(".printable"), HTMLElement));
                        })).End.Render();
                    }

                    html.EndOf$1(".menuBar");
                    Core.Components.Renderer.ClassName(html.Div, "printable").Style$1("page-break-before: always;");
                    this._rptContent = html.GetContext();
                }
            },
            GeneratePdf: function (format) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    element, 
                    printEl, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        $task1 = Core.Clients.Client.LoadScript("https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js");
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        element = Bridge.as(this.Element.parentElement.querySelector(".printable"), HTMLElement);
                                        if (System.Nullable.eq(this.GuiInfo.Precision, 2)) {
                                            element = Bridge.as(this.Element.parentElement.querySelector(".print-group"), HTMLElement);
                                        }
                                        printEl = element;
                                        printEl.style.pageBreakBefore = null;
                                        const openPdfInNewWindow = (pdf) => {
                                        const blob = pdf.output('blob');
                                        var isMobile = Window.Instance["Cordova"] != null;
                                        if (!isMobile)
                                        {
                                            window.open(window.URL.createObjectURL(blob));
                                            return;
                                        }
                                        var isAndroid = Window.Instance["device"]["platform"].ToString() == "Android";
                                            if (isAndroid)
                                            {
                                                Window.Location.Href = window.URL.createObjectURL(blob);
                                                return;
                                            }
                                            cordova.InAppBrowser.open(window.URL.createObjectURL(blob), "_system");
                                        };
                                        html2pdf(printEl, {
                                            filename : this.GuiInfo.PlainText,
                                            jsPDF: { format: format},
                                            image: { type: 'jpeg', quality: 0.98 },
                                            pdfCallback: openPdfInNewWindow,
                                        });
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            RenderInternal: function () {
                if (!this.Show) {
                    return;
                }
                this.DisposeChildren();
                var template;
                if (Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.Template)) {
                    template = this.GuiInfo.Template;
                    this.TemplateLoaded(template);
                } else {
                    Core.Extensions.EventExt.Done$1(Core.Models.Feature, Core.Components.Extensions.ComponentExt.LoadFeature(this.ConnKey, this.GuiInfo.RefClass, this.GuiInfo.RefClass), Bridge.fn.bind(this, function (ft) {
                        template = ft.Template;
                        this.TemplateLoaded(template);
                    }));
                }
            },
            TemplateLoaded: function (template) {
                if (Core.Extensions.StringExt.IsNullOrEmpty(template)) {
                    throw new System.InvalidOperationException.$ctor1(Core.Components.PdfReport.TemplateNotFound);
                }
                Core.Extensions.EventExt.Done$1(System.Object, this.LoadData(), Bridge.fn.bind(this, function (dataSet) {
                    if (dataSet == null) {
                        this.ShowErrorMessage(Core.Components.PdfReport.DataNotFound);
                        return;
                    }
                    this.Element.style.display = "";
                    var formatted = Core.Extensions.Utils.FormatEntity(template, null, dataSet, function (x) {
                        return "";
                    }, void 0);
                    this._rptContent.innerHTML = formatted;
                    var dsCount = 0;
                    Core.Extensions.IEnumerableExtensions.SelectForEach(HTMLElement, this._rptContent.children, Bridge.fn.bind(this, function (child) {
                        this.EditForm.BindingTemplate(child, this, false, dataSet, Bridge.fn.bind(this, function (ele, component, parent, isLayout, entity) {
                            var $t;
                            var table;
                            if (((table = Bridge.as(ele, HTMLTableElement))) != null) {
                                dsCount = (dsCount + 1) | 0;
                                var ds = dataSet["ds" + dsCount];
                                var com = ($t = new Core.Components.Section.$ctor1(Core.MVVM.ElementType.table), $t.Element = ele, $t);
                                var tbody = table.tBodies[0];
                                var arr = Bridge.as(ds, System.Array.type(System.Object));
                                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, arr)) {
                                    arr = System.Array.init([{ }], System.Object);
                                }
                                var formattedRows = System.Linq.Enumerable.from(arr, System.Object).select(Bridge.fn.bind(this, function (arrItem) {
                                        var $t1;
                                        var cloned = this.CloneRow(($t1 = HTMLTableRowElement, System.Linq.Enumerable.from(tbody.rows, $t1).ToArray($t1)));
                                        return this.BindingRowData(cloned, arrItem);
                                    })).selectMany(function (x) {
                                    return x;
                                }).ToArray(HTMLTableRowElement);
                                tbody.innerHTML = null;
                                formattedRows.forEach(function (x) {
                                        tbody.appendChild(x);
                                    });
                                return com;
                            }
                            return this.EditForm.BindingCom(ele, component, parent, isLayout, entity);
                        }), void 0);
                    }));
                    if (this.GuiInfo != null && Core.Extensions.StringExt.HasAnyChar(this.GuiInfo.Events)) {
                        Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "DOMContentLoaded", [this.Entity]));
                    }
                }));
            },
            ShowErrorMessage: function (message) {
                if (Core.Extensions.HtmlElementExtension.Hidden(this.Element)) {
                    return;
                }
                this.Element.style.display = "none";
                Core.Components.Forms.ConfirmDialog.RenderConfirm$1(message);
            },
            BindingRowData: function (template, arrItem) {
                if (arrItem == null || Core.Extensions.IEnumerableExtensions.Nothing(HTMLTableRowElement, template)) {
                    return null;
                }
                var res = new (System.Collections.Generic.List$1(HTMLTableRowElement)).ctor();
                var subRowIndex = Core.Extensions.IEnumerableExtensions.IndexOf(HTMLTableRowElement, template, function (x) {
                    return Bridge.referenceEquals(x.dataset.subRpt, "true");
                });
                for (var i = 0; subRowIndex >= 0 && i < subRowIndex || subRowIndex <= 0 && i < template.length; i = (i + 1) | 0) {
                    template[System.Array.index(i, template)].innerHTML = Core.Extensions.Utils.FormatEntity(template[System.Array.index(i, template)].innerHTML, null, arrItem, Core.Extensions.Utils.EmptyFormat, Core.Extensions.Utils.EmptyFormat);
                    res.add(template[System.Array.index(i, template)]);
                }

                if (subRowIndex < 0) {
                    return res.ToArray();
                }
                var cloned = System.Linq.Enumerable.from(template, HTMLTableRowElement).skip(subRowIndex).ToArray(HTMLTableRowElement);
                var subGridRows = this.BindingSubGrid(cloned, arrItem);
                if (Core.Extensions.IEnumerableExtensions.HasElement(HTMLTableRowElement, subGridRows)) {
                    res.AddRange(subGridRows);
                }
                return res.ToArray();
            },
            BindingSubGrid: function (template, groupItem) {
                var arrayField = "SubRpt";
                for (var field in groupItem) if (groupItem[field] instanceof Array) arrayField = field;
                var cells = System.Linq.Enumerable.from(template, HTMLTableRowElement).selectMany(function (x) {
                        return x.cells;
                    }).select(function (x) {{ return Bridge.cast(x, HTMLElement); }});
                var firstRowIndex = Core.Extensions.IEnumerableExtensions.IndexOf(HTMLTableRowElement, template, function (x) {
                    var $t;
                    return Bridge.referenceEquals(x, (($t = cells.firstOrDefault(function (a) {
                                return System.String.contains(a.innerHTML,"{") && System.String.contains(x.innerHTML,"}");
                            }, null)) != null ? $t.parentElement : null));
                });
                var lastRowIndex = Core.Extensions.IEnumerableExtensions.IndexOf(HTMLTableRowElement, template, function (x) {
                    var $t;
                    return Bridge.referenceEquals(x, (($t = cells.lastOrDefault(function (a) {
                                return System.String.contains(a.innerHTML,"{") && System.String.contains(x.innerHTML,"}");
                            }, null)) != null ? $t.parentElement : null));
                });
                var subRptArr;
                if (!(((subRptArr = Bridge.as(groupItem[arrayField], System.Array.type(System.Object)))) != null)) {
                    return null;
                }
                var res = new (System.Collections.Generic.List$1(HTMLTableRowElement)).$ctor1(System.Linq.Enumerable.from(template, HTMLTableRowElement).take(firstRowIndex));
                for (var i = 0; i < subRptArr.length; i = (i + 1) | 0) {
                    var subTemplate = this.CloneRow(System.Linq.Enumerable.from(template, HTMLTableRowElement).skip(firstRowIndex).take(((((lastRowIndex - firstRowIndex) | 0) + 1) | 0)).ToArray(HTMLTableRowElement));
                    var formatted = this.BindingRowData(subTemplate, subRptArr[System.Array.index(i, subRptArr)]);
                    if (Core.Extensions.IEnumerableExtensions.HasElement(HTMLTableRowElement, formatted)) {
                        res.AddRange(formatted);
                    }
                }
                res.AddRange(System.Linq.Enumerable.from(template, HTMLTableRowElement).skip(((lastRowIndex + 1) | 0)));
                return res.ToArray();
            },
            CloneRow: function (templateRow) {
                var res = new (System.Collections.Generic.List$1(HTMLTableRowElement)).ctor();
                for (var i = 0; i < templateRow.length; i = (i + 1) | 0) {
                    res.add(Bridge.as(templateRow[System.Array.index(i, templateRow)].cloneNode(true), HTMLTableRowElement));
                }
                return res.ToArray();
            },
            LoadData: function () {
                var $t;
                if (this.Data != null) {
                    var res = this.ProcessData(this.Data);
                    return System.Threading.Tasks.Task.fromResult(res, System.Object);
                }
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                var fn = { };
                var isFn = Core.Extensions.Utils.IsFunction(this.GuiInfo.PreQuery, fn);
                var sql = ($t = new Core.ViewModels.SqlViewModel(), $t.ComId = this.GuiInfo.Id, $t.Params = isFn ? JSON.stringify(Bridge.unbox(fn.v.call(null, this))) : null, $t.ConnKey = this.ConnKey, $t);
                Core.Extensions.EventExt.Catch(Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), Core.Clients.Client.Instance.ComQuery(sql), Bridge.fn.bind(this, function (ds) {
                    this.Data = ds;
                    var res1 = this.ProcessData(this.Data);
                    tcs.trySetResult(res1);
                })), Bridge.fn.bind(this, function (e) {
                    this.ShowErrorMessage(e.Message);
                }));
                return tcs.task;
            },
            ProcessData: function (dataSet) {
                var res = { };
                var formatter = { };
                var hasSubRpt = false;
                for (var i = 0; i < dataSet.length; i++) {
                    for (var j = 0; j < dataSet[i].length; j++) {
                        for (var prop in dataSet[i][j]) {
                            if (typeof(dataSet[i][j][prop]) === 'string') {
                                dataSet[i][j][prop]=Core.Extensions.Utils.DecodeSpecialChar(dataSet[i][j][prop]);
                            }
                        }
                    }
                	            if (i == 0) {
                		            for (var field in dataSet[0][0]) {
                			            res[field] = dataSet[0][0][field];
                		            }
                	            }
                	            else {
                		            var ds = dataSet[i];
                		            var subRptField = [], groupField = [], subRptName;
                		            if (ds == null || ds.length == 0) continue;
                		            for (var field in ds[0]) if (field.indexOf('.') >= 0) subRptField.push(field); else groupField.push(field);
                		            if (subRptField.length > 0) {
                			            subRptName = subRptField[0].split('.')[0];
                			            var fieldMap = subRptField.map(x => { return { field: x.split('.').reverse()[0], fullField: x} });
                			            ds = System.Linq.Enumerable.from(ds)
                				            .groupBy(x => System.String.concat(groupField.map(g => x[g])))
                				            .select(x => { 
                					            var arr = x.ToArray();
                					            var first = arr[0];
                					            var children = arr.map(item => {
                                        var res = {}; 
                                        fieldMap.forEach(field => { res[field.field] = item[field.fullField]; delete item[field.fullField]; });
                                        return res;
                                    });
                					            first[subRptName] = children;
                					            return first;
                				            }).ToArray();
                		            }
                		            res['ds' + i] = ds;
                	            }
                }
                if (Core.Extensions.Utils.IsFunction(this.GuiInfo.FormatEntity, formatter)) {
                    return formatter.v.call(null, Bridge.unbox(res), this);
                }
                return res;
            },
            UpdateView: function (force, dirty, componentNames) {
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                this.Data = null;
                window.clearTimeout(this._updateViewAwaiter$1);
                this._updateViewAwaiter$1 = window.setTimeout(Bridge.fn.cacheBind(this, this.RenderInternal), 200);
            }
        }
    });

    Bridge.define("Core.Components.Rating", {
        inherits: [Core.Components.EditableComponent],
        fields: {
            InputList: null,
            _value: null
        },
        props: {
            Value: {
                get: function () {
                    return this._value;
                },
                set: function (value) {
                    if (System.Nullable.eq(this._value, value)) {
                        return;
                    }

                    this._value = value;
                    if (System.Nullable.hasValue(this._value)) {
                        this._value = System.Nullable.getValue(this._value);
                        this.SetSelected(value);
                    }

                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, Bridge.box(this._value, System.Int32, System.Nullable.toString, System.Nullable.getHashCode));
                    this.Dirty = true;
                }
            },
            Disabled: {
                get: function () {
                    return Bridge.ensureBaseProperty(this, "Disabled").$Core$Components$EditableComponent$Disabled;
                },
                set: function (value) {
                    Bridge.ensureBaseProperty(this, "Disabled").$Core$Components$EditableComponent$Disabled = value;
                    this.InputList.ForEach(function (x) {
                        x.disabled = value;
                    });
                }
            }
        },
        ctors: {
            init: function () {
                this.InputList = new (System.Collections.Generic.List$1(HTMLInputElement)).ctor();
            },
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }
                var $t;

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this.GuiInfo = ui || (function () {
                    throw new System.ArgumentNullException.$ctor1("ui");
                })();
                this.GuiInfo.Precision = ($t = this.GuiInfo.Precision, $t != null ? $t : 5);
                this.ParentElement = ele;
            }
        },
        methods: {
            SetSelected: function (value) {
                if (value == null || System.Nullable.lte(value, 0) || System.Nullable.gt(value, this.GuiInfo.Precision)) {
                    return;
                }
                this.InputList.getItem(((System.Nullable.getValue(this.GuiInfo.Precision) - System.Nullable.getValue(value)) | 0)).checked = true;
            },
            Render: function () {
                var $t;
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement).Div, "rate");
                this.Element = Core.MVVM.Html.Context;
                var radioGroup = (this.FieldName || "") + (this.GuiInfo.Id || "") + Bridge.getHashCode(this);
                for (var item = this.GuiInfo.Precision; System.Nullable.gte(item, 1); item = Bridge.Int.clip32(System.Nullable.sub(item, 1))) {
                    var radioId = System.String.format("{0}_{1}", radioGroup, Bridge.box(item, System.Int32, System.Nullable.toString, System.Nullable.getHashCode));
                    Core.MVVM.Html.Take(this.Element).Input.Attr$1("type", "radio").Id(radioId).Attr$1("name", radioGroup).Value(System.Nullable.toString(item, null)).Event$1("change", Bridge.fn.cacheBind(this, this.DispatchChange)).Style$1(this.GuiInfo.Style);
                    this.InputList.add(Core.MVVM.Html.Context);
                    Core.MVVM.Html.Take(this.Element).Label.Attr$1("for", radioId).Text(System.String.format("{0} stars", [Bridge.box(item, System.Int32, System.Nullable.toString, System.Nullable.getHashCode)]));
                }
                Core.MVVM.Html.Take(this.Element).End.Render();
                this._value = Bridge.unbox(Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName));
                this.SetSelected(this._value);
                !Bridge.staticEquals(($t = this.DOMContentLoaded), null) ? $t() : null;
            },
            DispatchChange: function (e) {
                var $t;
                if (this.Disabled) {
                    return;
                }

                if (Core.Extensions.IEnumerableExtensions.Nothing(HTMLInputElement, this.InputList)) {
                    return;
                }

                var check = System.Linq.Enumerable.from(this.InputList, HTMLInputElement).firstOrDefault(function (x) {
                        return x.checked;
                    }, null);
                var oldVal = this.Value;
                this.Value = System.Int32.parse(check.value);
                Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, Bridge.box(this._value, System.Int32, System.Nullable.toString, System.Nullable.getHashCode));
                if (!Bridge.staticEquals(this.UserInput, null)) {
                    this.UserInput(($t = new Core.MVVM.ObservableArgs(), $t.NewData = Bridge.box(this.Value, System.Int32, System.Nullable.toString, System.Nullable.getHashCode), $t.OldData = Bridge.box(oldVal, System.Int32, System.Nullable.toString, System.Nullable.getHashCode), $t));
                }
                System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "click", [this.Entity]);
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                }));
            },
            UpdateView: function (force, dirty, componentNames) {
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                this.Value = Bridge.unbox(Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName));
            },
            GetValueText: function () {
                return this._value == null ? "Kh\u00f4ng \u0111\u00e1nh gi\u00e1" : System.Nullable.toString(this._value, null) + " sao";
            },
            ValidateAsync: function () {
                this.ValidationResult.clear();
                if (this.Value == null) {
                    return System.Threading.Tasks.Task.fromResult(false, System.Boolean);
                }
                var isValid = System.Nullable.hasValue(this.Value) && this.ValidateRequired(System.Int32, System.Nullable.getValue(this.Value));
                return System.Threading.Tasks.Task.fromResult(isValid, System.Boolean);
            }
        }
    });

    Bridge.define("Core.Components.RichTextBox", {
        inherits: [Core.Components.EditableComponent],
        fields: {
            _textArea: null,
            editor: null
        },
        ctors: {
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.EditableComponent.ctor.call(this, ui);
                this._textArea = Bridge.as(ele, HTMLTextAreaElement);
            }
        },
        methods: {
            Render: function () {
                if (System.Nullable.lte(this.GuiInfo.Row, 0)) {
                    this.GuiInfo.Row = 1;
                }
                if (this._textArea == null) {
                    this._textArea = Bridge.as(Core.MVVM.Html.Take(this.ParentElement).TextArea.Id("RE_" + (Core.Structs.Uuid7.Id25() || "")).GetContext(), HTMLTextAreaElement);
                }
                System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Clients.Client.LoadScript("https://support.pavietnam.vn/js/tinymce/tinymce.min.js?v=1.9.84");
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            var self = this;
                                            tinymce.init({
                                                selector: '#' + this._textArea.id,
                                                menubar: 'file edit view insert format tools table tc help',
                                                plugins: 'print preview code powerpaste casechange importcss tinydrive searchreplace autolink autosave save directionality advcode visualblocks visualchars fullscreen image link media mediaembed template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists checklist wordcount tinymcespellchecker a11ychecker imagetools textpattern noneditable help formatpainter permanentpen pageembed charmap tinycomments mentions quickbars linkchecker emoticons advtable export',
                                                toolbar: 'undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist checklist | forecolor backcolor anchor link media image table | hr code removeformat | fullscreen | casechange permanentpen formatpainter | pagebreak | charmap emoticons | preview save print | insertfile pageembed template | a11ycheck ltr rtl | showcomments addcomment',
                                                fontsize_formats: '8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 17pt 18pt 24pt 36pt 48pt',
                                                images_upload_handler: self.ImageUploadHandler,
                                                setup: function(editor) {
                                                    self.editor = editor;
                                                    editor.on('init', function() {
                                                        editor.setContent(self.Entity[self.FieldName] || '');
                                                    });
                                                    editor.on('input', function(e) {
                                                        self.Entity[self.FieldName] = editor.getContent();
                                                        self.Dirty = true;
                                                    });
                                                }
                                            });
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                }));
            },
            ImageUploadHandler: function (fileWrapper, success) {
                var file = Bridge.unbox(fileWrapper.blob)();
                var reader = new FileReader();
                reader.onload = Bridge.fn.combine(reader.onload, Bridge.fn.bind(this, function (e) {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        uploader, 
                        path, 
                        content, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        uploader = new Core.Components.Image(new Core.Models.Component());
                                        $task1 = uploader.UploadBase64Image(Bridge.toString(e.target.result), file.name);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        path = $taskResult1;
                                        if (!Bridge.staticEquals(success, null)) {
                                            success(path);
                                            content = null;
                                            content = this.editor.setContent(text);
                                            Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, content);
                                        }
                                        return;
                                    }
                                    default: {
                                        return;
                                    }
                                }
                            }
                        }, arguments);

                    $asyncBody();
                }));
                reader.readAsDataURL(file);
            },
            UpdateView: function (force, dirty, componentNames) {
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                var text = Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName);
                this.editor.setContent(text || '');
            }
        }
    });

    Bridge.define("Core.ViewModels.SecurityVM", {
        inherits: [Core.Models.FeaturePolicy],
        props: {
            AllPermission: false,
            RecordIds: null,
            StrRecordIds: {
                get: function () {
                    return Core.Extensions.IEnumerableExtensions.Combine(System.String, System.Linq.Enumerable.from(this.RecordIds, System.String).select(function (x) {
                            return System.String.format("\"{0}\"", [x]);
                        }));
                }
            },
            FeaturePolicy: null
        }
    });

    Bridge.define("Core.ViewModels.UserProfileVM", {
        inherits: [Core.Models.User],
        props: {
            OldPassword: null,
            NewPassword: null,
            ConfirmedPassword: null
        }
    });

    Bridge.define("Core.Components.Forms.TabEditor", {
        inherits: [Core.Components.Forms.EditForm],
        statics: {
            fields: {
                ActiveClass: null,
                TabContainer: null,
                Tabs: null
            },
            props: {
                ActiveTab: {
                    get: function () {
                        return System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs, Core.Components.Forms.TabEditor).firstOrDefault(function (x) {
                                return x.Show;
                            }, null);
                    }
                },
                ShowTabText: false
            },
            ctors: {
                init: function () {
                    this.ActiveClass = "active";
                    this.TabContainer = document.getElementById("tab-content");
                    this.Tabs = new (System.Collections.Generic.List$1(Core.Components.Forms.TabEditor)).ctor();
                }
            },
            methods: {
                FindTab: function (id) {
                    return System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs, Core.Components.Forms.TabEditor).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.Id, id);
                        }, null);
                }
            }
        },
        fields: {
            _backdrop: null,
            _backdropGridView: null,
            _tab: null,
            DataSearchEntry: null,
            _li: null,
            _hotKeyComponents: null
        },
        props: {
            Popup: false,
            ChildForm: false,
            TabTitle: {
                get: function () {
                    var $t, $t1;
                    return ($t = (($t1 = this.Feature) != null ? $t1.Label : null), $t != null ? $t : this.Title);
                }
            },
            Show: {
                get: function () {
                    return Bridge.ensureBaseProperty(this, "Show").$Core$Components$EditableComponent$Show;
                },
                set: function (value) {
                    Bridge.ensureBaseProperty(this, "Show").$Core$Components$EditableComponent$Show = value;
                    if (this._li == null) {
                        return;
                    }

                    if (value) {
                        Core.Extensions.HtmlElementExtension.AddClass(this._li, Core.Components.Forms.TabEditor.ActiveClass);
                        Core.Extensions.HtmlElementExtension.AddClass(this._li.querySelector(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.a)), Core.Components.Forms.TabEditor.ActiveClass);
                    } else {
                        Core.Extensions.HtmlElementExtension.RemoveClass(this._li, Core.Components.Forms.TabEditor.ActiveClass);
                        Core.Extensions.HtmlElementExtension.RemoveClass(this._li.querySelector(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.a)), Core.Components.Forms.TabEditor.ActiveClass);
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.DataSearchEntry = new (System.Collections.Generic.Dictionary$2(System.String,System.Collections.Generic.List$1(System.Object))).ctor();
            },
            ctor: function (entity) {
                if (entity === void 0) { entity = null; }

                this.$initialize();
                Core.Components.Forms.EditForm.ctor.call(this, entity);
                this.PopulateDirty = false;
                this.ShouldLoadEntity = true;
            }
        },
        methods: {
            Render: function () {
                var $t;
                if (this.ParentElement == null && !this.ChildForm) {
                    this.ParentElement = (($t = this.TabEditor) != null ? $t.Element : null) || Core.Components.Forms.TabEditor.TabContainer;
                }
                if (this.Popup) {
                    this.RenderPopup();
                } else {
                    this.RenderTab();
                }
                this.Focus();
            },
            RenderTab: function () {
                if (this.ChildForm) {
                    Core.MVVM.Html.Take(this.ParentElement).Div.Render();
                    this.Element = Core.MVVM.Html.Context;
                    Core.Components.Forms.EditForm.prototype.Render.call(this);
                    return;
                }
                var html = Core.MVVM.Html.Take$1("#tabs");
                Core.Components.Renderer.ClassName(Core.Components.Renderer.Title(Core.Components.Renderer.ClassName(html.Li, "nav-item"), this.TabTitle).A, "nav-link pl-lg-2 pr-lg-2 pl-xl-3 pr-xl-3").Event("click", Bridge.fn.cacheBind(this, this.Focus)).Event$1("mouseup", Bridge.fn.cacheBind(this, this.Close));
                if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.Icon)) {
                    Core.Components.Renderer.Icon(html, this.Icon).End.Render();
                }
                Core.Components.Renderer.Icon(html, "fa fal fa-compress-wide").Event$1("click", Bridge.fn.bind(this, function (e) {
                    this.FullScreen();
                })).End.Render();
                Core.Components.Renderer.Icon(html, "fa fa-times").Event$1("click", Bridge.fn.bind(this, function (e) {
                    e.stopPropagation();
                    this.DirtyCheckAndCancel();
                })).End.Render();
                if (Core.Components.Forms.TabEditor.ShowTabText) {
                    Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(html.Span, "title"), this.TabTitle).End.Render();
                }

                this._li = Core.MVVM.Html.Context.parentElement;
                this.IconElement = this._li.firstElementChild;
                Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(Core.Components.Forms.TabEditor.TabContainer), -1).Trigger("focus").Div.Event$1("keydown", Bridge.fn.cacheBind(this, this.HotKeyHandler)).Render();
                this.Element = Core.MVVM.Html.Context;
                this.ParentElement = Core.Components.Forms.TabEditor.TabContainer;
                Core.Components.Forms.TabEditor.Tabs.add(this);
                var tabIds = System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs, Core.Components.Forms.TabEditor).select(function (x) {
                        return x.Name;
                    }).toList(System.String);
                window.localStorage.setItem("tabs", Core.Extensions.IEnumerableExtensions.Combine(System.String, tabIds));
                Core.Components.Forms.EditForm.prototype.Render.call(this);
            },
            FullScreen: function () {
                var elem = this.Element;
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
            },
            RenderPopup: function () {
                var $t, $t1;
                if (Bridge.is(this.Parent, Core.Components.GridView)) {
                    Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement || (($t = this.Parent) != null ? $t.Element : null) || Core.Components.Forms.TabEditor.TabContainer).Div, "backdrop-gridview"), -1).Trigger("focus").Event$1("keydown", Bridge.fn.cacheBind(this, this.HotKeyHandler));
                    this._backdropGridView = Core.MVVM.Html.Context;
                    Core.Components.Renderer.IconForSpan(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "popup-content").Div, "popup-title").Span, this.Icon);
                    this.IconElement = Core.MVVM.Html.Context;
                    Core.Components.Renderer.IText(Core.MVVM.Html.Instance.End.Span, this.Title);
                    this.TitleElement = Core.MVVM.Html.Context;
                    Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div, "icon-box").Span, "fa fa-times").Event("click", Bridge.fn.cacheBind(this, this.Dispose)).EndOf$1(".popup-title").Div, "popup-body");
                    this.Element = Core.MVVM.Html.Context;
                    Core.Components.Forms.EditForm.prototype.Render.call(this);
                    if (Core.Extensions.HtmlElementExtension.OutOfViewport(this._backdropGridView).Top) {
                        this._backdropGridView.scrollIntoView(true);
                    }
                } else {
                    Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement || (($t1 = this.Parent) != null ? $t1.Element : null) || Core.Components.Forms.TabEditor.TabContainer).Div, "backdrop"), -1).Trigger("focus").Event$1("keydown", Bridge.fn.cacheBind(this, this.HotKeyHandler));
                    this._backdrop = Core.MVVM.Html.Context;
                    Core.Components.Renderer.IconForSpan(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "popup-content").Div, "popup-title").Span, this.Icon);
                    this.IconElement = Core.MVVM.Html.Context;
                    Core.Components.Renderer.IText(Core.MVVM.Html.Instance.End.Span, this.Title);
                    this.TitleElement = Core.MVVM.Html.Context;
                    Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div, "icon-box").Span, "fa fa-times").Event("click", Bridge.fn.cacheBind(this, this.Dispose)).EndOf$1(".popup-title").Div, "popup-body");
                    this.Element = Core.MVVM.Html.Context;
                    Core.Components.Forms.EditForm.prototype.Render.call(this);
                    if (Core.Extensions.HtmlElementExtension.OutOfViewport(this._backdrop).Top) {
                        this._backdrop.scrollIntoView(true);
                    }
                }
            },
            HotKeyHandler: function (e) {
                var $t;
                if (e.keyCode == null) {
                    return;
                }

                var keyCode = Core.Extensions.EventExt.KeyCodeEnum(e);
                if (System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.F6)) {
                    var gridView = System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.GridView, this), Core.Components.GridView).firstOrDefault(null, null);
                    if (gridView != null && !System.Linq.Enumerable.from(gridView.AllListViewItem, Core.Components.ListViewItem).any(function (x) {
                            return x.Selected;
                        })) {
                        if (System.Linq.Enumerable.from(gridView.AllListViewItem, Core.Components.ListViewItem).any()) {
                            System.Linq.Enumerable.from(gridView.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(null, null).Focus();
                        } else {
                            gridView.ListViewSearch.Focus();
                        }
                    }
                    return;
                }
                if (Core.Extensions.EventExt.AltKey(e) && System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.GraveAccent)) {
                    if (Core.Components.Forms.TabEditor.Tabs.Count <= 1) {
                        return;
                    }
                    var index;
                    index = Core.Components.Forms.TabEditor.Tabs.indexOf(this);
                    if (index >= ((Core.Components.Forms.TabEditor.Tabs.Count - 1) | 0)) {
                        index = 0;
                    } else {
                        index = (index + 1) | 0;
                    }
                    if (index < 0 || index > Core.Components.Forms.TabEditor.Tabs.Count) {
                        return;
                    }

                    ($t = System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs, Core.Components.Forms.TabEditor).elementAt(index)) != null ? $t.Focus() : null;
                }
                var shiftKey = Core.Extensions.EventExt.ShiftKey(e);
                var ctrlKey = Core.Extensions.EventExt.CtrlOrMetaKey(e);
                var altKey = Core.Extensions.EventExt.AltKey(e);
                var defaultKeys = this.DefaultHotKeys(keyCode, shiftKey, ctrlKey, altKey);
                if (defaultKeys) {
                    e.preventDefault();
                    e.stopPropagation();
                    return;
                }
                if (System.Nullable.gte(keyCode, Core.Enums.KeyCodeEnum.Shift) && System.Nullable.lte(keyCode, Core.Enums.KeyCodeEnum.Alt)) {
                    return;
                }

                this.TriggerMatchHotKey(e, keyCode, shiftKey, ctrlKey, altKey);
            },
            DisposeTabView: function () {
                Core.Extensions.HtmlElementExtension.Hide(this._tab);
            },
            TriggerMatchHotKey: function (e, keyCode, shiftKey, ctrlKey, altKey) {
                var $t, $t1;
                if (keyCode == null) {
                    return;
                }
                var patternList = new (System.Collections.Generic.List$1(Core.Enums.KeyCodeEnum)).ctor();
                if (shiftKey) {
                    patternList.add(Core.Enums.KeyCodeEnum.Shift);
                }

                if (ctrlKey) {
                    patternList.add(Core.Enums.KeyCodeEnum.Ctrl);
                }

                if (altKey) {
                    patternList.add(Core.Enums.KeyCodeEnum.Alt);
                }

                if (System.Nullable.lt(keyCode, Core.Enums.KeyCodeEnum.Shift)) {
                    patternList.insert(0, System.Nullable.getValue(keyCode));
                } else if (System.Nullable.gt(keyCode, Core.Enums.KeyCodeEnum.Alt)) {
                    patternList.add(System.Nullable.getValue(keyCode));
                }

                this._hotKeyComponents = this._hotKeyComponents || System.Linq.Enumerable.from(this.FilterChildren$1(function (x) {
                    return Bridge.is(x, Core.Components.Button) && !Core.Extensions.StringExt.IsNullOrWhiteSpace(x.GuiInfo.HotKey);
                })).select(function (x) { return Bridge.cast(x, Core.Components.Button); }).toList(Core.Components.Button);
                $t = Bridge.getEnumerator(this._hotKeyComponents);
                try {
                    while ($t.moveNext()) {
                        var com = $t.Current;
                        var parts = com.GuiInfo.HotKey.split(",");
                        if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, parts)) {
                            continue;
                        }

                        var lastPart = System.Linq.Enumerable.from(parts, System.String).lastOrDefault(null, null);
                        var configKeys = System.Linq.Enumerable.from(lastPart.split("-"), System.String).select(function (x) {
                                var key = { v : new Core.Enums.KeyCodeEnum() };
                                var parsed = System.Enum.tryParse(Core.Enums.KeyCodeEnum, x, key);
                                return parsed ? Bridge.cast(key.v, System.Int32, true) : null;
                            }).where(function (x) {
                            return x != null;
                        }).select(function (x) {{ return Bridge.cast(x, Core.Enums.KeyCodeEnum); }}).orderBy(function (x) {
                            return x;
                        });
                        var isMatch = System.Linq.Enumerable.from(patternList, Core.Enums.KeyCodeEnum).sequenceEqual(configKeys);
                        if (!isMatch) {
                            continue;
                        }

                        e.preventDefault();
                        e.stopPropagation();
                        ($t1 = com.Element) != null ? $t1.click() : null;
                        return;
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            DefaultHotKeys: function (keyCode, shiftKey, ctrlKey, altKey) {
                var $t;
                if (keyCode == null) {
                    return false;
                }
                if (System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.Escape) && !shiftKey && !ctrlKey && !altKey) {
                    this.DirtyCheckAndCancel();
                    return true;
                } else if (ctrlKey && altKey && (System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.LeftArrow) || System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.RightArrow))) {
                    var index;
                    index = Core.Components.Forms.TabEditor.Tabs.indexOf(this);
                    if (System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.LeftArrow)) {
                        if (index === 0) {
                            index = (Core.Components.Forms.TabEditor.Tabs.Count - 1) | 0;
                        } else {
                            index = (index - 1) | 0;
                        }
                    } else {
                        if (index >= ((Core.Components.Forms.TabEditor.Tabs.Count - 1) | 0)) {
                            index = 0;
                        } else {
                            index = (index + 1) | 0;
                        }
                    }
                    if (index < 0 || index > Core.Components.Forms.TabEditor.Tabs.Count) {
                        return false;
                    }

                    ($t = System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs, Core.Components.Forms.TabEditor).elementAt(index)) != null ? $t.Focus() : null;
                    return true;
                } else if (ctrlKey && shiftKey && System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.F)) {
                    // trigger search gridview
                    var listView = System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.ListView, this), Core.Components.ListView).firstOrDefault(null, null);
                    if (listView == null || !listView.GuiInfo.CanSearch) {
                        return true;
                    }

                    listView.ListViewSearch.AdvancedSearch(null);
                    return true;
                }
                return false;
            },
            Focus: function () {
                var $t, $t1;
                if (!this.Popup && !this.ChildForm) {
                    Core.Components.Forms.TabEditor.Tabs.ForEach(function (x) {
                        x.Show = false;
                    });
                }

                if (!this.ChildForm) {
                    this.Show = true;
                }
                if (this.Feature != null && this.Feature.Name != null && !this.Popup && !this.ChildForm) {
                    var ns = (document).head.children.baseUri;
                    var newPath = System.IO.Path.Combine([(ns != null ? ns.content : null) || window.location.origin, (System.String.replaceAll(this.Feature.Name, " ", "-") || "") + (System.String.format("{0}", [((($t = this.Entity) != null ? $t[Core.Components.EditableComponent.IdField] : null) == null ? "" : System.String.format("?Id={0}", [this.Entity[Core.Components.EditableComponent.IdField]]))]) || "")]);
                    window.history.pushState(null, Core.Components.LangSelect.Get(this.TabTitle), newPath);
                }
                document.title = Core.Components.LangSelect.Get(this.TabTitle);
                ($t1 = System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.EditableComponent, this, function (x) {
                        var $t2;
                        return System.Nullable.eq((x != null && ($t2 = x.GuiInfo) != null ? $t2.Focus : null), true);
                    }), Core.Components.EditableComponent).firstOrDefault(null, null)) != null ? $t1.Focus() : null;
            },
            Close: function (e) {
                var $t, $t1;
                var intWhich = { };
                System.Int32.tryParse(($t = e.which) != null ? Bridge.toString($t) : null, intWhich);
                var intButton = { };
                System.Int32.tryParse(($t1 = e.button) != null ? Bridge.toString($t1) : null, intButton);
                if (intWhich.v === 2 || intButton.v === 1) {
                    e.preventDefault();
                    this.DirtyCheckAndCancel();
                }
            },
            Dispose: function () {
                if (this.ParentForm != null) {
                    this.ParentForm.Focus();
                } else if (this.Parent != null) {
                    this.Parent.Focus();
                } else if (this.ParentElement != null) {
                    this.ParentElement.focus();
                }

                if (!this.Popup && this._li != null) {
                    this._li.remove();
                    this.DisposeTab();
                } else {
                }
                var firstGridView = System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.GridView, this.Parent), Core.Components.GridView).firstOrDefault(null, null);
                if (firstGridView != null && firstGridView.LastListViewItem != null && firstGridView.LastElementFocus != null) {
                    firstGridView.LastListViewItem.Focused = true;
                    firstGridView.LastElementFocus.focus();
                }
                Core.Components.Forms.EditForm.prototype.Dispose.call(this);
            },
            DisposeTab: function () {
                var $t;
                if (this.ParentForm == null) {
                    ($t = System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs, Core.Components.Forms.TabEditor).lastOrDefault(Bridge.fn.bind(this, function (x) {
                                return !Bridge.referenceEquals(x, this);
                            }), null)) != null ? $t.Focus() : null;
                } else {
                    this.ParentForm.Focus();
                    this.ParentForm = null;
                }
                Core.Components.Forms.TabEditor.Tabs.remove(this);
                var tabIds = System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs, Core.Components.Forms.TabEditor).select(function (x) {
                        return x.Name;
                    }).toList(System.String);
                window.localStorage.setItem("tabs", Core.Extensions.IEnumerableExtensions.Combine(System.String, tabIds));
            },
            RemoveDOM: function () {
                var $t;
                ($t = this.Element) != null ? $t.remove() : null;
                this._li != null ? this._li.remove() : null;
                this._backdrop != null ? this._backdrop.remove() : null;
                this._backdropGridView != null ? this._backdropGridView.remove() : null;
            }
        }
    });

    Bridge.define("Core.Components.ButtonPdf", {
        inherits: [Core.Components.Button],
        props: {
            _preview: null,
            _pdfReport: null
        },
        ctors: {
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.Button.ctor.call(this, ui, ele);
            }
        },
        methods: {
            DispatchClick: function () {
                System.Threading.Tasks.Task.run(Bridge.fn.cacheBind(this, this.DispatchClickAsync));
            },
            DispatchClickAsync: function () {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $task2, 
                    $task3, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    body, 
                    $t, 
                    parentGridView, 
                    selectedData, 
                    selectedRow, 
                    item, 
                    js, 
                    $t1, 
                    printWindow, 
                    parentGridView1, 
                    selectedData1, 
                    selectedRow1, 
                    item1, 
                    js1, 
                    $t2, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18], $step);
                                switch ($step) {
                                    case 0: {
                                        $task1 = Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "click", [this.Entity, this.GuiInfo]);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        Core.Components.Renderer.Escape(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div, "backdrop").Style$1("align-items: center;"), Bridge.fn.bind(this, function (e) {
                                            this.Dispose();
                                        }));
                                        this._preview = Core.MVVM.Html.Context;
                                        Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "popup-content confirm-dialog").Style$1("top: 0;").Div, "popup-title").InnerHTML(this.GuiInfo.PlainText).Div, "icon-box").Span, "fa fa-times").Event("click", Bridge.fn.cacheBind(this, this.ClosePreview)).EndOf$1(".popup-title").Div, "popup-body scroll-content");
                                        if (System.Nullable.eq(this.GuiInfo.Precision, 2)) {
                                            Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "container-rpt");
                                            Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "menuBar").Div, "printBtn").Button, "btn btn-success mr-1 fa fa-print").Event("click", Bridge.fn.bind(this, function () {
                                                this.EditForm.PrintSection(Bridge.as(this._preview.querySelector(".print-group"), HTMLElement), true, void 0, true, this.GuiInfo);
                                            })).End.Button, "btn btn-success mr-1").Text("a4").Event("click", Bridge.fn.bind(this, function () {
                                                this.GeneratePdf("a4");
                                            })).End.Button, "btn btn-success mr-1").Text("a5").Event("click", Bridge.fn.bind(this, function () {
                                                this.GeneratePdf("a5");
                                            })).End.Render();
                                            Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.EndOf$1(".menuBar").Div, "print-group");
                                        }
                                        body = Core.MVVM.Html.Context;
                                        this._pdfReport = ($t = new Core.Components.PdfReport(this.GuiInfo), $t.ParentElement = body, $t);
                                        if (this.GuiInfo.FocusSearch) {
                                            $step = 2;
                                            continue;
                                        } else  {
                                            $step = 10;
                                            continue;
                                        }
                                    }
                                    case 2: {
                                        if (System.Nullable.eq(this.GuiInfo.Precision, 2)) {
                                            $step = 3;
                                            continue;
                                        } else  {
                                            $step = 8;
                                            continue;
                                        }
                                    }
                                    case 3: {
                                        parentGridView = System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.GridView, this.TabEditor), Core.Components.GridView).firstOrDefault(null, null);
                                        selectedData = parentGridView.CacheData;
                                        if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, selectedData)) {
                                            selectedData = parentGridView.RowData.Data;
                                        }
                                        selectedRow = System.Linq.Enumerable.from(selectedData, System.Object).where(function (x) {
                                            return parentGridView.SelectedIds.contains(Bridge.toString(x.Id));
                                        }).toList(System.Object);
                                        $t = Bridge.getEnumerator(selectedRow);
                                        $step = 4;
                                        continue;
                                    }
                                    case 4: {
                                        if ($t.moveNext()) {
                                            item = $t.Current;
                                            $step = 5;
                                            continue;
                                        }
                                        $step = 7;
                                        continue;
                                    }
                                    case 5: {
                                        $task2 = System.Threading.Tasks.Task.delay(200);
                                        $step = 6;
                                        if ($task2.isCompleted()) {
                                            continue;
                                        }
                                        $task2.continue($asyncBody);
                                        return;
                                    }
                                    case 6: {
                                        $task2.getAwaitedResult();
                                        js = ($t1 = new Core.Components.PdfReport(this.GuiInfo), $t1.ParentElement = body, $t1.Selected = item, $t1);
                                        this.Parent.AddChild(js);
                                        $step = 4;
                                        continue;
                                    }
                                    case 7: {
                                        window.setTimeout(Bridge.fn.bind(this, function () {
                                            var ele = System.Linq.Enumerable.from(this._preview.querySelectorAll(".print-group")).select(function (x) { return Bridge.cast(x, HTMLElement); }).toList(HTMLElement);
                                            var printWindow = window.open("", "_blank");
                                            printWindow.document.close();
                                            printWindow.document.body.innerHTML = Core.Extensions.IEnumerableExtensions.Combine(System.String, System.Linq.Enumerable.from(ele, HTMLElement).select(function (x) {
                                                return x.outerHTML;
                                            }), "</br>");
                                            printWindow.print();
                                            printWindow.addEventListener("mousemove", function (e) {
                                                printWindow.close();
                                            });
                                            printWindow.addEventListener("click", function (e) {
                                                printWindow.close();
                                            });
                                            printWindow.addEventListener("afterprint", Bridge.fn.bind(this, function (e) {
                                                var $step = 0,
                                                    $task1, 
                                                    $taskResult1, 
                                                    $jumpFromFinally, 
                                                    $asyncBody = Bridge.fn.bind(this, function () {
                                                        for (;;) {
                                                            $step = System.Array.min([0,1], $step);
                                                            switch ($step) {
                                                                case 0: {
                                                                    $task1 = Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "afterprint", [selectedRow]);
                                                                    $step = 1;
                                                                    if ($task1.isCompleted()) {
                                                                        continue;
                                                                    }
                                                                    $task1.continue($asyncBody);
                                                                    return;
                                                                }
                                                                case 1: {
                                                                    $taskResult1 = $task1.getAwaitedResult();
                                                                    return;
                                                                }
                                                                default: {
                                                                    return;
                                                                }
                                                            }
                                                        }
                                                    }, arguments);

                                                $asyncBody();
                                            }));
                                            printWindow.addEventListener("keyup", function (e) {
                                                printWindow.close();
                                            });
                                            if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.Style)) {
                                                var style = Bridge.as(document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.style)), HTMLStyleElement);
                                                style.appendChild(document.createTextNode(this.GuiInfo.Style));
                                                printWindow.document.head.appendChild(style);
                                            }
                                            this._pdfReport.Dispose();
                                            this._preview.remove();
                                        }), 2000);
                                        $step = 9;
                                        continue;
                                    }
                                    case 8: {
                                        this.Parent.AddChild(this._pdfReport);
                                        printWindow = window.open("", "_blank");
                                        printWindow.document.close();
                                        window.setTimeout(Bridge.fn.bind(this, function () {
                                            printWindow.document.body.innerHTML = this._pdfReport.Element.querySelector(".printable").outerHTML;
                                            printWindow.print();
                                            printWindow.addEventListener("mousemove", function (e) {
                                                printWindow.close();
                                            });
                                            printWindow.addEventListener("click", function (e) {
                                                printWindow.close();
                                            });
                                            printWindow.addEventListener("keyup", function (e) {
                                                printWindow.close();
                                            });
                                            printWindow.addEventListener("afterprint", Bridge.fn.bind(this, function (e) {
                                                var $step = 0,
                                                    $task1, 
                                                    $taskResult1, 
                                                    $jumpFromFinally, 
                                                    $asyncBody = Bridge.fn.bind(this, function () {
                                                        for (;;) {
                                                            $step = System.Array.min([0,1], $step);
                                                            switch ($step) {
                                                                case 0: {
                                                                    $task1 = Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "afterprint", [this.EditForm]);
                                                                    $step = 1;
                                                                    if ($task1.isCompleted()) {
                                                                        continue;
                                                                    }
                                                                    $task1.continue($asyncBody);
                                                                    return;
                                                                }
                                                                case 1: {
                                                                    $taskResult1 = $task1.getAwaitedResult();
                                                                    return;
                                                                }
                                                                default: {
                                                                    return;
                                                                }
                                                            }
                                                        }
                                                    }, arguments);

                                                $asyncBody();
                                            }));
                                            if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.Style)) {
                                                var style = Bridge.as(document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.style)), HTMLStyleElement);
                                                style.appendChild(document.createTextNode(this.GuiInfo.Style));
                                                printWindow.document.head.appendChild(style);
                                            }
                                            this._pdfReport.Dispose();
                                            this._preview.remove();
                                        }), 2000);
                                        $step = 9;
                                        continue;
                                    }
                                    case 9: {
                                        $step = 18;
                                        continue;
                                    }
                                    case 10: {
                                        if (System.Nullable.eq(this.GuiInfo.Precision, 2)) {
                                            $step = 11;
                                            continue;
                                        } else  {
                                            $step = 16;
                                            continue;
                                        }
                                    }
                                    case 11: {
                                        parentGridView1 = System.Linq.Enumerable.from(Core.Components.Extensions.ComponentExt.FindActiveComponent(Core.Components.GridView, this.TabEditor), Core.Components.GridView).firstOrDefault(null, null);
                                        selectedData1 = parentGridView1.CacheData;
                                        if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, selectedData1)) {
                                            selectedData1 = parentGridView1.RowData.Data;
                                        }
                                        selectedRow1 = System.Linq.Enumerable.from(selectedData1, System.Object).where(function (x) {
                                            return parentGridView1.SelectedIds.contains(Bridge.toString(x.Id));
                                        }).toList(System.Object);
                                        $t1 = Bridge.getEnumerator(selectedRow1);
                                        $step = 12;
                                        continue;
                                    }
                                    case 12: {
                                        if ($t1.moveNext()) {
                                            item1 = $t1.Current;
                                            $step = 13;
                                            continue;
                                        }
                                        $step = 15;
                                        continue;
                                    }
                                    case 13: {
                                        $task3 = System.Threading.Tasks.Task.delay(200);
                                        $step = 14;
                                        if ($task3.isCompleted()) {
                                            continue;
                                        }
                                        $task3.continue($asyncBody);
                                        return;
                                    }
                                    case 14: {
                                        $task3.getAwaitedResult();
                                        js1 = ($t2 = new Core.Components.PdfReport(this.GuiInfo), $t2.ParentElement = body, $t2.Selected = item1, $t2);
                                        this.Parent.AddChild(js1);
                                        $step = 12;
                                        continue;
                                    }
                                    case 15: {
                                        $step = 17;
                                        continue;
                                    }
                                    case 16: {
                                        this.Parent.AddChild(this._pdfReport);
                                        $step = 17;
                                        continue;
                                    }

                                    case 18: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            GeneratePdf: function (format) {
                var task = Core.Clients.Client.LoadScript("https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js");
                Core.Clients.Client.ExecTaskNoResult(task, Bridge.fn.cacheBind(this, this.PdfLibLoaded));
            },
            PdfLibLoaded: function () {
                var element = Bridge.as(this._preview.querySelector(".print-group"), HTMLElement);
                var printEl = element;
                var first = Bridge.as(System.Linq.Enumerable.from(printEl.querySelectorAll(".printable"), Node).firstOrDefault(null, null), HTMLElement);
                first.style.pageBreakBefore = null;
                const openPdfInNewWindow = (pdf) => {
                const blob = pdf.output('blob');
                var isMobile = Window.Instance["Cordova"] != null;
                if (!isMobile)
                {
                    window.open(window.URL.createObjectURL(blob));
                    return;
                }
                var isAndroid = Window.Instance["device"]["platform"].ToString() == "Android";
                    if (isAndroid)
                    {
                        Window.Location.Href = window.URL.createObjectURL(blob);
                        return;
                    }
                    cordova.InAppBrowser.open(window.URL.createObjectURL(blob), "_system");
                };
                html2pdf(printEl, {
                    filename : this.GuiInfo.PlainText,
                    jsPDF: { format: format},
                    image: { type: 'jpeg', quality: 0.98 },
                    pdfCallback: openPdfInNewWindow,
                });

            },
            ClosePreview: function () {
                this._preview.remove();
            }
        }
    });

    Bridge.define("Core.Components.GridView", {
        inherits: [Core.Components.ListView],
        statics: {
            fields: {
                SummaryClass: null,
                CellCountNoSticky: 0,
                ToolbarColumn: null
            },
            ctors: {
                init: function () {
                    var $t;
                    this.SummaryClass = "summary";
                    this.CellCountNoSticky = 50;
                    this.ToolbarColumn = ($t = new Core.Models.Component(), $t.StatusBar = true, $t.ShortDesc = "", $t.Frozen = true, $t);
                }
            },
            methods: {
                SetSummaryHeaderText: function (sum, tr) {
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(sum.Summary)) {
                        return;
                    }

                    var cell = tr.cells[0];
                    cell.colSpan = (System.Nullable.getValue(sum.SummaryColSpan)) >>> 0;
                    cell.textContent = sum.Summary;
                    Core.Extensions.HtmlElementExtension.AddClass(cell, "summary-header");
                },
                ResetSummaryRow: function (tr, colSpan) {
                    var $t;
                    for (var i = 1; i < colSpan; i = (i + 1) | 0) {
                        ($t = tr.cells[0]) != null ? $t.remove() : null;
                    }
                    Core.Components.GridView.ClearSummaryContent(tr);
                },
                ClearSummaryContent: function (tr) {
                    var $t;
                    $t = Bridge.getEnumerator(tr.cells, "getEnumerator");
                    try {
                        while ($t.moveNext()) {
                            var c = $t.Current;
                            c.innerHTML = "";
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                }
            }
        },
        fields: {
            _summarys: null,
            LastThClick: null,
            LastNumClick: null,
            AutoFocus: false,
            LoadRerender: false,
            _waitingLoad: false,
            _renderPrepareCacheAwaiter: 0,
            _hasFirstLoad: false,
            _imeout: 0,
            awaiter1: 0,
            _renderIndexAwaiter: 0,
            _lastScrollTop: 0
        },
        props: {
            EmptyRowSection: null,
            DataTable: null
        },
        ctors: {
            init: function () {
                this._summarys = new (System.Collections.Generic.List$1(HTMLElement)).ctor();
                this.AutoFocus = false;
                this.LoadRerender = false;
                this._hasFirstLoad = false;
            },
            ctor: function (ui) {
                this.$initialize();
                Core.Components.ListView.ctor.call(this, ui);
                this.DOMContentLoaded = Bridge.fn.combine(this.DOMContentLoaded, Bridge.fn.cacheBind(this, this.DOMContentLoadedHandler));
            }
        },
        methods: {
            DOMContentLoadedHandler: function () {
                if (this.GuiInfo.IsSumary) {
                    this.AddSummaries();
                }
                this.PopulateFields$1();
            },
            PopulateFields$1: function () {
                if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.PopulateField)) {
                    var fields = this.GuiInfo.PopulateField.split(",");
                    if (fields.length > 0) {
                        this.EditForm.UpdateView$1(true, fields);
                    }
                }
            },
            Rerender: function () {
                var $t, $t1;
                this.LoadRerender = true;
                this.DisposeNoRecord();
                this.Editable = this.GuiInfo.CanAdd && System.Linq.Enumerable.from(this.Header, Core.Models.Component).any(function (x) {
                        return !x.Hidden && x.Editable;
                    });
                this.Header = System.Linq.Enumerable.from(this.Header, Core.Models.Component).where(function (x) {
                        return !x.Hidden;
                    }).toList(Core.Models.Component);
                this.RenderTableHeader(this.Header);
                if (this.Editable) {
                    this.AddNewEmptyRow();
                }
                this.RenderContent();
                this.StickyColumn(this);
                ($t = this.MainSection) != null && ($t1 = $t.Element) != null ? $t1.addEventListener("contextmenu", Bridge.fn.cacheBind(this, this.BodyContextMenuHandler)) : null;
                if (!this.Editable && Core.Extensions.IEnumerableExtensions.Nothing(System.Object, this.RowData.Data)) {
                    this.NoRecordFound();
                    return;
                }
                this.RenderIndex();
            },
            StickyColumn: function (rows, top) {
                var $t;
                if (top === void 0) { top = null; }
                var shouldStickEle = System.Array.init(["th", "td"], System.String);
                var frozen = ($t = Core.Components.EditableComponent, System.Linq.Enumerable.from(rows.FilterChildren(Core.Components.EditableComponent, function (x) {
                        return x.GuiInfo != null && x.GuiInfo.Frozen;
                    }, function (x) {
                        return Bridge.is(x, Core.Components.ListViewSearch);
                    }, void 0), $t).ToArray($t));
                frozen.forEach(function (x) {
                        var cell = x.Element;
                        var isCell = System.Array.contains(shouldStickEle, x.Element.tagName.toLowerCase(), System.String);
                        if (!isCell) {
                            cell = Core.Extensions.HtmlElementExtension.Closest(x.Element, "td");
                        }
                        if (Core.Extensions.StringExt.HasAnyChar(top)) {
                            Core.Components.Renderer.Sticky(Core.MVVM.Html.Take(cell), top, void 0);
                        } else {
                            Core.Components.Renderer.Sticky(Core.MVVM.Html.Take(cell), void 0, Bridge.toString((0)));
                        }
                    });
            },
            AddSections: function () {
                var $t, $t1;
                if ((($t = this.HeaderSection) != null ? $t.Element : null) != null) {
                    return;
                }
                var html = Core.MVVM.Html.Take(this.ParentElement);
                var id = "collapse" + (this.GuiInfo.Id || "");
                var idtb = "tb" + (this.GuiInfo.Id || "");
                if (this.GuiInfo.IsCollapsible) {
                    Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(html.Div, "card mb-0").Div, "card-header").H5, "mb-0").A, "btn btn-primary").DataAttr$1("toggle", "collapse").Href("#" + (id || "")).Attr$1("aria-expanded", "false").Attr$1("aria-controls", id).Text(this.GuiInfo.Label).EndOf$1(".card");
                }
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(html.Div.Event$1("keydown", Bridge.fn.bind(this, function (e) {
                    this.HotKeyF6Handler(e, Core.Extensions.EventExt.KeyCodeEnum(e));
                })), "grid-wrapper " + ((this.GuiInfo.IsCollapsible ? "collapse multi-collapse" : "") || "")).Id(id), this.Editable ? "editable" : "");
                this.Element = Core.MVVM.Html.Context;
                if (this.GuiInfo.CanSearch) {
                    Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "grid-toolbar search").End.Render();
                }
                this.ListViewSearch = ($t1 = new Core.Components.ListViewSearch(this.GuiInfo), $t1.Entity = new Core.Components.ListViewSearchVM(), $t1);
                if (System.Nullable.hasValue(this.GuiInfo.DefaultAddStart)) {
                    var pre = System.Convert.toDouble(Bridge.box(System.Nullable.getValue(this.GuiInfo.DefaultAddStart), System.Int32));
                    this.ListViewSearch.EntityVM.StartDate = System.DateTime.addDays(System.DateTime.getNow(), pre);
                }
                var lFrom = window.localStorage.getItem("FromDate" + (this.GuiInfo.Id || ""));
                if (lFrom != null) {
                    this.ListViewSearch.EntityVM.StartDate = System.DateTime.parse(Bridge.toString(lFrom));
                    if (System.DateTime.lt(this.ListViewSearch.EntityVM.StartDate, System.DateTime.addMonths(System.DateTime.getNow(), -2))) {
                        this.ListViewSearch.EntityVM.StartDate = System.DateTime.addMonths(System.DateTime.getNow(), -2);
                    }
                } else {
                    if (Bridge.referenceEquals(this.GuiInfo.ComponentType, "VirtualGrid") && this.GuiInfo.AddDate) {
                        this.ListViewSearch.EntityVM.StartDate = System.DateTime.addMonths(System.DateTime.getNow(), -2);
                    }
                }
                if (System.Nullable.hasValue(this.GuiInfo.DefaultAddEnd)) {
                    var pre1 = System.Convert.toDouble(Bridge.box(System.Nullable.getValue(this.GuiInfo.DefaultAddEnd), System.Int32));
                    this.ListViewSearch.EntityVM.EndDate = System.DateTime.addDays(System.DateTime.getNow(), pre1);
                }
                var lTo = window.localStorage.getItem("ToDate" + (this.GuiInfo.Id || ""));
                if (lTo != null) {
                    this.ListViewSearch.EntityVM.EndDate = System.DateTime.parse(Bridge.toString(lTo));
                }
                this.AddChild(this.ListViewSearch);
                this.DataTable = Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div, "table-wrapper").Table, "table").Id(idtb).GetContext();
                Core.Components.Renderer.ClassName(Core.Components.Renderer.TabIndex(Core.MVVM.Html.Instance.Thead, -1).End.TBody, "empty").End.TBody.End.TFooter.Render();

                this.FooterSection = ($t1 = new Core.Components.ListViewSection.ctor(Core.MVVM.Html.Context), $t1.ParentElement = this.DataTable, $t1);
                this.AddChild(this.FooterSection);

                this.MainSection = ($t1 = new Core.Components.ListViewSection.ctor(this.FooterSection.Element.previousElementSibling), $t1.ParentElement = this.DataTable, $t1);
                this.AddChild(this.MainSection);

                this.EmptyRowSection = ($t1 = new Core.Components.ListViewSection.ctor(this.MainSection.Element.previousElementSibling), $t1.ParentElement = this.DataTable, $t1);
                this.AddChild(this.EmptyRowSection);

                this.HeaderSection = ($t1 = new Core.Components.ListViewSection.ctor(this.EmptyRowSection.Element.previousElementSibling), $t1.ParentElement = this.DataTable, $t1);
                this.AddChild(this.HeaderSection);
                Core.MVVM.Html.Instance.EndOf$1(".table-wrapper");
                this.RenderPaginator();
            },
            SwapList: function (oldIndex, newIndex) {
                var item = this.Header.getItem(oldIndex);
                this.Header.removeAt(oldIndex);
                this.Header.insert(newIndex, item);
            },
            SwapHeader: function (oldIndex, newIndex) {
                var item = this.Header.getItem(oldIndex);
                this.Header.removeAt(oldIndex);
                this.Header.insert(newIndex, item);
            },
            ClickHeader: function (e, header) {
                var index = this.LastNumClick;
                var table = this.DataTable;
                if (this.LastNumClick != null) {
                    table.querySelectorAll('tr:not(.summary)').forEach(function(row) {
                        if(row.hasAttribute('virtualrow') || row.classList.contains('group-row')){
                            return;
                        }
                        const cells = [].slice.call(row.querySelectorAll('th, td'));
                        cells[index].style.removeProperty("background-color");
                        cells[index].style.removeProperty("color");
                    });
                }
                var th = Core.Extensions.HtmlElementExtension.Closest((Bridge.as(e.target, HTMLElement)), "th");
                var tr = th.parentElement.querySelectorAll("th");
                index = Core.Extensions.IEnumerableExtensions.FindItemAndIndex(Node, tr, function (x) {
                    return Bridge.referenceEquals(x, th);
                }).Item2;
                if (System.Nullable.lt(index, 0)) {
                    return;
                }
                this.LastThClick = th;
                this.LastNumClick = index;
                table.querySelectorAll('tr:not(.summary)').forEach(function(row) {
                    if(row.hasAttribute('virtualrow') || row.classList.contains('group-row')){
                        return;
                    }
                    const cells = [].slice.call(row.querySelectorAll('th, td'));
                    cells[index].style.backgroundColor= "#cbdcc2";
                    cells[index].style.color = "#000";
                });
            },
            FocusOutHeader: function (e, header) {
                var index = this.LastNumClick;
                var table = this.DataTable;
                if (this.LastNumClick != null) {
                    table.querySelectorAll('tr:not(.summary)').forEach(function(row) {
                        if(row.hasAttribute('virtualrow') || row.classList.contains('group-row')){
                            return;
                        }
                        const cells = [].slice.call(row.querySelectorAll('th, td'));
                        cells[index].style.removeProperty("background-color");
                        cells[index].style.removeProperty("color");
                    });
                }
            },
            ThHotKeyHandler: function (e, header) {
                if (this.GuiInfo.Focus) {
                    return;
                }
                var keyCode = Core.Extensions.EventExt.KeyCodeEnum(e);
                if (System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.RightArrow)) {
                    e.stopPropagation();
                    var th = Core.Extensions.HtmlElementExtension.Closest((Bridge.as(e.target, HTMLElement)), "th");
                    var tr = th.parentElement.querySelectorAll("th");
                    var index = Core.Extensions.IEnumerableExtensions.FindItemAndIndex(Node, tr, function (x) {
                        return Bridge.referenceEquals(x, th);
                    }).Item2;
                    th.parentElement.parentElement.parentElement.querySelectorAll('tr').forEach(function(row) {
                            if(row.hasAttribute('virtualrow') || row.classList.contains('group-row')){
                                return;
                            }
                            const cells = [].slice.call(row.querySelectorAll('th, td'));
                            if(cells[0].classList.contains('summary-header')){
                                return;
                            }
                            var draggingColumnIndex = index;
                            var endColumnIndex = index + 1;
                            draggingColumnIndex > endColumnIndex
                                ? cells[endColumnIndex].parentNode && cells[endColumnIndex].parentNode.insertBefore(
                                        cells[draggingColumnIndex],
                                        cells[endColumnIndex]
                                    )
                                : cells[endColumnIndex].parentNode && cells[endColumnIndex].parentNode.insertBefore(
                                        cells[draggingColumnIndex],
                                        cells[endColumnIndex].nextSibling
                                    );
                            cells[draggingColumnIndex].style.backgroundColor= "#cbdcc2";
                    });
                    this.SwapList(((index - 1) | 0), index);
                    this.SwapHeader(index, ((index + 1) | 0));
                    this.ResetOrder();
                    this.UpdateHeader();
                    th.focus();
                } else if (System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.LeftArrow)) {
                    e.stopPropagation();
                    var th1 = Core.Extensions.HtmlElementExtension.Closest((Bridge.as(e.target, HTMLElement)), "th");
                    var tr1 = th1.parentElement.querySelectorAll("th");
                    var index1 = Core.Extensions.IEnumerableExtensions.FindItemAndIndex(Node, tr1, function (x) {
                        return Bridge.referenceEquals(x, th1);
                    }).Item2;
                    th1.parentElement.parentElement.parentElement.querySelectorAll('tr').forEach(function(row) {
                            if(row.hasAttribute('virtualrow') || row.classList.contains('group-row')){
                                return;
                            }
                            const cells = [].slice.call(row.querySelectorAll('th, td'));
                            if(cells[0].classList.contains('summary-header')){
                                return;
                            }
                            var draggingColumnIndex = index1;
                            var endColumnIndex = index1 - 1;
                            draggingColumnIndex > endColumnIndex
                                ? cells[endColumnIndex].parentNode && cells[endColumnIndex].parentNode.insertBefore(
                                        cells[draggingColumnIndex],
                                        cells[endColumnIndex]
                                    )
                                : cells[endColumnIndex].parentNode && cells[endColumnIndex].parentNode.insertBefore(
                                        cells[draggingColumnIndex],
                                        cells[endColumnIndex].nextSibling
                                    );
                            cells[draggingColumnIndex].style.backgroundColor= "#cbdcc2";
                    });
                    this.SwapList(((index1 - 1) | 0), ((index1 - 2) | 0));
                    this.SwapHeader(index1, ((index1 - 1) | 0));
                    this.ResetOrder();
                    this.UpdateHeader();
                    th1.focus();
                }
            },
            FilterInSelected: function (e) {
                var $t;
                var hotKeyModel = Bridge.unbox(e);
                if (this._waitingLoad) {
                    window.clearTimeout(this._renderPrepareCacheAwaiter);
                }
                if (hotKeyModel.Operator == null) {
                    return;
                }
                var header = System.Linq.Enumerable.from(this.Header, Core.Models.Component).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.FieldName, hotKeyModel.FieldName);
                    }, null);
                var subFilter = "";
                var lastFilter = window.localStorage.getItem("LastSearch" + (this.GuiInfo.Id || "") + (header.Id || ""));
                if (lastFilter != null) {
                    subFilter = Bridge.toString(lastFilter);
                }
                var confirmDialog = ($t = new Core.Components.Forms.ConfirmDialog(), $t.Content = (System.String.format("Nh\u1eadp {0} c\u1ea7n t\u00ecm ", [header.ShortDesc]) || "") + (hotKeyModel.OperatorText || ""), $t.NeedAnswer = true, $t.MultipleLine = false, $t.ComType = Bridge.referenceEquals(header.ComponentType, "Datepicker") || Bridge.referenceEquals(header.ComponentType, "Number") ? header.ComponentType : "Textbox", $t.Precision = header.Precision, $t.PElement = this.MainSection.Element, $t);
                confirmDialog.YesConfirmed = Bridge.fn.combine(confirmDialog.YesConfirmed, Bridge.fn.bind(this, function () {
                    var $t1;
                    var value = null;
                    var valueText = null;
                    if (Bridge.referenceEquals(header.ComponentType, "Datepicker")) {
                        valueText = (value = System.Nullable.toString(confirmDialog.Datepicker.Value, function ($t) { return System.DateTime.format($t); }));
                    } else if (Bridge.referenceEquals(header.ComponentType, "Number")) {
                        valueText = confirmDialog.Number.GetValueText();
                        value = confirmDialog.Number.Value.toString();
                    } else {
                        valueText = Core.Extensions.Utils.EncodeSpecialChar(confirmDialog.Textbox.Text.trim());
                        value = Core.Extensions.Utils.EncodeSpecialChar(confirmDialog.Textbox.Text.trim());
                    }
                    window.localStorage.setItem("LastSearch" + (this.GuiInfo.Id || "") + (header.Id || ""), value);
                    if (System.Linq.Enumerable.from(this.CellSelected, Core.Models.CellSelected).any(function (x) {
                            return Bridge.referenceEquals(x.FieldName, hotKeyModel.FieldName) && System.Nullable.eq(x.Operator, Core.Enums.OperatorEnum.In);
                        }) && !hotKeyModel.Shift) {
                        System.Linq.Enumerable.from(this.CellSelected, Core.Models.CellSelected).firstOrDefault(function (x) {
                                return Bridge.referenceEquals(x.FieldName, hotKeyModel.FieldName) && System.Nullable.eq(x.Operator, Core.Enums.OperatorEnum.In);
                            }, null).Value = value;
                        System.Linq.Enumerable.from(this.CellSelected, Core.Models.CellSelected).firstOrDefault(function (x) {
                                return Bridge.referenceEquals(x.FieldName, hotKeyModel.FieldName) && System.Nullable.eq(x.Operator, Core.Enums.OperatorEnum.In);
                            }, null).ValueText = valueText;
                    } else {
                        this.CellSelected.add(($t1 = new Core.Models.CellSelected(), $t1.FieldName = hotKeyModel.FieldName, $t1.FieldText = header.ShortDesc, $t1.ComponentType = header.ComponentType, $t1.Shift = hotKeyModel.Shift, $t1.Value = value, $t1.ValueText = valueText, $t1.Operator = hotKeyModel.Operator, $t1.OperatorText = hotKeyModel.OperatorText, $t1));
                    }
                    this._summarys.add(document.createElement("div"));
                    confirmDialog.Textbox.Text = null;
                    this.ActionFilter();
                }));
                confirmDialog.Entity = new $asm.$AnonymousType$11("");
                confirmDialog.Render();
                if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(subFilter)) {
                    if (Bridge.referenceEquals(header.ComponentType, "Datepicker")) {
                        confirmDialog.Datepicker.Value = System.DateTime.parse(subFilter);
                        var input = Bridge.as(confirmDialog.Datepicker.Element, HTMLInputElement);
                        input.selectionStart = 0;
                        input.selectionEnd = subFilter.length;
                    } else if (Bridge.referenceEquals(header.ComponentType, "Number")) {
                        confirmDialog.Number.Value = System.Convert.toDecimal(subFilter);
                        var input1 = Bridge.as(confirmDialog.Number.Element, HTMLInputElement);
                        input1.selectionStart = 0;
                        input1.selectionEnd = subFilter.length;
                    } else {
                        confirmDialog.Textbox.Text = subFilter;
                        var input2 = Bridge.as(confirmDialog.Textbox.Element, HTMLInputElement);
                        input2.selectionStart = 0;
                        input2.selectionEnd = subFilter.length;
                    }
                }
            },
            ActionFilter: function () {
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.CellSelected, this.CellSelected)) {
                    this.NoCellSelected();
                    return;
                }
                Core.Components.Spinner.AppendTo(this.DataTable);
                var dropdowns = System.Linq.Enumerable.from(this.CellSelected, Core.Models.CellSelected).where(function (x) {
                        return (!Core.Extensions.StringExt.IsNullOrWhiteSpace(x.Value) || !Core.Extensions.StringExt.IsNullOrWhiteSpace(x.ValueText)) && Bridge.referenceEquals(x.ComponentType, "SearchEntry") || System.String.contains(x.FieldName,".");
                    }).toList(Core.Models.CellSelected);
                var groups = System.Linq.Enumerable.from(this.CellSelected, Core.Models.CellSelected).where(function (x) {
                        return System.String.contains(x.FieldName,".");
                    }).toList(Core.Models.CellSelected);
                Core.Clients.Client.ExecTask(System.Array.type(System.Array.type(System.String)), this.FilterDropdownIds(dropdowns), Bridge.fn.bind(this, function (data) {
                    var index = 0;
                    var lisToast = new (System.Collections.Generic.List$1(System.String)).ctor();
                    this.CellSelected.ForEach(Bridge.fn.bind(this, function (cell) {
                        index = this.BuildCondition(cell, data, index, lisToast);
                    }));
                    Core.Components.Spinner.Hide();
                    if (Bridge.referenceEquals(this.GuiInfo.ComponentType, "VirtualGrid") && this.GuiInfo.CanSearch) {
                        this.HeaderSection.Element.focus();
                    }
                    if (Bridge.referenceEquals(this.GuiInfo.ComponentType, "SearchEntry")) {
                        var search = Bridge.as(this.Parent, Core.Components.SearchEntry);
                        search != null ? search._input.focus() : null;
                    }
                    Core.Extensions.Toast.Success(Core.Extensions.IEnumerableExtensions.Combine(System.String, lisToast, "</br>"));
                    this.ApplyFilter();
                }));
            },
            FilterDropdownIds: function (dropdowns) {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                var dataTask = System.Linq.Enumerable.from(dropdowns, Core.Models.CellSelected).select(Bridge.fn.bind(this, function (x) {
                        var $t;
                        var header = System.Linq.Enumerable.from(this.Header, Core.Models.Component).firstOrDefault(function (y) {
                                return Bridge.referenceEquals(y.FieldName, x.FieldName);
                            }, null);
                        if (!x.IsSearch) {
                            var filterOperation = Core.Enums.AdvSearchOperation.Like;
                            if (System.Nullable.eq(x.Operator, Core.Enums.OperatorEnum.Lr)) {
                                filterOperation = Core.Enums.AdvSearchOperation.StartWith;
                            } else if (System.Nullable.eq(x.Operator, Core.Enums.OperatorEnum.Rl)) {
                                filterOperation = Core.Enums.AdvSearchOperation.EndWidth;
                            } else if (System.Nullable.eq(x.Operator, Core.Enums.OperatorEnum.NotIn)) {
                                filterOperation = Core.Enums.AdvSearchOperation.NotLike;
                            }
                            var func = Core.Extensions.AdvOptionExt.OperationToSql.getItem(filterOperation);
                            var sqlFilter = System.String.format(func, System.String.format("ds.[{0}]", [header.FormatData]), x.Value);
                            return Core.Clients.Client.Instance.GetIds(($t = new Core.ViewModels.SqlViewModel(), $t.ComId = header.Id, $t.Where = sqlFilter, $t));
                        } else {
                            return System.Threading.Tasks.Task.fromResult(System.Array.init([x.Value], System.String), System.Array.type(System.String));
                        }
                    })).ToArray(System.Threading.Tasks.Task$1(System.Array.type(System.String)));
                Core.Clients.Client.ExecTask(System.Array.type(System.Array.type(System.String)), System.Threading.Tasks.Task.whenAll.apply(System.Threading.Tasks.Task, dataTask), function (ds) {
                    tcs.trySetResult(ds);
                });
                return tcs.task;
            },
            BuildCondition: function (cell, data, index, lisToast) {
                var $t, $t1, $t2, $t3;
                var where = "";
                var hl = System.Linq.Enumerable.from(this.Header, Core.Models.Component).firstOrDefault(function (y) {
                        return Bridge.referenceEquals(y.FieldName, cell.FieldName);
                    }, null);
                var ids = null;
                var isNUll = Core.Extensions.StringExt.IsNullOrWhiteSpace(cell.Value);
                var advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotIn : Core.Enums.AdvSearchOperation.In;
                if (Bridge.referenceEquals(hl.FieldName, Core.Components.EditableComponent.IdField)) {
                    where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("[ds].{0} not in ({1})", cell.FieldName, cell.Value) : System.String.format("[ds].{0} in ({1})", cell.FieldName, cell.Value);
                    lisToast.add((cell.FieldText || "") + " <span class='text-danger'>" + (cell.OperatorText || "") + "</span> " + (cell.ValueText || ""));
                } else {
                    if (Bridge.referenceEquals(hl.ComponentType, "SearchEntry") && Core.Extensions.StringExt.HasNonSpaceChar(hl.FormatData)) {
                        if (isNUll) {
                            advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotEqualNull : Core.Enums.AdvSearchOperation.EqualNull;
                            where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("[ds].{0} is not null", [cell.FieldName]) : System.String.format("[ds].{0} is null", [cell.FieldName]);
                        } else {
                            var idArr = data[System.Array.index(index, data)];
                            if (System.Linq.Enumerable.from(idArr, System.String).any()) {
                                ids = Core.Extensions.IEnumerableExtensions.Combine(System.String, idArr);
                                where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("[ds].{0} not in ({1})", cell.FieldName, ids) : System.String.format("[ds].{0} in ({1})", cell.FieldName, ids);
                            } else {
                                where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("[ds].{0} != {1}", cell.FieldName, cell.Value) : System.String.format("[ds].{0} = {1}", cell.FieldName, cell.Value);
                            }
                            index = (index + 1) | 0;
                        }
                        lisToast.add((hl.ShortDesc || "") + " <span class='text-danger'>" + (cell.OperatorText || "") + "</span> " + (cell.ValueText || ""));
                    } else if (Bridge.referenceEquals(hl.ComponentType, "Input") || Bridge.referenceEquals(hl.ComponentType, "Textbox") || Bridge.referenceEquals(hl.ComponentType, "Textarea")) {
                        if (isNUll) {
                            advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotEqualNull : Core.Enums.AdvSearchOperation.EqualNull;
                            where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("([ds].{0} is not null and [ds].{1} != '')", cell.FieldName, cell.FieldName) : System.String.format("([ds].{0} is null or [ds].{1} = '')", cell.FieldName, cell.FieldName);
                        } else {
                            advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotLike : Core.Enums.AdvSearchOperation.Like;
                            where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("(CHARINDEX(N'{0}', [ds].{1}) = 0 or [ds].{2} is null)", cell.Value, cell.FieldName, cell.FieldName) : System.String.format("CHARINDEX(N'{0}', [ds].{1}) > 0", cell.Value, cell.FieldName);
                            if (System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Lr)) {
                                advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotStartWith : Core.Enums.AdvSearchOperation.StartWith;
                                where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format(" [ds].{0} not like N'{1}%' or [ds].{2} is null)", cell.FieldName, cell.Value, cell.FieldName) : System.String.format(" [ds].{0} like N'{1}%'", cell.FieldName, cell.Value);
                            }
                            if (System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Rl)) {
                                advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotEndWidth : Core.Enums.AdvSearchOperation.EndWidth;
                                where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format(" [ds].{0} not like N'%{1}' or [ds].{2} is null)", cell.FieldName, cell.Value, cell.FieldName) : System.String.format(" [ds].{0} like N'%{1}'", cell.FieldName, cell.Value);
                            }
                        }
                        lisToast.add((hl.ShortDesc || "") + " <span class='text-danger'>" + (cell.OperatorText || "") + "</span> " + (cell.ValueText || ""));
                    } else if (Bridge.referenceEquals(hl.ComponentType, "Number") || (Bridge.referenceEquals(hl.ComponentType, "Label") && System.String.contains(hl.FieldName,"Id"))) {
                        if (System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) || System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.In)) {
                            if (isNUll) {
                                advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotEqualNull : Core.Enums.AdvSearchOperation.EqualNull;
                                where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("[ds].{0} is not null", [cell.FieldName]) : System.String.format("[ds].{0} is null", [cell.FieldName]);
                            } else {
                                advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotEqual : Core.Enums.AdvSearchOperation.Equal;
                                where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("[ds].{0} != {1}", cell.FieldName, System.String.replaceAll(cell.Value, ",", "")) : System.String.format("[ds].{0} = {1}", cell.FieldName, System.String.replaceAll(cell.Value, ",", ""));
                            }
                        } else {
                            if (System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Gt) || System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Lt)) {
                                where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Gt) ? System.String.format("[ds].{0} > {1}", cell.FieldName, cell.Value) : System.String.format("[ds].{0} < {1}", cell.FieldName, cell.Value);
                                advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Gt) ? Core.Enums.AdvSearchOperation.GreaterThan : Core.Enums.AdvSearchOperation.LessThan;
                            } else if (System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Ge) || System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Le)) {
                                where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Ge) ? System.String.format("[ds].{0} >= {1}", cell.FieldName, cell.Value) : System.String.format("[ds].{0} <= {1}", cell.FieldName, cell.Value);
                                advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Ge) ? Core.Enums.AdvSearchOperation.GreaterThanOrEqual : Core.Enums.AdvSearchOperation.LessThanOrEqual;
                            }
                        }
                        lisToast.add((hl.ShortDesc || "") + " <span class='text-danger'>" + (cell.OperatorText || "") + "</span> " + (cell.ValueText || ""));
                    } else if (Bridge.referenceEquals(hl.ComponentType, "Checkbox")) {
                        if (isNUll) {
                            advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotEqualNull : Core.Enums.AdvSearchOperation.EqualNull;
                            where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("[ds].{0} is not null", [cell.FieldName]) : System.String.format("[ds].{0} is null", [cell.FieldName]);
                        } else {
                            where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("[ds].{0} != {1}", cell.FieldName, (Bridge.referenceEquals(cell.Value, "true") ? "1" : "0")) : System.String.format("[ds].{0} = {1}", cell.FieldName, (Bridge.referenceEquals(cell.Value, "true") ? "1" : "0"));
                        }
                        lisToast.add((hl.ShortDesc || "") + " <span class='text-danger'>" + (cell.OperatorText || "") + "</span> " + (cell.ValueText || ""));
                    } else if (Bridge.referenceEquals(hl.ComponentType, "Datepicker")) {
                        cell.Value = Core.Extensions.Utils.DecodeSpecialChar(cell.Value);
                        cell.ValueText = Core.Extensions.Utils.DecodeSpecialChar(cell.Value);
                        if (System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) || System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.In)) {
                            if (isNUll) {
                                where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("[ds].{0} is not null", [cell.FieldName]) : System.String.format("[ds].{0} is null", [cell.FieldName]);
                                advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotEqualNull : Core.Enums.AdvSearchOperation.EqualNull;
                            } else {
                                try {
                                    var va = System.DateTimeOffset.ParseExact(cell.Value, "dd/MM/yyyy", System.Globalization.CultureInfo.invariantCulture);
                                    if (System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) || System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.In)) {
                                        where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("[ds].{0} != '{1:yyyy-MM-dd}'", cell.FieldName, va.$clone()) : System.String.format("[ds].{0} = '{1:yyyy-MM-dd}'", cell.FieldName, va.$clone());
                                        advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotEqualDatime : Core.Enums.AdvSearchOperation.EqualDatime;
                                    }
                                } catch ($e1) {
                                    $e1 = System.Exception.create($e1);
                                    var va1 = System.DateTimeOffset.ParseExact(cell.Value, "MM/dd/yyyy HH:mm:ss", System.Globalization.CultureInfo.invariantCulture);
                                    where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? System.String.format("[ds].{0} != '{1:yyyy-MM-dd}'", cell.FieldName, va1.$clone()) : System.String.format("[ds].{0} = '{1:yyyy-MM-dd}'", cell.FieldName, va1.$clone());
                                    advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotEqualDatime : Core.Enums.AdvSearchOperation.EqualDatime;
                                }
                            }
                        } else {
                            if (!isNUll) {
                                var va2;
                                try {
                                    va2 = System.DateTime.parseExact(cell.Value, "dd/MM/yyyy", System.Globalization.CultureInfo.invariantCulture);
                                } catch ($e2) {
                                    $e2 = System.Exception.create($e2);
                                    va2 = System.DateTime.parseExact(cell.Value, "MM/dd/yyyy HH:mm:ss", System.Globalization.CultureInfo.invariantCulture);
                                }
                                if (System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Gt) || System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Lt)) {
                                    where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Gt) ? System.String.format("[ds].{0} > '{1:yyyy-MM-dd HH:mm}'", cell.FieldName, Bridge.box(va2, System.DateTime, System.DateTime.format)) : System.String.format("[ds].{0} < '{1:yyyy-MM-dd HH:mm}'", cell.FieldName, Bridge.box(va2, System.DateTime, System.DateTime.format));
                                    advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Gt) ? Core.Enums.AdvSearchOperation.GreaterThanDatime : Core.Enums.AdvSearchOperation.LessThanDatime;
                                } else if (System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Ge) || System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Le)) {
                                    where = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Ge) ? System.String.format("[ds].{0} >= '{1:yyyy-MM-dd HH:mm}'", cell.FieldName, Bridge.box(va2, System.DateTime, System.DateTime.format)) : System.String.format("[ds].{0} <= '{1:yyyy-MM-dd HH:mm}'", cell.FieldName, Bridge.box(va2, System.DateTime, System.DateTime.format));
                                    advo = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.Ge) ? Core.Enums.AdvSearchOperation.GreaterEqualDatime : Core.Enums.AdvSearchOperation.LessEqualDatime;
                                }
                            }
                        }
                        lisToast.add((hl.ShortDesc || "") + " <span class='text-danger'>" + (cell.OperatorText || "") + "</span> " + (cell.ValueText || ""));
                    }
                }
                var value = ($t = ids, $t != null ? $t : cell.Value);
                if (System.Linq.Enumerable.from(this.AdvSearchVM.Conditions, Core.Models.FieldCondition).any(function (x) {
                        return Bridge.referenceEquals(x.Field.FieldName, cell.FieldName) && System.Nullable.eq(x.CompareOperatorId, advo) && (System.Nullable.eq(x.CompareOperatorId, Core.Enums.AdvSearchOperation.Like) || System.Nullable.eq(x.CompareOperatorId, Core.Enums.AdvSearchOperation.In) || System.Nullable.eq(x.CompareOperatorId, Core.Enums.AdvSearchOperation.EqualDatime));
                    }) && !cell.Shift && !cell.Group) {
                    System.Linq.Enumerable.from(this.AdvSearchVM.Conditions, Core.Models.FieldCondition).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.Field.FieldName, cell.FieldName) && System.Nullable.eq(x.CompareOperatorId, advo);
                        }, null).Value = Core.Extensions.StringExt.IsNullOrWhiteSpace(value) ? cell.ValueText : value;
                    System.Linq.Enumerable.from(this.Wheres, Core.Models.Where).firstOrDefault(function (x) {
                            return System.String.contains(x.Condition,System.String.format("[ds].{0}", [cell.FieldName]));
                        }, null).Condition = where;
                } else {
                    if (!System.Linq.Enumerable.from(this.AdvSearchVM.Conditions, Core.Models.FieldCondition).any(function (x) {
                            return Bridge.referenceEquals(x.Field.FieldName, cell.FieldName) && System.Nullable.eq(x.CompareOperatorId, advo) && Bridge.referenceEquals(x.Value, cell.Value);
                        })) {
                        if (Bridge.referenceEquals(cell.ComponentType, "Input") && Core.Extensions.StringExt.IsNullOrWhiteSpace(cell.Value)) {
                            this.AdvSearchVM.Conditions.add(($t1 = new Core.Models.FieldCondition(), $t1.Field = hl, $t1.CompareOperatorId = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotEqualNull : Core.Enums.AdvSearchOperation.EqualNull, $t1.LogicOperatorId = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.LogicOperation.And : Core.Enums.LogicOperation.Or, $t1.Value = null, $t1.Group = true, $t1));
                            this.AdvSearchVM.Conditions.add(($t1 = new Core.Models.FieldCondition(), $t1.Field = hl, $t1.CompareOperatorId = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.AdvSearchOperation.NotEqual : Core.Enums.AdvSearchOperation.Equal, $t1.LogicOperatorId = System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.NotIn) ? Core.Enums.LogicOperation.And : Core.Enums.LogicOperation.Or, $t1.Value = "", $t1.Group = true, $t1));
                        } else {
                            if (System.String.contains(hl.FieldName,".")) {
                                var format = (System.Linq.Enumerable.from(hl.FieldName.split("."), System.String).firstOrDefault(null, null) || "") + "Id";
                                hl.FieldName = format;
                                this.AdvSearchVM.Conditions.add(($t1 = new Core.Models.FieldCondition(), $t1.Field = hl, $t1.CompareOperatorId = advo, $t1.LogicOperatorId = ($t2 = cell.Logic, $t2 != null ? $t2 : Core.Enums.LogicOperation.And), $t1.Value = Core.Extensions.StringExt.IsNullOrWhiteSpace(value) ? cell.ValueText : value, $t1.Group = cell.Group, $t1));
                            } else {
                                this.AdvSearchVM.Conditions.add(($t1 = new Core.Models.FieldCondition(), $t1.Field = hl, $t1.CompareOperatorId = advo, $t1.LogicOperatorId = ($t3 = cell.Logic, $t3 != null ? $t3 : Core.Enums.LogicOperation.And), $t1.Value = Core.Extensions.StringExt.IsNullOrWhiteSpace(value) ? cell.ValueText : value, $t1.Group = cell.Group, $t1));
                            }
                        }
                        this.Wheres.add(($t1 = new Core.Models.Where(), $t1.Condition = where, $t1.Group = cell.Group, $t1));
                    }
                }

                return index;
            },
            NoCellSelected: function () {
                var dataSourceFilter = this.GuiInfo.DataSourceFilter;
                this.MainSection.DisposeChildren();
                this.ApplyFilter();
                if (Bridge.referenceEquals(this.GuiInfo.ComponentType, "VirtualGrid") && this.GuiInfo.CanSearch) {
                    this.HeaderSection.Element.focus();
                }
                if (Bridge.referenceEquals(this.GuiInfo.ComponentType, "SearchEntry")) {
                    var search = Bridge.as(this.Parent, Core.Components.SearchEntry);
                    search != null ? search._input.focus() : null;
                }
            },
            ApplyLocal: function () {
                var tb = Bridge.as(this.DataTable, HTMLTableElement);
                var rows;
                if (this.GuiInfo.TopEmpty) {
                    rows = System.Linq.Enumerable.from(tb.tBodies, HTMLTableSectionElement).lastOrDefault(null, null).children;
                } else {
                    rows = System.Linq.Enumerable.from(tb.tBodies, HTMLTableSectionElement).firstOrDefault(null, null).children;
                }
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.CellSelected, this.CellSelected)) {
                    for (var i = 0; i < rows.length; i = (i + 1) | 0) {
                        Core.Extensions.HtmlElementExtension.RemoveClass(rows[i], "d-none");
                    }
                    return;
                }
                this.LastElementFocus = null;
                var listNone = new (System.Collections.Generic.List$1(HTMLElement)).ctor();
                var header = Core.Extensions.IEnumerableExtensions.IndexOf(Core.Models.Component, this.Header, Bridge.fn.bind(this, function (y) {
                    return Bridge.referenceEquals(y.FieldName, System.Linq.Enumerable.from(this.CellSelected, Core.Models.CellSelected).firstOrDefault(null, null).FieldName);
                }));
                this.CellSelected.ForEach(function (cell) {
                    var $t;
                    for (var i1 = 0; i1 < rows.length; i1 = (i1 + 1) | 0) {
                        var cells = rows[i1].children;
                        if (cells[header] == null) {
                            continue;
                        }
                        var cellText = ($t = cells[header].textContent, $t != null ? $t : "");
                        if (System.Nullable.eq(cell.Operator, Core.Enums.OperatorEnum.In)) {
                            if (!(System.String.indexOf(cellText.toLowerCase(), cell.ValueText.toLowerCase()) > -1)) {
                                if (!System.Linq.Enumerable.from(listNone, HTMLElement).any(function (x) {
                                        return Bridge.referenceEquals(x, rows[i1]);
                                    })) {
                                    listNone.add(rows[i1]);
                                }
                            }
                        } else {
                            if (!(System.String.indexOf(cellText.toLowerCase(), cell.ValueText.toLowerCase()) <= -1)) {
                                if (!System.Linq.Enumerable.from(listNone, HTMLElement).any(function (x) {
                                        return Bridge.referenceEquals(x, rows[i1]);
                                    })) {
                                    listNone.add(rows[i1]);
                                }
                            }
                        }
                    }
                });
                for (var i1 = 0; i1 < rows.length; i1 = (i1 + 1) | 0) {
                    var cells = rows[i1].children;
                    if (System.Linq.Enumerable.from(listNone, HTMLElement).any(function (x) {
                            return Bridge.referenceEquals(x, Bridge.cast(rows[i1], HTMLElement));
                        })) {
                        Core.Extensions.HtmlElementExtension.AddClass(rows[i1], "d-none");
                    } else {
                        if (this.LastElementFocus == null) {
                            this.LastElementFocus = cells[header];
                        }
                        Core.Extensions.HtmlElementExtension.RemoveClass(rows[i1], "d-none");
                    }
                }
                if (this.LastElementFocus != null) {
                    this.LastElementFocus.focus();
                    this.LastElementFocus = null;
                }
            },
            FilterSelected: function (hotKeyModel) {
                var $t;
                if (hotKeyModel.Operator == null) {
                    return;
                }
                if (!System.Linq.Enumerable.from(this.CellSelected, Core.Models.CellSelected).any(function (x) {
                        return Bridge.referenceEquals(x.FieldName, hotKeyModel.FieldName) && Bridge.referenceEquals(x.Value, hotKeyModel.Value) && Bridge.referenceEquals(x.ValueText, hotKeyModel.ValueText) && System.Nullable.eq(x.Operator, hotKeyModel.Operator);
                    })) {
                    var header = System.Linq.Enumerable.from(this.Header, Core.Models.Component).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.FieldName, hotKeyModel.FieldName);
                        }, null);
                    this.CellSelected.add(($t = new Core.Models.CellSelected(), $t.FieldName = hotKeyModel.FieldName, $t.FieldText = header.ShortDesc, $t.ComponentType = header.ComponentType, $t.Value = hotKeyModel.Value, $t.ValueText = hotKeyModel.ValueText, $t.Operator = hotKeyModel.Operator, $t.OperatorText = hotKeyModel.OperatorText, $t.IsSearch = hotKeyModel.ActValue, $t));
                    this._summarys.add(document.createElement("div"));
                }
                this.ActionFilter();
            },
            DisposeSumary: function () {
                if (System.Linq.Enumerable.from(this._summarys, HTMLElement).any()) {
                    System.Linq.Enumerable.from(this._summarys, HTMLElement).elementAtOrDefault(((this._summarys.Count - 1) | 0), null).remove();
                    this._summarys.removeAt(((this._summarys.Count - 1) | 0));
                }
                if (this.LastListViewItem != null && this.LastElementFocus != null) {
                    this.LastListViewItem.Focused = true;
                    this.LastElementFocus.focus();
                }
            },
            HiddenSumary: function () {
                Core.Extensions.HtmlElementExtension.Hide(System.Linq.Enumerable.from(this._summarys, HTMLElement).elementAtOrDefault(((this._summarys.Count - 1) | 0), null));
            },
            SearchDisplayRows: function () {
                var table = Bridge.as(this.DataTable, HTMLTableElement);
                var rows = System.Linq.Enumerable.from(table.tBodies, HTMLTableSectionElement).lastOrDefault(null, null).children;
                for (var i = 0; i < rows.length; i = (i + 1) | 0) {
                    if (Core.Extensions.HtmlElementExtension.HasClass(rows[i], "virtual-row")) {
                        continue;
                    }
                    var cells = rows[i].childNodes;
                    var found = false;
                    for (var j = 0; j < cells.length; j = (j + 1) | 0) {
                        var htmlElement = Bridge.as(cells[j], HTMLElement);
                        var cellText = "";
                        var input = htmlElement.querySelector("input:first-child");
                        if (input != null) {
                            cellText = Bridge.toString(Core.Extensions.Utils.GetPropValue(input, "value"));
                        } else {
                            cellText = cells[j].textContent == null ? "" : cells[j].textContent;
                        }
                        if (System.String.indexOf(Core.Extensions.Utils.DecodeSpecialChar(cellText).toLowerCase(), Core.Extensions.Utils.DecodeSpecialChar(this.ListViewSearch.EntityVM.FullTextSearch.toLowerCase())) > -1) {
                            found = true;
                            break;
                        }
                    }
                    if (found) {
                        Core.Extensions.HtmlElementExtension.RemoveClass(rows[i], "d-none");
                    } else {
                        Core.Extensions.HtmlElementExtension.AddClass(rows[i], "d-none");
                    }
                }
            },
            FocusCell: function (e, header) {
                var td = Bridge.as(e.target, HTMLElement);

                var $table = $(e.target).closest('table');
                $table.find("tbody tr").removeClass("focus");
                $table.find("tbody td").removeClass("cell-selected");

                Core.Extensions.HtmlElementExtension.AddClass(Core.Extensions.HtmlElementExtension.Closest(td, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.tr)), "focus");
                Core.Extensions.HtmlElementExtension.AddClass(Core.Extensions.HtmlElementExtension.Closest(td, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), "cell-selected");
            },
            ActionKeyHandler: function (e, header, focusedRow, com, el, keyCode) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7;
                var fieldName = "";
                var text = "";
                var value = "";
                if (System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.F4) || System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.F8) || System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.F9) || System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.F10) || System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.F11) || System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.F2) || System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.UpArrow) || System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.DownArrow) || System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.Home) || System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.End) || System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.Insert) || (Core.Extensions.EventExt.CtrlOrMetaKey(e) && System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.D))) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (com == null) {
                        return;
                    }
                    fieldName = com.FieldName;
                    switch (com.GuiInfo.ComponentType) {
                        case "SearchEntry": 
                            value = ($t = Core.Extensions.Utils.GetPropValue(focusedRow.Entity, header.FieldName)) != null ? Core.Extensions.Utils.EncodeSpecialChar(Bridge.toString($t)) : null;
                            break;
                        case "Number": 
                            value = ($t1 = Core.Extensions.Utils.GetPropValue(focusedRow.Entity, header.FieldName)) != null && ($t2 = Bridge.toString($t1)) != null ? System.String.replaceAll($t2, ",", "") : null;
                            break;
                        case "Checkbox": 
                            value = ($t3 = Core.Components.Extensions.ComponentExt.GetValue(com)) != null && ($t4 = Bridge.toString($t3)) != null ? $t4.toLowerCase() : null;
                            break;
                        default: 
                            value = ($t5 = Core.Components.Extensions.ComponentExt.GetValue(com)) != null ? Core.Extensions.Utils.EncodeSpecialChar(Bridge.toString($t5)) : null;
                            break;
                    }
                    if (value == null) {
                        text = null;
                    } else {
                        if (!com.GuiInfo.Editable) {
                            text = com.GetValueTextAct() == null ? null : Core.Extensions.Utils.DecodeSpecialChar(Bridge.toString(com.GetValueTextAct()));
                        } else {
                            text = com.GetValueText() == null ? null : Core.Extensions.Utils.DecodeSpecialChar(Bridge.toString(com.GetValueText()));
                        }
                    }
                }

                switch (keyCode) {
                    case Core.Enums.KeyCodeEnum.F2: 
                        this.FilterSelected(($t6 = new Core.ViewModels.HotKeyModel(), $t6.Operator = 2, $t6.OperatorText = "Lo\u1ea1i tr\u1eeb", $t6.Value = value, $t6.FieldName = fieldName, $t6.ValueText = text, $t6.ActValue = true, $t6));
                        break;
                    case Core.Enums.KeyCodeEnum.F4: 
                        this.ProcessFilterDetail(e, com, el, fieldName, text, value);
                        break;
                    case Core.Enums.KeyCodeEnum.F8: 
                        this.ProcessHardDelete();
                        break;
                    case Core.Enums.KeyCodeEnum.F9: 
                        this.FilterSelected(($t6 = new Core.ViewModels.HotKeyModel(), $t6.Operator = 1, $t6.OperatorText = "Ch\u1ee9a", $t6.Value = value, $t6.FieldName = fieldName, $t6.ValueText = text, $t6.ActValue = true, $t6));
                        com.Focus();
                        break;
                    case Core.Enums.KeyCodeEnum.F11: 
                        this.ProcessSort(e, com);
                        break;
                    case Core.Enums.KeyCodeEnum.UpArrow: 
                        var currentItemUp = this.GetItemFocus();
                        if (currentItemUp.RowNo === 0) {
                            return;
                        }
                        var upItemUp = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).where(function (x) {
                                return !x.GroupRow;
                            }).firstOrDefault(function (x) {
                                return x.RowNo === (((currentItemUp.RowNo - 1) | 0));
                            }, null);
                        if (upItemUp == null) {
                            if (this.GuiInfo.CanAdd) {
                                upItemUp = Bridge.as(this.EmptyRowSection.FirstChild, Core.Components.ListViewItem);
                            } else {
                                return;
                            }
                        }
                        this.CoppyValue(e, com, fieldName, currentItemUp, upItemUp);
                        break;
                    case Core.Enums.KeyCodeEnum.DownArrow: 
                        var currentItemDown = this.GetItemFocus();
                        if (currentItemDown == null) {
                            return;
                        }
                        var upItemDown = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).where(function (x) {
                                return !x.GroupRow;
                            }).firstOrDefault(function (x) {
                                return x.RowNo === (((currentItemDown.RowNo + 1) | 0));
                            }, null);
                        if (upItemDown == null) {
                            if (this.GuiInfo.CanAdd) {
                                upItemDown = Bridge.as(this.EmptyRowSection.FirstChild, Core.Components.ListViewItem);
                            } else {
                                return;
                            }
                        }
                        this.CoppyValue(e, com, fieldName, currentItemDown, upItemDown);
                        break;
                    case Core.Enums.KeyCodeEnum.LeftArrow: 
                        if (!this.GuiInfo.IsRealtime) {
                            return;
                        }
                        e.preventDefault();
                        e.stopPropagation();
                        var currentItemLeft = this.LastListViewItem;
                        var upItemLeft = System.Linq.Enumerable.from(currentItemLeft.Children, Core.Components.EditableComponent).firstOrDefault(function (x) {
                                return Bridge.referenceEquals(Core.Extensions.HtmlElementExtension.Closest(x.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), Core.Extensions.HtmlElementExtension.Closest(com.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)).previousElementSibling);
                            }, null);
                        if (upItemLeft == null || Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, currentItemLeft.Children)) {
                            return;
                        }
                        ($t6 = upItemLeft.ParentElement) != null ? $t6.focus() : null;
                        upItemLeft.Focus();
                        if (upItemLeft.GuiInfo.Editable && !upItemLeft.Disabled) {
                            var html;
                            if (((html = Bridge.as(upItemLeft.Element, HTMLInputElement))) != null) {
                                html.selectionStart = 0;
                                html.selectionEnd = upItemLeft.GetValueText().length;
                            }
                        }
                        break;
                    case Core.Enums.KeyCodeEnum.RightArrow: 
                        if (!this.GuiInfo.IsRealtime) {
                            return;
                        }
                        e.preventDefault();
                        e.stopPropagation();
                        var currentItemRight = this.LastListViewItem;
                        if (currentItemRight == null || Core.Extensions.IEnumerableExtensions.Nothing(Core.Components.EditableComponent, currentItemRight.Children)) {
                            return;
                        }
                        var upItemRight = System.Linq.Enumerable.from(currentItemRight.Children, Core.Components.EditableComponent).firstOrDefault(function (x) {
                                return Bridge.referenceEquals(Core.Extensions.HtmlElementExtension.Closest(x.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), Core.Extensions.HtmlElementExtension.Closest(com.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)).nextElementSibling);
                            }, null);
                        if (upItemRight == null) {
                            return;
                        }
                        ($t7 = upItemRight.ParentElement) != null ? $t7.focus() : null;
                        upItemRight.Focus();
                        if (upItemRight.GuiInfo.Editable && !upItemRight.Disabled) {
                            var html1;
                            if (((html1 = Bridge.as(upItemRight.Element, HTMLInputElement))) != null) {
                                html1.selectionStart = 0;
                                html1.selectionEnd = upItemRight.GetValueText().length;
                            }
                        }
                        break;
                    case Core.Enums.KeyCodeEnum.Home: 
                        var lastSelected = System.Linq.Enumerable.from(this.GetSelectedRows(), System.Object).lastOrDefault(null, null);
                        var currentItemHome = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(null, null);
                        if (currentItemHome != null) {
                            currentItemHome.Focused = false;
                        }
                        this.DataTable.parentElement.scrollTop = 0;
                        this.RenderViewPort();
                        var upItemHome = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(null, null);
                        if (upItemHome != null) {
                            upItemHome.Focused = true;
                            var upComponent = Core.Components.Extensions.ComponentExt.FirstOrDefault(upItemHome, function (x) {
                                return Bridge.referenceEquals(x.FieldName, fieldName);
                            });
                            var tdup = Core.Extensions.HtmlElementExtension.Closest(upComponent.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td));
                            upItemHome.Focus();
                            tdup.focus();
                        }
                        break;
                    case Core.Enums.KeyCodeEnum.End: 
                        var lastSelectedEnd = System.Linq.Enumerable.from(this.GetSelectedRows(), System.Object).lastOrDefault(null, null);
                        var currentItemEnd = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(function (x) {
                                return Bridge.referenceEquals(x.Entity, lastSelectedEnd);
                            }, null);
                        if (currentItemEnd != null) {
                            currentItemEnd.Focused = false;
                        }
                        this.DataTable.parentElement.scrollTop = this.DataTable.parentElement.scrollHeight;
                        this.RenderViewPort();
                        var upItemEnd = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).lastOrDefault(null, null);
                        if (upItemEnd != null) {
                            upItemEnd.Focused = true;
                            var upComponent1 = Core.Components.Extensions.ComponentExt.FirstOrDefault(upItemEnd, function (x) {
                                return Bridge.referenceEquals(x.FieldName, fieldName);
                            });
                            var tdup1 = Core.Extensions.HtmlElementExtension.Closest(upComponent1.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td));
                            upItemEnd.Focus();
                            tdup1.focus();
                        }
                        break;
                    case Core.Enums.KeyCodeEnum.Insert: 
                        var currentItemInsert = this.GetItemFocus();
                        currentItemInsert.Selected = !currentItemInsert.Selected;
                        break;
                    case Core.Enums.KeyCodeEnum.D: 
                        if (Core.Extensions.EventExt.CtrlOrMetaKey(e)) {
                            e.stopPropagation();
                            e.preventDefault();
                            var currentItemD = this.GetItemFocus();
                            if (currentItemD.RowNo === 0) {
                                return;
                            }
                            var upItemD = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(function (x) {
                                    return x.RowNo === (((currentItemD.RowNo - 1) | 0));
                                }, null);
                            Core.Extensions.BridgeExt.SetComplexPropValue(currentItemD.Entity, fieldName, Core.Extensions.Utils.GetPropValue(upItemD.Entity, com.FieldName));
                            var updated = System.Linq.Enumerable.from(currentItemD.FilterChildren$1(function (x) {
                                    return Bridge.referenceEquals(x.FieldName, com.FieldName);
                                }), Core.Components.EditableComponent).firstOrDefault(null, null);
                            updated.Dirty = true;
                            System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                                var $step = 0,
                                    $task1, 
                                    $taskResult1, 
                                    $task2, 
                                    $taskResult2, 
                                    $task3, 
                                    $taskResult3, 
                                    $jumpFromFinally, 
                                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                                    $returnValue, 
                                    dropdown, 
                                    $async_e, 
                                    $asyncBody = Bridge.fn.bind(this, function () {
                                        try {
                                            for (;;) {
                                                $step = System.Array.min([0,1,2,3,4,5,6], $step);
                                                switch ($step) {
                                                    case 0: {
                                                        if (Bridge.referenceEquals(updated.GuiInfo.ComponentType, "SearchEntry")) {
                                                            $step = 1;
                                                            continue;
                                                        } else  {
                                                            $step = 3;
                                                            continue;
                                                        }
                                                    }
                                                    case 1: {
                                                        updated.UpdateView();
                                                        dropdown = Bridge.as(com, Core.Components.SearchEntry);
                                                        updated.PopulateFields(dropdown.Matched);
                                                        $task1 = Core.Components.Extensions.ComponentExt.DispatchEvent(updated, updated.GuiInfo.Events, "change", [currentItemD.Entity, dropdown.Matched]);
                                                        $step = 2;
                                                        if ($task1.isCompleted()) {
                                                            continue;
                                                        }
                                                        $task1.continue($asyncBody);
                                                        return;
                                                    }
                                                    case 2: {
                                                        $taskResult1 = $task1.getAwaitedResult();
                                                        $step = 5;
                                                        continue;
                                                    }
                                                    case 3: {
                                                        updated.UpdateView();
                                                        updated.PopulateFields();
                                                        $task2 = Core.Components.Extensions.ComponentExt.DispatchEvent(updated, updated.GuiInfo.Events, "change", [currentItemD.Entity]);
                                                        $step = 4;
                                                        if ($task2.isCompleted()) {
                                                            continue;
                                                        }
                                                        $task2.continue($asyncBody);
                                                        return;
                                                    }
                                                    case 4: {
                                                        $taskResult2 = $task2.getAwaitedResult();
                                                        $step = 5;
                                                        continue;
                                                    }
                                                    case 5: {
                                                        $task3 = Core.Components.Extensions.ComponentExt.DispatchEvent(currentItemD.ListViewSection.ListView, upItemD.ListViewSection.ListView.GuiInfo.Events, "change", [upItemD.Entity]);
                                                        $step = 6;
                                                        if ($task3.isCompleted()) {
                                                            continue;
                                                        }
                                                        $task3.continue($asyncBody);
                                                        return;
                                                    }
                                                    case 6: {
                                                        $taskResult3 = $task3.getAwaitedResult();
                                                        if (this.GuiInfo.IsRealtime) {
                                                            currentItemD.PatchUpdateOrCreate();
                                                        }
                                                        $tcs.setResult(null);
                                                        return;
                                                    }
                                                    default: {
                                                        $tcs.setResult(null);
                                                        return;
                                                    }
                                                }
                                            }
                                        } catch($async_e1) {
                                            $async_e = System.Exception.create($async_e1);
                                            $tcs.setException($async_e);
                                        }
                                    }, arguments);

                                $asyncBody();
                                return $tcs.task;
                            }));
                        }
                        break;
                    default: 
                        break;
                }
            },
            ProcessHardDelete: function () {
                var $t;
                if (this.Disabled) {
                    return;
                }
                var selectedRows = ($t = System.Object, System.Linq.Enumerable.from(this.GetSelectedRows(), $t).toList($t));
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, selectedRows)) {
                    Core.Extensions.Toast.Warning("Vui l\u00f2ng ch\u1ecdn d\u00f2ng c\u1ea7n x\u00f3a");
                    return;
                }
                var gridPolicies = this.EditForm.GetElementPolicies(this.GuiInfo.Id, Core.Extensions.Utils.ComponentId);
                var isOwner = System.Linq.Enumerable.from(selectedRows, System.Object).all(function (x) {
                        return Core.Extensions.Utils.IsOwner(x, false);
                    });
                var canDelete = this.CanDo(gridPolicies, function (x) {
                    return x.CanDelete && isOwner || x.CanDeleteAll;
                });
                if (canDelete) {
                    this.HardDeleteSelected(null);
                }
            },
            ProcessFilterDetail: function (e, com, el, fieldName, text, value) {
                var menu = Core.Components.Forms.ContextMenu.Instance;
                menu.PElement = this.MainSection.Element;
                menu.Top = el.getBoundingClientRect().top;
                menu.Left = el.getBoundingClientRect().left;
                menu.MenuItems = Bridge.fn.bind(this, function (_o1) {
                        var $t, $t1;
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-angle-double-right", $t.Text = "Ch\u1ee9a", $t.Click = Bridge.fn.cacheBind(this, this.FilterInSelected), $t.Parameter = ($t1 = new Core.ViewModels.HotKeyModel(), $t1.Operator = Core.Enums.OperatorEnum.In, $t1.OperatorText = "Ch\u1ee9a", $t1.Value = value, $t1.FieldName = fieldName, $t1.ValueText = text, $t1.Shift = Core.Extensions.EventExt.ShiftKey(e), $t1), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-not-equal", $t.Text = "Kh\u00f4ng ch\u1ee9a", $t.Click = Bridge.fn.cacheBind(this, this.FilterInSelected), $t.Parameter = ($t1 = new Core.ViewModels.HotKeyModel(), $t1.Operator = Core.Enums.OperatorEnum.NotIn, $t1.OperatorText = "Kh\u00f4ng ch\u1ee9a", $t1.Value = value, $t1.FieldName = fieldName, $t1.ValueText = text, $t1.Shift = Core.Extensions.EventExt.ShiftKey(e), $t1), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-hourglass-start", $t.Text = "Tr\u00e1i ph\u1ea3i", $t.Click = Bridge.fn.cacheBind(this, this.FilterInSelected), $t.Parameter = ($t1 = new Core.ViewModels.HotKeyModel(), $t1.Operator = Core.Enums.OperatorEnum.Lr, $t1.OperatorText = "Tr\u00e1i ph\u1ea3i", $t1.Value = value, $t1.FieldName = fieldName, $t1.ValueText = text, $t1.Shift = Core.Extensions.EventExt.ShiftKey(e), $t1), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-hourglass-end", $t.Text = "Ph\u1ea3i tr\u00e1i", $t.Click = Bridge.fn.cacheBind(this, this.FilterInSelected), $t.Parameter = ($t1 = new Core.ViewModels.HotKeyModel(), $t1.Operator = Core.Enums.OperatorEnum.Rl, $t1.OperatorText = "Ph\u1ea3i tr\u00e1i", $t1.Value = value, $t1.FieldName = fieldName, $t1.ValueText = text, $t1.Shift = Core.Extensions.EventExt.ShiftKey(e), $t1), $t));
                        return _o1;
                    })(new (System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem)).ctor());
                if (Bridge.referenceEquals(com.GuiInfo.ComponentType, "Number") || Bridge.referenceEquals(com.GuiInfo.ComponentType, "Datepicker")) {
                    menu.MenuItems.AddRange(Bridge.fn.bind(this, function (_o2) {
                            var $t, $t1;
                            _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-greater-than", $t.Text = "L\u1edbn h\u01a1n", $t.Click = Bridge.fn.cacheBind(this, this.FilterInSelected), $t.Parameter = ($t1 = new Core.ViewModels.HotKeyModel(), $t1.Operator = Core.Enums.OperatorEnum.Gt, $t1.OperatorText = "L\u1edbn h\u01a1n", $t1.Value = value, $t1.FieldName = fieldName, $t1.ValueText = text, $t1.Shift = Core.Extensions.EventExt.ShiftKey(e), $t1), $t));
                            _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-less-than", $t.Text = "Nh\u1ecf h\u01a1n", $t.Click = Bridge.fn.cacheBind(this, this.FilterInSelected), $t.Parameter = ($t1 = new Core.ViewModels.HotKeyModel(), $t1.Operator = Core.Enums.OperatorEnum.Lt, $t1.OperatorText = "Nh\u1ecf h\u01a1n", $t1.Value = value, $t1.FieldName = fieldName, $t1.ValueText = text, $t1.Shift = Core.Extensions.EventExt.ShiftKey(e), $t1), $t));
                            _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-greater-than-equal", $t.Text = "L\u1edbn h\u01a1n b\u1eb1ng", $t.Click = Bridge.fn.cacheBind(this, this.FilterInSelected), $t.Parameter = ($t1 = new Core.ViewModels.HotKeyModel(), $t1.Operator = Core.Enums.OperatorEnum.Ge, $t1.OperatorText = "L\u1edbn h\u01a1n b\u1eb1ng", $t1.Value = value, $t1.FieldName = fieldName, $t1.ValueText = text, $t1.Shift = Core.Extensions.EventExt.ShiftKey(e), $t1), $t));
                            _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-less-than-equal", $t.Text = "Nh\u1ecf h\u01a1n b\u1eb1ng", $t.Click = Bridge.fn.cacheBind(this, this.FilterInSelected), $t.Parameter = new $asm.$AnonymousType$12(Core.Enums.OperatorEnum.Le, "Nh\u1ecf h\u01a1n b\u1eb1ng", value, fieldName, text, Core.Extensions.EventExt.ShiftKey(e)), $t));
                            return _o2;
                        })(new (System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem)).ctor()));
                }
                menu.Render();
            },
            ProcessSort: function (e, com) {
                var $t;
                if (Bridge.referenceEquals(com.GuiInfo.ComponentType, "Button")) {
                    return;
                }
                var th = System.Linq.Enumerable.from(this.HeaderSection.Children, Core.Components.EditableComponent).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.GuiInfo.Id, com.GuiInfo.Id);
                    }, null);
                Core.Extensions.HtmlElementExtension.RemoveClass(th.Element, "desc");
                Core.Extensions.HtmlElementExtension.RemoveClass(th.Element, "asc");
                var fieldName = Bridge.referenceEquals(com.ComponentType, "SearchEntry") ? com.GuiInfo.FieldText : com.FieldName;
                var sort = ($t = new Core.Models.OrderBy(), $t.FieldName = fieldName, $t.OrderbyDirectionId = Core.Enums.OrderbyDirection.ASC, $t.ComId = com.GuiInfo.Id, $t);
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.OrderBy, this.AdvSearchVM.OrderBy)) {
                    this.AdvSearchVM.OrderBy = function (_o1) {
                            _o1.add(sort);
                            return _o1;
                        }(new (System.Collections.Generic.List$1(Core.Models.OrderBy)).ctor());
                    Core.Extensions.HtmlElementExtension.AddClass(th.Element, "desc");
                } else {
                    var existSort = System.Linq.Enumerable.from(this.AdvSearchVM.OrderBy, Core.Models.OrderBy).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.FieldName, fieldName);
                        }, null);
                    if (existSort != null) {
                        this.AlterExistSort(th, existSort);
                    } else {
                        var shiftKey = Core.Extensions.EventExt.ShiftKey(e);
                        this.RemoveOtherSorts(shiftKey);
                        Core.Extensions.HtmlElementExtension.AddClass(th.Element, "desc");
                        this.AdvSearchVM.OrderBy.add(sort);
                    }
                }
                Core.Clients.LocalStorage.SetItem(System.Collections.Generic.List$1(Core.Models.OrderBy), "OrderBy" + (this.GuiInfo.Id || ""), this.AdvSearchVM.OrderBy);
                Core.Clients.Client.ExecTaskNoResult(this.ReloadData());
            },
            AlterExistSort: function (th, existSort) {
                if (System.Nullable.eq(existSort.OrderbyDirectionId, Core.Enums.OrderbyDirection.ASC)) {
                    existSort.OrderbyDirectionId = Core.Enums.OrderbyDirection.DESC;
                    Core.Extensions.HtmlElementExtension.ReplaceClass(th.Element, "asc", "desc");
                } else {
                    this.AdvSearchVM.OrderBy.remove(existSort);
                }
            },
            RemoveOtherSorts: function (shiftKey) {
                if (shiftKey) {
                    return;
                }
                this.HeaderSection.Children.ForEach(function (x) {
                    Core.Extensions.HtmlElementExtension.RemoveClass(x.Element, "desc");
                    Core.Extensions.HtmlElementExtension.RemoveClass(x.Element, "asc");
                });
                this.AdvSearchVM.OrderBy.clear();
            },
            RenderViewPort: function (count, firstLoad, skip) {
                if (count === void 0) { count = true; }
                if (firstLoad === void 0) { firstLoad = false; }
                if (skip === void 0) { skip = null; }
                return;
            },
            HotKeyF6Handler: function (e, keyCode) {
                switch (keyCode) {
                    case Core.Enums.KeyCodeEnum.F6: 
                        e.preventDefault();
                        e.stopPropagation();
                        if (System.Linq.Enumerable.from(this._summarys, HTMLElement).any()) {

                            var lastElement = System.Linq.Enumerable.from(this._summarys, HTMLElement).lastOrDefault(null, null);
                            if (this.GuiInfo.FilterLocal) {
                                if (Bridge.referenceEquals(lastElement.innerHTML, "")) {
                                    this.CellSelected.removeAt(((this.CellSelected.Count - 1) | 0));
                                    this.ActionFilter();
                                    this._summarys.removeAt(((this._summarys.Count - 1) | 0));
                                } else {
                                    if (Bridge.referenceEquals(Bridge.toString(lastElement.style.display), "none")) {
                                        this.CellSelected.removeAt(((this.CellSelected.Count - 1) | 0));
                                        this.ActionFilter();
                                        Core.Extensions.HtmlElementExtension.Show(lastElement);
                                    } else {
                                        this._summarys.removeAt(((this._summarys.Count - 1) | 0));
                                        lastElement.remove();
                                    }
                                }
                                return;
                            }
                            if (Bridge.referenceEquals(lastElement.innerHTML, "")) {
                                this.CellSelected.removeAt(((this.CellSelected.Count - 1) | 0));
                                this.Wheres.removeAt(((this.Wheres.Count - 1) | 0));
                                var last = System.Linq.Enumerable.from(this.AdvSearchVM.Conditions, Core.Models.FieldCondition).lastOrDefault(null, null);
                                if (last != null && Bridge.referenceEquals(last.Field.ComponentType, "Input") && Core.Extensions.StringExt.IsNullOrWhiteSpace(last.Value)) {
                                    this.AdvSearchVM.Conditions.removeAt(((this.AdvSearchVM.Conditions.Count - 1) | 0));
                                    this.AdvSearchVM.Conditions.removeAt(((this.AdvSearchVM.Conditions.Count - 1) | 0));
                                } else {

                                    this.AdvSearchVM.Conditions.removeAt(((this.AdvSearchVM.Conditions.Count - 1) | 0));
                                }
                                this.ActionFilter();
                                this._summarys.removeAt(((this._summarys.Count - 1) | 0));
                            } else {
                                if (this._waitingLoad) {
                                    window.clearTimeout(this._renderPrepareCacheAwaiter);
                                }
                                if (Bridge.referenceEquals(Bridge.toString(lastElement.style.display), "none")) {
                                    this.CellSelected.removeAt(((this.CellSelected.Count - 1) | 0));
                                    this.Wheres.removeAt(((this.Wheres.Count - 1) | 0));
                                    var last1 = System.Linq.Enumerable.from(this.AdvSearchVM.Conditions, Core.Models.FieldCondition).lastOrDefault(null, null);
                                    if (last1 != null && Bridge.referenceEquals(last1.Field.ComponentType, "Input") && Core.Extensions.StringExt.IsNullOrWhiteSpace(last1.Value)) {
                                        this.AdvSearchVM.Conditions.removeAt(((this.AdvSearchVM.Conditions.Count - 1) | 0));
                                        this.AdvSearchVM.Conditions.removeAt(((this.AdvSearchVM.Conditions.Count - 1) | 0));
                                    } else {

                                        this.AdvSearchVM.Conditions.removeAt(((this.AdvSearchVM.Conditions.Count - 1) | 0));
                                    }
                                    this.ActionFilter();
                                    Core.Extensions.HtmlElementExtension.Show(lastElement);
                                } else {
                                    this._summarys.removeAt(((this._summarys.Count - 1) | 0));
                                    lastElement.remove();
                                }
                            }
                        }
                        break;
                    case Core.Enums.KeyCodeEnum.F3: 
                        e.preventDefault();
                        e.stopPropagation();
                        Core.Extensions.EventExt.Done$1(System.Collections.Generic.List$1(System.Object), this.GetRealTimeSelectedRows(), Bridge.fn.bind(this, function (selected) {
                            var $t;
                            if (selected.Count === 0) {
                                selected = ($t = System.Object, System.Linq.Enumerable.from(this.RowData.Data, $t).toList($t));
                            }
                            var numbers = System.Linq.Enumerable.from(this.Header, Core.Models.Component).where(function (x) {
                                    return Bridge.referenceEquals(x.ComponentType, "Number");
                                }).toList(Core.Models.Component);
                            if (numbers.Count === 0) {
                                Core.Extensions.Toast.Warning("Vui l\u00f2ng c\u1ea5u h\u00ecnh");
                                return;
                            }
                            var listString = System.Linq.Enumerable.from(numbers, Core.Models.Component).select(function (x) {
                                    var val = System.Linq.Enumerable.from(selected, System.Object).select(function (k) {
                                            return k[x.FieldName];
                                        }).where(function (k) {
                                        return k != null;
                                    }).select(function (y) {
                                        return System.Convert.toDecimal(y);
                                    }).sum(System.Decimal.Zero);
                                    return (x.ShortDesc || "") + " : " + ((val.mod(System.Decimal(2)).gt(System.Decimal(0)) ? Bridge.Int.format(val, "N2") : Bridge.Int.format(val, "N0")) || "");
                                });
                            Core.Extensions.Toast.Success(Core.Extensions.IEnumerableExtensions.Combine(System.String, listString, "</br>"), 6000);
                        }));
                        break;
                    case Core.Enums.KeyCodeEnum.F1: 
                        e.preventDefault();
                        e.stopPropagation();
                        this.ToggleAll();
                        break;
                    case Core.Enums.KeyCodeEnum.U: 
                        if (Core.Extensions.EventExt.CtrlOrMetaKey(e)) {
                            if (this.Disabled || !this.GuiInfo.CanAdd) {
                                return;
                            }
                            e.preventDefault();
                            e.stopPropagation();
                            this.DuplicateSelected(e, true);
                        }
                        break;
                    default: 
                        break;
                }
                if (this.LastListViewItem == null) {
                    return;
                }
                if (this.LastListViewItem.Children == null) {
                    return;
                }
                var com = System.Linq.Enumerable.from(this.LastListViewItem.Children, Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this, function (x) {
                        return Bridge.referenceEquals(x.GuiInfo.Id, (this.LastComponentFocus != null ? this.LastComponentFocus.Id : null));
                    }), null);
                if (com == null) {
                    return;
                }
                this.ActionKeyHandler(e, this.LastComponentFocus, this.LastListViewItem, com, Core.Extensions.HtmlElementExtension.Closest(com.Element, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), keyCode);
            },
            RenderCopyPasteMenu: function (canWrite) {
                var $t;
                if (canWrite) {
                    Core.Components.Forms.ContextMenu.Instance.MenuItems.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-copy", $t.Text = "Copy", $t.Click = Bridge.fn.cacheBind(this, this.CopySelected), $t));
                    Core.Components.Forms.ContextMenu.Instance.MenuItems.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fa fa-clone", $t.Text = "Copy & D\u00e1n", $t.Click = Bridge.fn.bind(this, function (e) {
                        this.DuplicateSelected(null, false);
                    }), $t));
                }
                if (canWrite && Core.Extensions.IEnumerableExtensions.HasElement(System.Object, Core.Components.ListView._copiedRows)) {
                    Core.Components.Forms.ContextMenu.Instance.MenuItems.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-paste", $t.Text = "D\u00e1n", $t.Click = Bridge.fn.cacheBind(this, this.PasteSelected), $t));
                }
            },
            CoppyValue: function (e, com, fieldName, currentItem, upItem) {
                var $t;
                this.LastListViewItem = upItem;
                currentItem.Focused = false;
                upItem.Focused = true;
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(fieldName)) {
                    return;
                }
                var nextcom = System.Linq.Enumerable.from(upItem.FilterChildren$1(function (x) {
                        return Bridge.referenceEquals(x.GuiInfo.Id, com.GuiInfo.Id);
                    }), Core.Components.EditableComponent).firstOrDefault(null, null);
                if (nextcom != null) {
                    this.LastComponentFocus = nextcom.GuiInfo;
                    ($t = nextcom.ParentElement) != null ? $t.focus() : null;
                    nextcom.Focus();
                    if (nextcom.GuiInfo.Editable && !nextcom.Disabled) {
                        var html;
                        if (((html = Bridge.as(nextcom.Element, HTMLInputElement))) != null) {
                            html.selectionStart = 0;
                            html.selectionEnd = nextcom.GetValueText().length;
                        }
                    }
                    this.LastElementFocus = nextcom.Element;
                    if (Core.Extensions.EventExt.ShiftKey(e)) {
                        Core.Extensions.BridgeExt.SetComplexPropValue(upItem.Entity, fieldName, Core.Components.Extensions.ComponentExt.GetValue(com));
                        var updated = System.Linq.Enumerable.from(upItem.FilterChildren$1(function (x) {
                                return Bridge.referenceEquals(x.FieldName, nextcom.FieldName);
                            }), Core.Components.EditableComponent).firstOrDefault(null, null);
                        if (updated.Disabled || !updated.GuiInfo.Editable) {
                            return;
                        }
                        updated.Dirty = true;
                        System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                            var $step = 0,
                                $task1, 
                                $taskResult1, 
                                $task2, 
                                $taskResult2, 
                                $task3, 
                                $taskResult3, 
                                $jumpFromFinally, 
                                $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                                $returnValue, 
                                dropdown, 
                                $async_e, 
                                $asyncBody = Bridge.fn.bind(this, function () {
                                    try {
                                        for (;;) {
                                            $step = System.Array.min([0,1,2,3,4,5,6], $step);
                                            switch ($step) {
                                                case 0: {
                                                    if (Bridge.referenceEquals(updated.GuiInfo.ComponentType, "SearchEntry")) {
                                                        $step = 1;
                                                        continue;
                                                    } else  {
                                                        $step = 3;
                                                        continue;
                                                    }
                                                }
                                                case 1: {
                                                    updated.UpdateView();
                                                    dropdown = Bridge.as(com, Core.Components.SearchEntry);
                                                    updated.PopulateFields(dropdown.Matched);
                                                    $task1 = Core.Components.Extensions.ComponentExt.DispatchEvent(updated, updated.GuiInfo.Events, "change", [upItem.Entity, dropdown.Matched]);
                                                    $step = 2;
                                                    if ($task1.isCompleted()) {
                                                        continue;
                                                    }
                                                    $task1.continue($asyncBody);
                                                    return;
                                                }
                                                case 2: {
                                                    $taskResult1 = $task1.getAwaitedResult();
                                                    $step = 5;
                                                    continue;
                                                }
                                                case 3: {
                                                    updated.UpdateView();
                                                    updated.PopulateFields();
                                                    $task2 = Core.Components.Extensions.ComponentExt.DispatchEvent(updated, updated.GuiInfo.Events, "change", [upItem.Entity]);
                                                    $step = 4;
                                                    if ($task2.isCompleted()) {
                                                        continue;
                                                    }
                                                    $task2.continue($asyncBody);
                                                    return;
                                                }
                                                case 4: {
                                                    $taskResult2 = $task2.getAwaitedResult();
                                                    $step = 5;
                                                    continue;
                                                }
                                                case 5: {
                                                    $task3 = Core.Components.Extensions.ComponentExt.DispatchEvent(upItem.ListViewSection.ListView, upItem.ListViewSection.ListView.GuiInfo.Events, "change", [upItem.Entity]);
                                                    $step = 6;
                                                    if ($task3.isCompleted()) {
                                                        continue;
                                                    }
                                                    $task3.continue($asyncBody);
                                                    return;
                                                }
                                                case 6: {
                                                    $taskResult3 = $task3.getAwaitedResult();
                                                    if (this.GuiInfo.IsRealtime) {
                                                        upItem.PatchUpdateOrCreate();
                                                    }
                                                    $tcs.setResult(null);
                                                    return;
                                                }
                                                default: {
                                                    $tcs.setResult(null);
                                                    return;
                                                }
                                            }
                                        }
                                    } catch($async_e1) {
                                        $async_e = System.Exception.create($async_e1);
                                        $tcs.setException($async_e);
                                    }
                                }, arguments);

                            $asyncBody();
                            return $tcs.task;
                        }));
                    }
                }
            },
            AddRow: function (rowData, index, singleAdd) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    rowSection, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        if (index === void 0) { index = 0; }
                                        if (singleAdd === void 0) { singleAdd = true; }
                                        $task1 = Core.Components.ListView.prototype.AddRow.call(this, rowData, index, singleAdd);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        rowSection = $taskResult1;
                                        this.StickyColumn(rowSection);
                                        this.RenderIndex();
                                        $tcs.setResult(rowSection);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            AddNewEmptyRow: function () {
                var $t;
                if (this.Disabled || !this.Editable || System.Nullable.eq((($t = this.EmptyRowSection) != null ? Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent, $t.Children) : null), true)) {
                    return;
                }
                var emptyRowData = { };
                var fn = { };
                if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(this.GuiInfo.DefaultVal) && Core.Extensions.Utils.IsFunction(this.GuiInfo.DefaultVal, fn)) {
                    var dfObj = fn.v.call(this, this);
                    Core.Extensions.Utils.ForEachProp(dfObj, function (x) {
                        emptyRowData[x] = dfObj[x];
                    });
                }
                emptyRowData[Core.Components.EditableComponent.IdField] = null;
                var rowSection = this.RenderRowData(this.Header, emptyRowData, this.EmptyRowSection, null, true);
                Core.Extensions.Utils.ForEachProp$1(emptyRowData, function (field, value) {
                    var $t1;
                    rowSection.PatchModel.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = field, $t1.Value = value != null ? Bridge.toString(value) : null, $t1));
                });
                if (!this.GuiInfo.TopEmpty) {
                    this.DataTable.insertBefore(this.MainSection.Element, this.EmptyRowSection.Element);
                } else {
                    this.DataTable.insertBefore(this.EmptyRowSection.Element, this.MainSection.Element);
                }
                System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterEmptyRowCreated, [Bridge.box(this.emptyRow, System.Boolean, System.Nullable.toStringFn(System.Boolean.toString), System.Nullable.getHashCode)]);
                                            $step = 1;
                                            if ($task1.isCompleted()) {
                                                continue;
                                            }
                                            $task1.continue($asyncBody);
                                            return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            $tcs.setResult(null);
                                            return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                }));
            },
            FilterColumns: function (Component) {
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.Component, Component)) {
                    return Component;
                }
                var specificComponent = System.Linq.Enumerable.from(Component, Core.Models.Component).any(Bridge.fn.bind(this, function (x) {
                        return Bridge.referenceEquals(x.ComponentId, this.GuiInfo.Id);
                    }));
                if (specificComponent) {
                    Component = System.Linq.Enumerable.from(Component, Core.Models.Component).where(Bridge.fn.bind(this, function (x) {
                            return Bridge.referenceEquals(x.ComponentId, this.GuiInfo.Id);
                        })).toList(Core.Models.Component);
                } else {
                    Component = System.Linq.Enumerable.from(Component, Core.Models.Component).where(function (x) {
                            return x.ComponentId == null;
                        }).toList(Core.Models.Component);
                }

                var permission = this.EditForm.GetGridPolicies$1(System.Linq.Enumerable.from(Component, Core.Models.Component).select(function (x) {
                        return x.Id;
                    }).ToArray(System.String), Core.Extensions.Utils.ComponentId);
                var headers = System.Linq.Enumerable.from(Component, Core.Models.Component).where(function (x) {
                        return !x.Hidden;
                    }).where(function (header) {
                    return !header.IsPrivate || Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy, System.Linq.Enumerable.from(permission, Core.Models.FeaturePolicy).where(function (x) {
                            return Bridge.referenceEquals(x.RecordId, header.Id);
                        }), function (policy) {
                        return policy.CanRead;
                    });
                }).select(Bridge.fn.cacheBind(this, this.CalcTextAlign)).orderByDescending(function (x) {
                    return x.Frozen;
                }).thenByDescending(function (header) {
                    return Bridge.referenceEquals(header.ComponentType, "Button");
                }).thenBy(function (x) {
                    return x.Order;
                }).toList(Core.Models.Component);
                Core.Components.ListView.OrderHeaderGroup(headers);
                this.Header.clear();
                this.Header.add(Core.Components.GridView.ToolbarColumn);
                this.Header.AddRange(headers);
                this.Header = System.Linq.Enumerable.from(this.Header, Core.Models.Component).where(function (x) {
                        return x != null;
                    }).toList(Core.Models.Component);
                return this.Header;
            },
            ApplyFilter: function () {
                this.DataTable.parentElement.scrollTop = 0;
                return this.ReloadData(true, void 0, void 0);
            },
            ColumnResizeHandler: function () {
                var self = this;
                const createResizableTable = function (table) {
                    if (table == null) return;
                    const cols = table.querySelectorAll('th');
                    [].forEach.call(cols, function (col) {
                        // Add a resizer element to the column
                        const resizer = document.createElement('div');
                        resizer.classList.add('resizer');

                        col.appendChild(resizer);

                        createResizableColumn(col, resizer);
                    });
                };

                const createResizableColumn = function (col, resizer) {
                    let x = 0;
                    let w = 0;

                    const mouseDownHandler = function (e) {
                        e.preventDefault();
                        x = e.clientX;

                        const styles = window.getComputedStyle(col);
                        w = parseInt(styles.width, 10);

                        document.addEventListener('mousemove', mouseMoveHandler);
                        document.addEventListener('mouseup', mouseUpHandler);

                        resizer.classList.add('resizing');
                    };

                    const mouseMoveHandler = function (e) {
                        e.preventDefault();
                        const dx = e.clientX - x;
                        col.style.width = `${w + dx}px`;
                        col.style.minWidth = `${w + dx}px`;
                        col.style.maxWidth = `${w + dx}px`;
                    };

                    const mouseUpHandler = function () {
                        self.UpdateHeader();
                        resizer.classList.remove('resizing');
                        document.removeEventListener('mousemove', mouseMoveHandler);
                        document.removeEventListener('mouseup', mouseUpHandler);
                    };

                    resizer.addEventListener('mousedown', mouseDownHandler);
                };
                createResizableTable(this.DataTable);
            },
            RenderContent: function () {
                var $t;
                if (!this.LoadRerender) {
                    this.Rerender();
                }
                this.AddSections();
                if (!this._hasFirstLoad && this.VirtualScroll) {
                    this._hasFirstLoad = true;
                    return;
                }
                var viewPort = this.GetViewPortItem();
                this.FormattedRowData = this.GuiInfo.LocalRender ? this.GuiInfo.LocalData : this.RowData.Data;
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, this.FormattedRowData)) {
                    this.MainSection.DisposeChildren();
                    this.DomLoaded();
                    return;
                }
                this.DisposeNoRecord();
                if (this.VirtualScroll && this.FormattedRowData.Count > viewPort) {
                    this.FormattedRowData = System.Linq.Enumerable.from(this.FormattedRowData, System.Object).take(viewPort).toList(System.Object);
                }
                if (Core.Extensions.IEnumerableExtensions.HasElement(Core.Components.EditableComponent, this.MainSection.Children)) {
                    this.UpdateExistRowsWrapper(false, 0, viewPort);
                    return;
                }
                this.MainSection.Show = false;
                ($t = System.Object, System.Linq.Enumerable.from(this.FormattedRowData, $t).toList($t)).ForEach(Bridge.fn.bind(this, function (rowData) {
                    Core.MVVM.Html.Take(this.MainSection.Element);
                    this.RenderRowData(this.Header, rowData, this.MainSection);
                }));
                this.MainSection.Show = true;
                this.ContentRendered();
                this.DomLoaded();
            },
            SetFocusingCom: function () {
                if (this.AutoFocus) {
                    return;
                }
                if (this.EntityFocusId != null && this.LastComponentFocus != null) {
                    var element = System.Linq.Enumerable.from(Core.Extensions.IEnumerableExtensions.Flattern(Core.Components.EditableComponent, this.MainSection.Children, function (x) {
                            return x.Children;
                        }), Core.Components.EditableComponent).firstOrDefault(Bridge.fn.bind(this, function (x) {
                            return Bridge.referenceEquals(Bridge.toString(x.Entity[Core.Components.EditableComponent.IdField]), this.EntityFocusId) && Bridge.referenceEquals(x.GuiInfo.Id, this.LastComponentFocus.Id);
                        }), null);
                    if (element != null) {
                        var lastListView = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(Bridge.fn.bind(this, function (x) {
                                return Bridge.referenceEquals(Bridge.toString(x.Entity[Core.Components.EditableComponent.IdField]), this.EntityFocusId);
                            }), null);
                        lastListView.Focused = true;
                        Core.Extensions.HtmlElementExtension.AddClass(element.ParentElement, "cell-selected");
                        this.LastListViewItem = lastListView;
                        this.LastComponentFocus = element.GuiInfo;
                        this.LastElementFocus = element.Element;
                    } else {
                        this.HeaderSection.Element.focus();
                    }
                } else {
                    this.HeaderSection.Element.focus();
                }
            },
            UpdateExistRowsWrapper: function (dirty, skip, viewPort) {
                if (!this._hasFirstLoad) {
                    this._hasFirstLoad = true;
                    return;
                }
                this.UpdateExistRows(dirty);
                this.RenderIndex();
                this.DomLoaded();
            },
            UpdateExistRows: function (dirty) {
                var updatedData = this.FormattedRowData.ToArray();
                var dataSections = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).take(updatedData.length).ToArray(Core.Components.ListViewItem);
                Core.Extensions.IEnumerableExtensions.SelectForEach$1(Core.Components.ListViewItem, dataSections, function (child, index) {
                    child.Entity = updatedData[System.Array.index(index, updatedData)];
                    Core.Extensions.IEnumerableExtensions.SelectForEach(Core.Components.EditableComponent, Core.Extensions.IEnumerableExtensions.Flattern(Core.Components.EditableComponent, child.Children, function (x) {
                        return x.Children;
                    }), function (x) {
                        x.Entity = updatedData[System.Array.index(index, updatedData)];
                    });
                    child.UpdateView();
                });
                var shouldAddRow = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).count() <= updatedData.length;
                if (shouldAddRow) {
                    System.Linq.Enumerable.from(updatedData, System.Object).skip(dataSections.length).forEach(Bridge.fn.bind(this, function (newRow) {
                        var rs = this.RenderRowData(this.Header, newRow, this.MainSection);
                        this.StickyColumn(rs);
                    }));
                } else {
                    System.Linq.Enumerable.from(this.MainSection.Children, Core.Components.EditableComponent).skip(updatedData.length).ToArray(Core.Components.EditableComponent).forEach(function (x) {
                            x.Dispose();
                        });
                }
                if (System.Nullable.hasValue(dirty)) {
                    this.Dirty = System.Nullable.getValue(dirty);
                }
                this.RenderIndex();
            },
            RenderRowData: function (headers, row, section, index, emptyRow) {
                var $t;
                if (index === void 0) { index = null; }
                if (emptyRow === void 0) { emptyRow = false; }
                var tbody = section.Element;
                Core.MVVM.Html.Take(tbody);
                var rowSection = ($t = new Core.Components.GridViewItem(Core.MVVM.ElementType.tr), $t.EmptyRow = emptyRow, $t.Entity = row, $t.ParentElement = tbody, $t.PreQueryFn = this._preQueryFn, $t.ListView = this, $t.GuiInfo = this.GuiInfo, $t);
                section.AddChild(rowSection, index);
                var id = Bridge.unbox(row[Core.Components.EditableComponent.IdField]);
                if (id <= 0 && !emptyRow) {
                    rowSection.Dirty = true;
                }
                var tr = Bridge.as(Core.MVVM.Html.Context, HTMLTableRowElement);
                tr.tabIndex = -1;
                if (System.Nullable.hasValue(index)) {
                    if (System.Nullable.gte(index, System.Linq.Enumerable.from(tr.parentElement.children, HTMLElement).count()) || System.Nullable.lt(index, 0)) {
                        index = 0;
                    }

                    tr.parentElement.insertBefore(tr, tr.parentElement.children[System.Nullable.getValue(index)]);
                }
                if (Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.Component, headers)) {
                    headers.ForEach(function (header) {
                        rowSection.RenderTableCell(row, header);
                    });
                }
                if (emptyRow) {
                    this.Children.ForEach(function (x) {
                        x.AlwaysLogHistory = true;
                    });
                }
                if (this.Disabled) {
                    Core.Components.Extensions.ComponentExt.SetDisabled$1(rowSection, false, ["btnEdit"]);
                }
                if (!Bridge.referenceEquals(this.GuiInfo.ComponentType, "FileUploadGrid")) {
                    if (System.Nullable.gt(Bridge.unbox(row.Id), 0)) {
                        Core.Extensions.HtmlElementExtension.RemoveClass(rowSection.Element, "new-row");
                    } else {
                        Core.Extensions.HtmlElementExtension.AddClass(rowSection.Element, "new-row");
                    }
                }
                return rowSection;
            },
            AddSummaries: function () {
                if (System.Linq.Enumerable.from(this.Header, Core.Models.Component).all(function (x) {
                        return Core.Extensions.StringExt.IsNullOrEmpty(x.Summary);
                    })) {
                    return;
                }

                var sums = System.Linq.Enumerable.from(this.Header, Core.Models.Component).where(function (x) {
                        return !Core.Extensions.StringExt.IsNullOrWhiteSpace(x.Summary);
                    });
                System.Linq.Enumerable.from(this.MainSection.Element.children, HTMLElement).where(function (x) {
                            return Core.Extensions.HtmlElementExtension.HasClass(x, Core.Components.GridView.SummaryClass);
                        }).ToArray(HTMLElement).forEach(function (x) {
                        x.remove();
                    });
                var count = System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.Models.Component, System.String, sums, function (x) {
                        return x.Summary;
                    }), Core.Models.Component).count();
                sums.forEach(Bridge.fn.bind(this, function (header) {
                    this.AddNewEmptyRow();
                    this.RenderSummaryRow(header, this.Header, Bridge.as(this.FooterSection.Element, HTMLTableSectionElement), count);
                }));
            },
            DuplicateSelected: function (ev, addRow) {
                var $t;
                if (addRow === void 0) { addRow = false; }
                var originalRows = this.GetSelectedRows();
                var copiedRows = ($t = System.Object, System.Linq.Enumerable.from(Core.Extensions.ReflectionExt.CloneRows(originalRows), $t).toList($t));
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, copiedRows) || !this.CanWrite) {
                    return;
                }

                Core.Extensions.Toast.Success("\u0110ang Sao ch\u00e9p li\u1ec7u !");
                Core.Extensions.EventExt.Done(Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforePasted, [originalRows, copiedRows]), Bridge.fn.bind(this, function () {
                    var index = this.GetStartIndex(ev, addRow);
                    Core.Extensions.EventExt.Done$1(System.Array.type(Core.Components.ListViewItem), Core.Components.ListView.prototype.AddRowsNo.call(this, copiedRows, index), Bridge.fn.bind(this, function (list) {
                        this.RowsAdded(list, originalRows, copiedRows);
                    }));
                }));
            },
            GetStartIndex: function (ev, addRow) {
                var index = Core.Extensions.IEnumerableExtensions.IndexOf(Core.Components.ListViewItem, this.AllListViewItem, function (x) {
                    return x.Selected;
                });
                if (addRow) {
                    if (System.Nullable.eq(Core.Extensions.EventExt.KeyCodeEnum(ev), Core.Enums.KeyCodeEnum.U) && Core.Extensions.EventExt.CtrlOrMetaKey(ev)) {
                        if (this.GuiInfo.TopEmpty) {
                            index = 0;
                        } else {
                            index = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).lastOrDefault(null, null).RowNo;
                        }
                    }
                }

                return index;
            },
            RowsAdded: function (list, originalRows, copiedRows) {
                var $t, $t1;
                var lastChild = System.Linq.Enumerable.from(System.Linq.Enumerable.from(list, Core.Components.ListViewItem).firstOrDefault(null, null).FilterChildren(Core.Components.EditableComponent, function (x) {
                        return x.GuiInfo.Editable;
                    }), Core.Components.EditableComponent).firstOrDefault(null, null);
                lastChild != null ? lastChild.Focus() : null;
                this.RenderIndex();
                if (this.GuiInfo.IsSumary) {
                    this.AddSummaries();
                }
                this.ClearSelected();
                $t = Bridge.getEnumerator(list);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        item.Selected = true;
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                this.LastListViewItem = System.Linq.Enumerable.from(list, Core.Components.ListViewItem).firstOrDefault(null, null);
                if (this.GuiInfo.IsRealtime) {
                    $t1 = Bridge.getEnumerator(list);
                    try {
                        while ($t1.moveNext()) {
                            var item1 = $t1.Current;
                            item1.PatchUpdateOrCreate();
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                    Core.Extensions.Toast.Success("Sao ch\u00e9p d\u1eef li\u1ec7u th\u00e0nh c\u00f4ng !");
                    Bridge.ensureBaseProperty(this, "Dirty").$Core$Components$EditableComponent$Dirty = false;
                } else {
                    Core.Extensions.Toast.Success("Sao ch\u00e9p d\u1eef li\u1ec7u th\u00e0nh c\u00f4ng !");
                }
                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterPasted, [originalRows, copiedRows]));
            },
            RenderSummaryRow: function (sum, headers, footer, count) {
                var $t;
                var tr = this.CreateSummaryTableRow(sum, footer, count);
                if (tr == null) {
                    return;
                }

                var hasSummaryClass = Core.Extensions.HtmlElementExtension.HasClass(tr, Core.Components.GridView.SummaryClass);
                var colSpan = ($t = sum.SummaryColSpan, $t != null ? $t : 0);
                Core.Extensions.HtmlElementExtension.AddClass(tr, Core.Components.GridView.SummaryClass);
                if (!hasSummaryClass && headers.contains(sum)) {
                    Core.Components.GridView.ResetSummaryRow(tr, colSpan);
                }
                if (!headers.contains(sum)) {
                    Core.Components.GridView.ClearSummaryContent(tr);
                    return;
                }
                Core.Components.GridView.SetSummaryHeaderText(sum, tr);
                this.CalcSumCol(sum, headers, tr, colSpan);
            },
            SetRowData: function (listData) {
                this.RowData._data.clear();
                var hasElement = Core.Extensions.IEnumerableExtensions.HasElement(System.Object, listData);
                if (hasElement) {
                    listData.ForEach(Bridge.fn.cacheBind(this.RowData._data, this.RowData._data.add)); // Not to use AddRange because the _data is not always List
                }
                this.RenderContent();
                if (this.Entity != null && this.ShouldSetEntity) {
                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this.RowData.Data);
                }
            },
            CreateSummaryTableRow: function (sum, footer, count) {
                var summaryText = sum.Summary;
                if (footer == null) {
                    return null;
                }

                var summaryRowCount = System.Linq.Enumerable.from(footer.rows, HTMLTableRowElement).count(function (x) {
                        return Core.Extensions.HtmlElementExtension.HasClass(x, Core.Components.GridView.SummaryClass);
                    });
                var existSumRow = System.Linq.Enumerable.from(footer.rows, HTMLTableRowElement).reverse().firstOrDefault(function (x) {
                        return Core.Extensions.HtmlElementExtension.HasClass(x, Core.Components.GridView.SummaryClass) && System.Linq.Enumerable.from(x.children, HTMLElement).any(function (y) {
                                return Bridge.referenceEquals(y.textContent, summaryText);
                            });
                    }, null);
                if (existSumRow == null) {
                    existSumRow = System.Linq.Enumerable.from(footer.rows, HTMLTableRowElement).lastOrDefault(null, null);
                }

                if (summaryRowCount >= count) {
                    return existSumRow;
                }
                if (this.MainSection.FirstChild == null) {
                    return null;
                }
                var result = Bridge.as(this.MainSection.FirstChild.Element.cloneNode(true), HTMLTableRowElement);
                footer.appendChild(result);
                Core.Extensions.IEnumerableExtensions.SelectForEach(HTMLElement, result.children, function (x) {
                    x.innerHTML = null;
                });
                return result;
            },
            CalcSumCol: function (header, headers, tr, colSpan) {
                var index = headers.indexOf(header);
                var cellVal = tr.cells[((((index - colSpan) | 0) + 1) | 0)];
                var format = Core.Extensions.StringExt.IsNullOrWhiteSpace(header.FormatData) ? "{0:n0}" : header.FormatData;
                var isNumber = System.Linq.Enumerable.from(this.RowData.Data, System.Object).any(function (x) {
                        return Core.Extensions.ReflectionExt.IsNumber(Bridge.Reflection.getMembers(Bridge.getType(x), 16, 284, header.FieldName).rt);
                    });
                var sum = System.Linq.Enumerable.from(this.RowData.Data, System.Object).sum(function (x) {
                        var val = x[header.FieldName];
                        if (val == null) {
                            return System.Decimal(0);
                        }

                        return System.Convert.toDecimal(val);
                    }, System.Decimal.Zero);
                cellVal.textContent = Core.Extensions.Utils.FormatEntity$1(format, isNumber ? sum : System.Decimal(System.Linq.Enumerable.from(this.RowData.Data, System.Object).count()));
            },
            RowChangeHandler: function (rowData, rowSection, observableArgs, component) {
                var $step = 0,
                    $task1, 
                    $task2, 
                    $taskResult2, 
                    $task3, 
                    $taskResult3, 
                    $task4, 
                    $taskResult4, 
                    $task5, 
                    $taskResult5, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    com, 
                    rs, 
                    entity, 
                    headers, 
                    currentComponent, 
                    index, 
                    nextGrid, 
                    nextComponent, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3,4,5,6,7,8,9], $step);
                                switch ($step) {
                                    case 0: {
                                        if (component === void 0) { component = null; }
                                        $task1 = System.Threading.Tasks.Task.delay(50);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $task1.getAwaitedResult();
                                        com = function (_o1) {
                                            _o1.add("SearchEntry");
                                            return _o1;
                                        }(new (System.Collections.Generic.List$1(System.String)).ctor());
                                        if (rowSection.EmptyRow && observableArgs.EvType === "change") {
                                            $step = 2;
                                            continue;
                                        } 
                                        $step = 5;
                                        continue;
                                    }
                                    case 2: {
                                        $task2 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforeCreated, [rowData, this]);
                                        $step = 3;
                                        if ($task2.isCompleted()) {
                                            continue;
                                        }
                                        $task2.continue($asyncBody);
                                        return;
                                    }
                                    case 3: {
                                        $taskResult2 = $task2.getAwaitedResult();
                                        if (this.GuiInfo.IsRealtime) {
                                            entity = rowData;
                                            rowSection.PatchUpdateOrCreate();
                                            this.Dirty = false;
                                        } else {
                                            rs = rowSection.Entity;
                                            this.Dirty = true;
                                        }
                                        if (!Bridge.referenceEquals(this.GuiInfo.ComponentType, "VirtualGrid")) {
                                            Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this.RowData.Data);
                                        }
                                        rowSection.UpdateView$1(true);
                                        this.MoveEmptyRow(rowSection);
                                        this.EmptyRowSection.Children.clear();
                                        this.AddNewEmptyRow();
                                        if (!com.contains(component != null ? component.GuiInfo.ComponentType : null)) {
                                            this.ClearSelected();
                                            rowSection.Selected = true;
                                            rowSection.Focus();
                                            this.LastListViewItem = rowSection;
                                            this.LastElementFocus.focus();
                                        }
                                        $task3 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterCreated, [rowData]);
                                        $step = 4;
                                        if ($task3.isCompleted()) {
                                            continue;
                                        }
                                        $task3.continue($asyncBody);
                                        return;
                                    }
                                    case 4: {
                                        $taskResult3 = $task3.getAwaitedResult();
                                        $step = 5;
                                        continue;
                                    }
                                    case 5: {
                                        if (component != null && Bridge.referenceEquals(component.ComponentType, "GridView")) {
                                            $step = 6;
                                            continue;
                                        } 
                                        $step = 8;
                                        continue;
                                    }
                                    case 6: {
                                        $task4 = Core.Components.Extensions.ComponentExt.DispatchEvent(this, component.GuiInfo.Events, observableArgs.EvType, [rowData, rowSection]);
                                        $step = 7;
                                        if ($task4.isCompleted()) {
                                            continue;
                                        }
                                        $task4.continue($asyncBody);
                                        return;
                                    }
                                    case 7: {
                                        $taskResult4 = $task4.getAwaitedResult();
                                        $step = 8;
                                        continue;
                                    }
                                    case 8: {
                                        $task5 = Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, observableArgs.EvType, [rowData, rowSection]);
                                        $step = 9;
                                        if ($task5.isCompleted()) {
                                            continue;
                                        }
                                        $task5.continue($asyncBody);
                                        return;
                                    }
                                    case 9: {
                                        $taskResult5 = $task5.getAwaitedResult();
                                        if (observableArgs.EvType === "change") {
                                            this.PopulateFields$1();
                                            this.RenderIndex();
                                            if (this.GuiInfo.IsSumary) {
                                                this.AddSummaries();
                                            }
                                            this.LastListViewItem = rowSection;
                                            headers = System.Linq.Enumerable.from(this.Header, Core.Models.Component).where(function (y) {
                                                return y.Editable;
                                            }).toList(Core.Models.Component);
                                            currentComponent = System.Linq.Enumerable.from(headers, Core.Models.Component).firstOrDefault(function (y) {
                                                return Bridge.referenceEquals(y.FieldName, (component != null ? component.FieldName : null));
                                            }, null);
                                            if (com.contains(currentComponent.ComponentType) && rowData[currentComponent.FieldName] != null) {
                                                index = headers.indexOf(currentComponent);
                                                if (headers.Count > ((index + 1) | 0)) {
                                                    nextGrid = headers.getItem(((index + 1) | 0));
                                                    nextComponent = System.Linq.Enumerable.from(rowSection.Children, Core.Components.EditableComponent).where(function (y) {
                                                        return Bridge.referenceEquals((y != null ? y.FieldName : null), nextGrid.FieldName);
                                                    }).firstOrDefault(null, null);
                                                    this.ClearSelected();
                                                    rowSection.Selected = true;
                                                    rowSection.Focus();
                                                    this.LastListViewItem = rowSection;
                                                    nextComponent.Focus();
                                                }
                                            }
                                        }
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            MoveEmptyRow: function (rowSection) {
                if (this.RowData.Data.contains(rowSection.Entity)) {
                    return;
                }
                if (this.GuiInfo.TopEmpty) {
                    this.RowData.Data.insert(0, rowSection.Entity);
                    if (!this.MainSection.Children.contains(this.EmptyRowSection.FirstChild)) {
                        this.MainSection.Children.insert(0, this.EmptyRowSection.FirstChild);
                    }
                    Core.Extensions.HtmlElementExtension.Prepend(this.MainSection.Element, this.EmptyRowSection.Element.firstElementChild);
                } else {
                    this.RowData.Data.add(rowSection.Entity);
                    this.MainSection.Element.appendChild(this.EmptyRowSection.Element.firstElementChild);
                    if (!this.MainSection.Children.contains(this.EmptyRowSection.FirstChild)) {
                        this.MainSection.Children.add(this.EmptyRowSection.FirstChild);
                    }
                }
                if (this.GuiInfo.IsRealtime) {
                    Core.Extensions.HtmlElementExtension.RemoveClass(rowSection.Element, "new-row");
                }
                rowSection.Parent = this.MainSection;
                rowSection.ListViewSection = this.MainSection;
            },
            ProcessMetaData: function (ds, rowCount) {
                var $t, $t1, $t2;
                var total = ds.length > 1 && ds[System.Array.index(1, ds)].length > 0 ? Bridge.cast(Bridge.unbox(($t = ds[System.Array.index(1, ds)])[System.Array.index(0, $t)].total, System.Int32), System.Int32, true) : null;
                var headers = ds.length > 2 ? System.Linq.Enumerable.from(ds[System.Array.index(2, ds)], System.Object).select(function (x) {
                        return Core.Extensions.BridgeExt.CastProp(Core.Models.Component, x);
                    }).toList(Core.Models.Component) : null;
                this.Settings = ds.length > 3 && ds[System.Array.index(3, ds)].length > 0 ? Bridge.unbox(($t1 = ds[System.Array.index(3, ds)])[System.Array.index(0, $t1)]) : null;
                this.FilterColumns(this.MergeComponent(headers, this.Settings));
                this.RenderTableHeader(this.Header);
                if (this.Paginator != null) {
                    this.Paginator.Options.Total = ($t2 = total, $t2 != null ? $t2 : rowCount);
                }
            },
            RenderTableHeader: function (headers) {
                if (Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.Component, headers)) {
                    headers = this.Header;
                }
                if (this.HeaderSection.Element == null) {
                    this.AddSections();
                }
                Core.Extensions.IEnumerableExtensions.SelectForEach$2(Core.Models.Component, System.Int32, headers, function (x, index) {
                    return (x.PostOrder = index, index);
                });
                this.HeaderSection.DisposeChildren();
                var anyGroup = System.Linq.Enumerable.from(headers, Core.Models.Component).any(function (x) {
                        return !System.String.isNullOrEmpty(x.GroupName);
                    });
                Core.MVVM.Html.Take(this.HeaderSection.Element).Clear().TRow.ForEach$2(Core.Models.Component, headers, Bridge.fn.bind(this, function (header, index) {
                    var $t;
                    if (anyGroup && !System.String.isNullOrEmpty(header.GroupName)) {
                        if (!Bridge.referenceEquals(header, System.Linq.Enumerable.from(headers, Core.Models.Component).firstOrDefault(function (x) {
                                return Bridge.referenceEquals(x.GroupName, header.GroupName);
                            }, null))) {
                            return;
                        }

                        Core.MVVM.Html.Instance.Th.Render();
                        Core.Components.Renderer.ColSpan(Core.MVVM.Html.Instance, System.Linq.Enumerable.from(headers, Core.Models.Component).count(function (x) {
                                return Bridge.referenceEquals(x.GroupName, header.GroupName);
                            }));
                        Core.Components.Renderer.IHtml(Core.MVVM.Html.Instance, header.GroupName).Render();
                        return;
                    }
                    Core.Components.Renderer.TextAlign(Core.Components.Renderer.Width(Core.Components.Renderer.TabIndex(Core.MVVM.Html.Instance.Th, -1).DataAttr$1("field", header.FieldName).DataAttr$1("id", header.Id), header.AutoFit ? "auto" : header.Width).Style$1(System.String.format("{0};min-width: {1}; max-width: {2}", header.Style, header.MinWidth, header.MaxWidth)), Core.Enums.TextAlign.center).Event$4(Core.Models.Component, "contextmenu", Bridge.fn.cacheBind(this, this.HeaderContextMenu), header).Event$1("focusout", Bridge.fn.bind(this, function (e) {
                        this.FocusOutHeader(e, header);
                    })).Event$1("keydown", Bridge.fn.bind(this, function (e) {
                        this.ThHotKeyHandler(e, header);
                    }));
                    this.HeaderSection.AddChild(($t = new Core.Components.Section.ctor(Core.MVVM.Html.Context), $t.GuiInfo = header, $t));
                    if (anyGroup && System.String.isNullOrEmpty(header.GroupName)) {
                        Core.Components.Renderer.RowSpan(Core.MVVM.Html.Instance, 2);
                    }
                    if (!anyGroup && System.Linq.Enumerable.from(this.Header, Core.Models.Component).any(function (x) {
                            return Core.Extensions.StringExt.HasAnyChar(x.GroupName);
                        })) {
                        Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance, "header-group");
                    }
                    if (header.StatusBar) {
                        Core.Components.Renderer.Icon(Core.MVVM.Html.Instance, "fa fa-edit").Event("click", Bridge.fn.cacheBind(this, this.ToggleAll)).End.Render();
                    }
                    var orderBy = ($t = this.AdvSearchVM.OrderBy) != null ? System.Linq.Enumerable.from($t, Core.Models.OrderBy).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.ComId, header.Id);
                        }, null) : null;
                    if (orderBy != null) {
                        Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance, System.Nullable.eq(orderBy.OrderbyDirectionId, Core.Enums.OrderbyDirection.ASC) ? "asc" : "desc").Render();
                    }
                    if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(header.Icon)) {
                        Core.Components.Renderer.Margin(Core.Components.Renderer.Icon(Core.MVVM.Html.Instance, header.Icon), Core.Components.Direction.right, 0).End.Render();
                    } else if (!header.StatusBar) {
                        Core.Components.Renderer.IHtml(Core.MVVM.Html.Instance.Event$1("click", Bridge.fn.bind(this, function (e) {
                            this.ClickHeader(e, header);
                        })), header.ShortDesc).Render();
                    }
                    if (Bridge.referenceEquals(header.ComponentType, "Number")) {
                        Core.MVVM.Html.Instance.Div.End.Render();
                        Core.MVVM.Html.Instance.Span.Style$1("display: block;").End.Render();
                    }
                    if (header.Description != null) {
                        Core.MVVM.Html.Instance.Attr$1("title", header.Description);
                    }
                    if (Core.Clients.Client.CheckHasRole(Core.Enums.RoleEnum.System)) {
                        Core.MVVM.Html.Instance.Attr$1("contenteditable", "true");
                        Core.MVVM.Html.Instance.Event$1("input", Bridge.fn.bind(this, function (e) {
                            this.ChangeHeader(e, header);
                        }));
                    }
                    Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.th);
                })).EndOf(Core.MVVM.ElementType.tr).Render();

                if (anyGroup) {
                    Core.MVVM.Html.Instance.TRow.ForEach$2(Core.Models.Component, headers, Bridge.fn.bind(this, function (header, index) {
                        var $t;
                        if (anyGroup && !System.String.isNullOrEmpty(header.GroupName)) {
                            Core.Components.Renderer.TextAlign(Core.Components.Renderer.Width(Core.MVVM.Html.Instance.Th.DataAttr$1("field", header.FieldName), header.Width).Style$1(System.String.format("min-width: {0}; max-width: {1}", header.MinWidth, header.MaxWidth)), header.TextAlignEnum).Event$4(Core.Models.Component, "contextmenu", Bridge.fn.cacheBind(this, this.HeaderContextMenu), header).InnerHTML(header.ShortDesc);
                            this.HeaderSection.AddChild(($t = new Core.Components.Section.ctor(Core.MVVM.Html.Context.parentElement), $t.GuiInfo = header, $t));
                        }
                    }));
                }
                this.HeaderSection.Children = System.Linq.Enumerable.from(this.HeaderSection.Children, Core.Components.EditableComponent).orderBy(function (x) {
                        return x.GuiInfo.PostOrder;
                    }).toList(Core.Components.EditableComponent);
                if (!this.GuiInfo.Focus) {
                    this.ColumnResizeHandler();
                }
            },
            ChangeHeader: function (e, header) {
                window.clearTimeout(this._imeout);
                this._imeout = window.setTimeout(function () {
                    var $t;
                    var html = Bridge.as(e.target, HTMLElement);
                    var patchVM = ($t = new Core.ViewModels.PatchVM(), $t.Table = "Component", $t.Changes = function (_o1) {
                            var $t1;
                            _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "Id", $t1.Value = header.Id, $t1.OldVal = header.Id, $t1));
                            _o1.add(($t1 = new Core.ViewModels.PatchDetail(), $t1.Field = "ShortDesc", $t1.Value = html.textContent.trim(), $t1.OldVal = header.ShortDesc, $t1));
                            return _o1;
                        }(new (System.Collections.Generic.List$1(Core.ViewModels.PatchDetail)).ctor()), $t);
                    Core.Clients.Client.Instance.PatchAsync(patchVM);
                }, 1000);
            },
            CustomQuery: function (vm) {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                var dsTask = Core.Clients.Client.Instance.ComQuery(vm);
                Core.Clients.Client.ExecTask(System.Array.type(System.Array.type(System.Object)), dsTask, Bridge.fn.bind(this, function (ds) {
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.Array.type(System.Object), ds)) {
                        this.SetRowData(null);
                        tcs.trySetResult(null);
                        return;
                    }
                    var total = ds.length > 1 ? ds[System.Array.index(1, ds)][0].total : ds[System.Array.index(0, ds)].length;
                    if (ds.length >= 3) {
                        this.ProcessMetaData(ds, total);
                    }
                    var rows = new (System.Collections.Generic.List$1(System.Object)).$ctor1(ds[System.Array.index(0, ds)]);
                    this.ClearRowData();
                    this.SetRowData(rows);
                    this.UpdatePagination(total, rows.Count);
                    tcs.trySetResult(rows);
                }));
                return tcs.task;
            },
            MoveLeft: function (header, e) {
                var current = Bridge.as(e.target, HTMLElement);
                var th = current.parentElement;
                var tr = th.parentElement.querySelectorAll("th");
                var index = Core.Extensions.IEnumerableExtensions.FindItemAndIndex(Node, tr, function (x) {
                    return Bridge.referenceEquals(x, th);
                }).Item2;
                th.parentElement.parentElement.parentElement.querySelectorAll('tr').forEach(function(row) {
                    const cells = [].slice.call(row.querySelectorAll('th, td'));
                    if(!cells[0].classList.contains('summary-header')){
                        var draggingColumnIndex = index;
                        var endColumnIndex = index - 1;
                        draggingColumnIndex > endColumnIndex
                            ? cells[endColumnIndex].parentNode && cells[endColumnIndex].parentNode.insertBefore(
                                    cells[draggingColumnIndex],
                                    cells[endColumnIndex]
                                )
                            : cells[endColumnIndex].parentNode && cells[endColumnIndex].parentNode.insertBefore(
                                    cells[draggingColumnIndex],
                                    cells[endColumnIndex].nextSibling
                                );
                    }
                });
                this.SwapList(((index - 1) | 0), ((index - 2) | 0));
                this.SwapHeader(index, ((index - 1) | 0));
                this.ResetOrder();
                this.UpdateHeader();
            },
            MoveRight: function (header, e) {
                var current = Bridge.as(e.target, HTMLElement);
                var th = current.parentElement;
                var tr = th.parentElement.querySelectorAll("th");
                var index = Core.Extensions.IEnumerableExtensions.FindItemAndIndex(Node, tr, function (x) {
                    return Bridge.referenceEquals(x, th);
                }).Item2;
                th.parentElement.parentElement.parentElement.querySelectorAll('tr').forEach(function(row) {
                    const cells = [].slice.call(row.querySelectorAll('th, td'));
                    if(!cells[0].classList.contains('summary-header')){
                        var draggingColumnIndex = index;
                        var endColumnIndex = index + 1;
                        draggingColumnIndex > endColumnIndex
                            ? cells[endColumnIndex].parentNode && cells[endColumnIndex].parentNode.insertBefore(
                                    cells[draggingColumnIndex],
                                    cells[endColumnIndex]
                                )
                            : cells[endColumnIndex].parentNode && cells[endColumnIndex].parentNode.insertBefore(
                                    cells[draggingColumnIndex],
                                    cells[endColumnIndex].nextSibling
                                );
                    }
                });
                this.SwapList(((index - 1) | 0), index);
                this.SwapHeader(index, ((index + 1) | 0));
                this.ResetOrder();
                this.UpdateHeader();
            },
            ChangeFieldOrder: function (header, e) {
                if (this.GuiInfo.CanCache || Core.Extensions.StringExt.IsNullOrWhiteSpace(header.ShortDesc)) {
                    return;
                }

                var sortFields = this.GetSortedFields();
                if (!sortFields.containsKey(header.FieldName)) {
                    sortFields.add(header.FieldName, false);
                }
                var target = e.target;
                var th = Core.MVVM.Html.Take(target).Closest(Core.MVVM.ElementType.th).GetContext();
                var sortEle = th.querySelector(".fa");
                if (sortEle == null) {
                    Core.Components.Renderer.Icon(Core.MVVM.Html.Take(target), "fa fa-sort-amount-up-alt").End.Render();
                } else if (Core.Extensions.HtmlElementExtension.HasClass(sortEle, "fa-sort-amount-down-alt")) {
                    sortFields.remove(header.FieldName);
                    Core.Extensions.HtmlElementExtension.RemoveClass(sortEle, "fa-sort-amount-down-alt");
                } else if (Core.Extensions.HtmlElementExtension.HasClass(sortEle, "fa-sort-amount-up-alt")) {
                    sortFields.setItem(header.FieldName, true);
                    Core.Extensions.HtmlElementExtension.ReplaceClass(sortEle, "fa-sort-amount-up-alt", "fa-sort-amount-down-alt");
                }
                var orderPart = Bridge.toArray(System.Linq.Enumerable.from(sortFields, System.Collections.Generic.KeyValuePair$2(System.String,System.Boolean)).select(function (x) {
                            return (x.key || "") + ((x.value ? " desc" : "") || "");
                        })).join(",");
                this.DataSourceFilter = Core.Extensions.OdataExt.ApplyClause(this.DataSourceFilter, orderPart, Core.Extensions.OdataExt.OrderByKeyword);
                this.UpdateView();
            },
            GetSortedFields: function () {
                var fieldSorts = new (System.Collections.Generic.Dictionary$2(System.String,System.Boolean)).ctor();
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(this.DataSourceFilter)) {
                    return fieldSorts;
                }

                this.DataSourceFilter = this.DataSourceFilter.replace(new RegExp("\\s+"), " ");
                var orderClause = Core.Extensions.OdataExt.GetClausePart(this.DataSourceFilter, Core.Extensions.OdataExt.OrderByKeyword);
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(orderClause)) {
                    return fieldSorts;
                }

                fieldSorts = System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(System.Object, System.String, System.Linq.Enumerable.from(orderClause.split(","), System.String).select(function (x) {
                        if (Core.Extensions.StringExt.IsNullOrWhiteSpace(x)) {
                            return null;
                        }

                        var sortedField = x.split(" ");
                        if (sortedField.length < 1) {
                            return null;
                        }

                        return new $asm.$AnonymousType$13(sortedField[System.Array.index(0, sortedField)], sortedField.length === 2 && Bridge.referenceEquals(sortedField[System.Array.index(1, sortedField)].toLowerCase(), "desc"));
                    }).where(function (x) {
                    return x != null;
                }), function (x) {
                    return x.Field;
                }), System.Object).toDictionary(function (x) {
                        return x.Field;
                    }, function (x) {
                        return x.Desc;
                    }, System.String, System.Boolean);

                return fieldSorts;
            },
            ToggleAll: function () {
                var anySelected = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).any(function (x) {
                        return x.Selected;
                    });
                if (anySelected) {
                    this.ClearSelected();
                    return;
                }
                this.RowAction(function (x) {
                    if (x.EmptyRow) {
                        return;
                    }
                    x.Selected = true;
                });
            },
            HeaderContextMenu: function (e, header) {
                e.preventDefault();
                e.stopPropagation();
                var editForm = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, this);
                var section = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Section, this);
                var menu = Core.Components.Forms.ContextMenu.Instance;
                menu.Top = Core.Extensions.EventExt.Top(e);
                menu.Left = Core.Extensions.EventExt.Left(e);

                menu.MenuItems = Bridge.fn.bind(this, function (_o1) {
                        var $t;
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-eye", $t.Text = "Hi\u1ec7n ti\u00eau \u0111\u1ec1", $t.Click = Bridge.fn.cacheBind(this, this.ShowWidth), $t.Parameter = new $asm.$AnonymousType$14(header, e), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-eye-slash", $t.Text = "\u1ea8n ti\u00eau \u0111\u1ec1", $t.Click = Bridge.fn.cacheBind(this, this.HideWidth), $t.Parameter = new $asm.$AnonymousType$14(header, e), $t));
                        _o1.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = header.Frozen ? "fal fa-snowflakes" : "fal fa-snowflake", $t.Text = header.Frozen ? "H\u1ee7y \u0111\u1ecbnh c\u1ed9t" : "C\u1ed1 \u0111\u1ecbnh c\u1ed9t", $t.Click = Bridge.fn.cacheBind(this, this.FrozenColumn), $t.Parameter = new $asm.$AnonymousType$14(header, e), $t));
                        return _o1;
                    })(new (System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem)).ctor());
                if (Core.Clients.Client.SystemRole) {
                    menu.MenuItems.AddRange(Bridge.fn.bind(this, function (_o2) {
                            var $t;
                            _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-wrench", $t.Text = "T\u00f9y ch\u1ecdn c\u1ed9t d\u1eef li\u1ec7u", $t.Click = Bridge.fn.cacheBind(editForm, editForm.ComponentProperties), $t.Parameter = header, $t));
                            _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-clone", $t.Text = "Clone c\u1ed9t", $t.Click = Bridge.fn.cacheBind(this, this.CloneHeader), $t.Parameter = header, $t));
                            _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-trash-alt", $t.Text = "X\u00f3a c\u1ed9t", $t.Click = Bridge.fn.cacheBind(this, this.RemoveHeader), $t.Parameter = header, $t));
                            _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-cog", $t.Text = "T\u00f9y ch\u1ecdn b\u1ea3ng d\u1eef li\u1ec7u", $t.Click = Bridge.fn.cacheBind(editForm, editForm.ComponentProperties), $t.Parameter = this.GuiInfo, $t));
                            _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-cogs", $t.Text = "T\u00f9y ch\u1ecdn v\u00f9ng d\u1eef li\u1ec7u", $t.Click = Bridge.fn.cacheBind(editForm, editForm.SectionProperties), $t.Parameter = section.ComponentGroup, $t));
                            _o2.add(($t = new Core.Components.Forms.ContextMenuItem(), $t.Icon = "fal fa-folder-open", $t.Text = "Thi\u1ebft l\u1eadp chung", $t.Click = Bridge.fn.cacheBind(editForm, editForm.FeatureProperties), $t.Parameter = editForm.Feature, $t));
                            return _o2;
                        })(new (System.Collections.Generic.List$1(Core.Components.Forms.ContextMenuItem)).ctor()));
                }
                menu.Render();
            },
            UpdateHeader: function () {
                var isSave = window.localStorage.getItem("isSave");
                if (isSave == null) {
                    window.clearTimeout(this.awaiter1);
                    this.awaiter1 = window.setTimeout(Bridge.fn.bind(this, function () {
                        Core.Extensions.EventExt.Done$1(System.Boolean, this.UpdateSetting(this.Settings, "ListView", this.GetHeaderSettings()));
                    }), 100);
                }
            },
            HideWidth: function (arg) {
                var entity = Bridge.as(arg.header, Core.Models.Component);
                var e = Bridge.as(arg.events, Event);
                Core.Extensions.EventExt.Done$1(System.Boolean, this.UpdateSetting(this.Settings, "ListView", this.GetHeaderSettings()));
            },
            GetHeaderSettings: function () {
                var headerElement = System.Linq.Enumerable.from(this.HeaderSection.Children, Core.Components.EditableComponent).where(function (x) {
                        var $t;
                        return (($t = x.GuiInfo) != null ? $t.Id : null) != null;
                    }).toDictionary(function (x) {
                        return x.GuiInfo.Id;
                    }, null, System.String, Core.Components.EditableComponent);
                var columns = System.Linq.Enumerable.from(this.Header, Core.Models.Component).where(function (x) {
                        return x.Id != null;
                    }).select(function (x) {
                    var match = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, Core.Components.EditableComponent, headerElement, x.Id);
                    if (match == null) {
                        return null;
                    }
                    x.Width = match.Element.offsetWidth + "px";
                    x.MaxWidth = match.Element.offsetWidth + "px";
                    x.MinWidth = match.Element.offsetWidth + "px";
                    return x;
                }).where(function (x) {
                    return x != null;
                }).ToArray(Core.Models.Component);
                var value = Newtonsoft.Json.JsonConvert.SerializeObject(columns);
                return value;
            },
            ShowWidth: function (arg) {
                var entity = Bridge.as(arg.header, Core.Models.Component);
                var e = Bridge.as(arg.events, Event);
                Core.Extensions.EventExt.Done$1(System.Boolean, this.UpdateSetting(this.Settings, "ListView", this.GetHeaderSettings()));
            },
            FrozenColumn: function (arg) {
                var entity = Bridge.as(arg.header, Core.Models.Component);
                System.Linq.Enumerable.from(this.Header, Core.Models.Component).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.Id, entity.Id);
                    }, null).Frozen = !entity.Frozen;
                Core.Extensions.EventExt.Done$1(System.Boolean, this.UpdateSetting(this.Settings, "ListView", this.GetHeaderSettings()), Bridge.fn.bind(this, function (x) {
                    this.ReloadData(false, void 0, void 0);
                }));
            },
            CloneHeader: function (arg) {
                var $t;
                var entity = Bridge.as(arg, Core.Models.Component);
                var confirm = ($t = new Core.Components.Forms.ConfirmDialog(), $t.Content = "B\u1ea1n c\u00f3 ch\u1eafc ch\u1eafn mu\u1ed1n clone c\u1ed9t n\u00e0y kh\u00f4ng?", $t);
                confirm.Render();
                confirm.YesConfirmed = Bridge.fn.combine(confirm.YesConfirmed, Bridge.fn.bind(this, function () {
                    var cloned = Bridge.as(Core.Clients.XHRWrapper.UnboxValue(entity), Core.Models.Component);
                    cloned.Id = Core.Structs.Uuid7.Id25();
                    var patch = Core.Components.Extensions.ComponentExt.MapToPatch(Core.Models.Component, cloned);
                    Core.Extensions.EventExt.Done$1(System.Int32, Core.Clients.Client.Instance.PatchAsync(patch), Bridge.fn.bind(this, function (success) {
                        if (success === 0) {
                            Core.Extensions.Toast.Warning("Clone error");
                            return;
                        }
                        this.Header.add(cloned);
                        this.Header = System.Linq.Enumerable.from(this.Header, Core.Models.Component).orderByDescending(function (x) {
                                return x.Frozen;
                            }).thenByDescending(function (header) {
                            return Bridge.referenceEquals(header.ComponentType, "Button");
                        }).thenBy(function (x) {
                            return x.Order;
                        }).toList(Core.Models.Component);
                        this.Rerender();
                        Core.Extensions.Toast.Success("Clone success");
                    }));
                }));
            },
            RemoveHeader: function (arg) {
                var $t;
                var entity = Bridge.as(arg, Core.Models.Component);
                var confirm = ($t = new Core.Components.Forms.ConfirmDialog(), $t.Content = "B\u1ea1n c\u00f3 ch\u1eafc ch\u1eafn mu\u1ed1n x\u00f3a c\u1ed9t n\u00e0y kh\u00f4ng?", $t);
                confirm.Render();
                confirm.YesConfirmed = Bridge.fn.combine(confirm.YesConfirmed, Bridge.fn.bind(this, function () {
                    var ids = System.Array.init([entity.Id], System.String);
                    Core.Extensions.EventExt.Done$1(System.Array.type(System.String), Core.Clients.Client.Instance.HardDeleteAsync(ids, "Component", this.ConnKey), Bridge.fn.bind(this, function (delIds) {
                        if (Core.Extensions.IEnumerableExtensions.HasElement(System.String, delIds)) {
                            Core.Extensions.Toast.Success("Delete success");
                            this.Header.remove(entity);
                            this.Rerender();
                        } else {
                            Core.Extensions.Toast.Warning("delete error");
                        }
                    }));
                }));
            },
            RemoveRowById: function (id) {
                Core.Components.ListView.prototype.RemoveRowById.call(this, id);
                this.RenderIndex();
            },
            RemoveRow: function (row) {
                Core.Components.ListView.prototype.RemoveRow.call(this, row);
                this.RenderIndex();
            },
            HardDeleteConfirmed: function (deleted) {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done$1(System.Collections.Generic.List$1(System.Object), Core.Components.ListView.prototype.HardDeleteConfirmed.call(this, deleted), Bridge.fn.bind(this, function (res) {
                    this.RenderIndex();
                    if (this.GuiInfo.IsSumary) {
                        this.AddSummaries();
                    }
                    tcs.trySetResult(res);
                }));
                return tcs.task;
            },
            UpdateView: function (force, dirty, componentNames) {
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                if (!this.Editable && !this.GuiInfo.CanCache) {
                    if (force) {
                        this.DisposeNoRecord();
                        this.ListViewSearch.RefershListView();
                    }
                } else {
                    this.RowAction$2(function (row) {
                        return !row.EmptyRow;
                    }, function (row) {
                        row.UpdateView(force, dirty, componentNames);
                    });
                }
            },
            RowChangeHandlerGrid: function (rowData, rowSection, observableArgs, component) {
                var $step = 0,
                    $task1, 
                    $task2, 
                    $taskResult2, 
                    $task3, 
                    $taskResult3, 
                    $task4, 
                    $taskResult4, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    headers, 
                    currentComponent, 
                    index, 
                    nextGrid, 
                    nextComponent, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3,4,5,6], $step);
                                switch ($step) {
                                    case 0: {
                                        if (component === void 0) { component = null; }
                                        $task1 = System.Threading.Tasks.Task.delay(Core.Components.GridView.CellCountNoSticky);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $task1.getAwaitedResult();
                                        if (rowSection.EmptyRow && observableArgs.EvType === "change") {
                                            $step = 2;
                                            continue;
                                        } 
                                        $step = 5;
                                        continue;
                                    }
                                    case 2: {
                                        $task2 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforeCreated, [rowData]);
                                        $step = 3;
                                        if ($task2.isCompleted()) {
                                            continue;
                                        }
                                        $task2.continue($asyncBody);
                                        return;
                                    }
                                    case 3: {
                                        $taskResult2 = $task2.getAwaitedResult();
                                        rowSection.EmptyRow = false;
                                        this.MoveEmptyRow(rowSection);
                                        headers = System.Linq.Enumerable.from(this.Header, Core.Models.Component).where(function (y) {
                                            return y.Editable;
                                        }).toList(Core.Models.Component);
                                        currentComponent = System.Linq.Enumerable.from(headers, Core.Models.Component).firstOrDefault(function (y) {
                                            return Bridge.referenceEquals(y.FieldName, component.FieldName);
                                        }, null);
                                        index = headers.indexOf(currentComponent);
                                        if (headers.Count > ((index + 1) | 0)) {
                                            nextGrid = headers.getItem(((index + 1) | 0));
                                            nextComponent = System.Linq.Enumerable.from(rowSection.Children, Core.Components.EditableComponent).where(function (y) {
                                                return Bridge.referenceEquals(y.FieldName, nextGrid.FieldName);
                                            }).firstOrDefault(null, null);
                                            nextComponent.Focus();
                                        }
                                        this.EmptyRowSection.Children.clear();
                                        this.AddNewEmptyRow();
                                        Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this.RowData.Data);
                                        $task3 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterCreated, [rowData]);
                                        $step = 4;
                                        if ($task3.isCompleted()) {
                                            continue;
                                        }
                                        $task3.continue($asyncBody);
                                        return;
                                    }
                                    case 4: {
                                        $taskResult3 = $task3.getAwaitedResult();
                                        $step = 5;
                                        continue;
                                    }
                                    case 5: {
                                        this.AddSummaries();
                                        this.PopulateFields$1();
                                        this.RenderIndex();
                                        $task4 = Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [rowData]);
                                        $step = 6;
                                        if ($task4.isCompleted()) {
                                            continue;
                                        }
                                        $task4.continue($asyncBody);
                                        return;
                                    }
                                    case 6: {
                                        $taskResult4 = $task4.getAwaitedResult();
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            GetViewPortItem: function () {
                var $t, $t1;
                if (this.Element == null || !Core.Extensions.HtmlElementExtension.HasClass(this.Element, System.Enum.toString(Core.Components.Position, Core.Components.Position.sticky))) {
                    return System.Linq.Enumerable.from(this.RowData.Data, System.Object).count();
                }
                var mainSectionHeight = (((((this.Element.clientHeight - (($t = (($t1 = this.HeaderSection.Element) != null ? $t1.clientHeight : null), $t != null ? $t : 0))) | 0) - this.Paginator.Element.clientHeight) | 0) - this._theadTable) | 0;
                this.Header = System.Linq.Enumerable.from(this.Header, Core.Models.Component).where(function (x) {
                        return x != null;
                    }).toList(Core.Models.Component);
                if (!System.Linq.Enumerable.from(this.Header, Core.Models.Component).all(function (x) {
                        return Core.Extensions.StringExt.IsNullOrEmpty(x.Summary);
                    })) {
                    mainSectionHeight = (mainSectionHeight - this._tfooterTable) | 0;
                }
                if (this.GuiInfo.CanAdd) {
                    mainSectionHeight = (mainSectionHeight - this._rowHeight) | 0;
                }
                return this.GetRowCountByHeight(mainSectionHeight);
            }
        }
    });

    Bridge.define("$AnonymousType$11", $asm, {
        $kind: "anonymous",
        ctors: {
            ctor: function (reasonOfChange) {
                this.ReasonOfChange = reasonOfChange;
            }
        },
        methods: {
            equals: function (o) {
                if (!Bridge.is(o, $asm.$AnonymousType$11)) {
                    return false;
                }
                return Bridge.equals(this.ReasonOfChange, o.ReasonOfChange);
            },
            getHashCode: function () {
                var h = Bridge.addHash([7550208730, this.ReasonOfChange]);
                return h;
            },
            toJSON: function () {
                return {
                    ReasonOfChange : this.ReasonOfChange
                };
            }
        },
        statics : {
            methods: {
                $metadata : function () { return {"m":[{"a":2,"n":"ReasonOfChange","t":16,"rt":System.String,"g":{"a":2,"n":"get_ReasonOfChange","t":8,"rt":System.String,"fg":"ReasonOfChange"},"fn":"ReasonOfChange"}]}; }
            }
        }
    });

    Bridge.define("$AnonymousType$12", $asm, {
        $kind: "anonymous",
        ctors: {
            ctor: function (operator, operatorText, value, fieldName, valueText, shift) {
                this.Operator = operator;
                this.OperatorText = operatorText;
                this.Value = value;
                this.FieldName = fieldName;
                this.ValueText = valueText;
                this.Shift = shift;
            }
        },
        methods: {
            equals: function (o) {
                if (!Bridge.is(o, $asm.$AnonymousType$12)) {
                    return false;
                }
                return Bridge.equals(this.Operator, o.Operator) && Bridge.equals(this.OperatorText, o.OperatorText) && Bridge.equals(this.Value, o.Value) && Bridge.equals(this.FieldName, o.FieldName) && Bridge.equals(this.ValueText, o.ValueText) && Bridge.equals(this.Shift, o.Shift);
            },
            getHashCode: function () {
                var h = Bridge.addHash([7550208986, this.Operator, this.OperatorText, this.Value, this.FieldName, this.ValueText, this.Shift]);
                return h;
            },
            toJSON: function () {
                return {
                    Operator : this.Operator,
                    OperatorText : this.OperatorText,
                    Value : this.Value,
                    FieldName : this.FieldName,
                    ValueText : this.ValueText,
                    Shift : this.Shift
                };
            }
        },
        statics : {
            methods: {
                $metadata : function () { return {"m":[{"a":2,"n":"FieldName","t":16,"rt":System.String,"g":{"a":2,"n":"get_FieldName","t":8,"rt":System.String,"fg":"FieldName"},"fn":"FieldName"},{"a":2,"n":"Operator","t":16,"rt":System.Int32,"g":{"a":2,"n":"get_Operator","t":8,"rt":System.Int32,"fg":"Operator","box":function ($v) { return Bridge.box($v, System.Int32);}},"fn":"Operator"},{"a":2,"n":"OperatorText","t":16,"rt":System.String,"g":{"a":2,"n":"get_OperatorText","t":8,"rt":System.String,"fg":"OperatorText"},"fn":"OperatorText"},{"a":2,"n":"Shift","t":16,"rt":System.Boolean,"g":{"a":2,"n":"get_Shift","t":8,"rt":System.Boolean,"fg":"Shift","box":function ($v) { return Bridge.box($v, System.Boolean, System.Boolean.toString);}},"fn":"Shift"},{"a":2,"n":"Value","t":16,"rt":System.String,"g":{"a":2,"n":"get_Value","t":8,"rt":System.String,"fg":"Value"},"fn":"Value"},{"a":2,"n":"ValueText","t":16,"rt":System.String,"g":{"a":2,"n":"get_ValueText","t":8,"rt":System.String,"fg":"ValueText"},"fn":"ValueText"}]}; }
            }
        }
    });

    Bridge.define("$AnonymousType$13", $asm, {
        $kind: "anonymous",
        ctors: {
            ctor: function (field, desc) {
                this.Field = field;
                this.Desc = desc;
            }
        },
        methods: {
            equals: function (o) {
                if (!Bridge.is(o, $asm.$AnonymousType$13)) {
                    return false;
                }
                return Bridge.equals(this.Field, o.Field) && Bridge.equals(this.Desc, o.Desc);
            },
            getHashCode: function () {
                var h = Bridge.addHash([7550209242, this.Field, this.Desc]);
                return h;
            },
            toJSON: function () {
                return {
                    Field : this.Field,
                    Desc : this.Desc
                };
            }
        },
        statics : {
            methods: {
                $metadata : function () { return {"m":[{"a":2,"n":"Desc","t":16,"rt":System.Boolean,"g":{"a":2,"n":"get_Desc","t":8,"rt":System.Boolean,"fg":"Desc","box":function ($v) { return Bridge.box($v, System.Boolean, System.Boolean.toString);}},"fn":"Desc"},{"a":2,"n":"Field","t":16,"rt":System.String,"g":{"a":2,"n":"get_Field","t":8,"rt":System.String,"fg":"Field"},"fn":"Field"}]}; }
            }
        }
    });

    Bridge.define("$AnonymousType$14", $asm, {
        $kind: "anonymous",
        ctors: {
            ctor: function (header, events) {
                this.header = header;
                this.events = events;
            }
        },
        methods: {
            equals: function (o) {
                if (!Bridge.is(o, $asm.$AnonymousType$14)) {
                    return false;
                }
                return Bridge.equals(this.header, o.header) && Bridge.equals(this.events, o.events);
            },
            getHashCode: function () {
                var h = Bridge.addHash([7550209498, this.header, this.events]);
                return h;
            },
            toJSON: function () {
                return {
                    header : this.header,
                    events : this.events
                };
            }
        },
        statics : {
            methods: {
                $metadata : function () { return {"m":[{"a":2,"n":"events","t":16,"rt":Event,"g":{"a":2,"n":"get_events","t":8,"rt":Event,"fg":"events"},"fn":"events"},{"a":2,"n":"header","t":16,"rt":Core.Models.Component,"g":{"a":2,"n":"get_header","t":8,"rt":Core.Models.Component,"fg":"header"},"fn":"header"}]}; }
            }
        }
    });

    Bridge.define("Core.Components.Forms.ConfirmDialog", {
        inherits: [Core.Components.Forms.EditForm],
        statics: {
            methods: {
                RenderConfirm: function (content, yesConfirm, noConfirm) {
                    var $t;
                    if (noConfirm === void 0) { noConfirm = null; }
                    var confirm = ($t = new Core.Components.Forms.ConfirmDialog(), $t.Content = content, $t);
                    confirm.Render();
                    confirm.YesConfirmed = Bridge.fn.combine(confirm.YesConfirmed, yesConfirm);
                    confirm.NoConfirmed = Bridge.fn.combine(confirm.NoConfirmed, noConfirm);
                    return confirm;
                },
                RenderConfirm$1: function (content, textButton) {
                    var $t;
                    if (textButton === void 0) { textButton = "\u0110\u00f3ng"; } /// Simplify object initialization


                    var dialog = ($t = new Core.Components.Forms.ConfirmDialog(), $t.Content = content, $t);
                    dialog.YesText = textButton;
                    dialog.IgnoreNoButton = true;
                    dialog.Render();
                    return dialog;
                }
            }
        },
        fields: {
            _yesBtn: null,
            PElement: null,
            Precision: null,
            YesConfirmed: null,
            NoConfirmed: null,
            Canceled: null
        },
        props: {
            OpenEditForm: null,
            Textbox: null,
            Number: null,
            Datepicker: null,
            SearchEntry: null,
            IgnoreNoButton: false,
            MultipleLine: false,
            YesText: null,
            NoText: null,
            CancelText: null,
            Content: null,
            NeedAnswer: false,
            ComType: null,
            IgnoreCancelButton: false,
            DisposeAfterYes: false
        },
        ctors: {
            init: function () {
                this.MultipleLine = true;
                this.YesText = "\u0110\u1ed3ng \u00fd";
                this.NoText = "Kh\u00f4ng";
                this.CancelText = "\u0110\u00f3ng";
                this.Content = "B\u1ea1n c\u00f3 ch\u1eafc ch\u1eafn mu\u1ed1n x\u00f3a d\u1eef li\u1ec7u?";
                this.ComType = "Textbox";
                this.IgnoreCancelButton = true;
                this.DisposeAfterYes = true;
            },
            ctor: function () {
                this.$initialize();
                Core.Components.Forms.EditForm.ctor.call(this, null);
                this.PopulateDirty = false;
                this.Title = "X\u00e1c nh\u1eadn";
            }
        },
        methods: {
            Render: function () {
                var $t, $t1;
                Core.Components.Renderer.Escape(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.PElement || document.body).Div, "backdrop").Style$1("align-items: center;"), Bridge.fn.bind(this, function (e) {
                    this.Dispose();
                }));
                if (this.PElement != null) {
                    Core.MVVM.Html.Instance.Style$1("position: fixed !important;");
                }
                this.Element = Core.MVVM.Html.Context;
                this.ParentElement = this.Element.parentElement;
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.IHtml(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "popup-content confirm-dialog").Style$1("top: auto;").Div, "popup-title"), this.Title).Div, "icon-box").Span, "fa fa-times").Event("click", Bridge.fn.cacheBind(this, this.CloseDispose)).EndOf$1(".popup-title").Div, "popup-body");

                Core.Components.Renderer.MarginRem(Core.Components.Renderer.IHtml(Core.MVVM.Html.Instance.P, this.Content).End.Div.Event$1("keydown", Bridge.fn.cacheBind(this, this.HotKeyHandler)), Core.Components.Direction.top, 1);
                if (this.NeedAnswer) {
                    if (Bridge.referenceEquals(this.ComType, "Textbox")) {
                        this.Textbox = ($t = new Core.Components.Textbox(($t1 = new Core.Models.Component(), $t1.PlainText = "Nh\u1eadp c\u00e2u tr\u1ea3 l\u1eddi", $t1.ShowLabel = false, $t1.FieldName = Core.Components.CompareGridView.ReasonOfChange, $t1.Row = 2, $t1)), $t.MultipleLine = this.MultipleLine, $t);
                        this.AddChild(this.Textbox);
                        Core.MVVM.Html.Instance.End.Render();
                    }
                    if (Bridge.referenceEquals(this.ComType, "Number")) {
                        this.Number = new Core.Components.Number(($t = new Core.Models.Component(), $t.PlainText = "Nh\u1eadp c\u00e2u tr\u1ea3 l\u1eddi", $t.FieldName = Core.Components.CompareGridView.ReasonOfChange, $t.Visibility = true, $t.ShowLabel = false, $t));
                        this.AddChild(this.Number);
                        Core.MVVM.Html.Instance.End.Render();
                    }
                    if (Bridge.referenceEquals(this.ComType, "Datepicker")) {
                        this.Datepicker = new Core.Components.Datepicker(($t = new Core.Models.Component(), $t.PlainText = "Ch\u1ecdn ng\u00e0y", $t.ShowLabel = false, $t.FieldName = Core.Components.CompareGridView.ReasonOfChange, $t.Row = 2, $t.FocusSearch = true, $t.Visibility = true, $t.Precision = this.Precision, $t));
                        this.AddChild(this.Datepicker);
                        Core.MVVM.Html.Instance.EndOf$1(".datetime-picker");
                    }
                }
                Core.Components.Renderer.Button(Core.MVVM.Html.Instance, this.YesText, "button info small", "fa fa-check").Event("click", Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        isValid, 
                        ex, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        $task1 = this.IsFormValid();
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        isValid = $taskResult1;
                                        if (!isValid) {
                                            return;
                                        }

                                        try {
                                            !Bridge.staticEquals(this.YesConfirmed, null) ? this.YesConfirmed() : null;
                                        } catch (ex) {
                                            ex = System.Exception.create(ex);
                                            System.Console.WriteLine(ex.StackTrace);
                                        }
                                        if (this.DisposeAfterYes) {
                                            this.Dispose();
                                        }
                                        return;
                                    }
                                    default: {
                                        return;
                                    }
                                }
                            }
                        }, arguments);

                    $asyncBody();
                })).Render();
                this._yesBtn = Core.MVVM.Html.Context;
                Core.MVVM.Html.Instance.End.Render();
                if (!this.IgnoreNoButton) {
                    Core.Components.Renderer.MarginRem(Core.Components.Renderer.Button(Core.MVVM.Html.Instance, this.NoText, "button alert small", "mif-exit"), Core.Components.Direction.left, 1).Event("click", Bridge.fn.bind(this, function () {
                        try {
                            !Bridge.staticEquals(this.NoConfirmed, null) ? this.NoConfirmed() : null;
                        } catch (ex) {
                            ex = System.Exception.create(ex);
                            System.Console.WriteLine(ex.StackTrace);
                        }
                        this.CloseDispose();
                    })).End.Render();
                }

                if (!this.IgnoreCancelButton) {
                    Core.Components.Renderer.MarginRem(Core.Components.Renderer.Button(Core.MVVM.Html.Instance, this.CancelText, "button info small", "fa fa-times"), Core.Components.Direction.left, 1).Event("click", Bridge.fn.bind(this, function () {
                        this.Dispose();
                    }));
                }

                if (this.NeedAnswer) {
                    if (this.Textbox != null) {
                        this.Textbox.Element.focus();
                    }
                    if (this.Datepicker != null) {
                        this.Datepicker.Element.focus();
                    }
                    if (this.Number != null) {
                        this.Number.Element.focus();
                    }
                } else {
                    this._yesBtn.focus();
                }
            },
            Dispose: function () {
                Core.Components.Forms.EditForm.prototype.Dispose.call(this);
            },
            CloseDispose: function () {
                !Bridge.staticEquals(this.Canceled, null) ? this.Canceled() : null;
                Core.Components.Forms.EditForm.prototype.Dispose.call(this);
            },
            HotKeyHandler: function (e) {
                var keyCode = Core.Extensions.EventExt.KeyCodeEnum(e);
                if (System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.Enter)) {
                    this._yesBtn.click();
                }
            }
        }
    });

    Bridge.define("Core.Components.Forms.TabComponent", {
        inherits: [Core.Components.Section],
        statics: {
            fields: {
                ActiveClass: null
            },
            ctors: {
                init: function () {
                    this.ActiveClass = "active";
                }
            }
        },
        fields: {
            _li: null,
            _badge: null,
            BadgeElement: null,
            _displayBadge: false
        },
        props: {
            HasRendered: false,
            NextTab: {
                get: function () {
                    var count = System.Linq.Enumerable.from(this.Parent.Children, Core.Components.EditableComponent).count();
                    var thisIndex = this.Parent.Children.indexOf(this);
                    if (thisIndex === count) {
                        return Bridge.cast(System.Linq.Enumerable.from(this.Parent.Children, Core.Components.EditableComponent).firstOrDefault(null, null), Core.Components.Forms.TabComponent);
                    } else {
                        return Bridge.cast(this.Parent.Children.getItem(((thisIndex + 1) | 0)), Core.Components.Forms.TabComponent);
                    }
                }
            },
            Badge: {
                get: function () {
                    return this._badge;
                },
                set: function (value) {
                    this._badge = value;
                    if (this.BadgeElement != null) {
                        this.BadgeElement.textContent = this._badge;
                    }
                }
            },
            DisplayBadge: {
                get: function () {
                    return this._displayBadge;
                },
                set: function (value) {
                    this._displayBadge = value;
                    if (value) {
                        Core.Extensions.HtmlElementExtension.Show(this.BadgeElement);
                    } else {
                        Core.Extensions.HtmlElementExtension.Hide(this.BadgeElement);
                    }
                }
            },
            Show: {
                get: function () {
                    return Bridge.ensureBaseProperty(this, "Show").$Core$Components$EditableComponent$Show;
                },
                set: function (value) {
                    if (this._li == null) {
                        return;
                    }

                    Bridge.ensureBaseProperty(this, "Show").$Core$Components$EditableComponent$Show = value;
                    if (value) {
                        Core.Extensions.HtmlElementExtension.AddClass(this._li, Core.Components.Forms.TabComponent.ActiveClass);
                        Core.Extensions.HtmlElementExtension.AddClass(this._li.querySelector(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.a)), Core.Components.Forms.TabComponent.ActiveClass);
                        Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.ComponentGroup.Events, "focusin", [this.Entity]));
                    } else {
                        Core.Extensions.HtmlElementExtension.RemoveClass(this._li, Core.Components.Forms.TabComponent.ActiveClass);
                        Core.Extensions.HtmlElementExtension.RemoveClass(this._li.querySelector(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.a)), Core.Components.Forms.TabComponent.ActiveClass);
                        Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.ComponentGroup.Events, "focusout", [this.Entity]));
                    }
                }
            },
            Disabled: {
                get: function () {
                    return Bridge.ensureBaseProperty(this, "Disabled").$Core$Components$EditableComponent$Disabled;
                },
                set: function (value) {
                    if (this._li == null) {
                        return;
                    }

                    if (value) {
                        this._li.setAttribute("disabled", "");
                    } else {
                        this._li.removeAttribute("disabled");
                    }
                }
            },
            Hidden: {
                get: function () {
                    return Bridge.ensureBaseProperty(this, "Disabled").$Core$Components$EditableComponent$Disabled;
                },
                set: function (value) {
                    this._li.hidden = value;
                    if (this.Show) {
                        this.Show = false;
                    } else {
                        return;
                    }

                    if (this.NextTab.HasRendered) {
                        this.NextTab.Focus();
                    } else {
                        this.NextTab.RenderTabContent();
                        this.NextTab.Focus();
                    }
                }
            }
        },
        ctors: {
            ctor: function (group) {
                this.$initialize();
                Core.Components.Section.ctor.call(this, null);
                this.ComponentGroup = group;
                this.Name = group.Name;
            }
        },
        methods: {
            Render: function () {
                var $t, $t1, $t2, $t3;
                var policies = this.EditForm.GetElementPolicies$1(System.Array.init([this.ComponentGroup.Id], System.String), Core.Extensions.Utils.ComponentGroupId);
                var readPermission = !this.ComponentGroup.IsPrivate || Core.Extensions.IEnumerableExtensions.HasElementAndAll(Core.Models.FeaturePolicy, policies, function (x) {
                    return x.CanRead;
                });
                if (!readPermission) {
                    return;
                }

                Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Parent.Ul).Li.A, "nav-link tab-default").I, ($t = this.ComponentGroup.Icon, $t != null ? $t : "")).End, ($t1 = this.ComponentGroup.Label, $t1 != null ? $t1 : this.ComponentGroup.Name)).Span, "ml-1 badge badge-warning");
                this.BadgeElement = Core.MVVM.Html.Context;
                if (this.DisplayBadge) {
                    Core.MVVM.Html.Instance.Text(($t2 = this.Badge, $t2 != null ? $t2 : ""));
                } else {
                    Core.Extensions.HtmlElementExtension.Hide(this.BadgeElement);
                }

                this._li = Core.MVVM.Html.Context.parentElement.parentElement;
                Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div, "desc"), ($t3 = this.ComponentGroup.Description, $t3 != null ? $t3 : "")).End.Render();
                this._li.addEventListener("click", Bridge.fn.bind(this, function () {
                    if (this.HasRendered) {
                        this.Focus();
                    } else {
                        this.Focus();
                        this.RenderTabContent();
                    }
                }));
            },
            RenderTabContent: function () {
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Parent.TabContent).Div, "tab-content");
                this.Element = Core.MVVM.Html.Context;
                var editForm = Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.Forms.EditForm, this);
                Core.Components.Section.RenderSection(this, this.ComponentGroup);
                this.HasRendered = true;
                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.ComponentGroup.Events, "DOMContentLoaded", [this.Entity]));
            },
            Focus: function () {
                System.Linq.Enumerable.from(this.Parent.Children).select(function (x) { return Bridge.cast(x, Core.Components.Forms.TabComponent); }).where(Bridge.fn.bind(this, function (x) {
                        return !Bridge.referenceEquals(x, this);
                    })).ToArray(Core.Components.Forms.TabComponent).forEach(function (x) {
                        x.Show = false;
                    });
                this.Show = true;
                this.EditForm.ResizeListView();
                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.ComponentGroup.Events, "focusin", [this.Entity]));
            }
        }
    });

    Bridge.define("Core.Components.ListViewItem", {
        inherits: [Core.Components.Section],
        statics: {
            fields: {
                EmptyRowClass: null,
                SelectedClass: null,
                FocusedClass: null,
                HoveringClass: null,
                CmdUrl: null,
                NotCellText: null
            },
            ctors: {
                init: function () {
                    this.EmptyRowClass = "empty-row";
                    this.SelectedClass = "__selected__";
                    this.FocusedClass = "focus";
                    this.HoveringClass = "hovering";
                    this.CmdUrl = "Cmd";
                    this.NotCellText = System.Array.init(["Button", "Image", "Checkbox"], System.String);
                }
            }
        },
        fields: {
            _selected: false,
            _focused: false,
            _emptyRow: false,
            PatchModel: null
        },
        props: {
            GroupSection: null,
            lastpathModel: null,
            ListViewSection: null,
            ListView: null,
            PreQueryFn: null,
            RowNo: 0,
            Selected: {
                get: function () {
                    return this._selected;
                },
                set: function (value) {
                    var $t;
                    this._selected = value;
                    this.SetSelected(value);
                    var id = ($t = this.Entity[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null;
                    if (value) {
                        if (!this.ListViewSection.ListView.SelectedIds.contains(id)) {
                            this.ListViewSection.ListView.SelectedIds.add(id);
                        }
                    } else {
                        this.ListViewSection.ListView.SelectedIds.remove(id);
                    }
                }
            },
            Focused: {
                get: function () {
                    return this._focused;
                },
                set: function (value) {
                    this._focused = value;
                    if (value) {
                        Core.Extensions.HtmlElementExtension.AddClass(this.Element, Core.Components.ListViewItem.FocusedClass);
                    } else {
                        Core.Extensions.HtmlElementExtension.RemoveClass(this.Element, Core.Components.ListViewItem.FocusedClass);
                    }

                    var id = Bridge.unbox(this.Entity[Core.Components.EditableComponent.IdField]);
                    if (value) {
                        this.ListViewSection.ListView.FocusId = id;
                    } else {
                        this.ListViewSection.ListView.FocusId = null;
                    }
                }
            },
            EmptyRow: {
                get: function () {
                    return this._emptyRow;
                },
                set: function (value) {
                    this._emptyRow = value;
                    if (value) {
                        Core.Extensions.HtmlElementExtension.AddClass(this.Element, Core.Components.ListViewItem.EmptyRowClass);
                    } else {
                        Core.Extensions.HtmlElementExtension.RemoveClass(this.Element, Core.Components.ListViewItem.EmptyRowClass);
                    }

                    Core.Extensions.IEnumerableExtensions.SelectForEach(Core.Components.EditableComponent, this.FilterChildren(Core.Components.EditableComponent), function (x) {
                        x.EmptyRow = value;
                    });
                    this.AlwaysValid = value;
                }
            },
            GroupRow: false,
            Show: {
                get: function () {
                    return Bridge.ensureBaseProperty(this, "Show").$Core$Components$EditableComponent$Show;
                },
                set: function (value) {
                    this.Toggle(value);
                }
            }
        },
        ctors: {
            init: function () {
                this.PatchModel = new (System.Collections.Generic.List$1(Core.ViewModels.PatchDetail)).ctor();
            },
            ctor: function (elementType) {
                if (elementType === void 0) { elementType = 96; }

                this.$initialize();
                Core.Components.Section.$ctor1.call(this, elementType);
                this.StopChildrenHistory = true;
            }
        },
        methods: {
            SetSelected: function (value) {
                if (value) {
                    Core.Extensions.HtmlElementExtension.AddClass(this.Element, Core.Components.ListViewItem.SelectedClass);
                } else {
                    Core.Extensions.HtmlElementExtension.RemoveClass(this.Element, Core.Components.ListViewItem.SelectedClass);
                }
            },
            Render: function () {
                this.ListViewSection = this.ListViewSection || Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListViewSection, this);
                this.ListView = this.ListView || Core.Components.Extensions.ComponentExt.FindClosest(Core.Components.ListView, this);
                this.GuiInfo = this.ListView.GuiInfo;
                Core.Components.Section.prototype.Render.call(this);
                if (this._selected) {
                    Core.Extensions.HtmlElementExtension.AddClass(this.Element, Core.Components.ListViewItem.SelectedClass);
                }

                Core.MVVM.Html.Take(this.Element).Event$1("click", Bridge.fn.cacheBind(this, this.RowItemClick)).Event$1("dblclick", Bridge.fn.cacheBind(this, this.RowDblClick)).Event("focusin", Bridge.fn.bind(this, function () {
                    Core.Extensions.IEnumerableExtensions.SelectForEach(Core.Components.ListViewItem, this.ListView.AllListViewItem, function (x) {
                        if (x.Focused) {
                            x.Focused = false;
                        }
                    });
                    this.Focused = true;
                })).Event("focusout", Bridge.fn.cacheBind(this, this.RowFocusOut)).Event("mouseenter", Bridge.fn.cacheBind(this, this.MouseEnter)).Event("mouseleave", Bridge.fn.cacheBind(this, this.MouseLeave));
            },
            RenderRowData: function (headers, row, index, emptyRow) {
                var $t;
                if (index === void 0) { index = null; }
                if (emptyRow === void 0) { emptyRow = false; }
                if (System.Nullable.hasValue(index)) {
                    if (System.Nullable.gte(index, System.Linq.Enumerable.from(this.Element.parentElement.children, HTMLElement).count()) || System.Nullable.lt(index, 0)) {
                        index = 0;
                    }

                    this.Element.parentElement.insertBefore(this.Element, this.Element.parentElement.children[System.Nullable.getValue(index)]);
                }
                var func = { };
                if (Core.Extensions.Utils.IsFunction(this.GuiInfo.Template, func)) {
                    var formatted = ($t = func.v.call(this, this)) != null ? Bridge.toString($t) : null;
                    this.Element.innerHTML = formatted;
                    this.EditForm.BindingTemplate(this.Element, this);
                } else {
                    System.Linq.Enumerable.from(headers, Core.Models.Component).where(function (x) {
                            return !x.Hidden;
                        }).forEach(Bridge.fn.bind(this, function (header) {
                        this.RenderTableCell(row, header, this.Element);
                    }));
                }
                var id = Bridge.unbox(row[Core.Components.EditableComponent.IdField]);
                this.Dirty = (!System.Nullable.hasValue(id) || System.Nullable.lte(id, 0)) && !emptyRow;
            },
            CanDo: function (gridPolicies, permissionPredicate) {
                var grid = System.Linq.Enumerable.from(gridPolicies, Core.Models.FeaturePolicy).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.UserId, Core.Clients.Client.Token.UserId);
                    }, null);
                if (grid != null) {
                    return grid.CanWrite;
                } else {
                    var featurePolicy = System.Linq.Enumerable.from(this.EditForm.Feature.FeaturePolicy, Core.Models.FeaturePolicy).where(function (x) {
                            return x.EntityId == null;
                        }).any(permissionPredicate);
                    if (!featurePolicy) {
                        return false;
                    }
                    var Component = System.Linq.Enumerable.from(gridPolicies, Core.Models.FeaturePolicy).any();
                    if (!Component) {
                        return true;
                    }
                    return System.Linq.Enumerable.from(gridPolicies, Core.Models.FeaturePolicy).any(permissionPredicate);
                }
            },
            RenderTableCell: function (rowData, header, cellWrapper) {
                var $t;
                if (cellWrapper === void 0) { cellWrapper = null; }
                if (System.String.isNullOrEmpty(header.FieldName)) {
                    return;
                }
                var gridPolicies = this.EditForm.GetGridPolicies(header.Id, Core.Extensions.Utils.ComponentId);
                var canWrite = this.CanDo(gridPolicies, function (x) {
                    return x.CanWrite;
                });
                var component = ((header.Editable || System.Array.contains(Core.Components.ListViewItem.NotCellText, header.ComponentType, System.String)) && this.ListViewSection.ListView.CanWrite && canWrite) ? Core.Components.Extensions.ComponentFactory.GetComponent(header, this.EditForm) : new Core.Components.Label(header);
                var cellText;
                if (((cellText = Bridge.as(component, Core.Components.Label))) != null) {
                    cellText.RefData = this.ListView.RefData;
                }
                if (Core.Extensions.StringExt.HasAnyChar(header.ReferenceId)) {
                    var source = header.LocalData || (Core.Extensions.IEnumerableExtensions.Nothing(System.Collections.Generic.KeyValuePair$2(System.String,System.Collections.Generic.List$1(System.Object)), this.ListView.RefData) ? null : System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, System.Collections.Generic.List$1(System.Object), this.ListView.RefData, header.RefName));
                    header.LocalData = source;
                }
                var searchEntry;
                if (((searchEntry = Bridge.as(component, Core.Components.SearchEntry))) != null && !(Bridge.is(component, Core.Components.MultipleSearchEntry))) {
                    var matched = ($t = header.LocalData) != null ? System.Linq.Enumerable.from($t, System.Object).firstOrDefault(function (x) {
                            var $t1;
                            return Bridge.referenceEquals(Bridge.cast(x[Core.Components.EditableComponent.IdField], System.String), (rowData != null && ($t1 = Core.Extensions.Utils.GetPropValue(rowData, header.FieldName)) != null ? Bridge.toString($t1) : null));
                        }, null) : null;
                    searchEntry.Matched = matched;
                }
                component.Id = header.Id;
                component.Name = header.FieldName;
                component.Entity = rowData;
                component.ParentElement = cellWrapper || Core.MVVM.Html.Context;
                this.AddChild(component);
                if (this.Disabled || header.Disabled) {
                    Core.Components.Extensions.ComponentExt.SetDisabled(component, true);
                }
                if (component.Element != null && !Core.Extensions.StringExt.IsNullOrWhiteSpace(header.ChildStyle)) {
                    component.Element.style.cssText = header.ChildStyle;
                }
                component.UserInput = Bridge.fn.combine(component.UserInput, Bridge.fn.bind(this, function (arg) {
                    if (Bridge.referenceEquals(component.ComponentType, "Input") || Bridge.referenceEquals(component.ComponentType, "Textbox") || Bridge.referenceEquals(component.ComponentType, "Textarea")) {
                        if (arg.EvType === "abort" || arg.EvType === "change" || arg.EvType === "blur") {
                            if (component.Disabled) {
                                return;
                            }
                            Core.Extensions.EventExt.Done(this.ListView.RowChangeHandler(component.Entity, this, arg, component), Bridge.fn.bind(this, function () {
                                this.ListView.RealtimeUpdate(this, arg);
                            }));
                        }
                    } else {
                        Core.Extensions.EventExt.Done(this.ListView.RowChangeHandler(component.Entity, this, arg, component), Bridge.fn.bind(this, function () {
                            if (arg.EvType === "change") {
                                if (component.Disabled) {
                                    return;
                                }
                                this.ListView.RealtimeUpdate(this, arg);
                            }
                        }));
                    }
                }));
            },
            PatchUpdateOrCreate: function () {
                if (!this.Dirty) {
                    return;
                }
                var patchModel = this.GetPatchEntity();
                Core.Extensions.EventExt.Done(Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforePatchUpdate, [this.Entity, patchModel, this]), Bridge.fn.bind(this, function () {
                    this.lastpathModel = patchModel;
                    Core.Extensions.EventExt.Done$1(System.Int32, Core.Clients.Client.Instance.PatchAsync(patchModel), Bridge.fn.bind(this, function (success) {
                        this.PatchUpdateCb(success > 0, patchModel);
                    }));
                }));
            },
            PatchUpdateCb: function (success, patchModel) {
                if (!success) {
                    Core.Extensions.Toast.Warning("Save data was not succeded");
                } else {
                    this.EntityId = patchModel.EntityId;
                    this.Dirty = false;
                    this.EmptyRow = false;
                }
                Core.Clients.Client.ExecTaskNoResult(Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterPatchUpdate, [this.Entity, patchModel, this]));
            },
            GetPatchEntity: function () {
                var $t, $t1;
                var shouldGetAll = this.EntityId == null;
                var dirtyPatch = System.Linq.Enumerable.from(this.Children, Core.Components.EditableComponent).where(function (child) {
                        var editable;
                        return ((editable = child)) != null && (shouldGetAll || editable.Dirty);
                    }).selectMany(Bridge.fn.bind(this, function (child) {
                    var $t, $t1;
                    var fn;
                    if (!Bridge.staticEquals(((fn = child.PatchDetail)), null)) {
                        return Bridge.as(fn.call(child), System.Array.type(Core.ViewModels.PatchDetail));
                    }
                    var value = Core.Extensions.Utils.GetPropValue(child.Entity, child.FieldName);
                    var propType = Core.Extensions.BridgeExt.GetComplexPropType(Bridge.getType(child.Entity), child.FieldName, child.Entity);
                    var patch = ($t = new Core.ViewModels.PatchDetail(), $t.Label = child.Label, $t.Field = child.FieldName, $t.OldVal = (child.OldValue != null && Core.Extensions.ReflectionExt.IsDate(propType)) ? Core.Extensions.DateTimeExt.DateConverter(Bridge.toString(child.OldValue)) : ($t1 = child.OldValue) != null ? Bridge.toString($t1) : null, $t.Value = (value != null && Core.Extensions.ReflectionExt.IsDate(propType)) ? Core.Extensions.DateTimeExt.DateConverter(Bridge.toString(value)) : !this.EditForm.Feature.IgnoreEncode ? value != null ? Core.Extensions.Utils.EncodeSpecialChar(Bridge.toString(value).trim()) : null : value != null ? Bridge.toString(value).trim() : null, $t);
                    return System.Array.init([patch], Core.ViewModels.PatchDetail);
                })).toList(Core.ViewModels.PatchDetail);
                this.AddIdToPatch(dirtyPatch);
                this.PatchModel.AddRange(dirtyPatch);
                return ($t = new Core.ViewModels.PatchVM(), $t.CacheName = this.CacheName, $t.QueueName = this.QueueName, $t.Changes = dirtyPatch, $t.Table = this.ListView.GuiInfo.RefName, $t.ConnKey = ($t1 = this.ListView.ConnKey, $t1 != null ? $t1 : Core.Clients.Client.ConnKey), $t);
            },
            RowDblClick: function (e) {
                var $t;
                e.stopPropagation();
                !Bridge.staticEquals(($t = this.ListViewSection.ListView.DblClick), null) ? $t(this.Entity) : null;
                Core.Clients.Client.ExecTaskNoResult(Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "dblclick", [this.Entity]));
            },
            RowItemClick: function (e) {
                var $t;
                e.stopPropagation();
                var ctrl = Core.Extensions.EventExt.CtrlOrMetaKey(e);
                var shift = Core.Extensions.EventExt.ShiftKey(e);
                var target = Bridge.as(e.target, Node);
                var focusing = Core.Components.Extensions.ComponentExt.FirstOrDefault(this, function (x) {
                    return Bridge.referenceEquals(x.Element, target) || x.ParentElement.contains(target);
                }) != null;
                this.HotKeySelectRow(ctrl, shift, focusing);
                if (!Core.Extensions.EventExt.ShiftKey(e)) {
                    !Bridge.staticEquals(($t = this.ListViewSection.ListView.RowClick), null) ? $t(this.Entity) : null;
                }
                this.ListViewSection.ListView.LastListViewItem = this;
                Core.Clients.Client.ExecTaskNoResult(Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "click", [this.Entity]));
            },
            HotKeySelectRow: function (ctrl, shift, focusing) {
                if (this.EmptyRow) {
                    return;
                }
                if (this.ListViewSection.ListView.VirtualScroll) {
                    if (ctrl || shift) {
                        this.Selected = !this._selected;
                        if (this._selected) {
                            this.ListViewSection.ListView.SelectedIndex = this.ListViewSection.Children.indexOf(this);
                        }
                    }
                    if (shift) {
                        var allListView = this.ListViewSection.ListView.AllListViewItem;
                        if (this.ListViewSection.ListView.LastShiftViewItem == null) {
                            this.ListViewSection.ListView.LastShiftViewItem = this;
                            this.ListViewSection.ListView.LastIndex = this.RowNo;
                        }
                        var _lastIndex = { v : this.ListViewSection.ListView.LastIndex };
                        var currentIndex = { v : this.RowNo };
                        if (_lastIndex.v > currentIndex.v) {
                            Bridge.Deconstruct(new (System.ValueTuple$2(System.Int32,System.Int32)).$ctor1(currentIndex.v, _lastIndex.v).$clone(), _lastIndex, currentIndex);
                        }
                        if (this.ListViewSection.ListView.VirtualScroll && currentIndex.v > _lastIndex.v) {
                            var sql = this.ListView.GetSql(Bridge.Int.clip32(_lastIndex.v - 1), Bridge.Int.clip32(((currentIndex.v - _lastIndex.v) | 0) + 1), true);
                            Core.Extensions.EventExt.Done$1(System.Array.type(System.String), Core.Clients.Client.Instance.GetIds(sql), Bridge.fn.bind(this, function (selectedIds) {
                                if (this.Selected) {
                                    System.Linq.Enumerable.from(selectedIds, System.String).except(this.ListViewSection.ListView.SelectedIds).forEach(Bridge.fn.cacheBind(this.ListViewSection.ListView.SelectedIds, this.ListViewSection.ListView.SelectedIds.add));
                                } else {
                                    selectedIds.forEach(Bridge.fn.bind(this, function (x) {
                                            this.ListViewSection.ListView.SelectedIds.remove(x);
                                        }));
                                }
                                this.SetSeletedListViewItem(allListView, _lastIndex.v, currentIndex.v);
                                this.ListViewSection.ListView.LastShiftViewItem = null;
                            }));
                        } else {
                            this.SetSeletedListViewItem(allListView, _lastIndex.v, currentIndex.v);
                        }
                    }
                } else {
                    if (!ctrl && !shift) {
                        if (this.ListViewSection.ListView.SelectedIds.Count <= 1) {
                            this.ListViewSection.ListView.ClearSelected();
                            this.Selected = !this._selected;
                            if (this._selected) {
                                this.ListViewSection.ListView.SelectedIndex = this.ListViewSection.Children.indexOf(this);
                            }
                        }
                        return;
                    }
                    this.Selected = !this._selected;

                    if (!shift && !ctrl && this._selected) {
                        this.ListViewSection.ListView.SelectedIndex = this.ListViewSection.Children.indexOf(this);
                    }
                    if (shift) {
                        var allListView1 = this.ListViewSection.ListView.AllListViewItem;
                        var selected = System.Linq.Enumerable.from(allListView1, Core.Components.ListViewItem).firstOrDefault(function (x) {
                                return x.Selected;
                            }, null);
                        var _lastIndex1 = { v : Core.Extensions.IEnumerableExtensions.IndexOf(Core.Components.ListViewItem, allListView1, function (x) {
                            return Bridge.referenceEquals(x, selected);
                        }) };
                        var currentIndex1 = { v : this.ListViewSection.Children.indexOf(this) };
                        if (_lastIndex1.v > currentIndex1.v) {
                            Bridge.Deconstruct(new (System.ValueTuple$2(System.Int32,System.Int32)).$ctor1(currentIndex1.v, _lastIndex1.v).$clone(), _lastIndex1, currentIndex1);
                        }
                        for (var i = _lastIndex1.v; i <= currentIndex1.v; i = (i + 1) | 0) {
                            var row;
                            if (((row = Bridge.as(this.ListViewSection.Children.getItem(i), Core.Components.ListViewItem))) != null) {
                                row.Selected = true;
                            }
                        }
                    }
                }
            },
            SetSeletedListViewItem: function (allListView, _lastIndex, currentIndex) {
                var $t;
                var start = System.Linq.Enumerable.from(allListView, Core.Components.ListViewItem).firstOrDefault(null, null).RowNo > _lastIndex ? System.Linq.Enumerable.from(allListView, Core.Components.ListViewItem).firstOrDefault(null, null).RowNo : _lastIndex;
                var items = System.Linq.Enumerable.from(this.ListViewSection.ListView.AllListViewItem, Core.Components.ListViewItem).where(function (x) {
                        return x.RowNo >= start && x.RowNo <= currentIndex;
                    }).toList(Core.Components.ListViewItem);
                if (!this.ListViewSection.ListView.VirtualScroll) {
                    this.ListViewSection.ListView.SelectedIds = System.Linq.Enumerable.from(items, Core.Components.ListViewItem).select(function (x) {
                            return x.EntityId;
                        }).toList(System.String);
                }
                $t = Bridge.getEnumerator(items);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        var id = item.EntityId;
                        if (this.ListViewSection.ListView.SelectedIds.contains(id)) {
                            item.Selected = this.Selected;
                        } else {
                            item.Selected = false;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            RowFocusOut: function () {
                System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.RowFocusOut, [this.Entity]);
                                                $step = 1;
                                                if ($task1.isCompleted()) {
                                                    continue;
                                                }
                                                $task1.continue($asyncBody);
                                                return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            $tcs.setResult($taskResult1);
                                                return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                }));
            },
            MouseEnter: function () {
                Core.Extensions.HtmlElementExtension.AddClass(this.Element, Core.Components.ListViewItem.HoveringClass);
                System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.ListViewSection.ListView.GuiInfo.Events, Core.Enums.CustomEventType.RowMouseEnter, [this.Entity]);
                                                $step = 1;
                                                if ($task1.isCompleted()) {
                                                    continue;
                                                }
                                                $task1.continue($asyncBody);
                                                return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            $tcs.setResult($taskResult1);
                                                return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                }));
            },
            MouseLeave: function () {
                Core.Extensions.HtmlElementExtension.RemoveClass(this.Element, Core.Components.ListViewItem.HoveringClass);
                System.Threading.Tasks.Task.run(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                        $returnValue, 
                        $async_e, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            try {
                                for (;;) {
                                    $step = System.Array.min([0,1], $step);
                                    switch ($step) {
                                        case 0: {
                                            $task1 = Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.ListViewSection.ListView.GuiInfo.Events, Core.Enums.CustomEventType.RowMouseLeave, [this.Entity]);
                                                $step = 1;
                                                if ($task1.isCompleted()) {
                                                    continue;
                                                }
                                                $task1.continue($asyncBody);
                                                return;
                                        }
                                        case 1: {
                                            $taskResult1 = $task1.getAwaitedResult();
                                            $tcs.setResult($taskResult1);
                                                return;
                                        }
                                        default: {
                                            $tcs.setResult(null);
                                            return;
                                        }
                                    }
                                }
                            } catch($async_e1) {
                                $async_e = System.Exception.create($async_e1);
                                $tcs.setException($async_e);
                            }
                        }, arguments);

                    $asyncBody();
                    return $tcs.task;
                }));
            }
        }
    });

    Bridge.define("Core.Components.GroupListView", {
        inherits: [Core.Components.ListView],
        statics: {
            fields: {
                _groupKey: null,
                GroupRowClass: null
            },
            ctors: {
                init: function () {
                    this._groupKey = "__groupkey__";
                    this.GroupRowClass = "group-row";
                }
            }
        },
        ctors: {
            ctor: function (ui) {
                this.$initialize();
                Core.Components.ListView.ctor.call(this, ui);
            }
        },
        methods: {
            Render: function () {
                Core.Components.ListView.prototype.Render.call(this);
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element), "group-listview").End.Render();
            },
            AddRow: function (item, fromIndex, singleAdd) {
                var $t;
                if (singleAdd === void 0) { singleAdd = true; }
                fromIndex = 0;
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                this.DisposeNoRecord();
                var keys = this.GuiInfo.GroupBy.split(",");
                item[Core.Components.GroupListView._groupKey] = Bridge.toArray(System.Linq.Enumerable.from(keys, System.String).select(function (key) {
                            var $t;
                            return ($t = Core.Extensions.Utils.GetPropValue(item, key)) != null ? Bridge.toString($t) : null;
                        })).join(" ");
                var groupKey = item[Core.Components.GroupListView._groupKey];
                var existGroup = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(function (group) {
                        return group.GroupRow && Bridge.referenceEquals(Bridge.unbox(group.Entity).Key, groupKey);
                    }, null);
                var rowSection;
                if (existGroup == null) {
                    var groupData = ($t = new Core.Components.GroupRowData(), $t.Key = groupKey, $t.Children = function (_o1) {
                            _o1.add(item);
                            return _o1;
                        }(new (System.Collections.Generic.List$1(System.Object)).ctor()), $t);
                    this.FormattedRowData.add(groupData);
                    rowSection = this.RenderRowData(this.Header, groupData, this.MainSection, this.MainSection.Children.Count);
                } else {
                    Bridge.unbox(existGroup.Entity).Children.add(item);
                    var index = this.MainSection.Children.indexOf(existGroup);
                    rowSection = this.RenderRowData(this.Header, item, this.MainSection, Bridge.Int.clip32(index + existGroup.Children.Count));
                }
                if (singleAdd) {
                    this.AddNewEmptyRow();
                }
                this.Dirty = true;
                tcs.trySetResult(rowSection);
                return tcs.task;
            },
            AddRows: function (rowsData, index) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    listItem, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        if (index === void 0) { index = 0; }
                                        listItem = new (System.Collections.Generic.List$1(Core.Components.ListViewItem)).ctor();
                                        $task1 = Core.Extensions.IEnumerableExtensions.ForEachAsync(System.Object, rowsData, Bridge.fn.bind(this, function (x) {
                                            var $step = 0,
                                                $task1, 
                                                $taskResult1, 
                                                $jumpFromFinally, 
                                                $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                                                $returnValue, 
                                                $async_e, 
                                                $asyncBody = Bridge.fn.bind(this, function () {
                                                    try {
                                                        for (;;) {
                                                            $step = System.Array.min([0,1], $step);
                                                            switch ($step) {
                                                                case 0: {
                                                                    $task1 = this.AddRow(x, 0, false);
                                                                    $step = 1;
                                                                    if ($task1.isCompleted()) {
                                                                        continue;
                                                                    }
                                                                    $task1.continue($asyncBody);
                                                                    return;
                                                                }
                                                                case 1: {
                                                                    $taskResult1 = $task1.getAwaitedResult();
                                                                    listItem.add($taskResult1);
                                                                    $tcs.setResult(null);
                                                                    return;
                                                                }
                                                                default: {
                                                                    $tcs.setResult(null);
                                                                    return;
                                                                }
                                                            }
                                                        }
                                                    } catch($async_e1) {
                                                        $async_e = System.Exception.create($async_e1);
                                                        $tcs.setException($async_e);
                                                    }
                                                }, arguments);

                                            $asyncBody();
                                            return $tcs.task;
                                        }));
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        $tcs.setResult(listItem);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            RenderRowData: function (headers, row, listViewSection, index, emptyRow) {
                var $t;
                if (emptyRow === void 0) { emptyRow = false; }
                var groupRow;
                if (!(((groupRow = Bridge.as(row, Core.Components.GroupRowData))) != null)) {
                    return Core.Components.ListView.prototype.RenderRowData.call(this, headers, row, listViewSection, index, emptyRow);
                }
                var wrapper = listViewSection.Element;
                if (groupRow.Key == null || Core.Extensions.StringExt.IsNullOrWhiteSpace(Bridge.toString(groupRow.Key))) {
                    var rowResult = null;
                    groupRow.Children.ForEach(Bridge.fn.bind(this, function (child) {
                        Core.MVVM.Html.Take(wrapper);
                        rowResult = this.RenderRowData(headers, child, listViewSection, null);
                    }));
                    return rowResult;
                }
                var groupSection = ($t = new Core.Components.GroupViewItem(Core.MVVM.ElementType.div), $t.Entity = row, $t.ParentElement = wrapper, $t.GroupRow = true, $t.PreQueryFn = this._preQueryFn, $t.ListView = this, $t.GuiInfo = this.GuiInfo, $t);
                listViewSection.AddChild(groupSection);
                var first = System.Linq.Enumerable.from(groupRow.Children, System.Object).firstOrDefault(null, null);
                var groupText = Core.Extensions.Utils.FormatEntity(this.GuiInfo.GroupFormat, null, first, function (x) {
                    return "N/A";
                }, function (x) {
                    return "N/A";
                });
                Core.Components.Renderer.Icon(Core.MVVM.Html.Take(groupSection.Element).Event$2(System.Object, "click", Bridge.fn.cacheBind(this, this.DispatchClick), first).Event$2(System.Object, "dblclick", Bridge.fn.cacheBind(this, this.DispatchDblClick), first), "fa fa-chevron-right").Event$3(Core.Components.GroupViewItem, "click", Bridge.fn.cacheBind(this, this.ToggleGroupRow), groupSection).End.Span.InnerHTML(groupText);
                groupSection.GroupText = Core.MVVM.Html.Context;
                groupRow.Children.ForEach(Bridge.fn.bind(this, function (child) {
                    Core.MVVM.Html.Take(groupSection.Element);
                    var childRow = this.RenderRowData(headers, child, groupSection, null);
                    childRow.GroupSection = groupSection;
                    Core.Components.Renderer.SmallCheckbox(Core.MVVM.Html.Take(childRow.Element)).Render();
                    var chk = Bridge.as(Core.MVVM.Html.Context.previousElementSibling, HTMLInputElement);
                    Core.MVVM.Html.Instance.End.End.Event$1("click", function (e) {
                        e.preventDefault();
                        childRow.Selected = !childRow.Selected;
                        chk.checked = childRow.Selected;
                    });
                }));
                return groupSection;
            },
            DispatchClick: function (row) {
                Core.Clients.Client.ExecTaskNoResult(Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.GroupEvent, "click", [row]));
            },
            DispatchDblClick: function (row) {
                Core.Clients.Client.ExecTaskNoResult(Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.GroupEvent, "dblclick", [row]));
            },
            ToggleGroupRow: function (groupSection, e) {
                var target;
                if (!(((target = Bridge.as(e.target, HTMLElement))) != null)) {
                    return;
                }

                if (Core.Extensions.HtmlElementExtension.HasClass(target, "fa-chevron-right")) {
                    Core.Extensions.HtmlElementExtension.ReplaceClass(target, "fa-chevron-right", "fa-chevron-down");
                    groupSection.Children.ForEach(function (x) {
                        x.Show = false;
                    });
                } else {
                    Core.Extensions.HtmlElementExtension.ReplaceClass(target, "fa-chevron-down", "fa-chevron-right");
                    groupSection.Children.ForEach(function (x) {
                        x.Show = true;
                    });
                }
            },
            RemoveRowById: function (id) {
                var index = Core.Extensions.IEnumerableExtensions.IndexOf(System.Object, this.RowData.Data, function (x) {
                    return Bridge.referenceEquals(Bridge.toString(x[Core.Components.EditableComponent.IdField]), id);
                });
                if (index < 0) {
                    return;
                }

                this.RowData.Data.removeAt(index);
                System.Linq.Enumerable.from(this.FilterChildren$1(function (x) {
                    return Bridge.is(x, Core.Components.ListViewItem) && Bridge.referenceEquals(Bridge.toString(x.Entity[Core.Components.EditableComponent.IdField]), id);
                })).select(function (x) { return Bridge.cast(x, Core.Components.ListViewItem); }).toList(Core.Components.ListViewItem).ForEach(Bridge.fn.bind(this, function (x) {
                    if (x.GroupSection != null && Bridge.is(x.GroupSection.Entity, Core.Components.GroupRowData)) {
                        var groupChildren = Bridge.unbox(x.GroupSection.Entity).Children;
                        groupChildren.remove(x.Entity);
                        if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, groupChildren)) {
                            this.RowData.Data.remove(x.GroupSection.Entity);
                            x.GroupSection.Dispose();
                        }
                    }
                    x.Dispose();
                }));
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, this.RowData.Data)) {
                    this.NoRecordFound();
                }
            },
            RemoveRange: function (data) {
                Core.Extensions.IEnumerableExtensions.SelectForEach(System.Object, data, Bridge.fn.bind(this, function (x) {
                    this.RemoveRowById(Bridge.toString(x[Core.Components.EditableComponent.IdField]));
                }));
            },
            AddOrUpdateRow: function (rowData, singleAdd, force, fields) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $task2, 
                    $taskResult2, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    existRowData, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3,4,5,6,7], $step);
                                switch ($step) {
                                    case 0: {
                                        if (singleAdd === void 0) { singleAdd = true; }
                                        if (force === void 0) { force = false; }
                                        if (fields === void 0) { fields = []; }
                                        existRowData = System.Linq.Enumerable.from(this.FilterChildren$1(function (x) {
                                            return Bridge.is(x, Core.Components.ListViewItem) && Bridge.referenceEquals(x.Entity, rowData);
                                        })).select(function (x) { return Bridge.cast(x, Core.Components.ListViewItem); }).firstOrDefault(null, null);
                                        if (existRowData == null) {
                                            $step = 1;
                                            continue;
                                        } 
                                        $step = 3;
                                        continue;
                                    }
                                    case 1: {
                                        $task1 = this.AddRow(rowData, 0, singleAdd);
                                        $step = 2;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 2: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    case 3: {
                                        if (existRowData.EmptyRow) {
                                            $step = 4;
                                            continue;
                                        } else  {
                                            $step = 6;
                                            continue;
                                        }
                                    }
                                    case 4: {
                                        existRowData.Entity = null;
                                        $task2 = this.AddRow(rowData, 0, singleAdd);
                                        $step = 5;
                                        if ($task2.isCompleted()) {
                                            continue;
                                        }
                                        $task2.continue($asyncBody);
                                        return;
                                    }
                                    case 5: {
                                        $taskResult2 = $task2.getAwaitedResult();
                                        $step = 7;
                                        continue;
                                    }
                                    case 6: {
                                        Core.Extensions.ReflectionExt.CopyPropFrom(existRowData.Entity, rowData);
                                        this.RowAction$2(function (x) {
                                            return Bridge.referenceEquals(x.Entity, existRowData.Entity);
                                        }, function (x) {
                                            x.EmptyRow = false;
                                            x.UpdateView$1(force, fields);
                                            x.Dirty = true;
                                        });
                                        $step = 7;
                                        continue;
                                    }
                                    case 7: {
                                        if (singleAdd) {
                                            this.AddNewEmptyRow();
                                        }
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            }
        }
    });

    Bridge.define("Core.Components.ImageServer", {
        inherits: [Core.Components.Image],
        statics: {
            fields: {
                pathSeparator: null,
                _backdrop: null,
                _preview: null
            },
            props: {
                Camera: null
            },
            ctors: {
                init: function () {
                    this.pathSeparator = "    ";
                }
            }
        },
        fields: {
            _input$1: null,
            _plus: null,
            _disabledDelete$1: false,
            _placeHolder: null
        },
        props: {
            Path: {
                get: function () {
                    return this._path;
                },
                set: function (value) {
                    var $t;
                    this.RemoveChild$1();
                    this._path = value;
                    if (this.Entity != null) {
                        Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this._path);
                    }

                    if (this._path == null) {
                        this.RenderFileThumb$1(this._path);
                        return;
                    }

                    var updatedImages = ($t = System.String, System.Linq.Enumerable.from(this._path.split(Core.Components.ImageServer.pathSeparator), $t).toList($t));
                    updatedImages.ForEach(Bridge.fn.bind(this, function (x) {
                        this.RenderFileThumb$1(x);
                    }));
                }
            },
            _imageSources$1: {
                get: function () {
                    return this._path != null ? this._path.split(Core.Components.ImageServer.pathSeparator) : null;
                }
            },
            Disabled: {
                get: function () {
                    return Bridge.ensureBaseProperty(this, "Disabled").$Core$Components$Image$Disabled;
                },
                set: function (value) {
                    if (this._input$1 != null) {
                        this._input$1.disabled = value;
                    }

                    Bridge.ensureBaseProperty(this, "Disabled").$Core$Components$Image$Disabled = value;
                    if (value) {
                        this.ParentElement.setAttribute("disabled", "");
                    } else {
                        this.ParentElement.removeAttribute("disabled");
                    }
                }
            }
        },
        ctors: {
            ctor: function (ui) {
                var $t;
                this.$initialize();
                Core.Components.Image.ctor.call(this, ui);
                this.GuiInfo = ui;
                this.DataSourceFilter = ($t = this.GuiInfo.DataSourceFilter, $t != null ? $t : "image/*");
            }
        },
        methods: {
            RemoveChild$1: function () {
                System.Linq.Enumerable.from(this.ParentElement.querySelectorAll(".thumb-wrapper")).select(function (x) { return Bridge.cast(x, HTMLElement); }).forEach(function (x) {
                    x.remove();
                });
            },
            Render: function () {
                var $t, $t1, $t2, $t3;
                this._path = ($t = this.Entity) != null && ($t1 = Core.Extensions.Utils.GetPropValue($t, this.FieldName)) != null ? Bridge.toString($t1) : null;
                var paths = this._path != null ? ($t2 = System.String, System.Linq.Enumerable.from(this._path.split(Core.Components.ImageServer.pathSeparator), $t2).toList($t2)) : null;
                this.RenderUploadForm$1();
                this.Path = this._path;
                !Bridge.staticEquals(($t3 = this.DOMContentLoaded), null) ? $t3() : null;
            },
            RenderFileThumb$1: function (path, first) {
                if (first === void 0) { first = false; }
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div, "thumb-wrapper").Div, "overlay");
                if (!this._disabledDelete$1 && path != null && !Bridge.referenceEquals(path, "")) {
                    Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.I, "fal fa-eye").Event$2(System.String, "click", Bridge.fn.cacheBind(this, this.Preview$1), path).End.I, "fa fa-times").Event$4(System.String, "click", Bridge.fn.cacheBind(this, this.RemoveFile$1), path).End.Render();
                }
                Core.MVVM.Html.Instance.End.Render();
                if (!Core.Extensions.StringExt.IsNullOrWhiteSpace(path)) {
                    Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Img.Event("click", Bridge.fn.cacheBind(this, this.OpenForm)), "thumb").Style$1(this.GuiInfo.ChildStyle).Src(path).Render();
                }
                return Core.MVVM.Html.Context.parentElement;
            },
            Preview$1: function (path) {
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(path)) {
                    return;
                }

                if (!System.IO.Path.IsImage(path)) {
                    Core.Clients.Client.Download(path);
                    return;
                }

                var img = null;
                var rotate = 0;
                Core.Components.Renderer.Escape(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(Bridge.ensureBaseProperty(this, "EditForm").$Core$Components$EditableComponent$EditForm.Element).Div, "dark-overlay"), function (e) {
                    Core.Components.ImageServer._preview.remove();
                }).Event$1("keydown", Bridge.fn.bind(this, function (e) {
                    var keyCode = Core.Extensions.EventExt.KeyCodeEnum(e);
                    if (System.Nullable.neq(keyCode, Core.Enums.KeyCodeEnum.LeftArrow) && System.Nullable.neq(keyCode, Core.Enums.KeyCodeEnum.RightArrow)) {
                        return;
                    }

                    if (System.Nullable.eq(keyCode, Core.Enums.KeyCodeEnum.LeftArrow)) {
                        path = this.MoveLeft(path, img);
                    } else {
                        path = this.MoveRight(path, img);
                    }
                }));
                Core.Components.ImageServer._preview = Core.MVVM.Html.Context;
                Core.MVVM.Html.Instance.Img.Src((Core.Clients.Client.Origin || "") + (path || ""));
                img = Bridge.as(Core.MVVM.Html.Context, HTMLImageElement);
                Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.Title(Core.Components.Renderer.Icon(Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Span, "close").Event("click", function () {
                    Core.Components.ImageServer._preview.remove();
                }).End.Div, "toolbar"), "fa fa-undo ro-left").Event("click", function () {
                    rotate = (rotate - 90) | 0;
                    img.style.transform = System.String.format("rotate({0}deg)", [Bridge.box(rotate, System.Int32)]);
                }).End, "fa fa-cloud-download-alt"), "T\u1ea3i xu\u1ed1ng").Event("click", function () {
                    var link = Bridge.as(document.createElement("a"), HTMLAnchorElement);
                    link.href = img.src;
                    link.download = img.src.substr(img.src.lastIndexOf("/"));
                    document.body.appendChild(link);
                    link.click();
                    link.remove();
                }).End, "fa fa-redo ro-right").Event("click", function () {
                    rotate = (rotate + 90) | 0;
                    img.style.transform = System.String.format("rotate({0}deg)", [Bridge.box(rotate, System.Int32)]);
                }).End.End, "fa fa-chevron-left").Event("click", Bridge.fn.bind(this, function () {
                    path = this.MoveLeft(path, img);
                })).End, "fa fa-chevron-right").Event("click", Bridge.fn.bind(this, function () {
                    path = this.MoveRight(path, img);
                })).End.Render();
            },
            RenderUploadForm$1: function () {
                this.Element = Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.ParentElement), "uploader").Div.GetContext();
                if (this._plus == null) {
                    if (System.Nullable.gt(this.GuiInfo.Precision, 0)) {
                        Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.I.Event("click", Bridge.fn.cacheBind(this, this.OpenForm)), "fal fa-plus mt-3").Style$1(this.GuiInfo.ChildStyle).End.Render();
                    } else {
                        if (Core.Extensions.StringExt.IsNullOrWhiteSpace(this.Path)) {
                            Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.I.Event("click", Bridge.fn.cacheBind(this, this.OpenForm)), "fal fa-plus mt-3").Style$1(this.GuiInfo.ChildStyle).End.Render();
                        }
                    }
                    this._plus = Core.MVVM.Html.Context;
                }
            },
            OpenForm: function () {
                var $t;
                if (Core.Components.ImageServer._backdrop == null) {
                    Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(document.body).Div, "backdrop").Style$1("z-index:2000"), -1);
                    Core.Components.ImageServer._backdrop = Core.MVVM.Html.Context;
                }
                Core.Extensions.HtmlElementExtension.Show(Core.Components.ImageServer._backdrop);
                Core.Components.Renderer.IconForSpan(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(Core.Components.ImageServer._backdrop).Clear().Div, "popup-content").Style$1("width:100%").Div, "popup-title").Span, "");
                Core.MVVM.Html.Instance.End.Span.Text("Danh s\u00e1ch h\u00ecnh \u1ea3nh");
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div, "icon-box").Span, "fa fa-times").Event("click", Bridge.fn.cacheBind(this, this.ClosePopup)).EndOf$1(".popup-title").Div, "popup-body");
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Input.Type$1("file").Attr$1("multiple", "multiple").Attr$1("name", "imagefiles"), "d-none").Attr$1("accept", this.DataSourceFilter).Event$1("change", Bridge.fn.bind(this, function (e) {
                    this.UploadSelectedImages$1(e);
                }));
                this._input$1 = Bridge.as(Core.MVVM.Html.Context, HTMLInputElement);
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.End.Div, "col-md-12").Style$1("padding: 20px 5%;").Div, "alert alert-info").Text("L\u01b0u \u00fd: H\u1ec7 th\u1ed1ng ch\u1ec9 nh\u1eadn c\u00e1c file \u1ea3nh (bmp, jpg, jpeg, gif, png) v\u00e0 dung l\u01b0\u1ee3ng d\u01b0\u1edbi 1Mb / file").End.Div, "gallery-buttons bottom-30px").Button.Event$1("click", Bridge.fn.bind(this, function (e) {
                    this.OpenNativeFileDialog$1(e);
                })).Id("btn-upload"), "btn btn-success btn-md dz-clickable mr-1").I, "fa fa-upload mr-1").End.Text("Upload \u1ea3nh m\u1edbi").End.Button.Id("btn-upload"), "btn btn-success btn-md mr-1").I, "fa fa-heart mr-1").End.Text("Ch\u00e8n \u1ea3nh \u0111\u00e3 ch\u1ecdn").End.Button.Id("btn-upload"), "btn btn-danger btn-md mr-1").I, "fa fa-trash mr-1").End.Text("X\u00f3a \u1ea3nh \u0111\u00e3 ch\u1ecdn").End.End.Div, " list-group").Div, "row").Id("previewContainer");
                var fn = { };

                var isFn = Core.Extensions.Utils.IsFunction(this.GuiInfo.PreQuery, fn);
                var loadImageTask = Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), Core.Clients.Client.Instance.ComQuery(($t = new Core.ViewModels.SqlViewModel(), $t.ComId = this.GuiInfo.Id, $t.Params = isFn ? JSON.stringify(Bridge.unbox(fn.v.call(null, this))) : null, $t)), Bridge.fn.bind(this, function (ds) {
                    var images = ds.length > 0 ? Bridge.unbox(ds[System.Array.index(0, ds)]) : null;
                    if (Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.Images, images)) {
                        this.RenderListImage(System.Linq.Enumerable.from(images, Core.Models.Images).select(function (x) {
                                return x.Url;
                            }).ToArray(System.String));
                    }
                }));
            },
            RemoveFile$1: function (e, removedPath) {
                if (this.Disabled) {
                    return;
                }
                this._plus = null;
                e.stopPropagation();
                if (Core.Extensions.StringExt.IsNullOrEmpty(removedPath)) {
                    return;
                }

                var oldVal = this._path;
                if (System.Nullable.gt(this.GuiInfo.Precision, 1)) {
                    var newPath = System.Linq.Enumerable.from(System.String.replaceAll(this._path, removedPath, "").split(Core.Components.ImageServer.pathSeparator), System.String).where(function (x) {
                            return Core.Extensions.StringExt.HasAnyChar(x);
                        }).toList(System.String);
                    this.Path = Bridge.toArray(newPath).join(Core.Components.ImageServer.pathSeparator);
                } else {
                    this.Path = null;
                }
                var dispatchTask = Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity]);
                Core.Clients.Client.ExecTaskNoResult(dispatchTask, Bridge.fn.bind(this, function () {
                    var $t, $t1;
                    !Bridge.staticEquals(($t = this.UserInput), null) ? $t(($t1 = new Core.MVVM.ObservableArgs(), $t1.NewData = this._path, $t1.OldData = oldVal, $t1.FieldName = this.FieldName, $t1)) : null;
                    this.Dirty = true;
                }));
            },
            UploadSelectedImages$1: function (e) {
                e.preventDefault();
                var files = Bridge.as(e.target.files, FileList);
                if (Core.Extensions.IEnumerableExtensions.Nothing(File, files)) {
                    return;
                }
                var oldVal = this._path;
                Core.Extensions.EventExt.Done(this.UploadAllFiles$1(files), Bridge.fn.bind(this, function () {
                    var $t, $t1;
                    this.Dirty = true;
                    this._input$1.value = "";
                    !Bridge.staticEquals(($t = this.UserInput), null) ? $t(($t1 = new Core.MVVM.ObservableArgs(), $t1.NewData = this._path, $t1.OldData = oldVal, $t1.FieldName = this.FieldName, $t1)) : null;
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity]));
                }));
            },
            UploadAllFiles$1: function (filesSelected) {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Components.Spinner.AppendTo(Core.Components.ImageServer._backdrop);
                var files = System.Linq.Enumerable.from(filesSelected, File).select(Bridge.fn.cacheBind(this, this.UploadFile));
                Core.Extensions.EventExt.Done$1(System.Array.type(System.String), System.Threading.Tasks.Task.whenAll(files), Bridge.fn.bind(this, function (allPath) {
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, allPath)) {
                        return;
                    }
                    this.RenderListImage(allPath);
                    Core.Components.Spinner.Hide();
                    tcs.trySetResult(true);
                }));
                return tcs.task;
            },
            RenderListImage: function (allPath) {
                allPath.forEach(Bridge.fn.bind(this, function (img) {
                        Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take$1("#previewContainer").Div, "item col-md-1 col-sm-3").Div, "thumbnail").Div.Img.Event("click", Bridge.fn.bind(this, function () {
                            this.ChooseImage(img);
                        })).Src(img), "list-group-image").End.Input.Type$1("checkbox").End.End.End.End.Render();
                    }));
            },
            ChooseImage: function (img) {
                var $t, $t1;
                if (System.Nullable.gt(this.GuiInfo.Precision, 1)) {
                    this.Path = (this.Path || "") + ((System.String.format("{0}{1}", Core.Components.ImageServer.pathSeparator, img)) || "");
                } else {
                    this.Path = System.String.format("{0}", [img]);
                    this.ClosePopup();
                }
                this.Dirty = true;
                !Bridge.staticEquals(($t = this.UserInput), null) ? $t(($t1 = new Core.MVVM.ObservableArgs(), $t1.NewData = this._path, $t1.FieldName = this.FieldName, $t1.EvType = "change", $t1)) : null;
                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity]));
            },
            OpenNativeFileDialog$1: function (e) {
                e != null ? e.preventDefault() : null;
                this._input$1.click();
            },
            GetValueText: function () {
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, this._imageSources$1)) {
                    return null;
                }
                return Core.Extensions.IEnumerableExtensions.Combine(System.String, System.Linq.Enumerable.from(this._imageSources$1, System.String).select(function (path) {
                        var label = Core.Components.Image.RemoveGuid(path);
                        return System.String.format("<a target=\"_blank\" href=\"{0}\">{1}</a>", path, label);
                    }), ",");
            },
            ClosePopup: function () {
                Core.Components.ImageServer._backdrop != null ? Core.Extensions.HtmlElementExtension.Hide(Core.Components.ImageServer._backdrop) : null;
            }
        }
    });

    Bridge.define("Core.Components.ListViewSection", {
        inherits: [Core.Components.Section],
        props: {
            ListView: null
        },
        ctors: {
            $ctor1: function (elementType) {
                this.$initialize();
                Core.Components.Section.$ctor1.call(this, elementType);
            },
            ctor: function (interactiveEle) {
                this.$initialize();
                Core.Components.Section.ctor.call(this, interactiveEle);
            }
        },
        methods: {
            Render: function () {
                this.ListView = Bridge.as(this.Parent, Core.Components.ListView);
                Core.Components.Section.prototype.Render.call(this);
            }
        }
    });

    Bridge.define("Core.Components.MultipleSearchEntry", {
        inherits: [Core.Components.SearchEntry],
        statics: {
            fields: {
                MultipleClass: null
            },
            ctors: {
                init: function () {
                    this.MultipleClass = "multiple";
                }
            }
        },
        fields: {
            _isStringSource: false,
            _toggleButton: null,
            _listValues: null
        },
        props: {
            ListValues: {
                get: function () {
                    return this._listValues;
                },
                set: function (value) {
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, value)) {
                        this._listValues != null ? this._listValues.clear() : null;
                    } else {
                        if (!Bridge.referenceEquals(this._listValues, value)) {
                            this._listValues.clear();
                            System.Linq.Enumerable.from(value, System.String).distinct().forEach(Bridge.fn.cacheBind(this._listValues, this._listValues.add));
                        }
                    }

                    this.SetEntityValue(value);
                    this.CascadeField();
                    this.PopulateFields();
                }
            },
            MatchedItems: null
        },
        ctors: {
            init: function () {
                this._listValues = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.MatchedItems = new (System.Collections.Generic.List$1(System.Object)).ctor();
            },
            ctor: function (ui) {
                this.$initialize();
                Core.Components.SearchEntry.ctor.call(this, ui);
            }
        },
        methods: {
            Render: function () {
                this._isStringSource = this.Entity != null && Bridge.equals(Core.Extensions.BridgeExt.GetComplexPropType(Bridge.getType(this.Entity), this.FieldName, this.Entity), System.String);
                Core.Components.SearchEntry.prototype.Render.call(this);
                Core.Extensions.HtmlElementExtension.AddClass(this.Element.parentElement, Core.Components.MultipleSearchEntry.MultipleClass);
                this.TryParseData();
                this.FindMatchText();
            },
            TryParseData: function () {
                if (this.Entity == null) {
                    return;
                }
                var source = Core.Extensions.Utils.GetPropValue(this.Entity, this.FieldName);
                if (source == null) {
                    return;
                }
                var list = null;
                if (this._isStringSource) {
                    list = System.Linq.Enumerable.from((Bridge.as(source, System.String)).split(","), System.String).where(function (x) {
                            return Core.Extensions.StringExt.HasAnyChar(x);
                        }).toList(System.String);
                } else {
                    list = Bridge.unbox(source);
                }
                System.Linq.Enumerable.from(list, System.String).except(this._listValues).ToArray(System.String).forEach(Bridge.fn.cacheBind(this._listValues, this._listValues.add));
            },
            GridResultDomLoaded: function () {
                Core.Components.SearchEntry.prototype.GridResultDomLoaded.call(this);
                if (this._toggleButton != null) {
                    return;
                }
                Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this._gv.Element).Div, "dropdown-toolbar").Button.Event("click", Bridge.fn.cacheBind(this, this.ToggleAllRecord)), "fa fa-check").Attr$1("title", "Ch\u1ecdn t\u1ea5t c\u1ea3").End.Button.Event("click", Bridge.fn.cacheBind(this, this.Dispose)), "fa fa-times").Attr$1("title", "\u0110\u00f3ng g\u1ee3i \u00fd");
                this._toggleButton = Bridge.as(Core.MVVM.Html.Context.previousElementSibling, HTMLButtonElement);
            },
            ToggleAllRecord: function () {
                var value = this.ListValues;
                if (value == null) {
                    this.ListValues = new (System.Collections.Generic.List$1(System.String)).ctor();
                    this._toggleButton.setAttribute("title", "Ch\u1ecdn t\u1ea5t c\u1ea3");
                } else {
                    this.ListValues = null;
                    this._toggleButton.setAttribute("title", "H\u1ee7y ch\u1ecdn");
                }
                this.FindMatchText();
            },
            SetEntityValue: function (value) {
                if (this._isStringSource) {
                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, Core.Extensions.IEnumerableExtensions.Combine(System.String, value));
                } else {
                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, value);
                }
            },
            FindMatchText: function () {
                var $t;
                if (this.EmptyRow || this.ProcessLocalMatch()) {
                    return;
                }
                var values = this.ListValues;
                this.ClearTagIfNotExists();
                if (Core.Extensions.IEnumerableExtensions.HasElement(System.Object, this.MatchedItems) && Core.Extensions.IEnumerableExtensions.Nothing(System.String, System.Linq.Enumerable.from(values, System.String).except(System.Linq.Enumerable.from(this.MatchedItems, System.Object).select(function (x) {
                            return Bridge.unbox(x[Core.Components.EditableComponent.IdField]);
                        })))) {
                    this.SetMatchedValue();
                    return;
                }
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), Core.Clients.Client.Instance.ComQuery(($t = new Core.ViewModels.SqlViewModel(), $t.ComId = this.GuiInfo.Id, $t)), Bridge.fn.bind(this, function (ds) {
                    var $t1;
                    this.MatchedItems = ds.length > 0 ? ($t1 = System.Object, System.Linq.Enumerable.from(ds[System.Array.index(0, ds)], $t1).toList($t1)) : this.MatchedItems;
                    this.SetMatchedValue();
                }));
            },
            ProcessLocalMatch: function () {
                var isLocalMatched = this._gv != null && Core.Extensions.IEnumerableExtensions.HasElement(System.Object, this.RowData.Data) || this.GuiInfo.LocalData != null;
                if (isLocalMatched) {
                    var rows = Core.Extensions.IEnumerableExtensions.Nothing(System.Object, this.GuiInfo.LocalData) ? this.RowData.Data : this.GuiInfo.LocalData;
                    this.MatchedItems = System.Linq.Enumerable.from(rows, System.Object).where(Bridge.fn.bind(this, function (x) {
                            var $t;
                            return this._listValues.contains(($t = x[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null);
                        })).toList(System.Object);
                }
                if (Core.Extensions.IEnumerableExtensions.HasElement(System.Object, this.MatchedItems) && this.MatchedItems.Count === this._listValues.Count) {
                    this.SetMatchedValue();
                    return true;
                }
                return false;
            },
            SetMatchedValue: function () {
                this._input.value = "";
                this.ClearTagIfNotExists();
                for (var i = 0; i < this.ListValues.Count; i = (i + 1) | 0) {
                    var item = System.Linq.Enumerable.from(this.MatchedItems, System.Object).firstOrDefault(Bridge.fn.bind(this, function (x) {
                            var $t;
                            return Bridge.referenceEquals((($t = x[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null), this.ListValues.getItem(i));
                        }), null);
                    this.RenderTag(item);
                }
            },
            ClearTagIfNotExists: function () {
                var $t;
                var tags = System.Linq.Enumerable.from(this.ParentElement.querySelectorAll("div > span")).select(function (x) { return Bridge.cast(x, HTMLElement); }).select(function (tag) {
                    return new $asm.$AnonymousType$15(tag, tag.dataset.id);
                }).where(Bridge.fn.bind(this, function (x0) {
                    return x0.id != null && !this.ListValues.contains(x0.id);
                })).select(function (x1) {
                    return x1.tag;
                });
                $t = Bridge.getEnumerator(tags);
                try {
                    while ($t.moveNext()) {
                        var tag = $t.Current;
                        tag.remove();
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            RenderTag: function (item) {
                if (item == null) {
                    return;
                }
                var idAttr = Bridge.toString(item[Core.Components.EditableComponent.IdField]);
                var exist = this.Element.parentElement.querySelector(System.String.format("span[data-id='{0}']", [idAttr]));
                if (exist != null) {
                    return;
                }
                Core.MVVM.Html.Take(this.Element.parentElement).Span.Attr$1("data-id", idAttr).InnerHTML(this.GetMatchedText(item));
                var tag = Core.MVVM.Html.Context;
                this.Element.parentElement.insertBefore(Core.MVVM.Html.Context, this._input);
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Button, "fa fa-times").End.Event("click", Bridge.fn.bind(this, function () {
                    var $t, $t1, $t2, $t3;
                    var oldList = ($t = System.String, System.Linq.Enumerable.from(this.ListValues, $t).toList($t));
                    this.MatchedItems.remove(item);
                    var id = ($t1 = item[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t1) : null;
                    while (this.ListValues.contains(id)) {
                        this.ListValues.remove(id);
                    }
                    this.ListValues = this.ListValues;
                    this.Dirty = true;
                    this.FindMatchText();
                    !Bridge.staticEquals(($t2 = this.UserInput), null) ? $t2(($t3 = new Core.MVVM.ObservableArgs(), $t3.NewData = this.ListValues, $t3.OldData = oldList, $t3.EvType = "change", $t3)) : null;
                    tag.remove();
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity, this.ListValues, oldList]));
                })).End.Render();
            },
            EntrySelected: function (rowData) {
                var $t, $t1, $t2;
                window.clearTimeout(this._waitForDispose);
                if (rowData == null) {
                    return;
                }

                var id = ($t = rowData[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null;
                if (this.ListValues == null) {
                    this.ListValues = new (System.Collections.Generic.List$1(System.String)).ctor();
                }
                if (!this.ListValues.contains(id)) {
                    this.ListValues.add(id);
                    this.MatchedItems.add(rowData);
                } else {
                    this.ListValues.remove(id);
                    var exist = System.Linq.Enumerable.from(this.MatchedItems, System.Object).firstOrDefault(function (x) {
                            var $t1;
                            return Bridge.referenceEquals((($t1 = x[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t1) : null), id);
                        }, null);
                    this.MatchedItems.remove(exist);
                }
                this.ListValues = this.ListValues;
                this.Dirty = true;
                this.FindMatchText();
                this._input.focus();
                !Bridge.staticEquals(($t1 = this.UserInput), null) ? $t1(($t2 = new Core.MVVM.ObservableArgs(), $t2.NewData = this.ListValues, $t2.OldData = this.ListValues, $t2.NewMatch = rowData, $t2.EvType = "change", $t2)) : null;
                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.Events, "change", [this.Entity]));
            },
            UpdateView: function (force, dirty, componentNames) {
                if (force === void 0) { force = false; }
                if (dirty === void 0) { dirty = null; }
                if (componentNames === void 0) { componentNames = []; }
                this.TryParseData();
                this.FindMatchText();
            }
        }
    });

    Bridge.define("$AnonymousType$15", $asm, {
        $kind: "anonymous",
        ctors: {
            ctor: function (tag, id) {
                this.tag = tag;
                this.id = id;
            }
        },
        methods: {
            equals: function (o) {
                if (!Bridge.is(o, $asm.$AnonymousType$15)) {
                    return false;
                }
                return Bridge.equals(this.tag, o.tag) && Bridge.equals(this.id, o.id);
            },
            getHashCode: function () {
                var h = Bridge.addHash([7550209754, this.tag, this.id]);
                return h;
            },
            toJSON: function () {
                return {
                    tag : this.tag,
                    id : this.id
                };
            }
        },
        statics : {
            methods: {
                $metadata : function () { return {"m":[{"a":2,"n":"id","t":16,"rt":System.String,"g":{"a":2,"n":"get_id","t":8,"rt":System.String,"fg":"id"},"fn":"id"},{"a":2,"n":"tag","t":16,"rt":HTMLElement,"g":{"a":2,"n":"get_tag","t":8,"rt":HTMLElement,"fg":"tag"},"fn":"tag"}]}; }
            }
        }
    });

    Bridge.define("Core.Components.Password", {
        inherits: [Core.Components.Textbox],
        ctors: {
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.Textbox.ctor.call(this, ui, ele);
                this.Password = true;
            }
        }
    });

    Bridge.define("Core.Components.Textarea", {
        inherits: [Core.Components.Textbox],
        ctors: {
            ctor: function (ui, ele) {
                if (ele === void 0) { ele = null; }

                this.$initialize();
                Core.Components.Textbox.ctor.call(this, ui, ele);
                this.MultipleLine = true;
            }
        }
    });

    Bridge.define("Core.Components.Timepicker", {
        inherits: [Core.Components.Textbox],
        statics: {
            fields: {
                _waiter: 0,
                _hour: null,
                _minute: null
            },
            methods: {
                ClearClosingWaiter: function () {
                    window.clearTimeout(Core.Components.Timepicker._waiter);
                }
            }
        },
        props: {
            HHmmFormat: {
                get: function () {
                    return Core.Components.Datepicker.HHmmFormat;
                }
            },
            Hour: {
                get: function () {
                    var $t;
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(this.Text) || !Core.Extensions.StringExt.IsMatch(this.Text, "\\d{2}h\\d{2}")) {
                        this.Value = "00h00";
                    }

                    return System.Int64(($t = Core.Extensions.Utils.TryParseInt(System.Linq.Enumerable.from(this.Text.split("h"), System.String).firstOrDefault(null, null)), $t != null ? $t : 0));
                }
            },
            Minute: {
                get: function () {
                    var $t;
                    if (Core.Extensions.StringExt.IsNullOrWhiteSpace(this.Text) || !Core.Extensions.StringExt.IsMatch(this.Text, "\\d{2}h\\d{2}")) {
                        this.Value = "00h00";
                    }

                    return System.Int64(($t = Core.Extensions.Utils.TryParseInt(System.Linq.Enumerable.from(this.Text.split("h"), System.String).lastOrDefault(null, null)), $t != null ? $t : 0));
                }
            }
        },
        ctors: {
            ctor: function (ui) {
                this.$initialize();
                Core.Components.Textbox.ctor.call(this, ui);
            }
        },
        methods: {
            Render: function () {
                var $t;
                Core.Components.Textbox.prototype.Render.call(this);
                this.Disabled = true;
                this.Input.style.backgroundColor = "transparent";
                this.Input.addEventListener("focusin", Bridge.fn.cacheBind(this, this.RenderTimepicker));
                this.Input.addEventListener("focusout", Bridge.fn.cacheBind(this, this.WaitToClose));
                ($t = Core.Extensions.HtmlElementExtension.Closest(this.Element, "td")) != null ? $t.addEventListener("keydown", Bridge.fn.cacheBind(this, this.ListViewItemTab)) : null;
            },
            WaitToClose: function () {
                window.clearTimeout(Core.Components.Timepicker._waiter);
                Core.Components.Timepicker._waiter = window.setTimeout(function () {
                    Core.Components.Timepicker._hour.parentElement.parentElement.remove();
                }, 250);
            },
            RenderTimepicker: function () {
                Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.TabIndex(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element.parentElement).Div, "time-picker"), -1).Event("focusin", Core.Components.Timepicker.ClearClosingWaiter).Event("focusout", Bridge.fn.cacheBind(this, this.WaitToClose)).Div, "hour"), "fa fa-chevron-up").Event("click", Bridge.fn.bind(this, function () {
                    this.IncreaseTime(System.Int64(1));
                })).End.Input.Value(this.Hour.toString(this.HHmmFormat));
                Core.Components.Timepicker._hour = Bridge.as(Core.MVVM.Html.Context, HTMLInputElement);
                Core.Components.Timepicker._hour.addEventListener("change", Bridge.fn.cacheBind(this, this.ChangeHour));
                Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.Components.Renderer.Icon(Core.MVVM.Html.Instance.End, "fa fa-chevron-down").Event("click", Bridge.fn.bind(this, function () {
                    this.IncreaseTime(System.Int64(-1));
                })).EndOf$1(".hour").Div, "minute"), "fa fa-chevron-up").Event("click", Bridge.fn.bind(this, function () {
                    this.IncreaseTime(System.Int64(5), true);
                })).End.Input.Value(this.Minute.toString(this.HHmmFormat));
                Core.Components.Timepicker._minute = Bridge.as(Core.MVVM.Html.Context, HTMLInputElement);
                Core.Components.Timepicker._minute.addEventListener("change", Bridge.fn.cacheBind(this, this.ChangeMinute));
                Core.Components.Renderer.Icon(Core.MVVM.Html.Instance.End, "fa fa-chevron-down").Event("click", Bridge.fn.bind(this, function () {
                    this.IncreaseTime(System.Int64(-5), true);
                })).EndOf$1(".minute");
            },
            ChangeMinute: function (e) {
                var newMinute = { };
                var parsed = System.Int64.tryParse(Core.Components.Timepicker._minute.value, newMinute);
                Core.Components.Timepicker._minute.value = parsed ? newMinute.v.toString(this.HHmmFormat) : this.Minute.toString(this.HHmmFormat);
                this.Value = (Core.Components.Timepicker._hour.value || "") + "h" + (Core.Components.Timepicker._minute.value || "");
            },
            ChangeHour: function () {
                var newHour = { };
                var parsed = System.Int64.tryParse(Core.Components.Timepicker._hour.value, newHour);
                Core.Components.Timepicker._hour.value = parsed ? newHour.v.toString(this.HHmmFormat) : this.Hour.toString(this.HHmmFormat);
                this.Value = (Core.Components.Timepicker._hour.value || "") + "h" + (Core.Components.Timepicker._minute.value || "");
            },
            IncreaseTime: function (value, minute) {
                if (minute === void 0) { minute = false; }
                Core.Components.Timepicker.ClearClosingWaiter();
                var afterIncreaseHour = this.Hour.add(value);
                var afterIncreaseMinute = this.Minute.add(value);
                if (!minute && afterIncreaseHour.gte(System.Int64(0)) && afterIncreaseHour.lt(System.Int64(24))) {
                    Core.Components.Timepicker._hour.value = afterIncreaseHour.toString(this.HHmmFormat);
                } else if (afterIncreaseMinute.gte(System.Int64(0)) && afterIncreaseMinute.lt(System.Int64(60))) {
                    Core.Components.Timepicker._minute.value = afterIncreaseMinute.toString(this.HHmmFormat);
                }
                this.Value = (Core.Components.Timepicker._hour.value || "") + "h" + (Core.Components.Timepicker._minute.value || "");
                this.Dirty = true;
            }
        }
    });

    Bridge.define("Core.Components.TreeView", {
        inherits: [Core.Components.ListView],
        ctors: {
            ctor: function (ui) {
                this.$initialize();
                Core.Components.ListView.ctor.call(this, ui);

            }
        },
        methods: {
            Rerender: function () {
                var $t;
                this.DisposeNoRecord();
                this.Editable = this.GuiInfo.CanAdd && System.Linq.Enumerable.from(this.Header, Core.Models.Component).any(function (x) {
                        return !x.Hidden && x.Editable;
                    });
                this.Header = System.Linq.Enumerable.from(this.Header, Core.Models.Component).where(function (x) {
                        return !x.Hidden;
                    }).toList(Core.Models.Component);
                Core.Extensions.HtmlElementExtension.AddClass(this.MainSection.Element, "overflow");
                var firstData = ($t = Core.Extensions.IEnumerableExtensions.Nothing(System.Object, this.FormattedRowData) ? this.RowData.Data : this.FormattedRowData, this.FormattedRowData = $t, $t);
                this.RenderContent$1(this.Header, this.MainSection, true, firstData);
                this.MainSection.DisposeChildren();
                if (this.Editable) {
                    this.AddNewEmptyRow();
                } else if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, this.RowData.Data)) {
                    this.NoRecordFound();
                    this.DomLoaded();
                    return;
                }
                var tableElement;
                if (((tableElement = Bridge.as(this.MainSection.Element, HTMLTableSectionElement))) != null) {
                    tableElement.addEventListener("contextmenu", Bridge.fn.cacheBind(this, this.BodyContextMenuHandler));
                }
                this.DomLoaded();
                Core.Components.Spinner.Hide();
            },
            RenderContent$1: function (headers, node, first, rowDatas) {
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, rowDatas)) {
                    return;
                }
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(node.Element).Ul, ((!first ? "d-block " : " ") || "") + ((first ? " wtree" : " ") || ""));
                var ul = Core.MVVM.Html.Context;
                rowDatas.ForEach(Bridge.fn.bind(this, function (row) {
                    var $step = 0,
                        $task1, 
                        $jumpFromFinally, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        $task1 = this.RenderRow(headers, node, row, ul);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $task1.getAwaitedResult();
                                        return;
                                    }
                                    default: {
                                        return;
                                    }
                                }
                            }
                        }, arguments);

                    $asyncBody();
                }));
            },
            RenderRow: function (headers, node, row, ul) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    fn, 
                    isFn, 
                    data, 
                    $t, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        fn = { };
                                        isFn = Core.Extensions.Utils.IsFunction(this.GuiInfo.PreQuery, fn);
                                        $task1 = System.Threading.Tasks.Task.fromPromise(Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), Core.Clients.Client.Instance.ComQuery(($t = new Core.ViewModels.SqlViewModel(), $t.ComId = this.GuiInfo.Id, $t.Params = isFn ? JSON.stringify(Bridge.unbox(fn.v.call(null, this))) : null, $t)), Bridge.fn.bind(this, function (ds) {
                                            var $t1, $t2;
                                            var datas = ds.length > 0 ? ($t1 = System.Object, System.Linq.Enumerable.from(ds[System.Array.index(0, ds)], $t1).toList($t1)) : null;
                                            var count = ds.length > 1 && ds[System.Array.index(1, ds)].length > 0 ? Bridge.cast((ds[System.Array.index(1, ds)]).total, System.Int32) : 0;
                                            Core.MVVM.Html.Take(ul);
                                            var rowSection = ($t2 = new Core.Components.ListViewItem(Core.MVVM.ElementType.li), $t2.Entity = row, $t2.ListViewSection = this.MainSection, $t2);
                                            node.AddChild(rowSection);
                                            Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, count > 0 ? "has" : "").Render();
                                            var label = Core.MVVM.Html.Context;
                                            Core.Extensions.IEnumerableExtensions.SelectForEach(Core.Models.Component, headers, function (header) {
                                                var com = header;
                                                Core.MVVM.Html.Take(label).P.Render();
                                                rowSection.RenderTableCell(row, com);
                                                Core.MVVM.Html.Take(label).EndOf(Core.MVVM.ElementType.p);
                                            });
                                            if (count > 0) {
                                                rowSection.Element.addEventListener("click", Bridge.fn.bind(this, function () {
                                                    this.FocusIn(rowSection, row, datas);
                                                }));
                                            }
                                        })));
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        data = $taskResult1;
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            FocusIn: function (listViewItem, row, datas) {
                var ul = listViewItem.Element.querySelector("ul");
                if (Core.Extensions.HtmlElementExtension.HasClass(listViewItem.Element, "expanded")) {
                    Core.Extensions.HtmlElementExtension.RemoveClass(ul, "d-block");
                    Core.Extensions.HtmlElementExtension.AddClass(ul, "d-none");
                    Core.Extensions.HtmlElementExtension.RemoveClass(listViewItem.Element, "expanded");
                } else {
                    Core.Extensions.HtmlElementExtension.AddClass(listViewItem.Element, "expanded");
                    if (ul == null) {
                        this.RenderContent$1(this.Header, listViewItem, false, datas);
                    } else {
                        Core.Extensions.HtmlElementExtension.RemoveClass(ul, "d-none");
                        Core.Extensions.HtmlElementExtension.AddClass(ul, "d-block");
                        Core.Extensions.HtmlElementExtension.AddClass(listViewItem.Element, "expanded");
                    }
                }
            },
            CalcFilterQuery: function () {
                var res = Core.Components.ListView.prototype.CalcFilterQuery.call(this);
                var resetSearch = Core.Extensions.StringExt.IsNullOrWhiteSpace(this.ListViewSearch.EntityVM.SearchTerm) && Core.Extensions.IEnumerableExtensions.Nothing(Core.Models.FieldCondition, this.AdvSearchVM.Conditions);
                if (!resetSearch) {
                    var filterPart = Core.Extensions.OdataExt.GetClausePart(res, Core.Extensions.OdataExt.FilterKeyword);
                    filterPart = filterPart.replace(new RegExp("((and|or) )?Parent(\\w|\\W)* eq null( (and|or)$)?"), "");
                    filterPart = filterPart.replace(new RegExp("^Parent(\\w|\\W)* eq null( (and|or))?"), "");
                    return Core.Extensions.OdataExt.ApplyClause(res, filterPart);
                }
                return res;
            }
        }
    });

    Bridge.define("Core.Components.Forms.PopupEditor", {
        inherits: [Core.Components.Forms.TabEditor],
        ctors: {
            ctor: function (entity) {
                var $t;
                this.$initialize();
                Core.Components.Forms.TabEditor.ctor.call(this, entity);
                this.Popup = true;
                this.ParentElement = ($t = this.TabEditor) != null ? $t.Element : null;
                this.ShouldLoadEntity = false;
            }
        }
    });

    Bridge.define("Core.Components.CompareGridView", {
        inherits: [Core.Components.GridView],
        statics: {
            fields: {
                ContentFieldName: null,
                ReasonOfChange: null,
                Style: null
            },
            ctors: {
                init: function () {
                    this.ContentFieldName = "TextHistory";
                    this.ReasonOfChange = "ReasonOfChange";
                    this.Style = "white-space: pre-wrap;";
                }
            }
        },
        ctors: {
            ctor: function (ui) {
                this.$initialize();
                Core.Components.GridView.ctor.call(this, ui);
                this.GuiInfo.LocalHeader = function (_o1) {
                        var $t, $t1;
                        _o1.add(($t = new Core.Models.Component(), $t.FieldName = "InsertedBy", $t.ComponentType = "Label", $t.ShortDesc = "Ng\u01b0\u1eddi thao t\u00e1c", $t.Description = "Ng\u01b0\u1eddi thao t\u00e1c", $t.ReferenceId = ($t1 = Core.Extensions.Utils.GetEntity("User")) != null ? $t1.Id : null, $t.RefName = "User", $t.FormatData = "{FullName}", $t.Active = true, $t));
                        _o1.add(($t = new Core.Models.Component(), $t.FieldName = "InsertedDate", $t.ComponentType = "Label", $t.ShortDesc = "Ng\u00e0y thao t\u00e1c", $t.Description = "Ng\u00e0y thao t\u00e1c", $t.Active = true, $t.TextAlign = "left", $t.FormatData = "{0:dd/MM/yyyy HH:mm zz}", $t));
                        _o1.add(($t = new Core.Models.Component(), $t.FieldName = "ReasonOfChange", $t.ComponentType = "Label", $t.ShortDesc = "N\u1ed9i dung", $t.Description = "N\u1ed9i dung", $t.HasFilter = true, $t.Active = true, $t));
                        _o1.add(($t = new Core.Models.Component(), $t.FieldName = "TextHistory", $t.ComponentType = "Label", $t.ChildStyle = Core.Components.CompareGridView.Style, $t.ShortDesc = "Chi ti\u1ebft thay \u0111\u1ed5i", $t.Description = "Chi ti\u1ebft thay \u0111\u1ed5i", $t.HasFilter = true, $t.Active = true, $t));
                        return _o1;
                    }(new (System.Collections.Generic.List$1(Core.Models.Component)).ctor());
            }
        },
        methods: {
            FilterColumns: function (Component) {
                Core.Components.GridView.prototype.FilterColumns.call(this, Component);
                Component.ForEach(function (x) {
                    x.Frozen = false;
                });
                this.Header.remove(System.Linq.Enumerable.from(this.Header, Core.Models.Component).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x, Core.Components.GridView.ToolbarColumn);
                    }, null));
                return Component;
            }
        }
    });

    Bridge.define("Core.Components.FileUploadGrid", {
        inherits: [Core.Components.GridView],
        ctors: {
            ctor: function (ui) {
                this.$initialize();
                Core.Components.GridView.ctor.call(this, ui);
                this.GuiInfo = ui;
                ui.LocalHeader = Bridge.fn.bind(this, function (_o1) {
                        var $t, $t1, $t2;
                        _o1.add(($t = new Core.Models.Component(), $t.FieldName = "FileName", $t.Editable = true, $t.ShortDesc = "Name", $t.ComponentType = "Input", $t.Order = 2, $t));
                        _o1.add(($t = new Core.Models.Component(), $t.FieldName = "FilePath", $t.Editable = true, $t.Active = true, $t.ComponentType = "Image", $t.DataSourceFilter = Core.Extensions.StringExt.IsNullOrEmpty(ui.DataSourceFilter) ? "*.*" : ui.DataSourceFilter, $t.ShortDesc = "File", $t.IsRealtime = this.GuiInfo.IsRealtime, $t.Precision = 1, $t.Order = 1, $t));
                        _o1.add(($t = new Core.Models.Component(), $t.FieldName = "InsertedBy", $t.Active = true, $t.RefName = "User", $t.ReferenceId = ($t1 = Core.Extensions.Utils.GetEntity("User")) != null ? $t1.Id : null, $t.FormatData = "{FullName}", $t.ComponentType = "Label", $t.ShortDesc = "Created by", $t.Order = 3, $t));
                        _o1.add(($t = new Core.Models.Component(), $t.FieldName = "InsertedDate", $t.Active = true, $t.ComponentType = "Label", $t.ShortDesc = "Created date", $t.Order = 4, $t));
                        _o1.add(($t = new Core.Models.Component(), $t.FieldName = "UpdatedBy", $t.Active = true, $t.RefName = "User", $t.ReferenceId = ($t2 = Core.Extensions.Utils.GetEntity("User")) != null ? $t2.Id : null, $t.FormatData = "{FullName}", $t.ComponentType = "Label", $t.ShortDesc = "Updated by", $t.Order = 5, $t));
                        _o1.add(($t = new Core.Models.Component(), $t.FieldName = "UpdatedDate", $t.Active = true, $t.ComponentType = "Label", $t.ShortDesc = "Updated date", $t.Order = 6, $t));
                        return _o1;
                    })(new (System.Collections.Generic.List$1(Core.Models.Component)).ctor());
                ui.Row = 2147483647;
                this.DOMContentLoaded = Bridge.fn.combine(this.DOMContentLoaded, Bridge.fn.cacheBind(this, this.SetEntityPath));
            }
        },
        methods: {
            Render: function () {
                this.RowData._data = new (System.Collections.Generic.List$1(System.Object)).ctor();
                this.GuiInfo.DataSourceFilter = System.String.format("?$filter=EntityName eq '{0}' and RecordId eq {1} and FieldName eq '{2}' and SectionId eq {3} and RecordId ne 0", this.GuiInfo.IdField, this.Entity[Core.Components.EditableComponent.IdField], this.FieldName, this.GuiInfo.ComponentGroupId);
                this.DataSourceFilter = this.GuiInfo.DataSourceFilter;
                Core.Components.GridView.prototype.Render.call(this);
                this.Paginator.Show = false;
            },
            AddSections: function () {
                var $t;
                if ((($t = this.HeaderSection) != null ? $t.Element : null) != null) {
                    return;
                }
                Core.Components.GridView.prototype.AddSections.call(this);
                Core.Components.Renderer.Title(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element).Div, "toolbar").Button, "btn fa fa-download"), "Download all").Event("click", Bridge.fn.cacheBind(this, this.DownloadAll)).End.Render();
                Core.Extensions.HtmlElementExtension.Prepend(this.Element, Core.MVVM.Html.Context);
            },
            DownloadAll: function () {
                System.Linq.Enumerable.from(this.RowData.Data, System.Object).select(function (x) {
                        return Core.Extensions.BridgeExt.CastProp(Core.ViewModels.FileUpload, x);
                    }).forEach(function (x) {
                    Core.Clients.Client.Download(x.FilePath);
                });
            },
            RowChangeHandler: function (rowData, rowSection, observableArgs, component) {
                var $step = 0,
                    $task1, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        if (component === void 0) { component = null; }
                                        if (System.Nullable.lte(Bridge.unbox(rowData.Id), 0)) {
                                            rowData.InsertedBy = Core.Clients.Client.Token.UserId;
                                            rowData.InsertedDate = Bridge.box(System.DateTime.getNow(), System.DateTime, System.DateTime.format);
                                        } else {
                                            rowData.UpdatedBy = Core.Clients.Client.Token.UserId;
                                            rowData.UpdatedDate = Bridge.box(System.DateTime.getNow(), System.DateTime, System.DateTime.format);
                                        }
                                        rowData.EntityName = this.GuiInfo.IdField;
                                        rowData.RecordId = this.EntityId;
                                        rowData.SectionId = this.GuiInfo.ComponentGroupId;
                                        rowData.FieldName = this.FieldName;
                                        rowData.FileName = Core.Components.Image.RemoveGuid(Bridge.as(rowData.FilePath, System.String));
                                        $task1 = this.RowChangeHandlerGrid(rowData, rowSection, observableArgs);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $task1.getAwaitedResult();
                                        rowSection.UpdateView$1(true);
                                        this.SetEntityPath();
                                        if (this.GuiInfo.IsRealtime && this.EntityId != null) {
                                            this.RealtimeUpdate(rowSection, observableArgs);
                                        }
                                        this.Dirty = true;
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            BatchUpdate: function (updateView) {
                if (updateView === void 0) { updateView = false; }
                this.UpdatedRows.ForEach(Bridge.fn.bind(this, function (row) {
                    row.RecordId = this.EntityId;
                }));
                Core.Components.GridView.prototype.BatchUpdate.call(this, updateView);
            },
            SetEntityPath: function () {
                this.Entity[this.FieldName] = Core.Extensions.IEnumerableExtensions.Combine$1(Core.Components.ListViewItem, System.String, this.AllListViewItem, function (x) {
                    return Bridge.as(x.Entity.FilePath, System.String);
                }, Core.Components.Image.PathSeparator);
            },
            SetRowData: function (listData) {
                if (listData == null) {
                    listData = new (System.Collections.Generic.List$1(System.Object)).ctor();
                }
                listData = this.MergePaths(listData);
                this.RowData._data = new (System.Collections.Generic.List$1(System.Object)).ctor();
                if (Core.Extensions.IEnumerableExtensions.HasElement(System.Object, listData)) {
                    listData.ForEach(Bridge.fn.cacheBind(this.RowData._data, this.RowData._data.add));
                }
                this.RenderContent();
                this.SetEntityPath();
            },
            MergePaths: function (listData) {
                var pathCombined = Bridge.as(this.Entity[this.FieldName], System.String);
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(pathCombined)) {
                    return listData;
                }
                var separatedFiles = Core.Extensions.ReflectionExt.ToDictionaryDistinct(System.Object, System.String, listData, function (x) {
                    return Bridge.unbox(x.FilePath);
                });
                var existPaths = pathCombined.split(Core.Components.Image.PathSeparator);
                var existFiles = System.Linq.Enumerable.from(existPaths, System.String).select(Bridge.fn.bind(this, function (x) {
                        var $t;
                        var metaData = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, System.Object, separatedFiles, x);
                        return ($t = new Core.ViewModels.FileUpload(), $t.EntityName = this.GuiInfo.IdField, $t.RecordId = this.EntityId, $t.SectionId = this.GuiInfo.ComponentGroupId, $t.FieldName = this.FieldName, $t.FileName = Core.Components.Image.RemoveGuid(x), $t.FilePath = x, $t.Id = (metaData != null ? metaData.Id : null) || 0, $t.InsertedBy = (metaData != null ? metaData.InsertedBy : null) || 1, $t.InsertedDate = (metaData != null ? metaData.InsertedDate : null) || System.DateTime.getNow(), $t.UpdatedBy = metaData != null ? metaData.UpdatedBy : null, $t.UpdatedDate = metaData != null ? metaData.UpdatedDate : null, $t);
                    })).ToArray(Core.ViewModels.FileUpload);
                listData = System.Linq.Enumerable.from(Core.Extensions.BridgeExt.DistinctBy(Core.ViewModels.FileUpload, System.String, System.Linq.Enumerable.from(existFiles, Core.ViewModels.FileUpload).union(System.Linq.Enumerable.from(listData, System.Object).select(function (x) {
                            return Core.Extensions.BridgeExt.CastProp(Core.ViewModels.FileUpload, x);
                        })), function (x) {
                    return x.FilePath;
                })).select(function (x) { return Bridge.cast(x, System.Object); }).toList(System.Object);
                return listData;
            },
            HardDeleteConfirmed: function (deleted) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    deleted1, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        $task1 = Core.Components.GridView.prototype.HardDeleteConfirmed.call(this, deleted);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        deleted1 = $taskResult1;
                                        this.Dirty = true;
                                        this.SetEntityPath();
                                        $tcs.setResult(deleted1);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            }
        }
    });

    Bridge.define("Core.Components.GridViewItem", {
        inherits: [Core.Components.ListViewItem],
        ctors: {
            ctor: function (tr) {
                this.$initialize();
                Core.Components.ListViewItem.ctor.call(this, tr);
            }
        },
        methods: {
            Render: function () {
                Core.Components.ListViewItem.prototype.Render.call(this);
            },
            RenderTableCell: function (rowData, header, cellWrapper) {
                if (cellWrapper === void 0) { cellWrapper = null; }
                Core.Components.Renderer.TabIndex(Core.MVVM.Html.Take(this.Element).TData, -1).Event$1("focusin", Bridge.fn.bind(this, function (e) {
                    this.FocusCell(e, header);
                })).DataAttr$1("field", header.FieldName).Render();
                if (header.StatusBar) {
                    Core.Components.Renderer.Icon(Core.MVVM.Html.Instance, "fa fa-pencil").End.Render();
                }
                if (System.String.isNullOrEmpty(header.FieldName)) {
                    return;
                }
                Core.Components.ListViewItem.prototype.RenderTableCell.call(this, rowData, header, cellWrapper || Core.MVVM.Html.Context);
                Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.td);
            },
            FocusCell: function (e, header) {
                var $t, $t1;
                ($t = this.ListViewSection.ListView.LastElementFocus) != null ? Core.Extensions.HtmlElementExtension.RemoveClass(Core.Extensions.HtmlElementExtension.Closest($t, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), "cell-selected") : null;
                var td = Bridge.as(e.target, HTMLElement);
                Core.Extensions.HtmlElementExtension.AddClass(Core.Extensions.HtmlElementExtension.Closest(td, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), "cell-selected");
                this.ListViewSection.ListView.LastElementFocus = td;
                this.ListViewSection.ListView.LastComponentFocus = header;
                this.ListViewSection.ListView.EntityFocusId = ($t1 = this.Entity[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t1) : null;
            }
        }
    });

    Bridge.define("Core.Components.GroupGridView", {
        inherits: [Core.Components.GridView],
        statics: {
            fields: {
                _groupKey: null,
                GroupRowClass: null
            },
            ctors: {
                init: function () {
                    this._groupKey = "__groupkey__";
                    this.GroupRowClass = "group-row";
                }
            }
        },
        ctors: {
            ctor: function (ui) {
                this.$initialize();
                Core.Components.GridView.ctor.call(this, ui);
            }
        },
        methods: {
            Render: function () {
                Core.Components.GridView.prototype.Render.call(this);
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(this.Element), "group-table").End.Render();
            },
            RenderContent: function () {
                this.AddSections();
                this.FormattedRowData = Core.Extensions.IEnumerableExtensions.Nothing(System.Object, this.FormattedRowData) ? this.RowData.Data : this.FormattedRowData;
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, this.FormattedRowData)) {
                    return;
                }
                this.MainSection.Show = false;
                this.MainSection.DisposeChildren();
                Core.Extensions.IEnumerableExtensions.SelectForEach$1(System.Object, this.FormattedRowData, Bridge.fn.bind(this, function (row, index) {
                    Core.MVVM.Html.Take(this.MainSection.Element);
                    this.RenderRowData(this.Header, row, this.MainSection, null);
                }));
                this.MainSection.Show = true;
                this.ContentRendered();
            },
            ApplyFilter: function () {
                this.MainSection.DisposeChildren();
                return Core.Components.GridView.prototype.ApplyFilter.call(this);
            },
            NoRowData: function (list) {
                this.Editable = this.GuiInfo.CanAdd && System.Linq.Enumerable.from(this.Header, Core.Models.Component).any(function (x) {
                        return !x.Hidden && x.Editable;
                    });
                if (this.Editable) {
                    this.AddNewEmptyRow();
                } else if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, list)) {
                    this.NoRecordFound();
                }
            },
            AddRow: function (item, fromIndex, singleAdd) {
                var $t;
                if (singleAdd === void 0) { singleAdd = true; }
                fromIndex = 0;
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                this.DisposeNoRecord();
                var keys = this.GuiInfo.GroupBy.split(",");
                item[Core.Components.GroupGridView._groupKey] = Bridge.toArray(System.Linq.Enumerable.from(keys, System.String).select(function (key) {
                            var $t;
                            return ($t = Core.Extensions.Utils.GetPropValue(item, key)) != null ? Bridge.toString($t) : null;
                        })).join(" ");
                var groupKey = item[Core.Components.GroupGridView._groupKey];
                var existGroup = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).firstOrDefault(function (group) {
                        return group.GroupRow && Bridge.referenceEquals(Bridge.unbox(group.Entity).Key, groupKey);
                    }, null);
                var row;
                if (existGroup == null) {
                    var groupData = ($t = new Core.Components.GroupRowData(), $t.Key = groupKey, $t.Children = function (_o1) {
                            _o1.add(item);
                            return _o1;
                        }(new (System.Collections.Generic.List$1(System.Object)).ctor()), $t);
                    this.FormattedRowData.add(groupData);
                    row = this.RenderRowData(this.Header, groupData, this.MainSection, 0);
                } else {
                    Bridge.unbox(existGroup.Entity).Children.add(item);
                    var index = this.MainSection.Children.indexOf(existGroup);
                    row = this.RenderRowData(this.Header, item, this.MainSection, Bridge.Int.clip32(((index + existGroup.Children.Count) | 0) + 1));
                }
                this.Dirty = true;
                tcs.trySetResult(row);
                return tcs.task;
            },
            RenderRowData: function (headers, row, section, index, emptyRow) {
                var $t;
                if (emptyRow === void 0) { emptyRow = false; }
                var groupRow;
                if (!(((groupRow = Bridge.as(row, Core.Components.GroupRowData))) != null)) {
                    return Core.Components.GridView.prototype.RenderRowData.call(this, headers, row, section, index, emptyRow);
                }
                var tbody;
                if (!(((tbody = Bridge.as(section.Element, HTMLTableSectionElement))) != null)) {
                    throw new System.InvalidOperationException.$ctor1("The section is not HTML table element");
                }
                Core.MVVM.Html.Take(tbody);
                if (groupRow.Key == null || Core.Extensions.StringExt.IsNullOrWhiteSpace(Bridge.toString(groupRow.Key))) {
                    var rowResult = null;
                    groupRow.Children.ForEach(Bridge.fn.bind(this, function (child) {
                        Core.MVVM.Html.Take(tbody);
                        rowResult = Core.Components.GridView.prototype.RenderRowData.call(this, headers, child, section, null);
                    }));
                    return rowResult;
                }
                var first = System.Linq.Enumerable.from(groupRow.Children, System.Object).firstOrDefault(null, null);
                var groupSection = ($t = new Core.Components.GroupViewItem(Core.MVVM.ElementType.tr), $t.Entity = row, $t.ParentElement = tbody, $t.GroupRow = true, $t.ListViewSection = Bridge.as(section, Core.Components.ListViewSection), $t.ListView = this, $t);
                section.AddChild(groupSection);
                groupSection.Element.tabIndex = -1;
                var groupText;
                var fn = { };
                if (Core.Extensions.Utils.IsFunction(this.GuiInfo.GroupFormat, fn)) {
                    groupText = Bridge.toString(fn.v.call(this, this, Bridge.unbox(first)));
                } else {
                    groupText = Core.Extensions.Utils.FormatEntity(this.GuiInfo.GroupFormat, null, first, Core.Extensions.Utils.EmptyFormat, Core.Extensions.Utils.EmptyFormat);
                }
                if (this.GuiInfo.GroupReferenceId != null) {
                    var val = Core.Extensions.Utils.GetPropValue(first, this.GuiInfo.GroupBy.substr(0, ((this.GuiInfo.GroupBy.length - 2) | 0)));
                    groupSection.Entity = val;
                    Core.Extensions.BridgeExt.SetPropValue(groupSection.Entity, "ModelName", this.GuiInfo.RefName);
                    System.Linq.Enumerable.from(headers, Core.Models.Component).where(function (x) {
                            return !x.Hidden;
                        }).forEach(Bridge.fn.bind(this, function (header) {
                        Core.Components.Renderer.TabIndex(Core.MVVM.Html.Instance.TData, -1).Style$1(header.Style).Event$1("focusin", Bridge.fn.bind(this, function (e) {
                            this.FocusCell(e, header);
                        })).DataAttr$1("field", header.FieldName).Render();
                        var td = Core.MVVM.Html.Context;
                        groupSection.RenderTableCell(val, header, td);
                        Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.td);
                    }));
                } else {
                    Core.Components.Renderer.ClassName(Core.Components.Renderer.Icon(Core.Components.Renderer.ColSpan(Core.Components.Renderer.Icon(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.TData, "status-cell"), "mif-pencil").EndOf(Core.MVVM.ElementType.td).TData, ((headers.Count - 1) | 0)).Event$2(System.Object, "click", Bridge.fn.cacheBind(this, this.DispatchClick), first).Event$2(System.Object, "dblclick", Bridge.fn.cacheBind(this, this.DispatchDblClick), first), "fa fa-chevron-down").Event("click", function () {
                        groupSection.ShowChildren = !groupSection.ShowChildren;
                    }).End.Div, "d-flex").InnerHTML(groupText);
                    groupSection.GroupText = Core.MVVM.Html.Context;
                    groupSection.Chevron = Core.MVVM.Html.Context.previousElementSibling;
                    groupSection.Chevron.parentElement.previousElementSibling.appendChild(groupSection.Chevron);
                    Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.td);
                }
                Core.MVVM.Html.Instance.EndOf(Core.MVVM.ElementType.tr);
                groupRow.Children.ForEach(Bridge.fn.bind(this, function (child) {
                    Core.MVVM.Html.Take(tbody);
                    var rowSection = Core.Components.GridView.prototype.RenderRowData.call(this, headers, child, section);
                    Core.Extensions.HtmlElementExtension.AddClass(rowSection.Element, "group-detail");
                    groupSection.ChildrenItems.add(rowSection);
                    rowSection.GroupSection = groupSection;
                }));
                return groupSection;
            },
            DispatchClick: function (row) {
                Core.Clients.Client.ExecTaskNoResult(Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.GroupEvent, "click", [row]));
            },
            DispatchDblClick: function (row) {
                Core.Clients.Client.ExecTaskNoResult(Core.Components.Extensions.ComponentExt.DispatchEvent(this, this.GuiInfo.GroupEvent, "dblclick", [row]));
            },
            ToggleAll: function () {
                var allSelected = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).where(function (x) {
                        return !x.GroupRow && !x.EmptyRow;
                    }).all(function (x) {
                    return x.Selected;
                });
                if (allSelected) {
                    this.ClearSelected();
                } else {
                    this.RowAction(function (x) {
                        x.Selected = !x.GroupRow && !x.EmptyRow;
                    });
                }
            },
            RemoveRowById: function (id) {
                var index = Core.Extensions.IEnumerableExtensions.IndexOf(System.Object, this.RowData.Data, function (x) {
                    return Bridge.referenceEquals(Bridge.toString(x[Core.Components.EditableComponent.IdField]), id);
                });
                if (index < 0) {
                    return;
                }

                this.RowData.Data.removeAt(index);
                System.Linq.Enumerable.from(this.FilterChildren$1(function (x) {
                    return Bridge.is(x, Core.Components.ListViewItem) && Bridge.referenceEquals(Bridge.toString(x.Entity[Core.Components.EditableComponent.IdField]), id);
                })).select(function (x) { return Bridge.cast(x, Core.Components.ListViewItem); }).toList(Core.Components.ListViewItem).ForEach(Bridge.fn.bind(this, function (x) {
                    if (x.GroupSection != null && Bridge.is(x.GroupSection.Entity, Core.Components.GroupRowData)) {
                        var groupChildren = Bridge.unbox(x.GroupSection.Entity).Children;
                        groupChildren.remove(x.Entity);
                        if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, groupChildren)) {
                            this.RowData.Data.remove(x.GroupSection.Entity);
                            x.GroupSection.Dispose();
                        }
                    }
                    x.Dispose();
                }));
                this.NoRowData(this.RowData.Data);
            },
            RemoveRange: function (data) {
                Core.Extensions.IEnumerableExtensions.SelectForEach(System.Object, data, Bridge.fn.bind(this, function (x) {
                    this.RemoveRowById(Bridge.toString(x[Core.Components.EditableComponent.IdField]));
                }));
            },
            AddRows: function (rowsData, index) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    listItem, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        if (index === void 0) { index = 0; }
                                        listItem = new (System.Collections.Generic.List$1(Core.Components.ListViewItem)).ctor();
                                        $task1 = Core.Extensions.IEnumerableExtensions.ForEachAsync(System.Object, rowsData, Bridge.fn.bind(this, function (x) {
                                            var $step = 0,
                                                $task1, 
                                                $taskResult1, 
                                                $jumpFromFinally, 
                                                $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                                                $returnValue, 
                                                $async_e, 
                                                $asyncBody = Bridge.fn.bind(this, function () {
                                                    try {
                                                        for (;;) {
                                                            $step = System.Array.min([0,1], $step);
                                                            switch ($step) {
                                                                case 0: {
                                                                    $task1 = this.AddRow(x, 0, false);
                                                                    $step = 1;
                                                                    if ($task1.isCompleted()) {
                                                                        continue;
                                                                    }
                                                                    $task1.continue($asyncBody);
                                                                    return;
                                                                }
                                                                case 1: {
                                                                    $taskResult1 = $task1.getAwaitedResult();
                                                                    listItem.add($taskResult1);
                                                                    $tcs.setResult(null);
                                                                    return;
                                                                }
                                                                default: {
                                                                    $tcs.setResult(null);
                                                                    return;
                                                                }
                                                            }
                                                        }
                                                    } catch($async_e1) {
                                                        $async_e = System.Exception.create($async_e1);
                                                        $tcs.setException($async_e);
                                                    }
                                                }, arguments);

                                            $asyncBody();
                                            return $tcs.task;
                                        }));
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        $tcs.setResult(listItem);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            AddOrUpdateRow: function (rowData, singleAdd, force, fields) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $task2, 
                    $taskResult2, 
                    $jumpFromFinally, 
                    $tcs = new System.Threading.Tasks.TaskCompletionSource(), 
                    $returnValue, 
                    existRowData, 
                    $async_e, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                $step = System.Array.min([0,1,2,3,4,5,6,7], $step);
                                switch ($step) {
                                    case 0: {
                                        if (singleAdd === void 0) { singleAdd = true; }
                                        if (force === void 0) { force = false; }
                                        if (fields === void 0) { fields = []; }
                                        existRowData = System.Linq.Enumerable.from(this.FilterChildren$1(function (x) {
                                            return Bridge.is(x, Core.Components.ListViewItem) && Bridge.referenceEquals(x.Entity[Core.Components.EditableComponent.IdField], rowData[Core.Components.EditableComponent.IdField]);
                                        })).select(function (x) { return Bridge.cast(x, Core.Components.ListViewItem); }).firstOrDefault(null, null);
                                        if (existRowData == null) {
                                            $step = 1;
                                            continue;
                                        } 
                                        $step = 3;
                                        continue;
                                    }
                                    case 1: {
                                        $task1 = this.AddRow(rowData, 0, singleAdd);
                                        $step = 2;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 2: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    case 3: {
                                        if (existRowData.EmptyRow) {
                                            $step = 4;
                                            continue;
                                        } else  {
                                            $step = 6;
                                            continue;
                                        }
                                    }
                                    case 4: {
                                        existRowData.Entity = null;
                                        $task2 = this.AddRow(rowData, 0, singleAdd);
                                        $step = 5;
                                        if ($task2.isCompleted()) {
                                            continue;
                                        }
                                        $task2.continue($asyncBody);
                                        return;
                                    }
                                    case 5: {
                                        $taskResult2 = $task2.getAwaitedResult();
                                        $step = 7;
                                        continue;
                                    }
                                    case 6: {
                                        Core.Extensions.ReflectionExt.CopyPropFrom(existRowData.Entity, rowData);
                                        this.RowAction$2(function (x) {
                                            return Bridge.referenceEquals(x.Entity, existRowData.Entity);
                                        }, function (x) {
                                            x.UpdateView$1(force, fields);
                                        });
                                        $step = 7;
                                        continue;
                                    }
                                    case 7: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                    default: {
                                        $tcs.setResult(null);
                                        return;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            $tcs.setException($async_e);
                        }
                    }, arguments);

                $asyncBody();
                return $tcs.task;
            },
            RenderIndex: function (skip) {
                if (skip === void 0) { skip = null; }
                window.clearTimeout(this._renderIndexAwaiter);
                this._renderIndexAwaiter = window.setTimeout(Bridge.fn.bind(this, function () {
                    var index = 0;
                    var indexRow = 0;
                    var isChild = false;
                    System.Linq.Enumerable.from(this.MainSection.Children).select(function (x) { return Bridge.cast(x, Core.Components.ListViewItem); }).forEach(function (row) {
                        if (row.GroupRow) {
                            index = 0;
                            isChild = true;
                            return;
                        }
                        if (!Core.Extensions.HtmlElementExtension.HasClass(row.Element, "group-detail") && isChild) {
                            index = 0;
                            isChild = false;
                        }
                        var previous = Core.Extensions.HtmlElementExtension.Closest(row.FirstChild.Element, "td").previousElementSibling;
                        if (previous == null) {
                            return;
                        }
                        if (row.EmptyRow) {
                            index = 0;
                            previous.innerHTML = "<i class='fal fa-plus'></i>";
                        } else {
                            previous.innerHTML = Bridge.toString((((index + 1) | 0)));
                            row.RowNo = indexRow;
                            indexRow = (indexRow + 1) | 0;
                            index = (index + 1) | 0;
                        }
                    });
                }));
            },
            SetRowData: function (listData) {
                this.RowData._data.clear();
                var hasElement = Core.Extensions.IEnumerableExtensions.HasElement(System.Object, listData);
                if (hasElement) {
                    listData.ForEach(Bridge.fn.cacheBind(this.RowData._data, this.RowData._data.add)); // Not to use AddRange because the _data is not always List
                }
                this.RenderContent();

                if (this.Entity != null && this.ShouldSetEntity) {
                    Core.Extensions.BridgeExt.SetComplexPropValue(this.Entity, this.FieldName, this.RowData.Data);
                }
            }
        }
    });

    Bridge.define("Core.Components.GroupViewItem", {
        inherits: [Core.Components.ListViewItem],
        statics: {
            fields: {
                ChevronDown: null,
                ChevronRight: null
            },
            ctors: {
                init: function () {
                    this.ChevronDown = "fa-chevron-down";
                    this.ChevronRight = "fa-chevron-right";
                }
            }
        },
        fields: {
            _showChildren: false
        },
        props: {
            ParentItem: null,
            ChildrenItems: null,
            GroupText: null,
            Chevron: null,
            Selected: {
                get: function () {
                    return false;
                },
                set: function (value) {
                    this._selected = false;
                }
            },
            ShowChildren: {
                get: function () {
                    return this._showChildren;
                },
                set: function (value) {
                    this._showChildren = value;
                    this.ChildrenItems.ForEach(function (x) {
                        x.Show = value;
                    });
                    if (value) {
                        Core.Extensions.HtmlElementExtension.ReplaceClass(this.Chevron, Core.Components.GroupViewItem.ChevronRight, Core.Components.GroupViewItem.ChevronDown);
                    } else {
                        Core.Extensions.HtmlElementExtension.ReplaceClass(this.Chevron, Core.Components.GroupViewItem.ChevronDown, Core.Components.GroupViewItem.ChevronRight);
                    }
                }
            }
        },
        ctors: {
            ctor: function (elementType) {
                this.$initialize();
                Core.Components.ListViewItem.ctor.call(this, elementType);
                this.GroupRow = true;
                this.ChildrenItems = new (System.Collections.Generic.List$1(Core.Components.ListViewItem)).ctor();
            }
        },
        methods: {
            Render: function () {
                Core.Components.ListViewItem.prototype.Render.call(this);
                Core.Extensions.HtmlElementExtension.AddClass(this.Element, Core.Components.GroupGridView.GroupRowClass);
            },
            AppendGroupText: function (text) {
                if (this.GroupText == null) {
                    return;
                }
                this.GroupText.innerHTML = (this.GroupText.firstElementChild.outerHTML || "") + (text || "");
            },
            SetGroupText: function (text) {
                if (this.GroupText == null) {
                    return;
                }

                this.GroupText.innerHTML = text;
            }
        }
    });

    Bridge.define("Core.Components.VirtualGrid", {
        inherits: [Core.Components.GridView],
        statics: {
            fields: {
                RowNo: null,
                VirtualRow: null,
                cacheAhead: 0
            },
            ctors: {
                init: function () {
                    this.RowNo = "_index";
                    this.VirtualRow = "virtualRow";
                    this.cacheAhead = 5;
                }
            }
        },
        fields: {
            _renderViewPortAwaiter: 0,
            _renderingViewPort: false,
            LastData: null,
            viewPortCount: 0,
            _skip: 0
        },
        ctors: {
            ctor: function (ui) {
                this.$initialize();
                Core.Components.GridView.ctor.call(this, ui);
            }
        },
        methods: {
            AddSections: function () {
                Core.Components.GridView.prototype.AddSections.call(this);
                this.DataTable.parentElement.addEventListener(System.Enum.toString(System.String, "scroll"), Bridge.fn.cacheBind(this, this.RenderViewPortWrapper));
                this.DataTable.parentElement.addEventListener(System.Enum.toString(System.String, "resize"), Bridge.fn.bind(this, function (e) {
                    this._lastScrollTop = -1;
                    this.RenderViewPortWrapper(e);
                }));
            },
            ApplyFilter: function () {
                this.CacheData.clear();
                this.DataTable.parentElement.scrollTop = 0;
                return this.ReloadData(true, void 0, void 0);
            },
            PrepareCache: function (skip) {
                if (skip === void 0) { skip = 0; }
                if (Core.Extensions.IEnumerableExtensions.HasElement(System.Object, this.CacheData)) {
                    var firstRowNo = System.Nullable.getValue(Bridge.cast(Bridge.unbox(System.Linq.Enumerable.from(this.CacheData, System.Object).first()[Core.Components.VirtualGrid.RowNo], System.Int32), System.Int32));
                    var shouldEndNo = (firstRowNo + Bridge.Int.mul(this.viewPortCount, Core.Components.VirtualGrid.cacheAhead)) | 0;
                    if (skip > firstRowNo && skip < shouldEndNo) {
                        this._waitingLoad = false;
                        return System.Threading.Tasks.Task.fromResult(true, System.Boolean);
                    }
                }
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                var start = (skip - Bridge.Int.mul(this.viewPortCount, Core.Components.VirtualGrid.cacheAhead)) | 0;
                if (start < 0) {
                    start = 0;
                }
                var sql = this.GetSql(start, Bridge.Int.clip32(this.viewPortCount + Bridge.Int.mul(Bridge.Int.mul(this.viewPortCount, Core.Components.VirtualGrid.cacheAhead), 2)), true, false);
                Core.Clients.Client.ExecTask(System.Array.type(System.Array.type(System.Object)), Core.Clients.Client.Instance.ComQuery(sql), Bridge.fn.bind(this, function (ds) {
                    if (Core.Extensions.IEnumerableExtensions.Nothing(System.Array.type(System.Object), ds)) {
                        this._waitingLoad = false;
                        return;
                    }
                    this.CacheData.clear();
                    this.CacheData.AddRange(ds[System.Array.index(0, ds)]);
                    Core.Extensions.IEnumerableExtensions.SelectForEach$2(System.Object, System.Object, this.CacheData, function (x, index) {
                        var $t;
                        return ($t = Bridge.box((((start + index) | 0) + 1) | 0, System.Int32), x[Core.Components.VirtualGrid.RowNo] = $t, $t);
                    });
                    this._waitingLoad = false;
                    tcs.trySetResult(true);
                }), function (e) {
                    tcs.trySetException(e);
                });
                return tcs.task;
            },
            RenderViewPort: function (count, firstLoad, skip) {
                var $t, $t1, $t2;
                if (count === void 0) { count = true; }
                if (firstLoad === void 0) { firstLoad = false; }
                if (skip === void 0) { skip = null; }
                this._renderingViewPort = true;
                this.viewPortCount = this.GetViewPortItem();
                var scrollTop = this.DataTable.parentElement.scrollTop;
                if (scrollTop === this._lastScrollTop) {
                    return;
                }
                var actualSkip = ($t = skip, $t != null ? $t : this.GetRowCountByHeight(scrollTop));
                if (this.viewPortCount <= 0) {
                    this.viewPortCount = ($t1 = this.GuiInfo.Row, $t1 != null ? $t1 : 20);
                }
                var rows;
                if (firstLoad) {
                    this.LoadData(scrollTop, actualSkip, count, firstLoad);
                } else {
                    rows = ($t2 = System.Object, System.Linq.Enumerable.from(this.ReadCache(actualSkip, this.viewPortCount), $t2).toList($t2));
                    if (rows.Count < this.viewPortCount && rows.Count < this.Paginator.Options.Total) {
                        this.LoadData(scrollTop, actualSkip, count);
                    } else {
                        this.RowDataLoaded(scrollTop, actualSkip, rows);
                    }
                }
            },
            LoadData: function (scrollTop, skip, count, firstLoad) {
                if (firstLoad === void 0) { firstLoad = false; }
                Core.Extensions.EventExt.Done$1(System.Collections.Generic.List$1(System.Object), this.Fetch(count, skip, !firstLoad), Bridge.fn.bind(this, function (rows) {
                    this.RowDataLoaded(scrollTop, skip, rows);
                    if (firstLoad) {
                        this.ContentRendered();
                    }
                }));
            },
            RowDataLoaded: function (scrollTop, skip, rows) {
                var $t;
                this.FormattedRowData = rows;
                if (scrollTop === 0) {
                    this.LastData = this.FormattedRowData;
                }
                this.RenderVirtualRow(Bridge.as(this.MainSection.Element, HTMLTableSectionElement), skip, this.viewPortCount);
                this.UpdateExistRows(false);
                var existBottomEle = System.Linq.Enumerable.from(this.MainSection.Element.children, HTMLElement).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.getAttribute(Core.Components.VirtualGrid.VirtualRow), System.Enum.toString(Core.Components.Direction, Core.Components.Direction.bottom));
                    }, null);
                this.MainSection.Element.appendChild(existBottomEle);
                this.RowData.Data.clear();
                rows.ForEach(Bridge.fn.cacheBind(this.RowData.Data, this.RowData.Data.add));
                ($t = this.Entity) != null ? Core.Extensions.BridgeExt.SetComplexPropValue($t, this.FieldName, rows) : null;
                this.RowAction(function (x) {
                    x.Focused = false;
                });
                if (Core.Components.EditableComponent.IsSmallUp) {
                    this.SetFocusingCom();
                }
                this._renderingViewPort = false;
            },
            ReadCache: function (skip, viewPortCount) {
                return new (Bridge.GeneratorEnumerable$1(System.Object))(Bridge.fn.bind(this, function (skip, viewPortCount) {
                    var $step = 0,
                        $jumpFromFinally,
                        $returnValue,
                        index,
                        $async_e,
                        $async_e1;

                    var $enumerator = new (Bridge.GeneratorEnumerator$1(System.Object))(Bridge.fn.bind(this, function () {
                        try {
                            for (;;) {
                                switch ($step) {
                                    case 0: {
                                        index = -1;
                                        $step = 1;
                                        continue;
                                    }
                                    case 1: {
                                        index = Core.Extensions.IEnumerableExtensions.IndexOf(System.Object, this.CacheData, function (x) {
                                                return System.Nullable.getValue(Bridge.cast(Bridge.unbox(x[Core.Components.VirtualGrid.RowNo], System.Int32), System.Int32)) === ((skip + 1) | 0);
                                            });
                                        $step = 3;
                                        continue;
                                    }
                                    case 2: {
                                        this.CacheData.clear();
                                            return false;
                                            $async_e = null;
                                        $step = 3;
                                        continue;
                                    }
                                    case 3: {
                                        if (index < 0) {
                                                $step = 4;
                                                continue;
                                            } 
                                            $step = 5;
                                            continue;
                                    }
                                    case 4: {
                                        this.CacheData.clear();
                                            return false;
                                        $step = 5;
                                        continue;
                                    }
                                    case 5: {
                                        if ( viewPortCount > 0 && this.CacheData.Count > index ) {
                                                $step = 6;
                                                continue;
                                            } 
                                            $step = 8;
                                            continue;
                                    }
                                    case 6: {
                                        $enumerator.current = this.CacheData.getItem(index);
                                            $step = 7;
                                            return true;
                                    }
                                    case 7: {
                                        index = (index + 1) | 0;
                                            viewPortCount = (viewPortCount - 1) | 0;

                                            $step = 5;
                                            continue;
                                    }
                                    case 8: {

                                    }
                                    default: {
                                        return false;
                                    }
                                }
                            }
                        } catch($async_e1) {
                            $async_e = System.Exception.create($async_e1);
                            if ( $step >= 1 && $step <= 1 ){
                                $step = 2;
                                $enumerator.moveNext();
                                return;
                            }
                            throw $async_e;
                        }
                    }));
                    return $enumerator;
                }, arguments));
            },
            Fetch: function (count, skip, cacheMeta) {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                this._skip = skip;
                var sql = this.GetSql(skip, this.viewPortCount, cacheMeta, count);
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), Core.Clients.Client.Instance.ComQuery(sql), Bridge.fn.bind(this, function (ds) {
                    var $t;
                    var rows = ds.length > 0 ? ($t = System.Object, System.Linq.Enumerable.from(ds[System.Array.index(0, ds)], $t).toList($t)) : null;
                    if (count) {
                        this.ProcessMetaData(ds, rows.Count);
                    }
                    this.FormattedRowData = rows;
                    Core.Extensions.IEnumerableExtensions.SelectForEach$2(System.Object, System.Object, rows, function (x, index) {
                        var $t1;
                        return ($t1 = Bridge.box((((skip + index) | 0) + 1) | 0, System.Int32), x[Core.Components.VirtualGrid.RowNo] = $t1, $t1);
                    });
                    if (rows.Count < this.Paginator.Options.Total) {
                        window.clearTimeout(this._renderPrepareCacheAwaiter);
                        this._waitingLoad = true;
                        this._renderPrepareCacheAwaiter = window.setTimeout(Bridge.fn.bind(this, function () {
                            Core.Extensions.EventExt.Done$1(System.Boolean, this.PrepareCache(((skip + this.viewPortCount) | 0)));
                        }), 7000);
                    }
                    tcs.trySetResult(rows);
                }));
                return tcs.task;
            },
            ReloadData: function (cacheHeader, skip, pageSize) {
                if (cacheHeader === void 0) { cacheHeader = false; }
                if (skip === void 0) { skip = null; }
                if (pageSize === void 0) { pageSize = null; }
                this.DisposeNoRecord();
                this.VirtualScroll = Core.Extensions.IEnumerableExtensions.Nothing(System.Char, this.GuiInfo.GroupBy) && this.GuiInfo.VirtualScroll && !Bridge.referenceEquals(Bridge.toString(this.Element.style.display), System.Enum.toString(System.String, "none"));
                this._lastScrollTop = -1;
                this.RenderViewPort(true, !cacheHeader, skip);
                return System.Threading.Tasks.Task.fromResult(this.FormattedRowData, System.Collections.Generic.List$1(System.Object));
            },
            RenderViewPortWrapper: function (e) {
                if (this._waitingLoad) {
                    window.clearTimeout(this._renderPrepareCacheAwaiter);
                    this._renderPrepareCacheAwaiter = window.setTimeout(Bridge.fn.bind(this, function () {
                        Core.Clients.Client.ExecTask(System.Boolean, this.PrepareCache(this._skip));
                    }), 7000);
                }
                if (this._renderingViewPort || !this.VirtualScroll) {
                    this._renderingViewPort = false;
                    e.preventDefault();
                    return;
                }
                window.clearTimeout(this._renderViewPortAwaiter);
                this._renderViewPortAwaiter = window.setTimeout(Bridge.fn.bind(this, function () {
                    this.RenderViewPort(false);
                }), 100);
            },
            RenderVirtualRow: function (tbody, skip, viewPort) {
                var existTopEle = System.Linq.Enumerable.from(tbody.children, HTMLElement).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.getAttribute(Core.Components.VirtualGrid.VirtualRow), System.Enum.toString(Core.Components.Direction, Core.Components.Direction.top));
                    }, null);
                var topVirtualRow = existTopEle || document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.tr));
                if (!Core.Extensions.HtmlElementExtension.HasClass(topVirtualRow, "virtual-row")) {
                    Core.Extensions.HtmlElementExtension.AddClass(topVirtualRow, "virtual-row");
                    for (var i = 0; i < this.Header.Count; i = (i + 1) | 0) {
                        topVirtualRow.appendChild(document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)));
                    }
                }
                topVirtualRow.style.height = Bridge.Int.mul(skip, this._rowHeight) + (Core.Extensions.Utils.Pixel || "");
                topVirtualRow.setAttribute(Core.Components.VirtualGrid.VirtualRow, System.Enum.toString(Core.Components.Direction, Core.Components.Direction.top));
                tbody.insertBefore(topVirtualRow, tbody.firstChild);

                var existBottomEle = System.Linq.Enumerable.from(tbody.children, HTMLElement).lastOrDefault(function (x) {
                        return Bridge.referenceEquals(x.getAttribute(Core.Components.VirtualGrid.VirtualRow), System.Enum.toString(Core.Components.Direction, Core.Components.Direction.bottom));
                    }, null);
                var bottomVirtualRow = existBottomEle || document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.tr));
                if (!Core.Extensions.HtmlElementExtension.HasClass(bottomVirtualRow, "virtual-row")) {
                    Core.Extensions.HtmlElementExtension.AddClass(bottomVirtualRow, "virtual-row");
                    for (var i1 = 0; i1 < this.Header.Count; i1 = (i1 + 1) | 0) {
                        bottomVirtualRow.appendChild(document.createElement(System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)));
                    }
                }
                var bottomHeight = Bridge.Int.mul((((((this.Paginator.Options.Total - viewPort) | 0) - skip) | 0)), this._rowHeight);
                bottomHeight = bottomHeight >= this._rowHeight ? bottomHeight : 0;
                bottomVirtualRow.style.height = bottomHeight + (Core.Extensions.Utils.Pixel || "");
                bottomVirtualRow.setAttribute(Core.Components.VirtualGrid.VirtualRow, System.Enum.toString(Core.Components.Direction, Core.Components.Direction.bottom));
                tbody.appendChild(bottomVirtualRow);
                this.MainSection.Element.parentElement.parentElement.scrollTop = Bridge.Int.mul(skip, this._rowHeight);
                this._lastScrollTop = Bridge.Int.mul(skip, this._rowHeight);
                this.Paginator.Options.PageSize = this.Paginator.Options.Total;
                this.Paginator.Options.StartIndex = (skip + 1) | 0;
                this.Paginator.Options.EndIndex = (skip + viewPort) | 0;
                Core.Extensions.HtmlElementExtension.AddClass(this.Paginator.Element, "infinite-scroll");
                this.Paginator.Children.ForEach(function (child) {
                    child.UpdateView();
                });
            },
            DisposeSumary: function () {
                this._renderPrepareCacheAwaiter = window.setTimeout(Bridge.fn.bind(this, function () {
                    var $step = 0,
                        $task1, 
                        $taskResult1, 
                        $jumpFromFinally, 
                        $asyncBody = Bridge.fn.bind(this, function () {
                            for (;;) {
                                $step = System.Array.min([0,1], $step);
                                switch ($step) {
                                    case 0: {
                                        $task1 = this.PrepareCache(this._skip);
                                        $step = 1;
                                        if ($task1.isCompleted()) {
                                            continue;
                                        }
                                        $task1.continue($asyncBody);
                                        return;
                                    }
                                    case 1: {
                                        $taskResult1 = $task1.getAwaitedResult();
                                        return;
                                    }
                                    default: {
                                        return;
                                    }
                                }
                            }
                        }, arguments);

                    $asyncBody();
                }), 7000);
                Core.Components.GridView.prototype.DisposeSumary.call(this);
            },
            FocusCell: function (e, header) {
                var td = Bridge.as(e.target, HTMLElement);

                var $table = $(e.target).closest('table');
                $table.find("tbody tr").removeClass("focus");
                $table.find("tbody td").removeClass("cell-selected");

                Core.Extensions.HtmlElementExtension.AddClass(Core.Extensions.HtmlElementExtension.Closest(td, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.tr)), "focus");
                Core.Extensions.HtmlElementExtension.AddClass(Core.Extensions.HtmlElementExtension.Closest(td, System.Enum.toString(Core.MVVM.ElementType, Core.MVVM.ElementType.td)), "cell-selected");
            },
            HardDeleteSelected: function (e) {
                if (e === void 0) { e = null; }
                if (this.GuiInfo.IgnoreConfirmHardDelete && !Bridge.staticEquals(this.OnDeleteConfirmed, null)) {
                    this.OnDeleteConfirmed();
                    return;
                }
                Core.Extensions.EventExt.Done$1(System.Collections.Generic.List$1(System.Object), this.GetRealTimeSelectedRows(), Bridge.fn.bind(this, function (deletedItems) {
                    var confirm = new Core.Components.Forms.ConfirmDialog();
                    confirm.Title = System.String.format("B\u1ea1n c\u00f3 ch\u1eafc x\u00f3a {0} d\u00f2ng d\u1eef li\u00eau kh\u00f4ng!", [Bridge.box(deletedItems.Count, System.Int32)]);
                    confirm.Render();
                    confirm.YesConfirmed = Bridge.fn.combine(confirm.YesConfirmed, Bridge.fn.bind(this, function () {
                        var $t;
                        if (!Bridge.staticEquals(this.OnDeleteConfirmed, null)) {
                            this.OnDeleteConfirmed();
                            !Bridge.staticEquals(($t = this.DOMContentLoaded), null) ? $t() : null;
                            return;
                        }
                        confirm.Dispose();
                        if (Core.Extensions.IEnumerableExtensions.Nothing(System.Object, deletedItems)) {
                            deletedItems = this.GetFocusedRows();
                        }
                        Core.Extensions.EventExt.Done(Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.BeforeDeleted, [deletedItems]), Bridge.fn.bind(this, function () {
                            Core.Extensions.EventExt.Done$1(System.Collections.Generic.List$1(System.Object), this.HardDeleteConfirmed(deletedItems), Bridge.fn.bind(this, function (success) {
                                var $t1;
                                !Bridge.staticEquals(($t1 = this.DOMContentLoaded), null) ? $t1() : null;
                                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Components.Extensions.ComponentExt.DispatchCustomEvent(this, this.GuiInfo.Events, Core.Enums.CustomEventType.AfterDeleted, [deletedItems]));
                            }));
                        }));
                    }));
                }));
            },
            HardDeleteConfirmed: function (deleted) {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done$1(System.Collections.Generic.List$1(System.Object), Core.Components.GridView.prototype.HardDeleteConfirmed.call(this, deleted), Bridge.fn.bind(this, function (res) {
                    var ids = System.Linq.Enumerable.from(res, System.Object).select(function (x) {
                            var $t;
                            return ($t = x[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null;
                        }).toList(System.String);
                    this.CacheData.RemoveAll(function (x) {
                        var $t;
                        return ids.contains(($t = x[Core.Components.EditableComponent.IdField]) != null ? Bridge.toString($t) : null);
                    });
                    tcs.trySetResult(res);
                }));
                return tcs.task;
            },
            ToggleAll: function () {
                var anySelected = System.Linq.Enumerable.from(this.AllListViewItem, Core.Components.ListViewItem).any(function (x) {
                        return x.Selected;
                    });
                if (anySelected) {
                    this.ClearSelected();
                    return;
                }
                this.RowAction(function (x) {
                    if (x.EmptyRow) {
                        return;
                    }
                    x.Selected = !anySelected;
                });
                var sql = this.GetSql(0, this.Paginator.Options.Total, true, true);
                Core.Extensions.EventExt.Done$1(System.Array.type(System.String), Core.Clients.Client.Instance.GetIds(sql), Bridge.fn.bind(this, function (ids) {
                    this.SelectedIds = System.Linq.Enumerable.from(ids, System.String).distinct().toList(System.String);
                }));
            }
        }
    });

    Bridge.define("Core.Components.AdvancedSearch", {
        inherits: [Core.Components.Forms.PopupEditor],
        statics: {
            methods: {
                GetLogicOp: function (condition) {
                    if (condition.LogicOperatorId == null) {
                        return null;
                    }

                    return System.Nullable.eq(condition.LogicOperatorId, Core.Enums.LogicOperation.And) ? " and " : " or ";
                },
                SetSearchString: function (compareCell, comInfo) {
                    var component;
                    var com = new Core.Models.Component();
                    Core.Extensions.ReflectionExt.CopyPropFrom(com, comInfo);
                    com.ComponentType = "Textbox";
                    component = new Core.Components.Textbox(comInfo);
                    compareCell.GuiInfo.LocalData = System.Linq.Enumerable.from(Core.Components.AdvancedSearch.OperatorFactory(Core.Enums.ComponentTypeTypeEnum.Textbox)).select(function (x) { return Bridge.cast(x, System.Object); }).toList(System.Object);
                    return component;
                },
                OperatorFactory: function (componentType) {
                    var entities = System.Linq.Enumerable.from(Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.AdvSearchOperation)).select(function (x) { return Bridge.cast(x, Core.Models.Entity); });
                    switch (componentType) {
                        case Core.Enums.ComponentTypeTypeEnum.Textbox: 
                            return entities.where(function (x) {
                                return (System.Nullable.gte(Core.Extensions.Utils.TryParseInt(x.Id), Core.Enums.AdvSearchOperation.Contains) && System.Nullable.lt(Core.Extensions.Utils.TryParseInt(x.Id), Core.Enums.AdvSearchOperation.In)) || System.Nullable.eq(Core.Extensions.Utils.TryParseInt(x.Id), Core.Enums.AdvSearchOperation.Equal) || System.Nullable.eq(Core.Extensions.Utils.TryParseInt(x.Id), Core.Enums.AdvSearchOperation.NotEqual);
                            }).orderByDescending(function (x) {
                                return System.Nullable.eq(Core.Extensions.Utils.TryParseInt(x.Id), Core.Enums.AdvSearchOperation.Contains);
                            });
                        case Core.Enums.ComponentTypeTypeEnum.Datepicker: 
                            return entities.where(function (x) {
                                return System.Nullable.lt(Core.Extensions.Utils.TryParseInt(x.Id), Core.Enums.AdvSearchOperation.Contains);
                            });
                        case Core.Enums.ComponentTypeTypeEnum.Number: 
                            return entities.where(function (x) {
                                return System.Nullable.lt(Core.Extensions.Utils.TryParseInt(x.Id), Core.Enums.AdvSearchOperation.Contains);
                            });
                        case Core.Enums.ComponentTypeTypeEnum.Checkbox: 
                            return entities.where(function (x) {
                                return System.Nullable.eq(Core.Extensions.Utils.TryParseInt(x.Id), Core.Enums.AdvSearchOperation.Equal);
                            });
                        case Core.Enums.ComponentTypeTypeEnum.SearchEntry: 
                            return entities.where(function (x) {
                                return System.Nullable.eq(Core.Extensions.Utils.TryParseInt(x.Id), Core.Enums.AdvSearchOperation.In) || System.Nullable.eq(Core.Extensions.Utils.TryParseInt(x.Id), Core.Enums.AdvSearchOperation.NotIn);
                            });
                    }
                    return null;
                },
                SetSearchDecimal: function (compareCell, comInfo) {
                    var component;
                    comInfo.ComponentType = "Number";
                    component = new Core.Components.Number(comInfo);
                    compareCell.GuiInfo.LocalData = System.Linq.Enumerable.from(Core.Components.AdvancedSearch.OperatorFactory(Core.Enums.ComponentTypeTypeEnum.Number)).select(function (x) { return Bridge.cast(x, System.Object); }).toList(System.Object);
                    return component;
                },
                SetSearchBool: function (compareCell, com) {
                    var comInfo = new Core.Models.Component();
                    Core.Extensions.ReflectionExt.CopyPropFrom(comInfo, com);
                    var component;
                    comInfo.FormatData = "Description";
                    comInfo.ComponentType = "MultipleSearchEntry";
                    comInfo.LocalRender = true;
                    comInfo.LocalData = Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.ActiveStateEnum);
                    comInfo.LocalHeader = Core.Components.AdvancedSearch.GetBooleanSearchHeader();
                    component = new Core.Components.MultipleSearchEntry(comInfo);
                    compareCell.GuiInfo.LocalData = System.Linq.Enumerable.from(Core.Components.AdvancedSearch.OperatorFactory(Core.Enums.ComponentTypeTypeEnum.SearchEntry)).select(function (x) { return Bridge.cast(x, System.Object); }).toList(System.Object);
                    return component;
                },
                GetBooleanSearchHeader: function () {
                    return function (_o1) {
                            var $t;
                            _o1.add(($t = new Core.Models.Component(), $t.FieldName = "Name", $t.ShortDesc = "Tr\u1ea1ng th\u00e1i", $t.Active = true, $t));
                            _o1.add(($t = new Core.Models.Component(), $t.FieldName = "Description", $t.ShortDesc = "Mi\u00eau t\u1ea3", $t.Active = true, $t));
                            return _o1;
                        }(new (System.Collections.Generic.List$1(Core.Models.Component)).ctor());
                },
                SetSearchDateTime: function (compareCell, comInfo) {
                    var component;
                    var com = new Core.Models.Component();
                    Core.Extensions.ReflectionExt.CopyPropFrom(com, comInfo);
                    com.ComponentType = "Datepicker";
                    com.Precision = 7; // add time picker
                    component = new Core.Components.Datepicker(com);
                    compareCell.GuiInfo.LocalData = System.Linq.Enumerable.from(Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.AdvSearchOperation)).select(function (x) { return Bridge.cast(x, Core.Models.Entity); }).where(function (x) {
                        return System.Int32.parse(x.Id) < Core.Enums.AdvSearchOperation.Contains;
                    }).select(function (x) {{ return Bridge.cast(x, System.Object); }}).toList(System.Object);
                    return component;
                }
            }
        },
        fields: {
            _filterGrid: null,
            _orderByGrid: null,
            _headers: null,
            ParentListView: null,
            _orderById: null,
            _fieldConditionId: null,
            _ComponentId: null,
            _entityId: null,
            _searchByIdList: null
        },
        props: {
            ModelNameSpace: null,
            AdvSearchEntity: {
                get: function () {
                    return Bridge.as(this.Entity, Core.Models.AdvSearchVM);
                }
            }
        },
        ctors: {
            init: function () {
                this._orderById = System.Linq.Enumerable.from(Core.Clients.Client.Entities.Values, Core.Models.Entity).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.Name, "OrderBy");
                    }, null).Id;
                this._fieldConditionId = System.Linq.Enumerable.from(Core.Clients.Client.Entities.Values, Core.Models.Entity).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.Name, "FieldCondition");
                    }, null).Id;
                this._ComponentId = System.Linq.Enumerable.from(Core.Clients.Client.Entities.Values, Core.Models.Entity).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.Name, "Component");
                    }, null).Id;
                this._entityId = System.Linq.Enumerable.from(Core.Clients.Client.Entities.Values, Core.Models.Entity).firstOrDefault(function (x) {
                        return Bridge.referenceEquals(x.Name, "Entity");
                    }, null).Id;
                this._searchByIdList = System.Array.init(["SearchEntry", "MultipleSearchEntry"], System.String);
            },
            ctor: function (parent) {
                this.$initialize();
                Core.Components.Forms.PopupEditor.ctor.call(this, "Component");
                this.Name = "AdvancedSearch";
                this.Title = "T\u00ecm ki\u1ebfm n\u00e2ng cao";
                this.Icon = "fa fa-search-plus";
                this.ParentListView = parent;
            }
        },
        methods: {
            LoadFeatureAndRender: function (callback) {
                if (callback === void 0) { callback = null; }
                Core.Components.Forms.PopupEditor.prototype.LoadFeatureAndRender.call(this, Bridge.fn.cacheBind(this, this.LocalRender));
            },
            LocalRender: function () {
                var $t;
                this._headers = System.Linq.Enumerable.from(this.ParentListView.Header, Core.Models.Component).where(function (x) {
                        return x.Id != null && !Core.Extensions.StringExt.IsNullOrWhiteSpace(x.ShortDesc) && x.Active && !x.Hidden;
                    }).toList(Core.Models.Component);
                System.Array.add(this.Feature.FeaturePolicy, ($t = new Core.Models.FeaturePolicy(), $t.CanRead = true, $t.CanWrite = true, $t.CanDelete = true, $t), Core.Models.FeaturePolicy);
                this.Entity = this.ParentListView.AdvSearchVM;
                var fieldMap = this.HeaderForAdvSearch();
                var orderby = this.ParentListView.GuiInfo.OrderBy;
                this.ParentListView.AdvSearchVM.OrderBy = Core.Extensions.StringExt.IsNullOrWhiteSpace(orderby) ? this.ParentListView.AdvSearchVM.OrderBy : System.Linq.Enumerable.from(orderby.split(","), System.String).select(Bridge.fn.bind(this, function (x) {
                        var $t1;
                        if (Core.Extensions.StringExt.IsNullOrWhiteSpace(x)) {
                            return null;
                        }
                        var orderField = System.String.replaceAll(x.trim().replace(new RegExp("\\s+"), " "), "ds.", "").split(" ");
                        if (orderField.length < 1) {
                            return null;
                        }

                        var field = System.Linq.Enumerable.from(this._headers, Core.Models.Component).firstOrDefault(function (header) {
                                return Bridge.referenceEquals(header.FieldName, orderField[System.Array.index(0, orderField)]);
                            }, null);
                        if (field == null) {
                            return null;
                        }

                        var result = ($t1 = new Core.Models.OrderBy(), $t1.ComId = field.Id, $t1.FieldName = field.FieldName, $t1);
                        if (orderField.length === 1) {
                            result.OrderbyDirectionId = Core.Enums.OrderbyDirection.ASC;
                        } else {
                            var orderbyOption = { v : new Core.Enums.OrderbyDirection() };
                            var parsed = System.Enum.tryParse(Core.Enums.OrderbyDirection, Bridge.toString(orderField[System.Array.index(1, orderField)]).toUpperCase(), orderbyOption);
                            result.OrderbyDirectionId = parsed ? orderbyOption.v : Core.Enums.OrderbyDirection.ASC;
                        }
                        return result;
                    })).where(function (x) {
                    return x != null;
                }).toList(Core.Models.OrderBy);
                var section = this.AddSection();
                this.AddFilters(section);
                this.AddOrderByGrid(section);
            },
            AddSection: function () {
                var $t, $t1;
                var section = ($t = new Core.Components.Section.$ctor1(Core.MVVM.ElementType.div), $t.ComponentGroup = ($t1 = new Core.Models.ComponentGroup(), $t1.Column = 4, $t1.Label = "B\u1ed9 l\u1ecdc", $t1.Active = true, $t1.ClassName = "scroll-content", $t1), $t);
                this.AddChild(section);
                var label = document.createElement("label");
                section.Element.appendChild(label);
                label.textContent = "Tr\u1ea1ng th\u00e1i";
                section.ClassName = "filter-warpper panel group wrapper";
                return section;
            },
            AddFilters: function (section) {
                var $t, $t1;
                this._filterGrid = new Core.Components.GridView(($t = new Core.Models.Component(), $t.Id = Core.Structs.Uuid7.Id25(), $t.FieldName = "Conditions", $t.Column = 4, $t.ReferenceId = Bridge.toString(this._fieldConditionId), $t.RefName = "FieldCondition", $t.LocalRender = true, $t.IgnoreConfirmHardDelete = true, $t.CanAdd = true, $t.Events = System.String.format("{{'DOMContentLoaded': '{0}'}}", ["FilterDomLoaded"]), $t));
                this._filterGrid.OnDeleteConfirmed = Bridge.fn.combine(this._filterGrid.OnDeleteConfirmed, Bridge.fn.bind(this, function () {
                    this._filterGrid.GetSelectedRows().ForEach(Bridge.fn.cacheBind(this._filterGrid.RowData, this._filterGrid.RowData.Remove));
                }));
                this._filterGrid.Header = ($t = Bridge.fn.bind(this, function (_o4) {
                        var $t1;
                        _o4.add(($t1 = new Core.Models.Component(), $t1.Id = Bridge.toString((1)), $t1.EntityId = this._fieldConditionId, $t1.FieldName = "FieldId", $t1.Events = "{'change': 'FieldId_Changed'}", $t1.ShortDesc = "T\u00ean c\u1ed9t", $t1.ReferenceId = this._ComponentId, $t1.RefName = "Component", $t1.FormatData = "ShortDesc", $t1.Active = true, $t1.Editable = true, $t1.ComponentType = "SearchEntry", $t1.MinWidth = "100px", $t1.MaxWidth = "200px", $t1.LocalRender = true, $t1.LocalData = System.Linq.Enumerable.from(this._headers).select(function (x) { return Bridge.cast(x, System.Object); }).toList(System.Object), $t1.LocalHeader = Bridge.fn.bind(this, function (_o1) {
                                var $t2;
                                _o1.add(($t2 = new Core.Models.Component(), $t2.EntityId = this._ComponentId, $t2.FieldName = "ShortDesc", $t2.ShortDesc = "T\u00ean c\u1ed9t", $t2.Active = true, $t2));
                                return _o1;
                            })(new (System.Collections.Generic.List$1(Core.Models.Component)).ctor()), $t1.Validation = "[{\"Rule\": \"required\", \"Message\": \"{0} is required\"}]", $t1));
                        _o4.add(($t1 = new Core.Models.Component(), $t1.Id = Bridge.toString((2)), $t1.EntityId = this._fieldConditionId, $t1.FieldName = "CompareOperatorId", $t1.ShortDesc = "To\u00e1n t\u1eed", $t1.ReferenceId = this._entityId, $t1.RefName = "Entity", $t1.ComponentType = "SearchEntry", $t1.FormatData = "Description", $t1.Active = true, $t1.Editable = true, $t1.MinWidth = "150px", $t1.LocalRender = true, $t1.LocalData = Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.AdvSearchOperation), $t1.LocalHeader = Bridge.fn.bind(this, function (_o2) {
                                var $t2;
                                _o2.add(($t2 = new Core.Models.Component(), $t2.EntityId = this._entityId, $t2.FieldName = "Name", $t2.ShortDesc = "To\u00e1n t\u1eed", $t2.Active = true, $t2));
                                _o2.add(($t2 = new Core.Models.Component(), $t2.EntityId = this._entityId, $t2.FieldName = "Description", $t2.ShortDesc = "K\u00fd hi\u1ec7u", $t2.Active = true, $t2));
                                return _o2;
                            })(new (System.Collections.Generic.List$1(Core.Models.Component)).ctor()), $t1.Validation = "[{\"Rule\": \"required\", \"Message\": \"{0} is required\"}]", $t1));
                        _o4.add(($t1 = new Core.Models.Component(), $t1.Id = Bridge.toString((3)), $t1.EntityId = this._fieldConditionId, $t1.FieldName = "Value", $t1.ShortDesc = "Gi\u00e1 tr\u1ecb", $t1.ReferenceId = this._entityId, $t1.RefName = "Entity", $t1.ComponentType = "Input", $t1.Active = true, $t1.Editable = true, $t1.MinWidth = "450px", $t1.Validation = "[{\"Rule\": \"required\", \"Message\": \"{0} is required\"}]", $t1));
                        _o4.add(($t1 = new Core.Models.Component(), $t1.Id = Bridge.toString((2)), $t1.EntityId = this._fieldConditionId, $t1.FieldName = "LogicOperatorId", $t1.ShortDesc = "K\u1ebft h\u1ee3p", $t1.ReferenceId = this._entityId, $t1.RefName = "Entity", $t1.ComponentType = "SearchEntry", $t1.FormatData = "Description", $t1.Active = true, $t1.Editable = true, $t1.DefaultVal = "0", $t1.LocalRender = true, $t1.LocalData = Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.LogicOperation), $t1.LocalHeader = Bridge.fn.bind(this, function (_o3) {
                                var $t2;
                                _o3.add(($t2 = new Core.Models.Component(), $t2.EntityId = this._entityId, $t2.FieldName = "Name", $t2.ShortDesc = "K\u1ebft h\u1ee3p", $t2.Active = true, $t2));
                                _o3.add(($t2 = new Core.Models.Component(), $t2.EntityId = this._entityId, $t2.FieldName = "Description", $t2.ShortDesc = "Mi\u00eau t\u1ea3", $t2.Active = true, $t2));
                                return _o3;
                            })(new (System.Collections.Generic.List$1(Core.Models.Component)).ctor()), $t1));
                        return _o4;
                    })(new (System.Collections.Generic.List$1(Core.Models.Component)).ctor()), this._filterGrid.GuiInfo.LocalHeader = $t, $t);
                this._filterGrid.RowData.Data = ($t1 = System.Linq.Enumerable.from(this.AdvSearchEntity.Conditions).select(function (x) { return Bridge.cast(x, System.Object); }).toList(System.Object), this._filterGrid.GuiInfo.LocalData = $t1, $t1);
                this._filterGrid.ParentElement = section.Element;
                section.AddChild(this._filterGrid);
                this._filterGrid.Element.addEventListener("keydown", Bridge.fn.cacheBind(this, this.ToggleIndent));
            },
            FilterDomLoaded: function () {
                this._filterGrid.MainSection.Children.ForEach(Bridge.fn.bind(this, function (x) {
                    var condition = Bridge.unbox(x.Entity);
                    this.FieldId_Changed(condition, condition.Field);
                }));
            },
            HeaderForAdvSearch: function () {
                return System.Linq.Enumerable.from(this.ParentListView.Header, Core.Models.Component).where(function (x) {
                        return x.Id != null && !Core.Extensions.StringExt.IsNullOrWhiteSpace(x.ShortDesc) && x.Active && !x.Hidden;
                    });
            },
            AddOrderByGrid: function (section) {
                var $t, $t1;
                this._orderByGrid = new Core.Components.GridView(($t = new Core.Models.Component(), $t.FieldName = "OrderBy", $t.Column = 4, $t.ReferenceId = this._orderById, $t.RefName = "Entity", $t.CanAdd = true, $t.IgnoreConfirmHardDelete = true, $t.LocalRender = true, $t));
                this._orderByGrid.OnDeleteConfirmed = Bridge.fn.combine(this._orderByGrid.OnDeleteConfirmed, Bridge.fn.bind(this, function () {
                    this._orderByGrid.GetSelectedRows().ForEach(Bridge.fn.cacheBind(this._orderByGrid.RowData, this._orderByGrid.RowData.Remove));
                }));
                this._orderByGrid.GuiInfo.LocalHeader = Bridge.fn.bind(this, function (_o3) {
                        var $t1;
                        _o3.add(($t1 = new Core.Models.Component(), $t1.Id = Bridge.toString((1)), $t1.EntityId = this._fieldConditionId, $t1.FieldName = "FieldId", $t1.Events = "{'change': 'FieldId_Changed'}", $t1.ShortDesc = "T\u00ean c\u1ed9t", $t1.ReferenceId = this._ComponentId, $t1.RefName = "Component", $t1.FormatData = "ShortDesc", $t1.Active = true, $t1.Editable = true, $t1.ComponentType = "SearchEntry", $t1.MinWidth = "100px", $t1.MaxWidth = "200px", $t1.LocalData = System.Linq.Enumerable.from(this._headers).select(function (x) { return Bridge.cast(x, System.Object); }).toList(System.Object), $t1.LocalRender = true, $t1.LocalHeader = Bridge.fn.bind(this, function (_o1) {
                                var $t2;
                                _o1.add(($t2 = new Core.Models.Component(), $t2.EntityId = this._ComponentId, $t2.FieldName = "ShortDesc", $t2.ShortDesc = "T\u00ean c\u1ed9t", $t2.Active = true, $t2));
                                return _o1;
                            })(new (System.Collections.Generic.List$1(Core.Models.Component)).ctor()), $t1));
                        _o3.add(($t1 = new Core.Models.Component(), $t1.Id = Bridge.toString((2)), $t1.EntityId = this._orderById, $t1.FieldName = "OrderbyDirectionId", $t1.ShortDesc = "Th\u1ee9 t\u1ef1", $t1.ReferenceId = this._entityId, $t1.RefName = "Entity", $t1.ComponentType = "SearchEntry", $t1.FormatData = "Description", $t1.Active = true, $t1.Editable = true, $t1.MinWidth = "100px", $t1.MaxWidth = "120px", $t1.LocalData = Core.Extensions.IEnumerableExtensions.ToEntity(Core.Enums.OrderbyDirection), $t1.LocalHeader = Bridge.fn.bind(this, function (_o2) {
                                var $t2;
                                _o2.add(($t2 = new Core.Models.Component(), $t2.EntityId = this._entityId, $t2.FieldName = "Name", $t2.ShortDesc = "Th\u1ee9 t\u1ef1", $t2.Active = true, $t2));
                                return _o2;
                            })(new (System.Collections.Generic.List$1(Core.Models.Component)).ctor()), $t1.LocalRender = true, $t1));
                        return _o3;
                    })(new (System.Collections.Generic.List$1(Core.Models.Component)).ctor());
                this._orderByGrid.GuiInfo.LocalData = ($t = this.AdvSearchEntity.OrderBy) != null && ($t1 = System.Linq.Enumerable.from($t).select(function (x) { return Bridge.cast(x, System.Object); })) != null ? $t1.toList(System.Object) : null;
                this._orderByGrid.ParentElement = section.Element;
                section.AddChild(this._orderByGrid);
            },
            ToggleIndent: function (e) {
                var $t;
                var keyCode = Core.Extensions.EventExt.KeyCodeEnum(e);
                if (System.Nullable.neq(keyCode, Core.Enums.KeyCodeEnum.Tab)) {
                    return;
                }

                e.preventDefault();
                var reducing = Core.Extensions.EventExt.ShiftKey(e);
                var selectedRows = this._filterGrid.GetSelectedRows();
                var idMap = ($t = System.Object, System.Linq.Enumerable.from(selectedRows, $t).toDictionary(function (x) {
                        return Bridge.unbox(x[Core.Components.EditableComponent.IdField]);
                    }, null, System.Int32, $t));
                this._filterGrid.RowAction$2(function (x) {
                    return idMap.containsKey(Bridge.unbox(x.Entity[Core.Components.EditableComponent.IdField]));
                }, function (x) {
                    var fieldCondition = Bridge.as(x.Entity, Core.Models.FieldCondition);
                    fieldCondition.Level = (fieldCondition.Level || "") + reducing ? -1 : 1;
                    System.Linq.Enumerable.from(x.Element.querySelectorAll("td")).select(function (x) { return Bridge.cast(x, HTMLElement); }).forEach(function (td) {
                        td.style.paddingLeft = (fieldCondition.Level || "") + "rem";
                    });
                });
            },
            DirtyCheckAndCancel: function () {
                Core.Components.Forms.PopupEditor.prototype.Dispose.call(this);
            },
            ApplyAdvSearch: function () {
                Core.Extensions.EventExt.Done$1(System.Boolean, this.IsFormValid(), Bridge.fn.bind(this, function (isValid) {
                    if (!isValid) {
                        return;
                    }
                    this.CalcAdvSearchQuery();
                    Core.Extensions.EventExt.Done$1(System.Collections.Generic.List$1(System.Object), this.ParentListView.ReloadData(false, 0, void 0));
                }));
            },
            CalcAdvSearchQuery: function () {
                this.ParentListView.Wheres = System.Linq.Enumerable.from(this.AdvSearchEntity.Conditions, Core.Models.FieldCondition).select(Bridge.fn.bind(this, function (x, index) {
                        var $t;
                        return ($t = new Core.Models.Where(), $t.Condition = this.GetSearchValue(x), $t);
                    })).where(function (x) {
                    return Core.Extensions.StringExt.HasAnyChar(x.Condition);
                }).toList(Core.Models.Where);
            },
            GetSearchValue: function (condition) {
                var $t;
                var ignoreSearch = false;
                var value = ($t = condition.Value) != null ? Bridge.toString($t) : null;
                if (value == null && System.Nullable.neq(condition.CompareOperatorId, Core.Enums.AdvSearchOperation.EqualNull) && System.Nullable.neq(condition.CompareOperatorId, Core.Enums.AdvSearchOperation.NotEqualNull)) {
                    return null;
                }
                if (Bridge.referenceEquals(condition.Field.ComponentType, "Datepicker") && !Core.Extensions.StringExt.IsNullOrWhiteSpace(value)) {
                    try {
                        var dateTime = Core.Extensions.DateTimeExt.ToISOFormat(System.DateTime.parseExact(value, "dd/MM/yyyy", System.Globalization.CultureInfo.invariantCulture));
                        value = System.String.format("cast({0},Edm.DateTimeOffset)", [dateTime]);
                    } catch ($e1) {
                        $e1 = System.Exception.create($e1);
                        var dateTime1 = Core.Extensions.DateTimeExt.ToISOFormat(System.DateTime.parseExact(value, "MM/dd/yyyy HH:mm:ss", System.Globalization.CultureInfo.invariantCulture));
                        value = System.String.format("cast({0},Edm.DateTimeOffset)", [dateTime1]);
                    }
                } else if (Bridge.referenceEquals(condition.Field.ComponentType, "Number")) {
                    value = System.String.format("{0}", [value]);
                } else {
                    value = System.String.format("{0}", [Core.Extensions.Utils.EncodeSpecialChar(value)]);
                }

                var funcId = System.Nullable.getValue(Core.Extensions.Utils.TryParseInt(System.Nullable.toString(condition.CompareOperatorId, System.Enum.toStringFn(Core.Enums.AdvSearchOperation))));
                var func = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(Core.Enums.AdvSearchOperation, System.String, Core.Extensions.AdvOptionExt.OperationToSql, funcId);
                var formattedFunc = ignoreSearch ? "" : System.String.format(func, condition.OriginFieldName, value);

                return formattedFunc;
            },
            FieldId_Changed: function (condition, field) {
                var $t, $t1, $t2, $t3, $t4;
                if (condition == null || field == null) {
                    return;
                }
                condition.OriginFieldName = field.FieldName;
                condition.Field = field;
                var cell = Core.Components.Extensions.ComponentExt.FirstOrDefault(this._filterGrid, function (x) {
                    return Bridge.referenceEquals(x.Entity, condition) && Bridge.referenceEquals(x.FieldName, "Value");
                });
                var compareCell = Bridge.as(Core.Components.Extensions.ComponentExt.FirstOrDefault(this._filterGrid, function (x) {
                    return Bridge.referenceEquals(x.Entity, condition) && Bridge.referenceEquals(x.FieldName, "CompareOperatorId");
                }), Core.Components.SearchEntry);
                if (cell == null) {
                    return;
                }

                var parentCellElement = cell.ParentElement;
                var parentCell = cell.Parent;
                cell.Dispose();
                var component = null;
                var isSearchId = System.Array.contains(this._searchByIdList, field.ComponentType, System.String);
                if (Bridge.referenceEquals(field.ComponentType, "Datepicker")) {
                    component = Core.Components.AdvancedSearch.SetSearchDateTime(compareCell, field);
                    condition.Value = System.DateTimeOffset.Now.toString();
                } else if (Bridge.referenceEquals(field.ComponentType, "SearchEntry") || Bridge.referenceEquals(field.ComponentType, "MultipleSearchEntry")) {
                    component = this.SetSearchId(compareCell, field);
                    condition.Value = "";
                } else if (Bridge.referenceEquals(field.ComponentType, "Checkbox")) {
                    component = Core.Components.AdvancedSearch.SetSearchBool(compareCell, field);
                    condition.Value = Bridge.toString((Core.Enums.ActiveStateEnum.All));
                } else if (Bridge.referenceEquals(field.ComponentType, "Number")) {
                    component = Core.Components.AdvancedSearch.SetSearchDecimal(compareCell, field);
                    condition.Value = Bridge.toString((0));
                } else {
                    component = Core.Components.AdvancedSearch.SetSearchString(compareCell, field);
                }
                // Binding data manually because of field name confliction
                component.UserInput = Bridge.fn.combine(component.UserInput, function (e) {
                    component.Entity.Value = e.NewData;
                });
                condition.LogicOperatorId = ($t = condition.LogicOperatorId, $t != null ? $t : Core.Enums.LogicOperation.And);
                ($t1 = Core.Components.Extensions.ComponentExt.FirstOrDefault(this._filterGrid, function (x) {
                        return x.GuiInfo != null && Bridge.referenceEquals(x.Entity, condition) && Bridge.referenceEquals(x.FieldName, "LogicOperatorId");
                    })) != null ? $t1.UpdateView() : null;
                condition.CompareOperatorId = ($t2 = System.Linq.Enumerable.from(compareCell.GuiInfo.LocalData).select(function (x) { return Bridge.cast(x, Core.Models.Entity); }).firstOrDefault(null, null)) != null && ($t3 = $t2.Id) != null ? Core.Extensions.Utils.TryParseInt($t3) : null;
                compareCell.Value = ($t4 = condition.CompareOperatorId) != null ? Bridge.toString($t4) : null;
                compareCell.UpdateView();
                component.Entity = condition;
                Core.Components.Extensions.ComponentExt.SetValue(component, "Value", condition.Value);
                component.Parent = parentCell;
                parentCell.Children.insert(2, component);
                component.ParentElement = parentCellElement;
                component.Render();
            },
            SetSearchId: function (compareCell, field) {
                compareCell.GuiInfo.LocalData = System.Linq.Enumerable.from(Core.Components.AdvancedSearch.OperatorFactory(Core.Enums.ComponentTypeTypeEnum.SearchEntry)).select(function (x) { return Bridge.cast(x, System.Object); }).toList(System.Object);
                compareCell.Value = Bridge.toString((Core.Enums.AdvSearchOperation.In));

                var comInfo = new Core.Models.Component();
                Core.Extensions.ReflectionExt.CopyPropFrom(comInfo, field);
                comInfo.ComponentType = "MultipleSearchEntry";
                var component = new Core.Components.MultipleSearchEntry(comInfo);
                return component;
            }
        }
    });

    Bridge.define("Core.Components.ExportCustomData", {
        inherits: [Core.Components.Forms.PopupEditor],
        statics: {
            fields: {
                Prefix: null
            },
            ctors: {
                init: function () {
                    this.Prefix = "Export";
                }
            }
        },
        fields: {
            ParentListView: null,
            _tbody: null,
            _headers: null,
            _userSetting: null,
            _table: null,
            _hasLoadSetting: false
        },
        ctors: {
            ctor: function (parent) {
                this.$initialize();
                Core.Components.Forms.PopupEditor.ctor.call(this, "Component");
                this.Name = "Export CustomData";
                this.Title = "Xu\u1ea5t excel t\u00f9y ch\u1ecdn";
                this.DOMContentLoaded = Bridge.fn.combine(this.DOMContentLoaded, Bridge.fn.bind(this, function () {
                    this.LocalRender();
                }));
                this.ParentListView = parent;
                this._headers = System.Linq.Enumerable.from(this.ParentListView.Header, Core.Models.Component).where(function (x) {
                        return !Bridge.referenceEquals(x.ComponentType, "Button") && !Core.Extensions.StringExt.IsNullOrWhiteSpace(x.ShortDesc);
                    }).toList(Core.Models.Component);
            }
        },
        methods: {
            Move: function () {
                var seft = this;
                const table = this._table;

                let draggingEle;
                let draggingRowIndex;
                let placeholder;
                let list;
                let isDraggingStarted = false;

                // The current position of mouse relative to the dragging element
                let x = 0;
                let y = 0;

                // Swap two nodes
                const swap = function (nodeA, nodeB) {
                    const parentA = nodeA.parentNode;
                    const siblingA = nodeA.nextSibling === nodeB ? nodeA : nodeA.nextSibling;

                    // Move `nodeA` to before the `nodeB`
                    nodeB.parentNode.insertBefore(nodeA, nodeB);

                    // Move `nodeB` to before the sibling of `nodeA`
                    parentA.insertBefore(nodeB, siblingA);
                };

                // Check if `nodeA` is above `nodeB`
                const isAbove = function (nodeA, nodeB) {
                    // Get the bounding rectangle of nodes
                    const rectA = nodeA.getBoundingClientRect();
                    const rectB = nodeB.getBoundingClientRect();

                    return rectA.top + rectA.height / 2 < rectB.top + rectB.height / 2;
                };

                const cloneTable = function () {
                    const rect = table.getBoundingClientRect();
                    const width = parseInt(window.getComputedStyle(table).width);

                    list = document.createElement('div');
                    list.classList.add('clone-list');
                    list.style.position = 'absolute';
                    table.parentNode.insertBefore(list, table);

                    // Hide the original table
                    table.style.visibility = 'hidden';

                    table.querySelectorAll('tr').forEach(function (row) {
                        // Create a new table from given row
                        const item = document.createElement('div');
                        item.classList.add('draggable');

                        const newTable = document.createElement('table');
                        newTable.setAttribute('class', 'clone-table');
                        newTable.style.width = `${width}px`;

                        const newRow = document.createElement('tr');
                        const cells = [].slice.call(row.children);
                        cells.forEach(function (cell) {
                            const newCell = cell.cloneNode(true);
                            newCell.style.width = `${parseInt(window.getComputedStyle(cell).width)}px`;
                            newRow.appendChild(newCell);
                        });

                        newTable.appendChild(newRow);
                        item.appendChild(newTable);
                        list.appendChild(item);
                    });
                };

                const mouseDownHandler = function (e) {
                    // Get the original row
                    const originalRow = e.target.parentNode;
                    draggingRowIndex = [].slice.call(table.querySelectorAll('tr')).indexOf(originalRow);

                    // Determine the mouse position
                    x = e.clientX;
                    y = e.clientY;

                    // Attach the listeners to `document`
                    document.addEventListener('mousemove', mouseMoveHandler);
                    document.addEventListener('mouseup', mouseUpHandler);
                };

                const mouseMoveHandler = function (e) {
                    if (!isDraggingStarted) {
                        isDraggingStarted = true;

                        cloneTable();

                        draggingEle = [].slice.call(list.children)[draggingRowIndex];
                        draggingEle.classList.add('dragging');

                        // Let the placeholder take the height of dragging element
                        // So the next element won't move up
                        placeholder = document.createElement('div');
                        placeholder.classList.add('placeholder');
                        draggingEle.parentNode.insertBefore(placeholder, draggingEle.nextSibling);
                        placeholder.style.height = `${draggingEle.offsetHeight}px`;
                    }

                    // Set position for dragging element
                    draggingEle.style.position = 'absolute';
                    draggingEle.style.top = `${draggingEle.offsetTop + e.clientY - y}px`;
                    draggingEle.style.left = `${draggingEle.offsetLeft + e.clientX - x}px`;

                    // Reassign the position of mouse
                    x = e.clientX;
                    y = e.clientY;

                    // The current order
                    // prevEle
                    // draggingEle
                    // placeholder
                    // nextEle
                    const prevEle = draggingEle.previousElementSibling;
                    const nextEle = placeholder.nextElementSibling;

                    // The dragging element is above the previous element
                    // User moves the dragging element to the top
                    // We don't allow to drop above the header
                    // (which doesn't have `previousElementSibling`)
                    if (prevEle && prevEle.previousElementSibling && isAbove(draggingEle, prevEle)) {
                        // The current order    -> The new order
                        // prevEle              -> placeholder
                        // draggingEle          -> draggingEle
                        // placeholder          -> prevEle
                        swap(placeholder, draggingEle);
                        swap(placeholder, prevEle);
                        return;
                    }

                    // The dragging element is below the next element
                    // User moves the dragging element to the bottom
                    if (nextEle && isAbove(nextEle, draggingEle)) {
                        // The current order    -> The new order
                        // draggingEle          -> nextEle
                        // placeholder          -> placeholder
                        // nextEle              -> draggingEle
                        swap(nextEle, placeholder);
                        swap(nextEle, draggingEle);
                    }
                };

                const mouseUpHandler = function () {
                    // Remove the placeholder
                    placeholder && placeholder.parentNode.removeChild(placeholder);

                    draggingEle.classList.remove('dragging');
                    draggingEle.style.removeProperty('top');
                    draggingEle.style.removeProperty('left');
                    draggingEle.style.removeProperty('position');

                    // Get the end index
                    const endRowIndex = [].slice.call(list.children).indexOf(draggingEle);

                    isDraggingStarted = false;

                    // Remove the `list` element
                    list.parentNode.removeChild(list);

                    // Move the dragged row to `endRowIndex`
                    let rows = [].slice.call(table.querySelectorAll('tr'));
                    draggingRowIndex > endRowIndex
                        ? rows[endRowIndex].parentNode.insertBefore(rows[draggingRowIndex], rows[endRowIndex])
                        : rows[endRowIndex].parentNode.insertBefore(
                                rows[draggingRowIndex],
                                rows[endRowIndex].nextSibling
                            );

                    // Bring back the table
                    table.style.removeProperty('visibility');

                    // Remove the handlers of `mousemove` and `mouseup`
                    document.removeEventListener('mousemove', mouseMoveHandler);
                    document.removeEventListener('mouseup', mouseUpHandler);
                    seft.OrderBy();
                };

                table.querySelectorAll('tr').forEach(function (row, index) {
                    // Ignore the header
                    // We don't want user to change the order of header
                    if (index === 0) {
                        return;
                    }

                    const firstCell = row.firstElementChild;
                    firstCell.classList.add('draggable');
                    firstCell.addEventListener('mousedown', mouseDownHandler);
                });
            },
            LocalRender: function () {
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), this.ParentListView.GetUserSetting(Core.Components.ExportCustomData.Prefix), Bridge.fn.bind(this, function (x) {
                    this.UserSettingLoaded(x, true);
                }));
            },
            UserSettingLoaded: function (res, render) {
                var $t, $t1;
                if (render === void 0) { render = true; }
                this._hasLoadSetting = true;
                this._userSetting = res[System.Array.index(0, res)].length > 0 ? ($t = res[System.Array.index(0, res)])[System.Array.index(0, $t)] : null;
                if (this._userSetting != null) {
                    var usrHeaders = ($t1 = Core.Models.Component, System.Linq.Enumerable.from(Bridge.unbox(JSON.parse(Bridge.as(this._userSetting.Value, System.String))), $t1).toDictionary(function (x) {
                            return x.Id;
                        }, null, System.String, $t1));
                    this._headers.ForEach(function (x) {
                        x.IsExport = true;
                        var current = System.Collections.Generic.CollectionExtensions.GetValueOrDefault(System.String, Core.Models.Component, usrHeaders, x.Id);
                        if (current != null) {
                            x.IsExport = current.IsExport;
                            x.OrderExport = current.OrderExport;
                        }
                    });
                }
                this._headers = System.Linq.Enumerable.from(this._headers, Core.Models.Component).orderBy(function (x) {
                        return x.OrderExport;
                    }).toList(Core.Models.Component);
                if (!render) {
                    return;
                }
                var content = Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section, this, "Content");
                Core.Components.Renderer.ClassName(Core.MVVM.Html.Take(content.Element).Table, "table");
                this._table = Core.MVVM.Html.Context;
                Core.MVVM.Html.Instance.Thead.TRow.TData.Text("STT").End.TData.Checkbox(false).Event$1("input", Bridge.fn.bind(this, function (e) {
                    this._headers.ForEach(function (x) {
                        x.IsExport = Core.Extensions.EventExt.GetChecked(e);
                    });
                    this.RenderDetails();
                })).End.End.TData.Text("T\u00ean c\u1ed9t").EndOf(Core.MVVM.ElementType.thead);
                Core.MVVM.Html.Instance.TBody.Render();
                this._tbody = Core.MVVM.Html.Context;
                this.RenderDetails();
                this.Move();
            },
            SetChecked: function (item, e) {
                item.IsExport = Bridge.cast(e.target, HTMLInputElement).checked;
                this.Dirty = true;
            },
            DirtyCheckAndCancel: function () {
                this.Dirty = true;
                Core.Components.Forms.PopupEditor.prototype.DirtyCheckAndCancel.call(this);
            },
            RenderDetails: function () {
                var $t;
                Core.MVVM.Html.Take(this._tbody).Clear();
                var i = 1;
                $t = Bridge.getEnumerator(this._headers);
                try {
                    while ($t.moveNext()) {
                        var item = { v : $t.Current };
                        Core.Components.Renderer.IText(Core.Components.Renderer.ClassName(Core.Components.Renderer.IText(Core.MVVM.Html.Instance.TRow.DataAttr$1("id", item.v.Id).TData.DataAttr$1("id", item.v.Id).Style$1("padding:0"), Bridge.toString(i)).End.TData.Style$1("padding:0").Checkbox(item.v.IsExport).Event$1("input", (function ($me, item) {
                            return function (e1) {
                                item.v.IsExport = Bridge.cast(e1.target, HTMLInputElement).checked;
                            };
                        })(this, item)).End.End.TData.Style$1("padding:0"), "text-left"), item.v.ShortDesc).End.EndOf(Core.MVVM.ElementType.tr);
                        i = (i + 1) | 0;
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                this.Move();
            },
            OrderBy: function () {
                var j = 1;
                Core.Extensions.IEnumerableExtensions.SelectForEach(HTMLElement, this._tbody.children, Bridge.fn.bind(this, function (y) {
                    System.Linq.Enumerable.from(this._headers, Core.Models.Component).firstOrDefault(function (x) {
                            return Bridge.referenceEquals(x.Id, y.getAttribute("data-id"));
                        }, null).OrderExport = j;
                    j = (j + 1) | 0;
                }));
            },
            ExportAll: function () {
                this.Export();
            },
            ExportSelected: function () {
                if (Core.Extensions.IEnumerableExtensions.Nothing(System.String, this.ParentListView.SelectedIds)) {
                    Core.Extensions.Toast.Warning("Select at lease 1 row to export");
                    return;
                }
                this.Export(void 0, void 0, this.ParentListView.SelectedIds.ToArray());
            },
            Export: function (skip, pageSize, selectedIds) {
                if (skip === void 0) { skip = null; }
                if (pageSize === void 0) { pageSize = null; }
                if (selectedIds === void 0) { selectedIds = null; }
                Core.Extensions.Toast.Success("\u0110ang xu\u1ea5t excel");
                if (this._hasLoadSetting && this.Dirty) {
                    this.ParentListView.UpdateSetting(this._userSetting, Core.Components.ExportCustomData.Prefix, JSON.stringify(this._headers)).Done();
                    this.ExportWithSetting(skip, pageSize, selectedIds);
                    return;
                }
                Core.Extensions.EventExt.Done$1(System.Array.type(System.Array.type(System.Object)), this.ParentListView.GetUserSetting(Core.Components.ExportCustomData.Prefix), Bridge.fn.bind(this, function (x) {
                    this.UserSettingLoaded(x, false);
                    this.ExportWithSetting(skip, pageSize, selectedIds);
                }));
            },
            ExportWithSetting: function (skip, pageSize, selectedIds) {
                var $t, $t1;
                var sql = this.ParentListView.GetSql(skip, pageSize);
                sql.Count = false;
                if (Core.Extensions.IEnumerableExtensions.HasElement(Core.Models.Component, this._headers)) {
                    sql.FieldName = System.Linq.Enumerable.from(this._headers, Core.Models.Component).where(function (x) {
                            return x.IsExport;
                        }).select(function (x) {
                        return Core.Extensions.StringExt.IsNullOrWhiteSpace(x.FieldText) ? x.FieldName : x.FieldText;
                    }).ToArray(System.String);
                    sql.Select = Core.Extensions.IEnumerableExtensions.HasElement(System.String, sql.FieldName) ? Core.Extensions.IEnumerableExtensions.Combine(System.String, sql.FieldName) : null;
                }
                if (Core.Extensions.IEnumerableExtensions.HasElement(System.String, selectedIds)) {
                    var ids = Core.Extensions.IEnumerableExtensions.CombineStrings(selectedIds);
                    sql.Where = System.String.format("Id in ({0})", [ids]);
                }
                sql.Params = ($t = this.ParentListView.GuiInfo.Label, $t != null ? $t : this.ParentListView.GuiInfo.RefName);
                sql.Table = this.ParentListView.GuiInfo.RefName;
                var pathTask = Core.Clients.Client.Instance.SubmitAsync(System.String, ($t1 = new Core.Clients.XHRWrapper(), $t1.Value = JSON.stringify(sql), $t1.Url = Core.Extensions.Utils.ExportExcel, $t1.IsRawString = true, $t1.Method = Core.Enums.HttpMethod.POST, $t1));
                Core.Clients.Client.ExecTask(System.String, pathTask, function (path) {
                    Core.Clients.Client.Download(System.String.format("/excel/Download/{0}", [path]));
                    Core.Extensions.Toast.Success("Xu\u1ea5t file th\u00e0nh c\u00f4ng");
                });
            }
        }
    });

    Bridge.define("Core.Components.Framework.ComponentBL", {
        inherits: [Core.Components.Forms.PopupEditor],
        ctors: {
            ctor: function () {
                this.$initialize();
                Core.Components.Forms.PopupEditor.ctor.call(this, "Component");
                this.Name = "ComponentEditor";
                this.Title = "Component properties";
                this.Icon = "fa fa-wrench";
                this.Id = "EditComponent_" + (this.Id || "");
                this.Entity = new Core.Models.Component();
                this.PopulateDirty = false;
                this.Config = true;
                this.DOMContentLoaded = Bridge.fn.combine(this.DOMContentLoaded, Bridge.fn.cacheBind(this, this.AlterPosition));
            }
        },
        methods: {
            AlterPosition: function () {
                Core.Extensions.HtmlElementExtension.AddClass(this.Element.parentElement, "properties");
            }
        }
    });

    Bridge.define("Core.Components.Framework.ComponentGroupBL", {
        inherits: [Core.Components.Forms.PopupEditor],
        props: {
            ComGroupEntity: {
                get: function () {
                    return Bridge.as(this.Entity, Core.Models.ComponentGroup);
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                Core.Components.Forms.PopupEditor.ctor.call(this, "ComponentGroup");
                this.Name = "ComponentGroup";
                this.Title = "Section properties";
                this.Icon = "fa fa-wrench";
                this.PopulateDirty = false;
                this.Config = true;
                this.DOMContentLoaded = Bridge.fn.combine(this.DOMContentLoaded, Bridge.fn.cacheBind(this, this.AlterPosition));
            }
        },
        methods: {
            AlterPosition: function () {
                Core.Extensions.HtmlElementExtension.AddClass(this.Element.parentElement, "properties");
            }
        }
    });

    Bridge.define("Core.Components.Framework.FeatureBL", {
        inherits: [Core.Components.Forms.PopupEditor],
        ctors: {
            ctor: function () {
                this.$initialize();
                Core.Components.Forms.PopupEditor.ctor.call(this, "Feature");
                this.Name = "Feature management";
                this.Title = "Feature";
                this.Icon = "icons/config.png";
                this.Config = true;
                this.DOMContentLoaded = Bridge.fn.combine(this.DOMContentLoaded, Bridge.fn.cacheBind(this, this.AlterPosition));
            }
        },
        methods: {
            AlterPosition: function () {
                Core.Extensions.HtmlElementExtension.AddClass(this.Element.parentElement, "properties");
            },
            EditFeature: function (feature) {
                var id = "Feature_" + (feature.Id || "");
                Core.Components.Extensions.ComponentExt.OpenTab(this, id, function () {
                    var $t, $t1, $t2;
                    return ($t = new Core.Components.Framework.FeatureDetailBL(), $t.Id = id, $t.Entity = feature, $t.Title = System.String.format("Feature {0}", [($t1 = feature.Name, $t1 != null ? $t1 : ($t2 = feature.Label, $t2 != null ? $t2 : feature.Description))]), $t);
                });
            }
        }
    });

    Bridge.define("Core.Components.Framework.FeatureDetailBL", {
        inherits: [Core.Components.Forms.PopupEditor],
        props: {
            FeatureEntity: {
                get: function () {
                    return Core.Extensions.BridgeExt.CastProp(Core.Models.Feature, this.Entity);
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                Core.Components.Forms.PopupEditor.ctor.call(this, "Feature");
                this.Name = "FeatureEditor";
                this.Title = "Feature";
                this.PopulateDirty = false;
                this.Entity = new Core.Models.Feature();
                this.Config = true;
                this.DOMContentLoaded = Bridge.fn.combine(this.DOMContentLoaded, Bridge.fn.cacheBind(this, this.AlterPosition));
            }
        },
        methods: {
            AlterPosition: function () {
                Core.Extensions.HtmlElementExtension.AddClass(this.Element.parentElement, "properties");
            },
            EditGridColumn: function (arg) {
                var $t;
                var header = Bridge.as(arg, Core.Models.Component);
                var editor = ($t = new Core.Components.Framework.ComponentBL(), $t.Entity = header, $t.ParentElement = Bridge.ensureBaseProperty(this, "TabEditor").$Core$Components$EditableComponent$TabEditor.Element, $t);
                var tab = System.Linq.Enumerable.from(Core.Components.Forms.TabEditor.Tabs, Core.Components.Forms.TabEditor).firstOrDefault(function (x) {
                        return x.Show;
                    }, null);
                tab != null ? tab.AddChild(editor) : null;
            }
        }
    });

    /** @namespace System */

    /**
     * @memberof System
     * @callback System.Action
     * @param   {Core.ViewModels.Token}    arg
     * @return  {void}
     */

    Bridge.define("Core.Components.Framework.LoginBL", {
        inherits: [Core.Components.Forms.PopupEditor],
        statics: {
            fields: {
                _instance: null,
                _initApp: false
            },
            props: {
                MenuComponent: null,
                TaskList: null,
                Instance: {
                    get: function () {
                        if (Core.Components.Framework.LoginBL._instance == null) {
                            Core.Components.Framework.LoginBL._instance = new Core.Components.Framework.LoginBL();
                        }

                        return Core.Components.Framework.LoginBL._instance;
                    }
                }
            },
            methods: {
                InitFCM: function (signout) {
                    if (signout === void 0) { signout = false; }
                    System.Console.WriteLine("Init fcm");
                    var tanentCode = Core.Clients.Client.Token.TenantCode;
                    var strUserId = System.String.format("U{0:0000000}", [Core.Clients.Client.Token.UserId]);
                    if (typeof(PushNotification) === 'undefined') return;
                    var topics = ['/topics/' + tanentCode + strUserId];
                    const push = PushNotification.init({
                        android: {
                            senderID: '9681598079',
                            topics: topics
                        },
                        ios: {
                            alert: "true",
                            badge: "true",
                            sound: "true",
                            topics: topics
                        },
                    });
                    if (signout && push.unsubscribe) {
                        push.unsubscribe(topics[0]);
                        return;
                    }
                    push.on('registration', (data) => {
                    });
                    push.on('notification', (data) => {
                        if (typeof(cordova) !== 'undefined' &&
                            typeof(cordova.plugins) !== 'undefined' &&
                            typeof(cordova.plugins.notification) !== 'undefined') {
                            cordova.plugins.notification.local.schedule({
                                title: data.title,
                                text: data.message,
                                foreground: true,
                            });
                        }
                        // data.message,
                        // data.title,
                        // data.count,
                        // data.sound,
                        // data.image,
                        // data.additionalData
                    });

                    push.on('error', (e) => {
                        // e.message
                    });
                },
                DiposeAll: function () {
                    var $t;
                    while (Core.Components.Forms.TabEditor.Tabs.Count > 0) {
                        ($t = Core.Components.Forms.TabEditor.Tabs.getItem(0)) != null ? $t.Dispose() : null;
                    }
                    if (Core.Components.Framework.LoginBL.MenuComponent != null) {
                        Core.Components.Framework.LoginBL.MenuComponent.Dispose();
                    }

                    if (Core.Components.Framework.LoginBL.TaskList != null) {
                        Core.Components.Framework.LoginBL.TaskList.Dispose();
                    }

                    Core.Components.Framework.LoginBL.MenuComponent = null;
                    Core.Components.Framework.LoginBL.TaskList = null;
                }
            }
        },
        fields: {
            _renderAwaiter: 0
        },
        props: {
            LoginEntity: {
                get: function () {
                    return Bridge.as(this.Entity, Core.ViewModels.LoginVM);
                }
            },
            /**
             * This action is invoke after the user get signed in
             *
             * @instance
             * @public
             * @memberof Core.Components.Framework.LoginBL
             * @function SignedInHandler
             * @type System.Action
             */
            SignedInHandler: null,
            /**
             * This action is invoked when the app is initial
             *
             * @instance
             * @public
             * @memberof Core.Components.Framework.LoginBL
             * @function InitAppHanlder
             * @type System.Action
             */
            InitAppHanlder: null,
            /**
             * This action is invoked after user signed in or the token is refreshed
             *
             * @instance
             * @public
             * @memberof Core.Components.Framework.LoginBL
             * @function TokenRefreshedHandler
             * @type System.Action
             */
            TokenRefreshedHandler: null
        },
        ctors: {
            ctor: function () {
                var $t;
                this.$initialize();
                Core.Components.Forms.PopupEditor.ctor.call(this, "User");
                this.Entity = ($t = new Core.ViewModels.LoginVM(), $t.AutoSignIn = true, $t);
                this.Name = "Login";
                this.Title = "\u0110\u0103ng nh\u1eadp";
                window.addEventListener("beforeunload", function () {
                    Core.Components.Forms.EditForm.NotificationClient != null ? Core.Components.Forms.EditForm.NotificationClient.Close() : null;
                });
                this.Public = true;
                this.HeartBeat();
            }
        },
        methods: {
            Render: function () {
                var oldToken = Core.Clients.Client.Token;
                if (oldToken == null || System.DateTimeOffset.op_LessThanOrEqual(oldToken.RefreshTokenExp.$clone(), Core.Clients.Client.EpsilonNow.$clone())) {
                    this.RenderLoginForm();
                } else if (System.DateTimeOffset.op_GreaterThan(oldToken.AccessTokenExp.$clone(), Core.Clients.Client.EpsilonNow.$clone())) {
                    this.InitAppIfEmpty();
                } else if (System.DateTimeOffset.op_GreaterThan(oldToken.RefreshTokenExp.$clone(), Core.Clients.Client.EpsilonNow.$clone())) {
                    Core.Extensions.EventExt.Done$1(Core.ViewModels.Token, Core.Clients.Client.RefreshToken(), Bridge.fn.bind(this, function (newToken) {
                        this.InitAppIfEmpty();
                    }));
                }
            },
            HeartBeat: function () {
                window.setInterval(function () {
                    if (Core.Clients.Client.Token == null) {
                        return;
                    }
                    Core.Extensions.EventExt.Done$1(Core.ViewModels.Token, Core.Clients.Client.RefreshToken());
                }, 1000);
            },
            RenderLoginForm: function () {
                window.clearTimeout(this._renderAwaiter);
                this._renderAwaiter = window.setTimeout(Bridge.fn.bind(this, function () {
                    if (this._backdrop != null) {
                        document.body.appendChild(this._backdrop);
                        Core.Extensions.HtmlElementExtension.Show(this._backdrop);
                        return;
                    }
                    Core.Components.Renderer.ClassName(Core.MVVM.Html.Take$1("#tab-content").Div, "modal is-open").Event$1("keypress", Bridge.fn.cacheBind(this, this.KeyCodeEnter));
                    this._backdrop = Core.MVVM.Html.Context;
                    Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.Components.Renderer.ClassName(Core.MVVM.Html.Instance.Div, "modal-container").Div, "modal-left").H1, "modal-title").Text("XIN CH\u00c0O").End.Div, "input-block").Label, "input-label").Text("T\u00ean t\u00e0i kho\u1ea3n").End.Input.Event$1("input", Bridge.fn.bind(this, function (e) {
                        this.LoginEntity.UserName = Core.Extensions.EventExt.GetInputText(e);
                    })).Attr$1("name", "UserName").Type$1("text").End.End.Div, "input-block").Label, "input-label").Text("M\u1eadt kh\u1ea9u").End.Input.Event$1("input", Bridge.fn.bind(this, function (e) {
                        this.LoginEntity.Password = Core.Extensions.EventExt.GetInputText(e);
                    })).Attr$1("name", "Password").Value(this.LoginEntity.Password).Type$1("password").End.End.Div, "input-block").Label, "input-label").Text("Ghi nh\u1edb").End.Label, "checkbox input-small transition-on style2").Checkbox(this.LoginEntity.AutoSignIn).Event$1("input", Bridge.fn.bind(this, function (e) {
                        this.LoginEntity.AutoSignIn = Bridge.cast(e.target, HTMLInputElement).checked;
                    })).Attr$1("name", "AutoSignIn").Attr$1("name", "AutoSignIn").End.Span, "check myCheckbox").End.End.End.Div, "modal-buttons").A.Href("").Text("Qu\u00ean m\u1eadt kh\u1ea9u?").End.Button.Id("btnLogin").Event("click", Bridge.fn.bind(this, function () {
                        Core.Extensions.EventExt.Done$1(System.Boolean, this.Login());
                    })), "input-button").Text("\u0110\u0103ng nh\u1eadp").End.End.End.Div, "modal-right").Img.Src("../image/bg-launch.jpg").End.Render();
                    Bridge.ensureBaseProperty(this, "Element").$Core$Components$EditableComponent$Element = Core.MVVM.Html.Context;
                }), 100);
            },
            KeyCodeEnter: function (e) {
                if (Core.Extensions.EventExt.KeyCode(e) !== Core.Enums.KeyCodeEnum.Enter) {
                    return;
                }
                e.preventDefault();
                document.getElementById("btnLogin").click();
            },
            Login: function () {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done$1(System.Boolean, this.IsFormValid(), Bridge.fn.bind(this, function (isValid) {
                    if (!isValid) {
                        tcs.trySetResult(false);
                        return;
                    }
                    Core.Extensions.EventExt.Done$1(System.Boolean, this.SubmitLogin(), function (status) {
                        tcs.trySetResult(status);
                    });
                }));
                return tcs.task;
            },
            SubmitLogin: function () {
                var $t;
                var login = this.LoginEntity;
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                login.RecoveryToken = Core.Extensions.Utils.GetUrlParam("recovery");
                var domainUser = System.String.split(login.UserName, [47].map(function (i) {{ return String.fromCharCode(i); }}));
                login.CompanyName = domainUser.length > 1 ? domainUser[System.Array.index(0, domainUser)] : Core.Clients.Client.Tenant;
                login.UserName = domainUser.length > 1 ? domainUser[System.Array.index(1, domainUser)] : login.UserName;
                if (Core.Extensions.StringExt.IsNullOrWhiteSpace(login.CompanyName)) {
                    Core.Extensions.Toast.Warning("Company name must be provided!\nFor example my-compay/my-username");
                    return System.Threading.Tasks.Task.fromResult(false, System.Boolean);
                }
                login.Env = Core.Clients.Client.Env;
                Core.Extensions.EventExt.Catch(Core.Extensions.EventExt.Done$1(Core.ViewModels.Token, Core.Clients.Client.Instance.SubmitAsync(Core.ViewModels.Token, ($t = new Core.Clients.XHRWrapper(), $t.Url = System.String.format("/{0}/User/SignIn", [login.CompanyName]), $t.Value = JSON.stringify(login), $t.IsRawString = true, $t.Method = Core.Enums.HttpMethod.POST, $t.AllowAnonymous = true, $t)), Bridge.fn.bind(this, function (res) {
                    var $t1;
                    if (res == null) {
                        tcs.trySetResult(false);
                        return;
                    }
                    Core.Extensions.Toast.Success(System.String.format("Xin ch\u00e0o {0}!", [res.FullName]));
                    Core.Clients.Client.Token = res;
                    login.UserName = "";
                    login.Password = "";
                    this.InitAppIfEmpty();
                    Core.Components.Framework.LoginBL.InitFCM();
                    !Bridge.staticEquals(($t1 = this.SignedInHandler), null) ? $t1(Core.Clients.Client.Token) : null;
                    tcs.trySetResult(true);
                    this.Dispose();
                })), function (e) {
                    tcs.trySetResult(false);
                });
                return tcs.task;
            },
            ForgotPassword: function (login) {
                var tcs = new System.Threading.Tasks.TaskCompletionSource();
                Core.Extensions.EventExt.Done$1(System.Boolean, Core.Clients.Client.Instance.PostAsync(System.Boolean, login, "/user/ForgotPassword"), function (res) {
                    if (res) {
                        Core.Extensions.Toast.Warning("An error occurs. Please contact the administrator to get your password!");
                    } else {
                        Core.Extensions.Toast.Success(System.String.format("A recovery email has been sent to your email address. Please check and follow the steps in the email!", null));
                    }
                    tcs.trySetResult(res);
                });
                return tcs.task;
            },
            InitAppIfEmpty: function () {
                var $t;
                Core.Clients.Client.SystemRole = Core.Clients.Client.Token.RoleIds.contains(Bridge.toString((Core.Enums.RoleEnum.System)));
                if (Core.Components.Framework.LoginBL._initApp) {
                    return;
                }
                Core.Components.Framework.LoginBL._initApp = true;
                !Bridge.staticEquals(($t = this.InitAppHanlder), null) ? $t(Core.Clients.Client.Token) : null;
                var userId = Core.Clients.Client.Token.UserId;
                if (Core.Components.Forms.EditForm.NotificationClient == null) {
                    Core.Components.Forms.EditForm.NotificationClient = new Core.Clients.WebSocketClient("task");
                }

                if (Core.Components.Framework.LoginBL.MenuComponent == null) {
                    Core.Components.Framework.MenuComponent.Instance.Render();
                }
                if (Core.Components.Framework.LoginBL.TaskList == null) {
                    Core.Components.Framework.LoginBL.TaskList = Core.Components.Framework.NotificationBL.Instance;
                    Core.Components.Framework.LoginBL.TaskList.Render();
                    Core.Components.Framework.LoginBL.TaskList.DOMContentLoaded = Bridge.fn.combine(Core.Components.Framework.LoginBL.TaskList.DOMContentLoaded, function () {
                        document.getElementById("name-user").textContent = Core.Clients.Client.Token.UserName;
                        document.getElementById("Username-text").textContent = Core.Clients.Client.Token.FullName;
                        document.getElementById("text-address").textContent = Core.Clients.Client.Token.Address;
                        Core.MVVM.Html.Take$1("#user-image").Src("./image/" + (Core.Clients.Client.Token.Avatar || ""));
                        Core.MVVM.Html.Take$1("#img-detail").Src("./image/" + (Core.Clients.Client.Token.Avatar || ""));
                    });
                }
            },
            Dispose: function () {
                Core.Extensions.HtmlElementExtension.Hide(this._backdrop);
                Core.MVVM.Html.Take$1(".is-open").Clear();
            }
        }
    });

    Bridge.define("Core.Components.Framework.RegistrationBL", {
        inherits: [Core.Components.Forms.PopupEditor],
        props: {
            VM: {
                get: function () {
                    return Bridge.as(this.Entity, Core.ViewModels.RegistrationVM);
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                Core.Components.Forms.PopupEditor.ctor.call(this, "User");
                this.Entity = new Core.ViewModels.RegistrationVM();
                this.Name = "Registration";
                this.Title = this.Name;
                this.Public = true;
            }
        },
        methods: {
            Register: function () {
                Core.Extensions.EventExt.Done$1(System.Boolean, this.IsFormValid(), Bridge.fn.bind(this, function (isValid) {
                    if (!isValid) {
                        return;
                    }
                    Core.Extensions.EventExt.Done$1(System.Boolean, Core.Clients.Client.Instance.PostAsync(System.Boolean, this.VM, "Register", true), Bridge.fn.bind(this, function (result) {
                        if (!result) {
                            return;
                        }
                        this.ShowDialog();
                    }));
                }));
            },
            ShowDialog: function () {
                var $t;
                this._confirm = ($t = new Core.Components.Forms.ConfirmDialog(), $t.Content = (System.String.format("B\u1ea1n \u0111\u00e3 \u0111\u0103ng k\u00fd success, 1 email \u0111\u00e3 \u0111\u01b0\u1ee3c g\u1edfi v\u00e0o \u0111\u1ecba ch\u1ec9 {0}.<br />", [this.VM.Email]) || "") + (System.String.format("Vui l\u00f2ng ki\u1ec3m tra email \u0111\u1ec3 x\u00e1c nh\u1eadn vi\u1ec7c \u0111\u0103ng k\u00fd.<br />", null) || "") + (System.String.format("Email g\u1edfi \u0111\u1ebfn c\u00f3 th\u1ec3 n\u1eb1m trong th\u00f9ng r\u00e1c.<br />", null) || "") + (System.String.format("Xin l\u01b0u \u00fd, duy\u1ec7t t\u00e0i kho\u1ea3n c\u1ee7a b\u1ea1n c\u00f3 th\u1ec3 di\u1ec5n ra trong 1 - 3 ng\u00e0y l\u00e0m vi\u1ec7c.", null) || ""), $t);
                this._confirm.YesText = "\u0110\u1ed3ng \u00fd";
                this._confirm.YesConfirmed = Bridge.fn.combine(this._confirm.YesConfirmed, Bridge.fn.cacheBind(this, this.Dispose));
                this._confirm.Canceled = Bridge.fn.combine(this._confirm.Canceled, Bridge.fn.cacheBind(this, this.Dispose));
                this._confirm.IgnoreNoButton = true;
                this._confirm.Render();
            },
            Dispose: function () {
                this._confirm != null ? this._confirm.Dispose() : null;
                Core.Components.Forms.PopupEditor.prototype.Dispose.call(this);
            }
        }
    });

    Bridge.define("Core.Components.SecurityBL", {
        inherits: [Core.Components.Forms.PopupEditor],
        props: {
            Security: {
                get: function () {
                    return Bridge.as(this.Entity, Core.ViewModels.SecurityVM);
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                Core.Components.Forms.PopupEditor.ctor.call(this, "FeaturePolicy");
                this.Name = "SecurityEditor";
                this.Title = "B\u1ea3o m\u1eadt & Ph\u00e2n quy\u1ec1n";
                this.Icon = "mif-security";
            }
        }
    });

    Bridge.define("Core.Components.SecurityEditorBL", {
        inherits: [Core.Components.Forms.PopupEditor],
        props: {
            SecurityEntity: {
                get: function () {
                    return Bridge.as(this.Entity, Core.ViewModels.SecurityVM);
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                Core.Components.Forms.PopupEditor.ctor.call(this, "FeaturePolicy");
                this.Name = "CreateSecurity";
                this.Title = "B\u1ea3o m\u1eadt & Ph\u00e2n quy\u1ec1n";
                this.Icon = "mif-security";
                this.DOMContentLoaded = Bridge.fn.combine(this.DOMContentLoaded, Bridge.fn.cacheBind(this, this.CheckAllPolicy));
            }
        },
        methods: {
            CheckAllPolicy: function () {
                this.SecurityEntity.CanDelete = this.SecurityEntity.AllPermission;
                this.SecurityEntity.CanDeactivate = this.SecurityEntity.AllPermission;
                this.SecurityEntity.CanRead = this.SecurityEntity.AllPermission;
                this.SecurityEntity.CanWrite = this.SecurityEntity.AllPermission;
                this.SecurityEntity.CanShare = this.SecurityEntity.AllPermission;
                Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section, this, "Properties").UpdateView();
            },
            CheckPolicy: function () {
                this.SecurityEntity.AllPermission = !(!this.SecurityEntity.CanDeactivate || !this.SecurityEntity.CanDelete || !this.SecurityEntity.CanRead || !this.SecurityEntity.CanShare || !this.SecurityEntity.CanWrite);
                Core.Components.Extensions.ComponentExt.FindComponentByName(Core.Components.Section, this, "Properties").UpdateView();
            }
        }
    });
});
